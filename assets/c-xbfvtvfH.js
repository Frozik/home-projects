var c_=Object.defineProperty;var u_=(t,e,n)=>e in t?c_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Nd=(t,e,n)=>u_(t,typeof e!="symbol"?e+"":e,n);import{ag as uh,ah as Pc,ai as iv,aj as d_,ak as h_,al as f_,am as sv,an as ly,ao as pl,ap as p_,aq as r1,ar as cy,as as m_,at as a1,au as ih,av as g_,r as S,aw as ml,u as ji,i as Et,N as v_,a6 as gl,Y as x_,X as l1,V as b_,a7 as vl,ax as c1,ay as y_,az as w_,aA as ov,aB as rv,f as ye,s as ce,aC as _n,A as ke,K as et,aD as C_,B as me,c as nf,aE as wo,w as X,D as Ve,z as In,aF as S_,aG as Lo,aH as I_,aI as Ze,aJ as $_,aK as E_,aL as Ki,o as Wo,R as Wl,aM as Pi,x as av,y as lv,aN as N_,aO as ks,aP as Um,aQ as cv,v as Da,t as uv,G as Gl,E as Oo,g as Ys,m as Si,C as $n,aR as k_,aS as D_,a as os,aT as dh,b as he,aU as u1,aV as d1,I as En,aW as dv,aX as h1,aY as hv,e as Ta,aZ as br,d as kr,a_ as sf,a$ as T_,p as R_,b0 as f1,b1 as hh,b2 as __,b3 as A_,b4 as uy,q as Mc,F as xl,b5 as jm,b6 as O_,b7 as P_,b8 as M_,S as p1,b9 as Fc,ba as dy,bb as fv,bc as hy,bd as fy,be as F_,bf as py,bg as m1,bh as g1,bi as Ae,bj as pv,bk as L_,bl as z_,bm as B_,T as my,bn as V_,bo as W_,bp as v1,bq as po,br as G_,bs as H_,bt as gy,bu as U_,bv as j_,W as Lc,U as K_,bw as mv,H as tt,bx as Zr,af as x1,a8 as bl,ac as of,ad as yl,by as vy,M as X_,bz as q_,ae as xy,bA as by,Z as Y_}from"./e-lfq7BXF7.js";import{a as J_,u as gv}from"./c-C30sOuAq.js";import{R as b1,C as Z_,a as y1,V as rf,A as w1}from"./c-CUQF0nyJ.js";import{a as Q_,S as eA,k as vv}from"./c-B0JJgYjM.js";import{b as C1,a as S1,c as tA,r as wl,u as xv,d as nA}from"./c-CJ60_Qwl.js";import{d as yy,c as iA}from"./c-Ba6rztwA.js";import{selectCurrentCompetition as bv,addCompetitionRun as sA,selectPlaygroundGravity as oA,setPlaygroundGravity as rA,selectCompetitionsList as aA,setCurrentCompetition as lA,loadCompetition as cA,selectGravity as uA,setGravity as dA}from"./c-DKSsBA4C.js";import{F as hA,s as fA,a as pA,b as mA,c as gA,i as wy,d as Cy,g as vA,R as Sy,D as I1,e as xA,M as bA,O as yA,S as wA}from"./c-D4l_Q6Ky.js";function CA(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const o=Object.getOwnPropertyDescriptor(i,s);o&&Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var SA=/\s/;function IA(t){for(var e=t.length;e--&&SA.test(t.charAt(e)););return e}var $A=/^\s+/;function EA(t){return t&&t.slice(0,IA(t)+1).replace($A,"")}var Iy=NaN,NA=/^[-+]0x[0-9a-f]+$/i,kA=/^0b[01]+$/i,DA=/^0o[0-7]+$/i,TA=parseInt;function na(t){if(typeof t=="number")return t;if(uh(t))return Iy;if(Pc(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Pc(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=EA(t);var n=kA.test(t);return n||DA.test(t)?TA(t.slice(2),n?2:8):NA.test(t)?Iy:+t}var $y=1/0,RA=17976931348623157e292;function _A(t){if(!t)return t===0?t:0;if(t=na(t),t===$y||t===-$y){var e=t<0?-1:1;return e*RA}return t===t?t:0}function $1(t){var e=_A(t),n=e%1;return e===e?n?e-n:e:0}function Hl(t){return t}function AA(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function fh(){}var OA=800,PA=16,MA=Date.now;function FA(t){var e=0,n=0;return function(){var i=MA(),s=PA-(i-n);if(n=i,s>0){if(++e>=OA)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function LA(t){return function(){return t}}var zA=yy?function(t,e){return yy(t,"toString",{configurable:!0,enumerable:!1,value:LA(e),writable:!0})}:Hl,BA=FA(zA),Ey=Math.max;function VA(t,e,n){return e=Ey(e===void 0?t.length-1:e,0),function(){for(var i=arguments,s=-1,o=Ey(i.length-e,0),r=Array(o);++s<o;)r[s]=i[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=i[s];return a[e]=n(r),AA(t,this,a)}}function WA(t,e){return BA(VA(t,e,Hl),t+"")}function Ny(t,e,n){if(!Pc(n))return!1;var i=typeof e;return(i=="number"?iv(n)&&d_(e,n.length):i=="string"&&e in n)?h_(n[e],t):!1}function yv(t,e){e=f_(e,t);for(var n=0,i=e.length;t!=null&&n<i;)t=t[sv(e[n++])];return n&&n==i?t:void 0}function GA(t,e,n){var i=t==null?void 0:yv(t,e);return i===void 0?n:i}var ky=ly?ly.isConcatSpreadable:void 0;function HA(t){return pl(t)||p_(t)||!!(ky&&t&&t[ky])}function UA(t,e,n,i,s){var o=-1,r=t.length;for(n||(n=HA),s||(s=[]);++o<r;){var a=t[o];n(a)?Q_(s,a):s[s.length]=a}return s}var jA="Expected a function";function KA(t,e){var n;if(typeof e!="function")throw new TypeError(jA);return t=$1(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=void 0),n}}var XA=r1.isFinite,qA=Math.min;function YA(t){var e=Math[t];return function(n,i){if(n=na(n),i=i==null?0:qA($1(i),292),i&&XA(n)){var s=(cy(n)+"e").split("e"),o=e(s[0]+"e"+(+s[1]+i));return s=(cy(o)+"e").split("e"),+(s[0]+"e"+(+s[1]-i))}return e(n)}}function JA(t,e,n){return t===t&&(n!==void 0&&(t=t<=n?t:n),e!==void 0&&(t=t>=e?t:e)),t}function eu(t,e,n){return n===void 0&&(n=e,e=void 0),n!==void 0&&(n=na(n),n=n===n?n:0),e!==void 0&&(e=na(e),e=e===e?e:0),JA(na(t),e,n)}var ZA=1,QA=2;function eO(t,e,n,i){var s=n.length,o=s;if(t==null)return!o;for(t=Object(t);s--;){var r=n[s];if(r[2]?r[1]!==t[r[0]]:!(r[0]in t))return!1}for(;++s<o;){r=n[s];var a=r[0],l=t[a],c=r[1];if(r[2]){if(l===void 0&&!(a in t))return!1}else{var u=new eA,d;if(!(d===void 0?C1(c,l,ZA|QA,i,u):d))return!1}}return!0}function E1(t){return t===t&&!Pc(t)}function tO(t){for(var e=vv(t),n=e.length;n--;){var i=e[n],s=t[i];e[n]=[i,s,E1(s)]}return e}function N1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function nO(t){var e=tO(t);return e.length==1&&e[0][2]?N1(e[0][0],e[0][1]):function(n){return n===t||eO(n,t,e)}}function iO(t,e){return t!=null&&e in Object(t)}function sO(t,e){return t!=null&&m_(t,e,iO)}var oO=1,rO=2;function aO(t,e){return a1(t)&&E1(e)?N1(sv(t),e):function(n){var i=GA(n,t);return i===void 0&&i===e?sO(n,t):C1(e,i,oO|rO)}}function lO(t){return function(e){return e==null?void 0:e[t]}}function cO(t){return function(e){return yv(e,t)}}function uO(t){return a1(t)?lO(sv(t)):cO(t)}function dO(t){return typeof t=="function"?t:t==null?Hl:typeof t=="object"?pl(t)?aO(t[0],t[1]):nO(t):uO(t)}function hO(t){return function(e,n,i){for(var s=-1,o=Object(e),r=i(e),a=r.length;a--;){var l=r[++s];if(n(o[l],l,o)===!1)break}return e}}var fO=hO();function pO(t,e){return t&&fO(t,e,vv)}function mO(t,e){return function(n,i){if(n==null)return n;if(!iv(n))return t(n,i);for(var s=n.length,o=-1,r=Object(n);++o<s&&i(r[o],o,r)!==!1;);return n}}var gO=mO(pO),Qp=function(){return r1.Date.now()},vO="Expected a function",xO=Math.max,bO=Math.min;function yO(t,e,n){var i,s,o,r,a,l,c=0,u=!1,d=!1,f=!0;if(typeof t!="function")throw new TypeError(vO);e=na(e)||0,Pc(n)&&(u=!!n.leading,d="maxWait"in n,o=d?xO(na(n.maxWait)||0,e):o,f="trailing"in n?!!n.trailing:f);function h(C){var I=i,$=s;return i=s=void 0,c=C,r=t.apply($,I),r}function p(C){return c=C,a=setTimeout(v,e),u?h(C):r}function m(C){var I=C-l,$=C-c,E=e-I;return d?bO(E,o-$):E}function g(C){var I=C-l,$=C-c;return l===void 0||I>=e||I<0||d&&$>=o}function v(){var C=Qp();if(g(C))return x(C);a=setTimeout(v,m(C))}function x(C){return a=void 0,f&&i?h(C):(i=s=void 0,r)}function b(){a!==void 0&&clearTimeout(a),c=0,i=l=s=a=void 0}function w(){return a===void 0?r:x(Qp())}function y(){var C=Qp(),I=g(C);if(i=arguments,s=this,l=C,I){if(a===void 0)return p(l);if(d)return clearTimeout(a),a=setTimeout(v,e),h(l)}return a===void 0&&(a=setTimeout(v,e)),r}return y.cancel=b,y.flush=w,y}function wO(t,e){var n=-1,i=iv(t)?Array(t.length):[];return gO(t,function(s,o,r){i[++n]=e(s,o,r)}),i}function CO(t,e){return t>e}function SO(t,e){return ih(e,function(n){return t[n]})}function IO(t){return t==null?[]:SO(t,vv(t))}function Km(t){return t===void 0}function $O(t,e,n){for(var i=-1,s=t.length;++i<s;){var o=t[i],r=e(o);if(r!=null&&(a===void 0?r===r&&!uh(r):n(r,a)))var a=r,l=o}return l}function EO(t){return t&&t.length?$O(t,Hl,CO):void 0}function NO(t,e){for(var n,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==void 0&&(n=n===void 0?o:n+o)}return n}function kO(t){return KA(2,t)}function DO(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function TO(t,e){if(t!==e){var n=t!==void 0,i=t===null,s=t===t,o=uh(t),r=e!==void 0,a=e===null,l=e===e,c=uh(e);if(!a&&!c&&!o&&t>e||o&&r&&l&&!a&&!c||i&&r&&l||!n&&l||!s)return 1;if(!i&&!o&&!c&&t<e||c&&n&&s&&!i&&!o||a&&n&&s||!r&&s||!l)return-1}return 0}function RO(t,e,n){for(var i=-1,s=t.criteria,o=e.criteria,r=s.length,a=n.length;++i<r;){var l=TO(s[i],o[i]);if(l){if(i>=a)return l;var c=n[i];return l*(c=="desc"?-1:1)}}return t.index-e.index}function k1(t,e,n){e.length?e=ih(e,function(o){return pl(o)?function(r){return yv(r,o.length===1?o[0]:o)}:o}):e=[Hl];var i=-1;e=ih(e,g_(dO));var s=wO(t,function(o,r,a){var l=ih(e,function(c){return c(o)});return{criteria:l,index:++i,value:o}});return DO(s,function(o,r){return RO(o,r,n)})}function D1(t,e,n,i){return t==null?[]:(pl(e)||(e=e==null?[]:[e]),n=n,pl(n)||(n=n==null?[]:[n]),k1(t,e,n))}var _O=Math.floor,AO=Math.random;function OO(t,e){return t+_O(AO()*(e-t+1))}var PO=YA("round");function T1(t,e){var n=-1,i=t.length,s=i-1;for(e=e===void 0?i:e;++n<e;){var o=OO(n,s),r=t[o];t[o]=t[n],t[n]=r}return t.length=e,t}function MO(t){return T1(iA(t))}function FO(t){return T1(IO(t))}function LO(t){var e=pl(t)?MO:FO;return e(t)}var zO=WA(function(t,e){if(t==null)return[];var n=e.length;return n>1&&Ny(t,e[0],e[1])?e=[]:n>2&&Ny(e[0],e[1],e[2])&&(e=[e[0]]),k1(t,UA(e),[])});function BO(t){return t&&t.length?NO(t,Hl):0}function VO(t,e){const n=S.useMemo(()=>WO(ml(t)?t():t),e);return[S.useSyncExternalStore(n.subscribe,n.getSnapshot),n.setValue]}function WO(t){let e=t,n=fh;return{subscribe(i){return n=i,()=>n=fh},getSnapshot(){return e},setValue(i){e=ml(i)?i(e):i,n()}}}const GO={frameTime:0,deltaTime:0};function HO(t=!1){const[e,n]=S.useState(GO);return S.useEffect(()=>{if(t)return;let i=0,s=requestAnimationFrame(r=>o(r,!0));async function o(r,a=!1){if(!a){const l=r-i;n(c=>({frameTime:c.frameTime+l,deltaTime:l}))}i=r,s=requestAnimationFrame(o)}return()=>cancelAnimationFrame(s)},[t,n]),e}function UO(t,e,n){const i=S.useMemo(()=>new Set,[]),s=ji(r=>{if(i.add(r.code),Et(t))return;(Array.isArray(t)?t:[t]).every(l=>i.has(l))&&(e(),r.preventDefault())}),o=ji(({code:r})=>void i.delete(r));S.useEffect(()=>{if(v_(t))return;const r=(n==null?void 0:n.current)??window;return r.addEventListener("keydown",s),r.addEventListener("keyup",o),()=>{r.removeEventListener("keydown",s),r.removeEventListener("keyup",o)}},[s,o,t,n])}function em(t){throw new Error(`assertNever invocation for "${t}" type of ${typeof t}`)}var Xm=function(t,e){return Xm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},Xm(t,e)};function Rs(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Xm(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function jO(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function a(u){try{c(i.next(u))}catch(d){r(d)}}function l(u){try{c(i.throw(u))}catch(d){r(d)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function R1(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,s,o,r;return r={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(n=0)),n;)try{if(i=1,s&&(o=c[0]&2?s.return:c[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,c[1])).done)return o;switch(s=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,s=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){n.label=c[1];break}if(c[0]===6&&n.label<o[1]){n.label=o[1],o=c;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(c);break}o[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],s=0}finally{i=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Cl(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Go(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),s,o=[],r;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}function yr(t,e,n){if(n||arguments.length===2)for(var i=0,s=e.length,o;i<s;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}function sl(t){return this instanceof sl?(this.v=t,this):new sl(t)}function KO(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),s,o=[];return s={},a("next"),a("throw"),a("return",r),s[Symbol.asyncIterator]=function(){return this},s;function r(h){return function(p){return Promise.resolve(p).then(h,d)}}function a(h,p){i[h]&&(s[h]=function(m){return new Promise(function(g,v){o.push([h,m,g,v])>1||l(h,m)})},p&&(s[h]=p(s[h])))}function l(h,p){try{c(i[h](p))}catch(m){f(o[0][3],m)}}function c(h){h.value instanceof sl?Promise.resolve(h.value.v).then(u,d):f(o[0][2],h)}function u(h){l("next",h)}function d(h){l("throw",h)}function f(h,p){h(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function XO(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Cl=="function"?Cl(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(r){return new Promise(function(a,l){r=t[o](r),s(a,l,r.done,r.value)})}}function s(o,r,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},r)}}function en(t){return typeof t=="function"}function wv(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var tm=wv(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(i,s){return s+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ph(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Ul=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,s,o;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var a=Cl(r),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else r.remove(this);var u=this.initialTeardown;if(en(u))try{u()}catch(m){o=m instanceof tm?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Cl(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{Dy(p)}catch(m){o=o??[],m instanceof tm?o=yr(yr([],Go(o)),Go(m.errors)):o.push(m)}}}catch(m){i={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(i)throw i.error}}}if(o)throw new tm(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Dy(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&ph(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&ph(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),_1=Ul.EMPTY;function A1(t){return t instanceof Ul||t&&"closed"in t&&en(t.remove)&&en(t.add)&&en(t.unsubscribe)}function Dy(t){en(t)?t():t.unsubscribe()}var O1={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},P1={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,yr([t,e],Go(n)))},clearTimeout:function(t){var e=P1.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function M1(t){P1.setTimeout(function(){throw t})}function Ty(){}function sh(t){t()}var Cv=function(t){Rs(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,A1(n)&&n.add(i)):i.destination=ZO,i}return e.create=function(n,i,s){return new Sl(n,i,s)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ul),qO=Function.prototype.bind;function nm(t,e){return qO.call(t,e)}var YO=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){kd(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){kd(i)}else kd(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){kd(n)}},t}(),Sl=function(t){Rs(e,t);function e(n,i,s){var o=t.call(this)||this,r;if(en(n)||!n)r={next:n??void 0,error:i??void 0,complete:s??void 0};else{var a;o&&O1.useDeprecatedNextContext?(a=Object.create(n),a.unsubscribe=function(){return o.unsubscribe()},r={next:n.next&&nm(n.next,a),error:n.error&&nm(n.error,a),complete:n.complete&&nm(n.complete,a)}):r=n}return o.destination=new YO(r),o}return e}(Cv);function kd(t){M1(t)}function JO(t){throw t}var ZO={closed:!0,next:Ty,error:JO,complete:Ty},Sv=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function tu(t){return t}function QO(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return F1(t)}function F1(t){return t.length===0?tu:t.length===1?t[0]:function(n){return t.reduce(function(i,s){return s(i)},n)}}var ui=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var s=this,o=tP(e)?e:new Sl(e,n,i);return sh(function(){var r=s,a=r.operator,l=r.source;o.add(a?a.call(o,l):l?s._subscribe(o):s._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=Ry(n),new n(function(s,o){var r=new Sl({next:function(a){try{e(a)}catch(l){o(l),r.unsubscribe()}},error:o,complete:s});i.subscribe(r)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Sv]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return F1(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Ry(e),new e(function(i,s){var o;n.subscribe(function(r){return o=r},function(r){return s(r)},function(){return i(o)})})},t.create=function(e){return new t(e)},t}();function Ry(t){var e;return(e=t??O1.Promise)!==null&&e!==void 0?e:Promise}function eP(t){return t&&en(t.next)&&en(t.error)&&en(t.complete)}function tP(t){return t&&t instanceof Cv||eP(t)&&A1(t)}function nP(t){return en(t==null?void 0:t.lift)}function Ei(t){return function(e){if(nP(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function as(t,e,n,i,s){return new L1(t,e,n,i,s)}var L1=function(t){Rs(e,t);function e(n,i,s,o,r,a){var l=t.call(this,n)||this;return l.onFinalize=r,l.shouldUnsubscribe=a,l._next=i?function(c){try{i(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=o?function(c){try{o(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=s?function(){try{s()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Cv),mh={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,i=mh.delegate;i&&(e=i.requestAnimationFrame,n=i.cancelAnimationFrame);var s=e(function(o){n=void 0,t(o)});return new Ul(function(){return n==null?void 0:n(s)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return requestAnimationFrame.apply(void 0,yr([],Go(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=mh.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,yr([],Go(t)))},delegate:void 0},iP=wv(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),nu=function(t){Rs(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new _y(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new iP},e.prototype.next=function(n){var i=this;sh(function(){var s,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var r=Cl(i.currentObservers),a=r.next();!a.done;a=r.next()){var l=a.value;l.next(n)}}catch(c){s={error:c}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(s)throw s.error}}}})},e.prototype.error=function(n){var i=this;sh(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var s=i.observers;s.length;)s.shift().error(n)}})},e.prototype.complete=function(){var n=this;sh(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,s=this,o=s.hasError,r=s.isStopped,a=s.observers;return o||r?_1:(this.currentObservers=null,a.push(n),new Ul(function(){i.currentObservers=null,ph(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,s=i.hasError,o=i.thrownError,r=i.isStopped;s?n.error(o):r&&n.complete()},e.prototype.asObservable=function(){var n=new ui;return n.source=this,n},e.create=function(n,i){return new _y(n,i)},e}(ui),_y=function(t){Rs(e,t);function e(n,i){var s=t.call(this)||this;return s.destination=n,s.source=i,s}return e.prototype.next=function(n){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.next)===null||s===void 0||s.call(i,n)},e.prototype.error=function(n){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.error)===null||s===void 0||s.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,s;return(s=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&s!==void 0?s:_1},e}(nu),sP=function(t){Rs(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,s=n.thrownError,o=n._value;if(i)throw s;return this._throwIfClosed(),o},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(nu),Iv={now:function(){return(Iv.delegate||Date).now()},delegate:void 0},z1=function(t){Rs(e,t);function e(n,i,s){n===void 0&&(n=1/0),i===void 0&&(i=1/0),s===void 0&&(s=Iv);var o=t.call(this)||this;return o._bufferSize=n,o._windowTime=i,o._timestampProvider=s,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=i===1/0,o._bufferSize=Math.max(1,n),o._windowTime=Math.max(1,i),o}return e.prototype.next=function(n){var i=this,s=i.isStopped,o=i._buffer,r=i._infiniteTimeWindow,a=i._timestampProvider,l=i._windowTime;s||(o.push(n),!r&&o.push(a.now()+l)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var i=this._innerSubscribe(n),s=this,o=s._infiniteTimeWindow,r=s._buffer,a=r.slice(),l=0;l<a.length&&!n.closed;l+=o?1:2)n.next(a[l]);return this._checkFinalizedStatuses(n),i},e.prototype._trimBuffer=function(){var n=this,i=n._bufferSize,s=n._timestampProvider,o=n._buffer,r=n._infiniteTimeWindow,a=(r?1:2)*i;if(i<1/0&&a<o.length&&o.splice(0,o.length-a),!r){for(var l=s.now(),c=0,u=1;u<o.length&&o[u]<=l;u+=2)c=u;c&&o.splice(0,c+1)}},e}(nu),oP=function(t){Rs(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Ul),qm={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,yr([t,e],Go(n)))},clearInterval:function(t){var e=qm.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},B1=function(t){Rs(e,t);function e(n,i){var s=t.call(this,n,i)||this;return s.scheduler=n,s.work=i,s.pending=!1,s}return e.prototype.schedule=function(n,i){var s;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var o=this.id,r=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(r,o,i)),this.pending=!0,this.delay=i,this.id=(s=this.id)!==null&&s!==void 0?s:this.requestAsyncId(r,this.id,i),this},e.prototype.requestAsyncId=function(n,i,s){return s===void 0&&(s=0),qm.setInterval(n.flush.bind(n,this),s)},e.prototype.recycleAsyncId=function(n,i,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return i;i!=null&&qm.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(n,i);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var s=!1,o;try{this.work(n)}catch(r){s=!0,o=r||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,s=n.scheduler,o=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ph(o,this),i!=null&&(this.id=this.recycleAsyncId(s,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(oP),Ay=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=Iv.now,t}(),V1=function(t){Rs(e,t);function e(n,i){i===void 0&&(i=Ay.now);var s=t.call(this,n,i)||this;return s.actions=[],s._active=!1,s}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var s;this._active=!0;do if(s=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,s){for(;n=i.shift();)n.unsubscribe();throw s}},e}(Ay),W1=new V1(B1),rP=W1,aP=function(t){Rs(e,t);function e(n,i){var s=t.call(this,n,i)||this;return s.scheduler=n,s.work=i,s}return e.prototype.requestAsyncId=function(n,i,s){return s===void 0&&(s=0),s!==null&&s>0?t.prototype.requestAsyncId.call(this,n,i,s):(n.actions.push(this),n._scheduled||(n._scheduled=mh.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,i,s){var o;if(s===void 0&&(s=0),s!=null?s>0:this.delay>0)return t.prototype.recycleAsyncId.call(this,n,i,s);var r=n.actions;i!=null&&((o=r[r.length-1])===null||o===void 0?void 0:o.id)!==i&&(mh.cancelAnimationFrame(i),n._scheduled=void 0)},e}(B1),lP=function(t){Rs(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var s=this.actions,o;n=n||s.shift();do if(o=n.execute(n.state,n.delay))break;while((n=s[0])&&n.id===i&&s.shift());if(this._active=!1,o){for(;(n=s[0])&&n.id===i&&s.shift();)n.unsubscribe();throw o}},e}(V1),cP=new lP(aP),$v=new ui(function(t){return t.complete()});function uP(t){return t&&en(t.schedule)}function G1(t){return t[t.length-1]}function af(t){return uP(G1(t))?t.pop():void 0}function dP(t,e){return typeof G1(t)=="number"?t.pop():e}var Ev=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function H1(t){return en(t==null?void 0:t.then)}function U1(t){return en(t[Sv])}function j1(t){return Symbol.asyncIterator&&en(t==null?void 0:t[Symbol.asyncIterator])}function K1(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function hP(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var X1=hP();function q1(t){return en(t==null?void 0:t[X1])}function Y1(t){return KO(this,arguments,function(){var n,i,s,o;return R1(this,function(r){switch(r.label){case 0:n=t.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,sl(n.read())];case 3:return i=r.sent(),s=i.value,o=i.done,o?[4,sl(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,sl(s)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function J1(t){return en(t==null?void 0:t.getReader)}function _s(t){if(t instanceof ui)return t;if(t!=null){if(U1(t))return fP(t);if(Ev(t))return pP(t);if(H1(t))return mP(t);if(j1(t))return Z1(t);if(q1(t))return gP(t);if(J1(t))return vP(t)}throw K1(t)}function fP(t){return new ui(function(e){var n=t[Sv]();if(en(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function pP(t){return new ui(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function mP(t){return new ui(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,M1)})}function gP(t){return new ui(function(e){var n,i;try{for(var s=Cl(t),o=s.next();!o.done;o=s.next()){var r=o.value;if(e.next(r),e.closed)return}}catch(a){n={error:a}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}e.complete()})}function Z1(t){return new ui(function(e){xP(t,e).catch(function(n){return e.error(n)})})}function vP(t){return Z1(Y1(t))}function xP(t,e){var n,i,s,o;return jO(this,void 0,void 0,function(){var r,a;return R1(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=XO(t),l.label=1;case 1:return[4,n.next()];case 2:if(i=l.sent(),!!i.done)return[3,4];if(r=i.value,e.next(r),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),s={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ia(t,e,n,i,s){i===void 0&&(i=0),s===void 0&&(s=!1);var o=e.schedule(function(){n(),s?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(o),!s)return o}function Q1(t,e){return e===void 0&&(e=0),Ei(function(n,i){n.subscribe(as(i,function(s){return ia(i,t,function(){return i.next(s)},e)},function(){return ia(i,t,function(){return i.complete()},e)},function(s){return ia(i,t,function(){return i.error(s)},e)}))})}function eI(t,e){return e===void 0&&(e=0),Ei(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function bP(t,e){return _s(t).pipe(eI(e),Q1(e))}function yP(t,e){return _s(t).pipe(eI(e),Q1(e))}function wP(t,e){return new ui(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function CP(t,e){return new ui(function(n){var i;return ia(n,e,function(){i=t[X1](),ia(n,e,function(){var s,o,r;try{s=i.next(),o=s.value,r=s.done}catch(a){n.error(a);return}r?n.complete():n.next(o)},0,!0)}),function(){return en(i==null?void 0:i.return)&&i.return()}})}function tI(t,e){if(!t)throw new Error("Iterable cannot be null");return new ui(function(n){ia(n,e,function(){var i=t[Symbol.asyncIterator]();ia(n,e,function(){i.next().then(function(s){s.done?n.complete():n.next(s.value)})},0,!0)})})}function SP(t,e){return tI(Y1(t),e)}function IP(t,e){if(t!=null){if(U1(t))return bP(t,e);if(Ev(t))return wP(t,e);if(H1(t))return yP(t,e);if(j1(t))return tI(t,e);if(q1(t))return CP(t,e);if(J1(t))return SP(t,e)}throw K1(t)}function sa(t,e){return e?IP(t,e):_s(t)}function lf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=af(t);return sa(t,n)}var Nv=wv(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function nI(t,e){return new Promise(function(n,i){var s=new Sl({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){i(new Nv)}});t.subscribe(s)})}function $P(t){return t instanceof Date&&!isNaN(t)}function Il(t,e){return Ei(function(n,i){var s=0;n.subscribe(as(i,function(o){i.next(t.call(e,o,s++))}))})}var EP=Array.isArray;function NP(t,e){return EP(e)?t.apply(void 0,yr([],Go(e))):t(e)}function kP(t){return Il(function(e){return NP(t,e)})}function DP(t,e,n,i,s,o,r,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(m){return c<i?p(m):l.push(m)},p=function(m){c++;var g=!1;_s(n(m,u++)).subscribe(as(e,function(v){e.next(v)},function(){g=!0},void 0,function(){if(g)try{c--;for(var v=function(){var x=l.shift();r||p(x)};l.length&&c<i;)v();f()}catch(x){e.error(x)}}))};return t.subscribe(as(e,h,function(){d=!0,f()})),function(){}}function kv(t,e,n){return n===void 0&&(n=1/0),en(e)?kv(function(i,s){return Il(function(o,r){return e(i,o,s,r)})(_s(t(i,s)))},n):(typeof e=="number"&&(n=e),Ei(function(i,s){return DP(i,s,t,n)}))}function iI(t){return t===void 0&&(t=1/0),kv(tu,t)}function TP(){return iI(1)}function Ym(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return TP()(sa(t,af(t)))}function RP(t){return new ui(function(e){_s(t()).subscribe(e)})}var _P=["addListener","removeListener"],AP=["addEventListener","removeEventListener"],OP=["on","off"];function Jm(t,e,n,i){if(en(n)&&(i=n,n=void 0),i)return Jm(t,e,n).pipe(kP(i));var s=Go(FP(t)?AP.map(function(a){return function(l){return t[a](e,l,n)}}):PP(t)?_P.map(Oy(t,e)):MP(t)?OP.map(Oy(t,e)):[],2),o=s[0],r=s[1];if(!o&&Ev(t))return kv(function(a){return Jm(a,e,n)})(_s(t));if(!o)throw new TypeError("Invalid event target");return new ui(function(a){var l=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return a.next(1<c.length?c:c[0])};return o(l),function(){return r(l)}})}function Oy(t,e){return function(n){return function(i){return t[n](e,i)}}}function PP(t){return en(t.addListener)&&en(t.removeListener)}function MP(t){return en(t.on)&&en(t.off)}function FP(t){return en(t.addEventListener)&&en(t.removeEventListener)}function sI(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=rP),new ui(function(i){var s=$P(t)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),i.complete())},s)})}function LP(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=af(t),i=dP(t,1/0),s=t;return s.length?s.length===1?_s(s[0]):iI(i)(sa(s,n)):$v}function zP(t,e){return Ei(function(n,i){var s=0;n.subscribe(as(i,function(o){return t.call(e,o,s++)&&i.next(o)}))})}function Dv(t){return Ei(function(e,n){var i=null,s=!1,o;i=e.subscribe(as(n,void 0,void 0,function(r){o=_s(t(r,Dv(t)(e))),i?(i.unsubscribe(),i=null,o.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,o.subscribe(n))})}function BP(t,e){return e===void 0&&(e=W1),Ei(function(n,i){var s=null,o=null,r=null,a=function(){if(s){s.unsubscribe(),s=null;var c=o;o=null,i.next(c)}};function l(){var c=r+t,u=e.now();if(u<c){s=this.schedule(void 0,c-u),i.add(s);return}a()}n.subscribe(as(i,function(c){o=c,r=e.now(),s||(s=e.schedule(l,t),i.add(s))},function(){a(),i.complete()},void 0,function(){o=s=null}))})}function VP(t){return Ei(function(e,n){var i=!1;e.subscribe(as(n,function(s){i=!0,n.next(s)},function(){i||n.next(t),n.complete()}))})}function oI(t){return t<=0?function(){return $v}:Ei(function(e,n){var i=0;e.subscribe(as(n,function(s){++i<=t&&(n.next(s),t<=i&&n.complete())}))})}function WP(t){return t===void 0&&(t=GP),Ei(function(e,n){var i=!1;e.subscribe(as(n,function(s){i=!0,n.next(s)},function(){return i?n.complete():n.error(t())}))})}function GP(){return new Nv}function HP(t){return Ei(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function UP(t,e){var n=arguments.length>=2;return function(i){return i.pipe(t?zP(function(s,o){return t(s,o,i)}):tu,oI(1),n?VP(e):WP(function(){return new Nv}))}}function rI(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new nu}:e,i=t.resetOnError,s=i===void 0?!0:i,o=t.resetOnComplete,r=o===void 0?!0:o,a=t.resetOnRefCountZero,l=a===void 0?!0:a;return function(c){var u,d,f,h=0,p=!1,m=!1,g=function(){d==null||d.unsubscribe(),d=void 0},v=function(){g(),u=f=void 0,p=m=!1},x=function(){var b=u;v(),b==null||b.unsubscribe()};return Ei(function(b,w){h++,!m&&!p&&g();var y=f=f??n();w.add(function(){h--,h===0&&!m&&!p&&(d=im(x,l))}),y.subscribe(w),!u&&h>0&&(u=new Sl({next:function(C){return y.next(C)},error:function(C){m=!0,g(),d=im(v,s,C),y.error(C)},complete:function(){p=!0,g(),d=im(v,r),y.complete()}}),_s(b).subscribe(u))})(c)}}function im(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(e===!0){t();return}if(e!==!1){var s=new Sl({next:function(){s.unsubscribe(),t()}});return _s(e.apply(void 0,yr([],Go(n)))).subscribe(s)}}function jP(t,e,n){var i,s,o,r,a=!1;return t&&typeof t=="object"?(i=t.bufferSize,r=i===void 0?1/0:i,s=t.windowTime,e=s===void 0?1/0:s,o=t.refCount,a=o===void 0?!1:o,n=t.scheduler):r=t??1/0,rI({connector:function(){return new z1(r,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function KP(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=af(t);return Ei(function(i,s){(n?Ym(t,i,n):Ym(t,i)).subscribe(s)})}function Xr(t,e){return Ei(function(n,i){var s=null,o=0,r=!1,a=function(){return r&&!s&&i.complete()};n.subscribe(as(i,function(l){s==null||s.unsubscribe();var c=0,u=o++;_s(t(l,u)).subscribe(s=as(i,function(d){return i.next(e?e(l,d,u,c++):d)},function(){s=null,a()}))},function(){r=!0,a()}))})}function iu(t,e,n){var i=en(t)||e||n?{next:t,error:e,complete:n}:t;return i?Ei(function(s,o){var r;(r=i.subscribe)===null||r===void 0||r.call(i);var a=!0;s.subscribe(as(o,function(l){var c;(c=i.next)===null||c===void 0||c.call(i,l),o.next(l)},function(){var l;a=!1,(l=i.complete)===null||l===void 0||l.call(i),o.complete()},function(l){var c;a=!1,(c=i.error)===null||c===void 0||c.call(i,l),o.error(l)},function(){var l,c;a&&((l=i.unsubscribe)===null||l===void 0||l.call(i)),(c=i.finalize)===null||c===void 0||c.call(i)}))}):tu}function XP(t){const e=ml(t)?t:t.synced,n=ml(t)?i=>lf(i):t.unsynced;return{synced:e,unsynced:n}}function qP(t){const{synced:e,unsynced:n}=XP(t);return Xr(i=>gl(i,{synced:e,unsynced:n}))}function YP(t=x_){return Dv(e=>lf(l1(t(e))))}const aI={EXPONENTIAL:(t,e)=>Math.pow(2,t)*e+Math.random()*e/2,LINEAR:(t,e)=>t*e+Math.random()*e/2,STATIC:(t,e)=>e+Math.random()*e/2},JP={initialInterval:3e3,backoffDelay:aI.LINEAR,maxInterval:6e4,jitter:500};function ZP(t){const{maxRetries:e,maxInterval:n,initialInterval:i,backoffDelay:s,needRetry:o,beforeRetry:r,jitter:a}={...JP,...t};let l=0;return QO(iu(c=>{(!b_(c)||vl(c))&&(l=0)}),Dv((c,u)=>{if(l++,ml(o)&&!o(c,l)||!Km(e)&&l>e)throw c;const f=(s??aI.LINEAR)(l,i),h=(Km(n)?f:Math.min(f,n))+Math.random()*a;return Ym(ml(r)?r(c,l):$v,sI(h).pipe(Xr(()=>u)))}))}var oh=(t=>(t.Blocked="Blocked",t.Blocking="Blocking",t.Terminated="Terminated",t))(oh||{});function QP(t){return new ui(e=>{t(n=>e.error(new Error(`Database is in '${n}' state, reconnecting`))).then(n=>e.next(n),n=>e.error(n))})}function eM(){return ZP({initialInterval:5e3,jitter:1e3})}function tM(t,e){for(;t.length<e;)t="0"+t;return t}function Ro(t,e){var n,i,s;if(e.length===0)return t;for(n=0,s=e.length;n<s;n++)i=e.charCodeAt(n),t=(t<<5)-t+i,t|=0;return t<0?t*-2:t}function nM(t,e,n){return Object.keys(e).sort().reduce(i,t);function i(s,o){return lI(s,e[o],o,n)}}function lI(t,e,n,i){var s=Ro(Ro(Ro(t,n),iM(e)),typeof e);if(e===null)return Ro(s,"null");if(e===void 0)return Ro(s,"undefined");if(typeof e=="object"||typeof e=="function"){if(i.indexOf(e)!==-1)return Ro(s,"[Circular]"+n);i.push(e);var o=nM(s,e,i);if(!("valueOf"in e)||typeof e.valueOf!="function")return o;try{return Ro(o,String(e.valueOf()))}catch(r){return Ro(o,"[valueOf exception]"+(r.stack||r.message))}}return Ro(s,e.toString())}function iM(t){return Object.prototype.toString.call(t)}function sM(t){return tM(lI(0,t,"",[]).toString(16),8)}var oM=sM;const rM=c1(oM);function aM(t,e){const n=new Map;return function(...s){const{group:o,delay:r}=e(s);n.has(o)||n.set(o,yO((...l)=>{t(...l),n.delete(o)},r)),n.get(o)(...s)}}function lM(t,e=1){return rI({connector:()=>new z1(e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:()=>sI(t)})}function cM(t=1){return jP({bufferSize:t,refCount:!0})}const uM=(...t)=>rM(t),dM=5e3;function Dd(t,e={}){const n=e.normalize??uM,i=hM(e.replayCount??1,e.resetDelay,e.removeDelay,e.removeUnsubscribedDelay??dM);return(...s)=>i(n(s),()=>t(...s))}function hM(t,e,n,i){const s=new Map,o=u=>{const d=s.get(u);d!==void 0&&d.refCount===0&&s.delete(u)},r=n===void 0||n===0||!isFinite(n)?o:aM(o,([u])=>({group:u,delay:n})),a=(u,d)=>{const f=s.get(u);f!==void 0&&(f.refCount++,d())},l=u=>{const d=s.get(u);d!==void 0&&(d.refCount--,d.refCount===0&&r(u))},c=(u,d)=>{const f=setTimeout(()=>o(u),i);return{refCount:0,obs:d.pipe(e===void 0?tu:e===0?cM(t):lM(e,t),iu({subscribe:a.bind(null,u,()=>clearTimeout(f)),finalize:l.bind(null,u)}))}};return(u,d)=>(s.has(u)||s.set(u,c(u,d())),s.get(u).obs)}function fM(t){return t&&typeof t.then=="function"}Promise.resolve(!1);Promise.resolve(!0);var oa=Promise.resolve();function cI(t,e){return t||(t=0),new Promise(function(n){return setTimeout(function(){return n(e)},t)})}function pM(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function Tv(){return Math.random().toString(36).substring(2)}var sm=0;function su(){var t=Date.now()*1e3;return t<=sm&&(t=sm+1),sm=t,t}var mM=su,gM="native";function vM(t){var e={time:su(),messagesCallback:null,bc:new BroadcastChannel(t),subFns:[]};return e.bc.onmessage=function(n){e.messagesCallback&&e.messagesCallback(n.data)},e}function xM(t){t.bc.close(),t.subFns=[]}function bM(t,e){try{return t.bc.postMessage(e,!1),oa}catch(n){return Promise.reject(n)}}function yM(t,e){t.messagesCallback=e}function wM(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function CM(){return 150}var SM={create:vM,close:xM,onMessage:yM,postMessage:bM,canBeUsed:wM,type:gM,averageResponseTime:CM,microSeconds:mM};class uI{constructor(e){Nd(this,"ttl");Nd(this,"map",new Map);Nd(this,"_to",!1);this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,dI()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,IM(this)},0))}clear(){this.map.clear()}}function IM(t){const e=dI()-t.ttl,n=t.map[Symbol.iterator]();for(;;){const i=n.next().value;if(!i)return;const s=i[0];if(i[1]<e)t.map.delete(s);else return}}function dI(){return Date.now()}function Rv(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=JSON.parse(JSON.stringify(t));return typeof e.webWorkerSupport>"u"&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=1e3*45),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),t.idb&&typeof t.idb.onclose=="function"&&(e.idb.onclose=t.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=1e3*60),t.methods&&(e.methods=t.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=1e3*60*2),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),typeof e.node.useFastPath>"u"&&(e.node.useFastPath=!0),e}var $M=su,EM="pubkey.broadcast-channel-0-",Ho="messages",cf={durability:"relaxed"},NM="idb";function hI(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function _v(t){t.commit&&t.commit()}function kM(t){var e=hI(),n=EM+t,i=e.open(n);return i.onupgradeneeded=function(s){var o=s.target.result;o.createObjectStore(Ho,{keyPath:"id",autoIncrement:!0})},new Promise(function(s,o){i.onerror=function(r){return o(r)},i.onsuccess=function(){s(i.result)}})}function DM(t,e,n){var i=Date.now(),s={uuid:e,time:i,data:n},o=t.transaction([Ho],"readwrite",cf);return new Promise(function(r,a){o.oncomplete=function(){return r()},o.onerror=function(c){return a(c)};var l=o.objectStore(Ho);l.add(s),_v(o)})}function TM(t,e){var n=t.transaction(Ho,"readonly",cf),i=n.objectStore(Ho),s=[],o=IDBKeyRange.bound(e+1,1/0);if(i.getAll){var r=i.getAll(o);return new Promise(function(l,c){r.onerror=function(u){return c(u)},r.onsuccess=function(u){l(u.target.result)}})}function a(){try{return o=IDBKeyRange.bound(e+1,1/0),i.openCursor(o)}catch{return i.openCursor()}}return new Promise(function(l,c){var u=a();u.onerror=function(d){return c(d)},u.onsuccess=function(d){var f=d.target.result;f?f.value.id<e+1?f.continue(e+1):(s.push(f.value),f.continue()):(_v(n),l(s))}})}function RM(t,e){if(t.closed)return Promise.resolve([]);var n=t.db.transaction(Ho,"readwrite",cf),i=n.objectStore(Ho);return Promise.all(e.map(function(s){var o=i.delete(s);return new Promise(function(r){o.onsuccess=function(){return r()}})}))}function _M(t,e){var n=Date.now()-e,i=t.transaction(Ho,"readonly",cf),s=i.objectStore(Ho),o=[];return new Promise(function(r){s.openCursor().onsuccess=function(a){var l=a.target.result;if(l){var c=l.value;c.time<n?(o.push(c),l.continue()):(_v(i),r(o))}else r(o)}})}function AM(t){return _M(t.db,t.options.idb.ttl).then(function(e){return RM(t,e.map(function(n){return n.id}))})}function OM(t,e){return e=Rv(e),kM(t).then(function(n){var i={closed:!1,lastCursorId:0,channelName:t,options:e,uuid:Tv(),eMIs:new uI(e.idb.ttl*2),writeBlockPromise:oa,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){i.closed=!0,e.idb.onclose&&e.idb.onclose()},fI(i),i})}function fI(t){t.closed||pI(t).then(function(){return cI(t.options.idb.fallbackInterval)}).then(function(){return fI(t)})}function PM(t,e){return!(t.uuid===e.uuid||e.eMIs.has(t.id)||t.data.time<e.messagesCallbackTime)}function pI(t){return t.closed||!t.messagesCallback?oa:TM(t.db,t.lastCursorId).then(function(e){var n=e.filter(function(i){return!!i}).map(function(i){return i.id>t.lastCursorId&&(t.lastCursorId=i.id),i}).filter(function(i){return PM(i,t)}).sort(function(i,s){return i.time-s.time});return n.forEach(function(i){t.messagesCallback&&(t.eMIs.add(i.id),t.messagesCallback(i.data))}),oa})}function MM(t){t.closed=!0,t.db.close()}function FM(t,e){return t.writeBlockPromise=t.writeBlockPromise.then(function(){return DM(t.db,t.uuid,e)}).then(function(){pM(0,10)===0&&AM(t)}),t.writeBlockPromise}function LM(t,e,n){t.messagesCallbackTime=n,t.messagesCallback=e,pI(t)}function zM(){return!!hI()}function BM(t){return t.idb.fallbackInterval*2}var VM={create:OM,close:MM,onMessage:LM,postMessage:FM,canBeUsed:zM,type:NM,averageResponseTime:BM,microSeconds:$M},WM=su,GM="pubkey.broadcastChannel-",HM="localstorage";function mI(){var t;if(typeof window>"u")return null;try{t=window.localStorage,t=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return t}function gI(t){return GM+t}function UM(t,e){return new Promise(function(n){cI().then(function(){var i=gI(t.channelName),s={token:Tv(),time:Date.now(),data:e,uuid:t.uuid},o=JSON.stringify(s);mI().setItem(i,o);var r=document.createEvent("Event");r.initEvent("storage",!0,!0),r.key=i,r.newValue=o,window.dispatchEvent(r),n()})})}function jM(t,e){var n=gI(t),i=function(o){o.key===n&&e(JSON.parse(o.newValue))};return window.addEventListener("storage",i),i}function KM(t){window.removeEventListener("storage",t)}function XM(t,e){if(e=Rv(e),!vI())throw new Error("BroadcastChannel: localstorage cannot be used");var n=Tv(),i=new uI(e.localstorage.removeTimeout),s={channelName:t,uuid:n,eMIs:i};return s.listener=jM(t,function(o){s.messagesCallback&&o.uuid!==n&&(!o.token||i.has(o.token)||o.data.time&&o.data.time<s.messagesCallbackTime||(i.add(o.token),s.messagesCallback(o.data)))}),s}function qM(t){KM(t.listener)}function YM(t,e,n){t.messagesCallbackTime=n,t.messagesCallback=e}function vI(){var t=mI();if(!t)return!1;try{var e="__broadcastchannel_check";t.setItem(e,"works"),t.removeItem(e)}catch{return!1}return!0}function JM(){var t=120,e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?t*2:t}var ZM={create:XM,close:qM,onMessage:YM,postMessage:UM,canBeUsed:vI,type:HM,averageResponseTime:JM,microSeconds:WM},xI=su,QM="simulate",Av=new Set;function eF(t){var e={time:xI(),name:t,messagesCallback:null};return Av.add(e),e}function tF(t){Av.delete(t)}var bI=5;function nF(t,e){return new Promise(function(n){return setTimeout(function(){var i=Array.from(Av);i.forEach(function(s){s.name===t.name&&s!==t&&s.messagesCallback&&s.time<e.time&&s.messagesCallback(e)}),n()},bI)})}function iF(t,e){t.messagesCallback=e}function sF(){return!0}function oF(){return bI}var rF={create:eF,close:tF,onMessage:iF,postMessage:nF,canBeUsed:sF,type:QM,averageResponseTime:oF,microSeconds:xI},Py=[SM,VM,ZM];function aF(t){var e=[].concat(t.methods,Py).filter(Boolean);if(t.type){if(t.type==="simulate")return rF;var n=e.find(function(s){return s.type===t.type});if(n)return n;throw new Error("method-type "+t.type+" not found")}t.webWorkerSupport||(e=e.filter(function(s){return s.type!=="idb"}));var i=e.find(function(s){return s.canBeUsed()});if(i)return i;throw new Error("No usable method found in "+JSON.stringify(Py.map(function(s){return s.type})))}var yI=new Set,lF=0,Ov=function(e,n){this.id=lF++,yI.add(this),this.name=e,My&&(n=My),this.options=Rv(n),this.method=aF(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,cF(this)};Ov._pubkey=!0;var My;Ov.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return Fy(this,"message",e)},postInternal:function(e){return Fy(this,"internal",e)},set onmessage(t){var e=this.method.microSeconds(),n={time:e,fn:t};zy(this,"message",this._onML),t&&typeof t=="function"?(this._onML=n,Ly(this,"message",n)):this._onML=null},addEventListener:function(e,n){var i=this.method.microSeconds(),s={time:i,fn:n};Ly(this,e,s)},removeEventListener:function(e,n){var i=this._addEL[e].find(function(s){return s.fn===n});zy(this,e,i)},close:function(){var e=this;if(!this.closed){yI.delete(this),this.closed=!0;var n=this._prepP?this._prepP:oa;return this._onML=null,this._addEL.message=[],n.then(function(){return Promise.all(Array.from(e._uMP))}).then(function(){return Promise.all(e._befC.map(function(i){return i()}))}).then(function(){return e.method.close(e._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function Fy(t,e,n){var i=t.method.microSeconds(),s={time:i,type:e,data:n},o=t._prepP?t._prepP:oa;return o.then(function(){var r=t.method.postMessage(t._state,s);return t._uMP.add(r),r.catch().then(function(){return t._uMP.delete(r)}),r})}function cF(t){var e=t.method.create(t.name,t.options);fM(e)?(t._prepP=e,e.then(function(n){t._state=n})):t._state=e}function wI(t){return t._addEL.message.length>0||t._addEL.internal.length>0}function Ly(t,e,n){t._addEL[e].push(n),uF(t)}function zy(t,e,n){t._addEL[e]=t._addEL[e].filter(function(i){return i!==n}),dF(t)}function uF(t){if(!t._iL&&wI(t)){var e=function(s){t._addEL[s.type].forEach(function(o){s.time>=o.time&&o.fn(s.data)})},n=t.method.microSeconds();t._prepP?t._prepP.then(function(){t._iL=!0,t.method.onMessage(t._state,e,n)}):(t._iL=!0,t.method.onMessage(t._state,e,n))}}function dF(t){if(t._iL&&!wI(t)){t._iL=!1;var e=t.method.microSeconds();t.method.onMessage(t._state,null,e)}}const kc=new Map,ol=new Map;function CI(t){return kc.has(t)||(kc.set(t,new Ov(t)),ol.set(t,0)),ol.set(t,ol.get(t)+1),kc.get(t)}function SI(t){const e=kc.get(t),n=ol.get(t);n===1&&(e.close(),kc.delete(t),ol.delete(t)),ol.set(t,n-1)}function hF(t){return Ei((e,n)=>{const i=CI(t);e.pipe(HP(()=>SI(t))).subscribe(new L1(n,s=>{n.next(s),i.postMessage(s)}))})}function fF(t){return new ui(e=>{const n=CI(t),i=Jm(n,"message").subscribe(e);return()=>{SI(t),i.unsubscribe()}})}function pF(t){return e=>RP(()=>{const n=kO(i=>t(i));return e.pipe(iu(n))})}function mF(t,e,{upgrade:n,blocked:i,blocking:s,terminated:o}={}){return y_(t,e,{upgrade:n,blocking(r,a,l){s==null||s(r,a,l),console.error(new Error(`IndexedDB ${t}: blocking`))},blocked(r,a,l){i==null||i(r,a,l),console.error(new Error(`IndexedDB ${t}: blocked`))},terminated(){o==null||o(),console.error(new Error(`IndexedDB ${t}: abnormally terminated the connection`))}}).then(r=>(r.onversionchange=a=>{a.target.close()},r))}async function gF(t){try{const n=(await self.indexedDB.databases()).find(({name:i})=>i===t);return n==null?void 0:n.version}catch{return}}function vF(){const{contextId:t}=S.useContext(w_);return ov(!Et(t),"ContextRef is not defined"),t}function II(t,e){const n=ji(i=>{t(xF(i))&&i.preventDefault()});S.useEffect(()=>{const i=e==null?void 0:e.current;if(!Et(i))return i.addEventListener("mousemove",n),i.addEventListener("mousedown",n),i.addEventListener("mouseup",n),()=>{i.removeEventListener("mousemove",n),i.removeEventListener("mousedown",n),i.removeEventListener("mouseup",n)}},[n,t,e])}function xF(t){const{target:e,button:n,buttons:i,clientX:s,clientY:o}=t,{left:r,top:a}=e.getBoundingClientRect(),l=s-r,c=o-a;return{x:l,y:c,button:n,buttons:i}}function bF(t){const e=vF(),n=S.useMemo(()=>t(e),[t,e]),[i,s]=VO(void 0,[n]);return S.useEffect(()=>void n.then(s),[n,s]),i}function yF(t,e){const n=S.useMemo(()=>wF(t,e),[t]);return J_(n.unsubscribe),S.useSyncExternalStore(n.subscribe,n.getSnapshot)}function wF(t,e){let n=e,i=fh;const s=c=>{n=c,i()},o=()=>t.pipe(pF(s),BP(0,cP)).subscribe({next:s,error:c=>{throw c}}),r=()=>{l==null||l.unsubscribe(),i=fh,n=e},a=()=>n;let l;return{subscribe(c){return i=c,l=Km(l)||l.closed?o():l,n!==e&&i(),r},unsubscribe:r,getSnapshot:a}}const CF=t=>({color:t.colorLink,textDecoration:"none",outline:"none",cursor:"pointer",transition:`color ${t.motionDurationSlow}`,"&:focus, &:hover":{color:t.colorLinkHover},"&:active":{color:t.colorLinkActive}});var $I=function(e){if(rv()&&window.document.documentElement){var n=Array.isArray(e)?e:[e],i=window.document.documentElement;return n.some(function(s){return s in i.style})}return!1},SF=function(e,n){if(!$I(e))return!1;var i=document.createElement("div"),s=i.style[e];return i.style[e]=n,i.style[e]!==s};function IF(t,e){return!Array.isArray(t)&&e!==void 0?SF(t,e):$I(t)}var uf=function(e){var n=e.className,i=e.customizeIcon,s=e.customizeIconProps,o=e.children,r=e.onMouseDown,a=e.onClick,l=typeof i=="function"?i(s):i;return S.createElement("span",{className:n,onMouseDown:function(u){u.preventDefault(),r==null||r(u)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:a,"aria-hidden":!0},l!==void 0?l:S.createElement("span",{className:ye(n.split(/\s+/).map(function(c){return"".concat(c,"-icon")}))},o))},$F=function(e,n,i,s,o){var r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,a=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,c=ce.useMemo(function(){if(_n(s)==="object")return s.clearIcon;if(o)return o},[s,o]),u=ce.useMemo(function(){return!!(!r&&s&&(i.length||a)&&!(l==="combobox"&&a===""))},[s,r,i.length,a,l]);return{allowClear:u,clearIcon:ce.createElement(uf,{className:"".concat(e,"-clear"),onMouseDown:n,customizeIcon:c},"×")}},EI=S.createContext(null);function EF(){return S.useContext(EI)}function NF(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=S.useState(!1),n=ke(e,2),i=n[0],s=n[1],o=S.useRef(null),r=function(){window.clearTimeout(o.current)};S.useEffect(function(){return r},[]);var a=function(c,u){r(),o.current=window.setTimeout(function(){s(c),u&&u()},t)};return[i,a,r]}function NI(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:250,e=S.useRef(null),n=S.useRef(null);S.useEffect(function(){return function(){window.clearTimeout(n.current)}},[]);function i(s){(s||e.current===null)&&(e.current=s),window.clearTimeout(n.current),n.current=window.setTimeout(function(){e.current=null},t)}return[function(){return e.current},i]}function kF(t,e,n,i){var s=S.useRef(null);s.current={open:e,triggerOpen:n,customizedTrigger:i},S.useEffect(function(){function o(r){var a;if(!((a=s.current)!==null&&a!==void 0&&a.customizedTrigger)){var l=r.target;l.shadowRoot&&r.composed&&(l=r.composedPath()[0]||l),s.current.open&&t().filter(function(c){return c}).every(function(c){return!c.contains(l)&&c!==l})&&s.current.triggerOpen(!1)}}return window.addEventListener("mousedown",o),function(){return window.removeEventListener("mousedown",o)}},[])}function DF(t){return![et.ESC,et.SHIFT,et.BACKSPACE,et.TAB,et.WIN_KEY,et.ALT,et.META,et.WIN_KEY_RIGHT,et.CTRL,et.SEMICOLON,et.EQUALS,et.CAPS_LOCK,et.CONTEXT_MENU,et.F1,et.F2,et.F3,et.F4,et.F5,et.F6,et.F7,et.F8,et.F9,et.F10,et.F11,et.F12].includes(t)}var TF=function(e,n){var i,s=e.prefixCls,o=e.id,r=e.inputElement,a=e.disabled,l=e.tabIndex,c=e.autoFocus,u=e.autoComplete,d=e.editable,f=e.activeDescendantId,h=e.value,p=e.maxLength,m=e.onKeyDown,g=e.onMouseDown,v=e.onChange,x=e.onPaste,b=e.onCompositionStart,w=e.onCompositionEnd,y=e.open,C=e.attrs,I=r||S.createElement("input",null),$=I,E=$.ref,N=$.props,k=N.onKeyDown,D=N.onChange,_=N.onMouseDown,R=N.onCompositionStart,T=N.onCompositionEnd,A=N.style;return C_(!("maxLength"in I.props)),I=S.cloneElement(I,me(me(me({type:"search"},N),{},{id:o,ref:nf(n,E),disabled:a,tabIndex:l,autoComplete:u||"off",autoFocus:c,className:ye("".concat(s,"-selection-search-input"),(i=I)===null||i===void 0||(i=i.props)===null||i===void 0?void 0:i.className),role:"combobox","aria-expanded":y||!1,"aria-haspopup":"listbox","aria-owns":"".concat(o,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(o,"_list"),"aria-activedescendant":y?f:void 0},C),{},{value:d?h:"",maxLength:p,readOnly:!d,unselectable:d?null:"on",style:me(me({},A),{},{opacity:d?null:0}),onKeyDown:function(P){m(P),k&&k(P)},onMouseDown:function(P){g(P),_&&_(P)},onChange:function(P){v(P),D&&D(P)},onCompositionStart:function(P){b(P),R&&R(P)},onCompositionEnd:function(P){w(P),T&&T(P)},onPaste:x})),I},kI=S.forwardRef(TF);function DI(t){return Array.isArray(t)?t:t!==void 0?[t]:[]}var RF=typeof window<"u"&&window.document&&window.document.documentElement,_F=RF;function AF(t){return t!=null}function OF(t){return!t&&t!==0}function By(t){return["string","number"].includes(_n(t))}function TI(t){var e=void 0;return t&&(By(t.title)?e=t.title.toString():By(t.label)&&(e=t.label.toString())),e}function PF(t,e){_F?S.useLayoutEffect(t,e):S.useEffect(t,e)}function MF(t){var e;return(e=t.key)!==null&&e!==void 0?e:t.value}var Vy=function(e){e.preventDefault(),e.stopPropagation()},FF=function(e){var n=e.id,i=e.prefixCls,s=e.values,o=e.open,r=e.searchValue,a=e.autoClearSearchValue,l=e.inputRef,c=e.placeholder,u=e.disabled,d=e.mode,f=e.showSearch,h=e.autoFocus,p=e.autoComplete,m=e.activeDescendantId,g=e.tabIndex,v=e.removeIcon,x=e.maxTagCount,b=e.maxTagTextLength,w=e.maxTagPlaceholder,y=w===void 0?function(se){return"+ ".concat(se.length," ...")}:w,C=e.tagRender,I=e.onToggleOpen,$=e.onRemove,E=e.onInputChange,N=e.onInputPaste,k=e.onInputKeyDown,D=e.onInputMouseDown,_=e.onInputCompositionStart,R=e.onInputCompositionEnd,T=S.useRef(null),A=S.useState(0),O=ke(A,2),P=O[0],M=O[1],z=S.useState(!1),L=ke(z,2),W=L[0],B=L[1],q="".concat(i,"-selection"),H=o||d==="multiple"&&a===!1||d==="tags"?r:"",ne=d==="tags"||d==="multiple"&&a===!1||f&&(o||W);PF(function(){M(T.current.scrollWidth)},[H]);var te=function(J,ue,oe,be,de){return S.createElement("span",{title:TI(J),className:ye("".concat(q,"-item"),X({},"".concat(q,"-item-disabled"),oe))},S.createElement("span",{className:"".concat(q,"-item-content")},ue),be&&S.createElement(uf,{className:"".concat(q,"-item-remove"),onMouseDown:Vy,onClick:de,customizeIcon:v},"×"))},ae=function(J,ue,oe,be,de,Ie){var ge=function(De){Vy(De),I(!o)};return S.createElement("span",{onMouseDown:ge},C({label:ue,value:J,disabled:oe,closable:be,onClose:de,isMaxTag:!!Ie}))},re=function(J){var ue=J.disabled,oe=J.label,be=J.value,de=!u&&!ue,Ie=oe;if(typeof b=="number"&&(typeof oe=="string"||typeof oe=="number")){var ge=String(Ie);ge.length>b&&(Ie="".concat(ge.slice(0,b),"..."))}var $e=function(ve){ve&&ve.stopPropagation(),$(J)};return typeof C=="function"?ae(be,Ie,ue,de,$e):te(J,Ie,ue,de,$e)},ee=function(J){var ue=typeof y=="function"?y(J):y;return typeof C=="function"?ae(void 0,ue,!1,!1,void 0,!0):te({title:ue},ue,!1)},j=S.createElement("div",{className:"".concat(q,"-search"),style:{width:P},onFocus:function(){B(!0)},onBlur:function(){B(!1)}},S.createElement(kI,{ref:l,open:o,prefixCls:i,id:n,inputElement:null,disabled:u,autoFocus:h,autoComplete:p,editable:ne,activeDescendantId:m,value:H,onKeyDown:k,onMouseDown:D,onChange:E,onPaste:N,onCompositionStart:_,onCompositionEnd:R,tabIndex:g,attrs:wo(e,!0)}),S.createElement("span",{ref:T,className:"".concat(q,"-search-mirror"),"aria-hidden":!0},H," ")),Y=S.createElement(hA,{prefixCls:"".concat(q,"-overflow"),data:s,renderItem:re,renderRest:ee,suffix:j,itemKey:MF,maxCount:x});return S.createElement(S.Fragment,null,Y,!s.length&&!H&&S.createElement("span",{className:"".concat(q,"-placeholder")},c))},LF=function(e){var n=e.inputElement,i=e.prefixCls,s=e.id,o=e.inputRef,r=e.disabled,a=e.autoFocus,l=e.autoComplete,c=e.activeDescendantId,u=e.mode,d=e.open,f=e.values,h=e.placeholder,p=e.tabIndex,m=e.showSearch,g=e.searchValue,v=e.activeValue,x=e.maxLength,b=e.onInputKeyDown,w=e.onInputMouseDown,y=e.onInputChange,C=e.onInputPaste,I=e.onInputCompositionStart,$=e.onInputCompositionEnd,E=e.title,N=S.useState(!1),k=ke(N,2),D=k[0],_=k[1],R=u==="combobox",T=R||m,A=f[0],O=g||"";R&&v&&!D&&(O=v),S.useEffect(function(){R&&_(!1)},[R,v]);var P=u!=="combobox"&&!d&&!m?!1:!!O,M=E===void 0?TI(A):E,z=S.useMemo(function(){return A?null:S.createElement("span",{className:"".concat(i,"-selection-placeholder"),style:P?{visibility:"hidden"}:void 0},h)},[A,P,h,i]);return S.createElement(S.Fragment,null,S.createElement("span",{className:"".concat(i,"-selection-search")},S.createElement(kI,{ref:o,prefixCls:i,id:s,open:d,inputElement:n,disabled:r,autoFocus:a,autoComplete:l,editable:T,activeDescendantId:c,value:O,onKeyDown:b,onMouseDown:w,onChange:function(W){_(!0),y(W)},onPaste:C,onCompositionStart:I,onCompositionEnd:$,tabIndex:p,attrs:wo(e,!0),maxLength:R?x:void 0})),!R&&A?S.createElement("span",{className:"".concat(i,"-selection-item"),title:M,style:P?{visibility:"hidden"}:void 0},A.label):null,z)},zF=function(e,n){var i=S.useRef(null),s=S.useRef(!1),o=e.prefixCls,r=e.open,a=e.mode,l=e.showSearch,c=e.tokenWithEnter,u=e.disabled,d=e.autoClearSearchValue,f=e.onSearch,h=e.onSearchSubmit,p=e.onToggleOpen,m=e.onInputKeyDown,g=e.domRef;S.useImperativeHandle(n,function(){return{focus:function(P){i.current.focus(P)},blur:function(){i.current.blur()}}});var v=NI(0),x=ke(v,2),b=x[0],w=x[1],y=function(P){var M=P.which;(M===et.UP||M===et.DOWN)&&P.preventDefault(),m&&m(P),M===et.ENTER&&a==="tags"&&!s.current&&!r&&(h==null||h(P.target.value)),DF(M)&&p(!0)},C=function(){w(!0)},I=S.useRef(null),$=function(P){f(P,!0,s.current)!==!1&&p(!0)},E=function(){s.current=!0},N=function(P){s.current=!1,a!=="combobox"&&$(P.target.value)},k=function(P){var M=P.target.value;if(c&&I.current&&/[\r\n]/.test(I.current)){var z=I.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");M=M.replace(z,I.current)}I.current=null,$(M)},D=function(P){var M=P.clipboardData,z=M==null?void 0:M.getData("text");I.current=z||""},_=function(P){var M=P.target;if(M!==i.current){var z=document.body.style.msTouchAction!==void 0;z?setTimeout(function(){i.current.focus()}):i.current.focus()}},R=function(P){var M=b();P.target!==i.current&&!M&&!(a==="combobox"&&u)&&P.preventDefault(),(a!=="combobox"&&(!l||!M)||!r)&&(r&&d!==!1&&f("",!0,!1),p())},T={inputRef:i,onInputKeyDown:y,onInputMouseDown:C,onInputChange:k,onInputPaste:D,onInputCompositionStart:E,onInputCompositionEnd:N},A=a==="multiple"||a==="tags"?S.createElement(FF,Ve({},e,T)):S.createElement(LF,Ve({},e,T));return S.createElement("div",{ref:g,className:"".concat(o,"-selector"),onClick:_,onMouseDown:R},A)},BF=S.forwardRef(zF),VF=["prefixCls","disabled","visible","children","popupElement","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","builtinPlacements","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],WF=function(e){var n=e===!0?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:n,adjustY:1},htmlRegion:"scroll"},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:n,adjustY:1},htmlRegion:"scroll"},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:n,adjustY:1},htmlRegion:"scroll"},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:n,adjustY:1},htmlRegion:"scroll"}}},GF=function(e,n){var i=e.prefixCls;e.disabled;var s=e.visible,o=e.children,r=e.popupElement,a=e.animation,l=e.transitionName,c=e.dropdownStyle,u=e.dropdownClassName,d=e.direction,f=d===void 0?"ltr":d,h=e.placement,p=e.builtinPlacements,m=e.dropdownMatchSelectWidth,g=e.dropdownRender,v=e.dropdownAlign,x=e.getPopupContainer,b=e.empty,w=e.getTriggerDOMNode,y=e.onPopupVisibleChange,C=e.onPopupMouseEnter,I=In(e,VF),$="".concat(i,"-dropdown"),E=r;g&&(E=g(r));var N=S.useMemo(function(){return p||WF(m)},[p,m]),k=a?"".concat($,"-").concat(a):l,D=typeof m=="number",_=S.useMemo(function(){return D?null:m===!1?"minWidth":"width"},[m,D]),R=c;D&&(R=me(me({},R),{},{width:m}));var T=S.useRef(null);return S.useImperativeHandle(n,function(){return{getPopupElement:function(){var O;return(O=T.current)===null||O===void 0?void 0:O.popupElement}}}),S.createElement(S_,Ve({},I,{showAction:y?["click"]:[],hideAction:y?["click"]:[],popupPlacement:h||(f==="rtl"?"bottomRight":"bottomLeft"),builtinPlacements:N,prefixCls:$,popupTransitionName:k,popup:S.createElement("div",{onMouseEnter:C},E),ref:T,stretch:_,popupAlign:v,popupVisible:s,getPopupContainer:x,popupClassName:ye(u,X({},"".concat($,"-empty"),b)),popupStyle:R,getTriggerDOMNode:w,onPopupVisibleChange:y}),o)},HF=S.forwardRef(GF);function Wy(t,e){var n=t.key,i;return"value"in t&&(i=t.value),n??(i!==void 0?i:"rc-index-key-".concat(e))}function Zm(t){return typeof t<"u"&&!Number.isNaN(t)}function RI(t,e){var n=t||{},i=n.label,s=n.value,o=n.options,r=n.groupLabel,a=i||(e?"children":"label");return{label:a,value:s||"value",options:o||"options",groupLabel:r||a}}function UF(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.fieldNames,i=e.childrenAsData,s=[],o=RI(n,!1),r=o.label,a=o.value,l=o.options,c=o.groupLabel;function u(d,f){Array.isArray(d)&&d.forEach(function(h){if(f||!(l in h)){var p=h[a];s.push({key:Wy(h,s.length),groupOption:f,data:h,label:h[r],value:p})}else{var m=h[c];m===void 0&&i&&(m=h.label),s.push({key:Wy(h,s.length),group:!0,data:h,label:m}),u(h[l],!0)}})}return u(t,!1),s}function Qm(t){var e=me({},t);return"props"in e||Object.defineProperty(e,"props",{get:function(){return Lo(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),e}}),e}var jF=function(e,n,i){if(!n||!n.length)return null;var s=!1,o=function a(l,c){var u=I_(c),d=u[0],f=u.slice(1);if(!d)return[l];var h=l.split(d);return s=s||h.length>1,h.reduce(function(p,m){return[].concat(Ze(p),Ze(a(m,f)))},[]).filter(Boolean)},r=o(e,n);return s?typeof i<"u"?r.slice(0,i):r:null},Pv=S.createContext(null);function KF(t){var e=t.visible,n=t.values;if(!e)return null;var i=50;return S.createElement("span",{"aria-live":"polite",style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},"".concat(n.slice(0,i).map(function(s){var o=s.label,r=s.value;return["number","string"].includes(_n(o))?o:r}).join(", ")),n.length>i?", ...":null)}var XF=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],qF=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"],eg=function(e){return e==="tags"||e==="multiple"},YF=S.forwardRef(function(t,e){var n,i=t.id,s=t.prefixCls,o=t.className,r=t.showSearch,a=t.tagRender,l=t.direction,c=t.omitDomProps,u=t.displayValues,d=t.onDisplayValuesChange,f=t.emptyOptions,h=t.notFoundContent,p=h===void 0?"Not Found":h,m=t.onClear,g=t.mode,v=t.disabled,x=t.loading,b=t.getInputElement,w=t.getRawInputElement,y=t.open,C=t.defaultOpen,I=t.onDropdownVisibleChange,$=t.activeValue,E=t.onActiveValueChange,N=t.activeDescendantId,k=t.searchValue,D=t.autoClearSearchValue,_=t.onSearch,R=t.onSearchSplit,T=t.tokenSeparators,A=t.allowClear,O=t.suffixIcon,P=t.clearIcon,M=t.OptionList,z=t.animation,L=t.transitionName,W=t.dropdownStyle,B=t.dropdownClassName,q=t.dropdownMatchSelectWidth,H=t.dropdownRender,ne=t.dropdownAlign,te=t.placement,ae=t.builtinPlacements,re=t.getPopupContainer,ee=t.showAction,j=ee===void 0?[]:ee,Y=t.onFocus,se=t.onBlur,J=t.onKeyUp,ue=t.onKeyDown,oe=t.onMouseDown,be=In(t,XF),de=eg(g),Ie=(r!==void 0?r:de)||g==="combobox",ge=me({},be);qF.forEach(function(kt){delete ge[kt]}),c==null||c.forEach(function(kt){delete ge[kt]});var $e=S.useState(!1),De=ke($e,2),ve=De[0],we=De[1];S.useEffect(function(){we($_())},[]);var Re=S.useRef(null),Ne=S.useRef(null),Ke=S.useRef(null),We=S.useRef(null),ct=S.useRef(null),Ee=S.useRef(!1),lt=NF(),Xe=ke(lt,3),Le=Xe[0],Pe=Xe[1],ut=Xe[2];S.useImperativeHandle(e,function(){var kt,pt;return{focus:(kt=We.current)===null||kt===void 0?void 0:kt.focus,blur:(pt=We.current)===null||pt===void 0?void 0:pt.blur,scrollTo:function(oi){var xn;return(xn=ct.current)===null||xn===void 0?void 0:xn.scrollTo(oi)},nativeElement:Re.current||Ne.current}});var ht=S.useMemo(function(){var kt;if(g!=="combobox")return k;var pt=(kt=u[0])===null||kt===void 0?void 0:kt.value;return typeof pt=="string"||typeof pt=="number"?String(pt):""},[k,g,u]),Pt=g==="combobox"&&typeof b=="function"&&b()||null,ft=typeof w=="function"&&w(),Jn=E_(Ne,ft==null||(n=ft.props)===null||n===void 0?void 0:n.ref),Ut=S.useState(!1),vi=ke(Ut,2),Mt=vi[0],ki=vi[1];Ki(function(){ki(!0)},[]);var un=Wo(!1,{defaultValue:C,value:y}),dn=ke(un,2),gn=dn[0],Gn=dn[1],Tt=Mt?gn:!1,Yt=!p&&f;(v||Yt&&Tt&&g==="combobox")&&(Tt=!1);var jt=Yt?!1:Tt,Be=S.useCallback(function(kt){var pt=kt!==void 0?kt:!Tt;v||(Gn(pt),Tt!==pt&&(I==null||I(pt)))},[v,Tt,Gn,I]),ze=S.useMemo(function(){return(T||[]).some(function(kt){return[`
`,`\r
`].includes(kt)})},[T]),Oe=S.useContext(Pv)||{},qe=Oe.maxCount,Dt=Oe.rawValues,Rt=function(pt,Qn,oi){if(!(de&&Zm(qe)&&(Dt==null?void 0:Dt.size)>=qe)){var xn=!0,Hn=pt;E==null||E(null);var hs=jF(pt,T,Zm(qe)?qe-Dt.size:void 0),fs=oi?null:hs;return g!=="combobox"&&fs&&(Hn="",R==null||R(fs),Be(!1),xn=!1),_&&ht!==Hn&&_(Hn,{source:Qn?"typing":"effect"}),xn}},vn=function(pt){!pt||!pt.trim()||_(pt,{source:"submit"})};S.useEffect(function(){!Tt&&!de&&g!=="combobox"&&Rt("",!1,!1)},[Tt]),S.useEffect(function(){gn&&v&&Gn(!1),v&&!Ee.current&&Pe(!1)},[v]);var Je=NI(),dt=ke(Je,2),st=dt[0],vt=dt[1],Kt=S.useRef(!1),hn=function(pt){var Qn=st(),oi=pt.key,xn=oi==="Enter";if(xn&&(g!=="combobox"&&pt.preventDefault(),Tt||Be(!0)),vt(!!ht),oi==="Backspace"&&!Qn&&de&&!ht&&u.length){for(var Hn=Ze(u),hs=null,fs=Hn.length-1;fs>=0;fs-=1){var Qs=Hn[fs];if(!Qs.disabled){Hn.splice(fs,1),hs=Qs;break}}hs&&d(Hn,{type:"remove",values:[hs]})}for(var eo=arguments.length,to=new Array(eo>1?eo-1:0),ir=1;ir<eo;ir++)to[ir-1]=arguments[ir];if(Tt&&(!xn||!Kt.current)){var Br;(Br=ct.current)===null||Br===void 0||Br.onKeyDown.apply(Br,[pt].concat(to))}xn&&(Kt.current=!0),ue==null||ue.apply(void 0,[pt].concat(to))},An=function(pt){for(var Qn=arguments.length,oi=new Array(Qn>1?Qn-1:0),xn=1;xn<Qn;xn++)oi[xn-1]=arguments[xn];if(Tt){var Hn;(Hn=ct.current)===null||Hn===void 0||Hn.onKeyUp.apply(Hn,[pt].concat(oi))}pt.key==="Enter"&&(Kt.current=!1),J==null||J.apply(void 0,[pt].concat(oi))},Xt=function(pt){var Qn=u.filter(function(oi){return oi!==pt});d(Qn,{type:"remove",values:[pt]})},Ue=S.useRef(!1),je=function(){Pe(!0),v||(Y&&!Ue.current&&Y.apply(void 0,arguments),j.includes("focus")&&Be(!0)),Ue.current=!0},yt=function(){Ee.current=!0,Pe(!1,function(){Ue.current=!1,Ee.current=!1,Be(!1)}),!v&&(ht&&(g==="tags"?_(ht,{source:"submit"}):g==="multiple"&&_("",{source:"blur"})),se&&se.apply(void 0,arguments))},Ft=[];S.useEffect(function(){return function(){Ft.forEach(function(kt){return clearTimeout(kt)}),Ft.splice(0,Ft.length)}},[]);var Zn=function(pt){var Qn,oi=pt.target,xn=(Qn=Ke.current)===null||Qn===void 0?void 0:Qn.getPopupElement();if(xn&&xn.contains(oi)){var Hn=setTimeout(function(){var eo=Ft.indexOf(Hn);if(eo!==-1&&Ft.splice(eo,1),ut(),!ve&&!xn.contains(document.activeElement)){var to;(to=We.current)===null||to===void 0||to.focus()}});Ft.push(Hn)}for(var hs=arguments.length,fs=new Array(hs>1?hs-1:0),Qs=1;Qs<hs;Qs++)fs[Qs-1]=arguments[Qs];oe==null||oe.apply(void 0,[pt].concat(fs))},Di=S.useState({}),es=ke(Di,2),Ms=es[1];function Fs(){Ms({})}var ds;ft&&(ds=function(pt){Be(pt)}),kF(function(){var kt;return[Re.current,(kt=Ke.current)===null||kt===void 0?void 0:kt.getPopupElement()]},jt,Be,!!ft);var Do=S.useMemo(function(){return me(me({},t),{},{notFoundContent:p,open:Tt,triggerOpen:jt,id:i,showSearch:Ie,multiple:de,toggleOpen:Be})},[t,p,jt,Tt,i,Ie,de,Be]),it=!!O||x,wt;it&&(wt=S.createElement(uf,{className:ye("".concat(s,"-arrow"),X({},"".concat(s,"-arrow-loading"),x)),customizeIcon:O,customizeIconProps:{loading:x,searchValue:ht,open:Tt,focused:Le,showSearch:Ie}}));var nn=function(){var pt;m==null||m(),(pt=We.current)===null||pt===void 0||pt.focus(),d([],{type:"clear",values:u}),Rt("",!1,!1)},ts=$F(s,nn,u,A,P,v,ht,g),To=ts.allowClear,$d=ts.clearIcon,Yp=S.createElement(M,{ref:ct}),Jp=ye(s,o,X(X(X(X(X(X(X(X(X(X({},"".concat(s,"-focused"),Le),"".concat(s,"-multiple"),de),"".concat(s,"-single"),!de),"".concat(s,"-allow-clear"),A),"".concat(s,"-show-arrow"),it),"".concat(s,"-disabled"),v),"".concat(s,"-loading"),x),"".concat(s,"-open"),Tt),"".concat(s,"-customize-input"),Pt),"".concat(s,"-show-search"),Ie)),Ed=S.createElement(HF,{ref:Ke,disabled:v,prefixCls:s,visible:jt,popupElement:Yp,animation:z,transitionName:L,dropdownStyle:W,dropdownClassName:B,direction:l,dropdownMatchSelectWidth:q,dropdownRender:H,dropdownAlign:ne,placement:te,builtinPlacements:ae,getPopupContainer:re,empty:f,getTriggerDOMNode:function(pt){return Ne.current||pt},onPopupVisibleChange:ds,onPopupMouseEnter:Fs},ft?S.cloneElement(ft,{ref:Jn}):S.createElement(BF,Ve({},t,{domRef:Ne,prefixCls:s,inputElement:Pt,ref:We,id:i,showSearch:Ie,autoClearSearchValue:D,mode:g,activeDescendantId:N,tagRender:a,values:u,open:Tt,onToggleOpen:Be,activeValue:$,searchValue:ht,onSearch:Rt,onSearchSubmit:vn,onRemove:Xt,tokenWithEnter:ze}))),Ua;return ft?Ua=Ed:Ua=S.createElement("div",Ve({className:Jp},ge,{ref:Re,onMouseDown:Zn,onKeyDown:hn,onKeyUp:An,onFocus:je,onBlur:yt}),S.createElement(KF,{visible:Le&&!Tt,values:u}),Ed,wt,To&&$d),S.createElement(EI.Provider,{value:Do},Ua)}),Mv=function(){return null};Mv.isSelectOptGroup=!0;var Fv=function(){return null};Fv.isSelectOption=!0;var _I=S.forwardRef(function(t,e){var n=t.height,i=t.offsetY,s=t.offsetX,o=t.children,r=t.prefixCls,a=t.onInnerResize,l=t.innerProps,c=t.rtl,u=t.extra,d={},f={display:"flex",flexDirection:"column"};return i!==void 0&&(d={height:n,position:"relative",overflow:"hidden"},f=me(me({},f),{},X(X(X(X(X({transform:"translateY(".concat(i,"px)")},c?"marginRight":"marginLeft",-s),"position","absolute"),"left",0),"right",0),"top",0))),S.createElement("div",{style:d},S.createElement(Wl,{onResize:function(p){var m=p.offsetHeight;m&&a&&a()}},S.createElement("div",Ve({style:f,className:ye(X({},"".concat(r,"-holder-inner"),r)),ref:e},l),o,u)))});_I.displayName="Filler";function JF(t){var e=t.children,n=t.setRef,i=S.useCallback(function(s){n(s)},[]);return S.cloneElement(e,{ref:i})}function ZF(t,e,n,i,s,o,r,a){var l=a.getKey;return t.slice(e,n+1).map(function(c,u){var d=e+u,f=r(c,d,{style:{width:i},offsetX:s}),h=l(c);return S.createElement(JF,{key:h,setRef:function(m){return o(c,m)}},f)})}function QF(t,e,n){var i=t.length,s=e.length,o,r;if(i===0&&s===0)return null;i<s?(o=t,r=e):(o=e,r=t);var a={__EMPTY_ITEM__:!0};function l(p){return p!==void 0?n(p):a}for(var c=null,u=Math.abs(i-s)!==1,d=0;d<r.length;d+=1){var f=l(o[d]),h=l(r[d]);if(f!==h){c=d,u=u||f!==l(r[d+1]);break}}return c===null?null:{index:c,multiple:u}}function eL(t,e,n){var i=S.useState(t),s=ke(i,2),o=s[0],r=s[1],a=S.useState(null),l=ke(a,2),c=l[0],u=l[1];return S.useEffect(function(){var d=QF(o||[],t||[],e);(d==null?void 0:d.index)!==void 0&&u(t[d.index]),r(t)},[t]),[c]}var Gy=(typeof navigator>"u"?"undefined":_n(navigator))==="object"&&/Firefox/i.test(navigator.userAgent);const AI=function(t,e,n,i){var s=S.useRef(!1),o=S.useRef(null);function r(){clearTimeout(o.current),s.current=!0,o.current=setTimeout(function(){s.current=!1},50)}var a=S.useRef({top:t,bottom:e,left:n,right:i});return a.current.top=t,a.current.bottom=e,a.current.left=n,a.current.right=i,function(l,c){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=l?c<0&&a.current.left||c>0&&a.current.right:c<0&&a.current.top||c>0&&a.current.bottom;return u&&d?(clearTimeout(o.current),s.current=!1):(!d||s.current)&&r(),!s.current&&d}};function tL(t,e,n,i,s,o,r){var a=S.useRef(0),l=S.useRef(null),c=S.useRef(null),u=S.useRef(!1),d=AI(e,n,i,s);function f(x,b){Pi.cancel(l.current),a.current+=b,c.current=b,!d(!1,b)&&(Gy||x.preventDefault(),l.current=Pi(function(){var w=u.current?10:1;r(a.current*w),a.current=0}))}function h(x,b){r(b,!0),Gy||x.preventDefault()}var p=S.useRef(null),m=S.useRef(null);function g(x){if(t){Pi.cancel(m.current),m.current=Pi(function(){p.current=null},2);var b=x.deltaX,w=x.deltaY,y=x.shiftKey,C=b,I=w;(p.current==="sx"||!p.current&&y&&w&&!b)&&(C=w,I=0,p.current="sx");var $=Math.abs(C),E=Math.abs(I);p.current===null&&(p.current=o&&$>E?"x":"y"),p.current==="y"?f(x,I):h(x,C)}}function v(x){t&&(u.current=x.detail===c.current)}return[g,v]}function nL(t,e,n,i){var s=S.useMemo(function(){return[new Map,[]]},[t,n.id,i]),o=ke(s,2),r=o[0],a=o[1],l=function(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u,f=r.get(u),h=r.get(d);if(f===void 0||h===void 0)for(var p=t.length,m=a.length;m<p;m+=1){var g,v=t[m],x=e(v);r.set(x,m);var b=(g=n.get(x))!==null&&g!==void 0?g:i;if(a[m]=(a[m-1]||0)+b,x===u&&(f=m),x===d&&(h=m),f!==void 0&&h!==void 0)break}return{top:a[f-1]||0,bottom:a[h]}};return l}var iL=function(){function t(){lv(this,t),X(this,"maps",void 0),X(this,"id",0),this.maps=Object.create(null)}return av(t,[{key:"set",value:function(n,i){this.maps[n]=i,this.id+=1}},{key:"get",value:function(n){return this.maps[n]}}]),t}();function sL(t,e,n){var i=S.useState(0),s=ke(i,2),o=s[0],r=s[1],a=S.useRef(new Map),l=S.useRef(new iL),c=S.useRef();function u(){Pi.cancel(c.current)}function d(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;u();var p=function(){a.current.forEach(function(g,v){if(g&&g.offsetParent){var x=N_(g),b=x.offsetHeight;l.current.get(v)!==b&&l.current.set(v,x.offsetHeight)}}),r(function(g){return g+1})};h?p():c.current=Pi(p)}function f(h,p){var m=t(h);a.current.get(m),p?(a.current.set(m,p),d()):a.current.delete(m)}return S.useEffect(function(){return u},[]),[f,d,l.current,o]}var Hy=14/15;function oL(t,e,n){var i=S.useRef(!1),s=S.useRef(0),o=S.useRef(0),r=S.useRef(null),a=S.useRef(null),l,c=function(h){if(i.current){var p=Math.ceil(h.touches[0].pageX),m=Math.ceil(h.touches[0].pageY),g=s.current-p,v=o.current-m,x=Math.abs(g)>Math.abs(v);x?s.current=p:o.current=m,n(x,x?g:v)&&h.preventDefault(),clearInterval(a.current),a.current=setInterval(function(){x?g*=Hy:v*=Hy;var b=Math.floor(x?g:v);(!n(x,b,!0)||Math.abs(b)<=.1)&&clearInterval(a.current)},16)}},u=function(){i.current=!1,l()},d=function(h){l(),h.touches.length===1&&!i.current&&(i.current=!0,s.current=Math.ceil(h.touches[0].pageX),o.current=Math.ceil(h.touches[0].pageY),r.current=h.target,r.current.addEventListener("touchmove",c,{passive:!1}),r.current.addEventListener("touchend",u,{passive:!0}))};l=function(){r.current&&(r.current.removeEventListener("touchmove",c),r.current.removeEventListener("touchend",u))},Ki(function(){return t&&e.current.addEventListener("touchstart",d,{passive:!0}),function(){var f;(f=e.current)===null||f===void 0||f.removeEventListener("touchstart",d),l(),clearInterval(a.current)}},[t])}var rL=10;function aL(t,e,n,i,s,o,r,a){var l=S.useRef(),c=S.useState(null),u=ke(c,2),d=u[0],f=u[1];return Ki(function(){if(d&&d.times<rL){if(!t.current){f(function(M){return me({},M)});return}o();var h=d.targetAlign,p=d.originAlign,m=d.index,g=d.offset,v=t.current.clientHeight,x=!1,b=h,w=null;if(v){for(var y=h||p,C=0,I=0,$=0,E=Math.min(e.length-1,m),N=0;N<=E;N+=1){var k=s(e[N]);I=C;var D=n.get(k);$=I+(D===void 0?i:D),C=$}for(var _=y==="top"?g:v-g,R=E;R>=0;R-=1){var T=s(e[R]),A=n.get(T);if(A===void 0){x=!0;break}if(_-=A,_<=0)break}switch(y){case"top":w=I-g;break;case"bottom":w=$-v+g;break;default:{var O=t.current.scrollTop,P=O+v;I<O?b="top":$>P&&(b="bottom")}}w!==null&&r(w),w!==d.lastTop&&(x=!0)}x&&f(me(me({},d),{},{times:d.times+1,targetAlign:b,lastTop:w}))}},[d,t.current]),function(h){if(h==null){a();return}if(Pi.cancel(l.current),typeof h=="number")r(h);else if(h&&_n(h)==="object"){var p,m=h.align;"index"in h?p=h.index:p=e.findIndex(function(x){return s(x)===h.key});var g=h.offset,v=g===void 0?0:g;f({times:0,index:p,offset:v,originAlign:m})}}}function Uy(t,e){var n="touches"in t?t.touches[0]:t;return n[e?"pageX":"pageY"]}var jy=S.forwardRef(function(t,e){var n=t.prefixCls,i=t.rtl,s=t.scrollOffset,o=t.scrollRange,r=t.onStartMove,a=t.onStopMove,l=t.onScroll,c=t.horizontal,u=t.spinSize,d=t.containerSize,f=t.style,h=t.thumbStyle,p=S.useState(!1),m=ke(p,2),g=m[0],v=m[1],x=S.useState(null),b=ke(x,2),w=b[0],y=b[1],C=S.useState(null),I=ke(C,2),$=I[0],E=I[1],N=!i,k=S.useRef(),D=S.useRef(),_=S.useState(!1),R=ke(_,2),T=R[0],A=R[1],O=S.useRef(),P=function(){clearTimeout(O.current),A(!0),O.current=setTimeout(function(){A(!1)},3e3)},M=o-d||0,z=d-u||0,L=S.useMemo(function(){if(s===0||M===0)return 0;var ee=s/M;return ee*z},[s,M,z]),W=function(j){j.stopPropagation(),j.preventDefault()},B=S.useRef({top:L,dragging:g,pageY:w,startTop:$});B.current={top:L,dragging:g,pageY:w,startTop:$};var q=function(j){v(!0),y(Uy(j,c)),E(B.current.top),r(),j.stopPropagation(),j.preventDefault()};S.useEffect(function(){var ee=function(J){J.preventDefault()},j=k.current,Y=D.current;return j.addEventListener("touchstart",ee,{passive:!1}),Y.addEventListener("touchstart",q,{passive:!1}),function(){j.removeEventListener("touchstart",ee),Y.removeEventListener("touchstart",q)}},[]);var H=S.useRef();H.current=M;var ne=S.useRef();ne.current=z,S.useEffect(function(){if(g){var ee,j=function(J){var ue=B.current,oe=ue.dragging,be=ue.pageY,de=ue.startTop;Pi.cancel(ee);var Ie=k.current.getBoundingClientRect(),ge=d/(c?Ie.width:Ie.height);if(oe){var $e=(Uy(J,c)-be)*ge,De=de;!N&&c?De-=$e:De+=$e;var ve=H.current,we=ne.current,Re=we?De/we:0,Ne=Math.ceil(Re*ve);Ne=Math.max(Ne,0),Ne=Math.min(Ne,ve),ee=Pi(function(){l(Ne,c)})}},Y=function(){v(!1),a()};return window.addEventListener("mousemove",j,{passive:!0}),window.addEventListener("touchmove",j,{passive:!0}),window.addEventListener("mouseup",Y,{passive:!0}),window.addEventListener("touchend",Y,{passive:!0}),function(){window.removeEventListener("mousemove",j),window.removeEventListener("touchmove",j),window.removeEventListener("mouseup",Y),window.removeEventListener("touchend",Y),Pi.cancel(ee)}}},[g]),S.useEffect(function(){return P(),function(){clearTimeout(O.current)}},[s]),S.useImperativeHandle(e,function(){return{delayHidden:P}});var te="".concat(n,"-scrollbar"),ae={position:"absolute",visibility:T?null:"hidden"},re={position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"};return c?(ae.height=8,ae.left=0,ae.right=0,ae.bottom=0,re.height="100%",re.width=u,N?re.left=L:re.right=L):(ae.width=8,ae.top=0,ae.bottom=0,N?ae.right=0:ae.left=0,re.width="100%",re.height=u,re.top=L),S.createElement("div",{ref:k,className:ye(te,X(X(X({},"".concat(te,"-horizontal"),c),"".concat(te,"-vertical"),!c),"".concat(te,"-visible"),T)),style:me(me({},ae),f),onMouseDown:W,onMouseMove:P},S.createElement("div",{ref:D,className:ye("".concat(te,"-thumb"),X({},"".concat(te,"-thumb-moving"),g)),style:me(me({},re),h),onMouseDown:q}))}),lL=20;function Ky(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=t/e*t;return isNaN(n)&&(n=0),n=Math.max(n,lL),Math.floor(n)}var cL=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles"],uL=[],dL={overflowY:"auto",overflowAnchor:"none"};function hL(t,e){var n=t.prefixCls,i=n===void 0?"rc-virtual-list":n,s=t.className,o=t.height,r=t.itemHeight,a=t.fullHeight,l=a===void 0?!0:a,c=t.style,u=t.data,d=t.children,f=t.itemKey,h=t.virtual,p=t.direction,m=t.scrollWidth,g=t.component,v=g===void 0?"div":g,x=t.onScroll,b=t.onVirtualScroll,w=t.onVisibleChange,y=t.innerProps,C=t.extraRender,I=t.styles,$=In(t,cL),E=S.useCallback(function(Ue){return typeof f=="function"?f(Ue):Ue==null?void 0:Ue[f]},[f]),N=sL(E),k=ke(N,4),D=k[0],_=k[1],R=k[2],T=k[3],A=!!(h!==!1&&o&&r),O=S.useMemo(function(){return Object.values(R.maps).reduce(function(Ue,je){return Ue+je},0)},[R.id,R.maps]),P=A&&u&&(Math.max(r*u.length,O)>o||!!m),M=p==="rtl",z=ye(i,X({},"".concat(i,"-rtl"),M),s),L=u||uL,W=S.useRef(),B=S.useRef(),q=S.useRef(),H=S.useState(0),ne=ke(H,2),te=ne[0],ae=ne[1],re=S.useState(0),ee=ke(re,2),j=ee[0],Y=ee[1],se=S.useState(!1),J=ke(se,2),ue=J[0],oe=J[1],be=function(){oe(!0)},de=function(){oe(!1)},Ie={getKey:E};function ge(Ue){ae(function(je){var yt;typeof Ue=="function"?yt=Ue(je):yt=Ue;var Ft=Mt(yt);return W.current.scrollTop=Ft,Ft})}var $e=S.useRef({start:0,end:L.length}),De=S.useRef(),ve=eL(L,E),we=ke(ve,1),Re=we[0];De.current=Re;var Ne=S.useMemo(function(){if(!A)return{scrollHeight:void 0,start:0,end:L.length-1,offset:void 0};if(!P){var Ue;return{scrollHeight:((Ue=B.current)===null||Ue===void 0?void 0:Ue.offsetHeight)||0,start:0,end:L.length-1,offset:void 0}}for(var je=0,yt,Ft,Zn,Di=L.length,es=0;es<Di;es+=1){var Ms=L[es],Fs=E(Ms),ds=R.get(Fs),Do=je+(ds===void 0?r:ds);Do>=te&&yt===void 0&&(yt=es,Ft=je),Do>te+o&&Zn===void 0&&(Zn=es),je=Do}return yt===void 0&&(yt=0,Ft=0,Zn=Math.ceil(o/r)),Zn===void 0&&(Zn=L.length-1),Zn=Math.min(Zn+1,L.length-1),{scrollHeight:je,start:yt,end:Zn,offset:Ft}},[P,A,te,L,T,o]),Ke=Ne.scrollHeight,We=Ne.start,ct=Ne.end,Ee=Ne.offset;$e.current.start=We,$e.current.end=ct;var lt=S.useState({width:0,height:o}),Xe=ke(lt,2),Le=Xe[0],Pe=Xe[1],ut=function(je){Pe({width:je.offsetWidth,height:je.offsetHeight})},ht=S.useRef(),Pt=S.useRef(),ft=S.useMemo(function(){return Ky(Le.width,m)},[Le.width,m]),Jn=S.useMemo(function(){return Ky(Le.height,Ke)},[Le.height,Ke]),Ut=Ke-o,vi=S.useRef(Ut);vi.current=Ut;function Mt(Ue){var je=Ue;return Number.isNaN(vi.current)||(je=Math.min(je,vi.current)),je=Math.max(je,0),je}var ki=te<=0,un=te>=Ut,dn=j<=0,gn=j>=m,Gn=AI(ki,un,dn,gn),Tt=function(){return{x:M?-j:j,y:te}},Yt=S.useRef(Tt()),jt=ks(function(Ue){if(b){var je=me(me({},Tt()),Ue);(Yt.current.x!==je.x||Yt.current.y!==je.y)&&(b(je),Yt.current=je)}});function Be(Ue,je){var yt=Ue;je?(Um.flushSync(function(){Y(yt)}),jt()):ge(yt)}function ze(Ue){var je=Ue.currentTarget.scrollTop;je!==te&&ge(je),x==null||x(Ue),jt()}var Oe=function(je){var yt=je,Ft=m?m-Le.width:0;return yt=Math.max(yt,0),yt=Math.min(yt,Ft),yt},qe=ks(function(Ue,je){je?(Um.flushSync(function(){Y(function(yt){var Ft=yt+(M?-Ue:Ue);return Oe(Ft)})}),jt()):ge(function(yt){var Ft=yt+Ue;return Ft})}),Dt=tL(A,ki,un,dn,gn,!!m,qe),Rt=ke(Dt,2),vn=Rt[0],Je=Rt[1];oL(A,W,function(Ue,je,yt){return Gn(Ue,je,yt)?!1:(vn({preventDefault:function(){},deltaX:Ue?je:0,deltaY:Ue?0:je}),!0)}),Ki(function(){function Ue(yt){A&&yt.preventDefault()}var je=W.current;return je.addEventListener("wheel",vn,{passive:!1}),je.addEventListener("DOMMouseScroll",Je,{passive:!0}),je.addEventListener("MozMousePixelScroll",Ue,{passive:!1}),function(){je.removeEventListener("wheel",vn),je.removeEventListener("DOMMouseScroll",Je),je.removeEventListener("MozMousePixelScroll",Ue)}},[A]),Ki(function(){if(m){var Ue=Oe(j);Y(Ue),jt({x:Ue})}},[Le.width,m]);var dt=function(){var je,yt;(je=ht.current)===null||je===void 0||je.delayHidden(),(yt=Pt.current)===null||yt===void 0||yt.delayHidden()},st=aL(W,L,R,r,E,function(){return _(!0)},ge,dt);S.useImperativeHandle(e,function(){return{nativeElement:q.current,getScrollInfo:Tt,scrollTo:function(je){function yt(Ft){return Ft&&_n(Ft)==="object"&&("left"in Ft||"top"in Ft)}yt(je)?(je.left!==void 0&&Y(Oe(je.left)),st(je.top)):st(je)}}}),Ki(function(){if(w){var Ue=L.slice(We,ct+1);w(Ue,L)}},[We,ct,L]);var vt=nL(L,E,R,r),Kt=C==null?void 0:C({start:We,end:ct,virtual:P,offsetX:j,offsetY:Ee,rtl:M,getSize:vt}),hn=ZF(L,We,ct,m,j,D,d,Ie),An=null;o&&(An=me(X({},l?"height":"maxHeight",o),dL),A&&(An.overflowY="hidden",m&&(An.overflowX="hidden"),ue&&(An.pointerEvents="none")));var Xt={};return M&&(Xt.dir="rtl"),S.createElement("div",Ve({ref:q,style:me(me({},c),{},{position:"relative"}),className:z},Xt,$),S.createElement(Wl,{onResize:ut},S.createElement(v,{className:"".concat(i,"-holder"),style:An,ref:W,onScroll:ze,onMouseEnter:dt},S.createElement(_I,{prefixCls:i,height:Ke,offsetX:j,offsetY:Ee,scrollWidth:m,onInnerResize:_,ref:B,innerProps:y,rtl:M,extra:Kt},hn))),P&&Ke>o&&S.createElement(jy,{ref:ht,prefixCls:i,scrollOffset:te,scrollRange:Ke,rtl:M,onScroll:Be,onStartMove:be,onStopMove:de,spinSize:Jn,containerSize:Le.height,style:I==null?void 0:I.verticalScrollBar,thumbStyle:I==null?void 0:I.verticalScrollBarThumb}),P&&m>Le.width&&S.createElement(jy,{ref:Pt,prefixCls:i,scrollOffset:j,scrollRange:m,rtl:M,onScroll:Be,onStartMove:be,onStopMove:de,spinSize:ft,containerSize:Le.width,horizontal:!0,style:I==null?void 0:I.horizontalScrollBar,thumbStyle:I==null?void 0:I.horizontalScrollBarThumb}))}var df=S.forwardRef(hL);df.displayName="List";function fL(){return/(mac\sos|macintosh)/i.test(navigator.appVersion)}var pL=["disabled","title","children","style","className"];function Xy(t){return typeof t=="string"||typeof t=="number"}var mL=function(e,n){var i=EF(),s=i.prefixCls,o=i.id,r=i.open,a=i.multiple,l=i.mode,c=i.searchValue,u=i.toggleOpen,d=i.notFoundContent,f=i.onPopupScroll,h=S.useContext(Pv),p=h.maxCount,m=h.flattenOptions,g=h.onActiveValue,v=h.defaultActiveFirstOption,x=h.onSelect,b=h.menuItemSelectedIcon,w=h.rawValues,y=h.fieldNames,C=h.virtual,I=h.direction,$=h.listHeight,E=h.listItemHeight,N=h.optionRender,k="".concat(s,"-item"),D=cv(function(){return m},[r,m],function(ee,j){return j[0]&&ee[1]!==j[1]}),_=S.useRef(null),R=S.useMemo(function(){return a&&Zm(p)&&(w==null?void 0:w.size)>=p},[a,p,w==null?void 0:w.size]),T=function(j){j.preventDefault()},A=function(j){var Y;(Y=_.current)===null||Y===void 0||Y.scrollTo(typeof j=="number"?{index:j}:j)},O=function(j){for(var Y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,se=D.length,J=0;J<se;J+=1){var ue=(j+J*Y+se)%se,oe=D[ue]||{},be=oe.group,de=oe.data;if(!be&&!(de!=null&&de.disabled)&&!R)return ue}return-1},P=S.useState(function(){return O(0)}),M=ke(P,2),z=M[0],L=M[1],W=function(j){var Y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;L(j);var se={source:Y?"keyboard":"mouse"},J=D[j];if(!J){g(null,-1,se);return}g(J.value,j,se)};S.useEffect(function(){W(v!==!1?O(0):-1)},[D.length,c]);var B=S.useCallback(function(ee){return w.has(ee)&&l!=="combobox"},[l,Ze(w).toString(),w.size]);S.useEffect(function(){var ee=setTimeout(function(){if(!a&&r&&w.size===1){var Y=Array.from(w)[0],se=D.findIndex(function(J){var ue=J.data;return ue.value===Y});se!==-1&&(W(se),A(se))}});if(r){var j;(j=_.current)===null||j===void 0||j.scrollTo(void 0)}return function(){return clearTimeout(ee)}},[r,c]);var q=function(j){j!==void 0&&x(j,{selected:!w.has(j)}),a||u(!1)};if(S.useImperativeHandle(n,function(){return{onKeyDown:function(j){var Y=j.which,se=j.ctrlKey;switch(Y){case et.N:case et.P:case et.UP:case et.DOWN:{var J=0;if(Y===et.UP?J=-1:Y===et.DOWN?J=1:fL()&&se&&(Y===et.N?J=1:Y===et.P&&(J=-1)),J!==0){var ue=O(z+J,J);A(ue),W(ue,!0)}break}case et.ENTER:{var oe,be=D[z];be&&!(be!=null&&(oe=be.data)!==null&&oe!==void 0&&oe.disabled)&&!R?q(be.value):q(void 0),r&&j.preventDefault();break}case et.ESC:u(!1),r&&j.stopPropagation()}},onKeyUp:function(){},scrollTo:function(j){A(j)}}}),D.length===0)return S.createElement("div",{role:"listbox",id:"".concat(o,"_list"),className:"".concat(k,"-empty"),onMouseDown:T},d);var H=Object.keys(y).map(function(ee){return y[ee]}),ne=function(j){return j.label};function te(ee,j){var Y=ee.group;return{role:Y?"presentation":"option",id:"".concat(o,"_list_").concat(j)}}var ae=function(j){var Y=D[j];if(!Y)return null;var se=Y.data||{},J=se.value,ue=Y.group,oe=wo(se,!0),be=ne(Y);return Y?S.createElement("div",Ve({"aria-label":typeof be=="string"&&!ue?be:null},oe,{key:j},te(Y,j),{"aria-selected":B(J)}),J):null},re={role:"listbox",id:"".concat(o,"_list")};return S.createElement(S.Fragment,null,C&&S.createElement("div",Ve({},re,{style:{height:0,width:0,overflow:"hidden"}}),ae(z-1),ae(z),ae(z+1)),S.createElement(df,{itemKey:"key",ref:_,data:D,height:$,itemHeight:E,fullHeight:!1,onMouseDown:T,onScroll:f,virtual:C,direction:I,innerProps:C?null:re},function(ee,j){var Y=ee.group,se=ee.groupOption,J=ee.data,ue=ee.label,oe=ee.value,be=J.key;if(Y){var de,Ie=(de=J.title)!==null&&de!==void 0?de:Xy(ue)?ue.toString():void 0;return S.createElement("div",{className:ye(k,"".concat(k,"-group"),J.className),title:Ie},ue!==void 0?ue:be)}var ge=J.disabled,$e=J.title;J.children;var De=J.style,ve=J.className,we=In(J,pL),Re=Da(we,H),Ne=B(oe),Ke=ge||!Ne&&R,We="".concat(k,"-option"),ct=ye(k,We,ve,X(X(X(X({},"".concat(We,"-grouped"),se),"".concat(We,"-active"),z===j&&!Ke),"".concat(We,"-disabled"),Ke),"".concat(We,"-selected"),Ne)),Ee=ne(ee),lt=!b||typeof b=="function"||Ne,Xe=typeof Ee=="number"?Ee:Ee||oe,Le=Xy(Xe)?Xe.toString():void 0;return $e!==void 0&&(Le=$e),S.createElement("div",Ve({},wo(Re),C?{}:te(ee,j),{"aria-selected":Ne,className:ct,title:Le,onMouseMove:function(){z===j||Ke||W(j)},onClick:function(){Ke||q(oe)},style:De}),S.createElement("div",{className:"".concat(We,"-content")},typeof N=="function"?N(ee,{index:j}):Xe),S.isValidElement(b)||Ne,lt&&S.createElement(uf,{className:"".concat(k,"-option-state"),customizeIcon:b,customizeIconProps:{value:oe,disabled:Ke,isSelected:Ne}},Ne?"✓":null))}))},gL=S.forwardRef(mL);const vL=function(t,e){var n=S.useRef({values:new Map,options:new Map}),i=S.useMemo(function(){var o=n.current,r=o.values,a=o.options,l=t.map(function(d){if(d.label===void 0){var f;return me(me({},d),{},{label:(f=r.get(d.value))===null||f===void 0?void 0:f.label})}return d}),c=new Map,u=new Map;return l.forEach(function(d){c.set(d.value,d),u.set(d.value,e.get(d.value)||a.get(d.value))}),n.current.values=c,n.current.options=u,l},[t,e]),s=S.useCallback(function(o){return e.get(o)||n.current.options.get(o)},[e]);return[i,s]};function om(t,e){return DI(t).join("").toUpperCase().includes(e)}const xL=function(t,e,n,i,s){return S.useMemo(function(){if(!n||i===!1)return t;var o=e.options,r=e.label,a=e.value,l=[],c=typeof i=="function",u=n.toUpperCase(),d=c?i:function(h,p){return s?om(p[s],u):p[o]?om(p[r!=="children"?r:"label"],u):om(p[a],u)},f=c?function(h){return Qm(h)}:function(h){return h};return t.forEach(function(h){if(h[o]){var p=d(n,f(h));if(p)l.push(h);else{var m=h[o].filter(function(g){return d(n,f(g))});m.length&&l.push(me(me({},h),{},X({},o,m)))}return}d(n,f(h))&&l.push(h)}),l},[t,i,s,n,e])};var qy=0,bL=rv();function yL(){var t;return bL?(t=qy,qy+=1):t="TEST_OR_SSR",t}function wL(t){var e=S.useState(),n=ke(e,2),i=n[0],s=n[1];return S.useEffect(function(){s("rc_select_".concat(yL()))},[]),t||i}var CL=["children","value"],SL=["children"];function IL(t){var e=t,n=e.key,i=e.props,s=i.children,o=i.value,r=In(i,CL);return me({key:n,value:o!==void 0?o:n,children:s},r)}function OI(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return uv(t).map(function(n,i){if(!S.isValidElement(n)||!n.type)return null;var s=n,o=s.type.isSelectOptGroup,r=s.key,a=s.props,l=a.children,c=In(a,SL);return e||!o?IL(n):me(me({key:"__RC_SELECT_GRP__".concat(r===null?i:r,"__"),label:r},c),{},{options:OI(l)})}).filter(function(n){return n})}var $L=function(e,n,i,s,o){return S.useMemo(function(){var r=e,a=!e;a&&(r=OI(n));var l=new Map,c=new Map,u=function(h,p,m){m&&typeof m=="string"&&h.set(p[m],p)},d=function f(h){for(var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=0;m<h.length;m+=1){var g=h[m];!g[i.options]||p?(l.set(g[i.value],g),u(c,g,i.label),u(c,g,s),u(c,g,o)):f(g[i.options],!0)}};return d(r),{options:r,valueOptions:l,labelOptions:c}},[e,n,i,s,o])};function Yy(t){var e=S.useRef();e.current=t;var n=S.useCallback(function(){return e.current.apply(e,arguments)},[]);return n}var EL=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","labelRender","value","defaultValue","labelInValue","onChange","maxCount"],NL=["inputValue"];function kL(t){return!t||_n(t)!=="object"}var DL=S.forwardRef(function(t,e){var n=t.id,i=t.mode,s=t.prefixCls,o=s===void 0?"rc-select":s,r=t.backfill,a=t.fieldNames,l=t.inputValue,c=t.searchValue,u=t.onSearch,d=t.autoClearSearchValue,f=d===void 0?!0:d,h=t.onSelect,p=t.onDeselect,m=t.dropdownMatchSelectWidth,g=m===void 0?!0:m,v=t.filterOption,x=t.filterSort,b=t.optionFilterProp,w=t.optionLabelProp,y=t.options,C=t.optionRender,I=t.children,$=t.defaultActiveFirstOption,E=t.menuItemSelectedIcon,N=t.virtual,k=t.direction,D=t.listHeight,_=D===void 0?200:D,R=t.listItemHeight,T=R===void 0?20:R,A=t.labelRender,O=t.value,P=t.defaultValue,M=t.labelInValue,z=t.onChange,L=t.maxCount,W=In(t,EL),B=wL(n),q=eg(i),H=!!(!y&&I),ne=S.useMemo(function(){return v===void 0&&i==="combobox"?!1:v},[v,i]),te=S.useMemo(function(){return RI(a,H)},[JSON.stringify(a),H]),ae=Wo("",{value:c!==void 0?c:l,postState:function(ze){return ze||""}}),re=ke(ae,2),ee=re[0],j=re[1],Y=$L(y,I,te,b,w),se=Y.valueOptions,J=Y.labelOptions,ue=Y.options,oe=S.useCallback(function(Be){var ze=DI(Be);return ze.map(function(Oe){var qe,Dt,Rt,vn,Je;if(kL(Oe))qe=Oe;else{var dt;Rt=Oe.key,Dt=Oe.label,qe=(dt=Oe.value)!==null&&dt!==void 0?dt:Rt}var st=se.get(qe);if(st){var vt;Dt===void 0&&(Dt=st==null?void 0:st[w||te.label]),Rt===void 0&&(Rt=(vt=st==null?void 0:st.key)!==null&&vt!==void 0?vt:qe),vn=st==null?void 0:st.disabled,Je=st==null?void 0:st.title}return{label:Dt,value:qe,key:Rt,disabled:vn,title:Je}})},[te,w,se]),be=Wo(P,{value:O}),de=ke(be,2),Ie=de[0],ge=de[1],$e=S.useMemo(function(){var Be,ze=q&&Ie===null?[]:Ie,Oe=oe(ze);return i==="combobox"&&OF((Be=Oe[0])===null||Be===void 0?void 0:Be.value)?[]:Oe},[Ie,oe,i,q]),De=vL($e,se),ve=ke(De,2),we=ve[0],Re=ve[1],Ne=S.useMemo(function(){if(!i&&we.length===1){var Be=we[0];if(Be.value===null&&(Be.label===null||Be.label===void 0))return[]}return we.map(function(ze){var Oe;return me(me({},ze),{},{label:(Oe=typeof A=="function"?A(ze):ze.label)!==null&&Oe!==void 0?Oe:ze.value})})},[i,we,A]),Ke=S.useMemo(function(){return new Set(we.map(function(Be){return Be.value}))},[we]);S.useEffect(function(){if(i==="combobox"){var Be,ze=(Be=we[0])===null||Be===void 0?void 0:Be.value;j(AF(ze)?String(ze):"")}},[we]);var We=Yy(function(Be,ze){var Oe=ze??Be;return X(X({},te.value,Be),te.label,Oe)}),ct=S.useMemo(function(){if(i!=="tags")return ue;var Be=Ze(ue),ze=function(qe){return se.has(qe)};return Ze(we).sort(function(Oe,qe){return Oe.value<qe.value?-1:1}).forEach(function(Oe){var qe=Oe.value;ze(qe)||Be.push(We(qe,Oe.label))}),Be},[We,ue,se,we,i]),Ee=xL(ct,te,ee,ne,b),lt=S.useMemo(function(){return i!=="tags"||!ee||Ee.some(function(Be){return Be[b||"value"]===ee})||Ee.some(function(Be){return Be[te.value]===ee})?Ee:[We(ee)].concat(Ze(Ee))},[We,b,i,Ee,ee,te]),Xe=S.useMemo(function(){return x?Ze(lt).sort(function(Be,ze){return x(Be,ze,{searchValue:ee})}):lt},[lt,x,ee]),Le=S.useMemo(function(){return UF(Xe,{fieldNames:te,childrenAsData:H})},[Xe,te,H]),Pe=function(ze){var Oe=oe(ze);if(ge(Oe),z&&(Oe.length!==we.length||Oe.some(function(Rt,vn){var Je;return((Je=we[vn])===null||Je===void 0?void 0:Je.value)!==(Rt==null?void 0:Rt.value)}))){var qe=M?Oe:Oe.map(function(Rt){return Rt.value}),Dt=Oe.map(function(Rt){return Qm(Re(Rt.value))});z(q?qe:qe[0],q?Dt:Dt[0])}},ut=S.useState(null),ht=ke(ut,2),Pt=ht[0],ft=ht[1],Jn=S.useState(0),Ut=ke(Jn,2),vi=Ut[0],Mt=Ut[1],ki=$!==void 0?$:i!=="combobox",un=S.useCallback(function(Be,ze){var Oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},qe=Oe.source,Dt=qe===void 0?"keyboard":qe;Mt(ze),r&&i==="combobox"&&Be!==null&&Dt==="keyboard"&&ft(String(Be))},[r,i]),dn=function(ze,Oe,qe){var Dt=function(){var Xt,Ue=Re(ze);return[M?{label:Ue==null?void 0:Ue[te.label],value:ze,key:(Xt=Ue==null?void 0:Ue.key)!==null&&Xt!==void 0?Xt:ze}:ze,Qm(Ue)]};if(Oe&&h){var Rt=Dt(),vn=ke(Rt,2),Je=vn[0],dt=vn[1];h(Je,dt)}else if(!Oe&&p&&qe!=="clear"){var st=Dt(),vt=ke(st,2),Kt=vt[0],hn=vt[1];p(Kt,hn)}},gn=Yy(function(Be,ze){var Oe,qe=q?ze.selected:!0;qe?Oe=q?[].concat(Ze(we),[Be]):[Be]:Oe=we.filter(function(Dt){return Dt.value!==Be}),Pe(Oe),dn(Be,qe),i==="combobox"?ft(""):(!eg||f)&&(j(""),ft(""))}),Gn=function(ze,Oe){Pe(ze);var qe=Oe.type,Dt=Oe.values;(qe==="remove"||qe==="clear")&&Dt.forEach(function(Rt){dn(Rt.value,!1,qe)})},Tt=function(ze,Oe){if(j(ze),ft(null),Oe.source==="submit"){var qe=(ze||"").trim();if(qe){var Dt=Array.from(new Set([].concat(Ze(Ke),[qe])));Pe(Dt),dn(qe,!0),j("")}return}Oe.source!=="blur"&&(i==="combobox"&&Pe(ze),u==null||u(ze))},Yt=function(ze){var Oe=ze;i!=="tags"&&(Oe=ze.map(function(Dt){var Rt=J.get(Dt);return Rt==null?void 0:Rt.value}).filter(function(Dt){return Dt!==void 0}));var qe=Array.from(new Set([].concat(Ze(Ke),Ze(Oe))));Pe(qe),qe.forEach(function(Dt){dn(Dt,!0)})},jt=S.useMemo(function(){var Be=N!==!1&&g!==!1;return me(me({},Y),{},{flattenOptions:Le,onActiveValue:un,defaultActiveFirstOption:ki,onSelect:gn,menuItemSelectedIcon:E,rawValues:Ke,fieldNames:te,virtual:Be,direction:k,listHeight:_,listItemHeight:T,childrenAsData:H,maxCount:L,optionRender:C})},[L,Y,Le,un,ki,gn,E,Ke,te,N,g,k,_,T,H,C]);return S.createElement(Pv.Provider,{value:jt},S.createElement(YF,Ve({},W,{id:B,prefixCls:o,ref:e,omitDomProps:NL,mode:i,displayValues:Ne,onDisplayValuesChange:Gn,direction:k,searchValue:ee,onSearch:Tt,autoClearSearchValue:f,onSearchSplit:Yt,dropdownMatchSelectWidth:g,OptionList:gL,emptyOptions:!Le.length,activeValue:Pt,activeDescendantId:"".concat(B,"_list_").concat(vi)})))}),Lv=DL;Lv.Option=Fv;Lv.OptGroup=Mv;function gh(t,e,n){return ye({[`${t}-status-success`]:e==="success",[`${t}-status-warning`]:e==="warning",[`${t}-status-error`]:e==="error",[`${t}-status-validating`]:e==="validating",[`${t}-has-feedback`]:n})}const hf=(t,e)=>e||t,TL=()=>{const[,t]=Gl(),n=new Oo(t.colorBgBase).toHsl().l<.5?{opacity:.65}:{};return S.createElement("svg",{style:n,width:"184",height:"152",viewBox:"0 0 184 152",xmlns:"http://www.w3.org/2000/svg"},S.createElement("title",null,"empty image"),S.createElement("g",{fill:"none",fillRule:"evenodd"},S.createElement("g",{transform:"translate(24 31.67)"},S.createElement("ellipse",{fillOpacity:".8",fill:"#F5F5F7",cx:"67.797",cy:"106.89",rx:"67.797",ry:"12.668"}),S.createElement("path",{d:"M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z",fill:"#AEB8C2"}),S.createElement("path",{d:"M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z",fill:"url(#linearGradient-1)",transform:"translate(13.56)"}),S.createElement("path",{d:"M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z",fill:"#F5F5F7"}),S.createElement("path",{d:"M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z",fill:"#DCE0E6"})),S.createElement("path",{d:"M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z",fill:"#DCE0E6"}),S.createElement("g",{transform:"translate(149.65 15.383)",fill:"#FFF"},S.createElement("ellipse",{cx:"20.654",cy:"3.167",rx:"2.849",ry:"2.815"}),S.createElement("path",{d:"M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"}))))},RL=()=>{const[,t]=Gl(),{colorFill:e,colorFillTertiary:n,colorFillQuaternary:i,colorBgContainer:s}=t,{borderColor:o,shadowColor:r,contentColor:a}=S.useMemo(()=>({borderColor:new Oo(e).onBackground(s).toHexShortString(),shadowColor:new Oo(n).onBackground(s).toHexShortString(),contentColor:new Oo(i).onBackground(s).toHexShortString()}),[e,n,i,s]);return S.createElement("svg",{width:"64",height:"41",viewBox:"0 0 64 41",xmlns:"http://www.w3.org/2000/svg"},S.createElement("title",null,"Simple Empty"),S.createElement("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},S.createElement("ellipse",{fill:r,cx:"32",cy:"33",rx:"32",ry:"7"}),S.createElement("g",{fillRule:"nonzero",stroke:o},S.createElement("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),S.createElement("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",fill:a}))))},_L=t=>{const{componentCls:e,margin:n,marginXS:i,marginXL:s,fontSize:o,lineHeight:r}=t;return{[e]:{marginInline:i,fontSize:o,lineHeight:r,textAlign:"center",[`${e}-image`]:{height:t.emptyImgHeight,marginBottom:i,opacity:t.opacityImage,img:{height:"100%"},svg:{maxWidth:"100%",height:"100%",margin:"auto"}},[`${e}-description`]:{color:t.colorTextDescription},[`${e}-footer`]:{marginTop:n},"&-normal":{marginBlock:s,color:t.colorTextDescription,[`${e}-description`]:{color:t.colorTextDescription},[`${e}-image`]:{height:t.emptyImgHeightMD}},"&-small":{marginBlock:i,color:t.colorTextDescription,[`${e}-image`]:{height:t.emptyImgHeightSM}}}}},AL=Ys("Empty",t=>{const{componentCls:e,controlHeightLG:n,calc:i}=t,s=Si(t,{emptyImgCls:`${e}-img`,emptyImgHeight:i(n).mul(2.5).equal(),emptyImgHeightMD:n,emptyImgHeightSM:i(n).mul(.875).equal()});return[_L(s)]});var OL=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const PI=S.createElement(TL,null),MI=S.createElement(RL,null),Po=t=>{var{className:e,rootClassName:n,prefixCls:i,image:s=PI,description:o,children:r,imageStyle:a,style:l}=t,c=OL(t,["className","rootClassName","prefixCls","image","description","children","imageStyle","style"]);const{getPrefixCls:u,direction:d,empty:f}=S.useContext($n),h=u("empty",i),[p,m,g]=AL(h),[v]=S1("Empty"),x=typeof o<"u"?o:v==null?void 0:v.description,b=typeof x=="string"?x:"empty";let w=null;return typeof s=="string"?w=S.createElement("img",{alt:b,src:s}):w=s,p(S.createElement("div",Object.assign({className:ye(m,g,h,f==null?void 0:f.className,{[`${h}-normal`]:s===MI,[`${h}-rtl`]:d==="rtl"},e,n),style:Object.assign(Object.assign({},f==null?void 0:f.style),l)},c),S.createElement("div",{className:`${h}-image`,style:a},w),x&&S.createElement("div",{className:`${h}-description`},x),r&&S.createElement("div",{className:`${h}-footer`},r)))};Po.PRESENTED_IMAGE_DEFAULT=PI;Po.PRESENTED_IMAGE_SIMPLE=MI;const zv=t=>{const{componentName:e}=t,{getPrefixCls:n}=S.useContext($n),i=n("empty");switch(e){case"Table":case"List":return ce.createElement(Po,{image:Po.PRESENTED_IMAGE_SIMPLE});case"Select":case"TreeSelect":case"Cascader":case"Transfer":case"Mentions":return ce.createElement(Po,{image:Po.PRESENTED_IMAGE_SIMPLE,className:`${i}-small`});case"Table.filter":return null;default:return ce.createElement(Po,null)}},Bv=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;var i,s;const{variant:o,[t]:r}=S.useContext($n),a=S.useContext(k_),l=r==null?void 0:r.variant;let c;typeof e<"u"?c=e:n===!1?c="borderless":c=(s=(i=a??l)!==null&&i!==void 0?i:o)!==null&&s!==void 0?s:"outlined";const u=D_.includes(c);return[c,u]},PL=t=>{const n={overflow:{adjustX:!0,adjustY:!0,shiftY:!0},htmlRegion:t==="scroll"?"scroll":"visible",dynamicInset:!0};return{bottomLeft:Object.assign(Object.assign({},n),{points:["tl","bl"],offset:[0,4]}),bottomRight:Object.assign(Object.assign({},n),{points:["tr","br"],offset:[0,4]}),topLeft:Object.assign(Object.assign({},n),{points:["bl","tl"],offset:[0,-4]}),topRight:Object.assign(Object.assign({},n),{points:["br","tr"],offset:[0,-4]})}};function ML(t,e){return t||PL(e)}const Jy=t=>{const{optionHeight:e,optionFontSize:n,optionLineHeight:i,optionPadding:s}=t;return{position:"relative",display:"block",minHeight:e,padding:s,color:t.colorText,fontWeight:"normal",fontSize:n,lineHeight:i,boxSizing:"border-box"}},FL=t=>{const{antCls:e,componentCls:n}=t,i=`${n}-item`,s=`&${e}-slide-up-enter${e}-slide-up-enter-active`,o=`&${e}-slide-up-appear${e}-slide-up-appear-active`,r=`&${e}-slide-up-leave${e}-slide-up-leave-active`,a=`${n}-dropdown-placement-`;return[{[`${n}-dropdown`]:Object.assign(Object.assign({},os(t)),{position:"absolute",top:-9999,zIndex:t.zIndexPopup,boxSizing:"border-box",padding:t.paddingXXS,overflow:"hidden",fontSize:t.fontSize,fontVariant:"initial",backgroundColor:t.colorBgElevated,borderRadius:t.borderRadiusLG,outline:"none",boxShadow:t.boxShadowSecondary,[`
          ${s}${a}bottomLeft,
          ${o}${a}bottomLeft
        `]:{animationName:fA},[`
          ${s}${a}topLeft,
          ${o}${a}topLeft,
          ${s}${a}topRight,
          ${o}${a}topRight
        `]:{animationName:pA},[`${r}${a}bottomLeft`]:{animationName:mA},[`
          ${r}${a}topLeft,
          ${r}${a}topRight
        `]:{animationName:gA},"&-hidden":{display:"none"},[i]:Object.assign(Object.assign({},Jy(t)),{cursor:"pointer",transition:`background ${t.motionDurationSlow} ease`,borderRadius:t.borderRadiusSM,"&-group":{color:t.colorTextDescription,fontSize:t.fontSizeSM,cursor:"default"},"&-option":{display:"flex","&-content":Object.assign({flex:"auto"},dh),"&-state":{flex:"none",display:"flex",alignItems:"center"},[`&-active:not(${i}-option-disabled)`]:{backgroundColor:t.optionActiveBg},[`&-selected:not(${i}-option-disabled)`]:{color:t.optionSelectedColor,fontWeight:t.optionSelectedFontWeight,backgroundColor:t.optionSelectedBg,[`${i}-option-state`]:{color:t.colorPrimary},[`&:has(+ ${i}-option-selected:not(${i}-option-disabled))`]:{borderEndStartRadius:0,borderEndEndRadius:0,[`& + ${i}-option-selected:not(${i}-option-disabled)`]:{borderStartStartRadius:0,borderStartEndRadius:0}}},"&-disabled":{[`&${i}-option-selected`]:{backgroundColor:t.colorBgContainerDisabled},color:t.colorTextDisabled,cursor:"not-allowed"},"&-grouped":{paddingInlineStart:t.calc(t.controlPaddingHorizontal).mul(2).equal()}},"&-empty":Object.assign(Object.assign({},Jy(t)),{color:t.colorTextDisabled})}),"&-rtl":{direction:"rtl"}})},wy(t,"slide-up"),wy(t,"slide-down"),Cy(t,"move-up"),Cy(t,"move-down")]},LL=t=>{const{multipleSelectItemHeight:e,paddingXXS:n,lineWidth:i,INTERNAL_FIXED_ITEM_MARGIN:s}=t,o=t.max(t.calc(n).sub(i).equal(),0),r=t.max(t.calc(o).sub(s).equal(),0);return{basePadding:o,containerPadding:r,itemHeight:he(e),itemLineHeight:he(t.calc(e).sub(t.calc(t.lineWidth).mul(2)).equal())}},zL=t=>{const{multipleSelectItemHeight:e,selectHeight:n,lineWidth:i}=t;return t.calc(n).sub(e).div(2).sub(i).equal()},BL=t=>{const{componentCls:e,iconCls:n,borderRadiusSM:i,motionDurationSlow:s,paddingXS:o,multipleItemColorDisabled:r,multipleItemBorderColorDisabled:a,colorIcon:l,colorIconHover:c,INTERNAL_FIXED_ITEM_MARGIN:u}=t;return{[`${e}-selection-overflow`]:{position:"relative",display:"flex",flex:"auto",flexWrap:"wrap",maxWidth:"100%","&-item":{flex:"none",alignSelf:"center",maxWidth:"100%",display:"inline-flex"},[`${e}-selection-item`]:{display:"flex",alignSelf:"center",flex:"none",boxSizing:"border-box",maxWidth:"100%",marginBlock:u,borderRadius:i,cursor:"default",transition:`font-size ${s}, line-height ${s}, height ${s}`,marginInlineEnd:t.calc(u).mul(2).equal(),paddingInlineStart:o,paddingInlineEnd:t.calc(o).div(2).equal(),[`${e}-disabled&`]:{color:r,borderColor:a,cursor:"not-allowed"},"&-content":{display:"inline-block",marginInlineEnd:t.calc(o).div(2).equal(),overflow:"hidden",whiteSpace:"pre",textOverflow:"ellipsis"},"&-remove":Object.assign(Object.assign({},u1()),{display:"inline-flex",alignItems:"center",color:l,fontWeight:"bold",fontSize:10,lineHeight:"inherit",cursor:"pointer",[`> ${n}`]:{verticalAlign:"-0.2em"},"&:hover":{color:c}})}}}},VL=(t,e)=>{const{componentCls:n,INTERNAL_FIXED_ITEM_MARGIN:i}=t,s=`${n}-selection-overflow`,o=t.multipleSelectItemHeight,r=zL(t),a=e?`${n}-${e}`:"",l=LL(t);return{[`${n}-multiple${a}`]:Object.assign(Object.assign({},BL(t)),{[`${n}-selector`]:{display:"flex",flexWrap:"wrap",alignItems:"center",height:"100%",paddingInline:l.basePadding,paddingBlock:l.containerPadding,borderRadius:t.borderRadius,[`${n}-disabled&`]:{background:t.multipleSelectorBgDisabled,cursor:"not-allowed"},"&:after":{display:"inline-block",width:0,margin:`${he(i)} 0`,lineHeight:he(o),visibility:"hidden",content:'"\\a0"'}},[`${n}-selection-item`]:{height:l.itemHeight,lineHeight:he(l.itemLineHeight)},[`${s}-item + ${s}-item`]:{[`${n}-selection-search`]:{marginInlineStart:0}},[`${s}-item-suffix`]:{height:"100%"},[`${n}-selection-search`]:{display:"inline-flex",position:"relative",maxWidth:"100%",marginInlineStart:t.calc(t.inputPaddingHorizontalBase).sub(r).equal(),"\n          &-input,\n          &-mirror\n        ":{height:o,fontFamily:t.fontFamily,lineHeight:he(o),transition:`all ${t.motionDurationSlow}`},"&-input":{width:"100%",minWidth:4.1},"&-mirror":{position:"absolute",top:0,insetInlineStart:0,insetInlineEnd:"auto",zIndex:999,whiteSpace:"pre",visibility:"hidden"}},[`${n}-selection-placeholder`]:{position:"absolute",top:"50%",insetInlineStart:t.inputPaddingHorizontalBase,insetInlineEnd:t.inputPaddingHorizontalBase,transform:"translateY(-50%)",transition:`all ${t.motionDurationSlow}`}})}};function rm(t,e){const{componentCls:n}=t,i=e?`${n}-${e}`:"",s={[`${n}-multiple${i}`]:{fontSize:t.fontSize,[`${n}-selector`]:{[`${n}-show-search&`]:{cursor:"text"}},[`
        &${n}-show-arrow ${n}-selector,
        &${n}-allow-clear ${n}-selector
      `]:{paddingInlineEnd:t.calc(t.fontSizeIcon).add(t.controlPaddingHorizontal).equal()}}};return[VL(t,e),s]}const WL=t=>{const{componentCls:e}=t,n=Si(t,{selectHeight:t.controlHeightSM,multipleSelectItemHeight:t.multipleItemHeightSM,borderRadius:t.borderRadiusSM,borderRadiusSM:t.borderRadiusXS}),i=Si(t,{fontSize:t.fontSizeLG,selectHeight:t.controlHeightLG,multipleSelectItemHeight:t.multipleItemHeightLG,borderRadius:t.borderRadiusLG,borderRadiusSM:t.borderRadius});return[rm(t),rm(n,"sm"),{[`${e}-multiple${e}-sm`]:{[`${e}-selection-placeholder`]:{insetInline:t.calc(t.controlPaddingHorizontalSM).sub(t.lineWidth).equal()},[`${e}-selection-search`]:{marginInlineStart:2}}},rm(i,"lg")]};function am(t,e){const{componentCls:n,inputPaddingHorizontalBase:i,borderRadius:s}=t,o=t.calc(t.controlHeight).sub(t.calc(t.lineWidth).mul(2)).equal(),r=e?`${n}-${e}`:"";return{[`${n}-single${r}`]:{fontSize:t.fontSize,height:t.controlHeight,[`${n}-selector`]:Object.assign(Object.assign({},os(t,!0)),{display:"flex",borderRadius:s,[`${n}-selection-search`]:{position:"absolute",top:0,insetInlineStart:i,insetInlineEnd:i,bottom:0,"&-input":{width:"100%",WebkitAppearance:"textfield"}},[`
          ${n}-selection-item,
          ${n}-selection-placeholder
        `]:{padding:0,lineHeight:he(o),transition:`all ${t.motionDurationSlow}, visibility 0s`,alignSelf:"center"},[`${n}-selection-placeholder`]:{transition:"none",pointerEvents:"none"},[["&:after",`${n}-selection-item:empty:after`,`${n}-selection-placeholder:empty:after`].join(",")]:{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'}}),[`
        &${n}-show-arrow ${n}-selection-item,
        &${n}-show-arrow ${n}-selection-placeholder
      `]:{paddingInlineEnd:t.showArrowPaddingInlineEnd},[`&${n}-open ${n}-selection-item`]:{color:t.colorTextPlaceholder},[`&:not(${n}-customize-input)`]:{[`${n}-selector`]:{width:"100%",height:"100%",padding:`0 ${he(i)}`,[`${n}-selection-search-input`]:{height:o},"&:after":{lineHeight:he(o)}}},[`&${n}-customize-input`]:{[`${n}-selector`]:{"&:after":{display:"none"},[`${n}-selection-search`]:{position:"static",width:"100%"},[`${n}-selection-placeholder`]:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,padding:`0 ${he(i)}`,"&:after":{display:"none"}}}}}}}function GL(t){const{componentCls:e}=t,n=t.calc(t.controlPaddingHorizontalSM).sub(t.lineWidth).equal();return[am(t),am(Si(t,{controlHeight:t.controlHeightSM,borderRadius:t.borderRadiusSM}),"sm"),{[`${e}-single${e}-sm`]:{[`&:not(${e}-customize-input)`]:{[`${e}-selection-search`]:{insetInlineStart:n,insetInlineEnd:n},[`${e}-selector`]:{padding:`0 ${he(n)}`},[`&${e}-show-arrow ${e}-selection-search`]:{insetInlineEnd:t.calc(n).add(t.calc(t.fontSize).mul(1.5)).equal()},[`
            &${e}-show-arrow ${e}-selection-item,
            &${e}-show-arrow ${e}-selection-placeholder
          `]:{paddingInlineEnd:t.calc(t.fontSize).mul(1.5).equal()}}}},am(Si(t,{controlHeight:t.singleItemHeightLG,fontSize:t.fontSizeLG,borderRadius:t.borderRadiusLG}),"lg")]}const HL=t=>{const{fontSize:e,lineHeight:n,lineWidth:i,controlHeight:s,controlHeightSM:o,controlHeightLG:r,paddingXXS:a,controlPaddingHorizontal:l,zIndexPopupBase:c,colorText:u,fontWeightStrong:d,controlItemBgActive:f,controlItemBgHover:h,colorBgContainer:p,colorFillSecondary:m,colorBgContainerDisabled:g,colorTextDisabled:v}=t,x=a*2,b=i*2,w=Math.min(s-x,s-b),y=Math.min(o-x,o-b),C=Math.min(r-x,r-b);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(a/2),zIndexPopup:c+50,optionSelectedColor:u,optionSelectedFontWeight:d,optionSelectedBg:f,optionActiveBg:h,optionPadding:`${(s-e*n)/2}px ${l}px`,optionFontSize:e,optionLineHeight:n,optionHeight:s,selectorBg:p,clearBg:p,singleItemHeightLG:r,multipleItemBg:m,multipleItemBorderColor:"transparent",multipleItemHeight:w,multipleItemHeightSM:y,multipleItemHeightLG:C,multipleSelectorBgDisabled:g,multipleItemColorDisabled:v,multipleItemBorderColorDisabled:"transparent",showArrowPaddingInlineEnd:Math.ceil(t.fontSize*1.25)}},FI=(t,e)=>{const{componentCls:n,antCls:i,controlOutlineWidth:s}=t;return{[`&:not(${n}-customize-input) ${n}-selector`]:{border:`${he(t.lineWidth)} ${t.lineType} ${e.borderColor}`,background:t.selectorBg},[`&:not(${n}-disabled):not(${n}-customize-input):not(${i}-pagination-size-changer)`]:{[`&:hover ${n}-selector`]:{borderColor:e.hoverBorderHover},[`${n}-focused& ${n}-selector`]:{borderColor:e.activeBorderColor,boxShadow:`0 0 0 ${he(s)} ${e.activeShadowColor}`,outline:0}}}},Zy=(t,e)=>({[`&${t.componentCls}-status-${e.status}`]:Object.assign({},FI(t,e))}),UL=t=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign({},FI(t,{borderColor:t.colorBorder,hoverBorderHover:t.colorPrimaryHover,activeBorderColor:t.colorPrimary,activeShadowColor:t.controlOutline})),Zy(t,{status:"error",borderColor:t.colorError,hoverBorderHover:t.colorErrorHover,activeBorderColor:t.colorError,activeShadowColor:t.colorErrorOutline})),Zy(t,{status:"warning",borderColor:t.colorWarning,hoverBorderHover:t.colorWarningHover,activeBorderColor:t.colorWarning,activeShadowColor:t.colorWarningOutline})),{[`&${t.componentCls}-disabled`]:{[`&:not(${t.componentCls}-customize-input) ${t.componentCls}-selector`]:{background:t.colorBgContainerDisabled,color:t.colorTextDisabled}},[`&${t.componentCls}-multiple ${t.componentCls}-selection-item`]:{background:t.multipleItemBg,border:`${he(t.lineWidth)} ${t.lineType} ${t.multipleItemBorderColor}`}})}),LI=(t,e)=>{const{componentCls:n,antCls:i}=t;return{[`&:not(${n}-customize-input) ${n}-selector`]:{background:e.bg,border:`${he(t.lineWidth)} ${t.lineType} transparent`,color:e.color},[`&:not(${n}-disabled):not(${n}-customize-input):not(${i}-pagination-size-changer)`]:{[`&:hover ${n}-selector`]:{background:e.hoverBg},[`${n}-focused& ${n}-selector`]:{background:t.selectorBg,borderColor:e.activeBorderColor,outline:0}}}},Qy=(t,e)=>({[`&${t.componentCls}-status-${e.status}`]:Object.assign({},LI(t,e))}),jL=t=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign({},LI(t,{bg:t.colorFillTertiary,hoverBg:t.colorFillSecondary,activeBorderColor:t.colorPrimary,color:t.colorText})),Qy(t,{status:"error",bg:t.colorErrorBg,hoverBg:t.colorErrorBgHover,activeBorderColor:t.colorError,color:t.colorError})),Qy(t,{status:"warning",bg:t.colorWarningBg,hoverBg:t.colorWarningBgHover,activeBorderColor:t.colorWarning,color:t.colorWarning})),{[`&${t.componentCls}-disabled`]:{[`&:not(${t.componentCls}-customize-input) ${t.componentCls}-selector`]:{borderColor:t.colorBorder,background:t.colorBgContainerDisabled,color:t.colorTextDisabled}},[`&${t.componentCls}-multiple ${t.componentCls}-selection-item`]:{background:t.colorBgContainer,border:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`}})}),KL=t=>({"&-borderless":{[`${t.componentCls}-selector`]:{background:"transparent",borderColor:"transparent"},[`&${t.componentCls}-disabled`]:{[`&:not(${t.componentCls}-customize-input) ${t.componentCls}-selector`]:{color:t.colorTextDisabled}},[`&${t.componentCls}-multiple ${t.componentCls}-selection-item`]:{background:t.multipleItemBg,border:`${he(t.lineWidth)} ${t.lineType} ${t.multipleItemBorderColor}`},[`&${t.componentCls}-status-error`]:{[`${t.componentCls}-selection-item`]:{color:t.colorError}},[`&${t.componentCls}-status-warning`]:{[`${t.componentCls}-selection-item`]:{color:t.colorWarning}}}}),XL=t=>({[t.componentCls]:Object.assign(Object.assign(Object.assign({},UL(t)),jL(t)),KL(t))}),qL=t=>{const{componentCls:e}=t;return{position:"relative",transition:`all ${t.motionDurationMid} ${t.motionEaseInOut}`,input:{cursor:"pointer"},[`${e}-show-search&`]:{cursor:"text",input:{cursor:"auto",color:"inherit",height:"100%"}},[`${e}-disabled&`]:{cursor:"not-allowed",input:{cursor:"not-allowed"}}}},YL=t=>{const{componentCls:e}=t;return{[`${e}-selection-search-input`]:{margin:0,padding:0,background:"transparent",border:"none",outline:"none",appearance:"none",fontFamily:"inherit","&::-webkit-search-cancel-button":{display:"none","-webkit-appearance":"none"}}}},JL=t=>{const{antCls:e,componentCls:n,inputPaddingHorizontalBase:i,iconCls:s}=t;return{[n]:Object.assign(Object.assign({},os(t)),{position:"relative",display:"inline-block",cursor:"pointer",[`&:not(${n}-customize-input) ${n}-selector`]:Object.assign(Object.assign({},qL(t)),YL(t)),[`${n}-selection-item`]:Object.assign(Object.assign({flex:1,fontWeight:"normal",position:"relative",userSelect:"none"},dh),{[`> ${e}-typography`]:{display:"inline"}}),[`${n}-selection-placeholder`]:Object.assign(Object.assign({},dh),{flex:1,color:t.colorTextPlaceholder,pointerEvents:"none"}),[`${n}-arrow`]:Object.assign(Object.assign({},u1()),{position:"absolute",top:"50%",insetInlineStart:"auto",insetInlineEnd:i,height:t.fontSizeIcon,marginTop:t.calc(t.fontSizeIcon).mul(-1).div(2).equal(),color:t.colorTextQuaternary,fontSize:t.fontSizeIcon,lineHeight:1,textAlign:"center",pointerEvents:"none",display:"flex",alignItems:"center",transition:`opacity ${t.motionDurationSlow} ease`,[s]:{verticalAlign:"top",transition:`transform ${t.motionDurationSlow}`,"> svg":{verticalAlign:"top"},[`&:not(${n}-suffix)`]:{pointerEvents:"auto"}},[`${n}-disabled &`]:{cursor:"not-allowed"},"> *:not(:last-child)":{marginInlineEnd:8}}),[`${n}-clear`]:{position:"absolute",top:"50%",insetInlineStart:"auto",insetInlineEnd:i,zIndex:1,display:"inline-block",width:t.fontSizeIcon,height:t.fontSizeIcon,marginTop:t.calc(t.fontSizeIcon).mul(-1).div(2).equal(),color:t.colorTextQuaternary,fontSize:t.fontSizeIcon,fontStyle:"normal",lineHeight:1,textAlign:"center",textTransform:"none",cursor:"pointer",opacity:0,transition:`color ${t.motionDurationMid} ease, opacity ${t.motionDurationSlow} ease`,textRendering:"auto","&:before":{display:"block"},"&:hover":{color:t.colorTextTertiary}},[`&:hover ${n}-clear`]:{opacity:1,background:t.colorBgBase}}),[`${n}-has-feedback`]:{[`${n}-clear`]:{insetInlineEnd:t.calc(i).add(t.fontSize).add(t.paddingXS).equal()}}}},ZL=t=>{const{componentCls:e}=t;return[{[e]:{[`&${e}-in-form-item`]:{width:"100%"}}},JL(t),GL(t),WL(t),FL(t),{[`${e}-rtl`]:{direction:"rtl"}},d1(t,{borderElCls:`${e}-selector`,focusElCls:`${e}-focused`})]},QL=Ys("Select",(t,e)=>{let{rootPrefixCls:n}=e;const i=Si(t,{rootPrefixCls:n,inputPaddingHorizontalBase:t.calc(t.paddingSM).sub(1).equal(),multipleSelectItemHeight:t.multipleItemHeight,selectHeight:t.controlHeight});return[ZL(i),XL(i)]},HL,{unitless:{optionLineHeight:!0,optionSelectedFontWeight:!0}});var ez={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"},tz=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:ez}))},nz=S.forwardRef(tz),iz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"}}]},name:"down",theme:"outlined"},sz=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:iz}))},zI=S.forwardRef(sz),oz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},rz=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:oz}))},Vv=S.forwardRef(rz);function az(t){let{suffixIcon:e,clearIcon:n,menuItemSelectedIcon:i,removeIcon:s,loading:o,multiple:r,hasFeedback:a,prefixCls:l,showSuffixIcon:c,feedbackIcon:u,showArrow:d,componentName:f}=t;const h=n??S.createElement(b1,null),p=x=>e===null&&!a&&!d?null:S.createElement(S.Fragment,null,c!==!1&&x,a&&u);let m=null;if(e!==void 0)m=p(e);else if(o)m=p(S.createElement(h1,{spin:!0}));else{const x=`${l}-suffix`;m=b=>{let{open:w,showSearch:y}=b;return p(w&&y?S.createElement(Vv,{className:x}):S.createElement(zI,{className:x}))}}let g=null;i!==void 0?g=i:r?g=S.createElement(nz,null):g=null;let v=null;return s!==void 0?v=s:v=S.createElement(dv,null),{clearIcon:h,suffixIcon:m,itemIcon:g,removeIcon:v}}function lz(t,e){return e!==void 0?e:t!==null}var cz=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const BI="SECRET_COMBOBOX_MODE_DO_NOT_USE",uz=(t,e)=>{var n;const{prefixCls:i,bordered:s,className:o,rootClassName:r,getPopupContainer:a,popupClassName:l,dropdownClassName:c,listHeight:u=256,placement:d,listItemHeight:f,size:h,disabled:p,notFoundContent:m,status:g,builtinPlacements:v,dropdownMatchSelectWidth:x,popupMatchSelectWidth:b,direction:w,style:y,allowClear:C,variant:I,dropdownStyle:$,transitionName:E,tagRender:N,maxCount:k}=t,D=cz(t,["prefixCls","bordered","className","rootClassName","getPopupContainer","popupClassName","dropdownClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","direction","style","allowClear","variant","dropdownStyle","transitionName","tagRender","maxCount"]),{getPopupContainer:_,getPrefixCls:R,renderEmpty:T,direction:A,virtual:O,popupMatchSelectWidth:P,popupOverflow:M,select:z}=S.useContext($n),[,L]=Gl(),W=f??(L==null?void 0:L.controlHeight),B=R("select",i),q=R(),H=w??A,{compactSize:ne,compactItemClassnames:te}=hv(B,H),[ae,re]=Bv("select",I,s),ee=Ta(B),[j,Y,se]=QL(B,ee),J=S.useMemo(()=>{const{mode:Pt}=t;if(Pt!=="combobox")return Pt===BI?"combobox":Pt},[t.mode]),ue=J==="multiple"||J==="tags",oe=lz(t.suffixIcon,t.showArrow),be=(n=b??x)!==null&&n!==void 0?n:P,{status:de,hasFeedback:Ie,isFormItemInput:ge,feedbackIcon:$e}=S.useContext(br),De=hf(de,g);let ve;m!==void 0?ve=m:J==="combobox"?ve=null:ve=(T==null?void 0:T("Select"))||S.createElement(zv,{componentName:"Select"});const{suffixIcon:we,itemIcon:Re,removeIcon:Ne,clearIcon:Ke}=az(Object.assign(Object.assign({},D),{multiple:ue,hasFeedback:Ie,feedbackIcon:$e,showSuffixIcon:oe,prefixCls:B,componentName:"Select"})),We=C===!0?{clearIcon:Ke}:C,ct=Da(D,["suffixIcon","itemIcon"]),Ee=ye(l||c,{[`${B}-dropdown-${H}`]:H==="rtl"},r,se,ee,Y),lt=kr(Pt=>{var ft;return(ft=h??ne)!==null&&ft!==void 0?ft:Pt}),Xe=S.useContext(sf),Le=p??Xe,Pe=ye({[`${B}-lg`]:lt==="large",[`${B}-sm`]:lt==="small",[`${B}-rtl`]:H==="rtl",[`${B}-${ae}`]:re,[`${B}-in-form-item`]:ge},gh(B,De,Ie),te,z==null?void 0:z.className,o,r,se,ee,Y),ut=S.useMemo(()=>d!==void 0?d:H==="rtl"?"bottomRight":"bottomLeft",[d,H]),[ht]=T_("SelectLike",$==null?void 0:$.zIndex);return j(S.createElement(Lv,Object.assign({ref:e,virtual:O,showSearch:z==null?void 0:z.showSearch},ct,{style:Object.assign(Object.assign({},z==null?void 0:z.style),y),dropdownMatchSelectWidth:be,transitionName:R_(q,"slide-up",E),builtinPlacements:ML(v,M),listHeight:u,listItemHeight:W,mode:J,prefixCls:B,placement:ut,direction:H,suffixIcon:we,menuItemSelectedIcon:Re,removeIcon:Ne,allowClear:We,notFoundContent:ve,className:Pe,getPopupContainer:a||_,dropdownClassName:Ee,disabled:Le,dropdownStyle:Object.assign(Object.assign({},$),{zIndex:ht}),maxCount:ue?k:void 0,tagRender:ue?N:void 0})))},Jo=S.forwardRef(uz),dz=vA(Jo);Jo.SECRET_COMBOBOX_MODE_DO_NOT_USE=BI;Jo.Option=Fv;Jo.OptGroup=Mv;Jo._InternalPanelDoNotUseOrYouWillBeFired=dz;var hz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"},fz=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:hz}))},ew=S.forwardRef(fz);function Wv(t){return Si(t,{inputAffixPadding:t.paddingXXS})}const Gv=t=>{const{controlHeight:e,fontSize:n,lineHeight:i,lineWidth:s,controlHeightSM:o,controlHeightLG:r,fontSizeLG:a,lineHeightLG:l,paddingSM:c,controlPaddingHorizontalSM:u,controlPaddingHorizontal:d,colorFillAlter:f,colorPrimaryHover:h,colorPrimary:p,controlOutlineWidth:m,controlOutline:g,colorErrorOutline:v,colorWarningOutline:x,colorBgContainer:b}=t;return{paddingBlock:Math.max(Math.round((e-n*i)/2*10)/10-s,0),paddingBlockSM:Math.max(Math.round((o-n*i)/2*10)/10-s,0),paddingBlockLG:Math.ceil((r-a*l)/2*10)/10-s,paddingInline:c-s,paddingInlineSM:u-s,paddingInlineLG:d-s,addonBg:f,activeBorderColor:p,hoverBorderColor:h,activeShadow:`0 0 0 ${m}px ${g}`,errorActiveShadow:`0 0 0 ${m}px ${v}`,warningActiveShadow:`0 0 0 ${m}px ${x}`,hoverBg:b,activeBg:b,inputFontSize:n,inputFontSizeLG:a,inputFontSizeSM:n}},pz=t=>({borderColor:t.hoverBorderColor,backgroundColor:t.hoverBg}),ff=t=>({color:t.colorTextDisabled,backgroundColor:t.colorBgContainerDisabled,borderColor:t.colorBorder,boxShadow:"none",cursor:"not-allowed",opacity:1,"input[disabled], textarea[disabled]":{cursor:"not-allowed"},"&:hover:not([disabled])":Object.assign({},pz(Si(t,{hoverBorderColor:t.colorBorder,hoverBg:t.colorBgContainerDisabled})))}),Hv=(t,e)=>({background:t.colorBgContainer,borderWidth:t.lineWidth,borderStyle:t.lineType,borderColor:e.borderColor,"&:hover":{borderColor:e.hoverBorderColor,backgroundColor:t.hoverBg},"&:focus, &:focus-within":{borderColor:e.activeBorderColor,boxShadow:e.activeShadow,outline:0,backgroundColor:t.activeBg}}),tw=(t,e)=>({[`&${t.componentCls}-status-${e.status}:not(${t.componentCls}-disabled)`]:Object.assign(Object.assign({},Hv(t,e)),{[`${t.componentCls}-prefix, ${t.componentCls}-suffix`]:{color:e.affixColor}}),[`&${t.componentCls}-status-${e.status}${t.componentCls}-disabled`]:{borderColor:e.borderColor}}),mz=(t,e)=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Hv(t,{borderColor:t.colorBorder,hoverBorderColor:t.hoverBorderColor,activeBorderColor:t.activeBorderColor,activeShadow:t.activeShadow})),{[`&${t.componentCls}-disabled, &[disabled]`]:Object.assign({},ff(t))}),tw(t,{status:"error",borderColor:t.colorError,hoverBorderColor:t.colorErrorBorderHover,activeBorderColor:t.colorError,activeShadow:t.errorActiveShadow,affixColor:t.colorError})),tw(t,{status:"warning",borderColor:t.colorWarning,hoverBorderColor:t.colorWarningBorderHover,activeBorderColor:t.colorWarning,activeShadow:t.warningActiveShadow,affixColor:t.colorWarning})),e)}),nw=(t,e)=>({[`&${t.componentCls}-group-wrapper-status-${e.status}`]:{[`${t.componentCls}-group-addon`]:{borderColor:e.addonBorderColor,color:e.addonColor}}}),gz=t=>({"&-outlined":Object.assign(Object.assign(Object.assign({[`${t.componentCls}-group`]:{"&-addon":{background:t.addonBg,border:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`},"&-addon:first-child":{borderInlineEnd:0},"&-addon:last-child":{borderInlineStart:0}}},nw(t,{status:"error",addonBorderColor:t.colorError,addonColor:t.colorErrorText})),nw(t,{status:"warning",addonBorderColor:t.colorWarning,addonColor:t.colorWarningText})),{[`&${t.componentCls}-group-wrapper-disabled`]:{[`${t.componentCls}-group-addon`]:Object.assign({},ff(t))}})}),vz=(t,e)=>{const{componentCls:n}=t;return{"&-borderless":Object.assign({background:"transparent",border:"none","&:focus, &:focus-within":{outline:"none"},[`&${n}-disabled, &[disabled]`]:{color:t.colorTextDisabled},[`&${n}-status-error`]:{"&, & input, & textarea":{color:t.colorError}},[`&${n}-status-warning`]:{"&, & input, & textarea":{color:t.colorWarning}}},e)}},VI=(t,e)=>({background:e.bg,borderWidth:t.lineWidth,borderStyle:t.lineType,borderColor:"transparent","input&, & input, textarea&, & textarea":{color:e==null?void 0:e.inputColor},"&:hover":{background:e.hoverBg},"&:focus, &:focus-within":{outline:0,borderColor:e.activeBorderColor,backgroundColor:t.activeBg}}),iw=(t,e)=>({[`&${t.componentCls}-status-${e.status}:not(${t.componentCls}-disabled)`]:Object.assign(Object.assign({},VI(t,e)),{[`${t.componentCls}-prefix, ${t.componentCls}-suffix`]:{color:e.affixColor}})}),xz=(t,e)=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VI(t,{bg:t.colorFillTertiary,hoverBg:t.colorFillSecondary,activeBorderColor:t.activeBorderColor})),{[`&${t.componentCls}-disabled, &[disabled]`]:Object.assign({},ff(t))}),iw(t,{status:"error",bg:t.colorErrorBg,hoverBg:t.colorErrorBgHover,activeBorderColor:t.colorError,inputColor:t.colorErrorText,affixColor:t.colorError})),iw(t,{status:"warning",bg:t.colorWarningBg,hoverBg:t.colorWarningBgHover,activeBorderColor:t.colorWarning,inputColor:t.colorWarningText,affixColor:t.colorWarning})),e)}),sw=(t,e)=>({[`&${t.componentCls}-group-wrapper-status-${e.status}`]:{[`${t.componentCls}-group-addon`]:{background:e.addonBg,color:e.addonColor}}}),bz=t=>({"&-filled":Object.assign(Object.assign(Object.assign({[`${t.componentCls}-group`]:{"&-addon":{background:t.colorFillTertiary},[`${t.componentCls}-filled:not(:focus):not(:focus-within)`]:{"&:not(:first-child)":{borderInlineStart:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},"&:not(:last-child)":{borderInlineEnd:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`}}}},sw(t,{status:"error",addonBg:t.colorErrorBg,addonColor:t.colorErrorText})),sw(t,{status:"warning",addonBg:t.colorWarningBg,addonColor:t.colorWarningText})),{[`&${t.componentCls}-group-wrapper-disabled`]:{[`${t.componentCls}-group`]:{"&-addon":{background:t.colorFillTertiary,color:t.colorTextDisabled},"&-addon:first-child":{borderInlineStart:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderTop:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderBottom:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`},"&-addon:last-child":{borderInlineEnd:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderTop:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderBottom:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`}}}})}),yz=t=>({"&::-moz-placeholder":{opacity:1},"&::placeholder":{color:t,userSelect:"none"},"&:placeholder-shown":{textOverflow:"ellipsis"}}),WI=t=>{const{paddingBlockLG:e,lineHeightLG:n,borderRadiusLG:i,paddingInlineLG:s}=t;return{padding:`${he(e)} ${he(s)}`,fontSize:t.inputFontSizeLG,lineHeight:n,borderRadius:i}},Uv=t=>({padding:`${he(t.paddingBlockSM)} ${he(t.paddingInlineSM)}`,fontSize:t.inputFontSizeSM,borderRadius:t.borderRadiusSM}),jv=t=>Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",minWidth:0,padding:`${he(t.paddingBlock)} ${he(t.paddingInline)}`,color:t.colorText,fontSize:t.inputFontSize,lineHeight:t.lineHeight,borderRadius:t.borderRadius,transition:`all ${t.motionDurationMid}`},yz(t.colorTextPlaceholder)),{"textarea&":{maxWidth:"100%",height:"auto",minHeight:t.controlHeight,lineHeight:t.lineHeight,verticalAlign:"bottom",transition:`all ${t.motionDurationSlow}, height 0s`,resize:"vertical"},"&-lg":Object.assign({},WI(t)),"&-sm":Object.assign({},Uv(t)),"&-rtl, &-textarea-rtl":{direction:"rtl"}}),wz=t=>{const{componentCls:e,antCls:n}=t;return{position:"relative",display:"table",width:"100%",borderCollapse:"separate",borderSpacing:0,"&[class*='col-']":{paddingInlineEnd:t.paddingXS,"&:last-child":{paddingInlineEnd:0}},[`&-lg ${e}, &-lg > ${e}-group-addon`]:Object.assign({},WI(t)),[`&-sm ${e}, &-sm > ${e}-group-addon`]:Object.assign({},Uv(t)),[`&-lg ${n}-select-single ${n}-select-selector`]:{height:t.controlHeightLG},[`&-sm ${n}-select-single ${n}-select-selector`]:{height:t.controlHeightSM},[`> ${e}`]:{display:"table-cell","&:not(:first-child):not(:last-child)":{borderRadius:0}},[`${e}-group`]:{"&-addon, &-wrap":{display:"table-cell",width:1,whiteSpace:"nowrap",verticalAlign:"middle","&:not(:first-child):not(:last-child)":{borderRadius:0}},"&-wrap > *":{display:"block !important"},"&-addon":{position:"relative",padding:`0 ${he(t.paddingInline)}`,color:t.colorText,fontWeight:"normal",fontSize:t.inputFontSize,textAlign:"center",borderRadius:t.borderRadius,transition:`all ${t.motionDurationSlow}`,lineHeight:1,[`${n}-select`]:{margin:`${he(t.calc(t.paddingBlock).add(1).mul(-1).equal())} ${he(t.calc(t.paddingInline).mul(-1).equal())}`,[`&${n}-select-single:not(${n}-select-customize-input):not(${n}-pagination-size-changer)`]:{[`${n}-select-selector`]:{backgroundColor:"inherit",border:`${he(t.lineWidth)} ${t.lineType} transparent`,boxShadow:"none"}},"&-open, &-focused":{[`${n}-select-selector`]:{color:t.colorPrimary}}},[`${n}-cascader-picker`]:{margin:`-9px ${he(t.calc(t.paddingInline).mul(-1).equal())}`,backgroundColor:"transparent",[`${n}-cascader-input`]:{textAlign:"start",border:0,boxShadow:"none"}}}},[e]:{width:"100%",marginBottom:0,textAlign:"inherit","&:focus":{zIndex:1,borderInlineEndWidth:1},"&:hover":{zIndex:1,borderInlineEndWidth:1,[`${e}-search-with-button &`]:{zIndex:0}}},[`> ${e}:first-child, ${e}-group-addon:first-child`]:{borderStartEndRadius:0,borderEndEndRadius:0,[`${n}-select ${n}-select-selector`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${e}-affix-wrapper`]:{[`&:not(:first-child) ${e}`]:{borderStartStartRadius:0,borderEndStartRadius:0},[`&:not(:last-child) ${e}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${e}:last-child, ${e}-group-addon:last-child`]:{borderStartStartRadius:0,borderEndStartRadius:0,[`${n}-select ${n}-select-selector`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`${e}-affix-wrapper`]:{"&:not(:last-child)":{borderStartEndRadius:0,borderEndEndRadius:0,[`${e}-search &`]:{borderStartStartRadius:t.borderRadius,borderEndStartRadius:t.borderRadius}},[`&:not(:first-child), ${e}-search &:not(:first-child)`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&${e}-group-compact`]:Object.assign(Object.assign({display:"block"},f1()),{[`${e}-group-addon, ${e}-group-wrap, > ${e}`]:{"&:not(:first-child):not(:last-child)":{borderInlineEndWidth:t.lineWidth,"&:hover, &:focus":{zIndex:1}}},"& > *":{display:"inline-flex",float:"none",verticalAlign:"top",borderRadius:0},[`
        & > ${e}-affix-wrapper,
        & > ${e}-number-affix-wrapper,
        & > ${n}-picker-range
      `]:{display:"inline-flex"},"& > *:not(:last-child)":{marginInlineEnd:t.calc(t.lineWidth).mul(-1).equal(),borderInlineEndWidth:t.lineWidth},[e]:{float:"none"},[`& > ${n}-select > ${n}-select-selector,
      & > ${n}-select-auto-complete ${e},
      & > ${n}-cascader-picker ${e},
      & > ${e}-group-wrapper ${e}`]:{borderInlineEndWidth:t.lineWidth,borderRadius:0,"&:hover, &:focus":{zIndex:1}},[`& > ${n}-select-focused`]:{zIndex:1},[`& > ${n}-select > ${n}-select-arrow`]:{zIndex:1},[`& > *:first-child,
      & > ${n}-select:first-child > ${n}-select-selector,
      & > ${n}-select-auto-complete:first-child ${e},
      & > ${n}-cascader-picker:first-child ${e}`]:{borderStartStartRadius:t.borderRadius,borderEndStartRadius:t.borderRadius},[`& > *:last-child,
      & > ${n}-select:last-child > ${n}-select-selector,
      & > ${n}-cascader-picker:last-child ${e},
      & > ${n}-cascader-picker-focused:last-child ${e}`]:{borderInlineEndWidth:t.lineWidth,borderStartEndRadius:t.borderRadius,borderEndEndRadius:t.borderRadius},[`& > ${n}-select-auto-complete ${e}`]:{verticalAlign:"top"},[`${e}-group-wrapper + ${e}-group-wrapper`]:{marginInlineStart:t.calc(t.lineWidth).mul(-1).equal(),[`${e}-affix-wrapper`]:{borderRadius:0}},[`${e}-group-wrapper:not(:last-child)`]:{[`&${e}-search > ${e}-group`]:{[`& > ${e}-group-addon > ${e}-search-button`]:{borderRadius:0},[`& > ${e}`]:{borderStartStartRadius:t.borderRadius,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:t.borderRadius}}}})}},Cz=t=>{const{componentCls:e,controlHeightSM:n,lineWidth:i,calc:s}=t,r=s(n).sub(s(i).mul(2)).sub(16).div(2).equal();return{[e]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},os(t)),jv(t)),mz(t)),xz(t)),vz(t)),{'&[type="color"]':{height:t.controlHeight,[`&${e}-lg`]:{height:t.controlHeightLG},[`&${e}-sm`]:{height:n,paddingTop:r,paddingBottom:r}},'&[type="search"]::-webkit-search-cancel-button, &[type="search"]::-webkit-search-decoration':{"-webkit-appearance":"none"}})}},Sz=t=>{const{componentCls:e}=t;return{[`${e}-clear-icon`]:{margin:0,color:t.colorTextQuaternary,fontSize:t.fontSizeIcon,verticalAlign:-1,cursor:"pointer",transition:`color ${t.motionDurationSlow}`,"&:hover":{color:t.colorTextTertiary},"&:active":{color:t.colorText},"&-hidden":{visibility:"hidden"},"&-has-suffix":{margin:`0 ${he(t.inputAffixPadding)}`}}}},Iz=t=>{const{componentCls:e,inputAffixPadding:n,colorTextDescription:i,motionDurationSlow:s,colorIcon:o,colorIconHover:r,iconCls:a}=t;return{[`${e}-affix-wrapper`]:Object.assign(Object.assign(Object.assign(Object.assign({},jv(t)),{display:"inline-flex",[`&:not(${e}-disabled):hover`]:{zIndex:1,[`${e}-search-with-button &`]:{zIndex:0}},"&-focused, &:focus":{zIndex:1},[`> input${e}`]:{padding:0},[`> input${e}, > textarea${e}`]:{fontSize:"inherit",border:"none",borderRadius:0,outline:"none",background:"transparent",color:"inherit","&::-ms-reveal":{display:"none"},"&:focus":{boxShadow:"none !important"}},"&::before":{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'},[e]:{"&-prefix, &-suffix":{display:"flex",flex:"none",alignItems:"center","> *:not(:last-child)":{marginInlineEnd:t.paddingXS}},"&-show-count-suffix":{color:i},"&-show-count-has-suffix":{marginInlineEnd:t.paddingXXS},"&-prefix":{marginInlineEnd:n},"&-suffix":{marginInlineStart:n}}}),Sz(t)),{[`${a}${e}-password-icon`]:{color:o,cursor:"pointer",transition:`all ${s}`,"&:hover":{color:r}}})}},$z=t=>{const{componentCls:e,borderRadiusLG:n,borderRadiusSM:i}=t;return{[`${e}-group`]:Object.assign(Object.assign(Object.assign({},os(t)),wz(t)),{"&-rtl":{direction:"rtl"},"&-wrapper":Object.assign(Object.assign(Object.assign({display:"inline-block",width:"100%",textAlign:"start",verticalAlign:"top","&-rtl":{direction:"rtl"},"&-lg":{[`${e}-group-addon`]:{borderRadius:n,fontSize:t.inputFontSizeLG}},"&-sm":{[`${e}-group-addon`]:{borderRadius:i}}},gz(t)),bz(t)),{[`&:not(${e}-compact-first-item):not(${e}-compact-last-item)${e}-compact-item`]:{[`${e}, ${e}-group-addon`]:{borderRadius:0}},[`&:not(${e}-compact-last-item)${e}-compact-first-item`]:{[`${e}, ${e}-group-addon`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${e}-compact-first-item)${e}-compact-last-item`]:{[`${e}, ${e}-group-addon`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&:not(${e}-compact-last-item)${e}-compact-item`]:{[`${e}-affix-wrapper`]:{borderStartEndRadius:0,borderEndEndRadius:0}}})})}},Ez=t=>{const{componentCls:e,antCls:n}=t,i=`${e}-search`;return{[i]:{[e]:{"&:hover, &:focus":{borderColor:t.colorPrimaryHover,[`+ ${e}-group-addon ${i}-button:not(${n}-btn-primary)`]:{borderInlineStartColor:t.colorPrimaryHover}}},[`${e}-affix-wrapper`]:{borderRadius:0},[`${e}-lg`]:{lineHeight:t.calc(t.lineHeightLG).sub(2e-4).equal()},[`> ${e}-group`]:{[`> ${e}-group-addon:last-child`]:{insetInlineStart:-1,padding:0,border:0,[`${i}-button`]:{marginInlineEnd:-1,paddingTop:0,paddingBottom:0,borderStartStartRadius:0,borderStartEndRadius:t.borderRadius,borderEndEndRadius:t.borderRadius,borderEndStartRadius:0,boxShadow:"none"},[`${i}-button:not(${n}-btn-primary)`]:{color:t.colorTextDescription,"&:hover":{color:t.colorPrimaryHover},"&:active":{color:t.colorPrimaryActive},[`&${n}-btn-loading::before`]:{insetInlineStart:0,insetInlineEnd:0,insetBlockStart:0,insetBlockEnd:0}}}},[`${i}-button`]:{height:t.controlHeight,"&:hover, &:focus":{zIndex:1}},[`&-large ${i}-button`]:{height:t.controlHeightLG},[`&-small ${i}-button`]:{height:t.controlHeightSM},"&-rtl":{direction:"rtl"},[`&${e}-compact-item`]:{[`&:not(${e}-compact-last-item)`]:{[`${e}-group-addon`]:{[`${e}-search-button`]:{marginInlineEnd:t.calc(t.lineWidth).mul(-1).equal(),borderRadius:0}}},[`&:not(${e}-compact-first-item)`]:{[`${e},${e}-affix-wrapper`]:{borderRadius:0}},[`> ${e}-group-addon ${e}-search-button,
        > ${e},
        ${e}-affix-wrapper`]:{"&:hover, &:focus, &:active":{zIndex:2}},[`> ${e}-affix-wrapper-focused`]:{zIndex:2}}}}},Nz=t=>{const{componentCls:e,paddingLG:n}=t,i=`${e}-textarea`;return{[i]:{position:"relative","&-show-count":{[`> ${e}`]:{height:"100%"},[`${e}-data-count`]:{position:"absolute",bottom:t.calc(t.fontSize).mul(t.lineHeight).mul(-1).equal(),insetInlineEnd:0,color:t.colorTextDescription,whiteSpace:"nowrap",pointerEvents:"none"}},[`
        &-allow-clear > ${e},
        &-affix-wrapper${i}-has-feedback ${e}
      `]:{paddingInlineEnd:n},[`&-affix-wrapper${e}-affix-wrapper`]:{padding:0,[`> textarea${e}`]:{fontSize:"inherit",border:"none",outline:"none",background:"transparent","&:focus":{boxShadow:"none !important"}},[`${e}-suffix`]:{margin:0,"> *:not(:last-child)":{marginInline:0},[`${e}-clear-icon`]:{position:"absolute",insetInlineEnd:t.paddingInline,insetBlockStart:t.paddingXS},[`${i}-suffix`]:{position:"absolute",top:0,insetInlineEnd:t.paddingInline,bottom:0,zIndex:1,display:"inline-flex",alignItems:"center",margin:"auto",pointerEvents:"none"}}},[`&-affix-wrapper${e}-affix-wrapper-sm`]:{[`${e}-suffix`]:{[`${e}-clear-icon`]:{insetInlineEnd:t.paddingInlineSM}}}}}},kz=t=>{const{componentCls:e}=t;return{[`${e}-out-of-range`]:{[`&, & input, & textarea, ${e}-show-count-suffix, ${e}-data-count`]:{color:t.colorError}}}},Kv=Ys("Input",t=>{const e=Si(t,Wv(t));return[Cz(e),Nz(e),Iz(e),$z(e),Ez(e),kz(e),d1(e)]},Gv,{resetFont:!1});function Wi(t,e){return t[e]}var Dz=["children"];function GI(t,e){return"".concat(t,"-").concat(e)}function Tz(t){return t&&t.type&&t.type.isTreeNode}function ou(t,e){return t??e}function $l(t){var e=t||{},n=e.title,i=e._title,s=e.key,o=e.children,r=n||"title";return{title:r,_title:i||[r],key:s||"key",children:o||"children"}}function HI(t){function e(n){var i=uv(n);return i.map(function(s){if(!Tz(s))return Lo(!s,"Tree/TreeNode can only accept TreeNode as children."),null;var o=s.key,r=s.props,a=r.children,l=In(r,Dz),c=me({key:o},l),u=e(a);return u.length&&(c.children=u),c}).filter(function(s){return s})}return e(t)}function lm(t,e,n){var i=$l(n),s=i._title,o=i.key,r=i.children,a=new Set(e===!0?[]:e),l=[];function c(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return u.map(function(f,h){for(var p=GI(d?d.pos:"0",h),m=ou(f[o],p),g,v=0;v<s.length;v+=1){var x=s[v];if(f[x]!==void 0){g=f[x];break}}var b=Object.assign(Da(f,[].concat(Ze(s),[o,r])),{title:g,key:m,parent:d,pos:p,children:null,data:f,isStart:[].concat(Ze(d?d.isStart:[]),[h===0]),isEnd:[].concat(Ze(d?d.isEnd:[]),[h===u.length-1])});return l.push(b),e===!0||a.has(m)?b.children=c(f[r]||[],b):b.children=[],b})}return c(t),l}function Rz(t,e,n){var i={};_n(n)==="object"?i=n:i={externalGetKey:n},i=i||{};var s=i,o=s.childrenPropName,r=s.externalGetKey,a=s.fieldNames,l=$l(a),c=l.key,u=l.children,d=o||u,f;r?typeof r=="string"?f=function(m){return m[r]}:typeof r=="function"&&(f=function(m){return r(m)}):f=function(m,g){return ou(m[c],g)};function h(p,m,g,v){var x=p?p[d]:t,b=p?GI(g.pos,m):"0",w=p?[].concat(Ze(v),[p]):[];if(p){var y=f(p,b),C={node:p,index:m,pos:b,key:y,parentPos:g.node?g.pos:null,level:g.level+1,nodes:w};e(C)}x&&x.forEach(function(I,$){h(I,$,{node:p,pos:b,level:g?g.level+1:-1},w)})}h(null)}function Xv(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.initWrapper,i=e.processEntity,s=e.onProcessFinished,o=e.externalGetKey,r=e.childrenPropName,a=e.fieldNames,l=arguments.length>2?arguments[2]:void 0,c=o||l,u={},d={},f={posEntities:u,keyEntities:d};return n&&(f=n(f)||f),Rz(t,function(h){var p=h.node,m=h.index,g=h.pos,v=h.key,x=h.parentPos,b=h.level,w=h.nodes,y={node:p,nodes:w,index:m,key:v,pos:g,level:b},C=ou(v,g);u[g]=y,d[C]=y,y.parent=u[x],y.parent&&(y.parent.children=y.parent.children||[],y.parent.children.push(y)),i&&i(y,f)},{externalGetKey:c,childrenPropName:r,fieldNames:a}),s&&s(f),f}function Dc(t,e){var n=e.expandedKeys,i=e.selectedKeys,s=e.loadedKeys,o=e.loadingKeys,r=e.checkedKeys,a=e.halfCheckedKeys,l=e.dragOverNodeKey,c=e.dropPosition,u=e.keyEntities,d=Wi(u,t),f={eventKey:t,expanded:n.indexOf(t)!==-1,selected:i.indexOf(t)!==-1,loaded:s.indexOf(t)!==-1,loading:o.indexOf(t)!==-1,checked:r.indexOf(t)!==-1,halfChecked:a.indexOf(t)!==-1,pos:String(d?d.pos:""),dragOver:l===t&&c===0,dragOverGapTop:l===t&&c===-1,dragOverGapBottom:l===t&&c===1};return f}function Pn(t){var e=t.data,n=t.expanded,i=t.selected,s=t.checked,o=t.loaded,r=t.loading,a=t.halfChecked,l=t.dragOver,c=t.dragOverGapTop,u=t.dragOverGapBottom,d=t.pos,f=t.active,h=t.eventKey,p=me(me({},e),{},{expanded:n,selected:i,checked:s,loaded:o,loading:r,halfChecked:a,dragOver:l,dragOverGapTop:c,dragOverGapBottom:u,pos:d,active:f,key:h});return"props"in p||Object.defineProperty(p,"props",{get:function(){return Lo(!1,"Second param return from event is node data instead of TreeNode instance. Please read value directly instead of reading from `props`."),t}}),p}function UI(t,e){var n=new Set;return t.forEach(function(i){e.has(i)||n.add(i)}),n}function _z(t){var e=t||{},n=e.disabled,i=e.disableCheckbox,s=e.checkable;return!!(n||i)||s===!1}function Az(t,e,n,i){for(var s=new Set(t),o=new Set,r=0;r<=n;r+=1){var a=e.get(r)||new Set;a.forEach(function(d){var f=d.key,h=d.node,p=d.children,m=p===void 0?[]:p;s.has(f)&&!i(h)&&m.filter(function(g){return!i(g.node)}).forEach(function(g){s.add(g.key)})})}for(var l=new Set,c=n;c>=0;c-=1){var u=e.get(c)||new Set;u.forEach(function(d){var f=d.parent,h=d.node;if(!(i(h)||!d.parent||l.has(d.parent.key))){if(i(d.parent.node)){l.add(f.key);return}var p=!0,m=!1;(f.children||[]).filter(function(g){return!i(g.node)}).forEach(function(g){var v=g.key,x=s.has(v);p&&!x&&(p=!1),!m&&(x||o.has(v))&&(m=!0)}),p&&s.add(f.key),m&&o.add(f.key),l.add(f.key)}})}return{checkedKeys:Array.from(s),halfCheckedKeys:Array.from(UI(o,s))}}function Oz(t,e,n,i,s){for(var o=new Set(t),r=new Set(e),a=0;a<=i;a+=1){var l=n.get(a)||new Set;l.forEach(function(f){var h=f.key,p=f.node,m=f.children,g=m===void 0?[]:m;!o.has(h)&&!r.has(h)&&!s(p)&&g.filter(function(v){return!s(v.node)}).forEach(function(v){o.delete(v.key)})})}r=new Set;for(var c=new Set,u=i;u>=0;u-=1){var d=n.get(u)||new Set;d.forEach(function(f){var h=f.parent,p=f.node;if(!(s(p)||!f.parent||c.has(f.parent.key))){if(s(f.parent.node)){c.add(h.key);return}var m=!0,g=!1;(h.children||[]).filter(function(v){return!s(v.node)}).forEach(function(v){var x=v.key,b=o.has(x);m&&!b&&(m=!1),!g&&(b||r.has(x))&&(g=!0)}),m||o.delete(h.key),g&&r.add(h.key),c.add(h.key)}})}return{checkedKeys:Array.from(o),halfCheckedKeys:Array.from(UI(r,o))}}function rl(t,e,n,i){var s=[],o;i?o=i:o=_z;var r=new Set(t.filter(function(u){var d=!!Wi(n,u);return d||s.push(u),d})),a=new Map,l=0;Object.keys(n).forEach(function(u){var d=n[u],f=d.level,h=a.get(f);h||(h=new Set,a.set(f,h)),h.add(d),l=Math.max(l,f)}),Lo(!s.length,"Tree missing follow keys: ".concat(s.slice(0,100).map(function(u){return"'".concat(u,"'")}).join(", ")));var c;return e===!0?c=Az(r,a,l,o):c=Oz(r,e.halfCheckedKeys,a,l,o),c}const Pz=t=>{const{checkboxCls:e}=t,n=`${e}-wrapper`;return[{[`${e}-group`]:Object.assign(Object.assign({},os(t)),{display:"inline-flex",flexWrap:"wrap",columnGap:t.marginXS,[`> ${t.antCls}-row`]:{flex:1}}),[n]:Object.assign(Object.assign({},os(t)),{display:"inline-flex",alignItems:"baseline",cursor:"pointer","&:after":{display:"inline-block",width:0,overflow:"hidden",content:"'\\a0'"},[`& + ${n}`]:{marginInlineStart:0},[`&${n}-in-form-item`]:{'input[type="checkbox"]':{width:14,height:14}}}),[e]:Object.assign(Object.assign({},os(t)),{position:"relative",whiteSpace:"nowrap",lineHeight:1,cursor:"pointer",borderRadius:t.borderRadiusSM,alignSelf:"center",[`${e}-input`]:{position:"absolute",inset:0,zIndex:1,cursor:"pointer",opacity:0,margin:0,[`&:focus-visible + ${e}-inner`]:Object.assign({},hh(t))},[`${e}-inner`]:{boxSizing:"border-box",display:"block",width:t.checkboxSize,height:t.checkboxSize,direction:"ltr",backgroundColor:t.colorBgContainer,border:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderRadius:t.borderRadiusSM,borderCollapse:"separate",transition:`all ${t.motionDurationSlow}`,"&:after":{boxSizing:"border-box",position:"absolute",top:"50%",insetInlineStart:"25%",display:"table",width:t.calc(t.checkboxSize).div(14).mul(5).equal(),height:t.calc(t.checkboxSize).div(14).mul(8).equal(),border:`${he(t.lineWidthBold)} solid ${t.colorWhite}`,borderTop:0,borderInlineStart:0,transform:"rotate(45deg) scale(0) translate(-50%,-50%)",opacity:0,content:'""',transition:`all ${t.motionDurationFast} ${t.motionEaseInBack}, opacity ${t.motionDurationFast}`}},"& + span":{paddingInlineStart:t.paddingXS,paddingInlineEnd:t.paddingXS}})},{[`
        ${n}:not(${n}-disabled),
        ${e}:not(${e}-disabled)
      `]:{[`&:hover ${e}-inner`]:{borderColor:t.colorPrimary}},[`${n}:not(${n}-disabled)`]:{[`&:hover ${e}-checked:not(${e}-disabled) ${e}-inner`]:{backgroundColor:t.colorPrimaryHover,borderColor:"transparent"},[`&:hover ${e}-checked:not(${e}-disabled):after`]:{borderColor:t.colorPrimaryHover}}},{[`${e}-checked`]:{[`${e}-inner`]:{backgroundColor:t.colorPrimary,borderColor:t.colorPrimary,"&:after":{opacity:1,transform:"rotate(45deg) scale(1) translate(-50%,-50%)",transition:`all ${t.motionDurationMid} ${t.motionEaseOutBack} ${t.motionDurationFast}`}}},[`
        ${n}-checked:not(${n}-disabled),
        ${e}-checked:not(${e}-disabled)
      `]:{[`&:hover ${e}-inner`]:{backgroundColor:t.colorPrimaryHover,borderColor:"transparent"}}},{[e]:{"&-indeterminate":{[`${e}-inner`]:{backgroundColor:`${t.colorBgContainer} !important`,borderColor:`${t.colorBorder} !important`,"&:after":{top:"50%",insetInlineStart:"50%",width:t.calc(t.fontSizeLG).div(2).equal(),height:t.calc(t.fontSizeLG).div(2).equal(),backgroundColor:t.colorPrimary,border:0,transform:"translate(-50%, -50%) scale(1)",opacity:1,content:'""'}},[`&:hover ${e}-inner`]:{backgroundColor:`${t.colorBgContainer} !important`,borderColor:`${t.colorPrimary} !important`}}}},{[`${n}-disabled`]:{cursor:"not-allowed"},[`${e}-disabled`]:{[`&, ${e}-input`]:{cursor:"not-allowed",pointerEvents:"none"},[`${e}-inner`]:{background:t.colorBgContainerDisabled,borderColor:t.colorBorder,"&:after":{borderColor:t.colorTextDisabled}},"&:after":{display:"none"},"& + span":{color:t.colorTextDisabled},[`&${e}-indeterminate ${e}-inner::after`]:{background:t.colorTextDisabled}}}]};function jI(t,e){const n=Si(e,{checkboxCls:`.${t}`,checkboxSize:e.controlInteractiveSize});return[Pz(n)]}const KI=Ys("Checkbox",(t,e)=>{let{prefixCls:n}=e;return[jI(n,t)]}),XI=ce.createContext(null);var Mz=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const Fz=(t,e)=>{var n;const{prefixCls:i,className:s,rootClassName:o,children:r,indeterminate:a=!1,style:l,onMouseEnter:c,onMouseLeave:u,skipGroup:d=!1,disabled:f}=t,h=Mz(t,["prefixCls","className","rootClassName","children","indeterminate","style","onMouseEnter","onMouseLeave","skipGroup","disabled"]),{getPrefixCls:p,direction:m,checkbox:g}=S.useContext($n),v=S.useContext(XI),{isFormItemInput:x}=S.useContext(br),b=S.useContext(sf),w=(n=(v==null?void 0:v.disabled)||f)!==null&&n!==void 0?n:b,y=S.useRef(h.value);S.useEffect(()=>{v==null||v.registerValue(h.value)},[]),S.useEffect(()=>{if(!d)return h.value!==y.current&&(v==null||v.cancelValue(y.current),v==null||v.registerValue(h.value),y.current=h.value),()=>v==null?void 0:v.cancelValue(h.value)},[h.value]);const C=p("checkbox",i),I=Ta(C),[$,E,N]=KI(C,I),k=Object.assign({},h);v&&!d&&(k.onChange=function(){h.onChange&&h.onChange.apply(h,arguments),v.toggleOption&&v.toggleOption({label:r,value:h.value})},k.name=v.name,k.checked=v.value.includes(h.value));const D=ye(`${C}-wrapper`,{[`${C}-rtl`]:m==="rtl",[`${C}-wrapper-checked`]:k.checked,[`${C}-wrapper-disabled`]:w,[`${C}-wrapper-in-form-item`]:x},g==null?void 0:g.className,s,o,N,I,E),_=ye({[`${C}-indeterminate`]:a},__,E),R=a?"mixed":void 0;return $(S.createElement(A_,{component:"Checkbox",disabled:w},S.createElement("label",{className:D,style:Object.assign(Object.assign({},g==null?void 0:g.style),l),onMouseEnter:c,onMouseLeave:u},S.createElement(Z_,Object.assign({"aria-checked":R},k,{prefixCls:C,className:_,disabled:w,ref:e})),r!==void 0&&S.createElement("span",null,r))))},qI=S.forwardRef(Fz);var Lz=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const zz=S.forwardRef((t,e)=>{const{defaultValue:n,children:i,options:s=[],prefixCls:o,className:r,rootClassName:a,style:l,onChange:c}=t,u=Lz(t,["defaultValue","children","options","prefixCls","className","rootClassName","style","onChange"]),{getPrefixCls:d,direction:f}=S.useContext($n),[h,p]=S.useState(u.value||n||[]),[m,g]=S.useState([]);S.useEffect(()=>{"value"in u&&p(u.value||[])},[u.value]);const v=S.useMemo(()=>s.map(T=>typeof T=="string"||typeof T=="number"?{label:T,value:T}:T),[s]),x=T=>{g(A=>A.filter(O=>O!==T))},b=T=>{g(A=>[].concat(Ze(A),[T]))},w=T=>{const A=h.indexOf(T.value),O=Ze(h);A===-1?O.push(T.value):O.splice(A,1),"value"in u||p(O),c==null||c(O.filter(P=>m.includes(P)).sort((P,M)=>{const z=v.findIndex(W=>W.value===P),L=v.findIndex(W=>W.value===M);return z-L}))},y=d("checkbox",o),C=`${y}-group`,I=Ta(y),[$,E,N]=KI(y,I),k=Da(u,["value","disabled"]),D=s.length?v.map(T=>S.createElement(qI,{prefixCls:y,key:T.value.toString(),disabled:"disabled"in T?T.disabled:u.disabled,value:T.value,checked:h.includes(T.value),onChange:T.onChange,className:`${C}-item`,style:T.style,title:T.title,id:T.id,required:T.required},T.label)):i,_={toggleOption:w,value:h,disabled:u.disabled,name:u.name,registerValue:b,cancelValue:x},R=ye(C,{[`${C}-rtl`]:f==="rtl"},r,a,N,I,E);return $(S.createElement("div",Object.assign({className:R,style:l},k,{ref:e}),S.createElement(XI.Provider,{value:_},D)))}),El=qI;El.Group=zz;El.__ANT_CHECKBOX=!0;const YI=S.createContext({}),Bz=t=>{const{componentCls:e}=t;return{[e]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},Vz=t=>{const{componentCls:e}=t;return{[e]:{position:"relative",maxWidth:"100%",minHeight:1}}},Wz=(t,e)=>{const{prefixCls:n,componentCls:i,gridColumns:s}=t,o={};for(let r=s;r>=0;r--)r===0?(o[`${i}${e}-${r}`]={display:"none"},o[`${i}-push-${r}`]={insetInlineStart:"auto"},o[`${i}-pull-${r}`]={insetInlineEnd:"auto"},o[`${i}${e}-push-${r}`]={insetInlineStart:"auto"},o[`${i}${e}-pull-${r}`]={insetInlineEnd:"auto"},o[`${i}${e}-offset-${r}`]={marginInlineStart:0},o[`${i}${e}-order-${r}`]={order:0}):(o[`${i}${e}-${r}`]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${r/s*100}%`,maxWidth:`${r/s*100}%`}],o[`${i}${e}-push-${r}`]={insetInlineStart:`${r/s*100}%`},o[`${i}${e}-pull-${r}`]={insetInlineEnd:`${r/s*100}%`},o[`${i}${e}-offset-${r}`]={marginInlineStart:`${r/s*100}%`},o[`${i}${e}-order-${r}`]={order:r});return o[`${i}${e}-flex`]={flex:`var(--${n}${e}-flex)`},o},tg=(t,e)=>Wz(t,e),Gz=(t,e,n)=>({[`@media (min-width: ${he(e)})`]:Object.assign({},tg(t,n))}),Hz=()=>({}),Uz=()=>({}),jz=Ys("Grid",Bz,Hz),Kz=Ys("Grid",t=>{const e=Si(t,{gridColumns:24}),n={"-sm":e.screenSMMin,"-md":e.screenMDMin,"-lg":e.screenLGMin,"-xl":e.screenXLMin,"-xxl":e.screenXXLMin};return[Vz(e),tg(e,""),tg(e,"-xs"),Object.keys(n).map(i=>Gz(e,n[i],i)).reduce((i,s)=>Object.assign(Object.assign({},i),s),{})]},Uz);var Xz=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};function ow(t){return typeof t=="number"?`${t} ${t} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(t)?`0 0 ${t}`:t}const qz=["xs","sm","md","lg","xl","xxl"],Yz=S.forwardRef((t,e)=>{const{getPrefixCls:n,direction:i}=S.useContext($n),{gutter:s,wrap:o}=S.useContext(YI),{prefixCls:r,span:a,order:l,offset:c,push:u,pull:d,className:f,children:h,flex:p,style:m}=t,g=Xz(t,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),v=n("col",r),[x,b,w]=Kz(v),y={};let C={};qz.forEach(E=>{let N={};const k=t[E];typeof k=="number"?N.span=k:typeof k=="object"&&(N=k||{}),delete g[E],C=Object.assign(Object.assign({},C),{[`${v}-${E}-${N.span}`]:N.span!==void 0,[`${v}-${E}-order-${N.order}`]:N.order||N.order===0,[`${v}-${E}-offset-${N.offset}`]:N.offset||N.offset===0,[`${v}-${E}-push-${N.push}`]:N.push||N.push===0,[`${v}-${E}-pull-${N.pull}`]:N.pull||N.pull===0,[`${v}-rtl`]:i==="rtl"}),N.flex&&(C[`${v}-${E}-flex`]=!0,y[`--${v}-${E}-flex`]=ow(N.flex))});const I=ye(v,{[`${v}-${a}`]:a!==void 0,[`${v}-order-${l}`]:l,[`${v}-offset-${c}`]:c,[`${v}-push-${u}`]:u,[`${v}-pull-${d}`]:d},f,C,b,w),$={};if(s&&s[0]>0){const E=s[0]/2;$.paddingLeft=E,$.paddingRight=E}return p&&($.flex=ow(p),o===!1&&!$.minWidth&&($.minWidth=0)),x(S.createElement("div",Object.assign({},g,{style:Object.assign(Object.assign(Object.assign({},$),m),y),className:I,ref:e}),h))});var Jz=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};function rw(t,e){const[n,i]=S.useState(typeof t=="string"?t:""),s=()=>{if(typeof t=="string"&&i(t),typeof t=="object")for(let o=0;o<wl.length;o++){const r=wl[o];if(!e[r])continue;const a=t[r];if(a!==void 0){i(a);return}}};return S.useEffect(()=>{s()},[JSON.stringify(t),e]),n}const Zz=S.forwardRef((t,e)=>{const{prefixCls:n,justify:i,align:s,className:o,style:r,children:a,gutter:l=0,wrap:c}=t,u=Jz(t,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:d,direction:f}=S.useContext($n),[h,p]=S.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[m,g]=S.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),v=rw(s,m),x=rw(i,m),b=S.useRef(l),w=tA();S.useEffect(()=>{const O=w.subscribe(P=>{g(P);const M=b.current||0;(!Array.isArray(M)&&typeof M=="object"||Array.isArray(M)&&(typeof M[0]=="object"||typeof M[1]=="object"))&&p(P)});return()=>w.unsubscribe(O)},[]);const y=()=>{const O=[void 0,void 0];return(Array.isArray(l)?l:[l,void 0]).forEach((M,z)=>{if(typeof M=="object")for(let L=0;L<wl.length;L++){const W=wl[L];if(h[W]&&M[W]!==void 0){O[z]=M[W];break}}else O[z]=M}),O},C=d("row",n),[I,$,E]=jz(C),N=y(),k=ye(C,{[`${C}-no-wrap`]:c===!1,[`${C}-${x}`]:x,[`${C}-${v}`]:v,[`${C}-rtl`]:f==="rtl"},o,$,E),D={},_=N[0]!=null&&N[0]>0?N[0]/-2:void 0;_&&(D.marginLeft=_,D.marginRight=_);const[R,T]=N;D.rowGap=T;const A=S.useMemo(()=>({gutter:[R,T],wrap:c}),[R,T,c]);return I(S.createElement(YI.Provider,{value:A},S.createElement("div",Object.assign({},u,{className:k,style:Object.assign(Object.assign({},D),r),ref:e}),a)))});function Qz(t){return!!(t.addonBefore||t.addonAfter)}function e3(t){return!!(t.prefix||t.suffix||t.allowClear)}function aw(t,e,n){var i=e.cloneNode(!0),s=Object.create(t,{target:{value:i},currentTarget:{value:i}});return i.value=n,typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"&&(i.selectionStart=e.selectionStart,i.selectionEnd=e.selectionEnd),i.setSelectionRange=function(){e.setSelectionRange.apply(e,arguments)},s}function vh(t,e,n,i){if(n){var s=e;if(e.type==="click"){s=aw(e,t,""),n(s);return}if(t.type!=="file"&&i!==void 0){s=aw(e,t,i),n(s);return}n(s)}}function t3(t,e){if(t){t.focus(e);var n=e||{},i=n.cursor;if(i){var s=t.value.length;switch(i){case"start":t.setSelectionRange(0,0);break;case"end":t.setSelectionRange(s,s);break;default:t.setSelectionRange(0,s)}}}}var JI=ce.forwardRef(function(t,e){var n,i,s=t.inputElement,o=t.children,r=t.prefixCls,a=t.prefix,l=t.suffix,c=t.addonBefore,u=t.addonAfter,d=t.className,f=t.style,h=t.disabled,p=t.readOnly,m=t.focused,g=t.triggerFocus,v=t.allowClear,x=t.value,b=t.handleReset,w=t.hidden,y=t.classes,C=t.classNames,I=t.dataAttrs,$=t.styles,E=t.components,N=t.onClear,k=o??s,D=(E==null?void 0:E.affixWrapper)||"span",_=(E==null?void 0:E.groupWrapper)||"span",R=(E==null?void 0:E.wrapper)||"span",T=(E==null?void 0:E.groupAddon)||"span",A=S.useRef(null),O=function(J){var ue;(ue=A.current)!==null&&ue!==void 0&&ue.contains(J.target)&&(g==null||g())},P=e3(t),M=S.cloneElement(k,{value:x,className:ye(k.props.className,!P&&(C==null?void 0:C.variant))||null}),z=S.useRef(null);if(ce.useImperativeHandle(e,function(){return{nativeElement:z.current||A.current}}),P){var L=null;if(v){var W=!h&&!p&&x,B="".concat(r,"-clear-icon"),q=_n(v)==="object"&&v!==null&&v!==void 0&&v.clearIcon?v.clearIcon:"✖";L=ce.createElement("span",{onClick:function(J){b==null||b(J),N==null||N()},onMouseDown:function(J){return J.preventDefault()},className:ye(B,X(X({},"".concat(B,"-hidden"),!W),"".concat(B,"-has-suffix"),!!l)),role:"button",tabIndex:-1},q)}var H="".concat(r,"-affix-wrapper"),ne=ye(H,X(X(X(X(X({},"".concat(r,"-disabled"),h),"".concat(H,"-disabled"),h),"".concat(H,"-focused"),m),"".concat(H,"-readonly"),p),"".concat(H,"-input-with-clear-btn"),l&&v&&x),y==null?void 0:y.affixWrapper,C==null?void 0:C.affixWrapper,C==null?void 0:C.variant),te=(l||v)&&ce.createElement("span",{className:ye("".concat(r,"-suffix"),C==null?void 0:C.suffix),style:$==null?void 0:$.suffix},L,l);M=ce.createElement(D,Ve({className:ne,style:$==null?void 0:$.affixWrapper,onClick:O},I==null?void 0:I.affixWrapper,{ref:A}),a&&ce.createElement("span",{className:ye("".concat(r,"-prefix"),C==null?void 0:C.prefix),style:$==null?void 0:$.prefix},a),M,te)}if(Qz(t)){var ae="".concat(r,"-group"),re="".concat(ae,"-addon"),ee="".concat(ae,"-wrapper"),j=ye("".concat(r,"-wrapper"),ae,y==null?void 0:y.wrapper,C==null?void 0:C.wrapper),Y=ye(ee,X({},"".concat(ee,"-disabled"),h),y==null?void 0:y.group,C==null?void 0:C.groupWrapper);M=ce.createElement(_,{className:Y,ref:z},ce.createElement(R,{className:j},c&&ce.createElement(T,{className:re},c),M,u&&ce.createElement(T,{className:re},u)))}return ce.cloneElement(M,{className:ye((n=M.props)===null||n===void 0?void 0:n.className,d)||null,style:me(me({},(i=M.props)===null||i===void 0?void 0:i.style),f),hidden:w})}),n3=["show"];function ZI(t,e){return S.useMemo(function(){var n={};e&&(n.show=_n(e)==="object"&&e.formatter?e.formatter:!!e),n=me(me({},n),t);var i=n,s=i.show,o=In(i,n3);return me(me({},o),{},{show:!!s,showFormatter:typeof s=="function"?s:void 0,strategy:o.strategy||function(r){return r.length}})},[t,e])}var i3=["autoComplete","onChange","onFocus","onBlur","onPressEnter","onKeyDown","onKeyUp","prefixCls","disabled","htmlSize","className","maxLength","suffix","showCount","count","type","classes","classNames","styles","onCompositionStart","onCompositionEnd"],s3=S.forwardRef(function(t,e){var n=t.autoComplete,i=t.onChange,s=t.onFocus,o=t.onBlur,r=t.onPressEnter,a=t.onKeyDown,l=t.onKeyUp,c=t.prefixCls,u=c===void 0?"rc-input":c,d=t.disabled,f=t.htmlSize,h=t.className,p=t.maxLength,m=t.suffix,g=t.showCount,v=t.count,x=t.type,b=x===void 0?"text":x,w=t.classes,y=t.classNames,C=t.styles,I=t.onCompositionStart,$=t.onCompositionEnd,E=In(t,i3),N=S.useState(!1),k=ke(N,2),D=k[0],_=k[1],R=S.useRef(!1),T=S.useRef(!1),A=S.useRef(null),O=S.useRef(null),P=function(we){A.current&&t3(A.current,we)},M=Wo(t.defaultValue,{value:t.value}),z=ke(M,2),L=z[0],W=z[1],B=L==null?"":String(L),q=S.useState(null),H=ke(q,2),ne=H[0],te=H[1],ae=ZI(v,g),re=ae.max||p,ee=ae.strategy(B),j=!!re&&ee>re;S.useImperativeHandle(e,function(){var ve;return{focus:P,blur:function(){var Re;(Re=A.current)===null||Re===void 0||Re.blur()},setSelectionRange:function(Re,Ne,Ke){var We;(We=A.current)===null||We===void 0||We.setSelectionRange(Re,Ne,Ke)},select:function(){var Re;(Re=A.current)===null||Re===void 0||Re.select()},input:A.current,nativeElement:((ve=O.current)===null||ve===void 0?void 0:ve.nativeElement)||A.current}}),S.useEffect(function(){_(function(ve){return ve&&d?!1:ve})},[d]);var Y=function(we,Re,Ne){var Ke=Re;if(!R.current&&ae.exceedFormatter&&ae.max&&ae.strategy(Re)>ae.max){if(Ke=ae.exceedFormatter(Re,{max:ae.max}),Re!==Ke){var We,ct;te([((We=A.current)===null||We===void 0?void 0:We.selectionStart)||0,((ct=A.current)===null||ct===void 0?void 0:ct.selectionEnd)||0])}}else if(Ne.source==="compositionEnd")return;W(Ke),A.current&&vh(A.current,we,i,Ke)};S.useEffect(function(){if(ne){var ve;(ve=A.current)===null||ve===void 0||ve.setSelectionRange.apply(ve,Ze(ne))}},[ne]);var se=function(we){Y(we,we.target.value,{source:"change"})},J=function(we){R.current=!1,Y(we,we.currentTarget.value,{source:"compositionEnd"}),$==null||$(we)},ue=function(we){r&&we.key==="Enter"&&!T.current&&(T.current=!0,r(we)),a==null||a(we)},oe=function(we){we.key==="Enter"&&(T.current=!1),l==null||l(we)},be=function(we){_(!0),s==null||s(we)},de=function(we){_(!1),o==null||o(we)},Ie=function(we){W(""),P(),A.current&&vh(A.current,we,i)},ge=j&&"".concat(u,"-out-of-range"),$e=function(){var we=Da(t,["prefixCls","onPressEnter","addonBefore","addonAfter","prefix","suffix","allowClear","defaultValue","showCount","count","classes","htmlSize","styles","classNames","onClear"]);return ce.createElement("input",Ve({autoComplete:n},we,{onChange:se,onFocus:be,onBlur:de,onKeyDown:ue,onKeyUp:oe,className:ye(u,X({},"".concat(u,"-disabled"),d),y==null?void 0:y.input),style:C==null?void 0:C.input,ref:A,size:f,type:b,onCompositionStart:function(Ne){R.current=!0,I==null||I(Ne)},onCompositionEnd:J}))},De=function(){var we=Number(re)>0;if(m||ae.show){var Re=ae.showFormatter?ae.showFormatter({value:B,count:ee,maxLength:re}):"".concat(ee).concat(we?" / ".concat(re):"");return ce.createElement(ce.Fragment,null,ae.show&&ce.createElement("span",{className:ye("".concat(u,"-show-count-suffix"),X({},"".concat(u,"-show-count-has-suffix"),!!m),y==null?void 0:y.count),style:me({},C==null?void 0:C.count)},Re),m)}return null};return ce.createElement(JI,Ve({},E,{prefixCls:u,className:ye(h,ge),handleReset:Ie,value:B,focused:D,triggerFocus:P,suffix:De(),disabled:d,classes:w,classNames:y,styles:C}),$e())});const o3=t=>{const{getPrefixCls:e,direction:n}=S.useContext($n),{prefixCls:i,className:s}=t,o=e("input-group",i),r=e("input"),[a,l]=Kv(r),c=ye(o,{[`${o}-lg`]:t.size==="large",[`${o}-sm`]:t.size==="small",[`${o}-compact`]:t.compact,[`${o}-rtl`]:n==="rtl"},l,s),u=S.useContext(br),d=S.useMemo(()=>Object.assign(Object.assign({},u),{isFormItemInput:!1}),[u]);return a(S.createElement("span",{className:c,style:t.style,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,onFocus:t.onFocus,onBlur:t.onBlur},S.createElement(br.Provider,{value:d},t.children)))},QI=t=>{let e;return typeof t=="object"&&(t!=null&&t.clearIcon)?e=t:t&&(e={clearIcon:ce.createElement(b1,null)}),e};function e$(t,e){const n=S.useRef([]),i=()=>{n.current.push(setTimeout(()=>{var s,o,r,a;!((s=t.current)===null||s===void 0)&&s.input&&((o=t.current)===null||o===void 0?void 0:o.input.getAttribute("type"))==="password"&&(!((r=t.current)===null||r===void 0)&&r.input.hasAttribute("value"))&&((a=t.current)===null||a===void 0||a.input.removeAttribute("value"))}))};return S.useEffect(()=>(e&&i(),()=>n.current.forEach(s=>{s&&clearTimeout(s)})),[]),i}function r3(t){return!!(t.prefix||t.suffix||t.allowClear||t.showCount)}var a3=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};function l3(t,e){if(!t)return;t.focus(e);const{cursor:n}=e||{};if(n){const i=t.value.length;switch(n){case"start":t.setSelectionRange(0,0);break;case"end":t.setSelectionRange(i,i);break;default:t.setSelectionRange(0,i)}}}const pf=S.forwardRef((t,e)=>{var n;const{prefixCls:i,bordered:s=!0,status:o,size:r,disabled:a,onBlur:l,onFocus:c,suffix:u,allowClear:d,addonAfter:f,addonBefore:h,className:p,style:m,styles:g,rootClassName:v,onChange:x,classNames:b,variant:w}=t,y=a3(t,["prefixCls","bordered","status","size","disabled","onBlur","onFocus","suffix","allowClear","addonAfter","addonBefore","className","style","styles","rootClassName","onChange","classNames","variant"]),{getPrefixCls:C,direction:I,input:$}=ce.useContext($n),E=C("input",i),N=S.useRef(null),k=Ta(E),[D,_,R]=Kv(E,k),{compactSize:T,compactItemClassnames:A}=hv(E,I),O=kr(se=>{var J;return(J=r??T)!==null&&J!==void 0?J:se}),P=ce.useContext(sf),M=a??P,{status:z,hasFeedback:L,feedbackIcon:W}=S.useContext(br),B=hf(z,o),q=r3(t)||!!L;S.useRef(q);const H=e$(N,!0),ne=se=>{H(),l==null||l(se)},te=se=>{H(),c==null||c(se)},ae=se=>{H(),x==null||x(se)},re=(L||u)&&ce.createElement(ce.Fragment,null,u,L&&W),ee=QI(d??($==null?void 0:$.allowClear)),[j,Y]=Bv("input",w,s);return D(ce.createElement(s3,Object.assign({ref:nf(e,N),prefixCls:E,autoComplete:$==null?void 0:$.autoComplete},y,{disabled:M,onBlur:ne,onFocus:te,style:Object.assign(Object.assign({},$==null?void 0:$.style),m),styles:Object.assign(Object.assign({},$==null?void 0:$.styles),g),suffix:re,allowClear:ee,className:ye(p,v,R,k,A,$==null?void 0:$.className),onChange:ae,addonBefore:h&&ce.createElement(uy,{form:!0,space:!0},h),addonAfter:f&&ce.createElement(uy,{form:!0,space:!0},f),classNames:Object.assign(Object.assign(Object.assign({},b),$==null?void 0:$.classNames),{input:ye({[`${E}-sm`]:O==="small",[`${E}-lg`]:O==="large",[`${E}-rtl`]:I==="rtl"},b==null?void 0:b.input,(n=$==null?void 0:$.classNames)===null||n===void 0?void 0:n.input,_),variant:ye({[`${E}-${j}`]:Y},gh(E,B)),affixWrapper:ye({[`${E}-affix-wrapper-sm`]:O==="small",[`${E}-affix-wrapper-lg`]:O==="large",[`${E}-affix-wrapper-rtl`]:I==="rtl"},_),wrapper:ye({[`${E}-group-rtl`]:I==="rtl"},_),groupWrapper:ye({[`${E}-group-wrapper-sm`]:O==="small",[`${E}-group-wrapper-lg`]:O==="large",[`${E}-group-wrapper-rtl`]:I==="rtl",[`${E}-group-wrapper-${j}`]:Y},gh(`${E}-group-wrapper`,B,L),_)})})))}),c3=t=>{const{componentCls:e,paddingXS:n}=t;return{[e]:{display:"inline-flex",alignItems:"center",flexWrap:"nowrap",columnGap:n,"&-rtl":{direction:"rtl"},[`${e}-input`]:{textAlign:"center",paddingInline:t.paddingXXS},[`&${e}-sm ${e}-input`]:{paddingInline:t.calc(t.paddingXXS).div(2).equal()},[`&${e}-lg ${e}-input`]:{paddingInline:t.paddingXS}}}},u3=Ys(["Input","OTP"],t=>{const e=Si(t,Wv(t));return[c3(e)]},Gv);var d3=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const h3=S.forwardRef((t,e)=>{const{value:n,onChange:i,onActiveChange:s,index:o,mask:r}=t,a=d3(t,["value","onChange","onActiveChange","index","mask"]),l=n&&typeof r=="string"?r:n,c=p=>{i(o,p.target.value)},u=S.useRef(null);S.useImperativeHandle(e,()=>u.current);const d=()=>{Pi(()=>{var p;const m=(p=u.current)===null||p===void 0?void 0:p.input;document.activeElement===m&&m&&m.select()})},f=p=>{let{key:m}=p;m==="ArrowLeft"?s(o-1):m==="ArrowRight"&&s(o+1),d()},h=p=>{p.key==="Backspace"&&!n&&s(o-1),d()};return S.createElement(pf,Object.assign({},a,{ref:u,value:l,onInput:c,onFocus:d,onKeyDown:f,onKeyUp:h,onMouseDown:d,onMouseUp:d,type:r===!0?"password":"text"}))});var f3=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};function Td(t){return(t||"").split("")}const p3=S.forwardRef((t,e)=>{const{prefixCls:n,length:i=6,size:s,defaultValue:o,value:r,onChange:a,formatter:l,variant:c,disabled:u,status:d,autoFocus:f,mask:h}=t,p=f3(t,["prefixCls","length","size","defaultValue","value","onChange","formatter","variant","disabled","status","autoFocus","mask"]),{getPrefixCls:m,direction:g}=S.useContext($n),v=m("otp",n),x=wo(p,{aria:!0,data:!0,attr:!0}),b=Ta(v),[w,y,C]=u3(v,b),I=kr(L=>s??L),$=S.useContext(br),E=hf($.status,d),N=S.useMemo(()=>Object.assign(Object.assign({},$),{status:E,hasFeedback:!1,feedbackIcon:null}),[$,E]),k=S.useRef(null),D=S.useRef({});S.useImperativeHandle(e,()=>({focus:()=>{var L;(L=D.current[0])===null||L===void 0||L.focus()},blur:()=>{var L;for(let W=0;W<i;W+=1)(L=D.current[W])===null||L===void 0||L.blur()},nativeElement:k.current}));const _=L=>l?l(L):L,[R,T]=S.useState(Td(_(o||"")));S.useEffect(()=>{r!==void 0&&T(Td(r))},[r]);const A=ks(L=>{T(L),a&&L.length===i&&L.every(W=>W)&&L.some((W,B)=>R[B]!==W)&&a(L.join(""))}),O=ks((L,W)=>{let B=Ze(R);for(let H=0;H<L;H+=1)B[H]||(B[H]="");W.length<=1?B[L]=W:B=B.slice(0,L).concat(Td(W)),B=B.slice(0,i);for(let H=B.length-1;H>=0&&!B[H];H-=1)B.pop();const q=_(B.map(H=>H||" ").join(""));return B=Td(q).map((H,ne)=>H===" "&&!B[ne]?B[ne]:H),B}),P=(L,W)=>{var B;const q=O(L,W),H=Math.min(L+W.length,i-1);H!==L&&((B=D.current[H])===null||B===void 0||B.focus()),A(q)},M=L=>{var W;(W=D.current[L])===null||W===void 0||W.focus()},z={variant:c,disabled:u,status:E,mask:h};return w(S.createElement("div",Object.assign({},x,{ref:k,className:ye(v,{[`${v}-sm`]:I==="small",[`${v}-lg`]:I==="large",[`${v}-rtl`]:g==="rtl"},C,y)}),S.createElement(br.Provider,{value:N},Array.from({length:i}).map((L,W)=>{const B=`otp-${W}`,q=R[W]||"";return S.createElement(h3,Object.assign({ref:H=>{D.current[W]=H},key:B,index:W,size:I,htmlSize:1,className:`${v}-input`,onChange:P,value:q,onActiveChange:M,autoFocus:W===0&&f},z))}))))});var m3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}},{tag:"path",attrs:{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"}}]},name:"eye-invisible",theme:"outlined"},g3=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:m3}))},v3=S.forwardRef(g3),x3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"},b3=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:x3}))},y3=S.forwardRef(b3),w3=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const C3=t=>t?S.createElement(y3,null):S.createElement(v3,null),S3={click:"onClick",hover:"onMouseOver"},I3=S.forwardRef((t,e)=>{const{disabled:n,action:i="click",visibilityToggle:s=!0,iconRender:o=C3}=t,r=typeof s=="object"&&s.visible!==void 0,[a,l]=S.useState(()=>r?s.visible:!1),c=S.useRef(null);S.useEffect(()=>{r&&l(s.visible)},[r,s]);const u=e$(c),d=()=>{n||(a&&u(),l($=>{var E;const N=!$;return typeof s=="object"&&((E=s.onVisibleChange)===null||E===void 0||E.call(s,N)),N}))},f=$=>{const E=S3[i]||"",N=o(a),k={[E]:d,className:`${$}-icon`,key:"passwordIcon",onMouseDown:D=>{D.preventDefault()},onMouseUp:D=>{D.preventDefault()}};return S.cloneElement(S.isValidElement(N)?N:S.createElement("span",null,N),k)},{className:h,prefixCls:p,inputPrefixCls:m,size:g}=t,v=w3(t,["className","prefixCls","inputPrefixCls","size"]),{getPrefixCls:x}=S.useContext($n),b=x("input",m),w=x("input-password",p),y=s&&f(w),C=ye(w,h,{[`${w}-${g}`]:!!g}),I=Object.assign(Object.assign({},Da(v,["suffix","iconRender","visibilityToggle"])),{type:a?"text":"password",className:C,prefixCls:b,suffix:y});return g&&(I.size=g),S.createElement(pf,Object.assign({ref:nf(e,c)},I))});var $3=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const E3=S.forwardRef((t,e)=>{const{prefixCls:n,inputPrefixCls:i,className:s,size:o,suffix:r,enterButton:a=!1,addonAfter:l,loading:c,disabled:u,onSearch:d,onChange:f,onCompositionStart:h,onCompositionEnd:p}=t,m=$3(t,["prefixCls","inputPrefixCls","className","size","suffix","enterButton","addonAfter","loading","disabled","onSearch","onChange","onCompositionStart","onCompositionEnd"]),{getPrefixCls:g,direction:v}=S.useContext($n),x=S.useRef(!1),b=g("input-search",n),w=g("input",i),{compactSize:y}=hv(b,v),C=kr(z=>{var L;return(L=o??y)!==null&&L!==void 0?L:z}),I=S.useRef(null),$=z=>{z!=null&&z.target&&z.type==="click"&&d&&d(z.target.value,z,{source:"clear"}),f==null||f(z)},E=z=>{var L;document.activeElement===((L=I.current)===null||L===void 0?void 0:L.input)&&z.preventDefault()},N=z=>{var L,W;d&&d((W=(L=I.current)===null||L===void 0?void 0:L.input)===null||W===void 0?void 0:W.value,z,{source:"input"})},k=z=>{x.current||c||N(z)},D=typeof a=="boolean"?S.createElement(Vv,null):null,_=`${b}-button`;let R;const T=a||{},A=T.type&&T.type.__ANT_BUTTON===!0;A||T.type==="button"?R=Mc(T,Object.assign({onMouseDown:E,onClick:z=>{var L,W;(W=(L=T==null?void 0:T.props)===null||L===void 0?void 0:L.onClick)===null||W===void 0||W.call(L,z),N(z)},key:"enterButton"},A?{className:_,size:C}:{})):R=S.createElement(xl,{className:_,type:a?"primary":void 0,size:C,disabled:u,key:"enterButton",onMouseDown:E,onClick:N,loading:c,icon:D},a),l&&(R=[R,Mc(l,{key:"addonAfter"})]);const O=ye(b,{[`${b}-rtl`]:v==="rtl",[`${b}-${C}`]:!!C,[`${b}-with-button`]:!!a},s),P=z=>{x.current=!0,h==null||h(z)},M=z=>{x.current=!1,p==null||p(z)};return S.createElement(pf,Object.assign({ref:nf(I,e),onPressEnter:k},m,{size:C,onCompositionStart:P,onCompositionEnd:M,prefixCls:w,addonAfter:R,suffix:r,onChange:$,className:O,disabled:u}))});var N3=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,k3=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],cm={},ms;function D3(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=t.getAttribute("id")||t.getAttribute("data-reactid")||t.getAttribute("name");if(e&&cm[n])return cm[n];var i=window.getComputedStyle(t),s=i.getPropertyValue("box-sizing")||i.getPropertyValue("-moz-box-sizing")||i.getPropertyValue("-webkit-box-sizing"),o=parseFloat(i.getPropertyValue("padding-bottom"))+parseFloat(i.getPropertyValue("padding-top")),r=parseFloat(i.getPropertyValue("border-bottom-width"))+parseFloat(i.getPropertyValue("border-top-width")),a=k3.map(function(c){return"".concat(c,":").concat(i.getPropertyValue(c))}).join(";"),l={sizingStyle:a,paddingSize:o,borderSize:r,boxSizing:s};return e&&n&&(cm[n]=l),l}function T3(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;ms||(ms=document.createElement("textarea"),ms.setAttribute("tab-index","-1"),ms.setAttribute("aria-hidden","true"),document.body.appendChild(ms)),t.getAttribute("wrap")?ms.setAttribute("wrap",t.getAttribute("wrap")):ms.removeAttribute("wrap");var s=D3(t,e),o=s.paddingSize,r=s.borderSize,a=s.boxSizing,l=s.sizingStyle;ms.setAttribute("style","".concat(l,";").concat(N3)),ms.value=t.value||t.placeholder||"";var c=void 0,u=void 0,d,f=ms.scrollHeight;if(a==="border-box"?f+=r:a==="content-box"&&(f-=o),n!==null||i!==null){ms.value=" ";var h=ms.scrollHeight-o;n!==null&&(c=h*n,a==="border-box"&&(c=c+o+r),f=Math.max(c,f)),i!==null&&(u=h*i,a==="border-box"&&(u=u+o+r),d=f>u?"":"hidden",f=Math.min(u,f))}var p={height:f,overflowY:d,resize:"none"};return c&&(p.minHeight=c),u&&(p.maxHeight=u),p}var R3=["prefixCls","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],um=0,dm=1,hm=2,_3=S.forwardRef(function(t,e){var n=t,i=n.prefixCls,s=n.defaultValue,o=n.value,r=n.autoSize,a=n.onResize,l=n.className,c=n.style,u=n.disabled,d=n.onChange;n.onInternalAutoSize;var f=In(n,R3),h=Wo(s,{value:o,postState:function(q){return q??""}}),p=ke(h,2),m=p[0],g=p[1],v=function(q){g(q.target.value),d==null||d(q)},x=S.useRef();S.useImperativeHandle(e,function(){return{textArea:x.current}});var b=S.useMemo(function(){return r&&_n(r)==="object"?[r.minRows,r.maxRows]:[]},[r]),w=ke(b,2),y=w[0],C=w[1],I=!!r,$=function(){try{if(document.activeElement===x.current){var q=x.current,H=q.selectionStart,ne=q.selectionEnd,te=q.scrollTop;x.current.setSelectionRange(H,ne),x.current.scrollTop=te}}catch{}},E=S.useState(hm),N=ke(E,2),k=N[0],D=N[1],_=S.useState(),R=ke(_,2),T=R[0],A=R[1],O=function(){D(um)};Ki(function(){I&&O()},[o,y,C,I]),Ki(function(){if(k===um)D(dm);else if(k===dm){var B=T3(x.current,!1,y,C);D(hm),A(B)}else $()},[k]);var P=S.useRef(),M=function(){Pi.cancel(P.current)},z=function(q){k===hm&&(a==null||a(q),r&&(M(),P.current=Pi(function(){O()})))};S.useEffect(function(){return M},[]);var L=I?T:null,W=me(me({},c),L);return(k===um||k===dm)&&(W.overflowY="hidden",W.overflowX="hidden"),S.createElement(Wl,{onResize:z,disabled:!(r||a)},S.createElement("textarea",Ve({},f,{ref:x,style:W,className:ye(i,l,X({},"".concat(i,"-disabled"),u)),disabled:u,value:m,onChange:v})))}),A3=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","showCount","count","className","style","disabled","hidden","classNames","styles","onResize","onClear","onPressEnter","readOnly","autoSize","onKeyDown"],O3=ce.forwardRef(function(t,e){var n,i=t.defaultValue,s=t.value,o=t.onFocus,r=t.onBlur,a=t.onChange,l=t.allowClear,c=t.maxLength,u=t.onCompositionStart,d=t.onCompositionEnd,f=t.suffix,h=t.prefixCls,p=h===void 0?"rc-textarea":h,m=t.showCount,g=t.count,v=t.className,x=t.style,b=t.disabled,w=t.hidden,y=t.classNames,C=t.styles,I=t.onResize,$=t.onClear,E=t.onPressEnter,N=t.readOnly,k=t.autoSize,D=t.onKeyDown,_=In(t,A3),R=Wo(i,{value:s,defaultValue:i}),T=ke(R,2),A=T[0],O=T[1],P=A==null?"":String(A),M=ce.useState(!1),z=ke(M,2),L=z[0],W=z[1],B=ce.useRef(!1),q=ce.useState(null),H=ke(q,2),ne=H[0],te=H[1],ae=S.useRef(null),re=S.useRef(null),ee=function(){var Pe;return(Pe=re.current)===null||Pe===void 0?void 0:Pe.textArea},j=function(){ee().focus()};S.useImperativeHandle(e,function(){var Le;return{resizableTextArea:re.current,focus:j,blur:function(){ee().blur()},nativeElement:((Le=ae.current)===null||Le===void 0?void 0:Le.nativeElement)||ee()}}),S.useEffect(function(){W(function(Le){return!b&&Le})},[b]);var Y=ce.useState(null),se=ke(Y,2),J=se[0],ue=se[1];ce.useEffect(function(){if(J){var Le;(Le=ee()).setSelectionRange.apply(Le,Ze(J))}},[J]);var oe=ZI(g,m),be=(n=oe.max)!==null&&n!==void 0?n:c,de=Number(be)>0,Ie=oe.strategy(P),ge=!!be&&Ie>be,$e=function(Pe,ut){var ht=ut;!B.current&&oe.exceedFormatter&&oe.max&&oe.strategy(ut)>oe.max&&(ht=oe.exceedFormatter(ut,{max:oe.max}),ut!==ht&&ue([ee().selectionStart||0,ee().selectionEnd||0])),O(ht),vh(Pe.currentTarget,Pe,a,ht)},De=function(Pe){B.current=!0,u==null||u(Pe)},ve=function(Pe){B.current=!1,$e(Pe,Pe.currentTarget.value),d==null||d(Pe)},we=function(Pe){$e(Pe,Pe.target.value)},Re=function(Pe){Pe.key==="Enter"&&E&&E(Pe),D==null||D(Pe)},Ne=function(Pe){W(!0),o==null||o(Pe)},Ke=function(Pe){W(!1),r==null||r(Pe)},We=function(Pe){O(""),j(),vh(ee(),Pe,a)},ct=f,Ee;oe.show&&(oe.showFormatter?Ee=oe.showFormatter({value:P,count:Ie,maxLength:be}):Ee="".concat(Ie).concat(de?" / ".concat(be):""),ct=ce.createElement(ce.Fragment,null,ct,ce.createElement("span",{className:ye("".concat(p,"-data-count"),y==null?void 0:y.count),style:C==null?void 0:C.count},Ee)));var lt=function(Pe){var ut;I==null||I(Pe),(ut=ee())!==null&&ut!==void 0&&ut.style.height&&te(!0)},Xe=!k&&!m&&!l;return ce.createElement(JI,{ref:ae,value:P,allowClear:l,handleReset:We,suffix:ct,prefixCls:p,classNames:me(me({},y),{},{affixWrapper:ye(y==null?void 0:y.affixWrapper,X(X({},"".concat(p,"-show-count"),m),"".concat(p,"-textarea-allow-clear"),l))}),disabled:b,focused:L,className:ye(v,ge&&"".concat(p,"-out-of-range")),style:me(me({},x),ne&&!Xe?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":typeof Ee=="string"?Ee:void 0}},hidden:w,readOnly:N,onClear:$},ce.createElement(_3,Ve({},_,{autoSize:k,maxLength:c,onKeyDown:Re,onChange:we,onFocus:Ne,onBlur:Ke,onCompositionStart:De,onCompositionEnd:ve,className:ye(y==null?void 0:y.textarea),style:me(me({},C==null?void 0:C.textarea),{},{resize:x==null?void 0:x.resize}),disabled:b,prefixCls:p,onResize:lt,ref:re,readOnly:N})))}),P3=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const M3=S.forwardRef((t,e)=>{var n,i;const{prefixCls:s,bordered:o=!0,size:r,disabled:a,status:l,allowClear:c,classNames:u,rootClassName:d,className:f,style:h,styles:p,variant:m}=t,g=P3(t,["prefixCls","bordered","size","disabled","status","allowClear","classNames","rootClassName","className","style","styles","variant"]),{getPrefixCls:v,direction:x,textArea:b}=S.useContext($n),w=kr(r),y=S.useContext(sf),C=a??y,{status:I,hasFeedback:$,feedbackIcon:E}=S.useContext(br),N=hf(I,l),k=S.useRef(null);S.useImperativeHandle(e,()=>{var z;return{resizableTextArea:(z=k.current)===null||z===void 0?void 0:z.resizableTextArea,focus:L=>{var W,B;l3((B=(W=k.current)===null||W===void 0?void 0:W.resizableTextArea)===null||B===void 0?void 0:B.textArea,L)},blur:()=>{var L;return(L=k.current)===null||L===void 0?void 0:L.blur()}}});const D=v("input",s),_=Ta(D),[R,T,A]=Kv(D,_),[O,P]=Bv("textArea",m,o),M=QI(c??(b==null?void 0:b.allowClear));return R(S.createElement(O3,Object.assign({autoComplete:b==null?void 0:b.autoComplete},g,{style:Object.assign(Object.assign({},b==null?void 0:b.style),h),styles:Object.assign(Object.assign({},b==null?void 0:b.styles),p),disabled:C,allowClear:M,className:ye(A,_,f,d,b==null?void 0:b.className),classNames:Object.assign(Object.assign(Object.assign({},u),b==null?void 0:b.classNames),{textarea:ye({[`${D}-sm`]:w==="small",[`${D}-lg`]:w==="large"},T,u==null?void 0:u.textarea,(n=b==null?void 0:b.classNames)===null||n===void 0?void 0:n.textarea),variant:ye({[`${D}-${O}`]:P},gh(D,N)),affixWrapper:ye(`${D}-textarea-affix-wrapper`,{[`${D}-affix-wrapper-rtl`]:x==="rtl",[`${D}-affix-wrapper-sm`]:w==="small",[`${D}-affix-wrapper-lg`]:w==="large",[`${D}-textarea-show-count`]:t.showCount||((i=t.count)===null||i===void 0?void 0:i.show)},T)}),prefixCls:D,suffix:$&&S.createElement("span",{className:`${D}-textarea-suffix`},E),ref:k})))}),jl=pf;jl.Group=o3;jl.Search=E3;jl.TextArea=M3;jl.Password=I3;jl.OTP=p3;function lw(t){var e=t.getBoundingClientRect(),n=document.documentElement;return{left:e.left+(window.pageXOffset||n.scrollLeft)-(n.clientLeft||document.body.clientLeft||0),top:e.top+(window.pageYOffset||n.scrollTop)-(n.clientTop||document.body.clientTop||0)}}function Rd(t,e,n,i){var s=jm.unstable_batchedUpdates?function(r){jm.unstable_batchedUpdates(n,r)}:n;return t!=null&&t.addEventListener&&t.addEventListener(e,s,i),{remove:function(){t!=null&&t.removeEventListener&&t.removeEventListener(e,s,i)}}}const t$=function(){const t=Object.assign({},arguments.length<=0?void 0:arguments[0]);for(let e=1;e<arguments.length;e++){const n=e<0||arguments.length<=e?void 0:arguments[e];n&&Object.keys(n).forEach(i=>{const s=n[i];s!==void 0&&(t[i]=s)})}return t};var F3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M272.9 512l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L186.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H532c6.7 0 10.4-7.7 6.3-12.9L272.9 512zm304 0l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L490.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H836c6.7 0 10.4-7.7 6.3-12.9L576.9 512z"}}]},name:"double-left",theme:"outlined"},L3=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:F3}))},cw=S.forwardRef(L3),z3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M533.2 492.3L277.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H188c-6.7 0-10.4 7.7-6.3 12.9L447.1 512 181.7 851.1A7.98 7.98 0 00188 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5zm304 0L581.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H492c-6.7 0-10.4 7.7-6.3 12.9L751.1 512 485.7 851.1A7.98 7.98 0 00492 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5z"}}]},name:"double-right",theme:"outlined"},B3=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:z3}))},uw=S.forwardRef(B3),V3={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"},W3=["10","20","50","100"],G3=function(e){var n=e.pageSizeOptions,i=n===void 0?W3:n,s=e.locale,o=e.changeSize,r=e.pageSize,a=e.goButton,l=e.quickGo,c=e.rootPrefixCls,u=e.selectComponentClass,d=e.selectPrefixCls,f=e.disabled,h=e.buildOptionText,p=ce.useState(""),m=ke(p,2),g=m[0],v=m[1],x=function(){return!g||Number.isNaN(g)?void 0:Number(g)},b=typeof h=="function"?h:function(R){return"".concat(R," ").concat(s.items_per_page)},w=function(T){o==null||o(Number(T))},y=function(T){v(T.target.value)},C=function(T){a||g===""||(v(""),!(T.relatedTarget&&(T.relatedTarget.className.indexOf("".concat(c,"-item-link"))>=0||T.relatedTarget.className.indexOf("".concat(c,"-item"))>=0))&&(l==null||l(x())))},I=function(T){g!==""&&(T.keyCode===et.ENTER||T.type==="click")&&(v(""),l==null||l(x()))},$=function(){return i.some(function(T){return T.toString()===r.toString()})?i:i.concat([r.toString()]).sort(function(T,A){var O=Number.isNaN(Number(T))?0:Number(T),P=Number.isNaN(Number(A))?0:Number(A);return O-P})},E="".concat(c,"-options");if(!o&&!l)return null;var N=null,k=null,D=null;if(o&&u){var _=$().map(function(R,T){return ce.createElement(u.Option,{key:T,value:R.toString()},b(R))});N=ce.createElement(u,{disabled:f,prefixCls:d,showSearch:!1,className:"".concat(E,"-size-changer"),optionLabelProp:"children",popupMatchSelectWidth:!1,value:(r||i[0]).toString(),onChange:w,getPopupContainer:function(T){return T.parentNode},"aria-label":s.page_size,defaultOpen:!1},_)}return l&&(a&&(D=typeof a=="boolean"?ce.createElement("button",{type:"button",onClick:I,onKeyUp:I,disabled:f,className:"".concat(E,"-quick-jumper-button")},s.jump_to_confirm):ce.createElement("span",{onClick:I,onKeyUp:I},a)),k=ce.createElement("div",{className:"".concat(E,"-quick-jumper")},s.jump_to,ce.createElement("input",{disabled:f,type:"text",value:g,onChange:y,onKeyUp:I,onBlur:C,"aria-label":s.page}),s.page,D)),ce.createElement("li",{className:E},N,k)},fc=function(e){var n,i=e.rootPrefixCls,s=e.page,o=e.active,r=e.className,a=e.showTitle,l=e.onClick,c=e.onKeyPress,u=e.itemRender,d="".concat(i,"-item"),f=ye(d,"".concat(d,"-").concat(s),(n={},X(n,"".concat(d,"-active"),o),X(n,"".concat(d,"-disabled"),!s),n),r),h=function(){l(s)},p=function(v){c(v,l,s)},m=u(s,"page",ce.createElement("a",{rel:"nofollow"},s));return m?ce.createElement("li",{title:a?String(s):null,className:f,onClick:h,onKeyDown:p,tabIndex:0},m):null},H3=function(e,n,i){return i};function dw(){}function hw(t){var e=Number(t);return typeof e=="number"&&!Number.isNaN(e)&&isFinite(e)&&Math.floor(e)===e}function Gr(t,e,n){var i=typeof t>"u"?e:t;return Math.floor((n-1)/i)+1}var U3=function(e){var n,i=e.prefixCls,s=i===void 0?"rc-pagination":i,o=e.selectPrefixCls,r=o===void 0?"rc-select":o,a=e.className,l=e.selectComponentClass,c=e.current,u=e.defaultCurrent,d=u===void 0?1:u,f=e.total,h=f===void 0?0:f,p=e.pageSize,m=e.defaultPageSize,g=m===void 0?10:m,v=e.onChange,x=v===void 0?dw:v,b=e.hideOnSinglePage,w=e.align,y=e.showPrevNextJumpers,C=y===void 0?!0:y,I=e.showQuickJumper,$=e.showLessItems,E=e.showTitle,N=E===void 0?!0:E,k=e.onShowSizeChange,D=k===void 0?dw:k,_=e.locale,R=_===void 0?V3:_,T=e.style,A=e.totalBoundaryShowSizeChanger,O=A===void 0?50:A,P=e.disabled,M=e.simple,z=e.showTotal,L=e.showSizeChanger,W=e.pageSizeOptions,B=e.itemRender,q=B===void 0?H3:B,H=e.jumpPrevIcon,ne=e.jumpNextIcon,te=e.prevIcon,ae=e.nextIcon,re=ce.useRef(null),ee=Wo(10,{value:p,defaultValue:g}),j=ke(ee,2),Y=j[0],se=j[1],J=Wo(1,{value:c,defaultValue:d,postState:function(wt){return Math.max(1,Math.min(wt,Gr(void 0,Y,h)))}}),ue=ke(J,2),oe=ue[0],be=ue[1],de=ce.useState(oe),Ie=ke(de,2),ge=Ie[0],$e=Ie[1];S.useEffect(function(){$e(oe)},[oe]);var De=Math.max(1,oe-($?3:5)),ve=Math.min(Gr(void 0,Y,h),oe+($?3:5));function we(it,wt){var nn=it||ce.createElement("button",{type:"button","aria-label":wt,className:"".concat(s,"-item-link")});return typeof it=="function"&&(nn=ce.createElement(it,me({},e))),nn}function Re(it){var wt=it.target.value,nn=Gr(void 0,Y,h),ts;return wt===""?ts=wt:Number.isNaN(Number(wt))?ts=ge:wt>=nn?ts=nn:ts=Number(wt),ts}function Ne(it){return hw(it)&&it!==oe&&hw(h)&&h>0}var Ke=h>Y?I:!1;function We(it){(it.keyCode===et.UP||it.keyCode===et.DOWN)&&it.preventDefault()}function ct(it){var wt=Re(it);switch(wt!==ge&&$e(wt),it.keyCode){case et.ENTER:Xe(wt);break;case et.UP:Xe(wt-1);break;case et.DOWN:Xe(wt+1);break}}function Ee(it){Xe(Re(it))}function lt(it){var wt=Gr(it,Y,h),nn=oe>wt&&wt!==0?wt:oe;se(it),$e(nn),D==null||D(oe,it),be(nn),x==null||x(nn,it)}function Xe(it){if(Ne(it)&&!P){var wt=Gr(void 0,Y,h),nn=it;return it>wt?nn=wt:it<1&&(nn=1),nn!==ge&&$e(nn),be(nn),x==null||x(nn,Y),nn}return oe}var Le=oe>1,Pe=oe<Gr(void 0,Y,h),ut=L??h>O;function ht(){Le&&Xe(oe-1)}function Pt(){Pe&&Xe(oe+1)}function ft(){Xe(De)}function Jn(){Xe(ve)}function Ut(it,wt){if(it.key==="Enter"||it.charCode===et.ENTER||it.keyCode===et.ENTER){for(var nn=arguments.length,ts=new Array(nn>2?nn-2:0),To=2;To<nn;To++)ts[To-2]=arguments[To];wt.apply(void 0,ts)}}function vi(it){Ut(it,ht)}function Mt(it){Ut(it,Pt)}function ki(it){Ut(it,ft)}function un(it){Ut(it,Jn)}function dn(it){var wt=q(it,"prev",we(te,"prev page"));return ce.isValidElement(wt)?ce.cloneElement(wt,{disabled:!Le}):wt}function gn(it){var wt=q(it,"next",we(ae,"next page"));return ce.isValidElement(wt)?ce.cloneElement(wt,{disabled:!Pe}):wt}function Gn(it){(it.type==="click"||it.keyCode===et.ENTER)&&Xe(ge)}var Tt=null,Yt=wo(e,{aria:!0,data:!0}),jt=z&&ce.createElement("li",{className:"".concat(s,"-total-text")},z(h,[h===0?0:(oe-1)*Y+1,oe*Y>h?h:oe*Y])),Be=null,ze=Gr(void 0,Y,h);if(b&&h<=Y)return null;var Oe=[],qe={rootPrefixCls:s,onClick:Xe,onKeyPress:Ut,showTitle:N,itemRender:q,page:-1},Dt=oe-1>0?oe-1:0,Rt=oe+1<ze?oe+1:ze,vn=I&&I.goButton,Je=_n(M)==="object"?M.readOnly:!M,dt=vn,st=null;M&&(vn&&(typeof vn=="boolean"?dt=ce.createElement("button",{type:"button",onClick:Gn,onKeyUp:Gn},R.jump_to_confirm):dt=ce.createElement("span",{onClick:Gn,onKeyUp:Gn},vn),dt=ce.createElement("li",{title:N?"".concat(R.jump_to).concat(oe,"/").concat(ze):null,className:"".concat(s,"-simple-pager")},dt)),st=ce.createElement("li",{title:N?"".concat(oe,"/").concat(ze):null,className:"".concat(s,"-simple-pager")},Je?ge:ce.createElement("input",{type:"text",value:ge,disabled:P,onKeyDown:We,onKeyUp:ct,onChange:ct,onBlur:Ee,size:3}),ce.createElement("span",{className:"".concat(s,"-slash")},"/"),ze));var vt=$?1:2;if(ze<=3+vt*2){ze||Oe.push(ce.createElement(fc,Ve({},qe,{key:"noPager",page:1,className:"".concat(s,"-item-disabled")})));for(var Kt=1;Kt<=ze;Kt+=1)Oe.push(ce.createElement(fc,Ve({},qe,{key:Kt,page:Kt,active:oe===Kt})))}else{var hn=$?R.prev_3:R.prev_5,An=$?R.next_3:R.next_5,Xt=q(De,"jump-prev",we(H,"prev page")),Ue=q(ve,"jump-next",we(ne,"next page"));C&&(Tt=Xt?ce.createElement("li",{title:N?hn:null,key:"prev",onClick:ft,tabIndex:0,onKeyDown:ki,className:ye("".concat(s,"-jump-prev"),X({},"".concat(s,"-jump-prev-custom-icon"),!!H))},Xt):null,Be=Ue?ce.createElement("li",{title:N?An:null,key:"next",onClick:Jn,tabIndex:0,onKeyDown:un,className:ye("".concat(s,"-jump-next"),X({},"".concat(s,"-jump-next-custom-icon"),!!ne))},Ue):null);var je=Math.max(1,oe-vt),yt=Math.min(oe+vt,ze);oe-1<=vt&&(yt=1+vt*2),ze-oe<=vt&&(je=ze-vt*2);for(var Ft=je;Ft<=yt;Ft+=1)Oe.push(ce.createElement(fc,Ve({},qe,{key:Ft,page:Ft,active:oe===Ft})));if(oe-1>=vt*2&&oe!==3&&(Oe[0]=ce.cloneElement(Oe[0],{className:ye("".concat(s,"-item-after-jump-prev"),Oe[0].props.className)}),Oe.unshift(Tt)),ze-oe>=vt*2&&oe!==ze-2){var Zn=Oe[Oe.length-1];Oe[Oe.length-1]=ce.cloneElement(Zn,{className:ye("".concat(s,"-item-before-jump-next"),Zn.props.className)}),Oe.push(Be)}je!==1&&Oe.unshift(ce.createElement(fc,Ve({},qe,{key:1,page:1}))),yt!==ze&&Oe.push(ce.createElement(fc,Ve({},qe,{key:ze,page:ze})))}var Di=dn(Dt);if(Di){var es=!Le||!ze;Di=ce.createElement("li",{title:N?R.prev_page:null,onClick:ht,tabIndex:es?null:0,onKeyDown:vi,className:ye("".concat(s,"-prev"),X({},"".concat(s,"-disabled"),es)),"aria-disabled":es},Di)}var Ms=gn(Rt);if(Ms){var Fs,ds;M?(Fs=!Pe,ds=Le?0:null):(Fs=!Pe||!ze,ds=Fs?null:0),Ms=ce.createElement("li",{title:N?R.next_page:null,onClick:Pt,tabIndex:ds,onKeyDown:Mt,className:ye("".concat(s,"-next"),X({},"".concat(s,"-disabled"),Fs)),"aria-disabled":Fs},Ms)}var Do=ye(s,a,(n={},X(n,"".concat(s,"-start"),w==="start"),X(n,"".concat(s,"-center"),w==="center"),X(n,"".concat(s,"-end"),w==="end"),X(n,"".concat(s,"-simple"),M),X(n,"".concat(s,"-disabled"),P),n));return ce.createElement("ul",Ve({className:Do,style:T,ref:re},Yt),jt,Di,M?st:Oe,Ms,ce.createElement(G3,{locale:R,rootPrefixCls:s,disabled:P,selectComponentClass:l,selectPrefixCls:r,changeSize:ut?lt:null,pageSize:Y,pageSizeOptions:W,quickGo:Ke?Xe:null,goButton:dt}))};const n$=t=>S.createElement(Jo,Object.assign({},t,{showSearch:!0,size:"small"})),i$=t=>S.createElement(Jo,Object.assign({},t,{showSearch:!0,size:"middle"}));n$.Option=Jo.Option;i$.Option=Jo.Option;const j3=t=>{const{componentCls:e}=t;return{[`${e}-disabled`]:{"&, &:hover":{cursor:"not-allowed",[`${e}-item-link`]:{color:t.colorTextDisabled,cursor:"not-allowed"}},"&:focus-visible":{cursor:"not-allowed",[`${e}-item-link`]:{color:t.colorTextDisabled,cursor:"not-allowed"}}},[`&${e}-disabled`]:{cursor:"not-allowed",[`${e}-item`]:{cursor:"not-allowed","&:hover, &:active":{backgroundColor:"transparent"},a:{color:t.colorTextDisabled,backgroundColor:"transparent",border:"none",cursor:"not-allowed"},"&-active":{borderColor:t.colorBorder,backgroundColor:t.itemActiveBgDisabled,"&:hover, &:active":{backgroundColor:t.itemActiveBgDisabled},a:{color:t.itemActiveColorDisabled}}},[`${e}-item-link`]:{color:t.colorTextDisabled,cursor:"not-allowed","&:hover, &:active":{backgroundColor:"transparent"},[`${e}-simple&`]:{backgroundColor:"transparent","&:hover, &:active":{backgroundColor:"transparent"}}},[`${e}-simple-pager`]:{color:t.colorTextDisabled},[`${e}-jump-prev, ${e}-jump-next`]:{[`${e}-item-link-icon`]:{opacity:0},[`${e}-item-ellipsis`]:{opacity:1}}},[`&${e}-simple`]:{[`${e}-prev, ${e}-next`]:{[`&${e}-disabled ${e}-item-link`]:{"&:hover, &:active":{backgroundColor:"transparent"}}}}}},K3=t=>{const{componentCls:e}=t;return{[`&${e}-mini ${e}-total-text, &${e}-mini ${e}-simple-pager`]:{height:t.itemSizeSM,lineHeight:he(t.itemSizeSM)},[`&${e}-mini ${e}-item`]:{minWidth:t.itemSizeSM,height:t.itemSizeSM,margin:0,lineHeight:he(t.calc(t.itemSizeSM).sub(2).equal())},[`&${e}-mini:not(${e}-disabled) ${e}-item:not(${e}-item-active)`]:{backgroundColor:"transparent",borderColor:"transparent","&:hover":{backgroundColor:t.colorBgTextHover},"&:active":{backgroundColor:t.colorBgTextActive}},[`&${e}-mini ${e}-prev, &${e}-mini ${e}-next`]:{minWidth:t.itemSizeSM,height:t.itemSizeSM,margin:0,lineHeight:he(t.itemSizeSM)},[`&${e}-mini:not(${e}-disabled)`]:{[`${e}-prev, ${e}-next`]:{[`&:hover ${e}-item-link`]:{backgroundColor:t.colorBgTextHover},[`&:active ${e}-item-link`]:{backgroundColor:t.colorBgTextActive},[`&${e}-disabled:hover ${e}-item-link`]:{backgroundColor:"transparent"}}},[`
    &${e}-mini ${e}-prev ${e}-item-link,
    &${e}-mini ${e}-next ${e}-item-link
    `]:{backgroundColor:"transparent",borderColor:"transparent","&::after":{height:t.itemSizeSM,lineHeight:he(t.itemSizeSM)}},[`&${e}-mini ${e}-jump-prev, &${e}-mini ${e}-jump-next`]:{height:t.itemSizeSM,marginInlineEnd:0,lineHeight:he(t.itemSizeSM)},[`&${e}-mini ${e}-options`]:{marginInlineStart:t.paginationMiniOptionsMarginInlineStart,"&-size-changer":{top:t.miniOptionsSizeChangerTop},"&-quick-jumper":{height:t.itemSizeSM,lineHeight:he(t.itemSizeSM),input:Object.assign(Object.assign({},Uv(t)),{width:t.paginationMiniQuickJumperInputWidth,height:t.controlHeightSM})}}}},X3=t=>{const{componentCls:e}=t;return{[`
    &${e}-simple ${e}-prev,
    &${e}-simple ${e}-next
    `]:{height:t.itemSizeSM,lineHeight:he(t.itemSizeSM),verticalAlign:"top",[`${e}-item-link`]:{height:t.itemSizeSM,backgroundColor:"transparent",border:0,"&:hover":{backgroundColor:t.colorBgTextHover},"&:active":{backgroundColor:t.colorBgTextActive},"&::after":{height:t.itemSizeSM,lineHeight:he(t.itemSizeSM)}}},[`&${e}-simple ${e}-simple-pager`]:{display:"inline-block",height:t.itemSizeSM,marginInlineEnd:t.marginXS,input:{boxSizing:"border-box",height:"100%",padding:`0 ${he(t.paginationItemPaddingInline)}`,textAlign:"center",backgroundColor:t.itemInputBg,border:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderRadius:t.borderRadius,outline:"none",transition:`border-color ${t.motionDurationMid}`,color:"inherit","&:hover":{borderColor:t.colorPrimary},"&:focus":{borderColor:t.colorPrimaryHover,boxShadow:`${he(t.inputOutlineOffset)} 0 ${he(t.controlOutlineWidth)} ${t.controlOutline}`},"&[disabled]":{color:t.colorTextDisabled,backgroundColor:t.colorBgContainerDisabled,borderColor:t.colorBorder,cursor:"not-allowed"}}}}},q3=t=>{const{componentCls:e}=t;return{[`${e}-jump-prev, ${e}-jump-next`]:{outline:0,[`${e}-item-container`]:{position:"relative",[`${e}-item-link-icon`]:{color:t.colorPrimary,fontSize:t.fontSizeSM,opacity:0,transition:`all ${t.motionDurationMid}`,"&-svg":{top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,margin:"auto"}},[`${e}-item-ellipsis`]:{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,display:"block",margin:"auto",color:t.colorTextDisabled,fontFamily:"Arial, Helvetica, sans-serif",letterSpacing:t.paginationEllipsisLetterSpacing,textAlign:"center",textIndent:t.paginationEllipsisTextIndent,opacity:1,transition:`all ${t.motionDurationMid}`}},"&:hover":{[`${e}-item-link-icon`]:{opacity:1},[`${e}-item-ellipsis`]:{opacity:0}}},[`
    ${e}-prev,
    ${e}-jump-prev,
    ${e}-jump-next
    `]:{marginInlineEnd:t.marginXS},[`
    ${e}-prev,
    ${e}-next,
    ${e}-jump-prev,
    ${e}-jump-next
    `]:{display:"inline-block",minWidth:t.itemSize,height:t.itemSize,color:t.colorText,fontFamily:t.fontFamily,lineHeight:he(t.itemSize),textAlign:"center",verticalAlign:"middle",listStyle:"none",borderRadius:t.borderRadius,cursor:"pointer",transition:`all ${t.motionDurationMid}`},[`${e}-prev, ${e}-next`]:{fontFamily:"Arial, Helvetica, sans-serif",outline:0,button:{color:t.colorText,cursor:"pointer",userSelect:"none"},[`${e}-item-link`]:{display:"block",width:"100%",height:"100%",padding:0,fontSize:t.fontSizeSM,textAlign:"center",backgroundColor:"transparent",border:`${he(t.lineWidth)} ${t.lineType} transparent`,borderRadius:t.borderRadius,outline:"none",transition:`all ${t.motionDurationMid}`},[`&:hover ${e}-item-link`]:{backgroundColor:t.colorBgTextHover},[`&:active ${e}-item-link`]:{backgroundColor:t.colorBgTextActive},[`&${e}-disabled:hover`]:{[`${e}-item-link`]:{backgroundColor:"transparent"}}},[`${e}-slash`]:{marginInlineEnd:t.paginationSlashMarginInlineEnd,marginInlineStart:t.paginationSlashMarginInlineStart},[`${e}-options`]:{display:"inline-block",marginInlineStart:t.margin,verticalAlign:"middle","&-size-changer":{display:"inline-block",width:"auto"},"&-quick-jumper":{display:"inline-block",height:t.controlHeight,marginInlineStart:t.marginXS,lineHeight:he(t.controlHeight),verticalAlign:"top",input:Object.assign(Object.assign(Object.assign({},jv(t)),Hv(t,{borderColor:t.colorBorder,hoverBorderColor:t.colorPrimaryHover,activeBorderColor:t.colorPrimary,activeShadow:t.activeShadow})),{"&[disabled]":Object.assign({},ff(t)),width:t.calc(t.controlHeightLG).mul(1.25).equal(),height:t.controlHeight,boxSizing:"border-box",margin:0,marginInlineStart:t.marginXS,marginInlineEnd:t.marginXS})}}}},Y3=t=>{const{componentCls:e}=t;return{[`${e}-item`]:{display:"inline-block",minWidth:t.itemSize,height:t.itemSize,marginInlineEnd:t.marginXS,fontFamily:t.fontFamily,lineHeight:he(t.calc(t.itemSize).sub(2).equal()),textAlign:"center",verticalAlign:"middle",listStyle:"none",backgroundColor:t.itemBg,border:`${he(t.lineWidth)} ${t.lineType} transparent`,borderRadius:t.borderRadius,outline:0,cursor:"pointer",userSelect:"none",a:{display:"block",padding:`0 ${he(t.paginationItemPaddingInline)}`,color:t.colorText,"&:hover":{textDecoration:"none"}},[`&:not(${e}-item-active)`]:{"&:hover":{transition:`all ${t.motionDurationMid}`,backgroundColor:t.colorBgTextHover},"&:active":{backgroundColor:t.colorBgTextActive}},"&-active":{fontWeight:t.fontWeightStrong,backgroundColor:t.itemActiveBg,borderColor:t.colorPrimary,a:{color:t.colorPrimary},"&:hover":{borderColor:t.colorPrimaryHover},"&:hover a":{color:t.colorPrimaryHover}}}}},J3=t=>{const{componentCls:e}=t;return{[e]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},os(t)),{display:"flex","&-start":{justifyContent:"start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"end"},"ul, ol":{margin:0,padding:0,listStyle:"none"},"&::after":{display:"block",clear:"both",height:0,overflow:"hidden",visibility:"hidden",content:'""'},[`${e}-total-text`]:{display:"inline-block",height:t.itemSize,marginInlineEnd:t.marginXS,lineHeight:he(t.calc(t.itemSize).sub(2).equal()),verticalAlign:"middle"}}),Y3(t)),q3(t)),X3(t)),K3(t)),j3(t)),{[`@media only screen and (max-width: ${t.screenLG}px)`]:{[`${e}-item`]:{"&-after-jump-prev, &-before-jump-next":{display:"none"}}},[`@media only screen and (max-width: ${t.screenSM}px)`]:{[`${e}-options`]:{display:"none"}}}),[`&${t.componentCls}-rtl`]:{direction:"rtl"}}},Z3=t=>{const{componentCls:e}=t;return{[`${e}:not(${e}-disabled)`]:{[`${e}-item`]:Object.assign({},O_(t)),[`${e}-jump-prev, ${e}-jump-next`]:{"&:focus-visible":Object.assign({[`${e}-item-link-icon`]:{opacity:1},[`${e}-item-ellipsis`]:{opacity:0}},hh(t))},[`${e}-prev, ${e}-next`]:{[`&:focus-visible ${e}-item-link`]:Object.assign({},hh(t))}}}},s$=t=>Object.assign({itemBg:t.colorBgContainer,itemSize:t.controlHeight,itemSizeSM:t.controlHeightSM,itemActiveBg:t.colorBgContainer,itemLinkBg:t.colorBgContainer,itemActiveColorDisabled:t.colorTextDisabled,itemActiveBgDisabled:t.controlItemBgActiveDisabled,itemInputBg:t.colorBgContainer,miniOptionsSizeChangerTop:0},Gv(t)),o$=t=>Si(t,{inputOutlineOffset:0,paginationMiniOptionsMarginInlineStart:t.calc(t.marginXXS).div(2).equal(),paginationMiniQuickJumperInputWidth:t.calc(t.controlHeightLG).mul(1.1).equal(),paginationItemPaddingInline:t.calc(t.marginXXS).mul(1.5).equal(),paginationEllipsisLetterSpacing:t.calc(t.marginXXS).div(2).equal(),paginationSlashMarginInlineStart:t.marginSM,paginationSlashMarginInlineEnd:t.marginSM,paginationEllipsisTextIndent:"0.13em"},Wv(t)),Q3=Ys("Pagination",t=>{const e=o$(t);return[J3(e),Z3(e)]},s$),eB=t=>{const{componentCls:e}=t;return{[`${e}${e}-bordered${e}-disabled:not(${e}-mini)`]:{"&, &:hover":{[`${e}-item-link`]:{borderColor:t.colorBorder}},"&:focus-visible":{[`${e}-item-link`]:{borderColor:t.colorBorder}},[`${e}-item, ${e}-item-link`]:{backgroundColor:t.colorBgContainerDisabled,borderColor:t.colorBorder,[`&:hover:not(${e}-item-active)`]:{backgroundColor:t.colorBgContainerDisabled,borderColor:t.colorBorder,a:{color:t.colorTextDisabled}},[`&${e}-item-active`]:{backgroundColor:t.itemActiveBgDisabled}},[`${e}-prev, ${e}-next`]:{"&:hover button":{backgroundColor:t.colorBgContainerDisabled,borderColor:t.colorBorder,color:t.colorTextDisabled},[`${e}-item-link`]:{backgroundColor:t.colorBgContainerDisabled,borderColor:t.colorBorder}}},[`${e}${e}-bordered:not(${e}-mini)`]:{[`${e}-prev, ${e}-next`]:{"&:hover button":{borderColor:t.colorPrimaryHover,backgroundColor:t.itemBg},[`${e}-item-link`]:{backgroundColor:t.itemLinkBg,borderColor:t.colorBorder},[`&:hover ${e}-item-link`]:{borderColor:t.colorPrimary,backgroundColor:t.itemBg,color:t.colorPrimary},[`&${e}-disabled`]:{[`${e}-item-link`]:{borderColor:t.colorBorder,color:t.colorTextDisabled}}},[`${e}-item`]:{backgroundColor:t.itemBg,border:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,[`&:hover:not(${e}-item-active)`]:{borderColor:t.colorPrimary,backgroundColor:t.itemBg,a:{color:t.colorPrimary}},"&-active":{borderColor:t.colorPrimary}}}}},tB=P_(["Pagination","bordered"],t=>{const e=o$(t);return[eB(e)]},s$);var nB=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const r$=t=>{const{align:e,prefixCls:n,selectPrefixCls:i,className:s,rootClassName:o,style:r,size:a,locale:l,selectComponentClass:c,responsive:u,showSizeChanger:d}=t,f=nB(t,["align","prefixCls","selectPrefixCls","className","rootClassName","style","size","locale","selectComponentClass","responsive","showSizeChanger"]),{xs:h}=xv(u),[,p]=Gl(),{getPrefixCls:m,direction:g,pagination:v={}}=S.useContext($n),x=m("pagination",n),[b,w,y]=Q3(x),C=d??v.showSizeChanger,I=S.useMemo(()=>{const T=S.createElement("span",{className:`${x}-item-ellipsis`},"•••"),A=S.createElement("button",{className:`${x}-item-link`,type:"button",tabIndex:-1},g==="rtl"?S.createElement(Sy,null):S.createElement(ew,null)),O=S.createElement("button",{className:`${x}-item-link`,type:"button",tabIndex:-1},g==="rtl"?S.createElement(ew,null):S.createElement(Sy,null)),P=S.createElement("a",{className:`${x}-item-link`},S.createElement("div",{className:`${x}-item-container`},g==="rtl"?S.createElement(uw,{className:`${x}-item-link-icon`}):S.createElement(cw,{className:`${x}-item-link-icon`}),T)),M=S.createElement("a",{className:`${x}-item-link`},S.createElement("div",{className:`${x}-item-container`},g==="rtl"?S.createElement(cw,{className:`${x}-item-link-icon`}):S.createElement(uw,{className:`${x}-item-link-icon`}),T));return{prevIcon:A,nextIcon:O,jumpPrevIcon:P,jumpNextIcon:M}},[g,x]),[$]=S1("Pagination",M_),E=Object.assign(Object.assign({},$),l),N=kr(a),k=N==="small"||!!(h&&!N&&u),D=m("select",i),_=ye({[`${x}-${e}`]:!!e,[`${x}-mini`]:k,[`${x}-rtl`]:g==="rtl",[`${x}-bordered`]:p.wireframe},v==null?void 0:v.className,s,o,w,y),R=Object.assign(Object.assign({},v==null?void 0:v.style),r);return b(S.createElement(S.Fragment,null,p.wireframe&&S.createElement(tB,{prefixCls:x}),S.createElement(U3,Object.assign({},I,f,{style:R,prefixCls:x,selectPrefixCls:D,className:_,selectComponentClass:c||(k?n$:i$),locale:E,showSizeChanger:C}))))},qv=ce.createContext({});qv.Consumer;var a$=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const iB=t=>{var{prefixCls:e,className:n,avatar:i,title:s,description:o}=t,r=a$(t,["prefixCls","className","avatar","title","description"]);const{getPrefixCls:a}=S.useContext($n),l=a("list",e),c=ye(`${l}-item-meta`,n),u=ce.createElement("div",{className:`${l}-item-meta-content`},s&&ce.createElement("h4",{className:`${l}-item-meta-title`},s),o&&ce.createElement("div",{className:`${l}-item-meta-description`},o));return ce.createElement("div",Object.assign({},r,{className:c}),i&&ce.createElement("div",{className:`${l}-item-meta-avatar`},i),(s||o)&&u)},sB=ce.forwardRef((t,e)=>{const{prefixCls:n,children:i,actions:s,extra:o,styles:r,className:a,classNames:l,colStyle:c}=t,u=a$(t,["prefixCls","children","actions","extra","styles","className","classNames","colStyle"]),{grid:d,itemLayout:f}=S.useContext(qv),{getPrefixCls:h,list:p}=S.useContext($n),m=I=>{var $,E;return ye((E=($=p==null?void 0:p.item)===null||$===void 0?void 0:$.classNames)===null||E===void 0?void 0:E[I],l==null?void 0:l[I])},g=I=>{var $,E;return Object.assign(Object.assign({},(E=($=p==null?void 0:p.item)===null||$===void 0?void 0:$.styles)===null||E===void 0?void 0:E[I]),r==null?void 0:r[I])},v=()=>{let I=!1;return S.Children.forEach(i,$=>{typeof $=="string"&&(I=!0)}),I&&S.Children.count(i)>1},x=()=>f==="vertical"?!!o:!v(),b=h("list",n),w=s&&s.length>0&&ce.createElement("ul",{className:ye(`${b}-item-action`,m("actions")),key:"actions",style:g("actions")},s.map((I,$)=>ce.createElement("li",{key:`${b}-item-action-${$}`},I,$!==s.length-1&&ce.createElement("em",{className:`${b}-item-action-split`})))),y=d?"div":"li",C=ce.createElement(y,Object.assign({},u,d?{}:{ref:e},{className:ye(`${b}-item`,{[`${b}-item-no-flex`]:!x()},a)}),f==="vertical"&&o?[ce.createElement("div",{className:`${b}-item-main`,key:"content"},i,w),ce.createElement("div",{className:ye(`${b}-item-extra`,m("extra")),key:"extra",style:g("extra")},o)]:[i,w,Mc(o,{key:"extra"})]);return d?ce.createElement(Yz,{ref:e,flex:1,style:c},C):C}),l$=sB;l$.Meta=iB;const oB=t=>{const{listBorderedCls:e,componentCls:n,paddingLG:i,margin:s,itemPaddingSM:o,itemPaddingLG:r,marginLG:a,borderRadiusLG:l}=t;return{[e]:{border:`${he(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderRadius:l,[`${n}-header,${n}-footer,${n}-item`]:{paddingInline:i},[`${n}-pagination`]:{margin:`${he(s)} ${he(a)}`}},[`${e}${n}-sm`]:{[`${n}-item,${n}-header,${n}-footer`]:{padding:o}},[`${e}${n}-lg`]:{[`${n}-item,${n}-header,${n}-footer`]:{padding:r}}}},rB=t=>{const{componentCls:e,screenSM:n,screenMD:i,marginLG:s,marginSM:o,margin:r}=t;return{[`@media screen and (max-width:${i}px)`]:{[e]:{[`${e}-item`]:{[`${e}-item-action`]:{marginInlineStart:s}}},[`${e}-vertical`]:{[`${e}-item`]:{[`${e}-item-extra`]:{marginInlineStart:s}}}},[`@media screen and (max-width: ${n}px)`]:{[e]:{[`${e}-item`]:{flexWrap:"wrap",[`${e}-action`]:{marginInlineStart:o}}},[`${e}-vertical`]:{[`${e}-item`]:{flexWrap:"wrap-reverse",[`${e}-item-main`]:{minWidth:t.contentWidth},[`${e}-item-extra`]:{margin:`auto auto ${he(r)}`}}}}}},aB=t=>{const{componentCls:e,antCls:n,controlHeight:i,minHeight:s,paddingSM:o,marginLG:r,padding:a,itemPadding:l,colorPrimary:c,itemPaddingSM:u,itemPaddingLG:d,paddingXS:f,margin:h,colorText:p,colorTextDescription:m,motionDurationSlow:g,lineWidth:v,headerBg:x,footerBg:b,emptyTextPadding:w,metaMarginBottom:y,avatarMarginRight:C,titleMarginBottom:I,descriptionFontSize:$}=t;return{[e]:Object.assign(Object.assign({},os(t)),{position:"relative","*":{outline:"none"},[`${e}-header`]:{background:x},[`${e}-footer`]:{background:b},[`${e}-header, ${e}-footer`]:{paddingBlock:o},[`${e}-pagination`]:{marginBlockStart:r,[`${n}-pagination-options`]:{textAlign:"start"}},[`${e}-spin`]:{minHeight:s,textAlign:"center"},[`${e}-items`]:{margin:0,padding:0,listStyle:"none"},[`${e}-item`]:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:l,color:p,[`${e}-item-meta`]:{display:"flex",flex:1,alignItems:"flex-start",maxWidth:"100%",[`${e}-item-meta-avatar`]:{marginInlineEnd:C},[`${e}-item-meta-content`]:{flex:"1 0",width:0,color:p},[`${e}-item-meta-title`]:{margin:`0 0 ${he(t.marginXXS)} 0`,color:p,fontSize:t.fontSize,lineHeight:t.lineHeight,"> a":{color:p,transition:`all ${g}`,"&:hover":{color:c}}},[`${e}-item-meta-description`]:{color:m,fontSize:$,lineHeight:t.lineHeight}},[`${e}-item-action`]:{flex:"0 0 auto",marginInlineStart:t.marginXXL,padding:0,fontSize:0,listStyle:"none","& > li":{position:"relative",display:"inline-block",padding:`0 ${he(f)}`,color:m,fontSize:t.fontSize,lineHeight:t.lineHeight,textAlign:"center","&:first-child":{paddingInlineStart:0}},[`${e}-item-action-split`]:{position:"absolute",insetBlockStart:"50%",insetInlineEnd:0,width:v,height:t.calc(t.fontHeight).sub(t.calc(t.marginXXS).mul(2)).equal(),transform:"translateY(-50%)",backgroundColor:t.colorSplit}}},[`${e}-empty`]:{padding:`${he(a)} 0`,color:m,fontSize:t.fontSizeSM,textAlign:"center"},[`${e}-empty-text`]:{padding:w,color:t.colorTextDisabled,fontSize:t.fontSize,textAlign:"center"},[`${e}-item-no-flex`]:{display:"block"}}),[`${e}-grid ${n}-col > ${e}-item`]:{display:"block",maxWidth:"100%",marginBlockEnd:h,paddingBlock:0,borderBlockEnd:"none"},[`${e}-vertical ${e}-item`]:{alignItems:"initial",[`${e}-item-main`]:{display:"block",flex:1},[`${e}-item-extra`]:{marginInlineStart:r},[`${e}-item-meta`]:{marginBlockEnd:y,[`${e}-item-meta-title`]:{marginBlockStart:0,marginBlockEnd:I,color:p,fontSize:t.fontSizeLG,lineHeight:t.lineHeightLG}},[`${e}-item-action`]:{marginBlockStart:a,marginInlineStart:"auto","> li":{padding:`0 ${he(a)}`,"&:first-child":{paddingInlineStart:0}}}},[`${e}-split ${e}-item`]:{borderBlockEnd:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`,"&:last-child":{borderBlockEnd:"none"}},[`${e}-split ${e}-header`]:{borderBlockEnd:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},[`${e}-split${e}-empty ${e}-footer`]:{borderTop:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},[`${e}-loading ${e}-spin-nested-loading`]:{minHeight:i},[`${e}-split${e}-something-after-last-item ${n}-spin-container > ${e}-items > ${e}-item:last-child`]:{borderBlockEnd:`${he(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},[`${e}-lg ${e}-item`]:{padding:d},[`${e}-sm ${e}-item`]:{padding:u},[`${e}:not(${e}-vertical)`]:{[`${e}-item-no-flex`]:{[`${e}-item-action`]:{float:"right"}}}}},lB=t=>({contentWidth:220,itemPadding:`${he(t.paddingContentVertical)} 0`,itemPaddingSM:`${he(t.paddingContentVerticalSM)} ${he(t.paddingContentHorizontal)}`,itemPaddingLG:`${he(t.paddingContentVerticalLG)} ${he(t.paddingContentHorizontalLG)}`,headerBg:"transparent",footerBg:"transparent",emptyTextPadding:t.padding,metaMarginBottom:t.padding,avatarMarginRight:t.padding,titleMarginBottom:t.paddingSM,descriptionFontSize:t.fontSize}),cB=Ys("List",t=>{const e=Si(t,{listBorderedCls:`${t.componentCls}-bordered`,minHeight:t.controlHeightLG});return[aB(e),oB(e),rB(e)]},lB);var uB=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};function ng(t){var{pagination:e=!1,prefixCls:n,bordered:i=!1,split:s=!0,className:o,rootClassName:r,style:a,children:l,itemLayout:c,loadMore:u,grid:d,dataSource:f=[],size:h,header:p,footer:m,loading:g=!1,rowKey:v,renderItem:x,locale:b}=t,w=uB(t,["pagination","prefixCls","bordered","split","className","rootClassName","style","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]);const y=e&&typeof e=="object"?e:{},[C,I]=S.useState(y.defaultCurrent||1),[$,E]=S.useState(y.defaultPageSize||10),{getPrefixCls:N,renderEmpty:k,direction:D,list:_}=S.useContext($n),R={current:1,total:0},T=ge=>($e,De)=>{var ve;I($e),E(De),e&&((ve=e==null?void 0:e[ge])===null||ve===void 0||ve.call(e,$e,De))},A=T("onChange"),O=T("onShowSizeChange"),P=(ge,$e)=>{if(!x)return null;let De;return typeof v=="function"?De=v(ge):v?De=ge[v]:De=ge.key,De||(De=`list-item-${$e}`),S.createElement(S.Fragment,{key:De},x(ge,$e))},M=()=>!!(u||e||m),z=N("list",n),[L,W,B]=cB(z);let q=g;typeof q=="boolean"&&(q={spinning:q});const H=!!(q!=null&&q.spinning),ne=kr(h);let te="";switch(ne){case"large":te="lg";break;case"small":te="sm";break}const ae=ye(z,{[`${z}-vertical`]:c==="vertical",[`${z}-${te}`]:te,[`${z}-split`]:s,[`${z}-bordered`]:i,[`${z}-loading`]:H,[`${z}-grid`]:!!d,[`${z}-something-after-last-item`]:M(),[`${z}-rtl`]:D==="rtl"},_==null?void 0:_.className,o,r,W,B),re=t$(R,{total:f.length,current:C,pageSize:$},e||{}),ee=Math.ceil(re.total/re.pageSize);re.current>ee&&(re.current=ee);const j=e&&S.createElement("div",{className:ye(`${z}-pagination`)},S.createElement(r$,Object.assign({align:"end"},re,{onChange:A,onShowSizeChange:O})));let Y=Ze(f);e&&f.length>(re.current-1)*re.pageSize&&(Y=Ze(f).splice((re.current-1)*re.pageSize,re.pageSize));const se=Object.keys(d||{}).some(ge=>["xs","sm","md","lg","xl","xxl"].includes(ge)),J=xv(se),ue=S.useMemo(()=>{for(let ge=0;ge<wl.length;ge+=1){const $e=wl[ge];if(J[$e])return $e}},[J]),oe=S.useMemo(()=>{if(!d)return;const ge=ue&&d[ue]?d[ue]:d.column;if(ge)return{width:`${100/ge}%`,maxWidth:`${100/ge}%`}},[JSON.stringify(d),ue]);let be=H&&S.createElement("div",{style:{minHeight:53}});if(Y.length>0){const ge=Y.map(($e,De)=>P($e,De));be=d?S.createElement(Zz,{gutter:d.gutter},S.Children.map(ge,$e=>S.createElement("div",{key:$e==null?void 0:$e.key,style:oe},$e))):S.createElement("ul",{className:`${z}-items`},ge)}else!l&&!H&&(be=S.createElement("div",{className:`${z}-empty-text`},(b==null?void 0:b.emptyText)||(k==null?void 0:k("List"))||S.createElement(zv,{componentName:"List"})));const de=re.position||"bottom",Ie=S.useMemo(()=>({grid:d,itemLayout:c}),[JSON.stringify(d),c]);return L(S.createElement(qv.Provider,{value:Ie},S.createElement("div",Object.assign({style:Object.assign(Object.assign({},_==null?void 0:_.style),a),className:ae},w),(de==="top"||de==="both")&&j,p&&S.createElement("div",{className:`${z}-header`},p),S.createElement(p1,Object.assign({},q),be,l),m&&S.createElement("div",{className:`${z}-footer`},m),u||(de==="bottom"||de==="both")&&j)))}ng.Item=l$;var dB={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"filled"},hB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:dB}))},fB=S.forwardRef(hB),pB={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"outlined"},mB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:pB}))},gB=S.forwardRef(mB),vB={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z"}}]},name:"caret-up",theme:"outlined"},xB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:vB}))},bB=S.forwardRef(xB),yB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},wB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:yB}))},c$=S.forwardRef(wB),CB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M349 838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V642H349v196zm531.1-684H143.9c-24.5 0-39.8 26.7-27.5 48l221.3 376h348.8l221.3-376c12.1-21.3-3.2-48-27.7-48z"}}]},name:"filter",theme:"filled"},SB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:CB}))},IB=S.forwardRef(SB),$B={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"}}]},name:"folder-open",theme:"outlined"},EB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:$B}))},NB=S.forwardRef(EB),kB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder",theme:"outlined"},DB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:kB}))},TB=S.forwardRef(DB),RB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 276.5a56 56 0 1056-97 56 56 0 00-56 97zm0 284a56 56 0 1056-97 56 56 0 00-56 97zM640 228a56 56 0 10112 0 56 56 0 00-112 0zm0 284a56 56 0 10112 0 56 56 0 00-112 0zM300 844.5a56 56 0 1056-97 56 56 0 00-56 97zM640 796a56 56 0 10112 0 56 56 0 00-112 0z"}}]},name:"holder",theme:"outlined"},_B=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:RB}))},AB=S.forwardRef(_B),OB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"minus-square",theme:"outlined"},PB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:OB}))},MB=S.forwardRef(PB),FB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},LB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:FB}))},zB=S.forwardRef(LB),BB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},VB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:BB}))},fw=S.forwardRef(VB),WB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"plus-square",theme:"outlined"},GB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:WB}))},HB=S.forwardRef(GB),UB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"robot",theme:"outlined"},jB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:UB}))},u$=S.forwardRef(jB),KB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},XB=function(e,n){return S.createElement(En,Ve({},e,{ref:n,icon:KB}))},qB=S.forwardRef(XB),rr={},ru="rc-table-internal-hook";function Yv(t){var e=S.createContext(void 0),n=function(s){var o=s.value,r=s.children,a=S.useRef(o);a.current=o;var l=S.useState(function(){return{getValue:function(){return a.current},listeners:new Set}}),c=ke(l,1),u=c[0];return Ki(function(){Um.unstable_batchedUpdates(function(){u.listeners.forEach(function(d){d(o)})})},[o]),S.createElement(e.Provider,{value:u},r)};return{Context:e,Provider:n,defaultValue:t}}function Ii(t,e){var n=ks(typeof e=="function"?e:function(d){if(e===void 0)return d;if(!Array.isArray(e))return d[e];var f={};return e.forEach(function(h){f[h]=d[h]}),f}),i=S.useContext(t==null?void 0:t.Context),s=i||{},o=s.listeners,r=s.getValue,a=S.useRef();a.current=n(i?r():t==null?void 0:t.defaultValue);var l=S.useState({}),c=ke(l,2),u=c[1];return Ki(function(){if(!i)return;function d(f){var h=n(f);Fc(a.current,h,!0)||u({})}return o.add(d),function(){o.delete(d)}},[i]),a.current}function YB(){var t=S.createContext(null);function e(){return S.useContext(t)}function n(s,o){var r=dy(s),a=function(c,u){var d=r?{ref:u}:{},f=S.useRef(0),h=S.useRef(c),p=e();return p!==null?S.createElement(s,Ve({},c,d)):((!o||o(h.current,c))&&(f.current+=1),h.current=c,S.createElement(t.Provider,{value:f.current},S.createElement(s,Ve({},c,d))))};return r?S.forwardRef(a):a}function i(s,o){var r=dy(s),a=function(c,u){var d=r?{ref:u}:{};return e(),S.createElement(s,Ve({},c,d))};return r?S.memo(S.forwardRef(a),o):S.memo(a,o)}return{makeImmutable:n,responseImmutable:i,useImmutableMark:e}}var Jv=YB(),d$=Jv.makeImmutable,Kl=Jv.responseImmutable,JB=Jv.useImmutableMark,Zi=Yv(),h$=S.createContext({renderWithProps:!1}),ZB="RC_TABLE_KEY";function QB(t){return t==null?[]:Array.isArray(t)?t:[t]}function mf(t){var e=[],n={};return t.forEach(function(i){for(var s=i||{},o=s.key,r=s.dataIndex,a=o||QB(r).join("-")||ZB;n[a];)a="".concat(a,"_next");n[a]=!0,e.push(a)}),e}function ig(t){return t!=null}function eV(t){return t&&_n(t)==="object"&&!Array.isArray(t)&&!S.isValidElement(t)}function tV(t,e,n,i,s,o){var r=S.useContext(h$),a=JB(),l=cv(function(){if(ig(i))return[i];var c=e==null||e===""?[]:Array.isArray(e)?e:[e],u=fv(t,c),d=u,f=void 0;if(s){var h=s(u,t,n);eV(h)?(d=h.children,f=h.props,r.renderWithProps=!0):d=h}return[d,f]},[a,t,i,e,s,n],function(c,u){if(o){var d=ke(c,2),f=d[1],h=ke(u,2),p=h[1];return o(p,f)}return r.renderWithProps?!0:!Fc(c,u,!0)});return l}function nV(t,e,n,i){var s=t+e-1;return t<=i&&s>=n}function iV(t,e){return Ii(Zi,function(n){var i=nV(t,e||1,n.hoverStartRow,n.hoverEndRow);return[i,n.onHover]})}var sV=function(e){var n=e.ellipsis,i=e.rowType,s=e.children,o,r=n===!0?{showTitle:!0}:n;return r&&(r.showTitle||i==="header")&&(typeof s=="string"||typeof s=="number"?o=s.toString():S.isValidElement(s)&&typeof s.props.children=="string"&&(o=s.props.children)),o};function oV(t){var e,n,i,s,o,r,a,l,c=t.component,u=t.children,d=t.ellipsis,f=t.scope,h=t.prefixCls,p=t.className,m=t.align,g=t.record,v=t.render,x=t.dataIndex,b=t.renderIndex,w=t.shouldCellUpdate,y=t.index,C=t.rowType,I=t.colSpan,$=t.rowSpan,E=t.fixLeft,N=t.fixRight,k=t.firstFixLeft,D=t.lastFixLeft,_=t.firstFixRight,R=t.lastFixRight,T=t.appendNode,A=t.additionalProps,O=A===void 0?{}:A,P=t.isSticky,M="".concat(h,"-cell"),z=Ii(Zi,["supportSticky","allColumnsFixedLeft","rowHoverable"]),L=z.supportSticky,W=z.allColumnsFixedLeft,B=z.rowHoverable,q=tV(g,x,b,u,v,w),H=ke(q,2),ne=H[0],te=H[1],ae={},re=typeof E=="number"&&L,ee=typeof N=="number"&&L;re&&(ae.position="sticky",ae.left=E),ee&&(ae.position="sticky",ae.right=N);var j=(e=(n=(i=te==null?void 0:te.colSpan)!==null&&i!==void 0?i:O.colSpan)!==null&&n!==void 0?n:I)!==null&&e!==void 0?e:1,Y=(s=(o=(r=te==null?void 0:te.rowSpan)!==null&&r!==void 0?r:O.rowSpan)!==null&&o!==void 0?o:$)!==null&&s!==void 0?s:1,se=iV(y,Y),J=ke(se,2),ue=J[0],oe=J[1],be=ks(function(we){var Re;g&&oe(y,y+Y-1),O==null||(Re=O.onMouseEnter)===null||Re===void 0||Re.call(O,we)}),de=ks(function(we){var Re;g&&oe(-1,-1),O==null||(Re=O.onMouseLeave)===null||Re===void 0||Re.call(O,we)});if(j===0||Y===0)return null;var Ie=(a=O.title)!==null&&a!==void 0?a:sV({rowType:C,ellipsis:d,children:ne}),ge=ye(M,p,(l={},X(l,"".concat(M,"-fix-left"),re&&L),X(l,"".concat(M,"-fix-left-first"),k&&L),X(l,"".concat(M,"-fix-left-last"),D&&L),X(l,"".concat(M,"-fix-left-all"),D&&W&&L),X(l,"".concat(M,"-fix-right"),ee&&L),X(l,"".concat(M,"-fix-right-first"),_&&L),X(l,"".concat(M,"-fix-right-last"),R&&L),X(l,"".concat(M,"-ellipsis"),d),X(l,"".concat(M,"-with-append"),T),X(l,"".concat(M,"-fix-sticky"),(re||ee)&&P&&L),X(l,"".concat(M,"-row-hover"),!te&&ue),l),O.className,te==null?void 0:te.className),$e={};m&&($e.textAlign=m);var De=me(me(me(me({},ae),O.style),$e),te==null?void 0:te.style),ve=ne;return _n(ve)==="object"&&!Array.isArray(ve)&&!S.isValidElement(ve)&&(ve=null),d&&(D||_)&&(ve=S.createElement("span",{className:"".concat(M,"-content")},ve)),S.createElement(c,Ve({},te,O,{className:ge,style:De,title:Ie,scope:f,onMouseEnter:B?be:void 0,onMouseLeave:B?de:void 0,colSpan:j!==1?j:null,rowSpan:Y!==1?Y:null}),T,ve)}const Ra=S.memo(oV);function Zv(t,e,n,i,s){var o=n[t]||{},r=n[e]||{},a,l;o.fixed==="left"?a=i.left[s==="rtl"?e:t]:r.fixed==="right"&&(l=i.right[s==="rtl"?t:e]);var c=!1,u=!1,d=!1,f=!1,h=n[e+1],p=n[t-1],m=h&&!h.fixed||p&&!p.fixed||n.every(function(w){return w.fixed==="left"});if(s==="rtl"){if(a!==void 0){var g=p&&p.fixed==="left";f=!g&&m}else if(l!==void 0){var v=h&&h.fixed==="right";d=!v&&m}}else if(a!==void 0){var x=h&&h.fixed==="left";c=!x&&m}else if(l!==void 0){var b=p&&p.fixed==="right";u=!b&&m}return{fixLeft:a,fixRight:l,lastFixLeft:c,firstFixRight:u,lastFixRight:d,firstFixLeft:f,isSticky:i.isSticky}}var f$=S.createContext({});function rV(t){var e=t.className,n=t.index,i=t.children,s=t.colSpan,o=s===void 0?1:s,r=t.rowSpan,a=t.align,l=Ii(Zi,["prefixCls","direction"]),c=l.prefixCls,u=l.direction,d=S.useContext(f$),f=d.scrollColumnIndex,h=d.stickyOffsets,p=d.flattenColumns,m=n+o-1,g=m+1===f?o+1:o,v=Zv(n,n+g-1,p,h,u);return S.createElement(Ra,Ve({className:e,index:n,component:"td",prefixCls:c,record:null,dataIndex:null,align:a,colSpan:g,rowSpan:r,render:function(){return i}},v))}var aV=["children"];function lV(t){var e=t.children,n=In(t,aV);return S.createElement("tr",n,e)}function gf(t){var e=t.children;return e}gf.Row=lV;gf.Cell=rV;function cV(t){var e=t.children,n=t.stickyOffsets,i=t.flattenColumns,s=Ii(Zi,"prefixCls"),o=i.length-1,r=i[o],a=S.useMemo(function(){return{stickyOffsets:n,flattenColumns:i,scrollColumnIndex:r!=null&&r.scrollbar?o:null}},[r,i,o,n]);return S.createElement(f$.Provider,{value:a},S.createElement("tfoot",{className:"".concat(s,"-summary")},e))}const _d=Kl(cV);var p$=gf;function uV(t){return null}function dV(t){return null}function m$(t,e,n,i,s,o,r){t.push({record:e,indent:n,index:r});var a=o(e),l=s==null?void 0:s.has(a);if(e&&Array.isArray(e[i])&&l)for(var c=0;c<e[i].length;c+=1)m$(t,e[i][c],n+1,i,s,o,c)}function g$(t,e,n,i){var s=S.useMemo(function(){if(n!=null&&n.size){for(var o=[],r=0;r<(t==null?void 0:t.length);r+=1){var a=t[r];m$(o,a,0,e,n,i,r)}return o}return t==null?void 0:t.map(function(l,c){return{record:l,indent:0,index:c}})},[t,e,n,i]);return s}function v$(t,e,n,i){var s=Ii(Zi,["prefixCls","fixedInfoList","flattenColumns","expandableType","expandRowByClick","onTriggerExpand","rowClassName","expandedRowClassName","indentSize","expandIcon","expandedRowRender","expandIconColumnIndex","expandedKeys","childrenColumnName","rowExpandable","onRow"]),o=s.flattenColumns,r=s.expandableType,a=s.expandedKeys,l=s.childrenColumnName,c=s.onTriggerExpand,u=s.rowExpandable,d=s.onRow,f=s.expandRowByClick,h=s.rowClassName,p=r==="nest",m=r==="row"&&(!u||u(t)),g=m||p,v=a&&a.has(e),x=l&&t&&t[l],b=ks(c),w=d==null?void 0:d(t,n),y=w==null?void 0:w.onClick,C=function(N){f&&g&&c(t,N);for(var k=arguments.length,D=new Array(k>1?k-1:0),_=1;_<k;_++)D[_-1]=arguments[_];y==null||y.apply(void 0,[N].concat(D))},I;typeof h=="string"?I=h:typeof h=="function"&&(I=h(t,n,i));var $=mf(o);return me(me({},s),{},{columnsKey:$,nestExpandable:p,expanded:v,hasNestChildren:x,record:t,onTriggerExpand:b,rowSupportExpand:m,expandable:g,rowProps:me(me({},w),{},{className:ye(I,w==null?void 0:w.className),onClick:C})})}function x$(t){var e=t.prefixCls,n=t.children,i=t.component,s=t.cellComponent,o=t.className,r=t.expanded,a=t.colSpan,l=t.isEmpty,c=Ii(Zi,["scrollbarSize","fixHeader","fixColumn","componentWidth","horizonScroll"]),u=c.scrollbarSize,d=c.fixHeader,f=c.fixColumn,h=c.componentWidth,p=c.horizonScroll,m=n;return(l?p&&h:f)&&(m=S.createElement("div",{style:{width:h-(d?u:0),position:"sticky",left:0,overflow:"hidden"},className:"".concat(e,"-expanded-row-fixed")},m)),S.createElement(i,{className:o,style:{display:r?null:"none"}},S.createElement(Ra,{component:s,prefixCls:e,colSpan:a},m))}function b$(t,e,n,i,s){var o=t.record,r=t.prefixCls,a=t.columnsKey,l=t.fixedInfoList,c=t.expandIconColumnIndex,u=t.nestExpandable,d=t.indentSize,f=t.expandIcon,h=t.expanded,p=t.hasNestChildren,m=t.onTriggerExpand,g=a[n],v=l[n],x;n===(c||0)&&u&&(x=S.createElement(S.Fragment,null,S.createElement("span",{style:{paddingLeft:"".concat(d*i,"px")},className:"".concat(r,"-row-indent indent-level-").concat(i)}),f({prefixCls:r,expanded:h,expandable:p,record:o,onExpand:m})));var b;return e.onCell&&(b=e.onCell(o,s)),{key:g,fixedInfo:v,appendCellNode:x,additionalCellProps:b||{}}}function hV(t){var e=t.className,n=t.style,i=t.record,s=t.index,o=t.renderIndex,r=t.rowKey,a=t.indent,l=a===void 0?0:a,c=t.rowComponent,u=t.cellComponent,d=t.scopeCellComponent,f=v$(i,r,s,l),h=f.prefixCls,p=f.flattenColumns,m=f.expandedRowClassName,g=f.expandedRowRender,v=f.rowProps,x=f.expanded,b=f.rowSupportExpand,w=S.useRef(!1);w.current||(w.current=x);var y=m&&m(i,s,l),C=S.createElement(c,Ve({},v,{"data-row-key":r,className:ye(e,"".concat(h,"-row"),"".concat(h,"-row-level-").concat(l),v==null?void 0:v.className,l>=1?y:""),style:me(me({},n),v==null?void 0:v.style)}),p.map(function(E,N){var k=E.render,D=E.dataIndex,_=E.className,R=b$(f,E,N,l,s),T=R.key,A=R.fixedInfo,O=R.appendCellNode,P=R.additionalCellProps;return S.createElement(Ra,Ve({className:_,ellipsis:E.ellipsis,align:E.align,scope:E.rowScope,component:E.rowScope?d:u,prefixCls:h,key:T,record:i,index:s,renderIndex:o,dataIndex:D,render:k,shouldCellUpdate:E.shouldCellUpdate},A,{appendNode:O,additionalProps:P}))})),I;if(b&&(w.current||x)){var $=g(i,s,l+1,x);I=S.createElement(x$,{expanded:x,className:ye("".concat(h,"-expanded-row"),"".concat(h,"-expanded-row-level-").concat(l+1),y),prefixCls:h,component:c,cellComponent:u,colSpan:p.length,isEmpty:!1},$)}return S.createElement(S.Fragment,null,C,I)}const fV=Kl(hV);function pV(t){var e=t.columnKey,n=t.onColumnResize,i=S.useRef();return S.useEffect(function(){i.current&&n(e,i.current.offsetWidth)},[]),S.createElement(Wl,{data:e},S.createElement("td",{ref:i,style:{padding:0,border:0,height:0}},S.createElement("div",{style:{height:0,overflow:"hidden"}}," ")))}function mV(t){var e=t.prefixCls,n=t.columnsKey,i=t.onColumnResize;return S.createElement("tr",{"aria-hidden":"true",className:"".concat(e,"-measure-row"),style:{height:0,fontSize:0}},S.createElement(Wl.Collection,{onBatchResize:function(o){o.forEach(function(r){var a=r.data,l=r.size;i(a,l.offsetWidth)})}},n.map(function(s){return S.createElement(pV,{key:s,columnKey:s,onColumnResize:i})})))}function gV(t){var e=t.data,n=t.measureColumnWidth,i=Ii(Zi,["prefixCls","getComponent","onColumnResize","flattenColumns","getRowKey","expandedKeys","childrenColumnName","emptyNode"]),s=i.prefixCls,o=i.getComponent,r=i.onColumnResize,a=i.flattenColumns,l=i.getRowKey,c=i.expandedKeys,u=i.childrenColumnName,d=i.emptyNode,f=g$(e,u,c,l),h=S.useRef({renderWithProps:!1}),p=o(["body","wrapper"],"tbody"),m=o(["body","row"],"tr"),g=o(["body","cell"],"td"),v=o(["body","cell"],"th"),x;e.length?x=f.map(function(w,y){var C=w.record,I=w.indent,$=w.index,E=l(C,y);return S.createElement(fV,{key:E,rowKey:E,record:C,index:y,renderIndex:$,rowComponent:m,cellComponent:g,scopeCellComponent:v,getRowKey:l,indent:I})}):x=S.createElement(x$,{expanded:!0,className:"".concat(s,"-placeholder"),prefixCls:s,component:m,cellComponent:g,colSpan:a.length,isEmpty:!0},d);var b=mf(a);return S.createElement(h$.Provider,{value:h.current},S.createElement(p,{className:"".concat(s,"-tbody")},n&&S.createElement(mV,{prefixCls:s,columnsKey:b,onColumnResize:r}),x))}const vV=Kl(gV);var xV=["expandable"],Tc="RC_TABLE_INTERNAL_COL_DEFINE";function bV(t){var e=t.expandable,n=In(t,xV),i;return"expandable"in t?i=me(me({},n),e):i=n,i.showExpandColumn===!1&&(i.expandIconColumnIndex=-1),i}var yV=["columnType"];function y$(t){for(var e=t.colWidths,n=t.columns,i=t.columCount,s=[],o=i||n.length,r=!1,a=o-1;a>=0;a-=1){var l=e[a],c=n&&n[a],u=c&&c[Tc];if(l||u||r){var d=u||{};d.columnType;var f=In(d,yV);s.unshift(S.createElement("col",Ve({key:a,style:{width:l}},f))),r=!0}}return S.createElement("colgroup",null,s)}var wV=["className","noData","columns","flattenColumns","colWidths","columCount","stickyOffsets","direction","fixHeader","stickyTopOffset","stickyBottomOffset","stickyClassName","onScroll","maxContentScroll","children"];function CV(t,e){return S.useMemo(function(){for(var n=[],i=0;i<e;i+=1){var s=t[i];if(s!==void 0)n[i]=s;else return null}return n},[t.join("_"),e])}var SV=S.forwardRef(function(t,e){var n=t.className,i=t.noData,s=t.columns,o=t.flattenColumns,r=t.colWidths,a=t.columCount,l=t.stickyOffsets,c=t.direction,u=t.fixHeader,d=t.stickyTopOffset,f=t.stickyBottomOffset,h=t.stickyClassName,p=t.onScroll,m=t.maxContentScroll,g=t.children,v=In(t,wV),x=Ii(Zi,["prefixCls","scrollbarSize","isSticky","getComponent"]),b=x.prefixCls,w=x.scrollbarSize,y=x.isSticky,C=x.getComponent,I=C(["header","table"],"table"),$=y&&!u?0:w,E=S.useRef(null),N=S.useCallback(function(P){hy(e,P),hy(E,P)},[]);S.useEffect(function(){var P;function M(z){var L=z,W=L.currentTarget,B=L.deltaX;B&&(p({currentTarget:W,scrollLeft:W.scrollLeft+B}),z.preventDefault())}return(P=E.current)===null||P===void 0||P.addEventListener("wheel",M,{passive:!1}),function(){var z;(z=E.current)===null||z===void 0||z.removeEventListener("wheel",M)}},[]);var k=S.useMemo(function(){return o.every(function(P){return P.width})},[o]),D=o[o.length-1],_={fixed:D?D.fixed:null,scrollbar:!0,onHeaderCell:function(){return{className:"".concat(b,"-cell-scrollbar")}}},R=S.useMemo(function(){return $?[].concat(Ze(s),[_]):s},[$,s]),T=S.useMemo(function(){return $?[].concat(Ze(o),[_]):o},[$,o]),A=S.useMemo(function(){var P=l.right,M=l.left;return me(me({},l),{},{left:c==="rtl"?[].concat(Ze(M.map(function(z){return z+$})),[0]):M,right:c==="rtl"?P:[].concat(Ze(P.map(function(z){return z+$})),[0]),isSticky:y})},[$,l,y]),O=CV(r,a);return S.createElement("div",{style:me({overflow:"hidden"},y?{top:d,bottom:f}:{}),ref:N,className:ye(n,X({},h,!!h))},S.createElement(I,{style:{tableLayout:"fixed",visibility:i||O?null:"hidden"}},(!i||!m||k)&&S.createElement(y$,{colWidths:O?[].concat(Ze(O),[$]):[],columCount:a+1,columns:T}),g(me(me({},v),{},{stickyOffsets:A,columns:R,flattenColumns:T}))))});const pw=S.memo(SV);var IV=function(e){var n=e.cells,i=e.stickyOffsets,s=e.flattenColumns,o=e.rowComponent,r=e.cellComponent,a=e.onHeaderRow,l=e.index,c=Ii(Zi,["prefixCls","direction"]),u=c.prefixCls,d=c.direction,f;a&&(f=a(n.map(function(p){return p.column}),l));var h=mf(n.map(function(p){return p.column}));return S.createElement(o,f,n.map(function(p,m){var g=p.column,v=Zv(p.colStart,p.colEnd,s,i,d),x;return g&&g.onHeaderCell&&(x=p.column.onHeaderCell(g)),S.createElement(Ra,Ve({},p,{scope:g.title?p.colSpan>1?"colgroup":"col":null,ellipsis:g.ellipsis,align:g.align,component:r,prefixCls:u,key:h[m]},v,{additionalProps:x,rowType:"header"}))}))};function $V(t){var e=[];function n(r,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;e[l]=e[l]||[];var c=a,u=r.filter(Boolean).map(function(d){var f={key:d.key,className:d.className||"",children:d.title,column:d,colStart:c},h=1,p=d.children;return p&&p.length>0&&(h=n(p,c,l+1).reduce(function(m,g){return m+g},0),f.hasSubColumns=!0),"colSpan"in d&&(h=d.colSpan),"rowSpan"in d&&(f.rowSpan=d.rowSpan),f.colSpan=h,f.colEnd=f.colStart+h-1,e[l].push(f),c+=h,h});return u}n(t,0);for(var i=e.length,s=function(a){e[a].forEach(function(l){!("rowSpan"in l)&&!l.hasSubColumns&&(l.rowSpan=i-a)})},o=0;o<i;o+=1)s(o);return e}var EV=function(e){var n=e.stickyOffsets,i=e.columns,s=e.flattenColumns,o=e.onHeaderRow,r=Ii(Zi,["prefixCls","getComponent"]),a=r.prefixCls,l=r.getComponent,c=S.useMemo(function(){return $V(i)},[i]),u=l(["header","wrapper"],"thead"),d=l(["header","row"],"tr"),f=l(["header","cell"],"th");return S.createElement(u,{className:"".concat(a,"-thead")},c.map(function(h,p){var m=S.createElement(IV,{key:p,flattenColumns:s,cells:h,stickyOffsets:n,rowComponent:d,cellComponent:f,onHeaderRow:o,index:p});return m}))};const mw=Kl(EV);function gw(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return typeof e=="number"?e:e.endsWith("%")?t*parseFloat(e)/100:null}function NV(t,e,n){return S.useMemo(function(){if(e&&e>0){var i=0,s=0;t.forEach(function(f){var h=gw(e,f.width);h?i+=h:s+=1});var o=Math.max(e,n),r=Math.max(o-i,s),a=s,l=r/s,c=0,u=t.map(function(f){var h=me({},f),p=gw(e,h.width);if(p)h.width=p;else{var m=Math.floor(l);h.width=a===1?r:m,r-=m,a-=1}return c+=h.width,h});if(c<o){var d=o/c;r=o,u.forEach(function(f,h){var p=Math.floor(f.width*d);f.width=h===u.length-1?r:p,r-=p})}return[u,Math.max(c,o)]}return[t,e]},[t,e,n])}var kV=["children"],DV=["fixed"];function Qv(t){return uv(t).filter(function(e){return S.isValidElement(e)}).map(function(e){var n=e.key,i=e.props,s=i.children,o=In(i,kV),r=me({key:n},o);return s&&(r.children=Qv(s)),r})}function w$(t){return t.filter(function(e){return e&&_n(e)==="object"&&!e.hidden}).map(function(e){var n=e.children;return n&&n.length>0?me(me({},e),{},{children:w$(n)}):e})}function sg(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"key";return t.filter(function(n){return n&&_n(n)==="object"}).reduce(function(n,i,s){var o=i.fixed,r=o===!0?"left":o,a="".concat(e,"-").concat(s),l=i.children;return l&&l.length>0?[].concat(Ze(n),Ze(sg(l,a).map(function(c){return me({fixed:r},c)}))):[].concat(Ze(n),[me(me({key:a},i),{},{fixed:r})])},[])}function TV(t){return t.map(function(e){var n=e.fixed,i=In(e,DV),s=n;return n==="left"?s="right":n==="right"&&(s="left"),me({fixed:s},i)})}function RV(t,e){var n=t.prefixCls,i=t.columns,s=t.children,o=t.expandable,r=t.expandedKeys,a=t.columnTitle,l=t.getRowKey,c=t.onTriggerExpand,u=t.expandIcon,d=t.rowExpandable,f=t.expandIconColumnIndex,h=t.direction,p=t.expandRowByClick,m=t.columnWidth,g=t.fixed,v=t.scrollWidth,x=t.clientWidth,b=S.useMemo(function(){var D=i||Qv(s)||[];return w$(D.slice())},[i,s]),w=S.useMemo(function(){if(o){var D,_=b.slice();if(!_.includes(rr)){var R=f||0;R>=0&&_.splice(R,0,rr)}var T=_.indexOf(rr);_=_.filter(function(M,z){return M!==rr||z===T});var A=b[T],O;(g==="left"||g)&&!f?O="left":(g==="right"||g)&&f===b.length?O="right":O=A?A.fixed:null;var P=(D={},X(D,Tc,{className:"".concat(n,"-expand-icon-col"),columnType:"EXPAND_COLUMN"}),X(D,"title",a),X(D,"fixed",O),X(D,"className","".concat(n,"-row-expand-icon-cell")),X(D,"width",m),X(D,"render",function(z,L,W){var B=l(L,W),q=r.has(B),H=d?d(L):!0,ne=u({prefixCls:n,expanded:q,expandable:H,record:L,onExpand:c});return p?S.createElement("span",{onClick:function(ae){return ae.stopPropagation()}},ne):ne}),D);return _.map(function(M){return M===rr?P:M})}return b.filter(function(M){return M!==rr})},[o,b,l,r,u,h]),y=S.useMemo(function(){var D=w;return e&&(D=e(D)),D.length||(D=[{render:function(){return null}}]),D},[e,w,h]),C=S.useMemo(function(){return h==="rtl"?TV(sg(y)):sg(y)},[y,h,v]),I=S.useMemo(function(){for(var D=-1,_=C.length-1;_>=0;_-=1){var R=C[_].fixed;if(R==="left"||R===!0){D=_;break}}if(D>=0)for(var T=0;T<=D;T+=1){var A=C[T].fixed;if(A!=="left"&&A!==!0)return!0}var O=C.findIndex(function(z){var L=z.fixed;return L==="right"});if(O>=0)for(var P=O;P<C.length;P+=1){var M=C[P].fixed;if(M!=="right")return!0}return!1},[C]),$=NV(C,v,x),E=ke($,2),N=E[0],k=E[1];return[y,N,k,I]}function _V(t){var e,n=t.prefixCls,i=t.record,s=t.onExpand,o=t.expanded,r=t.expandable,a="".concat(n,"-row-expand-icon");if(!r)return S.createElement("span",{className:ye(a,"".concat(n,"-row-spaced"))});var l=function(u){s(i,u),u.stopPropagation()};return S.createElement("span",{className:ye(a,(e={},X(e,"".concat(n,"-row-expanded"),o),X(e,"".concat(n,"-row-collapsed"),!o),e)),onClick:l})}function AV(t,e,n){var i=[];function s(o){(o||[]).forEach(function(r,a){i.push(e(r,a)),s(r[n])})}return s(t),i}function OV(t,e,n){var i=bV(t),s=i.expandIcon,o=i.expandedRowKeys,r=i.defaultExpandedRowKeys,a=i.defaultExpandAllRows,l=i.expandedRowRender,c=i.onExpand,u=i.onExpandedRowsChange,d=i.childrenColumnName,f=s||_V,h=d||"children",p=S.useMemo(function(){return l?"row":t.expandable&&t.internalHooks===ru&&t.expandable.__PARENT_RENDER_ICON__||e.some(function(y){return y&&_n(y)==="object"&&y[h]})?"nest":!1},[!!l,e]),m=S.useState(function(){return r||(a?AV(e,n,h):[])}),g=ke(m,2),v=g[0],x=g[1],b=S.useMemo(function(){return new Set(o||v||[])},[o,v]),w=S.useCallback(function(y){var C=n(y,e.indexOf(y)),I,$=b.has(C);$?(b.delete(C),I=Ze(b)):I=[].concat(Ze(b),[C]),x(I),c&&c(!$,y),u&&u(I)},[n,b,e,c,u]);return[i,p,b,f,h,w]}function PV(t,e,n){var i=t.map(function(s,o){return Zv(o,o,t,e,n)});return cv(function(){return i},[i],function(s,o){return!Fc(s,o)})}function C$(t){var e=S.useRef(t),n=S.useState({}),i=ke(n,2),s=i[1],o=S.useRef(null),r=S.useRef([]);function a(l){r.current.push(l);var c=Promise.resolve();o.current=c,c.then(function(){if(o.current===c){var u=r.current,d=e.current;r.current=[],u.forEach(function(f){e.current=f(e.current)}),o.current=null,d!==e.current&&s({})}})}return S.useEffect(function(){return function(){o.current=null}},[]),[e.current,a]}function MV(t){var e=S.useRef(null),n=S.useRef();function i(){window.clearTimeout(n.current)}function s(r){e.current=r,i(),n.current=window.setTimeout(function(){e.current=null,n.current=void 0},100)}function o(){return e.current}return S.useEffect(function(){return i},[]),[s,o]}function FV(){var t=S.useState(-1),e=ke(t,2),n=e[0],i=e[1],s=S.useState(-1),o=ke(s,2),r=o[0],a=o[1],l=S.useCallback(function(c,u){i(c),a(u)},[]);return[n,r,l]}var vw=rv()?window:null;function LV(t,e){var n=_n(t)==="object"?t:{},i=n.offsetHeader,s=i===void 0?0:i,o=n.offsetSummary,r=o===void 0?0:o,a=n.offsetScroll,l=a===void 0?0:a,c=n.getContainer,u=c===void 0?function(){return vw}:c,d=u()||vw;return S.useMemo(function(){var f=!!t;return{isSticky:f,stickyClassName:f?"".concat(e,"-sticky-holder"):"",offsetHeader:s,offsetSummary:r,offsetScroll:l,container:d}},[l,s,r,e,d])}function zV(t,e,n){var i=S.useMemo(function(){var s=e.length,o=function(c,u,d){for(var f=[],h=0,p=c;p!==u;p+=d)f.push(h),e[p].fixed&&(h+=t[p]||0);return f},r=o(0,s,1),a=o(s-1,-1,-1).reverse();return n==="rtl"?{left:a,right:r}:{left:r,right:a}},[t,e,n]);return i}function xw(t){var e=t.className,n=t.children;return S.createElement("div",{className:e},n)}var BV=function(e,n){var i,s,o=e.scrollBodyRef,r=e.onScroll,a=e.offsetScroll,l=e.container,c=Ii(Zi,"prefixCls"),u=((i=o.current)===null||i===void 0?void 0:i.scrollWidth)||0,d=((s=o.current)===null||s===void 0?void 0:s.clientWidth)||0,f=u&&d*(d/u),h=S.useRef(),p=C$({scrollLeft:0,isHiddenScrollBar:!1}),m=ke(p,2),g=m[0],v=m[1],x=S.useRef({delta:0,x:0}),b=S.useState(!1),w=ke(b,2),y=w[0],C=w[1],I=S.useRef(null);S.useEffect(function(){return function(){Pi.cancel(I.current)}},[]);var $=function(){C(!1)},E=function(R){R.persist(),x.current.delta=R.pageX-g.scrollLeft,x.current.x=0,C(!0),R.preventDefault()},N=function(R){var T,A=R||((T=window)===null||T===void 0?void 0:T.event),O=A.buttons;if(!y||O===0){y&&C(!1);return}var P=x.current.x+R.pageX-x.current.x-x.current.delta;P<=0&&(P=0),P+f>=d&&(P=d-f),r({scrollLeft:P/d*(u+2)}),x.current.x=R.pageX},k=function(){I.current=Pi(function(){if(o.current){var R=lw(o.current).top,T=R+o.current.offsetHeight,A=l===window?document.documentElement.scrollTop+window.innerHeight:lw(l).top+l.clientHeight;T-fy()<=A||R>=A-a?v(function(O){return me(me({},O),{},{isHiddenScrollBar:!0})}):v(function(O){return me(me({},O),{},{isHiddenScrollBar:!1})})}})},D=function(R){v(function(T){return me(me({},T),{},{scrollLeft:R/u*d||0})})};return S.useImperativeHandle(n,function(){return{setScrollLeft:D,checkScrollBarVisible:k}}),S.useEffect(function(){var _=Rd(document.body,"mouseup",$,!1),R=Rd(document.body,"mousemove",N,!1);return k(),function(){_.remove(),R.remove()}},[f,y]),S.useEffect(function(){var _=Rd(l,"scroll",k,!1),R=Rd(window,"resize",k,!1);return function(){_.remove(),R.remove()}},[l]),S.useEffect(function(){g.isHiddenScrollBar||v(function(_){var R=o.current;return R?me(me({},_),{},{scrollLeft:R.scrollLeft/R.scrollWidth*R.clientWidth}):_})},[g.isHiddenScrollBar]),u<=d||!f||g.isHiddenScrollBar?null:S.createElement("div",{style:{height:fy(),width:d,bottom:a},className:"".concat(c,"-sticky-scroll")},S.createElement("div",{onMouseDown:E,ref:h,className:ye("".concat(c,"-sticky-scroll-bar"),X({},"".concat(c,"-sticky-scroll-bar-active"),y)),style:{width:"".concat(f,"px"),transform:"translate3d(".concat(g.scrollLeft,"px, 0, 0)")}}))};const VV=S.forwardRef(BV);var S$="rc-table",WV=[],GV={};function HV(){return"No Data"}function UV(t,e){var n,i=me({rowKey:"key",prefixCls:S$,emptyText:HV},t),s=i.prefixCls,o=i.className,r=i.rowClassName,a=i.style,l=i.data,c=i.rowKey,u=i.scroll,d=i.tableLayout,f=i.direction,h=i.title,p=i.footer,m=i.summary,g=i.caption,v=i.id,x=i.showHeader,b=i.components,w=i.emptyText,y=i.onRow,C=i.onHeaderRow,I=i.onScroll,$=i.internalHooks,E=i.transformColumns,N=i.internalRefs,k=i.tailor,D=i.getContainerWidth,_=i.sticky,R=i.rowHoverable,T=R===void 0?!0:R,A=l||WV,O=!!A.length,P=$===ru,M=S.useCallback(function($t,zt){return fv(b,$t)||zt},[b]),z=S.useMemo(function(){return typeof c=="function"?c:function($t){var zt=$t&&$t[c];return zt}},[c]),L=M(["body"]),W=FV(),B=ke(W,3),q=B[0],H=B[1],ne=B[2],te=OV(i,A,z),ae=ke(te,6),re=ae[0],ee=ae[1],j=ae[2],Y=ae[3],se=ae[4],J=ae[5],ue=u==null?void 0:u.x,oe=S.useState(0),be=ke(oe,2),de=be[0],Ie=be[1],ge=RV(me(me(me({},i),re),{},{expandable:!!re.expandedRowRender,columnTitle:re.columnTitle,expandedKeys:j,getRowKey:z,onTriggerExpand:J,expandIcon:Y,expandIconColumnIndex:re.expandIconColumnIndex,direction:f,scrollWidth:P&&k&&typeof ue=="number"?ue:null,clientWidth:de}),P?E:null),$e=ke(ge,4),De=$e[0],ve=$e[1],we=$e[2],Re=$e[3],Ne=we??ue,Ke=S.useMemo(function(){return{columns:De,flattenColumns:ve}},[De,ve]),We=S.useRef(),ct=S.useRef(),Ee=S.useRef(),lt=S.useRef();S.useImperativeHandle(e,function(){return{nativeElement:We.current,scrollTo:function(zt){var ri;if(Ee.current instanceof HTMLElement){var ps=zt.index,ai=zt.top,ja=zt.key;if(ai){var Vr;(Vr=Ee.current)===null||Vr===void 0||Vr.scrollTo({top:ai})}else{var Wr,hc=ja??z(A[ps]);(Wr=Ee.current.querySelector('[data-row-key="'.concat(hc,'"]')))===null||Wr===void 0||Wr.scrollIntoView()}}else(ri=Ee.current)!==null&&ri!==void 0&&ri.scrollTo&&Ee.current.scrollTo(zt)}}});var Xe=S.useRef(),Le=S.useState(!1),Pe=ke(Le,2),ut=Pe[0],ht=Pe[1],Pt=S.useState(!1),ft=ke(Pt,2),Jn=ft[0],Ut=ft[1],vi=C$(new Map),Mt=ke(vi,2),ki=Mt[0],un=Mt[1],dn=mf(ve),gn=dn.map(function($t){return ki.get($t)}),Gn=S.useMemo(function(){return gn},[gn.join("_")]),Tt=zV(Gn,ve,f),Yt=u&&ig(u.y),jt=u&&ig(Ne)||!!re.fixed,Be=jt&&ve.some(function($t){var zt=$t.fixed;return zt}),ze=S.useRef(),Oe=LV(_,s),qe=Oe.isSticky,Dt=Oe.offsetHeader,Rt=Oe.offsetSummary,vn=Oe.offsetScroll,Je=Oe.stickyClassName,dt=Oe.container,st=S.useMemo(function(){return m==null?void 0:m(A)},[m,A]),vt=(Yt||qe)&&S.isValidElement(st)&&st.type===gf&&st.props.fixed,Kt,hn,An;Yt&&(hn={overflowY:"scroll",maxHeight:u.y}),jt&&(Kt={overflowX:"auto"},Yt||(hn={overflowY:"hidden"}),An={width:Ne===!0?"auto":Ne,minWidth:"100%"});var Xt=S.useCallback(function($t,zt){F_(We.current)&&un(function(ri){if(ri.get($t)!==zt){var ps=new Map(ri);return ps.set($t,zt),ps}return ri})},[]),Ue=MV(),je=ke(Ue,2),yt=je[0],Ft=je[1];function Zn($t,zt){zt&&(typeof zt=="function"?zt($t):zt.scrollLeft!==$t&&(zt.scrollLeft=$t,zt.scrollLeft!==$t&&setTimeout(function(){zt.scrollLeft=$t},0)))}var Di=ks(function($t){var zt=$t.currentTarget,ri=$t.scrollLeft,ps=f==="rtl",ai=typeof ri=="number"?ri:zt.scrollLeft,ja=zt||GV;if(!Ft()||Ft()===ja){var Vr;yt(ja),Zn(ai,ct.current),Zn(ai,Ee.current),Zn(ai,Xe.current),Zn(ai,(Vr=ze.current)===null||Vr===void 0?void 0:Vr.setScrollLeft)}var Wr=zt||ct.current;if(Wr){var hc=Wr.scrollWidth,Zp=Wr.clientWidth;if(hc===Zp){ht(!1),Ut(!1);return}ps?(ht(-ai<hc-Zp),Ut(-ai>0)):(ht(ai>0),Ut(ai<hc-Zp))}}),es=ks(function($t){Di($t),I==null||I($t)}),Ms=function(){jt&&Ee.current?Di({currentTarget:Ee.current}):(ht(!1),Ut(!1))},Fs=function(zt){var ri,ps=zt.width;(ri=ze.current)===null||ri===void 0||ri.checkScrollBarVisible();var ai=We.current?We.current.offsetWidth:ps;P&&D&&We.current&&(ai=D(We.current,ai)||ai),ai!==de&&(Ms(),Ie(ai))},ds=S.useRef(!1);S.useEffect(function(){ds.current&&Ms()},[jt,l,De.length]),S.useEffect(function(){ds.current=!0},[]);var Do=S.useState(0),it=ke(Do,2),wt=it[0],nn=it[1],ts=S.useState(!0),To=ke(ts,2),$d=To[0],Yp=To[1];S.useEffect(function(){(!k||!P)&&(Ee.current instanceof Element?nn(py(Ee.current).width):nn(py(lt.current).width)),Yp(IF("position","sticky"))},[]),S.useEffect(function(){P&&N&&(N.body.current=Ee.current)});var Jp=S.useCallback(function($t){return S.createElement(S.Fragment,null,S.createElement(mw,$t),vt==="top"&&S.createElement(_d,$t,st))},[vt,st]),Ed=S.useCallback(function($t){return S.createElement(_d,$t,st)},[st]),Ua=M(["table"],"table"),kt=S.useMemo(function(){return d||(Be?Ne==="max-content"?"auto":"fixed":Yt||qe||ve.some(function($t){var zt=$t.ellipsis;return zt})?"fixed":"auto")},[Yt,Be,ve,d,qe]),pt,Qn={colWidths:Gn,columCount:ve.length,stickyOffsets:Tt,onHeaderRow:C,fixHeader:Yt,scroll:u},oi=S.useMemo(function(){return O?null:typeof w=="function"?w():w},[O,w]),xn=S.createElement(vV,{data:A,measureColumnWidth:Yt||jt||qe}),Hn=S.createElement(y$,{colWidths:ve.map(function($t){var zt=$t.width;return zt}),columns:ve}),hs=g!=null?S.createElement("caption",{className:"".concat(s,"-caption")},g):void 0,fs=wo(i,{data:!0}),Qs=wo(i,{aria:!0});if(Yt||qe){var eo;typeof L=="function"?(eo=L(A,{scrollbarSize:wt,ref:Ee,onScroll:Di}),Qn.colWidths=ve.map(function($t,zt){var ri=$t.width,ps=zt===ve.length-1?ri-wt:ri;return typeof ps=="number"&&!Number.isNaN(ps)?ps:0})):eo=S.createElement("div",{style:me(me({},Kt),hn),onScroll:es,ref:Ee,className:ye("".concat(s,"-body"))},S.createElement(Ua,Ve({style:me(me({},An),{},{tableLayout:kt})},Qs),hs,Hn,xn,!vt&&st&&S.createElement(_d,{stickyOffsets:Tt,flattenColumns:ve},st)));var to=me(me(me({noData:!A.length,maxContentScroll:jt&&Ne==="max-content"},Qn),Ke),{},{direction:f,stickyClassName:Je,onScroll:Di});pt=S.createElement(S.Fragment,null,x!==!1&&S.createElement(pw,Ve({},to,{stickyTopOffset:Dt,className:"".concat(s,"-header"),ref:ct}),Jp),eo,vt&&vt!=="top"&&S.createElement(pw,Ve({},to,{stickyBottomOffset:Rt,className:"".concat(s,"-summary"),ref:Xe}),Ed),qe&&Ee.current&&Ee.current instanceof Element&&S.createElement(VV,{ref:ze,offsetScroll:vn,scrollBodyRef:Ee,onScroll:Di,container:dt}))}else pt=S.createElement("div",{style:me(me({},Kt),hn),className:ye("".concat(s,"-content")),onScroll:Di,ref:Ee},S.createElement(Ua,Ve({style:me(me({},An),{},{tableLayout:kt})},Qs),hs,Hn,x!==!1&&S.createElement(mw,Ve({},Qn,Ke)),xn,st&&S.createElement(_d,{stickyOffsets:Tt,flattenColumns:ve},st)));var ir=S.createElement("div",Ve({className:ye(s,o,(n={},X(n,"".concat(s,"-rtl"),f==="rtl"),X(n,"".concat(s,"-ping-left"),ut),X(n,"".concat(s,"-ping-right"),Jn),X(n,"".concat(s,"-layout-fixed"),d==="fixed"),X(n,"".concat(s,"-fixed-header"),Yt),X(n,"".concat(s,"-fixed-column"),Be),X(n,"".concat(s,"-fixed-column-gapped"),Be&&Re),X(n,"".concat(s,"-scroll-horizontal"),jt),X(n,"".concat(s,"-has-fix-left"),ve[0]&&ve[0].fixed),X(n,"".concat(s,"-has-fix-right"),ve[ve.length-1]&&ve[ve.length-1].fixed==="right"),n)),style:a,id:v,ref:We},fs),h&&S.createElement(xw,{className:"".concat(s,"-title")},h(A)),S.createElement("div",{ref:lt,className:"".concat(s,"-container")},pt),p&&S.createElement(xw,{className:"".concat(s,"-footer")},p(A)));jt&&(ir=S.createElement(Wl,{onResize:Fs},ir));var Br=PV(ve,Tt,f),l_=S.useMemo(function(){return{scrollX:Ne,prefixCls:s,getComponent:M,scrollbarSize:wt,direction:f,fixedInfoList:Br,isSticky:qe,supportSticky:$d,componentWidth:de,fixHeader:Yt,fixColumn:Be,horizonScroll:jt,tableLayout:kt,rowClassName:r,expandedRowClassName:re.expandedRowClassName,expandIcon:Y,expandableType:ee,expandRowByClick:re.expandRowByClick,expandedRowRender:re.expandedRowRender,onTriggerExpand:J,expandIconColumnIndex:re.expandIconColumnIndex,indentSize:re.indentSize,allColumnsFixedLeft:ve.every(function($t){return $t.fixed==="left"}),emptyNode:oi,columns:De,flattenColumns:ve,onColumnResize:Xt,hoverStartRow:q,hoverEndRow:H,onHover:ne,rowExpandable:re.rowExpandable,onRow:y,getRowKey:z,expandedKeys:j,childrenColumnName:se,rowHoverable:T}},[Ne,s,M,wt,f,Br,qe,$d,de,Yt,Be,jt,kt,r,re.expandedRowClassName,Y,ee,re.expandRowByClick,re.expandedRowRender,J,re.expandIconColumnIndex,re.indentSize,oi,De,ve,Xt,q,H,ne,re.rowExpandable,y,z,j,se,T]);return S.createElement(Zi.Provider,{value:l_},ir)}var jV=S.forwardRef(UV);function I$(t){return d$(jV,t)}var Xl=I$();Xl.EXPAND_COLUMN=rr;Xl.INTERNAL_HOOKS=ru;Xl.Column=uV;Xl.ColumnGroup=dV;Xl.Summary=p$;var ex=Yv(null),$$=Yv(null);function KV(t,e,n){var i=e||1;return n[t+i]-(n[t]||0)}function XV(t){var e=t.rowInfo,n=t.column,i=t.colIndex,s=t.indent,o=t.index,r=t.component,a=t.renderIndex,l=t.record,c=t.style,u=t.className,d=t.inverse,f=t.getHeight,h=n.render,p=n.dataIndex,m=n.className,g=n.width,v=Ii($$,["columnsOffset"]),x=v.columnsOffset,b=b$(e,n,i,s,o),w=b.key,y=b.fixedInfo,C=b.appendCellNode,I=b.additionalCellProps,$=I.style,E=I.colSpan,N=E===void 0?1:E,k=I.rowSpan,D=k===void 0?1:k,_=i-1,R=KV(_,N,x),T=N>1?g-R:0,A=me(me(me({},$),c),{},{flex:"0 0 ".concat(R,"px"),width:"".concat(R,"px"),marginRight:T,pointerEvents:"auto"}),O=S.useMemo(function(){return d?D<=1:N===0||D===0||D>1},[D,N,d]);O?A.visibility="hidden":d&&(A.height=f==null?void 0:f(D));var P=O?function(){return null}:h,M={};return(D===0||N===0)&&(M.rowSpan=1,M.colSpan=1),S.createElement(Ra,Ve({className:ye(m,u),ellipsis:n.ellipsis,align:n.align,scope:n.rowScope,component:r,prefixCls:e.prefixCls,key:w,record:l,index:o,renderIndex:a,dataIndex:p,render:P,shouldCellUpdate:n.shouldCellUpdate},y,{appendNode:C,additionalProps:me(me({},I),{},{style:A},M)}))}var qV=["data","index","className","rowKey","style","extra","getHeight"],YV=S.forwardRef(function(t,e){var n=t.data,i=t.index,s=t.className,o=t.rowKey,r=t.style,a=t.extra,l=t.getHeight,c=In(t,qV),u=n.record,d=n.indent,f=n.index,h=Ii(Zi,["prefixCls","flattenColumns","fixColumn","componentWidth","scrollX"]),p=h.scrollX,m=h.flattenColumns,g=h.prefixCls,v=h.fixColumn,x=h.componentWidth,b=Ii(ex,["getComponent"]),w=b.getComponent,y=v$(u,o,i,d),C=w(["body","row"],"div"),I=w(["body","cell"],"div"),$=y.rowSupportExpand,E=y.expanded,N=y.rowProps,k=y.expandedRowRender,D=y.expandedRowClassName,_;if($&&E){var R=k(u,i,d+1,E),T=D==null?void 0:D(u,i,d),A={};v&&(A={style:X({},"--virtual-width","".concat(x,"px"))});var O="".concat(g,"-expanded-row-cell");_=S.createElement(C,{className:ye("".concat(g,"-expanded-row"),"".concat(g,"-expanded-row-level-").concat(d+1),T)},S.createElement(Ra,{component:I,prefixCls:g,className:ye(O,X({},"".concat(O,"-fixed"),v)),additionalProps:A},R))}var P=me(me({},r),{},{width:p});a&&(P.position="absolute",P.pointerEvents="none");var M=S.createElement(C,Ve({},N,c,{"data-row-key":o,ref:$?null:e,className:ye(s,"".concat(g,"-row"),N==null?void 0:N.className,X({},"".concat(g,"-row-extra"),a)),style:me(me({},P),N==null?void 0:N.style)}),m.map(function(z,L){return S.createElement(XV,{key:L,component:I,rowInfo:y,column:z,colIndex:L,indent:d,index:i,renderIndex:f,record:u,inverse:a,getHeight:l})}));return $?S.createElement("div",{ref:e},M,_):M}),bw=Kl(YV),JV=S.forwardRef(function(t,e){var n=t.data,i=t.onScroll,s=Ii(Zi,["flattenColumns","onColumnResize","getRowKey","prefixCls","expandedKeys","childrenColumnName","emptyNode","scrollX"]),o=s.flattenColumns,r=s.onColumnResize,a=s.getRowKey,l=s.expandedKeys,c=s.prefixCls,u=s.childrenColumnName,d=s.emptyNode,f=s.scrollX,h=Ii(ex),p=h.sticky,m=h.scrollY,g=h.listItemHeight,v=h.getComponent,x=h.onScroll,b=S.useRef(),w=g$(n,u,l,a),y=S.useMemo(function(){var A=0;return o.map(function(O){var P=O.width,M=O.key;return A+=P,[M,P,A]})},[o]),C=S.useMemo(function(){return y.map(function(A){return A[2]})},[y]);S.useEffect(function(){y.forEach(function(A){var O=ke(A,2),P=O[0],M=O[1];r(P,M)})},[y]),S.useImperativeHandle(e,function(){var A={scrollTo:function(P){var M;(M=b.current)===null||M===void 0||M.scrollTo(P)}};return Object.defineProperty(A,"scrollLeft",{get:function(){var P;return((P=b.current)===null||P===void 0?void 0:P.getScrollInfo().x)||0},set:function(P){var M;(M=b.current)===null||M===void 0||M.scrollTo({left:P})}}),A});var I=function(O,P){var M,z=(M=w[P])===null||M===void 0?void 0:M.record,L=O.onCell;if(L){var W,B=L(z,P);return(W=B==null?void 0:B.rowSpan)!==null&&W!==void 0?W:1}return 1},$=function(O){var P=O.start,M=O.end,z=O.getSize,L=O.offsetY;if(M<0)return null;for(var W=o.filter(function(J){return I(J,P)===0}),B=P,q=function(ue){if(W=W.filter(function(oe){return I(oe,ue)===0}),!W.length)return B=ue,1},H=P;H>=0&&!q(H);H-=1);for(var ne=o.filter(function(J){return I(J,M)!==1}),te=M,ae=function(ue){if(ne=ne.filter(function(oe){return I(oe,ue)!==1}),!ne.length)return te=Math.max(ue-1,M),1},re=M;re<w.length&&!ae(re);re+=1);for(var ee=[],j=function(ue){var oe=w[ue];if(!oe)return 1;o.some(function(be){return I(be,ue)>1})&&ee.push(ue)},Y=B;Y<=te;Y+=1)j(Y);var se=ee.map(function(J){var ue=w[J],oe=a(ue.record,J),be=function(ge){var $e=J+ge-1,De=a(w[$e].record,$e),ve=z(oe,De);return ve.bottom-ve.top},de=z(oe);return S.createElement(bw,{key:J,data:ue,rowKey:oe,index:J,style:{top:-L+de.top},extra:!0,getHeight:be})});return se},E=S.useMemo(function(){return{columnsOffset:C}},[C]),N="".concat(c,"-tbody"),k=v(["body","wrapper"]),D=v(["body","row"],"div"),_=v(["body","cell"],"div"),R;if(w.length){var T={};p&&(T.position="sticky",T.bottom=0,_n(p)==="object"&&p.offsetScroll&&(T.bottom=p.offsetScroll)),R=S.createElement(df,{fullHeight:!1,ref:b,prefixCls:"".concat(N,"-virtual"),styles:{horizontalScrollBar:T},className:N,height:m,itemHeight:g||24,data:w,itemKey:function(O){return a(O.record)},component:k,scrollWidth:f,onVirtualScroll:function(O){var P=O.x;i({scrollLeft:P})},onScroll:x,extraRender:$},function(A,O,P){var M=a(A.record,O);return S.createElement(bw,{data:A,rowKey:M,index:O,style:P.style})})}else R=S.createElement(D,{className:ye("".concat(c,"-placeholder"))},S.createElement(Ra,{component:_,prefixCls:c},d));return S.createElement($$.Provider,{value:E},R)}),ZV=Kl(JV),QV=function(e,n){var i=n.ref,s=n.onScroll;return S.createElement(ZV,{ref:i,data:e,onScroll:s})};function eW(t,e){var n=t.columns,i=t.scroll,s=t.sticky,o=t.prefixCls,r=o===void 0?S$:o,a=t.className,l=t.listItemHeight,c=t.components,u=t.onScroll,d=i||{},f=d.x,h=d.y;typeof f!="number"&&(f=1),typeof h!="number"&&(h=500);var p=ks(function(v,x){return fv(c,v)||x}),m=ks(u),g=S.useMemo(function(){return{sticky:s,scrollY:h,listItemHeight:l,getComponent:p,onScroll:m}},[s,h,l,p,m]);return S.createElement(ex.Provider,{value:g},S.createElement(Xl,Ve({},t,{className:ye(a,"".concat(r,"-virtual")),scroll:me(me({},i),{},{x:f}),components:me(me({},c),{},{body:QV}),columns:n,internalHooks:ru,tailor:!0,ref:e})))}var tW=S.forwardRef(eW);function E$(t){return d$(tW,t)}E$();const nW=t=>null,iW=t=>null;var tx=S.createContext(null),sW=function(e){for(var n=e.prefixCls,i=e.level,s=e.isStart,o=e.isEnd,r="".concat(n,"-indent-unit"),a=[],l=0;l<i;l+=1)a.push(S.createElement("span",{key:l,className:ye(r,X(X({},"".concat(r,"-start"),s[l]),"".concat(r,"-end"),o[l]))}));return S.createElement("span",{"aria-hidden":"true",className:"".concat(n,"-indent")},a)};const oW=S.memo(sW);var rW=["eventKey","className","style","dragOver","dragOverGapTop","dragOverGapBottom","isLeaf","isStart","isEnd","expanded","selected","checked","halfChecked","loading","domRef","active","data","onMouseMove","selectable"],yw="open",ww="close",aW="---",lW=function(t){m1(n,t);var e=g1(n);function n(){var i;lv(this,n);for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return i=e.call.apply(e,[this].concat(o)),X(Ae(i),"state",{dragNodeHighlight:!1}),X(Ae(i),"selectHandle",void 0),X(Ae(i),"cacheIndent",void 0),X(Ae(i),"onSelectorClick",function(a){var l=i.props.context.onNodeClick;l(a,Pn(i.props)),i.isSelectable()?i.onSelect(a):i.onCheck(a)}),X(Ae(i),"onSelectorDoubleClick",function(a){var l=i.props.context.onNodeDoubleClick;l(a,Pn(i.props))}),X(Ae(i),"onSelect",function(a){if(!i.isDisabled()){var l=i.props.context.onNodeSelect;l(a,Pn(i.props))}}),X(Ae(i),"onCheck",function(a){if(!i.isDisabled()){var l=i.props,c=l.disableCheckbox,u=l.checked,d=i.props.context.onNodeCheck;if(!(!i.isCheckable()||c)){var f=!u;d(a,Pn(i.props),f)}}}),X(Ae(i),"onMouseEnter",function(a){var l=i.props.context.onNodeMouseEnter;l(a,Pn(i.props))}),X(Ae(i),"onMouseLeave",function(a){var l=i.props.context.onNodeMouseLeave;l(a,Pn(i.props))}),X(Ae(i),"onContextMenu",function(a){var l=i.props.context.onNodeContextMenu;l(a,Pn(i.props))}),X(Ae(i),"onDragStart",function(a){var l=i.props.context.onNodeDragStart;a.stopPropagation(),i.setState({dragNodeHighlight:!0}),l(a,Ae(i));try{a.dataTransfer.setData("text/plain","")}catch{}}),X(Ae(i),"onDragEnter",function(a){var l=i.props.context.onNodeDragEnter;a.preventDefault(),a.stopPropagation(),l(a,Ae(i))}),X(Ae(i),"onDragOver",function(a){var l=i.props.context.onNodeDragOver;a.preventDefault(),a.stopPropagation(),l(a,Ae(i))}),X(Ae(i),"onDragLeave",function(a){var l=i.props.context.onNodeDragLeave;a.stopPropagation(),l(a,Ae(i))}),X(Ae(i),"onDragEnd",function(a){var l=i.props.context.onNodeDragEnd;a.stopPropagation(),i.setState({dragNodeHighlight:!1}),l(a,Ae(i))}),X(Ae(i),"onDrop",function(a){var l=i.props.context.onNodeDrop;a.preventDefault(),a.stopPropagation(),i.setState({dragNodeHighlight:!1}),l(a,Ae(i))}),X(Ae(i),"onExpand",function(a){var l=i.props,c=l.loading,u=l.context.onNodeExpand;c||u(a,Pn(i.props))}),X(Ae(i),"setSelectHandle",function(a){i.selectHandle=a}),X(Ae(i),"getNodeState",function(){var a=i.props.expanded;return i.isLeaf()?null:a?yw:ww}),X(Ae(i),"hasChildren",function(){var a=i.props.eventKey,l=i.props.context.keyEntities,c=Wi(l,a)||{},u=c.children;return!!(u||[]).length}),X(Ae(i),"isLeaf",function(){var a=i.props,l=a.isLeaf,c=a.loaded,u=i.props.context.loadData,d=i.hasChildren();return l===!1?!1:l||!u&&!d||u&&c&&!d}),X(Ae(i),"isDisabled",function(){var a=i.props.disabled,l=i.props.context.disabled;return!!(l||a)}),X(Ae(i),"isCheckable",function(){var a=i.props.checkable,l=i.props.context.checkable;return!l||a===!1?!1:l}),X(Ae(i),"syncLoadData",function(a){var l=a.expanded,c=a.loading,u=a.loaded,d=i.props.context,f=d.loadData,h=d.onNodeLoad;c||f&&l&&!i.isLeaf()&&!u&&h(Pn(i.props))}),X(Ae(i),"isDraggable",function(){var a=i.props,l=a.data,c=a.context.draggable;return!!(c&&(!c.nodeDraggable||c.nodeDraggable(l)))}),X(Ae(i),"renderDragHandler",function(){var a=i.props.context,l=a.draggable,c=a.prefixCls;return l!=null&&l.icon?S.createElement("span",{className:"".concat(c,"-draggable-icon")},l.icon):null}),X(Ae(i),"renderSwitcherIconDom",function(a){var l=i.props.switcherIcon,c=i.props.context.switcherIcon,u=l||c;return typeof u=="function"?u(me(me({},i.props),{},{isLeaf:a})):u}),X(Ae(i),"renderSwitcher",function(){var a=i.props.expanded,l=i.props.context.prefixCls;if(i.isLeaf()){var c=i.renderSwitcherIconDom(!0);return c!==!1?S.createElement("span",{className:ye("".concat(l,"-switcher"),"".concat(l,"-switcher-noop"))},c):null}var u=ye("".concat(l,"-switcher"),"".concat(l,"-switcher_").concat(a?yw:ww)),d=i.renderSwitcherIconDom(!1);return d!==!1?S.createElement("span",{onClick:i.onExpand,className:u},d):null}),X(Ae(i),"renderCheckbox",function(){var a=i.props,l=a.checked,c=a.halfChecked,u=a.disableCheckbox,d=i.props.context.prefixCls,f=i.isDisabled(),h=i.isCheckable();if(!h)return null;var p=typeof h!="boolean"?h:null;return S.createElement("span",{className:ye("".concat(d,"-checkbox"),l&&"".concat(d,"-checkbox-checked"),!l&&c&&"".concat(d,"-checkbox-indeterminate"),(f||u)&&"".concat(d,"-checkbox-disabled")),onClick:i.onCheck},p)}),X(Ae(i),"renderIcon",function(){var a=i.props.loading,l=i.props.context.prefixCls;return S.createElement("span",{className:ye("".concat(l,"-iconEle"),"".concat(l,"-icon__").concat(i.getNodeState()||"docu"),a&&"".concat(l,"-icon_loading"))})}),X(Ae(i),"renderSelector",function(){var a=i.state.dragNodeHighlight,l=i.props,c=l.title,u=c===void 0?aW:c,d=l.selected,f=l.icon,h=l.loading,p=l.data,m=i.props.context,g=m.prefixCls,v=m.showIcon,x=m.icon,b=m.loadData,w=m.titleRender,y=i.isDisabled(),C="".concat(g,"-node-content-wrapper"),I;if(v){var $=f||x;I=$?S.createElement("span",{className:ye("".concat(g,"-iconEle"),"".concat(g,"-icon__customize"))},typeof $=="function"?$(i.props):$):i.renderIcon()}else b&&h&&(I=i.renderIcon());var E;typeof u=="function"?E=u(p):w?E=w(p):E=u;var N=S.createElement("span",{className:"".concat(g,"-title")},E);return S.createElement("span",{ref:i.setSelectHandle,title:typeof u=="string"?u:"",className:ye("".concat(C),"".concat(C,"-").concat(i.getNodeState()||"normal"),!y&&(d||a)&&"".concat(g,"-node-selected")),onMouseEnter:i.onMouseEnter,onMouseLeave:i.onMouseLeave,onContextMenu:i.onContextMenu,onClick:i.onSelectorClick,onDoubleClick:i.onSelectorDoubleClick},I,N,i.renderDropIndicator())}),X(Ae(i),"renderDropIndicator",function(){var a=i.props,l=a.disabled,c=a.eventKey,u=i.props.context,d=u.draggable,f=u.dropLevelOffset,h=u.dropPosition,p=u.prefixCls,m=u.indent,g=u.dropIndicatorRender,v=u.dragOverNodeKey,x=u.direction,b=!!d,w=!l&&b&&v===c,y=m??i.cacheIndent;return i.cacheIndent=m,w?g({dropPosition:h,dropLevelOffset:f,indent:y,prefixCls:p,direction:x}):null}),i}return av(n,[{key:"componentDidMount",value:function(){this.syncLoadData(this.props)}},{key:"componentDidUpdate",value:function(){this.syncLoadData(this.props)}},{key:"isSelectable",value:function(){var s=this.props.selectable,o=this.props.context.selectable;return typeof s=="boolean"?s:o}},{key:"render",value:function(){var s,o=this.props,r=o.eventKey,a=o.className,l=o.style,c=o.dragOver,u=o.dragOverGapTop,d=o.dragOverGapBottom,f=o.isLeaf,h=o.isStart,p=o.isEnd,m=o.expanded,g=o.selected,v=o.checked,x=o.halfChecked,b=o.loading,w=o.domRef,y=o.active;o.data;var C=o.onMouseMove,I=o.selectable,$=In(o,rW),E=this.props.context,N=E.prefixCls,k=E.filterTreeNode,D=E.keyEntities,_=E.dropContainerKey,R=E.dropTargetKey,T=E.draggingNodeKey,A=this.isDisabled(),O=wo($,{aria:!0,data:!0}),P=Wi(D,r)||{},M=P.level,z=p[p.length-1],L=this.isDraggable(),W=!A&&L,B=T===r,q=I!==void 0?{"aria-selected":!!I}:void 0;return S.createElement("div",Ve({ref:w,className:ye(a,"".concat(N,"-treenode"),(s={},X(X(X(X(X(X(X(X(X(X(s,"".concat(N,"-treenode-disabled"),A),"".concat(N,"-treenode-switcher-").concat(m?"open":"close"),!f),"".concat(N,"-treenode-checkbox-checked"),v),"".concat(N,"-treenode-checkbox-indeterminate"),x),"".concat(N,"-treenode-selected"),g),"".concat(N,"-treenode-loading"),b),"".concat(N,"-treenode-active"),y),"".concat(N,"-treenode-leaf-last"),z),"".concat(N,"-treenode-draggable"),L),"dragging",B),X(X(X(X(X(X(s,"drop-target",R===r),"drop-container",_===r),"drag-over",!A&&c),"drag-over-gap-top",!A&&u),"drag-over-gap-bottom",!A&&d),"filter-node",k&&k(Pn(this.props))))),style:l,draggable:W,"aria-grabbed":B,onDragStart:W?this.onDragStart:void 0,onDragEnter:L?this.onDragEnter:void 0,onDragOver:L?this.onDragOver:void 0,onDragLeave:L?this.onDragLeave:void 0,onDrop:L?this.onDrop:void 0,onDragEnd:L?this.onDragEnd:void 0,onMouseMove:C},q,O),S.createElement(oW,{prefixCls:N,level:M,isStart:h,isEnd:p}),this.renderDragHandler(),this.renderSwitcher(),this.renderCheckbox(),this.renderSelector())}}]),n}(S.Component),Nl=function(e){return S.createElement(tx.Consumer,null,function(n){return S.createElement(lW,Ve({},e,{context:n}))})};Nl.displayName="TreeNode";Nl.isTreeNode=1;function io(t,e){if(!t)return[];var n=t.slice(),i=n.indexOf(e);return i>=0&&n.splice(i,1),n}function _o(t,e){var n=(t||[]).slice();return n.indexOf(e)===-1&&n.push(e),n}function nx(t){return t.split("-")}function cW(t,e){var n=[],i=Wi(e,t);function s(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];o.forEach(function(r){var a=r.key,l=r.children;n.push(a),s(l)})}return s(i.children),n}function uW(t){if(t.parent){var e=nx(t.pos);return Number(e[e.length-1])===t.parent.children.length-1}return!1}function dW(t){var e=nx(t.pos);return Number(e[e.length-1])===0}function Cw(t,e,n,i,s,o,r,a,l,c){var u,d=t.clientX,f=t.clientY,h=t.target.getBoundingClientRect(),p=h.top,m=h.height,g=(c==="rtl"?-1:1)*(((s==null?void 0:s.x)||0)-d),v=(g-12)/i,x=l.filter(function(A){var O;return(O=a[A])===null||O===void 0||(O=O.children)===null||O===void 0?void 0:O.length}),b=Wi(a,n.props.eventKey);if(f<p+m/2){var w=r.findIndex(function(A){return A.key===b.key}),y=w<=0?0:w-1,C=r[y].key;b=Wi(a,C)}var I=b.key,$=b,E=b.key,N=0,k=0;if(!x.includes(I))for(var D=0;D<v&&uW(b);D+=1)b=b.parent,k+=1;var _=e.props.data,R=b.node,T=!0;return dW(b)&&b.level===0&&f<p+m/2&&o({dragNode:_,dropNode:R,dropPosition:-1})&&b.key===n.props.eventKey?N=-1:($.children||[]).length&&x.includes(E)?o({dragNode:_,dropNode:R,dropPosition:0})?N=0:T=!1:k===0?v>-1.5?o({dragNode:_,dropNode:R,dropPosition:1})?N=1:T=!1:o({dragNode:_,dropNode:R,dropPosition:0})?N=0:o({dragNode:_,dropNode:R,dropPosition:1})?N=1:T=!1:o({dragNode:_,dropNode:R,dropPosition:1})?N=1:T=!1,{dropPosition:N,dropLevelOffset:k,dropTargetKey:b.key,dropTargetPos:b.pos,dragOverNodeKey:E,dropContainerKey:N===0?null:((u=b.parent)===null||u===void 0?void 0:u.key)||null,dropAllowed:T}}function Sw(t,e){if(t){var n=e.multiple;return n?t.slice():t.length?[t[0]]:t}}function fm(t){if(!t)return null;var e;if(Array.isArray(t))e={checkedKeys:t,halfCheckedKeys:void 0};else if(_n(t)==="object")e={checkedKeys:t.checked||void 0,halfCheckedKeys:t.halfChecked||void 0};else return Lo(!1,"`checkedKeys` is not an array or an object"),null;return e}function og(t,e){var n=new Set;function i(s){if(!n.has(s)){var o=Wi(e,s);if(o){n.add(s);var r=o.parent,a=o.node;a.disabled||r&&i(r.key)}}}return(t||[]).forEach(function(s){i(s)}),Ze(n)}function hW(t){const[e,n]=S.useState(null);return[S.useCallback((o,r,a)=>{const l=e??o,c=Math.min(l||0,o),u=Math.max(l||0,o),d=r.slice(c,u+1).map(p=>t(p)),f=d.some(p=>!a.has(p)),h=[];return d.forEach(p=>{f?(a.has(p)||h.push(p),a.add(p)):(a.delete(p),h.push(p))}),n(f?u:null),h},[e]),o=>{n(o)}]}const or={},rg="SELECT_ALL",ag="SELECT_INVERT",lg="SELECT_NONE",Iw=[],N$=(t,e)=>{let n=[];return(e||[]).forEach(i=>{n.push(i),i&&typeof i=="object"&&t in i&&(n=[].concat(Ze(n),Ze(N$(t,i[t]))))}),n},fW=(t,e)=>{const{preserveSelectedRowKeys:n,selectedRowKeys:i,defaultSelectedRowKeys:s,getCheckboxProps:o,onChange:r,onSelect:a,onSelectAll:l,onSelectInvert:c,onSelectNone:u,onSelectMultiple:d,columnWidth:f,type:h,selections:p,fixed:m,renderCell:g,hideSelectAll:v,checkStrictly:x=!0}=e||{},{prefixCls:b,data:w,pageData:y,getRecordByKey:C,getRowKey:I,expandType:$,childrenColumnName:E,locale:N,getPopupContainer:k}=t,D=pv(),[_,R]=hW(j=>j),[T,A]=Wo(i||s||Iw,{value:i}),O=S.useRef(new Map),P=S.useCallback(j=>{if(n){const Y=new Map;j.forEach(se=>{let J=C(se);!J&&O.current.has(se)&&(J=O.current.get(se)),Y.set(se,J)}),O.current=Y}},[C,n]);S.useEffect(()=>{P(T)},[T]);const{keyEntities:M}=S.useMemo(()=>{if(x)return{keyEntities:null};let j=w;if(n){const Y=new Set(w.map((J,ue)=>I(J,ue))),se=Array.from(O.current).reduce((J,ue)=>{let[oe,be]=ue;return Y.has(oe)?J:J.concat(be)},[]);j=[].concat(Ze(j),Ze(se))}return Xv(j,{externalGetKey:I,childrenPropName:E})},[w,I,x,E,n]),z=S.useMemo(()=>N$(E,y),[E,y]),L=S.useMemo(()=>{const j=new Map;return z.forEach((Y,se)=>{const J=I(Y,se),ue=(o?o(Y):null)||{};j.set(J,ue)}),j},[z,I,o]),W=S.useCallback(j=>{var Y;return!!(!((Y=L.get(I(j)))===null||Y===void 0)&&Y.disabled)},[L,I]),[B,q]=S.useMemo(()=>{if(x)return[T||[],[]];const{checkedKeys:j,halfCheckedKeys:Y}=rl(T,!0,M,W);return[j||[],Y]},[T,x,M,W]),H=S.useMemo(()=>{const j=h==="radio"?B.slice(0,1):B;return new Set(j)},[B,h]),ne=S.useMemo(()=>h==="radio"?new Set:new Set(q),[q,h]);S.useEffect(()=>{e||A(Iw)},[!!e]);const te=S.useCallback((j,Y)=>{let se,J;P(j),n?(se=j,J=j.map(ue=>O.current.get(ue))):(se=[],J=[],j.forEach(ue=>{const oe=C(ue);oe!==void 0&&(se.push(ue),J.push(oe))})),A(se),r==null||r(se,J,{type:Y})},[A,C,r,n]),ae=S.useCallback((j,Y,se,J)=>{if(a){const ue=se.map(oe=>C(oe));a(C(j),Y,ue,J)}te(se,"single")},[a,C,te]),re=S.useMemo(()=>!p||v?null:(p===!0?[rg,ag,lg]:p).map(Y=>Y===rg?{key:"all",text:N.selectionAll,onSelect(){te(w.map((se,J)=>I(se,J)).filter(se=>{const J=L.get(se);return!(J!=null&&J.disabled)||H.has(se)}),"all")}}:Y===ag?{key:"invert",text:N.selectInvert,onSelect(){const se=new Set(H);y.forEach((ue,oe)=>{const be=I(ue,oe),de=L.get(be);de!=null&&de.disabled||(se.has(be)?se.delete(be):se.add(be))});const J=Array.from(se);c&&(D.deprecated(!1,"onSelectInvert","onChange"),c(J)),te(J,"invert")}}:Y===lg?{key:"none",text:N.selectNone,onSelect(){u==null||u(),te(Array.from(H).filter(se=>{const J=L.get(se);return J==null?void 0:J.disabled}),"none")}}:Y).map(Y=>Object.assign(Object.assign({},Y),{onSelect:function(){for(var se,J,ue=arguments.length,oe=new Array(ue),be=0;be<ue;be++)oe[be]=arguments[be];(J=Y.onSelect)===null||J===void 0||(se=J).call.apply(se,[Y].concat(oe)),R(null)}})),[p,H,y,I,c,te]);return[S.useCallback(j=>{var Y;if(!e)return j.filter(Ee=>Ee!==or);let se=Ze(j);const J=new Set(H),ue=z.map(I).filter(Ee=>!L.get(Ee).disabled),oe=ue.every(Ee=>J.has(Ee)),be=ue.some(Ee=>J.has(Ee)),de=()=>{const Ee=[];oe?ue.forEach(Xe=>{J.delete(Xe),Ee.push(Xe)}):ue.forEach(Xe=>{J.has(Xe)||(J.add(Xe),Ee.push(Xe))});const lt=Array.from(J);l==null||l(!oe,lt.map(Xe=>C(Xe)),Ee.map(Xe=>C(Xe))),te(lt,"all"),R(null)};let Ie,ge;if(h!=="radio"){let Ee;if(re){const ut={getPopupContainer:k,items:re.map((ht,Pt)=>{const{key:ft,text:Jn,onSelect:Ut}=ht;return{key:ft??Pt,onClick:()=>{Ut==null||Ut(ue)},label:Jn}})};Ee=S.createElement("div",{className:`${b}-selection-extra`},S.createElement(I1,{menu:ut,getPopupContainer:k},S.createElement("span",null,S.createElement(zI,null))))}const lt=z.map((ut,ht)=>{const Pt=I(ut,ht),ft=L.get(Pt)||{};return Object.assign({checked:J.has(Pt)},ft)}).filter(ut=>{let{disabled:ht}=ut;return ht}),Xe=!!lt.length&&lt.length===z.length,Le=Xe&&lt.every(ut=>{let{checked:ht}=ut;return ht}),Pe=Xe&&lt.some(ut=>{let{checked:ht}=ut;return ht});ge=S.createElement(El,{checked:Xe?Le:!!z.length&&oe,indeterminate:Xe?!Le&&Pe:!oe&&be,onChange:de,disabled:z.length===0||Xe,"aria-label":Ee?"Custom selection":"Select all",skipGroup:!0}),Ie=!v&&S.createElement("div",{className:`${b}-selection`},ge,Ee)}let $e;h==="radio"?$e=(Ee,lt,Xe)=>{const Le=I(lt,Xe),Pe=J.has(Le);return{node:S.createElement(y1,Object.assign({},L.get(Le),{checked:Pe,onClick:ut=>ut.stopPropagation(),onChange:ut=>{J.has(Le)||ae(Le,!0,[Le],ut.nativeEvent)}})),checked:Pe}}:$e=(Ee,lt,Xe)=>{var Le;const Pe=I(lt,Xe),ut=J.has(Pe),ht=ne.has(Pe),Pt=L.get(Pe);let ft;return $==="nest"?ft=ht:ft=(Le=Pt==null?void 0:Pt.indeterminate)!==null&&Le!==void 0?Le:ht,{node:S.createElement(El,Object.assign({},Pt,{indeterminate:ft,checked:ut,skipGroup:!0,onClick:Jn=>Jn.stopPropagation(),onChange:Jn=>{let{nativeEvent:Ut}=Jn;const{shiftKey:vi}=Ut,Mt=ue.findIndex(un=>un===Pe),ki=B.some(un=>ue.includes(un));if(vi&&x&&ki){const un=_(Mt,ue,J),dn=Array.from(J);d==null||d(!ut,dn.map(gn=>C(gn)),un.map(gn=>C(gn))),te(dn,"multiple")}else{const un=B;if(x){const dn=ut?io(un,Pe):_o(un,Pe);ae(Pe,!ut,dn,Ut)}else{const dn=rl([].concat(Ze(un),[Pe]),!0,M,W),{checkedKeys:gn,halfCheckedKeys:Gn}=dn;let Tt=gn;if(ut){const Yt=new Set(gn);Yt.delete(Pe),Tt=rl(Array.from(Yt),{checked:!1,halfCheckedKeys:Gn},M,W).checkedKeys}ae(Pe,!ut,Tt,Ut)}}R(ut?null:Mt)}})),checked:ut}};const De=(Ee,lt,Xe)=>{const{node:Le,checked:Pe}=$e(Ee,lt,Xe);return g?g(Pe,lt,Xe,Le):Le};if(!se.includes(or))if(se.findIndex(Ee=>{var lt;return((lt=Ee[Tc])===null||lt===void 0?void 0:lt.columnType)==="EXPAND_COLUMN"})===0){const[Ee,...lt]=se;se=[Ee,or].concat(Ze(lt))}else se=[or].concat(Ze(se));const ve=se.indexOf(or);se=se.filter((Ee,lt)=>Ee!==or||lt===ve);const we=se[ve-1],Re=se[ve+1];let Ne=m;Ne===void 0&&((Re==null?void 0:Re.fixed)!==void 0?Ne=Re.fixed:(we==null?void 0:we.fixed)!==void 0&&(Ne=we.fixed)),Ne&&we&&((Y=we[Tc])===null||Y===void 0?void 0:Y.columnType)==="EXPAND_COLUMN"&&we.fixed===void 0&&(we.fixed=Ne);const Ke=ye(`${b}-selection-col`,{[`${b}-selection-col-with-dropdown`]:p&&h==="checkbox"}),We=()=>e!=null&&e.columnTitle?typeof e.columnTitle=="function"?e.columnTitle(ge):e.columnTitle:Ie,ct={fixed:Ne,width:f,className:`${b}-selection-column`,title:We(),render:De,onCell:e.onCell,[Tc]:{className:Ke}};return se.map(Ee=>Ee===or?ct:Ee)},[I,z,e,B,H,ne,f,re,$,L,d,ae,W]),H]};function pW(t,e){return t._antProxy=t._antProxy||{},Object.keys(e).forEach(n=>{if(!(n in t._antProxy)){const i=t[n];t._antProxy[n]=i,t[n]=e[n]}}),t}function mW(t,e){return S.useImperativeHandle(t,()=>{const n=e(),{nativeElement:i}=n;return typeof Proxy<"u"?new Proxy(i,{get(s,o){return n[o]?n[o]:Reflect.get(s,o)}}):pW(i,n)})}function gW(t){return e=>{const{prefixCls:n,onExpand:i,record:s,expanded:o,expandable:r}=e,a=`${n}-row-expand-icon`;return S.createElement("button",{type:"button",onClick:l=>{i(s,l),l.stopPropagation()},className:ye(a,{[`${a}-spaced`]:!r,[`${a}-expanded`]:r&&o,[`${a}-collapsed`]:r&&!o}),"aria-label":o?t.collapse:t.expand,"aria-expanded":o})}}function vW(t){return(n,i)=>{const s=n.querySelector(`.${t}-container`);let o=i;if(s){const r=getComputedStyle(s),a=parseInt(r.borderLeftWidth,10),l=parseInt(r.borderRightWidth,10);o=i-a-l}return o}}const wr=(t,e)=>"key"in t&&t.key!==void 0&&t.key!==null?t.key:t.dataIndex?Array.isArray(t.dataIndex)?t.dataIndex.join("."):t.dataIndex:e;function ql(t,e){return e?`${e}-${t}`:`${t}`}const vf=(t,e)=>typeof t=="function"?t(e):t,xW=(t,e)=>{const n=vf(t,e);return Object.prototype.toString.call(n)==="[object Object]"?"":n};function bW(t){const e=S.useRef(t),n=nA();return[()=>e.current,i=>{e.current=i,n()}]}function yW(t){var e=t.dropPosition,n=t.dropLevelOffset,i=t.indent,s={pointerEvents:"none",position:"absolute",right:0,backgroundColor:"red",height:2};switch(e){case-1:s.top=0,s.left=-n*i;break;case 1:s.bottom=0,s.left=-n*i;break;case 0:s.bottom=0,s.left=i;break}return S.createElement("div",{style:s})}function k$(t){if(t==null)throw new TypeError("Cannot destructure "+t)}function wW(t,e){var n=S.useState(!1),i=ke(n,2),s=i[0],o=i[1];Ki(function(){if(s)return t(),function(){e()}},[s]),Ki(function(){return o(!0),function(){o(!1)}},[])}var CW=["className","style","motion","motionNodes","motionType","onMotionStart","onMotionEnd","active","treeNodeRequiredProps"],D$=function(e,n){var i=e.className,s=e.style,o=e.motion,r=e.motionNodes,a=e.motionType,l=e.onMotionStart,c=e.onMotionEnd,u=e.active,d=e.treeNodeRequiredProps,f=In(e,CW),h=S.useState(!0),p=ke(h,2),m=p[0],g=p[1],v=S.useContext(tx),x=v.prefixCls,b=r&&a!=="hide";Ki(function(){r&&b!==m&&g(b)},[r]);var w=function(){r&&l()},y=S.useRef(!1),C=function(){r&&!y.current&&(y.current=!0,c())};wW(w,C);var I=function(E){b===E&&C()};return r?S.createElement(L_,Ve({ref:n,visible:m},o,{motionAppear:a==="show",onVisibleChanged:I}),function($,E){var N=$.className,k=$.style;return S.createElement("div",{ref:E,className:ye("".concat(x,"-treenode-motion"),N),style:k},r.map(function(D){var _=Object.assign({},(k$(D.data),D.data)),R=D.title,T=D.key,A=D.isStart,O=D.isEnd;delete _.children;var P=Dc(T,d);return S.createElement(Nl,Ve({},_,P,{title:R,active:u,data:D.data,key:T,isStart:A,isEnd:O}))}))}):S.createElement(Nl,Ve({domRef:n,className:i,style:s},f,{active:u}))};D$.displayName="MotionTreeNode";var SW=S.forwardRef(D$);function IW(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=t.length,i=e.length;if(Math.abs(n-i)!==1)return{add:!1,key:null};function s(o,r){var a=new Map;o.forEach(function(c){a.set(c,!0)});var l=r.filter(function(c){return!a.has(c)});return l.length===1?l[0]:null}return n<i?{add:!0,key:s(t,e)}:{add:!1,key:s(e,t)}}function $w(t,e,n){var i=t.findIndex(function(a){return a.key===n}),s=t[i+1],o=e.findIndex(function(a){return a.key===n});if(s){var r=e.findIndex(function(a){return a.key===s.key});return e.slice(o+1,r)}return e.slice(o+1)}var $W=["prefixCls","data","selectable","checkable","expandedKeys","selectedKeys","checkedKeys","loadedKeys","loadingKeys","halfCheckedKeys","keyEntities","disabled","dragging","dragOverNodeKey","dropPosition","motion","height","itemHeight","virtual","focusable","activeItem","focused","tabIndex","onKeyDown","onFocus","onBlur","onActiveChange","onListChangeStart","onListChangeEnd"],Ew={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},EW=function(){},da="RC_TREE_MOTION_".concat(Math.random()),cg={key:da},T$={key:da,level:0,index:0,pos:"0",node:cg,nodes:[cg]},Nw={parent:null,children:[],pos:T$.pos,data:cg,title:null,key:da,isStart:[],isEnd:[]};function kw(t,e,n,i){return e===!1||!n?t:t.slice(0,Math.ceil(n/i)+1)}function Dw(t){var e=t.key,n=t.pos;return ou(e,n)}function NW(t){for(var e=String(t.data.key),n=t;n.parent;)n=n.parent,e="".concat(n.data.key," > ").concat(e);return e}var R$=S.forwardRef(function(t,e){var n=t.prefixCls,i=t.data;t.selectable,t.checkable;var s=t.expandedKeys,o=t.selectedKeys,r=t.checkedKeys,a=t.loadedKeys,l=t.loadingKeys,c=t.halfCheckedKeys,u=t.keyEntities,d=t.disabled,f=t.dragging,h=t.dragOverNodeKey,p=t.dropPosition,m=t.motion,g=t.height,v=t.itemHeight,x=t.virtual,b=t.focusable,w=t.activeItem,y=t.focused,C=t.tabIndex,I=t.onKeyDown,$=t.onFocus,E=t.onBlur,N=t.onActiveChange,k=t.onListChangeStart,D=t.onListChangeEnd,_=In(t,$W),R=S.useRef(null),T=S.useRef(null);S.useImperativeHandle(e,function(){return{scrollTo:function($e){R.current.scrollTo($e)},getIndentWidth:function(){return T.current.offsetWidth}}});var A=S.useState(s),O=ke(A,2),P=O[0],M=O[1],z=S.useState(i),L=ke(z,2),W=L[0],B=L[1],q=S.useState(i),H=ke(q,2),ne=H[0],te=H[1],ae=S.useState([]),re=ke(ae,2),ee=re[0],j=re[1],Y=S.useState(null),se=ke(Y,2),J=se[0],ue=se[1],oe=S.useRef(i);oe.current=i;function be(){var ge=oe.current;B(ge),te(ge),j([]),ue(null),D()}Ki(function(){M(s);var ge=IW(P,s);if(ge.key!==null)if(ge.add){var $e=W.findIndex(function(Ke){var We=Ke.key;return We===ge.key}),De=kw($w(W,i,ge.key),x,g,v),ve=W.slice();ve.splice($e+1,0,Nw),te(ve),j(De),ue("show")}else{var we=i.findIndex(function(Ke){var We=Ke.key;return We===ge.key}),Re=kw($w(i,W,ge.key),x,g,v),Ne=i.slice();Ne.splice(we+1,0,Nw),te(Ne),j(Re),ue("hide")}else W!==i&&(B(i),te(i))},[s,i]),S.useEffect(function(){f||be()},[f]);var de=m?ne:i,Ie={expandedKeys:s,selectedKeys:o,loadedKeys:a,loadingKeys:l,checkedKeys:r,halfCheckedKeys:c,dragOverNodeKey:h,dropPosition:p,keyEntities:u};return S.createElement(S.Fragment,null,y&&w&&S.createElement("span",{style:Ew,"aria-live":"assertive"},NW(w)),S.createElement("div",null,S.createElement("input",{style:Ew,disabled:b===!1||d,tabIndex:b!==!1?C:null,onKeyDown:I,onFocus:$,onBlur:E,value:"",onChange:EW,"aria-label":"for screen reader"})),S.createElement("div",{className:"".concat(n,"-treenode"),"aria-hidden":!0,style:{position:"absolute",pointerEvents:"none",visibility:"hidden",height:0,overflow:"hidden",border:0,padding:0}},S.createElement("div",{className:"".concat(n,"-indent")},S.createElement("div",{ref:T,className:"".concat(n,"-indent-unit")}))),S.createElement(df,Ve({},_,{data:de,itemKey:Dw,height:g,fullHeight:!1,virtual:x,itemHeight:v,prefixCls:"".concat(n,"-list"),ref:R,onVisibleChange:function($e,De){var ve=new Set($e),we=De.filter(function(Re){return!ve.has(Re)});we.some(function(Re){return Dw(Re)===da})&&be()}}),function(ge){var $e=ge.pos,De=Object.assign({},(k$(ge.data),ge.data)),ve=ge.title,we=ge.key,Re=ge.isStart,Ne=ge.isEnd,Ke=ou(we,$e);delete De.key,delete De.children;var We=Dc(Ke,Ie);return S.createElement(SW,Ve({},De,We,{title:ve,active:!!w&&we===w.key,pos:$e,data:ge.data,isStart:Re,isEnd:Ne,motion:m,motionNodes:we===da?ee:null,motionType:J,onMotionStart:k,onMotionEnd:be,treeNodeRequiredProps:Ie,onMouseMove:function(){N(null)}}))}))});R$.displayName="NodeList";var kW=10,ix=function(t){m1(n,t);var e=g1(n);function n(){var i;lv(this,n);for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return i=e.call.apply(e,[this].concat(o)),X(Ae(i),"destroyed",!1),X(Ae(i),"delayedDragEnterLogic",void 0),X(Ae(i),"loadingRetryTimes",{}),X(Ae(i),"state",{keyEntities:{},indent:null,selectedKeys:[],checkedKeys:[],halfCheckedKeys:[],loadedKeys:[],loadingKeys:[],expandedKeys:[],draggingNodeKey:null,dragChildrenKeys:[],dropTargetKey:null,dropPosition:null,dropContainerKey:null,dropLevelOffset:null,dropTargetPos:null,dropAllowed:!0,dragOverNodeKey:null,treeData:[],flattenNodes:[],focused:!1,activeKey:null,listChanging:!1,prevProps:null,fieldNames:$l()}),X(Ae(i),"dragStartMousePosition",null),X(Ae(i),"dragNode",void 0),X(Ae(i),"currentMouseOverDroppableNodeKey",null),X(Ae(i),"listRef",S.createRef()),X(Ae(i),"onNodeDragStart",function(a,l){var c=i.state,u=c.expandedKeys,d=c.keyEntities,f=i.props.onDragStart,h=l.props.eventKey;i.dragNode=l,i.dragStartMousePosition={x:a.clientX,y:a.clientY};var p=io(u,h);i.setState({draggingNodeKey:h,dragChildrenKeys:cW(h,d),indent:i.listRef.current.getIndentWidth()}),i.setExpandedKeys(p),window.addEventListener("dragend",i.onWindowDragEnd),f==null||f({event:a,node:Pn(l.props)})}),X(Ae(i),"onNodeDragEnter",function(a,l){var c=i.state,u=c.expandedKeys,d=c.keyEntities,f=c.dragChildrenKeys,h=c.flattenNodes,p=c.indent,m=i.props,g=m.onDragEnter,v=m.onExpand,x=m.allowDrop,b=m.direction,w=l.props,y=w.pos,C=w.eventKey,I=Ae(i),$=I.dragNode;if(i.currentMouseOverDroppableNodeKey!==C&&(i.currentMouseOverDroppableNodeKey=C),!$){i.resetDragState();return}var E=Cw(a,$,l,p,i.dragStartMousePosition,x,h,d,u,b),N=E.dropPosition,k=E.dropLevelOffset,D=E.dropTargetKey,_=E.dropContainerKey,R=E.dropTargetPos,T=E.dropAllowed,A=E.dragOverNodeKey;if(f.indexOf(D)!==-1||!T){i.resetDragState();return}if(i.delayedDragEnterLogic||(i.delayedDragEnterLogic={}),Object.keys(i.delayedDragEnterLogic).forEach(function(O){clearTimeout(i.delayedDragEnterLogic[O])}),$.props.eventKey!==l.props.eventKey&&(a.persist(),i.delayedDragEnterLogic[y]=window.setTimeout(function(){if(i.state.draggingNodeKey!==null){var O=Ze(u),P=Wi(d,l.props.eventKey);P&&(P.children||[]).length&&(O=_o(u,l.props.eventKey)),"expandedKeys"in i.props||i.setExpandedKeys(O),v==null||v(O,{node:Pn(l.props),expanded:!0,nativeEvent:a.nativeEvent})}},800)),$.props.eventKey===D&&k===0){i.resetDragState();return}i.setState({dragOverNodeKey:A,dropPosition:N,dropLevelOffset:k,dropTargetKey:D,dropContainerKey:_,dropTargetPos:R,dropAllowed:T}),g==null||g({event:a,node:Pn(l.props),expandedKeys:u})}),X(Ae(i),"onNodeDragOver",function(a,l){var c=i.state,u=c.dragChildrenKeys,d=c.flattenNodes,f=c.keyEntities,h=c.expandedKeys,p=c.indent,m=i.props,g=m.onDragOver,v=m.allowDrop,x=m.direction,b=Ae(i),w=b.dragNode;if(w){var y=Cw(a,w,l,p,i.dragStartMousePosition,v,d,f,h,x),C=y.dropPosition,I=y.dropLevelOffset,$=y.dropTargetKey,E=y.dropContainerKey,N=y.dropAllowed,k=y.dropTargetPos,D=y.dragOverNodeKey;u.indexOf($)!==-1||!N||(w.props.eventKey===$&&I===0?i.state.dropPosition===null&&i.state.dropLevelOffset===null&&i.state.dropTargetKey===null&&i.state.dropContainerKey===null&&i.state.dropTargetPos===null&&i.state.dropAllowed===!1&&i.state.dragOverNodeKey===null||i.resetDragState():C===i.state.dropPosition&&I===i.state.dropLevelOffset&&$===i.state.dropTargetKey&&E===i.state.dropContainerKey&&k===i.state.dropTargetPos&&N===i.state.dropAllowed&&D===i.state.dragOverNodeKey||i.setState({dropPosition:C,dropLevelOffset:I,dropTargetKey:$,dropContainerKey:E,dropTargetPos:k,dropAllowed:N,dragOverNodeKey:D}),g==null||g({event:a,node:Pn(l.props)}))}}),X(Ae(i),"onNodeDragLeave",function(a,l){i.currentMouseOverDroppableNodeKey===l.props.eventKey&&!a.currentTarget.contains(a.relatedTarget)&&(i.resetDragState(),i.currentMouseOverDroppableNodeKey=null);var c=i.props.onDragLeave;c==null||c({event:a,node:Pn(l.props)})}),X(Ae(i),"onWindowDragEnd",function(a){i.onNodeDragEnd(a,null,!0),window.removeEventListener("dragend",i.onWindowDragEnd)}),X(Ae(i),"onNodeDragEnd",function(a,l){var c=i.props.onDragEnd;i.setState({dragOverNodeKey:null}),i.cleanDragState(),c==null||c({event:a,node:Pn(l.props)}),i.dragNode=null,window.removeEventListener("dragend",i.onWindowDragEnd)}),X(Ae(i),"onNodeDrop",function(a,l){var c,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=i.state,f=d.dragChildrenKeys,h=d.dropPosition,p=d.dropTargetKey,m=d.dropTargetPos,g=d.dropAllowed;if(g){var v=i.props.onDrop;if(i.setState({dragOverNodeKey:null}),i.cleanDragState(),p!==null){var x=me(me({},Dc(p,i.getTreeNodeRequiredProps())),{},{active:((c=i.getActiveItem())===null||c===void 0?void 0:c.key)===p,data:Wi(i.state.keyEntities,p).node}),b=f.indexOf(p)!==-1;Lo(!b,"Can not drop to dragNode's children node. This is a bug of rc-tree. Please report an issue.");var w=nx(m),y={event:a,node:Pn(x),dragNode:i.dragNode?Pn(i.dragNode.props):null,dragNodesKeys:[i.dragNode.props.eventKey].concat(f),dropToGap:h!==0,dropPosition:h+Number(w[w.length-1])};u||v==null||v(y),i.dragNode=null}}}),X(Ae(i),"cleanDragState",function(){var a=i.state.draggingNodeKey;a!==null&&i.setState({draggingNodeKey:null,dropPosition:null,dropContainerKey:null,dropTargetKey:null,dropLevelOffset:null,dropAllowed:!0,dragOverNodeKey:null}),i.dragStartMousePosition=null,i.currentMouseOverDroppableNodeKey=null}),X(Ae(i),"triggerExpandActionExpand",function(a,l){var c=i.state,u=c.expandedKeys,d=c.flattenNodes,f=l.expanded,h=l.key,p=l.isLeaf;if(!(p||a.shiftKey||a.metaKey||a.ctrlKey)){var m=d.filter(function(v){return v.key===h})[0],g=Pn(me(me({},Dc(h,i.getTreeNodeRequiredProps())),{},{data:m.data}));i.setExpandedKeys(f?io(u,h):_o(u,h)),i.onNodeExpand(a,g)}}),X(Ae(i),"onNodeClick",function(a,l){var c=i.props,u=c.onClick,d=c.expandAction;d==="click"&&i.triggerExpandActionExpand(a,l),u==null||u(a,l)}),X(Ae(i),"onNodeDoubleClick",function(a,l){var c=i.props,u=c.onDoubleClick,d=c.expandAction;d==="doubleClick"&&i.triggerExpandActionExpand(a,l),u==null||u(a,l)}),X(Ae(i),"onNodeSelect",function(a,l){var c=i.state.selectedKeys,u=i.state,d=u.keyEntities,f=u.fieldNames,h=i.props,p=h.onSelect,m=h.multiple,g=l.selected,v=l[f.key],x=!g;x?m?c=_o(c,v):c=[v]:c=io(c,v);var b=c.map(function(w){var y=Wi(d,w);return y?y.node:null}).filter(function(w){return w});i.setUncontrolledState({selectedKeys:c}),p==null||p(c,{event:"select",selected:x,node:l,selectedNodes:b,nativeEvent:a.nativeEvent})}),X(Ae(i),"onNodeCheck",function(a,l,c){var u=i.state,d=u.keyEntities,f=u.checkedKeys,h=u.halfCheckedKeys,p=i.props,m=p.checkStrictly,g=p.onCheck,v=l.key,x,b={event:"check",node:l,checked:c,nativeEvent:a.nativeEvent};if(m){var w=c?_o(f,v):io(f,v),y=io(h,v);x={checked:w,halfChecked:y},b.checkedNodes=w.map(function(k){return Wi(d,k)}).filter(function(k){return k}).map(function(k){return k.node}),i.setUncontrolledState({checkedKeys:w})}else{var C=rl([].concat(Ze(f),[v]),!0,d),I=C.checkedKeys,$=C.halfCheckedKeys;if(!c){var E=new Set(I);E.delete(v);var N=rl(Array.from(E),{checked:!1,halfCheckedKeys:$},d);I=N.checkedKeys,$=N.halfCheckedKeys}x=I,b.checkedNodes=[],b.checkedNodesPositions=[],b.halfCheckedKeys=$,I.forEach(function(k){var D=Wi(d,k);if(D){var _=D.node,R=D.pos;b.checkedNodes.push(_),b.checkedNodesPositions.push({node:_,pos:R})}}),i.setUncontrolledState({checkedKeys:I},!1,{halfCheckedKeys:$})}g==null||g(x,b)}),X(Ae(i),"onNodeLoad",function(a){var l,c=a.key,u=i.state.keyEntities,d=Wi(u,c);if(!(d!=null&&(l=d.children)!==null&&l!==void 0&&l.length)){var f=new Promise(function(h,p){i.setState(function(m){var g=m.loadedKeys,v=g===void 0?[]:g,x=m.loadingKeys,b=x===void 0?[]:x,w=i.props,y=w.loadData,C=w.onLoad;if(!y||v.indexOf(c)!==-1||b.indexOf(c)!==-1)return null;var I=y(a);return I.then(function(){var $=i.state.loadedKeys,E=_o($,c);C==null||C(E,{event:"load",node:a}),i.setUncontrolledState({loadedKeys:E}),i.setState(function(N){return{loadingKeys:io(N.loadingKeys,c)}}),h()}).catch(function($){if(i.setState(function(N){return{loadingKeys:io(N.loadingKeys,c)}}),i.loadingRetryTimes[c]=(i.loadingRetryTimes[c]||0)+1,i.loadingRetryTimes[c]>=kW){var E=i.state.loadedKeys;Lo(!1,"Retry for `loadData` many times but still failed. No more retry."),i.setUncontrolledState({loadedKeys:_o(E,c)}),h()}p($)}),{loadingKeys:_o(b,c)}})});return f.catch(function(){}),f}}),X(Ae(i),"onNodeMouseEnter",function(a,l){var c=i.props.onMouseEnter;c==null||c({event:a,node:l})}),X(Ae(i),"onNodeMouseLeave",function(a,l){var c=i.props.onMouseLeave;c==null||c({event:a,node:l})}),X(Ae(i),"onNodeContextMenu",function(a,l){var c=i.props.onRightClick;c&&(a.preventDefault(),c({event:a,node:l}))}),X(Ae(i),"onFocus",function(){var a=i.props.onFocus;i.setState({focused:!0});for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];a==null||a.apply(void 0,c)}),X(Ae(i),"onBlur",function(){var a=i.props.onBlur;i.setState({focused:!1}),i.onActiveChange(null);for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];a==null||a.apply(void 0,c)}),X(Ae(i),"getTreeNodeRequiredProps",function(){var a=i.state,l=a.expandedKeys,c=a.selectedKeys,u=a.loadedKeys,d=a.loadingKeys,f=a.checkedKeys,h=a.halfCheckedKeys,p=a.dragOverNodeKey,m=a.dropPosition,g=a.keyEntities;return{expandedKeys:l||[],selectedKeys:c||[],loadedKeys:u||[],loadingKeys:d||[],checkedKeys:f||[],halfCheckedKeys:h||[],dragOverNodeKey:p,dropPosition:m,keyEntities:g}}),X(Ae(i),"setExpandedKeys",function(a){var l=i.state,c=l.treeData,u=l.fieldNames,d=lm(c,a,u);i.setUncontrolledState({expandedKeys:a,flattenNodes:d},!0)}),X(Ae(i),"onNodeExpand",function(a,l){var c=i.state.expandedKeys,u=i.state,d=u.listChanging,f=u.fieldNames,h=i.props,p=h.onExpand,m=h.loadData,g=l.expanded,v=l[f.key];if(!d){var x=c.indexOf(v),b=!g;if(Lo(g&&x!==-1||!g&&x===-1,"Expand state not sync with index check"),b?c=_o(c,v):c=io(c,v),i.setExpandedKeys(c),p==null||p(c,{node:l,expanded:b,nativeEvent:a.nativeEvent}),b&&m){var w=i.onNodeLoad(l);w&&w.then(function(){var y=lm(i.state.treeData,c,f);i.setUncontrolledState({flattenNodes:y})}).catch(function(){var y=i.state.expandedKeys,C=io(y,v);i.setExpandedKeys(C)})}}}),X(Ae(i),"onListChangeStart",function(){i.setUncontrolledState({listChanging:!0})}),X(Ae(i),"onListChangeEnd",function(){setTimeout(function(){i.setUncontrolledState({listChanging:!1})})}),X(Ae(i),"onActiveChange",function(a){var l=i.state.activeKey,c=i.props,u=c.onActiveChange,d=c.itemScrollOffset,f=d===void 0?0:d;l!==a&&(i.setState({activeKey:a}),a!==null&&i.scrollTo({key:a,offset:f}),u==null||u(a))}),X(Ae(i),"getActiveItem",function(){var a=i.state,l=a.activeKey,c=a.flattenNodes;return l===null?null:c.find(function(u){var d=u.key;return d===l})||null}),X(Ae(i),"offsetActiveKey",function(a){var l=i.state,c=l.flattenNodes,u=l.activeKey,d=c.findIndex(function(p){var m=p.key;return m===u});d===-1&&a<0&&(d=c.length),d=(d+a+c.length)%c.length;var f=c[d];if(f){var h=f.key;i.onActiveChange(h)}else i.onActiveChange(null)}),X(Ae(i),"onKeyDown",function(a){var l=i.state,c=l.activeKey,u=l.expandedKeys,d=l.checkedKeys,f=l.fieldNames,h=i.props,p=h.onKeyDown,m=h.checkable,g=h.selectable;switch(a.which){case et.UP:{i.offsetActiveKey(-1),a.preventDefault();break}case et.DOWN:{i.offsetActiveKey(1),a.preventDefault();break}}var v=i.getActiveItem();if(v&&v.data){var x=i.getTreeNodeRequiredProps(),b=v.data.isLeaf===!1||!!(v.data[f.children]||[]).length,w=Pn(me(me({},Dc(c,x)),{},{data:v.data,active:!0}));switch(a.which){case et.LEFT:{b&&u.includes(c)?i.onNodeExpand({},w):v.parent&&i.onActiveChange(v.parent.key),a.preventDefault();break}case et.RIGHT:{b&&!u.includes(c)?i.onNodeExpand({},w):v.children&&v.children.length&&i.onActiveChange(v.children[0].key),a.preventDefault();break}case et.ENTER:case et.SPACE:{m&&!w.disabled&&w.checkable!==!1&&!w.disableCheckbox?i.onNodeCheck({},w,!d.includes(c)):!m&&g&&!w.disabled&&w.selectable!==!1&&i.onNodeSelect({},w);break}}}p==null||p(a)}),X(Ae(i),"setUncontrolledState",function(a){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!i.destroyed){var u=!1,d=!0,f={};Object.keys(a).forEach(function(h){if(h in i.props){d=!1;return}u=!0,f[h]=a[h]}),u&&(!l||d)&&i.setState(me(me({},f),c))}}),X(Ae(i),"scrollTo",function(a){i.listRef.current.scrollTo(a)}),i}return av(n,[{key:"componentDidMount",value:function(){this.destroyed=!1,this.onUpdated()}},{key:"componentDidUpdate",value:function(){this.onUpdated()}},{key:"onUpdated",value:function(){var s=this.props,o=s.activeKey,r=s.itemScrollOffset,a=r===void 0?0:r;o!==void 0&&o!==this.state.activeKey&&(this.setState({activeKey:o}),o!==null&&this.scrollTo({key:o,offset:a}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("dragend",this.onWindowDragEnd),this.destroyed=!0}},{key:"resetDragState",value:function(){this.setState({dragOverNodeKey:null,dropPosition:null,dropLevelOffset:null,dropTargetKey:null,dropContainerKey:null,dropTargetPos:null,dropAllowed:!1})}},{key:"render",value:function(){var s=this.state,o=s.focused,r=s.flattenNodes,a=s.keyEntities,l=s.draggingNodeKey,c=s.activeKey,u=s.dropLevelOffset,d=s.dropContainerKey,f=s.dropTargetKey,h=s.dropPosition,p=s.dragOverNodeKey,m=s.indent,g=this.props,v=g.prefixCls,x=g.className,b=g.style,w=g.showLine,y=g.focusable,C=g.tabIndex,I=C===void 0?0:C,$=g.selectable,E=g.showIcon,N=g.icon,k=g.switcherIcon,D=g.draggable,_=g.checkable,R=g.checkStrictly,T=g.disabled,A=g.motion,O=g.loadData,P=g.filterTreeNode,M=g.height,z=g.itemHeight,L=g.virtual,W=g.titleRender,B=g.dropIndicatorRender,q=g.onContextMenu,H=g.onScroll,ne=g.direction,te=g.rootClassName,ae=g.rootStyle,re=wo(this.props,{aria:!0,data:!0}),ee;return D&&(_n(D)==="object"?ee=D:typeof D=="function"?ee={nodeDraggable:D}:ee={}),S.createElement(tx.Provider,{value:{prefixCls:v,selectable:$,showIcon:E,icon:N,switcherIcon:k,draggable:ee,draggingNodeKey:l,checkable:_,checkStrictly:R,disabled:T,keyEntities:a,dropLevelOffset:u,dropContainerKey:d,dropTargetKey:f,dropPosition:h,dragOverNodeKey:p,indent:m,direction:ne,dropIndicatorRender:B,loadData:O,filterTreeNode:P,titleRender:W,onNodeClick:this.onNodeClick,onNodeDoubleClick:this.onNodeDoubleClick,onNodeExpand:this.onNodeExpand,onNodeSelect:this.onNodeSelect,onNodeCheck:this.onNodeCheck,onNodeLoad:this.onNodeLoad,onNodeMouseEnter:this.onNodeMouseEnter,onNodeMouseLeave:this.onNodeMouseLeave,onNodeContextMenu:this.onNodeContextMenu,onNodeDragStart:this.onNodeDragStart,onNodeDragEnter:this.onNodeDragEnter,onNodeDragOver:this.onNodeDragOver,onNodeDragLeave:this.onNodeDragLeave,onNodeDragEnd:this.onNodeDragEnd,onNodeDrop:this.onNodeDrop}},S.createElement("div",{role:"tree",className:ye(v,x,te,X(X(X({},"".concat(v,"-show-line"),w),"".concat(v,"-focused"),o),"".concat(v,"-active-focused"),c!==null)),style:ae},S.createElement(R$,Ve({ref:this.listRef,prefixCls:v,style:b,data:r,disabled:T,selectable:$,checkable:!!_,motion:A,dragging:l!==null,height:M,itemHeight:z,virtual:L,focusable:y,focused:o,tabIndex:I,activeItem:this.getActiveItem(),onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onActiveChange:this.onActiveChange,onListChangeStart:this.onListChangeStart,onListChangeEnd:this.onListChangeEnd,onContextMenu:q,onScroll:H},this.getTreeNodeRequiredProps(),re))))}}],[{key:"getDerivedStateFromProps",value:function(s,o){var r=o.prevProps,a={prevProps:s};function l(C){return!r&&C in s||r&&r[C]!==s[C]}var c,u=o.fieldNames;if(l("fieldNames")&&(u=$l(s.fieldNames),a.fieldNames=u),l("treeData")?c=s.treeData:l("children")&&(Lo(!1,"`children` of Tree is deprecated. Please use `treeData` instead."),c=HI(s.children)),c){a.treeData=c;var d=Xv(c,{fieldNames:u});a.keyEntities=me(X({},da,T$),d.keyEntities)}var f=a.keyEntities||o.keyEntities;if(l("expandedKeys")||r&&l("autoExpandParent"))a.expandedKeys=s.autoExpandParent||!r&&s.defaultExpandParent?og(s.expandedKeys,f):s.expandedKeys;else if(!r&&s.defaultExpandAll){var h=me({},f);delete h[da],a.expandedKeys=Object.keys(h).map(function(C){return h[C].key})}else!r&&s.defaultExpandedKeys&&(a.expandedKeys=s.autoExpandParent||s.defaultExpandParent?og(s.defaultExpandedKeys,f):s.defaultExpandedKeys);if(a.expandedKeys||delete a.expandedKeys,c||a.expandedKeys){var p=lm(c||o.treeData,a.expandedKeys||o.expandedKeys,u);a.flattenNodes=p}if(s.selectable&&(l("selectedKeys")?a.selectedKeys=Sw(s.selectedKeys,s):!r&&s.defaultSelectedKeys&&(a.selectedKeys=Sw(s.defaultSelectedKeys,s))),s.checkable){var m;if(l("checkedKeys")?m=fm(s.checkedKeys)||{}:!r&&s.defaultCheckedKeys?m=fm(s.defaultCheckedKeys)||{}:c&&(m=fm(s.checkedKeys)||{checkedKeys:o.checkedKeys,halfCheckedKeys:o.halfCheckedKeys}),m){var g=m,v=g.checkedKeys,x=v===void 0?[]:v,b=g.halfCheckedKeys,w=b===void 0?[]:b;if(!s.checkStrictly){var y=rl(x,!0,f);x=y.checkedKeys,w=y.halfCheckedKeys}a.checkedKeys=x,a.halfCheckedKeys=w}}return l("loadedKeys")&&(a.loadedKeys=s.loadedKeys),a}}]),n}(S.Component);X(ix,"defaultProps",{prefixCls:"rc-tree",showLine:!1,showIcon:!0,selectable:!0,multiple:!1,checkable:!1,disabled:!1,checkStrictly:!1,draggable:!1,defaultExpandParent:!0,autoExpandParent:!1,defaultExpandAll:!1,defaultExpandedKeys:[],defaultCheckedKeys:[],defaultSelectedKeys:[],dropIndicatorRender:yW,allowDrop:function(){return!0},expandAction:!1});X(ix,"TreeNode",Nl);const DW=new z_("ant-tree-node-fx-do-not-use",{"0%":{opacity:0},"100%":{opacity:1}}),TW=(t,e)=>({[`.${t}-switcher-icon`]:{display:"inline-block",fontSize:10,verticalAlign:"baseline",svg:{transition:`transform ${e.motionDurationSlow}`}}}),RW=(t,e)=>({[`.${t}-drop-indicator`]:{position:"absolute",zIndex:1,height:2,backgroundColor:e.colorPrimary,borderRadius:1,pointerEvents:"none","&:after":{position:"absolute",top:-3,insetInlineStart:-6,width:8,height:8,backgroundColor:"transparent",border:`${he(e.lineWidthBold)} solid ${e.colorPrimary}`,borderRadius:"50%",content:'""'}}}),_W=(t,e)=>{const{treeCls:n,treeNodeCls:i,treeNodePadding:s,titleHeight:o,nodeSelectedBg:r,nodeHoverBg:a}=e,l=e.paddingXS;return{[n]:Object.assign(Object.assign({},os(e)),{background:e.colorBgContainer,borderRadius:e.borderRadius,transition:`background-color ${e.motionDurationSlow}`,[`&${n}-rtl`]:{[`${n}-switcher`]:{"&_close":{[`${n}-switcher-icon`]:{svg:{transform:"rotate(90deg)"}}}}},[`&-focused:not(:hover):not(${n}-active-focused)`]:Object.assign({},hh(e)),[`${n}-list-holder-inner`]:{alignItems:"flex-start"},[`&${n}-block-node`]:{[`${n}-list-holder-inner`]:{alignItems:"stretch",[`${n}-node-content-wrapper`]:{flex:"auto"},[`${i}.dragging`]:{position:"relative","&:after":{position:"absolute",top:0,insetInlineEnd:0,bottom:s,insetInlineStart:0,border:`1px solid ${e.colorPrimary}`,opacity:0,animationName:DW,animationDuration:e.motionDurationSlow,animationPlayState:"running",animationFillMode:"forwards",content:'""',pointerEvents:"none"}}}},[i]:{display:"flex",alignItems:"flex-start",padding:`0 0 ${he(s)} 0`,outline:"none","&-rtl":{direction:"rtl"},"&-disabled":{[`${n}-node-content-wrapper`]:{color:e.colorTextDisabled,cursor:"not-allowed","&:hover":{background:"transparent"}}},[`&-active ${n}-node-content-wrapper`]:{background:e.controlItemBgHover},[`&:not(${i}-disabled).filter-node ${n}-title`]:{color:e.colorPrimary,fontWeight:500},"&-draggable":{cursor:"grab",[`${n}-draggable-icon`]:{flexShrink:0,width:o,lineHeight:he(o),textAlign:"center",visibility:"visible",opacity:.2,transition:`opacity ${e.motionDurationSlow}`,[`${i}:hover &`]:{opacity:.45}},[`&${i}-disabled`]:{[`${n}-draggable-icon`]:{visibility:"hidden"}}}},[`${n}-indent`]:{alignSelf:"stretch",whiteSpace:"nowrap",userSelect:"none","&-unit":{display:"inline-block",width:o}},[`${n}-draggable-icon`]:{visibility:"hidden"},[`${n}-switcher`]:Object.assign(Object.assign({},TW(t,e)),{position:"relative",flex:"none",alignSelf:"stretch",width:o,margin:0,lineHeight:he(o),textAlign:"center",cursor:"pointer",userSelect:"none",transition:`all ${e.motionDurationSlow}`,"&-noop":{cursor:"unset"},"&:before":{pointerEvents:"none",content:'""',width:o,height:o,position:"absolute",left:{_skip_check_:!0,value:0},top:0,borderRadius:e.borderRadius,transition:`all ${e.motionDurationSlow}`},[`&:not(${n}-switcher-noop):hover:before`]:{backgroundColor:e.colorBgTextHover},"&_close":{[`${n}-switcher-icon`]:{svg:{transform:"rotate(-90deg)"}}},"&-loading-icon":{color:e.colorPrimary},"&-leaf-line":{position:"relative",zIndex:1,display:"inline-block",width:"100%",height:"100%","&:before":{position:"absolute",top:0,insetInlineEnd:e.calc(o).div(2).equal(),bottom:e.calc(s).mul(-1).equal(),marginInlineStart:-1,borderInlineEnd:`1px solid ${e.colorBorder}`,content:'""'},"&:after":{position:"absolute",width:e.calc(e.calc(o).div(2).equal()).mul(.8).equal(),height:e.calc(o).div(2).equal(),borderBottom:`1px solid ${e.colorBorder}`,content:'""'}}}),[`${n}-checkbox`]:{top:"initial",marginInlineEnd:l,alignSelf:"flex-start",marginTop:e.marginXXS},[`${n}-node-content-wrapper, ${n}-checkbox + span`]:{position:"relative",zIndex:"auto",minHeight:o,margin:0,padding:`0 ${he(e.calc(e.paddingXS).div(2).equal())}`,color:"inherit",lineHeight:he(o),background:"transparent",borderRadius:e.borderRadius,cursor:"pointer",transition:`all ${e.motionDurationMid}, border 0s, line-height 0s, box-shadow 0s`,"&:hover":{backgroundColor:a},[`&${n}-node-selected`]:{backgroundColor:r},[`${n}-iconEle`]:{display:"inline-block",width:o,height:o,lineHeight:he(o),textAlign:"center",verticalAlign:"top","&:empty":{display:"none"}}},[`${n}-unselectable ${n}-node-content-wrapper:hover`]:{backgroundColor:"transparent"},[`${n}-node-content-wrapper`]:Object.assign({lineHeight:he(o),userSelect:"none"},RW(t,e)),[`${i}.drop-container`]:{"> [draggable]":{boxShadow:`0 0 0 2px ${e.colorPrimary}`}},"&-show-line":{[`${n}-indent`]:{"&-unit":{position:"relative",height:"100%","&:before":{position:"absolute",top:0,insetInlineEnd:e.calc(o).div(2).equal(),bottom:e.calc(s).mul(-1).equal(),borderInlineEnd:`1px solid ${e.colorBorder}`,content:'""'},"&-end":{"&:before":{display:"none"}}}},[`${n}-switcher`]:{background:"transparent","&-line-icon":{verticalAlign:"-0.15em"}}},[`${i}-leaf-last`]:{[`${n}-switcher`]:{"&-leaf-line":{"&:before":{top:"auto !important",bottom:"auto !important",height:`${he(e.calc(o).div(2).equal())} !important`}}}}})}},AW=t=>{const{treeCls:e,treeNodeCls:n,treeNodePadding:i,directoryNodeSelectedBg:s,directoryNodeSelectedColor:o}=t;return{[`${e}${e}-directory`]:{[n]:{position:"relative","&:before":{position:"absolute",top:0,insetInlineEnd:0,bottom:i,insetInlineStart:0,transition:`background-color ${t.motionDurationMid}`,content:'""',pointerEvents:"none"},"&:hover":{"&:before":{background:t.controlItemBgHover}},"> *":{zIndex:1},[`${e}-switcher`]:{transition:`color ${t.motionDurationMid}`},[`${e}-node-content-wrapper`]:{borderRadius:0,userSelect:"none","&:hover":{background:"transparent"},[`&${e}-node-selected`]:{color:o,background:"transparent"}},"&-selected":{"\n            &:hover::before,\n            &::before\n          ":{background:s},[`${e}-switcher`]:{color:o},[`${e}-node-content-wrapper`]:{color:o,background:"transparent"}}}}}},OW=(t,e)=>{const n=`.${t}`,i=`${n}-treenode`,s=e.calc(e.paddingXS).div(2).equal(),o=Si(e,{treeCls:n,treeNodeCls:i,treeNodePadding:s});return[_W(t,o),AW(o)]},PW=t=>{const{controlHeightSM:e}=t;return{titleHeight:e,nodeHoverBg:t.controlItemBgHover,nodeSelectedBg:t.controlItemBgActive}},MW=t=>{const{colorTextLightSolid:e,colorPrimary:n}=t;return Object.assign(Object.assign({},PW(t)),{directoryNodeSelectedColor:e,directoryNodeSelectedBg:n})},FW=Ys("Tree",(t,e)=>{let{prefixCls:n}=e;return[{[t.componentCls]:jI(`${n}-checkbox`,t)},OW(n,t),xA(t)]},MW),Tw=4;function LW(t){const{dropPosition:e,dropLevelOffset:n,prefixCls:i,indent:s,direction:o="ltr"}=t,r=o==="ltr"?"left":"right",a=o==="ltr"?"right":"left",l={[r]:-n*s+Tw,[a]:0};switch(e){case-1:l.top=-3;break;case 1:l.bottom=-3;break;default:l.bottom=-3,l[r]=s+Tw;break}return ce.createElement("div",{style:l,className:`${i}-drop-indicator`})}const zW=t=>{const{prefixCls:e,switcherIcon:n,treeNodeProps:i,showLine:s,switcherLoadingIcon:o}=t,{isLeaf:r,expanded:a,loading:l}=i;if(l)return S.isValidElement(o)?o:S.createElement(h1,{className:`${e}-switcher-loading-icon`});let c;if(s&&typeof s=="object"&&(c=s.showLeafIcon),r){if(!s)return null;if(typeof c!="boolean"&&c){const f=typeof c=="function"?c(i):c,h=`${e}-switcher-line-custom-icon`;return S.isValidElement(f)?Mc(f,{className:ye(f.props.className||"",h)}):f}return c?S.createElement(c$,{className:`${e}-switcher-line-icon`}):S.createElement("span",{className:`${e}-switcher-leaf-line`})}const u=`${e}-switcher-icon`,d=typeof n=="function"?n(i):n;return S.isValidElement(d)?Mc(d,{className:ye(d.props.className||"",u)}):d!==void 0?d:s?a?S.createElement(MB,{className:`${e}-switcher-line-icon`}):S.createElement(HB,{className:`${e}-switcher-line-icon`}):S.createElement(fB,{className:u})},_$=ce.forwardRef((t,e)=>{var n;const{getPrefixCls:i,direction:s,virtual:o,tree:r}=ce.useContext($n),{prefixCls:a,className:l,showIcon:c=!1,showLine:u,switcherIcon:d,switcherLoadingIcon:f,blockNode:h=!1,children:p,checkable:m=!1,selectable:g=!0,draggable:v,motion:x,style:b}=t,w=i("tree",a),y=i(),C=x??Object.assign(Object.assign({},B_(y)),{motionAppear:!1}),I=Object.assign(Object.assign({},t),{checkable:m,selectable:g,showIcon:c,motion:C,blockNode:h,showLine:!!u,dropIndicatorRender:LW}),[$,E,N]=FW(w),[,k]=Gl(),D=k.paddingXS/2+(((n=k.Tree)===null||n===void 0?void 0:n.titleHeight)||k.controlHeightSM),_=ce.useMemo(()=>{if(!v)return!1;let T={};switch(typeof v){case"function":T.nodeDraggable=v;break;case"object":T=Object.assign({},v);break}return T.icon!==!1&&(T.icon=T.icon||ce.createElement(AB,null)),T},[v]),R=T=>ce.createElement(zW,{prefixCls:w,switcherIcon:d,switcherLoadingIcon:f,treeNodeProps:T,showLine:u});return $(ce.createElement(ix,Object.assign({itemHeight:D,ref:e,virtual:o},I,{style:Object.assign(Object.assign({},r==null?void 0:r.style),b),prefixCls:w,className:ye({[`${w}-icon-hide`]:!c,[`${w}-block-node`]:h,[`${w}-unselectable`]:!g,[`${w}-rtl`]:s==="rtl"},r==null?void 0:r.className,l,E,N),direction:s,checkable:m&&ce.createElement("span",{className:`${w}-checkbox-inner`}),selectable:g,switcherIcon:R,draggable:_}),p))}),Rw=0,pm=1,_w=2;function sx(t,e,n){const{key:i,children:s}=n;function o(r){const a=r[i],l=r[s];e(a,r)!==!1&&sx(l||[],e,n)}t.forEach(o)}function BW(t){let{treeData:e,expandedKeys:n,startKey:i,endKey:s,fieldNames:o}=t;const r=[];let a=Rw;if(i&&i===s)return[i];if(!i||!s)return[];function l(c){return c===i||c===s}return sx(e,c=>{if(a===_w)return!1;if(l(c)){if(r.push(c),a===Rw)a=pm;else if(a===pm)return a=_w,!1}else a===pm&&r.push(c);return n.includes(c)},$l(o)),r}function mm(t,e,n){const i=Ze(e),s=[];return sx(t,(o,r)=>{const a=i.indexOf(o);return a!==-1&&(s.push(r),i.splice(a,1)),!!i.length},$l(n)),s}var Aw=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};function VW(t){const{isLeaf:e,expanded:n}=t;return e?S.createElement(c$,null):n?S.createElement(NB,null):S.createElement(TB,null)}function Ow(t){let{treeData:e,children:n}=t;return e||HI(n)}const WW=(t,e)=>{var{defaultExpandAll:n,defaultExpandParent:i,defaultExpandedKeys:s}=t,o=Aw(t,["defaultExpandAll","defaultExpandParent","defaultExpandedKeys"]);const r=S.useRef(),a=S.useRef(),l=()=>{const{keyEntities:$}=Xv(Ow(o));let E;return n?E=Object.keys($):i?E=og(o.expandedKeys||s||[],$):E=o.expandedKeys||s||[],E},[c,u]=S.useState(o.selectedKeys||o.defaultSelectedKeys||[]),[d,f]=S.useState(()=>l());S.useEffect(()=>{"selectedKeys"in o&&u(o.selectedKeys)},[o.selectedKeys]),S.useEffect(()=>{"expandedKeys"in o&&f(o.expandedKeys)},[o.expandedKeys]);const h=($,E)=>{var N;return"expandedKeys"in o||f($),(N=o.onExpand)===null||N===void 0?void 0:N.call(o,$,E)},p=($,E)=>{var N;const{multiple:k,fieldNames:D}=o,{node:_,nativeEvent:R}=E,{key:T=""}=_,A=Ow(o),O=Object.assign(Object.assign({},E),{selected:!0}),P=(R==null?void 0:R.ctrlKey)||(R==null?void 0:R.metaKey),M=R==null?void 0:R.shiftKey;let z;k&&P?(z=$,r.current=T,a.current=z,O.selectedNodes=mm(A,z,D)):k&&M?(z=Array.from(new Set([].concat(Ze(a.current||[]),Ze(BW({treeData:A,expandedKeys:d,startKey:T,endKey:r.current,fieldNames:D}))))),O.selectedNodes=mm(A,z,D)):(z=[T],r.current=T,a.current=z,O.selectedNodes=mm(A,z,D)),(N=o.onSelect)===null||N===void 0||N.call(o,z,O),"selectedKeys"in o||u(z)},{getPrefixCls:m,direction:g}=S.useContext($n),{prefixCls:v,className:x,showIcon:b=!0,expandAction:w="click"}=o,y=Aw(o,["prefixCls","className","showIcon","expandAction"]),C=m("tree",v),I=ye(`${C}-directory`,{[`${C}-directory-rtl`]:g==="rtl"},x);return S.createElement(_$,Object.assign({icon:VW,ref:e,blockNode:!0},y,{showIcon:b,expandAction:w,prefixCls:C,className:I,expandedKeys:d,selectedKeys:c,onSelect:p,onExpand:h}))},GW=S.forwardRef(WW),ox=_$;ox.DirectoryTree=GW;ox.TreeNode=Nl;const Pw=t=>{const{value:e,filterSearch:n,tablePrefixCls:i,locale:s,onChange:o}=t;return n?S.createElement("div",{className:`${i}-filter-dropdown-search`},S.createElement(jl,{prefix:S.createElement(Vv,null),placeholder:s.filterSearchPlaceholder,onChange:o,value:e,htmlSize:1,className:`${i}-filter-dropdown-search-input`})):null},HW=t=>{const{keyCode:e}=t;e===et.ENTER&&t.stopPropagation()},UW=S.forwardRef((t,e)=>S.createElement("div",{className:t.className,onClick:n=>n.stopPropagation(),onKeyDown:HW,ref:e},t.children));function al(t){let e=[];return(t||[]).forEach(n=>{let{value:i,children:s}=n;e.push(i),s&&(e=[].concat(Ze(e),Ze(al(s))))}),e}function jW(t){return t.some(e=>{let{children:n}=e;return n})}function A$(t,e){return typeof e=="string"||typeof e=="number"?e==null?void 0:e.toString().toLowerCase().includes(t.trim().toLowerCase()):!1}function O$(t){let{filters:e,prefixCls:n,filteredKeys:i,filterMultiple:s,searchValue:o,filterSearch:r}=t;return e.map((a,l)=>{const c=String(a.value);if(a.children)return{key:c||l,label:a.text,popupClassName:`${n}-dropdown-submenu`,children:O$({filters:a.children,prefixCls:n,filteredKeys:i,filterMultiple:s,searchValue:o,filterSearch:r})};const u=s?El:y1,d={key:a.value!==void 0?c:l,label:S.createElement(S.Fragment,null,S.createElement(u,{checked:i.includes(c)}),S.createElement("span",null,a.text))};return o.trim()?typeof r=="function"?r(o,a)?d:null:A$(o,a.text)?d:null:d})}function gm(t){return t||[]}const KW=t=>{var e,n;const{tablePrefixCls:i,prefixCls:s,column:o,dropdownPrefixCls:r,columnKey:a,filterOnClose:l,filterMultiple:c,filterMode:u="menu",filterSearch:d=!1,filterState:f,triggerFilter:h,locale:p,children:m,getPopupContainer:g,rootClassName:v}=t,{filterDropdownOpen:x,onFilterDropdownOpenChange:b,filterResetToDefaultFilteredValue:w,defaultFilteredValue:y,filterDropdownVisible:C,onFilterDropdownVisibleChange:I}=o,[$,E]=S.useState(!1),N=!!(f&&(!((e=f.filteredKeys)===null||e===void 0)&&e.length||f.forceFiltered)),k=de=>{E(de),b==null||b(de),I==null||I(de)},D=(n=x??C)!==null&&n!==void 0?n:$,_=f==null?void 0:f.filteredKeys,[R,T]=bW(gm(_)),A=de=>{let{selectedKeys:Ie}=de;T(Ie)},O=(de,Ie)=>{let{node:ge,checked:$e}=Ie;A(c?{selectedKeys:de}:{selectedKeys:$e&&ge.key?[ge.key]:[]})};S.useEffect(()=>{$&&A({selectedKeys:gm(_)})},[_]);const[P,M]=S.useState([]),z=de=>{M(de)},[L,W]=S.useState(""),B=de=>{const{value:Ie}=de.target;W(Ie)};S.useEffect(()=>{$||W("")},[$]);const q=de=>{const Ie=de!=null&&de.length?de:null;if(Ie===null&&(!f||!f.filteredKeys)||Fc(Ie,f==null?void 0:f.filteredKeys,!0))return null;h({column:o,key:a,filteredKeys:Ie})},H=()=>{k(!1),q(R())},ne=function(){let{confirm:de,closeDropdown:Ie}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{confirm:!1,closeDropdown:!1};de&&q([]),Ie&&k(!1),W(""),T(w?(y||[]).map(ge=>String(ge)):[])},te=function(){let{closeDropdown:de}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{closeDropdown:!0};de&&k(!1),q(R())},ae=(de,Ie)=>{Ie.source==="trigger"&&(de&&_!==void 0&&T(gm(_)),k(de),!de&&!o.filterDropdown&&l&&H())},re=ye({[`${r}-menu-without-submenu`]:!jW(o.filters||[])}),ee=de=>{if(de.target.checked){const Ie=al(o==null?void 0:o.filters).map(ge=>String(ge));T(Ie)}else T([])},j=de=>{let{filters:Ie}=de;return(Ie||[]).map((ge,$e)=>{const De=String(ge.value),ve={title:ge.text,key:ge.value!==void 0?De:String($e)};return ge.children&&(ve.children=j({filters:ge.children})),ve})},Y=de=>{var Ie;return Object.assign(Object.assign({},de),{text:de.title,value:de.key,children:((Ie=de.children)===null||Ie===void 0?void 0:Ie.map(ge=>Y(ge)))||[]})};let se;const{direction:J,renderEmpty:ue}=S.useContext($n);if(typeof o.filterDropdown=="function")se=o.filterDropdown({prefixCls:`${r}-custom`,setSelectedKeys:de=>A({selectedKeys:de}),selectedKeys:R(),confirm:te,clearFilters:ne,filters:o.filters,visible:D,close:()=>{k(!1)}});else if(o.filterDropdown)se=o.filterDropdown;else{const de=R()||[],Ie=()=>{var $e;const De=($e=ue==null?void 0:ue("Table.filter"))!==null&&$e!==void 0?$e:S.createElement(Po,{image:Po.PRESENTED_IMAGE_SIMPLE,description:p.filterEmptyText,imageStyle:{height:24},style:{margin:0,padding:"16px 0"}});if((o.filters||[]).length===0)return De;if(u==="tree")return S.createElement(S.Fragment,null,S.createElement(Pw,{filterSearch:d,value:L,onChange:B,tablePrefixCls:i,locale:p}),S.createElement("div",{className:`${i}-filter-dropdown-tree`},c?S.createElement(El,{checked:de.length===al(o.filters).length,indeterminate:de.length>0&&de.length<al(o.filters).length,className:`${i}-filter-dropdown-checkall`,onChange:ee},p.filterCheckall):null,S.createElement(ox,{checkable:!0,selectable:!1,blockNode:!0,multiple:c,checkStrictly:!c,className:`${r}-menu`,onCheck:O,checkedKeys:de,selectedKeys:de,showIcon:!1,treeData:j({filters:o.filters}),autoExpandParent:!0,defaultExpandAll:!0,filterTreeNode:L.trim()?Re=>typeof d=="function"?d(L,Y(Re)):A$(L,Re.title):void 0})));const ve=O$({filters:o.filters||[],filterSearch:d,prefixCls:s,filteredKeys:R(),filterMultiple:c,searchValue:L}),we=ve.every(Re=>Re===null);return S.createElement(S.Fragment,null,S.createElement(Pw,{filterSearch:d,value:L,onChange:B,tablePrefixCls:i,locale:p}),we?De:S.createElement(bA,{selectable:!0,multiple:c,prefixCls:`${r}-menu`,className:re,onSelect:A,onDeselect:A,selectedKeys:de,getPopupContainer:g,openKeys:P,onOpenChange:z,items:ve}))},ge=()=>w?Fc((y||[]).map($e=>String($e)),de,!0):de.length===0;se=S.createElement(S.Fragment,null,Ie(),S.createElement("div",{className:`${s}-dropdown-btns`},S.createElement(xl,{type:"link",size:"small",disabled:ge(),onClick:()=>ne()},p.filterReset),S.createElement(xl,{type:"primary",size:"small",onClick:H},p.filterConfirm)))}o.filterDropdown&&(se=S.createElement(yA,{selectable:void 0},se));const oe=()=>S.createElement(UW,{className:`${s}-dropdown`},se);let be;return typeof o.filterIcon=="function"?be=o.filterIcon(N):o.filterIcon?be=o.filterIcon:be=S.createElement(IB,null),S.createElement("div",{className:`${s}-column`},S.createElement("span",{className:`${i}-column-title`},m),S.createElement(I1,{dropdownRender:oe,trigger:["click"],open:D,onOpenChange:ae,getPopupContainer:g,placement:J==="rtl"?"bottomLeft":"bottomRight",rootClassName:v},S.createElement("span",{role:"button",tabIndex:-1,className:ye(`${s}-trigger`,{active:N}),onClick:de=>{de.stopPropagation()}},be)))},ug=(t,e,n)=>{let i=[];return(t||[]).forEach((s,o)=>{var r;const a=ql(o,n);if(s.filters||"filterDropdown"in s||"onFilter"in s)if("filteredValue"in s){let l=s.filteredValue;"filterDropdown"in s||(l=(r=l==null?void 0:l.map(String))!==null&&r!==void 0?r:l),i.push({column:s,key:wr(s,a),filteredKeys:l,forceFiltered:s.filtered})}else i.push({column:s,key:wr(s,a),filteredKeys:e&&s.defaultFilteredValue?s.defaultFilteredValue:void 0,forceFiltered:s.filtered});"children"in s&&(i=[].concat(Ze(i),Ze(ug(s.children,e,a))))}),i};function P$(t,e,n,i,s,o,r,a,l){return n.map((c,u)=>{const d=ql(u,a),{filterOnClose:f=!0,filterMultiple:h=!0,filterMode:p,filterSearch:m}=c;let g=c;if(g.filters||g.filterDropdown){const v=wr(g,d),x=i.find(b=>{let{key:w}=b;return v===w});g=Object.assign(Object.assign({},g),{title:b=>S.createElement(KW,{tablePrefixCls:t,prefixCls:`${t}-filter`,dropdownPrefixCls:e,column:g,columnKey:v,filterState:x,filterOnClose:f,filterMultiple:h,filterMode:p,filterSearch:m,triggerFilter:o,locale:s,getPopupContainer:r,rootClassName:l},vf(c.title,b))})}return"children"in g&&(g=Object.assign(Object.assign({},g),{children:P$(t,e,g.children,i,s,o,r,d,l)})),g})}const Mw=t=>{const e={};return t.forEach(n=>{let{key:i,filteredKeys:s,column:o}=n;const r=i,{filters:a,filterDropdown:l}=o;if(l)e[r]=s||null;else if(Array.isArray(s)){const c=al(a);e[r]=c.filter(u=>s.includes(String(u)))}else e[r]=null}),e},dg=(t,e,n)=>e.reduce((s,o)=>{const{column:{onFilter:r,filters:a},filteredKeys:l}=o;return r&&l&&l.length?s.map(c=>Object.assign({},c)).filter(c=>l.some(u=>{const d=al(a),f=d.findIndex(p=>String(p)===String(u)),h=f!==-1?d[f]:u;return c[n]&&(c[n]=dg(c[n],e,n)),r(h,c)})):s},t),M$=t=>t.flatMap(e=>"children"in e?[e].concat(Ze(M$(e.children||[]))):[e]),XW=t=>{const{prefixCls:e,dropdownPrefixCls:n,mergedColumns:i,onFilterChange:s,getPopupContainer:o,locale:r,rootClassName:a}=t;pv();const l=S.useMemo(()=>M$(i||[]),[i]),[c,u]=S.useState(()=>ug(l,!0)),d=S.useMemo(()=>{const m=ug(l,!1);if(m.length===0)return m;let g=!0;if(m.forEach(v=>{let{filteredKeys:x}=v;x!==void 0&&(g=!1)}),g){const v=(l||[]).map((x,b)=>wr(x,ql(b)));return c.filter(x=>{let{key:b}=x;return v.includes(b)}).map(x=>{const b=l[v.findIndex(w=>w===x.key)];return Object.assign(Object.assign({},x),{column:Object.assign(Object.assign({},x.column),b),forceFiltered:b.filtered})})}return m},[l,c]),f=S.useMemo(()=>Mw(d),[d]),h=m=>{const g=d.filter(v=>{let{key:x}=v;return x!==m.key});g.push(m),u(g),s(Mw(g),g)};return[m=>P$(e,n,m,d,r,h,o,void 0,a),d,f]},qW=(t,e,n)=>{const i=S.useRef({});function s(o){var r;if(!i.current||i.current.data!==t||i.current.childrenColumnName!==e||i.current.getRowKey!==n){let l=function(c){c.forEach((u,d)=>{const f=n(u,d);a.set(f,u),u&&typeof u=="object"&&e in u&&l(u[e]||[])})};const a=new Map;l(t),i.current={data:t,childrenColumnName:e,kvMap:a,getRowKey:n}}return(r=i.current.kvMap)===null||r===void 0?void 0:r.get(o)}return[s]};var YW=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};const F$=10;function JW(t,e){const n={current:t.current,pageSize:t.pageSize};return Object.keys(e&&typeof e=="object"?e:{}).forEach(s=>{const o=t[s];typeof o!="function"&&(n[s]=o)}),n}function ZW(t,e,n){const i=n&&typeof n=="object"?n:{},{total:s=0}=i,o=YW(i,["total"]),[r,a]=S.useState(()=>({current:"defaultCurrent"in o?o.defaultCurrent:1,pageSize:"defaultPageSize"in o?o.defaultPageSize:F$})),l=t$(r,o,{total:s>0?s:t}),c=Math.ceil((s||t)/l.pageSize);l.current>c&&(l.current=c||1);const u=(f,h)=>{a({current:f??1,pageSize:h||l.pageSize})},d=(f,h)=>{var p;n&&((p=n.onChange)===null||p===void 0||p.call(n,f,h)),u(f,h),e(f,h||(l==null?void 0:l.pageSize))};return n===!1?[{},()=>{}]:[Object.assign(Object.assign({},l),{onChange:d}),u]}const rh="ascend",vm="descend",xh=t=>typeof t.sorter=="object"&&typeof t.sorter.multiple=="number"?t.sorter.multiple:!1,Fw=t=>typeof t=="function"?t:t&&typeof t=="object"&&t.compare?t.compare:!1,QW=(t,e)=>e?t[t.indexOf(e)+1]:t[0],hg=(t,e,n)=>{let i=[];const s=(o,r)=>{i.push({column:o,key:wr(o,r),multiplePriority:xh(o),sortOrder:o.sortOrder})};return(t||[]).forEach((o,r)=>{const a=ql(r,n);o.children?("sortOrder"in o&&s(o,a),i=[].concat(Ze(i),Ze(hg(o.children,e,a)))):o.sorter&&("sortOrder"in o?s(o,a):e&&o.defaultSortOrder&&i.push({column:o,key:wr(o,a),multiplePriority:xh(o),sortOrder:o.defaultSortOrder}))}),i},L$=(t,e,n,i,s,o,r,a)=>(e||[]).map((c,u)=>{const d=ql(u,a);let f=c;if(f.sorter){const h=f.sortDirections||s,p=f.showSorterTooltip===void 0?r:f.showSorterTooltip,m=wr(f,d),g=n.find(E=>{let{key:N}=E;return N===m}),v=g?g.sortOrder:null,x=QW(h,v);let b;if(c.sortIcon)b=c.sortIcon({sortOrder:v});else{const E=h.includes(rh)&&S.createElement(bB,{className:ye(`${t}-column-sorter-up`,{active:v===rh})}),N=h.includes(vm)&&S.createElement(gB,{className:ye(`${t}-column-sorter-down`,{active:v===vm})});b=S.createElement("span",{className:ye(`${t}-column-sorter`,{[`${t}-column-sorter-full`]:!!(E&&N)})},S.createElement("span",{className:`${t}-column-sorter-inner`,"aria-hidden":"true"},E,N))}const{cancelSort:w,triggerAsc:y,triggerDesc:C}=o||{};let I=w;x===vm?I=C:x===rh&&(I=y);const $=typeof p=="object"?Object.assign({title:I},p):{title:I};f=Object.assign(Object.assign({},f),{className:ye(f.className,{[`${t}-column-sort`]:v}),title:E=>{const N=`${t}-column-sorters`,k=S.createElement("span",{className:`${t}-column-title`},vf(c.title,E)),D=S.createElement("div",{className:N},k,b);return p?typeof p!="boolean"&&(p==null?void 0:p.target)==="sorter-icon"?S.createElement("div",{className:`${N} ${t}-column-sorters-tooltip-target-sorter`},k,S.createElement(my,Object.assign({},$),b)):S.createElement(my,Object.assign({},$),D):D},onHeaderCell:E=>{var N;const k=((N=c.onHeaderCell)===null||N===void 0?void 0:N.call(c,E))||{},D=k.onClick,_=k.onKeyDown;k.onClick=A=>{i({column:c,key:m,sortOrder:x,multiplePriority:xh(c)}),D==null||D(A)},k.onKeyDown=A=>{A.keyCode===et.ENTER&&(i({column:c,key:m,sortOrder:x,multiplePriority:xh(c)}),_==null||_(A))};const R=xW(c.title,{}),T=R==null?void 0:R.toString();return v?k["aria-sort"]=v==="ascend"?"ascending":"descending":k["aria-label"]=T||"",k.className=ye(k.className,`${t}-column-has-sorters`),k.tabIndex=0,c.ellipsis&&(k.title=(R??"").toString()),k}})}return"children"in f&&(f=Object.assign(Object.assign({},f),{children:L$(t,f.children,n,i,s,o,r,d)})),f}),Lw=t=>{const{column:e,sortOrder:n}=t;return{column:e,order:n,field:e.dataIndex,columnKey:e.key}},zw=t=>{const e=t.filter(n=>{let{sortOrder:i}=n;return i}).map(Lw);if(e.length===0&&t.length){const n=t.length-1;return Object.assign(Object.assign({},Lw(t[n])),{column:void 0})}return e.length<=1?e[0]||{}:e},fg=(t,e,n)=>{const i=e.slice().sort((r,a)=>a.multiplePriority-r.multiplePriority),s=t.slice(),o=i.filter(r=>{let{column:{sorter:a},sortOrder:l}=r;return Fw(a)&&l});return o.length?s.sort((r,a)=>{for(let l=0;l<o.length;l+=1){const c=o[l],{column:{sorter:u},sortOrder:d}=c,f=Fw(u);if(f&&d){const h=f(r,a,d);if(h!==0)return d===rh?h:-h}}return 0}).map(r=>{const a=r[n];return a?Object.assign(Object.assign({},r),{[n]:fg(a,e,n)}):r}):s},e4=t=>{const{prefixCls:e,mergedColumns:n,sortDirections:i,tableLocale:s,showSorterTooltip:o,onSorterChange:r}=t,[a,l]=S.useState(hg(n,!0)),c=(m,g)=>{const v=[];return m.forEach((x,b)=>{const w=ql(b,g);if(v.push(wr(x,w)),Array.isArray(x.children)){const y=c(x.children,w);v.push.apply(v,Ze(y))}}),v},u=S.useMemo(()=>{let m=!0;const g=hg(n,!1);if(!g.length){const w=c(n);return a.filter(y=>{let{key:C}=y;return w.includes(C)})}const v=[];function x(w){m?v.push(w):v.push(Object.assign(Object.assign({},w),{sortOrder:null}))}let b=null;return g.forEach(w=>{b===null?(x(w),w.sortOrder&&(w.multiplePriority===!1?m=!1:b=!0)):(b&&w.multiplePriority!==!1||(m=!1),x(w))}),v},[n,a]),d=S.useMemo(()=>{var m,g;const v=u.map(x=>{let{column:b,sortOrder:w}=x;return{column:b,order:w}});return{sortColumns:v,sortColumn:(m=v[0])===null||m===void 0?void 0:m.column,sortOrder:(g=v[0])===null||g===void 0?void 0:g.order}},[u]),f=m=>{let g;m.multiplePriority===!1||!u.length||u[0].multiplePriority===!1?g=[m]:g=[].concat(Ze(u.filter(v=>{let{key:x}=v;return x!==m.key})),[m]),l(g),r(zw(g),g)};return[m=>L$(e,m,u,f,i,s,o),u,d,()=>zw(u)]},z$=(t,e)=>t.map(i=>{const s=Object.assign({},i);return s.title=vf(i.title,e),"children"in s&&(s.children=z$(s.children,e)),s}),t4=t=>[S.useCallback(n=>z$(n,t),[t])],n4=I$((t,e)=>{const{_renderTimes:n}=t,{_renderTimes:i}=e;return n!==i}),i4=E$((t,e)=>{const{_renderTimes:n}=t,{_renderTimes:i}=e;return n!==i}),s4=t=>{const{componentCls:e,lineWidth:n,lineType:i,tableBorderColor:s,tableHeaderBg:o,tablePaddingVertical:r,tablePaddingHorizontal:a,calc:l}=t,c=`${he(n)} ${i} ${s}`,u=(d,f,h)=>({[`&${e}-${d}`]:{[`> ${e}-container`]:{[`> ${e}-content, > ${e}-body`]:{"\n            > table > tbody > tr > th,\n            > table > tbody > tr > td\n          ":{[`> ${e}-expanded-row-fixed`]:{margin:`${he(l(f).mul(-1).equal())}
              ${he(l(l(h).add(n)).mul(-1).equal())}`}}}}}});return{[`${e}-wrapper`]:{[`${e}${e}-bordered`]:Object.assign(Object.assign(Object.assign({[`> ${e}-title`]:{border:c,borderBottom:0},[`> ${e}-container`]:{borderInlineStart:c,borderTop:c,[`
            > ${e}-content,
            > ${e}-header,
            > ${e}-body,
            > ${e}-summary
          `]:{"> table":{"\n                > thead > tr > th,\n                > thead > tr > td,\n                > tbody > tr > th,\n                > tbody > tr > td,\n                > tfoot > tr > th,\n                > tfoot > tr > td\n              ":{borderInlineEnd:c},"> thead":{"> tr:not(:last-child) > th":{borderBottom:c},"> tr > th::before":{backgroundColor:"transparent !important"}},"\n                > thead > tr,\n                > tbody > tr,\n                > tfoot > tr\n              ":{[`> ${e}-cell-fix-right-first::after`]:{borderInlineEnd:c}},"\n                > tbody > tr > th,\n                > tbody > tr > td\n              ":{[`> ${e}-expanded-row-fixed`]:{margin:`${he(l(r).mul(-1).equal())} ${he(l(l(a).add(n)).mul(-1).equal())}`,"&::after":{position:"absolute",top:0,insetInlineEnd:n,bottom:0,borderInlineEnd:c,content:'""'}}}}}},[`&${e}-scroll-horizontal`]:{[`> ${e}-container > ${e}-body`]:{"> table > tbody":{[`
                > tr${e}-expanded-row,
                > tr${e}-placeholder
              `]:{"> th, > td":{borderInlineEnd:0}}}}}},u("middle",t.tablePaddingVerticalMiddle,t.tablePaddingHorizontalMiddle)),u("small",t.tablePaddingVerticalSmall,t.tablePaddingHorizontalSmall)),{[`> ${e}-footer`]:{border:c,borderTop:0}}),[`${e}-cell`]:{[`${e}-container:first-child`]:{borderTop:0},"&-scrollbar:not([rowspan])":{boxShadow:`0 ${he(n)} 0 ${he(n)} ${o}`}},[`${e}-bordered ${e}-cell-scrollbar`]:{borderInlineEnd:c}}}},o4=t=>{const{componentCls:e}=t;return{[`${e}-wrapper`]:{[`${e}-cell-ellipsis`]:Object.assign(Object.assign({},dh),{wordBreak:"keep-all",[`
          &${e}-cell-fix-left-last,
          &${e}-cell-fix-right-first
        `]:{overflow:"visible",[`${e}-cell-content`]:{display:"block",overflow:"hidden",textOverflow:"ellipsis"}},[`${e}-column-title`]:{overflow:"hidden",textOverflow:"ellipsis",wordBreak:"keep-all"}})}}},r4=t=>{const{componentCls:e}=t;return{[`${e}-wrapper`]:{[`${e}-tbody > tr${e}-placeholder`]:{textAlign:"center",color:t.colorTextDisabled,"\n          &:hover > th,\n          &:hover > td,\n        ":{background:t.colorBgContainer}}}}},a4=t=>{const{componentCls:e,antCls:n,motionDurationSlow:i,lineWidth:s,paddingXS:o,lineType:r,tableBorderColor:a,tableExpandIconBg:l,tableExpandColumnWidth:c,borderRadius:u,tablePaddingVertical:d,tablePaddingHorizontal:f,tableExpandedRowBg:h,paddingXXS:p,expandIconMarginTop:m,expandIconSize:g,expandIconHalfInner:v,expandIconScale:x,calc:b}=t,w=`${he(s)} ${r} ${a}`,y=b(p).sub(s).equal();return{[`${e}-wrapper`]:{[`${e}-expand-icon-col`]:{width:c},[`${e}-row-expand-icon-cell`]:{textAlign:"center",[`${e}-row-expand-icon`]:{display:"inline-flex",float:"none",verticalAlign:"sub"}},[`${e}-row-indent`]:{height:1,float:"left"},[`${e}-row-expand-icon`]:Object.assign(Object.assign({},CF(t)),{position:"relative",float:"left",boxSizing:"border-box",width:g,height:g,padding:0,color:"inherit",lineHeight:he(g),background:l,border:w,borderRadius:u,transform:`scale(${x})`,transition:`all ${i}`,userSelect:"none","&:focus, &:hover, &:active":{borderColor:"currentcolor"},"&::before, &::after":{position:"absolute",background:"currentcolor",transition:`transform ${i} ease-out`,content:'""'},"&::before":{top:v,insetInlineEnd:y,insetInlineStart:y,height:s},"&::after":{top:y,bottom:y,insetInlineStart:v,width:s,transform:"rotate(90deg)"},"&-collapsed::before":{transform:"rotate(-180deg)"},"&-collapsed::after":{transform:"rotate(0deg)"},"&-spaced":{"&::before, &::after":{display:"none",content:"none"},background:"transparent",border:0,visibility:"hidden"}}),[`${e}-row-indent + ${e}-row-expand-icon`]:{marginTop:m,marginInlineEnd:o},[`tr${e}-expanded-row`]:{"&, &:hover":{"> th, > td":{background:h}},[`${n}-descriptions-view`]:{display:"flex",table:{flex:"auto",width:"100%"}}},[`${e}-expanded-row-fixed`]:{position:"relative",margin:`${he(b(d).mul(-1).equal())} ${he(b(f).mul(-1).equal())}`,padding:`${he(d)} ${he(f)}`}}}},l4=t=>{const{componentCls:e,antCls:n,iconCls:i,tableFilterDropdownWidth:s,tableFilterDropdownSearchWidth:o,paddingXXS:r,paddingXS:a,colorText:l,lineWidth:c,lineType:u,tableBorderColor:d,headerIconColor:f,fontSizeSM:h,tablePaddingHorizontal:p,borderRadius:m,motionDurationSlow:g,colorTextDescription:v,colorPrimary:x,tableHeaderFilterActiveBg:b,colorTextDisabled:w,tableFilterDropdownBg:y,tableFilterDropdownHeight:C,controlItemBgHover:I,controlItemBgActive:$,boxShadowSecondary:E,filterDropdownMenuBg:N,calc:k}=t,D=`${n}-dropdown`,_=`${e}-filter-dropdown`,R=`${n}-tree`,T=`${he(c)} ${u} ${d}`;return[{[`${e}-wrapper`]:{[`${e}-filter-column`]:{display:"flex",justifyContent:"space-between"},[`${e}-filter-trigger`]:{position:"relative",display:"flex",alignItems:"center",marginBlock:k(r).mul(-1).equal(),marginInline:`${he(r)} ${he(k(p).div(2).mul(-1).equal())}`,padding:`0 ${he(r)}`,color:f,fontSize:h,borderRadius:m,cursor:"pointer",transition:`all ${g}`,"&:hover":{color:v,background:b},"&.active":{color:x}}}},{[`${n}-dropdown`]:{[_]:Object.assign(Object.assign({},os(t)),{minWidth:s,backgroundColor:y,borderRadius:m,boxShadow:E,overflow:"hidden",[`${D}-menu`]:{maxHeight:C,overflowX:"hidden",border:0,boxShadow:"none",borderRadius:"unset",backgroundColor:N,"&:empty::after":{display:"block",padding:`${he(a)} 0`,color:w,fontSize:h,textAlign:"center",content:'"Not Found"'}},[`${_}-tree`]:{paddingBlock:`${he(a)} 0`,paddingInline:a,[R]:{padding:0},[`${R}-treenode ${R}-node-content-wrapper:hover`]:{backgroundColor:I},[`${R}-treenode-checkbox-checked ${R}-node-content-wrapper`]:{"&, &:hover":{backgroundColor:$}}},[`${_}-search`]:{padding:a,borderBottom:T,"&-input":{input:{minWidth:o},[i]:{color:w}}},[`${_}-checkall`]:{width:"100%",marginBottom:r,marginInlineStart:r},[`${_}-btns`]:{display:"flex",justifyContent:"space-between",padding:`${he(k(a).sub(c).equal())} ${he(a)}`,overflow:"hidden",borderTop:T}})}},{[`${n}-dropdown ${_}, ${_}-submenu`]:{[`${n}-checkbox-wrapper + span`]:{paddingInlineStart:a,color:l},"> ul":{maxHeight:"calc(100vh - 130px)",overflowX:"hidden",overflowY:"auto"}}}]},c4=t=>{const{componentCls:e,lineWidth:n,colorSplit:i,motionDurationSlow:s,zIndexTableFixed:o,tableBg:r,zIndexTableSticky:a,calc:l}=t,c=i;return{[`${e}-wrapper`]:{[`
        ${e}-cell-fix-left,
        ${e}-cell-fix-right
      `]:{position:"sticky !important",zIndex:o,background:r},[`
        ${e}-cell-fix-left-first::after,
        ${e}-cell-fix-left-last::after
      `]:{position:"absolute",top:0,right:{_skip_check_:!0,value:0},bottom:l(n).mul(-1).equal(),width:30,transform:"translateX(100%)",transition:`box-shadow ${s}`,content:'""',pointerEvents:"none"},[`${e}-cell-fix-left-all::after`]:{display:"none"},[`
        ${e}-cell-fix-right-first::after,
        ${e}-cell-fix-right-last::after
      `]:{position:"absolute",top:0,bottom:l(n).mul(-1).equal(),left:{_skip_check_:!0,value:0},width:30,transform:"translateX(-100%)",transition:`box-shadow ${s}`,content:'""',pointerEvents:"none"},[`${e}-container`]:{position:"relative","&::before, &::after":{position:"absolute",top:0,bottom:0,zIndex:l(a).add(1).equal({unit:!1}),width:30,transition:`box-shadow ${s}`,content:'""',pointerEvents:"none"},"&::before":{insetInlineStart:0},"&::after":{insetInlineEnd:0}},[`${e}-ping-left`]:{[`&:not(${e}-has-fix-left) ${e}-container::before`]:{boxShadow:`inset 10px 0 8px -8px ${c}`},[`
          ${e}-cell-fix-left-first::after,
          ${e}-cell-fix-left-last::after
        `]:{boxShadow:`inset 10px 0 8px -8px ${c}`},[`${e}-cell-fix-left-last::before`]:{backgroundColor:"transparent !important"}},[`${e}-ping-right`]:{[`&:not(${e}-has-fix-right) ${e}-container::after`]:{boxShadow:`inset -10px 0 8px -8px ${c}`},[`
          ${e}-cell-fix-right-first::after,
          ${e}-cell-fix-right-last::after
        `]:{boxShadow:`inset -10px 0 8px -8px ${c}`}},[`${e}-fixed-column-gapped`]:{[`
        ${e}-cell-fix-left-first::after,
        ${e}-cell-fix-left-last::after,
        ${e}-cell-fix-right-first::after,
        ${e}-cell-fix-right-last::after
      `]:{boxShadow:"none"}}}}},u4=t=>{const{componentCls:e,antCls:n,margin:i}=t;return{[`${e}-wrapper`]:{[`${e}-pagination${n}-pagination`]:{margin:`${he(i)} 0`},[`${e}-pagination`]:{display:"flex",flexWrap:"wrap",rowGap:t.paddingXS,"> *":{flex:"none"},"&-left":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-right":{justifyContent:"flex-end"}}}}},d4=t=>{const{componentCls:e,tableRadius:n}=t;return{[`${e}-wrapper`]:{[e]:{[`${e}-title, ${e}-header`]:{borderRadius:`${he(n)} ${he(n)} 0 0`},[`${e}-title + ${e}-container`]:{borderStartStartRadius:0,borderStartEndRadius:0,[`${e}-header, table`]:{borderRadius:0},"table > thead > tr:first-child":{"th:first-child, th:last-child, td:first-child, td:last-child":{borderRadius:0}}},"&-container":{borderStartStartRadius:n,borderStartEndRadius:n,"table > thead > tr:first-child":{"> *:first-child":{borderStartStartRadius:n},"> *:last-child":{borderStartEndRadius:n}}},"&-footer":{borderRadius:`0 0 ${he(n)} ${he(n)}`}}}}},h4=t=>{const{componentCls:e}=t;return{[`${e}-wrapper-rtl`]:{direction:"rtl",table:{direction:"rtl"},[`${e}-pagination-left`]:{justifyContent:"flex-end"},[`${e}-pagination-right`]:{justifyContent:"flex-start"},[`${e}-row-expand-icon`]:{float:"right","&::after":{transform:"rotate(-90deg)"},"&-collapsed::before":{transform:"rotate(180deg)"},"&-collapsed::after":{transform:"rotate(0deg)"}},[`${e}-container`]:{"&::before":{insetInlineStart:"unset",insetInlineEnd:0},"&::after":{insetInlineStart:0,insetInlineEnd:"unset"},[`${e}-row-indent`]:{float:"right"}}}}},f4=t=>{const{componentCls:e,antCls:n,iconCls:i,fontSizeIcon:s,padding:o,paddingXS:r,headerIconColor:a,headerIconHoverColor:l,tableSelectionColumnWidth:c,tableSelectedRowBg:u,tableSelectedRowHoverBg:d,tableRowHoverBg:f,tablePaddingHorizontal:h,calc:p}=t;return{[`${e}-wrapper`]:{[`${e}-selection-col`]:{width:c,[`&${e}-selection-col-with-dropdown`]:{width:p(c).add(s).add(p(o).div(4)).equal()}},[`${e}-bordered ${e}-selection-col`]:{width:p(c).add(p(r).mul(2)).equal(),[`&${e}-selection-col-with-dropdown`]:{width:p(c).add(s).add(p(o).div(4)).add(p(r).mul(2)).equal()}},[`
        table tr th${e}-selection-column,
        table tr td${e}-selection-column,
        ${e}-selection-column
      `]:{paddingInlineEnd:t.paddingXS,paddingInlineStart:t.paddingXS,textAlign:"center",[`${n}-radio-wrapper`]:{marginInlineEnd:0}},[`table tr th${e}-selection-column${e}-cell-fix-left`]:{zIndex:p(t.zIndexTableFixed).add(1).equal({unit:!1})},[`table tr th${e}-selection-column::after`]:{backgroundColor:"transparent !important"},[`${e}-selection`]:{position:"relative",display:"inline-flex",flexDirection:"column"},[`${e}-selection-extra`]:{position:"absolute",top:0,zIndex:1,cursor:"pointer",transition:`all ${t.motionDurationSlow}`,marginInlineStart:"100%",paddingInlineStart:he(p(h).div(4).equal()),[i]:{color:a,fontSize:s,verticalAlign:"baseline","&:hover":{color:l}}},[`${e}-tbody`]:{[`${e}-row`]:{[`&${e}-row-selected`]:{[`> ${e}-cell`]:{background:u,"&-row-hover":{background:d}}},[`> ${e}-cell-row-hover`]:{background:f}}}}}},p4=t=>{const{componentCls:e,tableExpandColumnWidth:n,calc:i}=t,s=(o,r,a,l)=>({[`${e}${e}-${o}`]:{fontSize:l,[`
        ${e}-title,
        ${e}-footer,
        ${e}-cell,
        ${e}-thead > tr > th,
        ${e}-tbody > tr > th,
        ${e}-tbody > tr > td,
        tfoot > tr > th,
        tfoot > tr > td
      `]:{padding:`${he(r)} ${he(a)}`},[`${e}-filter-trigger`]:{marginInlineEnd:he(i(a).div(2).mul(-1).equal())},[`${e}-expanded-row-fixed`]:{margin:`${he(i(r).mul(-1).equal())} ${he(i(a).mul(-1).equal())}`},[`${e}-tbody`]:{[`${e}-wrapper:only-child ${e}`]:{marginBlock:he(i(r).mul(-1).equal()),marginInline:`${he(i(n).sub(a).equal())} ${he(i(a).mul(-1).equal())}`}},[`${e}-selection-extra`]:{paddingInlineStart:he(i(a).div(4).equal())}}});return{[`${e}-wrapper`]:Object.assign(Object.assign({},s("middle",t.tablePaddingVerticalMiddle,t.tablePaddingHorizontalMiddle,t.tableFontSizeMiddle)),s("small",t.tablePaddingVerticalSmall,t.tablePaddingHorizontalSmall,t.tableFontSizeSmall))}},m4=t=>{const{componentCls:e,marginXXS:n,fontSizeIcon:i,headerIconColor:s,headerIconHoverColor:o}=t;return{[`${e}-wrapper`]:{[`${e}-thead th${e}-column-has-sorters`]:{outline:"none",cursor:"pointer",transition:`all ${t.motionDurationSlow}`,"&:hover":{background:t.tableHeaderSortHoverBg,"&::before":{backgroundColor:"transparent !important"}},"&:focus-visible":{color:t.colorPrimary},[`
          &${e}-cell-fix-left:hover,
          &${e}-cell-fix-right:hover
        `]:{background:t.tableFixedHeaderSortActiveBg}},[`${e}-thead th${e}-column-sort`]:{background:t.tableHeaderSortBg,"&::before":{backgroundColor:"transparent !important"}},[`td${e}-column-sort`]:{background:t.tableBodySortBg},[`${e}-column-title`]:{position:"relative",zIndex:1,flex:1},[`${e}-column-sorters`]:{display:"flex",flex:"auto",alignItems:"center",justifyContent:"space-between","&::after":{position:"absolute",inset:0,width:"100%",height:"100%",content:'""'}},[`${e}-column-sorters-tooltip-target-sorter`]:{"&::after":{content:"none"}},[`${e}-column-sorter`]:{marginInlineStart:n,color:s,fontSize:0,transition:`color ${t.motionDurationSlow}`,"&-inner":{display:"inline-flex",flexDirection:"column",alignItems:"center"},"&-up, &-down":{fontSize:i,"&.active":{color:t.colorPrimary}},[`${e}-column-sorter-up + ${e}-column-sorter-down`]:{marginTop:"-0.3em"}},[`${e}-column-sorters:hover ${e}-column-sorter`]:{color:o}}}},g4=t=>{const{componentCls:e,opacityLoading:n,tableScrollThumbBg:i,tableScrollThumbBgHover:s,tableScrollThumbSize:o,tableScrollBg:r,zIndexTableSticky:a,stickyScrollBarBorderRadius:l,lineWidth:c,lineType:u,tableBorderColor:d}=t,f=`${he(c)} ${u} ${d}`;return{[`${e}-wrapper`]:{[`${e}-sticky`]:{"&-holder":{position:"sticky",zIndex:a,background:t.colorBgContainer},"&-scroll":{position:"sticky",bottom:0,height:`${he(o)} !important`,zIndex:a,display:"flex",alignItems:"center",background:r,borderTop:f,opacity:n,"&:hover":{transformOrigin:"center bottom"},"&-bar":{height:o,backgroundColor:i,borderRadius:l,transition:`all ${t.motionDurationSlow}, transform none`,position:"absolute",bottom:0,"&:hover, &-active":{backgroundColor:s}}}}}}},Bw=t=>{const{componentCls:e,lineWidth:n,tableBorderColor:i,calc:s}=t,o=`${he(n)} ${t.lineType} ${i}`;return{[`${e}-wrapper`]:{[`${e}-summary`]:{position:"relative",zIndex:t.zIndexTableFixed,background:t.tableBg,"> tr":{"> th, > td":{borderBottom:o}}},[`div${e}-summary`]:{boxShadow:`0 ${he(s(n).mul(-1).equal())} 0 ${i}`}}}},v4=t=>{const{componentCls:e,motionDurationMid:n,lineWidth:i,lineType:s,tableBorderColor:o,calc:r}=t,a=`${he(i)} ${s} ${o}`,l=`${e}-expanded-row-cell`;return{[`${e}-wrapper`]:{[`${e}-tbody-virtual`]:{[`${e}-row:not(tr)`]:{display:"flex",boxSizing:"border-box",width:"100%"},[`${e}-cell`]:{borderBottom:a,transition:`background ${n}`},[`${e}-expanded-row`]:{[`${l}${l}-fixed`]:{position:"sticky",insetInlineStart:0,overflow:"hidden",width:`calc(var(--virtual-width) - ${he(i)})`,borderInlineEnd:"none"}}},[`${e}-bordered`]:{[`${e}-tbody-virtual`]:{"&:after":{content:'""',insetInline:0,bottom:0,borderBottom:a,position:"absolute"},[`${e}-cell`]:{borderInlineEnd:a,[`&${e}-cell-fix-right-first:before`]:{content:'""',position:"absolute",insetBlock:0,insetInlineStart:r(i).mul(-1).equal(),borderInlineStart:a}}},[`&${e}-virtual`]:{[`${e}-placeholder ${e}-cell`]:{borderInlineEnd:a,borderBottom:a}}}}}},x4=t=>{const{componentCls:e,fontWeightStrong:n,tablePaddingVertical:i,tablePaddingHorizontal:s,tableExpandColumnWidth:o,lineWidth:r,lineType:a,tableBorderColor:l,tableFontSize:c,tableBg:u,tableRadius:d,tableHeaderTextColor:f,motionDurationMid:h,tableHeaderBg:p,tableHeaderCellSplitColor:m,tableFooterTextColor:g,tableFooterBg:v,calc:x}=t,b=`${he(r)} ${a} ${l}`;return{[`${e}-wrapper`]:Object.assign(Object.assign({clear:"both",maxWidth:"100%"},f1()),{[e]:Object.assign(Object.assign({},os(t)),{fontSize:c,background:u,borderRadius:`${he(d)} ${he(d)} 0 0`,scrollbarColor:`${t.tableScrollThumbBg} ${t.tableScrollBg}`}),table:{width:"100%",textAlign:"start",borderRadius:`${he(d)} ${he(d)} 0 0`,borderCollapse:"separate",borderSpacing:0},[`
          ${e}-cell,
          ${e}-thead > tr > th,
          ${e}-tbody > tr > th,
          ${e}-tbody > tr > td,
          tfoot > tr > th,
          tfoot > tr > td
        `]:{position:"relative",padding:`${he(i)} ${he(s)}`,overflowWrap:"break-word"},[`${e}-title`]:{padding:`${he(i)} ${he(s)}`},[`${e}-thead`]:{"\n          > tr > th,\n          > tr > td\n        ":{position:"relative",color:f,fontWeight:n,textAlign:"start",background:p,borderBottom:b,transition:`background ${h} ease`,"&[colspan]:not([colspan='1'])":{textAlign:"center"},[`&:not(:last-child):not(${e}-selection-column):not(${e}-row-expand-icon-cell):not([colspan])::before`]:{position:"absolute",top:"50%",insetInlineEnd:0,width:1,height:"1.6em",backgroundColor:m,transform:"translateY(-50%)",transition:`background-color ${h}`,content:'""'}},"> tr:not(:last-child) > th[colspan]":{borderBottom:0}},[`${e}-tbody`]:{"> tr":{"> th, > td":{transition:`background ${h}, border-color ${h}`,borderBottom:b,[`
              > ${e}-wrapper:only-child,
              > ${e}-expanded-row-fixed > ${e}-wrapper:only-child
            `]:{[e]:{marginBlock:he(x(i).mul(-1).equal()),marginInline:`${he(x(o).sub(s).equal())}
                ${he(x(s).mul(-1).equal())}`,[`${e}-tbody > tr:last-child > td`]:{borderBottom:0,"&:first-child, &:last-child":{borderRadius:0}}}}},"> th":{position:"relative",color:f,fontWeight:n,textAlign:"start",background:p,borderBottom:b,transition:`background ${h} ease`}}},[`${e}-footer`]:{padding:`${he(i)} ${he(s)}`,color:g,background:v}})}},b4=t=>{const{colorFillAlter:e,colorBgContainer:n,colorTextHeading:i,colorFillSecondary:s,colorFillContent:o,controlItemBgActive:r,controlItemBgActiveHover:a,padding:l,paddingSM:c,paddingXS:u,colorBorderSecondary:d,borderRadiusLG:f,controlHeight:h,colorTextPlaceholder:p,fontSize:m,fontSizeSM:g,lineHeight:v,lineWidth:x,colorIcon:b,colorIconHover:w,opacityLoading:y,controlInteractiveSize:C}=t,I=new Oo(s).onBackground(n).toHexShortString(),$=new Oo(o).onBackground(n).toHexShortString(),E=new Oo(e).onBackground(n).toHexShortString(),N=new Oo(b),k=new Oo(w),D=C/2-x,_=D*2+x*3;return{headerBg:E,headerColor:i,headerSortActiveBg:I,headerSortHoverBg:$,bodySortBg:E,rowHoverBg:E,rowSelectedBg:r,rowSelectedHoverBg:a,rowExpandedBg:e,cellPaddingBlock:l,cellPaddingInline:l,cellPaddingBlockMD:c,cellPaddingInlineMD:u,cellPaddingBlockSM:u,cellPaddingInlineSM:u,borderColor:d,headerBorderRadius:f,footerBg:E,footerColor:i,cellFontSize:m,cellFontSizeMD:m,cellFontSizeSM:m,headerSplitColor:d,fixedHeaderSortActiveBg:I,headerFilterHoverBg:o,filterDropdownMenuBg:n,filterDropdownBg:n,expandIconBg:n,selectionColumnWidth:h,stickyScrollBarBg:p,stickyScrollBarBorderRadius:100,expandIconMarginTop:(m*v-x*3)/2-Math.ceil((g*1.4-x*3)/2),headerIconColor:N.clone().setAlpha(N.getAlpha()*y).toRgbString(),headerIconHoverColor:k.clone().setAlpha(k.getAlpha()*y).toRgbString(),expandIconHalfInner:D,expandIconSize:_,expandIconScale:C/_}},Vw=2,y4=Ys("Table",t=>{const{colorTextHeading:e,colorSplit:n,colorBgContainer:i,controlInteractiveSize:s,headerBg:o,headerColor:r,headerSortActiveBg:a,headerSortHoverBg:l,bodySortBg:c,rowHoverBg:u,rowSelectedBg:d,rowSelectedHoverBg:f,rowExpandedBg:h,cellPaddingBlock:p,cellPaddingInline:m,cellPaddingBlockMD:g,cellPaddingInlineMD:v,cellPaddingBlockSM:x,cellPaddingInlineSM:b,borderColor:w,footerBg:y,footerColor:C,headerBorderRadius:I,cellFontSize:$,cellFontSizeMD:E,cellFontSizeSM:N,headerSplitColor:k,fixedHeaderSortActiveBg:D,headerFilterHoverBg:_,filterDropdownBg:R,expandIconBg:T,selectionColumnWidth:A,stickyScrollBarBg:O,calc:P}=t,M=Si(t,{tableFontSize:$,tableBg:i,tableRadius:I,tablePaddingVertical:p,tablePaddingHorizontal:m,tablePaddingVerticalMiddle:g,tablePaddingHorizontalMiddle:v,tablePaddingVerticalSmall:x,tablePaddingHorizontalSmall:b,tableBorderColor:w,tableHeaderTextColor:r,tableHeaderBg:o,tableFooterTextColor:C,tableFooterBg:y,tableHeaderCellSplitColor:k,tableHeaderSortBg:a,tableHeaderSortHoverBg:l,tableBodySortBg:c,tableFixedHeaderSortActiveBg:D,tableHeaderFilterActiveBg:_,tableFilterDropdownBg:R,tableRowHoverBg:u,tableSelectedRowBg:d,tableSelectedRowHoverBg:f,zIndexTableFixed:Vw,zIndexTableSticky:P(Vw).add(1).equal({unit:!1}),tableFontSizeMiddle:E,tableFontSizeSmall:N,tableSelectionColumnWidth:A,tableExpandIconBg:T,tableExpandColumnWidth:P(s).add(P(t.padding).mul(2)).equal(),tableExpandedRowBg:h,tableFilterDropdownWidth:120,tableFilterDropdownHeight:264,tableFilterDropdownSearchWidth:140,tableScrollThumbSize:8,tableScrollThumbBg:O,tableScrollThumbBgHover:e,tableScrollBg:n});return[x4(M),u4(M),Bw(M),m4(M),l4(M),s4(M),d4(M),a4(M),Bw(M),r4(M),f4(M),c4(M),g4(M),o4(M),p4(M),h4(M),v4(M)]},b4,{unitless:{expandIconScale:!0}}),w4=[],C4=(t,e)=>{var n,i;const{prefixCls:s,className:o,rootClassName:r,style:a,size:l,bordered:c,dropdownPrefixCls:u,dataSource:d,pagination:f,rowSelection:h,rowKey:p="key",rowClassName:m,columns:g,children:v,childrenColumnName:x,onChange:b,getPopupContainer:w,loading:y,expandIcon:C,expandable:I,expandedRowRender:$,expandIconColumnIndex:E,indentSize:N,scroll:k,sortDirections:D,locale:_,showSorterTooltip:R={target:"full-header"},virtual:T}=t;pv();const A=S.useMemo(()=>g||Qv(v),[g,v]),O=S.useMemo(()=>A.some(Je=>Je.responsive),[A]),P=xv(O),M=S.useMemo(()=>{const Je=new Set(Object.keys(P).filter(dt=>P[dt]));return A.filter(dt=>!dt.responsive||dt.responsive.some(st=>Je.has(st)))},[A,P]),z=Da(t,["className","style","columns"]),{locale:L=V_,direction:W,table:B,renderEmpty:q,getPrefixCls:H,getPopupContainer:ne}=S.useContext($n),te=kr(l),ae=Object.assign(Object.assign({},L.Table),_),re=d||w4,ee=H("table",s),j=H("dropdown",u),[,Y]=Gl(),se=Ta(ee),[J,ue,oe]=y4(ee,se),be=Object.assign(Object.assign({childrenColumnName:x,expandIconColumnIndex:E},I),{expandIcon:(n=I==null?void 0:I.expandIcon)!==null&&n!==void 0?n:(i=B==null?void 0:B.expandable)===null||i===void 0?void 0:i.expandIcon}),{childrenColumnName:de="children"}=be,Ie=S.useMemo(()=>re.some(Je=>Je==null?void 0:Je[de])?"nest":$||I!=null&&I.expandedRowRender?"row":null,[re]),ge={body:S.useRef()},$e=vW(ee),De=S.useRef(null),ve=S.useRef(null);mW(e,()=>Object.assign(Object.assign({},ve.current),{nativeElement:De.current}));const we=S.useMemo(()=>typeof p=="function"?p:Je=>Je==null?void 0:Je[p],[p]),[Re]=qW(re,de,we),Ne={},Ke=function(Je,dt){let st=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var vt,Kt,hn,An;const Xt=Object.assign(Object.assign({},Ne),Je);st&&((vt=Ne.resetPagination)===null||vt===void 0||vt.call(Ne),!((Kt=Xt.pagination)===null||Kt===void 0)&&Kt.current&&(Xt.pagination.current=1),f&&((hn=f.onChange)===null||hn===void 0||hn.call(f,1,(An=Xt.pagination)===null||An===void 0?void 0:An.pageSize))),k&&k.scrollToFirstRowOnChange!==!1&&ge.body.current&&W_(0,{getContainer:()=>ge.body.current}),b==null||b(Xt.pagination,Xt.filters,Xt.sorter,{currentDataSource:dg(fg(re,Xt.sorterStates,de),Xt.filterStates,de),action:dt})},We=(Je,dt)=>{Ke({sorter:Je,sorterStates:dt},"sort",!1)},[ct,Ee,lt,Xe]=e4({prefixCls:ee,mergedColumns:M,onSorterChange:We,sortDirections:D||["ascend","descend"],tableLocale:ae,showSorterTooltip:R}),Le=S.useMemo(()=>fg(re,Ee,de),[re,Ee]);Ne.sorter=Xe(),Ne.sorterStates=Ee;const Pe=(Je,dt)=>{Ke({filters:Je,filterStates:dt},"filter",!0)},[ut,ht,Pt]=XW({prefixCls:ee,locale:ae,dropdownPrefixCls:j,mergedColumns:M,onFilterChange:Pe,getPopupContainer:w||ne,rootClassName:ye(r,se)}),ft=dg(Le,ht,de);Ne.filters=Pt,Ne.filterStates=ht;const Jn=S.useMemo(()=>{const Je={};return Object.keys(Pt).forEach(dt=>{Pt[dt]!==null&&(Je[dt]=Pt[dt])}),Object.assign(Object.assign({},lt),{filters:Je})},[lt,Pt]),[Ut]=t4(Jn),vi=(Je,dt)=>{Ke({pagination:Object.assign(Object.assign({},Ne.pagination),{current:Je,pageSize:dt})},"paginate")},[Mt,ki]=ZW(ft.length,vi,f);Ne.pagination=f===!1?{}:JW(Mt,f),Ne.resetPagination=ki;const un=S.useMemo(()=>{if(f===!1||!Mt.pageSize)return ft;const{current:Je=1,total:dt,pageSize:st=F$}=Mt;return ft.length<dt?ft.length>st?ft.slice((Je-1)*st,Je*st):ft:ft.slice((Je-1)*st,Je*st)},[!!f,ft,Mt==null?void 0:Mt.current,Mt==null?void 0:Mt.pageSize,Mt==null?void 0:Mt.total]),[dn,gn]=fW({prefixCls:ee,data:ft,pageData:un,getRowKey:we,getRecordByKey:Re,expandType:Ie,childrenColumnName:de,locale:ae,getPopupContainer:w||ne},h),Gn=(Je,dt,st)=>{let vt;return typeof m=="function"?vt=ye(m(Je,dt,st)):vt=ye(m),ye({[`${ee}-row-selected`]:gn.has(we(Je,dt))},vt)};be.__PARENT_RENDER_ICON__=be.expandIcon,be.expandIcon=be.expandIcon||C||gW(ae),Ie==="nest"&&be.expandIconColumnIndex===void 0?be.expandIconColumnIndex=h?1:0:be.expandIconColumnIndex>0&&h&&(be.expandIconColumnIndex-=1),typeof be.indentSize!="number"&&(be.indentSize=typeof N=="number"?N:15);const Tt=S.useCallback(Je=>Ut(dn(ut(ct(Je)))),[ct,ut,dn]);let Yt,jt;if(f!==!1&&(Mt!=null&&Mt.total)){let Je;Mt.size?Je=Mt.size:Je=te==="small"||te==="middle"?"small":void 0;const dt=Kt=>S.createElement(r$,Object.assign({},Mt,{className:ye(`${ee}-pagination ${ee}-pagination-${Kt}`,Mt.className),size:Je})),st=W==="rtl"?"left":"right",{position:vt}=Mt;if(vt!==null&&Array.isArray(vt)){const Kt=vt.find(Xt=>Xt.includes("top")),hn=vt.find(Xt=>Xt.includes("bottom")),An=vt.every(Xt=>`${Xt}`=="none");!Kt&&!hn&&!An&&(jt=dt(st)),Kt&&(Yt=dt(Kt.toLowerCase().replace("top",""))),hn&&(jt=dt(hn.toLowerCase().replace("bottom","")))}else jt=dt(st)}let Be;typeof y=="boolean"?Be={spinning:y}:typeof y=="object"&&(Be=Object.assign({spinning:!0},y));const ze=ye(oe,se,`${ee}-wrapper`,B==null?void 0:B.className,{[`${ee}-wrapper-rtl`]:W==="rtl"},o,r,ue),Oe=Object.assign(Object.assign({},B==null?void 0:B.style),a),qe=typeof(_==null?void 0:_.emptyText)<"u"?_.emptyText:(q==null?void 0:q("Table"))||S.createElement(zv,{componentName:"Table"}),Dt=T?i4:n4,Rt={},vn=S.useMemo(()=>{const{fontSize:Je,lineHeight:dt,padding:st,paddingXS:vt,paddingSM:Kt}=Y,hn=Math.floor(Je*dt);switch(te){case"large":return st*2+hn;case"small":return vt*2+hn;default:return Kt*2+hn}},[Y,te]);return T&&(Rt.listItemHeight=vn),J(S.createElement("div",{ref:De,className:ze,style:Oe},S.createElement(p1,Object.assign({spinning:!1},Be),Yt,S.createElement(Dt,Object.assign({},Rt,z,{ref:ve,columns:M,direction:W,expandable:be,prefixCls:ee,className:ye({[`${ee}-middle`]:te==="middle",[`${ee}-small`]:te==="small",[`${ee}-bordered`]:c,[`${ee}-empty`]:re.length===0},oe,se,ue),data:un,rowKey:we,rowClassName:Gn,emptyText:qe,internalHooks:ru,internalRefs:ge,transformColumns:Tt,getContainerWidth:$e})),jt)))},S4=S.forwardRef(C4),I4=(t,e)=>{const n=S.useRef(0);return n.current+=1,S.createElement(S4,Object.assign({},t,{ref:e,_renderTimes:n.current}))},Zo=S.forwardRef(I4);Zo.SELECTION_COLUMN=or;Zo.EXPAND_COLUMN=rr;Zo.SELECTION_ALL=rg;Zo.SELECTION_INVERT=ag;Zo.SELECTION_NONE=lg;Zo.Column=nW;Zo.ColumnGroup=iW;Zo.Summary=p$;const Ad=6e4,Od=3e4,$4=1,Ww="competitions",ha="robots",kl="generations",rx="by-competition-start",E4="by-id",Gw="competitionStart",pg="id",N4="by-name",k4="by-score",Hw="name",D4="score",Uw="__DB-COMPETITIONS-SYNC",T4=v1(async()=>{const t=new nu,e=Dd(()=>QP(R4).pipe(eM(),Xr(n=>LP(lf(n),fF(Uw).pipe(Il(()=>n)),t.pipe(Il(()=>n))))),{resetDelay:Od,removeDelay:Ad});return{getCompetitionsStarts$:Dd(()=>e().pipe(Xr(n=>sa(_4(n)))),{resetDelay:Od,removeDelay:Ad}),getGenerations$:Dd(n=>e().pipe(Xr(i=>sa(A4(i,n)))),{normalize:([n])=>n,resetDelay:Od,removeDelay:Ad}),addGeneration$:(n,i)=>nI(e().pipe(Xr(s=>P4(s,n,i)),hF(Uw),iu(()=>t.next()))),getRobot$:Dd(n=>e().pipe(Xr(i=>sa(O4(i,n))),oI(1)),{normalize:([n])=>n,resetDelay:Od,removeDelay:Ad})}});async function R4(t){const e=Math.max(await gF(Ww)??0,$4);return mF(Ww,e,{async blocked(){await t(oh.Blocked)},async blocking(){await t(oh.Blocking)},async terminated(){await t(oh.Terminated)},upgrade(n,i){if(i<1){const s=n.createObjectStore(kl,{keyPath:[Gw,pg]});s.createIndex(rx,Gw),s.createIndex(E4,pg);const o=n.createObjectStore(ha,{keyPath:Hw});o.createIndex(N4,Hw),o.createIndex(k4,D4)}}})}async function _4(t){const n=t.transaction(kl,"readonly").objectStore(kl).index(rx);if(await n.count()===0)return[];let i=await n.openCursor(null,"prevunique");const s=[];for(;!Et(i);)s.push(i.key),i=await i.continue();return s}async function A4(t,e){const s=await t.transaction(kl,"readonly").objectStore(kl).index(rx).getAll(e),o=D1(s,pg),r=t.transaction(ha,"readonly"),a=new Set;for(const{robotNames:c}of o)for(const u of c)a.add(u);const l=new Map;for(const c of a){const u=await r.objectStore(ha).get(c);if(Et(u))throw new Error(`Robot "${c}" is not found`);l.set(c,u)}return o.map(({robotNames:c,id:u,maxScore:d})=>({id:u,maxScore:d,players:zO(c.map(f=>{const h=l.get(f);return{name:h.name,modelUrl:h.modelUrl,score:h.score}}),({score:f})=>-f)}))}function O4(t,e){return t.transaction(ha,"readonly").objectStore(ha).get(e)}async function P4(t,e,n){for(const i of n.players){const s=await t.get(ha,i.name);await t.put(ha,{type:"TensorFlow",name:i.name,modelUrl:i.modelUrl,score:Et(s)?i.score:Math.max(s.score,i.score)})}await t.put(kl,{competitionStart:e,id:n.id,maxScore:n.maxScore,robotNames:n.players.map(({name:i})=>i)})}class B${}class fr extends B${constructor(e,n,i){super(),this.viewId=e,this.groupId=n,this.panelId=i}}class Rc extends B${constructor(e,n){super(),this.viewId=e,this.paneId=n}}class Co{constructor(){}static getInstance(){return Co.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,n){n&&(this.data=e,this.proto=n)}}Co.INSTANCE=new Co;function bi(){const t=Co.getInstance();if(t.hasData(fr.prototype))return t.getData(fr.prototype)[0]}function pc(){const t=Co.getInstance();if(t.hasData(Rc.prototype))return t.getData(Rc.prototype)[0]}var ra;(function(t){t.any=(...e)=>n=>{const i=e.map(s=>s(n));return{dispose:()=>{i.forEach(s=>{s.dispose()})}}}})(ra||(ra={}));class ax{constructor(){this._defaultPrevented=!1}get defaultPrevented(){return this._defaultPrevented}preventDefault(){this._defaultPrevented=!0}}class M4{constructor(){this.events=new Map}get size(){return this.events.size}add(e,n){this.events.set(e,n)}delete(e){this.events.delete(e)}clear(){this.events.clear()}}class bh{static create(){var e;return new bh((e=new Error().stack)!==null&&e!==void 0?e:"")}constructor(e){this.value=e}print(){console.warn("dockview: stacktrace",this.value)}}class F4{constructor(e,n){this.callback=e,this.stacktrace=n}}class xe{static setLeakageMonitorEnabled(e){e!==xe.ENABLE_TRACKING&&xe.MEMORY_LEAK_WATCHER.clear(),xe.ENABLE_TRACKING=e}get value(){return this._last}constructor(e){this.options=e,this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>{var n;!((n=this.options)===null||n===void 0)&&n.replay&&this._last!==void 0&&e(this._last);const i=new F4(e,xe.ENABLE_TRACKING?bh.create():void 0);return this._listeners.push(i),{dispose:()=>{const s=this._listeners.indexOf(i);s>-1&&this._listeners.splice(s,1)}}},xe.ENABLE_TRACKING&&xe.MEMORY_LEAK_WATCHER.add(this._event,bh.create())),this._event}fire(e){this._last=e;for(const n of this._listeners)n.callback(e)}dispose(){this._disposed||(this._disposed=!0,this._listeners.length>0&&(xe.ENABLE_TRACKING&&queueMicrotask(()=>{var e;for(const n of this._listeners)console.warn("dockview: stacktrace",(e=n.stacktrace)===null||e===void 0?void 0:e.print())}),this._listeners=[]),xe.ENABLE_TRACKING&&this._event&&xe.MEMORY_LEAK_WATCHER.delete(this._event))}}xe.ENABLE_TRACKING=!1;xe.MEMORY_LEAK_WATCHER=new M4;function zo(t,e,n,i){return t.addEventListener(e,n,i),{dispose:()=>{t.removeEventListener(e,n,i)}}}function sn(t,e,n,i){return t.addEventListener(e,n,i),{dispose:()=>{t.removeEventListener(e,n,i)}}}class jw{constructor(){this._onFired=new xe,this._currentFireCount=0,this._queued=!1,this.onEvent=e=>{const n=this._currentFireCount;return this._onFired.event(()=>{this._currentFireCount>n&&e()})}}fire(){this._currentFireCount++,!this._queued&&(this._queued=!0,queueMicrotask(()=>{this._queued=!1,this._onFired.fire()}))}dispose(){this._onFired.dispose()}}var Oi;(function(t){t.NONE={dispose:()=>{}};function e(n){return{dispose:()=>{n()}}}t.from=e})(Oi||(Oi={}));class Nt{get isDisposed(){return this._isDisposed}constructor(...e){this._isDisposed=!1,this._disposables=e}addDisposables(...e){e.forEach(n=>this._disposables.push(n))}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach(e=>e.dispose()),this._disposables=[])}}class Xi{constructor(){this._disposable=Oi.NONE}set value(e){this._disposable&&this._disposable.dispose(),this._disposable=e}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=Oi.NONE)}}function lr(t,e,n={},i={},s,o){const r=typeof e=="string"?n[e]:void 0,a=typeof e=="string"?i[e]:void 0;if(r&&a)throw new Error(`Cannot create '${t}'. component '${e}' registered as both a component and frameworkComponent`);if(a){if(!s)throw new Error(`Cannot create '${t}' for framework component '${e}'. you must register a frameworkPanelWrapper to use framework components`);return s.createComponent(t,e,a)}if(!r)throw new Error(`Cannot create '${t}', no component '${e}' provided`);return new r(t,e)}function V$(t,e){const n=new ResizeObserver(i=>{requestAnimationFrame(()=>{const s=i[0];e(s)})});return n.observe(t),{dispose:()=>{n.unobserve(t),n.disconnect()}}}const zc=(t,...e)=>{for(const n of e)t.classList.contains(n)&&t.classList.remove(n)},xf=(t,...e)=>{for(const n of e)t.classList.contains(n)||t.classList.add(n)},gt=(t,e,n)=>{const i=t.classList.contains(e);n&&!i&&t.classList.add(e),!n&&i&&t.classList.remove(e)};function mg(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Kw(t){return Array.prototype.slice.call(document.getElementsByTagName(t),0)}function W$(t){return new L4(t)}class L4 extends Nt{constructor(e){super(),this._onDidFocus=new xe,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new xe,this.onDidBlur=this._onDidBlur.event,this.addDisposables(this._onDidFocus,this._onDidBlur);let n=mg(document.activeElement,e),i=!1;const s=()=>{i=!1,n||(n=!0,this._onDidFocus.fire())},o=()=>{n&&(i=!0,window.setTimeout(()=>{i&&(i=!1,n=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{mg(document.activeElement,e)!==n&&(n?o():s())},e instanceof HTMLElement?(this.addDisposables(sn(e,"focus",s,!0)),this.addDisposables(sn(e,"blur",o,!0))):(this.addDisposables(zo(e,"focus",s,!0)),this.addDisposables(zo(e,"blur",o,!0)))}refreshState(){this._refreshStateHandler()}}const G$="dv-quasiPreventDefault";function z4(t){t[G$]=!0}function Xw(t){return t[G$]}function B4(t,e){const n=Array.from(e);for(const i of n){if(i.href){const o=t.createElement("link");o.href=i.href,o.type=i.type,o.rel="stylesheet",t.head.appendChild(o)}let s=[];try{i.cssRules&&(s=Array.from(i.cssRules).map(o=>o.cssText))}catch{}for(const o of s){const r=t.createElement("style");r.appendChild(t.createTextNode(o)),t.head.appendChild(r)}}}function qw(t){const{left:e,top:n,width:i,height:s}=t.getBoundingClientRect();return{left:e+window.scrollX,top:n+window.scrollY,width:i,height:s}}function V4(t){let e=t;for(;e!=null&&e.parentNode;){if(e.parentNode===document)return!0;e.parentNode instanceof DocumentFragment?e=e.parentNode.host:e=e.parentNode}return!1}function W4(t,e){t.setAttribute("data-testid",e)}function yh(){const t=[...Kw("iframe"),...Kw("webview")],e=new WeakMap;for(const n of t)e.set(n,n.style.pointerEvents),n.style.pointerEvents="none";return{release:()=>{var n;for(const i of t)i.style.pointerEvents=(n=e.get(i))!==null&&n!==void 0?n:"auto";t.splice(0,t.length)}}}function Bo(t){if(t.length===0)throw new Error("Invalid tail call");return[t.slice(0,t.length-1),t[t.length-1]]}function G4(t){return t.length>0?t[t.length-1]:void 0}function H$(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function xm(t,e){const n=t.indexOf(e);n>-1&&(t.splice(n,1),t.unshift(e))}function Pd(t,e){const n=t.indexOf(e);n>-1&&(t.splice(n,1),t.push(e))}function H4(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(e(i))return n}return-1}function bm(t,e){const n=t.findIndex(i=>i===e);return n>-1?(t.splice(n,1),!0):!1}const fn=(t,e,n)=>e>n?e:Math.min(n,Math.max(t,e)),lx=()=>{let t=1;return{next:()=>(t++).toString()}},Ls=(t,e)=>{const n=[];if(typeof e!="number"&&(e=t,t=0),t<=e)for(let i=t;i<e;i++)n.push(i);else for(let i=t;i>e;i--)n.push(i);return n};class U4{set size(e){this._size=e}get size(){return this._size}get cachedVisibleSize(){return this._cachedVisibleSize}get visible(){return typeof this._cachedVisibleSize>"u"}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,n,i,s){this.container=e,this.view=n,this.disposable=s,this._cachedVisibleSize=void 0,typeof i=="number"?(this._size=i,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=i.cachedVisibleSize)}setVisible(e,n){var i;e!==this.visible&&(e?(this.size=fn((i=this._cachedVisibleSize)!==null&&i!==void 0?i:0,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof n=="number"?n:this.size,this.size=0),this.container.classList.toggle("visible",e),this.view.setVisible&&this.view.setVisible(e))}dispose(){return this.disposable.dispose(),this.view}}var ot;(function(t){t.HORIZONTAL="HORIZONTAL",t.VERTICAL="VERTICAL"})(ot||(ot={}));var bs;(function(t){t[t.MAXIMUM=0]="MAXIMUM",t[t.MINIMUM=1]="MINIMUM",t[t.DISABLED=2]="DISABLED",t[t.ENABLED=3]="ENABLED"})(bs||(bs={}));var Un;(function(t){t.Low="low",t.High="high",t.Normal="normal"})(Un||(Un={}));var is;(function(t){t.Distribute={type:"distribute"};function e(i){return{type:"split",index:i}}t.Split=e;function n(i){return{type:"invisible",cachedVisibleSize:i}}t.Invisible=n})(is||(is={}));class Bc{get contentSize(){return this._contentSize}get size(){return this._size}set size(e){this._size=e}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get length(){return this.viewItems.length}get proportions(){return this._proportions?[...this._proportions]:void 0}get orientation(){return this._orientation}set orientation(e){this._orientation=e;const n=this.size;this.size=this.orthogonalSize,this.orthogonalSize=n,zc(this.element,"horizontal","vertical"),this.element.classList.add(this.orientation==ot.HORIZONTAL?"horizontal":"vertical")}get minimumSize(){return this.viewItems.reduce((e,n)=>e+n.minimumSize,0)}get maximumSize(){return this.length===0?Number.POSITIVE_INFINITY:this.viewItems.reduce((e,n)=>e+n.maximumSize,0)}get startSnappingEnabled(){return this._startSnappingEnabled}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}get endSnappingEnabled(){return this._endSnappingEnabled}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}get disabled(){return this._disabled}set disabled(e){this._disabled=e,gt(this.element,"dv-splitview-disabled",e)}get margin(){return this._margin}set margin(e){this._margin=e}constructor(e,n){var i;this.container=e,this.viewItems=[],this.sashes=[],this._size=0,this._orthogonalSize=0,this._contentSize=0,this._proportions=void 0,this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this._disabled=!1,this._margin=0,this._onDidSashEnd=new xe,this.onDidSashEnd=this._onDidSashEnd.event,this._onDidAddView=new xe,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new xe,this.onDidRemoveView=this._onDidRemoveView.event,this.resize=(s,o,r=this.viewItems.map(h=>h.size),a,l,c=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d,f)=>{if(s<0||s>this.viewItems.length)return 0;const h=Ls(s,-1),p=Ls(s+1,this.viewItems.length);if(l)for(const R of l)xm(h,R),xm(p,R);if(a)for(const R of a)Pd(h,R),Pd(p,R);const m=h.map(R=>this.viewItems[R]),g=h.map(R=>r[R]),v=p.map(R=>this.viewItems[R]),x=p.map(R=>r[R]),b=h.reduce((R,T)=>R+this.viewItems[T].minimumSize-r[T],0),w=h.reduce((R,T)=>R+this.viewItems[T].maximumSize-r[T],0),y=p.length===0?Number.POSITIVE_INFINITY:p.reduce((R,T)=>R+r[T]-this.viewItems[T].minimumSize,0),C=p.length===0?Number.NEGATIVE_INFINITY:p.reduce((R,T)=>R+r[T]-this.viewItems[T].maximumSize,0),I=Math.max(b,C),$=Math.min(y,w);let E=!1;if(d){const R=this.viewItems[d.index],T=o>=d.limitDelta;E=T!==R.visible,R.setVisible(T,d.size)}if(!E&&f){const R=this.viewItems[f.index],T=o<f.limitDelta;E=T!==R.visible,R.setVisible(T,f.size)}if(E)return this.resize(s,o,r,a,l,c,u);const N=fn(o,I,$);let k=0,D=N;for(let R=0;R<m.length;R++){const T=m[R],A=fn(g[R]+D,T.minimumSize,T.maximumSize),O=A-g[R];k+=O,D-=O,T.size=A}let _=k;for(let R=0;R<v.length;R++){const T=v[R],A=fn(x[R]-_,T.minimumSize,T.maximumSize),O=A-x[R];_+=O,T.size=A}return o},this._orientation=n.orientation,this.element=this.createContainer(),this.margin=(i=n.margin)!==null&&i!==void 0?i:0,this.proportionalLayout=n.proportionalLayout===void 0?!0:!!n.proportionalLayout,this.viewContainer=this.createViewContainer(),this.sashContainer=this.createSashContainer(),this.element.appendChild(this.sashContainer),this.element.appendChild(this.viewContainer),this.container.appendChild(this.element),this.style(n.styles),n.descriptor&&(this._size=n.descriptor.size,n.descriptor.views.forEach((s,o)=>{const r=s.visible===void 0||s.visible?s.size:{type:"invisible",cachedVisibleSize:s.size},a=s.view;this.addView(a,r,o,!0)}),this._contentSize=this.viewItems.reduce((s,o)=>s+o.size,0),this.saveProportions())}style(e){(e==null?void 0:e.separatorBorder)==="transparent"?(zc(this.element,"separator-border"),this.element.style.removeProperty("--dv-separator-border")):(xf(this.element,"separator-border"),e!=null&&e.separatorBorder&&this.element.style.setProperty("--dv-separator-border",e.separatorBorder))}isViewVisible(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].visible}setViewVisible(e,n){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");const i=this.viewItems[e];i.setVisible(n,i.size),this.distributeEmptySpace(e),this.layoutViews(),this.saveProportions()}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}resizeView(e,n){if(e<0||e>=this.viewItems.length)return;const i=Ls(this.viewItems.length).filter(a=>a!==e),s=[...i.filter(a=>this.viewItems[a].priority===Un.Low),e],o=i.filter(a=>this.viewItems[a].priority===Un.High),r=this.viewItems[e];n=Math.round(n),n=fn(n,r.minimumSize,Math.min(r.maximumSize,this._size)),r.size=n,this.relayout(s,o)}getViews(){return this.viewItems.map(e=>e.view)}onDidChange(e,n){const i=this.viewItems.indexOf(e);if(i<0||i>=this.viewItems.length)return;n=typeof n=="number"?n:e.size,n=fn(n,e.minimumSize,e.maximumSize),e.size=n;const s=Ls(this.viewItems.length).filter(a=>a!==i),o=[...s.filter(a=>this.viewItems[a].priority===Un.Low),i],r=s.filter(a=>this.viewItems[a].priority===Un.High);this.relayout([...o,i],r)}addView(e,n={type:"distribute"},i=this.viewItems.length,s){const o=document.createElement("div");o.className="view",o.appendChild(e.element);let r;typeof n=="number"?r=n:n.type==="split"?r=this.getViewSize(n.index)/2:n.type==="invisible"?r={cachedVisibleSize:n.cachedVisibleSize}:r=e.minimumSize;const a=e.onDidChange(c=>this.onDidChange(l,c.size)),l=new U4(o,e,r,{dispose:()=>{a.dispose(),this.viewContainer.removeChild(o)}});if(i===this.viewItems.length?this.viewContainer.appendChild(o):this.viewContainer.insertBefore(o,this.viewContainer.children.item(i)),this.viewItems.splice(i,0,l),this.viewItems.length>1){const c=document.createElement("div");c.className="sash";const u=f=>{for(const T of this.viewItems)T.enabled=!1;const h=yh(),p=this._orientation===ot.HORIZONTAL?f.clientX:f.clientY,m=H4(this.sashes,T=>T.container===c),g=this.viewItems.map(T=>T.size);let v,x;const b=Ls(m,-1),w=Ls(m+1,this.viewItems.length),y=b.reduce((T,A)=>T+(this.viewItems[A].minimumSize-g[A]),0),C=b.reduce((T,A)=>T+(this.viewItems[A].viewMaximumSize-g[A]),0),I=w.length===0?Number.POSITIVE_INFINITY:w.reduce((T,A)=>T+(g[A]-this.viewItems[A].minimumSize),0),$=w.length===0?Number.NEGATIVE_INFINITY:w.reduce((T,A)=>T+(g[A]-this.viewItems[A].viewMaximumSize),0),E=Math.max(y,$),N=Math.min(I,C),k=this.findFirstSnapIndex(b),D=this.findFirstSnapIndex(w);if(typeof k=="number"){const T=this.viewItems[k],A=Math.floor(T.viewMinimumSize/2);v={index:k,limitDelta:T.visible?E-A:E+A,size:T.size}}if(typeof D=="number"){const T=this.viewItems[D],A=Math.floor(T.viewMinimumSize/2);x={index:D,limitDelta:T.visible?N+A:N-A,size:T.size}}const _=T=>{const O=(this._orientation===ot.HORIZONTAL?T.clientX:T.clientY)-p;this.resize(m,O,g,void 0,void 0,E,N,v,x),this.distributeEmptySpace(),this.layoutViews()},R=()=>{for(const T of this.viewItems)T.enabled=!0;h.release(),this.saveProportions(),document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",R),document.removeEventListener("pointercancel",R),this._onDidSashEnd.fire(void 0)};document.addEventListener("pointermove",_),document.addEventListener("pointerup",R),document.addEventListener("pointercancel",R)};c.addEventListener("pointerdown",u);const d={container:c,disposable:()=>{c.removeEventListener("pointerdown",u),this.sashContainer.removeChild(c)}};this.sashContainer.appendChild(c),this.sashes.push(d)}s||this.relayout([i]),!s&&typeof n!="number"&&n.type==="distribute"&&this.distributeViewSizes(),this._onDidAddView.fire(e)}distributeViewSizes(){const e=[];let n=0;for(const a of this.viewItems)a.maximumSize-a.minimumSize>0&&(e.push(a),n+=a.size);const i=Math.floor(n/e.length);for(const a of e)a.size=fn(i,a.minimumSize,a.maximumSize);const s=Ls(this.viewItems.length),o=s.filter(a=>this.viewItems[a].priority===Un.Low),r=s.filter(a=>this.viewItems[a].priority===Un.High);this.relayout(o,r)}removeView(e,n,i=!1){const s=this.viewItems.splice(e,1)[0];if(s.dispose(),this.viewItems.length>=1){const o=Math.max(e-1,0);this.sashes.splice(o,1)[0].disposable()}return i||this.relayout(),n&&n.type==="distribute"&&this.distributeViewSizes(),this._onDidRemoveView.fire(s.view),s.view}getViewCachedVisibleSize(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].cachedVisibleSize}moveView(e,n){const i=this.getViewCachedVisibleSize(e),s=typeof i>"u"?this.getViewSize(e):is.Invisible(i),o=this.removeView(e,void 0,!0);this.addView(o,s,n)}layout(e,n){const i=Math.max(this.size,this._contentSize);if(this.size=e,this.orthogonalSize=n,this.proportions){let s=0;for(let o=0;o<this.viewItems.length;o++){const r=this.viewItems[o],a=this.proportions[o];typeof a=="number"?s+=a:e-=r.size}for(let o=0;o<this.viewItems.length;o++){const r=this.viewItems[o],a=this.proportions[o];typeof a=="number"&&s>0&&(r.size=fn(Math.round(a*e/s),r.minimumSize,r.maximumSize))}}else{const s=Ls(this.viewItems.length),o=s.filter(a=>this.viewItems[a].priority===Un.Low),r=s.filter(a=>this.viewItems[a].priority===Un.High);this.resize(this.viewItems.length-1,e-i,void 0,o,r)}this.distributeEmptySpace(),this.layoutViews()}relayout(e,n){const i=this.viewItems.reduce((s,o)=>s+o.size,0);this.resize(this.viewItems.length-1,this._size-i,void 0,e,n),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}distributeEmptySpace(e){const n=this.viewItems.reduce((a,l)=>a+l.size,0);let i=this.size-n;const s=Ls(this.viewItems.length-1,-1),o=s.filter(a=>this.viewItems[a].priority===Un.Low),r=s.filter(a=>this.viewItems[a].priority===Un.High);for(const a of r)xm(s,a);for(const a of o)Pd(s,a);typeof e=="number"&&Pd(s,e);for(let a=0;i!==0&&a<s.length;a++){const l=this.viewItems[s[a]],c=fn(l.size+i,l.minimumSize,l.maximumSize),u=c-l.size;i-=u,l.size=c}}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this._proportions=this.viewItems.map(e=>e.visible?e.size/this._contentSize:void 0))}layoutViews(){if(this._contentSize=this.viewItems.reduce((l,c)=>l+c.size,0),this.updateSashEnablement(),this.viewItems.length===0)return;const e=this.viewItems.filter(l=>l.visible),n=Math.max(0,e.length-1),i=this.margin*n/Math.max(1,e.length);let s=0;const o=[],r=4,a=this.viewItems.reduce((l,c,u)=>{const d=c.visible?1:0;return u===0?l.push(d):l.push(l[u-1]+d),l},[]);this.viewItems.forEach((l,c)=>{s+=this.viewItems[c].size,o.push(s);const u=l.visible?l.size-i:0,d=Math.max(0,a[c]-1),f=c===0||d===0?0:o[c-1]+d/n*i;if(c<this.viewItems.length-1){const h=l.visible?f+u-r/2+this.margin/2:f;this._orientation===ot.HORIZONTAL&&(this.sashes[c].container.style.left=`${h}px`,this.sashes[c].container.style.top="0px"),this._orientation===ot.VERTICAL&&(this.sashes[c].container.style.left="0px",this.sashes[c].container.style.top=`${h}px`)}this._orientation===ot.HORIZONTAL&&(l.container.style.width=`${u}px`,l.container.style.left=`${f}px`,l.container.style.top="",l.container.style.height=""),this._orientation===ot.VERTICAL&&(l.container.style.height=`${u}px`,l.container.style.top=`${f}px`,l.container.style.width="",l.container.style.left=""),l.view.layout(l.size-i,this._orthogonalSize)})}findFirstSnapIndex(e){for(const n of e){const i=this.viewItems[n];if(i.visible&&i.snap)return n}for(const n of e){const i=this.viewItems[n];if(i.visible&&i.maximumSize-i.minimumSize>0)return;if(!i.visible&&i.snap)return n}}updateSashEnablement(){let e=!1;const n=this.viewItems.map(l=>e=l.size-l.minimumSize>0||e);e=!1;const i=this.viewItems.map(l=>e=l.maximumSize-l.size>0||e),s=[...this.viewItems].reverse();e=!1;const o=s.map(l=>e=l.size-l.minimumSize>0||e).reverse();e=!1;const r=s.map(l=>e=l.maximumSize-l.size>0||e).reverse();let a=0;for(let l=0;l<this.sashes.length;l++){const c=this.sashes[l],u=this.viewItems[l];a+=u.size;const d=!(n[l]&&r[l+1]),f=!(i[l]&&o[l+1]);if(d&&f){const h=Ls(l,-1),p=Ls(l+1,this.viewItems.length),m=this.findFirstSnapIndex(h),g=this.findFirstSnapIndex(p),v=typeof m=="number"&&!this.viewItems[m].visible,x=typeof g=="number"&&!this.viewItems[g].visible;v&&o[l]&&(a>0||this.startSnappingEnabled)?this.updateSash(c,bs.MINIMUM):x&&n[l]&&(a<this._contentSize||this.endSnappingEnabled)?this.updateSash(c,bs.MAXIMUM):this.updateSash(c,bs.DISABLED)}else d&&!f?this.updateSash(c,bs.MINIMUM):!d&&f?this.updateSash(c,bs.MAXIMUM):this.updateSash(c,bs.ENABLED)}}updateSash(e,n){gt(e.container,"disabled",n===bs.DISABLED),gt(e.container,"enabled",n===bs.ENABLED),gt(e.container,"maximum",n===bs.MAXIMUM),gt(e.container,"minimum",n===bs.MINIMUM)}createViewContainer(){const e=document.createElement("div");return e.className="view-container",e}createSashContainer(){const e=document.createElement("div");return e.className="sash-container",e}createContainer(){const e=document.createElement("div"),n=this._orientation===ot.HORIZONTAL?"horizontal":"vertical";return e.className=`split-view-container ${n}`,e}dispose(){this._onDidSashEnd.dispose(),this._onDidAddView.dispose(),this._onDidRemoveView.dispose();for(let e=0;e<this.element.children.length;e++)if(this.element.children.item(e)===this.element){this.element.removeChild(this.element);break}for(const e of this.viewItems)e.dispose();this.element.remove()}}class Yw extends Nt{get onDidAddView(){return this.splitview.onDidAddView}get onDidRemoveView(){return this.splitview.onDidRemoveView}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get orientation(){return this.splitview.orientation}get size(){return this.splitview.size}get orthogonalSize(){return this.splitview.orthogonalSize}constructor(e,n){var i;super(),this.paneItems=[],this.skipAnimation=!1,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._orientation=(i=n.orientation)!==null&&i!==void 0?i:ot.VERTICAL,this.element=document.createElement("div"),this.element.className="pane-container",e.appendChild(this.element),this.splitview=new Bc(this.element,{orientation:this._orientation,proportionalLayout:!1,descriptor:n.descriptor}),this.getPanes().forEach(s=>{const o=new Nt(s.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)})),r={pane:s,disposable:{dispose:()=>{o.dispose()}}};this.paneItems.push(r),s.orthogonalSize=this.splitview.orthogonalSize}),this.addDisposables(this._onDidChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire(void 0)}),this.splitview.onDidAddView(()=>{this._onDidChange.fire()}),this.splitview.onDidRemoveView(()=>{this._onDidChange.fire()}))}setViewVisible(e,n){this.splitview.setViewVisible(e,n)}addPane(e,n,i=this.splitview.length,s=!1){const o=e.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)}),r={pane:e,disposable:{dispose:()=>{o.dispose()}}};this.paneItems.splice(i,0,r),e.orthogonalSize=this.splitview.orthogonalSize,this.splitview.addView(e,n,i,s)}getViewSize(e){return this.splitview.getViewSize(e)}getPanes(){return this.splitview.getViews()}removePane(e,n={skipDispose:!1}){const i=this.paneItems.splice(e,1)[0];return this.splitview.removeView(e),n.skipDispose||(i.disposable.dispose(),i.pane.dispose()),i}moveView(e,n){if(e===n)return;const i=this.removePane(e,{skipDispose:!0});this.skipAnimation=!0;try{this.addPane(i.pane,i.pane.size,n,!1)}finally{this.skipAnimation=!1}}layout(e,n){this.splitview.layout(e,n)}setupAnimation(){this.skipAnimation||(this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),xf(this.element,"animated"),this.animationTimer=setTimeout(()=>{this.animationTimer=void 0,zc(this.element,"animated")},200))}dispose(){super.dispose(),this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),this.paneItems.forEach(e=>{e.disposable.dispose(),e.pane.dispose()}),this.paneItems=[],this.splitview.dispose(),this.element.remove()}}class Ti{get minimumWidth(){return this.view.minimumWidth}get maximumWidth(){return this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get priority(){return this.view.priority}get snap(){return this.view.snap}get minimumSize(){return this.orientation===ot.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===ot.HORIZONTAL?this.maximumHeight:this.maximumWidth}get minimumOrthogonalSize(){return this.orientation===ot.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===ot.HORIZONTAL?this.maximumWidth:this.maximumHeight}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get element(){return this.view.element}get width(){return this.orientation===ot.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===ot.HORIZONTAL?this.size:this.orthogonalSize}constructor(e,n,i,s=0){this.view=e,this.orientation=n,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._orthogonalSize=i,this._size=s,this._disposable=this.view.onDidChange(o=>{o?this._onDidChange.fire({size:this.orientation===ot.VERTICAL?o.width:o.height,orthogonalSize:this.orientation===ot.VERTICAL?o.height:o.width}):this._onDidChange.fire({})})}setVisible(e){this.view.setVisible&&this.view.setVisible(e)}layout(e,n){this._size=e,this._orthogonalSize=n,this.view.layout(this.width,this.height)}dispose(){this._onDidChange.dispose(),this._disposable.dispose()}}class On extends Nt{get width(){return this.orientation===ot.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===ot.HORIZONTAL?this.orthogonalSize:this.size}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((e,n)=>this.splitview.isViewVisible(n)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,n)=>this.splitview.isViewVisible(n)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get minimumWidth(){return this.orientation===ot.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===ot.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===ot.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===ot.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get priority(){if(this.children.length===0)return Un.Normal;const e=this.children.map(n=>typeof n.priority>"u"?Un.Normal:n.priority);return e.some(n=>n===Un.High)?Un.High:e.some(n=>n===Un.Low)?Un.Low:Un.Normal}get disabled(){return this.splitview.disabled}set disabled(e){this.splitview.disabled=e}get margin(){return this.splitview.margin}set margin(e){this.splitview.margin=e,this.children.forEach(n=>{n instanceof On&&(n.margin=e)})}constructor(e,n,i,s,o,r,a,l){if(super(),this.orientation=e,this.proportionalLayout=n,this.styles=i,this._childrenDisposable=Oi.NONE,this.children=[],this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new xe,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._orthogonalSize=o,this._size=s,this.element=document.createElement("div"),this.element.className="branch-node",!l)this.splitview=new Bc(this.element,{orientation:this.orientation,proportionalLayout:n,styles:i,margin:a}),this.splitview.layout(this.size,this.orthogonalSize);else{const c={views:l.map(u=>({view:u.node,size:u.node.size,visible:u.node instanceof Ti&&u.visible!==void 0?u.visible:!0})),size:this.orthogonalSize};this.children=l.map(u=>u.node),this.splitview=new Bc(this.element,{orientation:this.orientation,descriptor:c,proportionalLayout:n,styles:i,margin:a})}this.disabled=r,this.addDisposables(this._onDidChange,this._onDidVisibilityChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire({})})),this.setupChildrenEvents()}setVisible(e){}isChildVisible(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.isViewVisible(e)}setChildVisible(e,n){if(e<0||e>=this.children.length)throw new Error("Invalid index");if(this.splitview.isViewVisible(e)===n)return;const i=this.splitview.contentSize===0;this.splitview.setViewVisible(e,n);const s=this.splitview.contentSize===0;(n&&i||!n&&s)&&this._onDidVisibilityChange.fire({visible:n})}moveChild(e,n){if(e===n)return;if(e<0||e>=this.children.length)throw new Error("Invalid from index");e<n&&n--,this.splitview.moveView(e,n);const i=this._removeChild(e);this._addChild(i,n)}getChildSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewSize(e)}resizeChild(e,n){if(e<0||e>=this.children.length)throw new Error("Invalid index");this.splitview.resizeView(e,n)}layout(e,n){this._size=n,this._orthogonalSize=e,this.splitview.layout(n,e)}addChild(e,n,i,s){if(i<0||i>this.children.length)throw new Error("Invalid index");this.splitview.addView(e,n,i,s),this._addChild(e,i)}getChildCachedVisibleSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewCachedVisibleSize(e)}removeChild(e,n){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.removeView(e,n),this._removeChild(e)}_addChild(e,n){this.children.splice(n,0,e),this.setupChildrenEvents()}_removeChild(e){const[n]=this.children.splice(e,1);return this.setupChildrenEvents(),n}setupChildrenEvents(){this._childrenDisposable.dispose(),this._childrenDisposable=new Nt(ra.any(...this.children.map(e=>e.onDidChange))(e=>{this._onDidChange.fire({size:e.orthogonalSize})}),...this.children.map((e,n)=>e instanceof On?e.onDidVisibilityChange(({visible:i})=>{this.setChildVisible(n,i)}):Oi.NONE))}dispose(){this._childrenDisposable.dispose(),this.splitview.dispose(),this.children.forEach(e=>e.dispose()),super.dispose()}}function gg(t,e){if(t instanceof Ti)return t;if(t instanceof On)return gg(t.children[e?t.children.length-1:0],e);throw new Error("invalid node")}function vg(t,e,n){if(t instanceof On){const i=new On(Mo(t.orientation),t.proportionalLayout,t.styles,e,n,t.disabled,t.margin);let s=0;for(let o=t.children.length-1;o>=0;o--){const r=t.children[o],a=r instanceof On?r.orthogonalSize:r.size;let l=t.size===0?0:Math.round(e*a/t.size);s+=l,o===0&&(l+=e-s),i.addChild(vg(r,n,l),l,0,!0)}return i}else return new Ti(t.view,Mo(t.orientation),n)}function j4(t){const e=t.parentElement;if(!e)throw new Error("Invalid grid element");let n=e.firstElementChild,i=0;for(;n!==t&&n!==e.lastElementChild&&n;)n=n.nextElementSibling,i++;return i}function bn(t){const e=t.parentElement;if(!e)throw new Error("Invalid grid element");if(/\bgrid-view\b/.test(e.className))return[];const n=j4(e),i=e.parentElement.parentElement.parentElement;return[...bn(i),n]}function ro(t,e,n){const i=X4(t,e),s=K4(n);if(i===s){const[o,r]=Bo(e);let a=r;return(n==="right"||n==="bottom")&&(a+=1),[...o,a]}else{const o=n==="right"||n==="bottom"?1:0;return[...e,o]}}function K4(t){return t==="top"||t==="bottom"?ot.VERTICAL:ot.HORIZONTAL}function X4(t,e){return e.length%2===0?Mo(t):t}const Mo=t=>t===ot.HORIZONTAL?ot.VERTICAL:ot.HORIZONTAL;function q4(t){return!!t.children}const U$=(t,e)=>{const n=e===ot.VERTICAL?t.box.width:t.box.height;return q4(t)?{type:"branch",data:t.children.map(i=>U$(i,Mo(e))),size:n}:typeof t.cachedVisibleSize=="number"?{type:"leaf",data:t.view.toJSON(),size:t.cachedVisibleSize,visible:!1}:{type:"leaf",data:t.view.toJSON(),size:n}};class Y4{get length(){return this._root?this._root.children.length:0}get orientation(){return this.root.orientation}set orientation(e){if(this.root.orientation===e)return;const{size:n,orthogonalSize:i}=this.root;this.root=vg(this.root,i,n),this.root.layout(n,i)}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get locked(){return this._locked}set locked(e){this._locked=e;const n=[this.root];for(;n.length>0;){const i=n.pop();i instanceof On&&(i.disabled=e,n.push(...i.children))}}get margin(){return this._margin}set margin(e){this._margin=e,this.root.margin=e}maximizedView(){var e;return(e=this._maximizedNode)===null||e===void 0?void 0:e.leaf.view}hasMaximizedView(){return this._maximizedNode!==void 0}maximizeView(e){var n;const i=bn(e.element),[s,o]=this.getNode(i);if(!(o instanceof Ti)||((n=this._maximizedNode)===null||n===void 0?void 0:n.leaf)===o)return;this.hasMaximizedView()&&this.exitMaximizedView();const r=[];function a(l,c){for(let u=0;u<l.children.length;u++){const d=l.children[u];d instanceof Ti?d!==c&&(l.isChildVisible(u)?l.setChildVisible(u,!1):r.push(d)):a(d,c)}}a(this.root,o),this._maximizedNode={leaf:o,hiddenOnMaximize:r},this._onDidMaximizedNodeChange.fire()}exitMaximizedView(){if(!this._maximizedNode)return;const e=this._maximizedNode.hiddenOnMaximize;function n(i){for(let s=i.children.length-1;s>=0;s--){const o=i.children[s];o instanceof Ti?e.includes(o)||i.setChildVisible(s,!0):n(o)}}n(this.root),this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire()}serialize(){return this.hasMaximizedView()&&this.exitMaximizedView(),{root:U$(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation}}dispose(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()}clear(){const e=this.root.orientation;this.root=new On(e,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)}deserialize(e,n){const i=e.orientation,s=i===ot.VERTICAL?e.height:e.width;this._deserialize(e.root,i,n,s)}_deserialize(e,n,i,s){this.root=this._deserializeNode(e,n,i,s)}_deserializeNode(e,n,i,s){var o;let r;if(e.type==="branch"){const l=e.data.map(c=>({node:this._deserializeNode(c,Mo(n),i,e.size),visible:c.visible}));r=new On(n,this.proportionalLayout,this.styles,e.size,s,this.locked,this.margin,l)}else{const a=i.fromJSON(e);typeof e.visible=="boolean"&&((o=a.setVisible)===null||o===void 0||o.call(a,e.visible)),r=new Ti(a,n,s,e.size)}return r}get root(){return this._root}set root(e){const n=this._root;n&&(n.dispose(),this._maximizedNode=void 0,this.element.removeChild(n.element)),this._root=e,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(i=>{this._onDidChange.fire(i)})}insertOrthogonalSplitviewAtRoot(){if(!this._root)return;const e=this.root;if(e.element.remove(),this._root=new On(Mo(e.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),e.children.length!==0)if(e.children.length===1){const n=e.children[0];e.removeChild(0).dispose(),e.dispose(),this._root.addChild(vg(n,n.orthogonalSize,n.size),is.Distribute,0)}else this._root.addChild(e,is.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(n=>{this._onDidChange.fire(n)})}next(e){return this.progmaticSelect(e)}previous(e){return this.progmaticSelect(e,!0)}getView(e){const n=e?this.getNode(e)[1]:this.root;return this._getViews(n,this.orientation)}_getViews(e,n,i){const s={height:e.height,width:e.width};if(e instanceof Ti)return{box:s,view:e.view,cachedVisibleSize:i};const o=[];for(let r=0;r<e.children.length;r++){const a=e.children[r],l=e.getChildCachedVisibleSize(r);o.push(this._getViews(a,Mo(n),l))}return{box:s,children:o}}progmaticSelect(e,n=!1){const[i,s]=this.getNode(e);if(!(s instanceof Ti))throw new Error("invalid location");for(let o=i.length-1;o>-1;o--){const r=i[o],a=e[o]||0;if(n?a-1>-1:a+1<r.children.length)return gg(r.children[n?a-1:a+1],n)}return gg(this.root,n)}constructor(e,n,i,s,o){this.proportionalLayout=e,this.styles=n,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new Xi,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new xe,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new xe,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="grid-view",this._locked=s??!1,this._margin=o??0,this.root=new On(i,e,n,0,0,this.locked,this.margin)}isViewVisible(e){const[n,i]=Bo(e),[,s]=this.getNode(n);if(!(s instanceof On))throw new Error("Invalid from location");return s.isChildVisible(i)}setViewVisible(e,n){this.hasMaximizedView()&&this.exitMaximizedView();const[i,s]=Bo(e),[,o]=this.getNode(i);if(!(o instanceof On))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),o.setChildVisible(s,n)}moveView(e,n,i){this.hasMaximizedView()&&this.exitMaximizedView();const[,s]=this.getNode(e);if(!(s instanceof On))throw new Error("Invalid location");s.moveChild(n,i)}addView(e,n,i){this.hasMaximizedView()&&this.exitMaximizedView();const[s,o]=Bo(i),[r,a]=this.getNode(s);if(a instanceof On){const l=new Ti(e,Mo(a.orientation),a.orthogonalSize);a.addChild(l,n,o)}else{const[l,...c]=[...r].reverse(),[u,...d]=[...s].reverse();let f=0;const h=l.getChildCachedVisibleSize(u);typeof h=="number"&&(f=is.Invisible(h)),l.removeChild(u).dispose();const m=new On(a.orientation,this.proportionalLayout,this.styles,a.size,a.orthogonalSize,this.locked,this.margin);l.addChild(m,a.size,u);const g=new Ti(a.view,l.orientation,a.size);m.addChild(g,f,0),typeof n!="number"&&n.type==="split"&&(n={type:"split",index:0});const v=new Ti(e,l.orientation,a.size);m.addChild(v,n,o)}}remove(e,n){const i=bn(e.element);return this.removeView(i,n)}removeView(e,n){this.hasMaximizedView()&&this.exitMaximizedView();const[i,s]=Bo(e),[o,r]=this.getNode(i);if(!(r instanceof On))throw new Error("Invalid location");const a=r.children[s];if(!(a instanceof Ti))throw new Error("Invalid location");if(r.removeChild(s,n),a.dispose(),r.children.length!==1)return a.view;const l=r.children[0];if(o.length===0)return l instanceof Ti||(r.removeChild(0,n),this.root=l),a.view;const[c,...u]=[...o].reverse(),[d,...f]=[...i].reverse(),h=r.isChildVisible(0);r.removeChild(0,n);const p=c.children.map((m,g)=>c.getChildSize(g));if(c.removeChild(d,n).dispose(),l instanceof On){p.splice(d,1,...l.children.map(m=>m.size));for(let m=0;m<l.children.length;m++){const g=l.children[m];c.addChild(g,g.size,d+m)}for(;l.children.length>0;)l.removeChild(0)}else{const m=new Ti(l.view,Mo(l.orientation),l.size),g=h?l.orthogonalSize:is.Invisible(l.orthogonalSize);c.addChild(m,g,d)}l.dispose();for(let m=0;m<p.length;m++)c.resizeChild(m,p[m]);return a.view}layout(e,n){const[i,s]=this.root.orientation===ot.HORIZONTAL?[n,e]:[e,n];this.root.layout(i,s)}getNode(e,n=this.root,i=[]){if(e.length===0)return[i,n];if(!(n instanceof On))throw new Error("Invalid location");const[s,...o]=e;if(s<0||s>=n.children.length)throw new Error("Invalid location");const r=n.children[s];return i.push(n),this.getNode(o,r,i)}}class cx extends Nt{get element(){return this._element}get disableResizing(){return this._disableResizing}set disableResizing(e){this._disableResizing=e}constructor(e,n=!1){super(),this._disableResizing=n,this._element=e,this.addDisposables(V$(this._element,i=>{if(this.isDisposed||this.disableResizing||!this._element.offsetParent||!V4(this._element))return;const{width:s,height:o}=i.contentRect;this.layout(s,o)}))}}const J4=lx();function wh(t){switch(t){case"left":return"left";case"right":return"right";case"above":return"top";case"below":return"bottom";case"within":default:return"center"}}class j$ extends cx{get id(){return this._id}get size(){return this._groups.size}get groups(){return Array.from(this._groups.values()).map(e=>e.value)}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumHeight(){return this.gridview.minimumHeight}get maximumHeight(){return this.gridview.maximumHeight}get minimumWidth(){return this.gridview.minimumWidth}get maximumWidth(){return this.gridview.maximumWidth}get activeGroup(){return this._activeGroup}get locked(){return this.gridview.locked}set locked(e){this.gridview.locked=e}constructor(e){var n,i;super(document.createElement("div"),e.disableAutoResizing),this._id=J4.next(),this._groups=new Map,this._onDidRemove=new xe,this.onDidRemove=this._onDidRemove.event,this._onDidAdd=new xe,this.onDidAdd=this._onDidAdd.event,this._onDidActiveChange=new xe,this.onDidActiveChange=this._onDidActiveChange.event,this._bufferOnDidLayoutChange=new jw,this.onDidLayoutChange=this._bufferOnDidLayoutChange.onEvent,this._onDidViewVisibilityChangeMicroTaskQueue=new jw,this.onDidViewVisibilityChangeMicroTaskQueue=this._onDidViewVisibilityChangeMicroTaskQueue.onEvent,this.classNames=[],this.element.style.height="100%",this.element.style.width="100%",this.classNames=(i=(n=e.className)===null||n===void 0?void 0:n.split(" "))!==null&&i!==void 0?i:[];for(const s of this.classNames)gt(this.element,s,!0);e.parentElement.appendChild(this.element),this.gridview=new Y4(!!e.proportionalLayout,e.styles,e.orientation,e.locked,e.margin),this.gridview.locked=!!e.locked,this.element.appendChild(this.gridview.element),this.layout(0,0,!0),this.addDisposables(this.gridview.onDidViewVisibilityChange(()=>this._onDidViewVisibilityChangeMicroTaskQueue.fire()),this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.layout(this.width,this.height,!0)}),Oi.from(()=>{var s;(s=this.element.parentElement)===null||s===void 0||s.removeChild(this.element)}),this.gridview.onDidChange(()=>{this._bufferOnDidLayoutChange.fire()}),ra.any(this.onDidAdd,this.onDidRemove,this.onDidActiveChange)(()=>{this._bufferOnDidLayoutChange.fire()}),this._bufferOnDidLayoutChange)}setVisible(e,n){this.gridview.setViewVisible(bn(e.element),n),this._bufferOnDidLayoutChange.fire()}isVisible(e){return this.gridview.isViewVisible(bn(e.element))}updateOptions(e){var n,i;if("className"in e){for(const s of this.classNames)gt(this.element,s,!1);this.classNames=(i=(n=e.className)===null||n===void 0?void 0:n.split(" "))!==null&&i!==void 0?i:[];for(const s of this.classNames)gt(this.element,s,!0)}}maximizeGroup(e){this.gridview.maximizeView(e),this.doSetGroupActive(e)}isMaximizedGroup(e){return this.gridview.maximizedView()===e}exitMaximizedGroup(){this.gridview.exitMaximizedView()}hasMaximizedGroup(){return this.gridview.hasMaximizedView()}get onDidMaximizedGroupChange(){return this.gridview.onDidMaximizedNodeChange}doAddGroup(e,n=[0],i){this.gridview.addView(e,i??is.Distribute,n),this._onDidAdd.fire(e)}doRemoveGroup(e,n){if(!this._groups.has(e.id))throw new Error("invalid operation");const i=this._groups.get(e.id),s=this.gridview.remove(e,is.Distribute);if(i&&!(n!=null&&n.skipDispose)&&(i.disposable.dispose(),i.value.dispose(),this._groups.delete(e.id),this._onDidRemove.fire(e)),!(n!=null&&n.skipActive)&&this._activeGroup===e){const o=Array.from(this._groups.values());this.doSetGroupActive(o.length>0?o[0].value:void 0)}return s}getPanel(e){var n;return(n=this._groups.get(e))===null||n===void 0?void 0:n.value}doSetGroupActive(e){this._activeGroup!==e&&(this._activeGroup&&this._activeGroup.setActive(!1),e&&e.setActive(!0),this._activeGroup=e,this._onDidActiveChange.fire(e))}removeGroup(e){this.doRemoveGroup(e)}moveToNext(e){var n;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=bn(e.group.element),s=(n=this.gridview.next(i))===null||n===void 0?void 0:n.view;this.doSetGroupActive(s)}moveToPrevious(e){var n;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=bn(e.group.element),s=(n=this.gridview.previous(i))===null||n===void 0?void 0:n.view;this.doSetGroupActive(s)}layout(e,n,i){(i||e!==this.width||n!==this.height)&&(this.gridview.element.style.height=`${n}px`,this.gridview.element.style.width=`${e}px`,this.gridview.layout(e,n))}dispose(){this._onDidActiveChange.dispose(),this._onDidAdd.dispose(),this._onDidRemove.dispose();for(const e of this.groups)e.dispose();this.gridview.dispose(),super.dispose()}}class K${get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get length(){return this.component.length}get orientation(){return this.component.orientation}get panels(){return this.component.panels}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}constructor(e){this.component=e}removePanel(e,n){this.component.removePanel(e,n)}focus(){this.component.focus()}getPanel(e){return this.component.getPanel(e)}layout(e,n){return this.component.layout(e,n)}addPanel(e){return this.component.addPanel(e)}movePanel(e,n){this.component.movePanel(e,n)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class Vc{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get panels(){return this.component.panels}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}get onDidDrop(){const e=new xe,n=this.component.onDidDrop(i=>{e.fire(Object.assign(Object.assign({},i),{api:this}))});return e.dispose=()=>{n.dispose(),e.dispose()},e.event}constructor(e){this.component=e}removePanel(e){this.component.removePanel(e)}getPanel(e){return this.component.getPanel(e)}movePanel(e,n){this.component.movePanel(e,n)}focus(){this.component.focus()}layout(e,n){this.component.layout(e,n)}addPanel(e){return this.component.addPanel(e)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class X${get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddPanel(){return this.component.onDidAddGroup}get onDidRemovePanel(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActiveGroupChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get panels(){return this.component.groups}get orientation(){return this.component.orientation}set orientation(e){this.component.updateOptions({orientation:e})}constructor(e){this.component=e}focus(){this.component.focus()}layout(e,n,i=!1){this.component.layout(e,n,i)}addPanel(e){return this.component.addPanel(e)}removePanel(e,n){this.component.removePanel(e,n)}movePanel(e,n){this.component.movePanel(e,n)}getPanel(e){return this.component.getPanel(e)}fromJSON(e){return this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class Ch{get id(){return this.component.id}get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get size(){return this.component.size}get totalPanels(){return this.component.totalPanels}get gap(){return this.component.gap}get onDidActiveGroupChange(){return this.component.onDidActiveGroupChange}get onDidAddGroup(){return this.component.onDidAddGroup}get onDidRemoveGroup(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActivePanelChange}get onDidAddPanel(){return this.component.onDidAddPanel}get onDidRemovePanel(){return this.component.onDidRemovePanel}get onDidMovePanel(){return this.component.onDidMovePanel}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidDrop(){return this.component.onDidDrop}get onWillDrop(){return this.component.onWillDrop}get onWillShowOverlay(){return this.component.onWillShowOverlay}get onWillDragGroup(){return this.component.onWillDragGroup}get onWillDragPanel(){return this.component.onWillDragPanel}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}get panels(){return this.component.panels}get groups(){return this.component.groups}get activePanel(){return this.component.activePanel}get activeGroup(){return this.component.activeGroup}constructor(e){this.component=e}focus(){this.component.focus()}getPanel(e){return this.component.getGroupPanel(e)}layout(e,n,i=!1){this.component.layout(e,n,i)}addPanel(e){return this.component.addPanel(e)}removePanel(e){this.component.removePanel(e)}addGroup(e){return this.component.addGroup(e)}closeAllGroups(){return this.component.closeAllGroups()}removeGroup(e){this.component.removeGroup(e)}getGroup(e){return this.component.getPanel(e)}addFloatingGroup(e,n){return this.component.addFloatingGroup(e,n)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}moveToNext(e){this.component.moveToNext(e)}moveToPrevious(e){this.component.moveToPrevious(e)}maximizeGroup(e){this.component.maximizeGroup(e.group)}hasMaximizedGroup(){return this.component.hasMaximizedGroup()}exitMaximizedGroup(){this.component.exitMaximizedGroup()}get onDidMaximizedGroupChange(){return this.component.onDidMaximizedGroupChange}addPopoutGroup(e,n){return this.component.addPopoutGroup(e,n)}setGap(e){this.component.updateOptions({gap:e})}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class ux extends Nt{constructor(e){super(),this.el=e,this.dataDisposable=new Xi,this.pointerEventsDisposable=new Xi,this._onDragStart=new xe,this.onDragStart=this._onDragStart.event,this.addDisposables(this._onDragStart,this.dataDisposable,this.pointerEventsDisposable),this.configure()}isCancelled(e){return!1}configure(){this.addDisposables(this._onDragStart,sn(this.el,"dragstart",e=>{if(e.defaultPrevented||this.isCancelled(e)){e.preventDefault();return}const n=yh();this.pointerEventsDisposable.value={dispose:()=>{n.release()}},this.el.classList.add("dv-dragged"),setTimeout(()=>this.el.classList.remove("dv-dragged"),0),this.dataDisposable.value=this.getData(e),this._onDragStart.fire(e),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.items.length>0||e.dataTransfer.setData("text/plain","__dockview_internal_drag_event__"))}),sn(this.el,"dragend",()=>{this.pointerEventsDisposable.dispose(),this.dataDisposable.dispose()}))}}class q$ extends Nt{constructor(e,n){super(),this.element=e,this.callbacks=n,this.target=null,this.registerListeners()}onDragEnter(e){this.target=e.target,this.callbacks.onDragEnter(e)}onDragOver(e){e.preventDefault(),this.callbacks.onDragOver&&this.callbacks.onDragOver(e)}onDragLeave(e){this.target===e.target&&(this.target=null,this.callbacks.onDragLeave(e))}onDragEnd(e){this.target=null,this.callbacks.onDragEnd(e)}onDrop(e){this.callbacks.onDrop(e)}registerListeners(){this.addDisposables(sn(this.element,"dragenter",e=>{this.onDragEnter(e)},!0)),this.addDisposables(sn(this.element,"dragover",e=>{this.onDragOver(e)},!0)),this.addDisposables(sn(this.element,"dragleave",e=>{this.onDragLeave(e)})),this.addDisposables(sn(this.element,"dragend",e=>{this.onDragEnd(e)})),this.addDisposables(sn(this.element,"drop",e=>{this.onDrop(e)}))}}class Z4 extends ax{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}constructor(e){super(),this.options=e}}function Jw(t){switch(t){case"above":return"top";case"below":return"bottom";case"left":return"left";case"right":return"right";case"within":return"center";default:throw new Error(`invalid direction '${t}'`)}}function Q4(t){switch(t){case"top":return"above";case"bottom":return"below";case"left":return"left";case"right":return"right";case"center":return"within";default:throw new Error(`invalid position '${t}'`)}}const eG={value:20,type:"percentage"},tG={value:50,type:"percentage"},nG=100,iG=100;class Uo extends Nt{get state(){return this._state}constructor(e,n){super(),this.element=e,this.options=n,this._onDrop=new xe,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._acceptedTargetZonesSet=new Set(this.options.acceptedTargetZones),this.dnd=new q$(this.element,{onDragEnter:()=>{},onDragOver:i=>{if(this._acceptedTargetZonesSet.size===0){this.removeDropTarget();return}const s=this.element.clientWidth,o=this.element.clientHeight;if(s===0||o===0)return;const r=i.currentTarget.getBoundingClientRect(),a=i.clientX-r.left,l=i.clientY-r.top,c=this.calculateQuadrant(this._acceptedTargetZonesSet,a,l,s,o);if(this.isAlreadyUsed(i)||c===null){this.removeDropTarget();return}if(!this.options.canDisplayOverlay(i,c)){this.removeDropTarget();return}const u=new Z4({nativeEvent:i,position:c});if(this._onWillShowOverlay.fire(u),u.defaultPrevented){this.removeDropTarget();return}this.markAsUsed(i),this.targetElement||(this.targetElement=document.createElement("div"),this.targetElement.className="drop-target-dropzone",this.overlayElement=document.createElement("div"),this.overlayElement.className="drop-target-selection",this._state="center",this.targetElement.appendChild(this.overlayElement),this.element.classList.add("drop-target"),this.element.append(this.targetElement)),this.toggleClasses(c,s,o),this._state=c},onDragLeave:()=>{this.removeDropTarget()},onDragEnd:()=>{this.removeDropTarget()},onDrop:i=>{i.preventDefault();const s=this._state;this.removeDropTarget(),s&&(i.stopPropagation(),this._onDrop.fire({position:s,nativeEvent:i}))}}),this.addDisposables(this._onDrop,this._onWillShowOverlay,this.dnd)}setTargetZones(e){this._acceptedTargetZonesSet=new Set(e)}setOverlayModel(e){this.options.overlayModel=e}dispose(){this.removeDropTarget(),super.dispose()}markAsUsed(e){e[Uo.USED_EVENT_ID]=!0}isAlreadyUsed(e){const n=e[Uo.USED_EVENT_ID];return typeof n=="boolean"&&n}toggleClasses(e,n,i){var s,o;if(!this.overlayElement)return;const r=n<nG,a=i<iG,l=e==="left",c=e==="right",u=e==="top",d=e==="bottom",f=!r&&c,h=!r&&l,p=!a&&u,m=!a&&d;let g=1;const v=(o=(s=this.options.overlayModel)===null||s===void 0?void 0:s.size)!==null&&o!==void 0?o:tG;v.type==="percentage"?g=fn(v.value,0,100)/100:((f||h)&&(g=fn(0,v.value,n)/n),(p||m)&&(g=fn(0,v.value,i)/i));const x={top:"0px",left:"0px",width:"100%",height:"100%"};f?(x.left=`${100*(1-g)}%`,x.width=`${100*g}%`):h?x.width=`${100*g}%`:p?x.height=`${100*g}%`:m&&(x.top=`${100*(1-g)}%`,x.height=`${100*g}%`),this.overlayElement.style.top=x.top,this.overlayElement.style.left=x.left,this.overlayElement.style.width=x.width,this.overlayElement.style.height=x.height,gt(this.overlayElement,"dv-drop-target-small-vertical",a),gt(this.overlayElement,"dv-drop-target-small-horizontal",r),gt(this.overlayElement,"dv-drop-target-left",l),gt(this.overlayElement,"dv-drop-target-right",c),gt(this.overlayElement,"dv-drop-target-top",u),gt(this.overlayElement,"dv-drop-target-bottom",d),gt(this.overlayElement,"dv-drop-target-center",e==="center")}calculateQuadrant(e,n,i,s,o){var r,a;const l=(a=(r=this.options.overlayModel)===null||r===void 0?void 0:r.activationSize)!==null&&a!==void 0?a:eG;return l.type==="percentage"?sG(e,n,i,s,o,l.value):oG(e,n,i,s,o,l.value)}removeDropTarget(){this.targetElement&&(this._state=void 0,this.element.removeChild(this.targetElement),this.targetElement=void 0,this.overlayElement=void 0,this.element.classList.remove("drop-target"))}}Uo.USED_EVENT_ID="__dockview_droptarget_event_is_used__";function sG(t,e,n,i,s,o){const r=100*e/i,a=100*n/s;return t.has("left")&&r<o?"left":t.has("right")&&r>100-o?"right":t.has("top")&&a<o?"top":t.has("bottom")&&a>100-o?"bottom":t.has("center")?"center":null}function oG(t,e,n,i,s,o){return t.has("left")&&e<o?"left":t.has("right")&&e>i-o?"right":t.has("top")&&n<o?"top":t.has("bottom")&&n>s-o?"bottom":t.has("center")?"center":null}class Y$ extends ax{constructor(){super()}}class J$ extends Nt{get isFocused(){return this._isFocused}get isActive(){return this._isActive}get isVisible(){return this._isVisible}get width(){return this._width}get height(){return this._height}constructor(e,n){super(),this.id=e,this.component=n,this._isFocused=!1,this._isActive=!1,this._isVisible=!0,this._width=0,this._height=0,this._parameters={},this.panelUpdatesDisposable=new Xi,this._onDidDimensionChange=new xe,this.onDidDimensionsChange=this._onDidDimensionChange.event,this._onDidChangeFocus=new xe,this.onDidFocusChange=this._onDidChangeFocus.event,this._onWillFocus=new xe,this.onWillFocus=this._onWillFocus.event,this._onDidVisibilityChange=new xe,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onWillVisibilityChange=new xe,this.onWillVisibilityChange=this._onWillVisibilityChange.event,this._onDidActiveChange=new xe,this.onDidActiveChange=this._onDidActiveChange.event,this._onActiveChange=new xe,this.onActiveChange=this._onActiveChange.event,this._onDidParametersChange=new xe,this.onDidParametersChange=this._onDidParametersChange.event,this.addDisposables(this.onDidFocusChange(i=>{this._isFocused=i.isFocused}),this.onDidActiveChange(i=>{this._isActive=i.isActive}),this.onDidVisibilityChange(i=>{this._isVisible=i.isVisible}),this.onDidDimensionsChange(i=>{this._width=i.width,this._height=i.height}),this.panelUpdatesDisposable,this._onDidDimensionChange,this._onDidChangeFocus,this._onDidVisibilityChange,this._onDidActiveChange,this._onWillFocus,this._onActiveChange,this._onWillFocus,this._onWillVisibilityChange,this._onDidParametersChange)}getParameters(){return this._parameters}initialize(e){this.panelUpdatesDisposable.value=this._onDidParametersChange.event(n=>{this._parameters=n,e.update({params:n})})}setVisible(e){this._onWillVisibilityChange.fire({isVisible:e})}setActive(){this._onActiveChange.fire()}updateParameters(e){this._onDidParametersChange.fire(e)}}class Z$ extends J${constructor(e,n){super(e,n),this._onDidConstraintsChangeInternal=new xe,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new xe({replay:!0}),this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new xe,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class rG extends Z${set pane(e){this._pane=e}constructor(e,n){super(e,n),this._onDidExpansionChange=new xe({replay:!0}),this.onDidExpansionChange=this._onDidExpansionChange.event,this._onMouseEnter=new xe({}),this.onMouseEnter=this._onMouseEnter.event,this._onMouseLeave=new xe({}),this.onMouseLeave=this._onMouseLeave.event,this.addDisposables(this._onDidExpansionChange,this._onMouseEnter,this._onMouseLeave)}setExpanded(e){var n;(n=this._pane)===null||n===void 0||n.setExpanded(e)}get isExpanded(){var e;return!!(!((e=this._pane)===null||e===void 0)&&e.isExpanded())}}class dx extends Nt{get element(){return this._element}get width(){return this._width}get height(){return this._height}get params(){var e;return(e=this._params)===null||e===void 0?void 0:e.params}constructor(e,n,i){super(),this.id=e,this.component=n,this.api=i,this._height=0,this._width=0,this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.style.outline="none",this._element.style.height="100%",this._element.style.width="100%",this._element.style.overflow="hidden";const s=W$(this._element);this.addDisposables(this.api,s.onDidFocus(()=>{this.api._onDidChangeFocus.fire({isFocused:!0})}),s.onDidBlur(()=>{this.api._onDidChangeFocus.fire({isFocused:!1})}),s)}focus(){const e=new Y$;this.api._onWillFocus.fire(e),!e.defaultPrevented&&this._element.focus()}layout(e,n){this._width=e,this._height=n,this.api._onDidDimensionChange.fire({width:e,height:n}),this.part&&this._params&&this.part.update(this._params.params)}init(e){this._params=e,this.part=this.getComponent()}update(e){var n,i;this._params=Object.assign(Object.assign({},this._params),{params:Object.assign(Object.assign({},(n=this._params)===null||n===void 0?void 0:n.params),e.params)});for(const s of Object.keys(e.params))e.params[s]===void 0&&delete this._params.params[s];(i=this.part)===null||i===void 0||i.update({params:this._params.params})}toJSON(){var e,n;const i=(n=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&n!==void 0?n:{};return{id:this.id,component:this.component,params:Object.keys(i).length>0?i:void 0}}dispose(){var e;this.api.dispose(),(e=this.part)===null||e===void 0||e.dispose(),super.dispose()}}class aG extends dx{set orientation(e){this._orientation=e}get orientation(){return this._orientation}get minimumSize(){const e=this.headerSize,i=this.isExpanded()?this._minimumBodySize:0;return e+i}get maximumSize(){const e=this.headerSize,i=this.isExpanded()?this._maximumBodySize:0;return e+i}get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(e){this._minimumBodySize=typeof e=="number"?e:0}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(e){this._maximumBodySize=typeof e=="number"?e:Number.POSITIVE_INFINITY}get headerVisible(){return this._headerVisible}set headerVisible(e){this._headerVisible=e,this.header.style.display=e?"":"none"}constructor(e,n,i,s,o,r){super(e,n,new rG(e,n)),this.headerComponent=i,this._onDidChangeExpansionState=new xe({replay:!0}),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this.headerSize=22,this._orthogonalSize=0,this._size=0,this._minimumBodySize=100,this._maximumBodySize=Number.POSITIVE_INFINITY,this._isExpanded=!1,this.expandedSize=0,this.api.pane=this,this.api.initialize(this),this._isExpanded=o,this._headerVisible=r,this._onDidChangeExpansionState.fire(this.isExpanded()),this._orientation=s,this.element.classList.add("pane"),this.addDisposables(this.api.onWillVisibilityChange(a=>{const{isVisible:l}=a,{accessor:c}=this._params;c.setVisible(this,l)}),this.api.onDidSizeChange(a=>{this._onDidChange.fire({size:a.size})}),sn(this.element,"mouseenter",a=>{this.api._onMouseEnter.fire(a)}),sn(this.element,"mouseleave",a=>{this.api._onMouseLeave.fire(a)})),this.addDisposables(this._onDidChangeExpansionState,this.onDidChangeExpansionState(a=>{this.api._onDidExpansionChange.fire({isExpanded:a})}),this.api.onDidFocusChange(a=>{this.header&&(a.isFocused?xf(this.header,"focused"):zc(this.header,"focused"))})),this.renderOnce()}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}isExpanded(){return this._isExpanded}setExpanded(e){this._isExpanded!==e&&(this._isExpanded=e,e?(this.animationTimer&&clearTimeout(this.animationTimer),this.body&&this.element.appendChild(this.body)):this.animationTimer=setTimeout(()=>{var n;(n=this.body)===null||n===void 0||n.remove()},200),this._onDidChange.fire(e?{size:this.width}:{}),this._onDidChangeExpansionState.fire(e))}layout(e,n){this._size=e,this._orthogonalSize=n;const[i,s]=this.orientation===ot.HORIZONTAL?[e,n]:[n,e];this.isExpanded()&&(this.expandedSize=i),super.layout(i,s)}init(e){var n,i;super.init(e),typeof e.minimumBodySize=="number"&&(this.minimumBodySize=e.minimumBodySize),typeof e.maximumBodySize=="number"&&(this.maximumBodySize=e.maximumBodySize),this.bodyPart=this.getBodyComponent(),this.headerPart=this.getHeaderComponent(),this.bodyPart.init(Object.assign(Object.assign({},e),{api:this.api})),this.headerPart.init(Object.assign(Object.assign({},e),{api:this.api})),(n=this.body)===null||n===void 0||n.append(this.bodyPart.element),(i=this.header)===null||i===void 0||i.append(this.headerPart.element),typeof e.isExpanded=="boolean"&&this.setExpanded(e.isExpanded)}toJSON(){const e=this._params;return Object.assign(Object.assign({},super.toJSON()),{headerComponent:this.headerComponent,title:e.title})}renderOnce(){this.header=document.createElement("div"),this.header.tabIndex=0,this.header.className="pane-header",this.header.style.height=`${this.headerSize}px`,this.header.style.lineHeight=`${this.headerSize}px`,this.header.style.minHeight=`${this.headerSize}px`,this.header.style.maxHeight=`${this.headerSize}px`,this.element.appendChild(this.header),this.body=document.createElement("div"),this.body.className="pane-body",this.element.appendChild(this.body)}getComponent(){return{update:e=>{var n,i;(n=this.bodyPart)===null||n===void 0||n.update({params:e}),(i=this.headerPart)===null||i===void 0||i.update({params:e})},dispose:()=>{var e,n;(e=this.bodyPart)===null||e===void 0||e.dispose(),(n=this.headerPart)===null||n===void 0||n.dispose()}}}}class lG extends aG{constructor(e,n,i,s,o,r,a){super(n,i,s,o,r,!0),this.accessor=e,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,a||this.initDragFeatures()}initDragFeatures(){if(!this.header)return;const e=this.id,n=this.accessor.id;this.header.draggable=!0,this.handler=new class extends ux{getData(){return Co.getInstance().setData([new Rc(n,e)],Rc.prototype),{dispose:()=>{Co.getInstance().clearData(Rc.prototype)}}}}(this.header),this.target=new Uo(this.element,{acceptedTargetZones:["top","bottom"],overlayModel:{activationSize:{type:"percentage",value:50}},canDisplayOverlay:i=>{const s=pc();return s&&s.paneId!==this.id&&s.viewId===this.accessor.id?!0:this.accessor.options.showDndOverlay?this.accessor.options.showDndOverlay({nativeEvent:i,getData:pc,panel:this}):!1}}),this.addDisposables(this._onDidDrop,this.handler,this.target,this.target.onDrop(i=>{this.onDrop(i)}))}onDrop(e){const n=pc();if(!n||n.viewId!==this.accessor.id){this._onDidDrop.fire(Object.assign(Object.assign({},e),{panel:this,api:new Vc(this.accessor),getData:pc}));return}const i=this._params.containerApi,s=n.paneId,o=i.getPanel(s);if(!o){this._onDidDrop.fire(Object.assign(Object.assign({},e),{panel:this,getData:pc,api:new Vc(this.accessor)}));return}const r=i.panels,a=r.indexOf(o);let l=i.panels.indexOf(this);(e.position==="left"||e.position==="top")&&(l=Math.max(0,l-1)),(e.position==="right"||e.position==="bottom")&&(a>l&&l++,l=Math.min(r.length-1,l)),i.movePanel(a,l)}}class cG extends Nt{get element(){return this._element}constructor(e,n){super(),this.accessor=e,this.group=n,this.disposable=new Xi,this._onDidFocus=new xe,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new xe,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="content-container",this._element.tabIndex=-1,this.addDisposables(this._onDidFocus,this._onDidBlur),this.dropTarget=new Uo(this.element,{acceptedTargetZones:["top","bottom","left","right","center"],canDisplayOverlay:(i,s)=>{if(this.group.locked==="no-drop-target"||this.group.locked&&s==="center")return!1;const o=bi();return!o&&i.shiftKey&&this.group.location.type!=="floating"?!1:o&&o.viewId===this.accessor.id?o.groupId===this.group.id&&(s==="center"||o.panelId===null)?!1:!(this.group.panels.length===1&&o.groupId===this.group.id):this.group.canDisplayOverlay(i,s,"content")}}),this.addDisposables(this.dropTarget)}show(){this.element.style.display=""}hide(){this.element.style.display="none"}renderPanel(e,n={asActive:!0}){const i=n.asActive||this.panel&&this.group.isPanelActive(this.panel);this.panel&&this.panel.view.content.element.parentElement===this._element&&this._element.removeChild(this.panel.view.content.element),this.panel=e;let s;switch(e.api.renderer){case"onlyWhenVisible":this.group.renderContainer.detatch(e),this.panel&&i&&this._element.appendChild(this.panel.view.content.element),s=this._element;break;case"always":e.view.content.element.parentElement===this._element&&this._element.removeChild(e.view.content.element),s=this.group.renderContainer.attach({panel:e,referenceContainer:this});break}if(i){const o=W$(s),r=new Nt;r.addDisposables(o,o.onDidFocus(()=>this._onDidFocus.fire()),o.onDidBlur(()=>this._onDidBlur.fire())),this.disposable.value=r}}openPanel(e){this.panel!==e&&this.renderPanel(e)}layout(e,n){}closePanel(){var e;this.panel&&this.panel.api.renderer==="onlyWhenVisible"&&((e=this.panel.view.content.element.parentElement)===null||e===void 0||e.removeChild(this.panel.view.content.element)),this.panel=void 0}dispose(){this.disposable.dispose(),super.dispose()}}class uG extends ux{constructor(e,n,i,s){super(e),this.accessor=n,this.group=i,this.panel=s,this.panelTransfer=Co.getInstance()}getData(e){return this.panelTransfer.setData([new fr(this.accessor.id,this.group.id,this.panel.id)],fr.prototype),{dispose:()=>{this.panelTransfer.clearData(fr.prototype)}}}}class dG extends Nt{get element(){return this._element}constructor(e,n,i){super(),this.panel=e,this.accessor=n,this.group=i,this.content=void 0,this._onChanged=new xe,this.onChanged=this._onChanged.event,this._onDropped=new xe,this.onDrop=this._onDropped.event,this._onDragStart=new xe,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="tab",this._element.tabIndex=0,this._element.draggable=!0,gt(this.element,"inactive-tab",!0);const s=new uG(this._element,this.accessor,this.group,this.panel);this.dropTarget=new Uo(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(o,r)=>{if(this.group.locked)return!1;const a=bi();return a&&this.accessor.id===a.viewId?a.panelId===null&&a.groupId===this.group.id?!1:this.panel.id!==a.panelId:this.group.model.canDisplayOverlay(o,r,"tab")}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this._onChanged,this._onDropped,this._onDragStart,s.onDragStart(o=>{this._onDragStart.fire(o)}),s,sn(this._element,"mousedown",o=>{o.defaultPrevented||this._onChanged.fire(o)}),this.dropTarget.onDrop(o=>{this._onDropped.fire(o)}),this.dropTarget)}setActive(e){gt(this.element,"active-tab",e),gt(this.element,"inactive-tab",!e)}setContent(e){this.content&&this._element.removeChild(this.content.element),this.content=e,this._element.appendChild(this.content.element)}dispose(){super.dispose()}}function hG(t,e){xf(e,"dv-dragged"),document.body.appendChild(e),t.setDragImage(e,0,0),setTimeout(()=>{zc(e,"dv-dragged"),e.remove()},0)}class fG extends ux{constructor(e,n,i){super(e),this.accessor=n,this.group=i,this.panelTransfer=Co.getInstance(),this.addDisposables(sn(e,"mousedown",s=>{s.shiftKey&&z4(s)},!0))}isCancelled(e){return this.group.api.location.type==="floating"&&!e.shiftKey}getData(e){const n=e.dataTransfer;this.panelTransfer.setData([new fr(this.accessor.id,this.group.id,null)],fr.prototype);const i=window.getComputedStyle(this.el),s=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-background-color"),o=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-color");if(n){const r=document.createElement("div");r.style.backgroundColor=s,r.style.color=o,r.style.padding="2px 8px",r.style.height="24px",r.style.fontSize="11px",r.style.lineHeight="20px",r.style.borderRadius="12px",r.style.position="absolute",r.textContent=`Multiple Panels (${this.group.size})`,hG(n,r)}return{dispose:()=>{this.panelTransfer.clearData(fr.prototype)}}}}class pG extends Nt{get element(){return this._element}constructor(e,n){super(),this.accessor=e,this.group=n,this._onDrop=new xe,this.onDrop=this._onDrop.event,this._onDragStart=new xe,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="void-container",this._element.tabIndex=0,this._element.draggable=!0,this.addDisposables(this._onDrop,this._onDragStart,sn(this._element,"pointerdown",()=>{this.accessor.doSetGroupActive(this.group)}));const i=new fG(this._element,e,n);this.dropTraget=new Uo(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(s,o)=>{var r;const a=bi();return a&&this.accessor.id===a.viewId?a.panelId===null&&a.groupId===this.group.id?!1:((r=G4(this.group.panels))===null||r===void 0?void 0:r.id)!==a.panelId:n.model.canDisplayOverlay(s,o,"header_space")}}),this.onWillShowOverlay=this.dropTraget.onWillShowOverlay,this.addDisposables(i,i.onDragStart(s=>{this._onDragStart.fire(s)}),this.dropTraget.onDrop(s=>{this._onDrop.fire(s)}),this.dropTraget)}}class mG extends Nt{get panels(){return this.tabs.map(e=>e.value.panel.id)}get size(){return this.tabs.length}get hidden(){return this._hidden}set hidden(e){this._hidden=e,this.element.style.display=e?"none":""}show(){this.hidden||(this.element.style.display="")}hide(){this._element.style.display="none"}setRightActionsElement(e){this.rightActions!==e&&(this.rightActions&&(this.rightActions.remove(),this.rightActions=void 0),e&&(this.rightActionsContainer.appendChild(e),this.rightActions=e))}setLeftActionsElement(e){this.leftActions!==e&&(this.leftActions&&(this.leftActions.remove(),this.leftActions=void 0),e&&(this.leftActionsContainer.appendChild(e),this.leftActions=e))}setPrefixActionsElement(e){this.preActions!==e&&(this.preActions&&(this.preActions.remove(),this.preActions=void 0),e&&(this.preActionsContainer.appendChild(e),this.preActions=e))}get element(){return this._element}isActive(e){return this.selectedIndex>-1&&this.tabs[this.selectedIndex].value===e}indexOf(e){return this.tabs.findIndex(n=>n.value.panel.id===e)}constructor(e,n){super(),this.accessor=e,this.group=n,this.tabs=[],this.selectedIndex=-1,this._hidden=!1,this._onDrop=new xe,this.onDrop=this._onDrop.event,this._onTabDragStart=new xe,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new xe,this.onGroupDragStart=this._onGroupDragStart.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._element=document.createElement("div"),this._element.className="tabs-and-actions-container",gt(this._element,"dv-full-width-single-tab",this.accessor.options.singleTabMode==="fullwidth"),this.rightActionsContainer=document.createElement("div"),this.rightActionsContainer.className="right-actions-container",this.leftActionsContainer=document.createElement("div"),this.leftActionsContainer.className="left-actions-container",this.preActionsContainer=document.createElement("div"),this.preActionsContainer.className="pre-actions-container",this.tabContainer=document.createElement("div"),this.tabContainer.className="tabs-container",this.voidContainer=new pG(this.accessor,this.group),this._element.appendChild(this.preActionsContainer),this._element.appendChild(this.tabContainer),this._element.appendChild(this.leftActionsContainer),this._element.appendChild(this.voidContainer.element),this._element.appendChild(this.rightActionsContainer),this.addDisposables(this.accessor.onDidAddPanel(i=>{i.api.group===this.group&&gt(this._element,"dv-single-tab",this.size===1)}),this.accessor.onDidRemovePanel(i=>{i.api.group===this.group&&gt(this._element,"dv-single-tab",this.size===1)}),this._onWillShowOverlay,this._onDrop,this._onTabDragStart,this._onGroupDragStart,this.voidContainer,this.voidContainer.onDragStart(i=>{this._onGroupDragStart.fire({nativeEvent:i,group:this.group})}),this.voidContainer.onDrop(i=>{this._onDrop.fire({event:i.nativeEvent,index:this.tabs.length})}),this.voidContainer.onWillShowOverlay(i=>{this._onWillShowOverlay.fire(new Sh(i,{kind:"header_space",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:bi}))}),sn(this.voidContainer.element,"mousedown",i=>{if(!this.accessor.options.disableFloatingGroups&&i.shiftKey&&this.group.api.location.type!=="floating"){i.preventDefault();const{top:o,left:r}=this.element.getBoundingClientRect(),{top:a,left:l}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(this.group,{x:r-l+20,y:o-a+20,inDragMode:!0})}}),sn(this.tabContainer,"mousedown",i=>{if(i.defaultPrevented)return;i.button===0&&this.accessor.doSetGroupActive(this.group)}))}setActive(e){}addTab(e,n=this.tabs.length){if(n<0||n>this.tabs.length)throw new Error("invalid location");this.tabContainer.insertBefore(e.value.element,this.tabContainer.children[n]),this.tabs=[...this.tabs.slice(0,n),e,...this.tabs.slice(n)],this.selectedIndex<0&&(this.selectedIndex=n)}delete(e){const n=this.tabs.findIndex(r=>r.value.panel.id===e),i=this.tabs.splice(n,1)[0],{value:s,disposable:o}=i;o.dispose(),s.dispose(),s.element.remove()}setActivePanel(e){this.tabs.forEach(n=>{const i=e.id===n.value.panel.id;n.value.setActive(i)})}openPanel(e,n=this.tabs.length){var i;if(this.tabs.find(a=>a.value.panel.id===e.id))return;const s=new dG(e,this.accessor,this.group);if(!(!((i=e.view)===null||i===void 0)&&i.tab))throw new Error("invalid header component");s.setContent(e.view.tab);const o=new Nt(s.onDragStart(a=>{this._onTabDragStart.fire({nativeEvent:a,panel:e})}),s.onChanged(a=>{const l=!this.accessor.options.disableFloatingGroups,c=this.group.api.location.type==="floating"&&this.size===1;if(l&&!c&&a.shiftKey){a.preventDefault();const d=this.accessor.getGroupPanel(s.panel.id),{top:f,left:h}=s.element.getBoundingClientRect(),{top:p,left:m}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(d,{x:h-m,y:f-p,inDragMode:!0});return}!(a.button===0)||a.defaultPrevented||this.group.activePanel!==e&&this.group.model.openPanel(e)}),s.onDrop(a=>{this._onDrop.fire({event:a.nativeEvent,index:this.tabs.findIndex(l=>l.value===s)})}),s.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(new Sh(a,{kind:"tab",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:bi}))})),r={value:s,disposable:o};this.addTab(r,n)}closePanel(e){this.delete(e.id)}dispose(){super.dispose();for(const{value:e,disposable:n}of this.tabs)n.dispose(),e.dispose();this.tabs=[]}}class Q${get isAccepted(){return this._isAccepted}constructor(e,n,i,s,o){this.nativeEvent=e,this.target=n,this.position=i,this.getData=s,this.group=o,this._isAccepted=!1}accept(){this._isAccepted=!0}}const xg=Object.keys({disableAutoResizing:void 0,hideBorders:void 0,singleTabMode:void 0,disableFloatingGroups:void 0,floatingGroupBounds:void 0,popoutUrl:void 0,defaultRenderer:void 0,debug:void 0,rootOverlayModel:void 0,locked:void 0,disableDnd:void 0,gap:void 0,className:void 0});function gG(t){return!!t.referencePanel}function vG(t){return!!t.referenceGroup}function xG(t){return!!t.referencePanel}function bG(t){return!!t.referenceGroup}class hx extends ax{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}get panel(){return this.options.panel}get group(){return this.options.group}get api(){return this.options.api}constructor(e){super(),this.options=e}getData(){return this.options.getData()}}class eE extends hx{get kind(){return this._kind}constructor(e){super(e),this._kind=e.kind}}class Sh{get kind(){return this.options.kind}get nativeEvent(){return this.event.nativeEvent}get position(){return this.event.position}get defaultPrevented(){return this.event.defaultPrevented}get panel(){return this.options.panel}get api(){return this.options.api}get group(){return this.options.group}preventDefault(){this.event.preventDefault()}getData(){return this.options.getData()}constructor(e,n){this.event=e,this.options=n}}class yG extends Nt{get element(){throw new Error("not supported")}get activePanel(){return this._activePanel}get locked(){return this._locked}set locked(e){this._locked=e,gt(this.container,"locked-groupview",e==="no-drop-target"||e)}get isActive(){return this._isGroupActive}get panels(){return this._panels}get size(){return this._panels.length}get isEmpty(){return this._panels.length===0}get hasWatermark(){return!!(this.watermark&&this.container.contains(this.watermark.element))}get header(){return this.tabsContainer}get isContentFocused(){return document.activeElement?mg(document.activeElement,this.contentContainer.element):!1}get location(){return this._location}set location(e){switch(this._location=e,gt(this.container,"dv-groupview-floating",!1),gt(this.container,"dv-groupview-popout",!1),e.type){case"grid":this.contentContainer.dropTarget.setTargetZones(["top","bottom","left","right","center"]);break;case"floating":this.contentContainer.dropTarget.setTargetZones(["center"]),this.contentContainer.dropTarget.setTargetZones(e?["center"]:["top","bottom","left","right","center"]),gt(this.container,"dv-groupview-floating",!0);break;case"popout":this.contentContainer.dropTarget.setTargetZones(["center"]),gt(this.container,"dv-groupview-popout",!0);break}this.groupPanel.api._onDidLocationChange.fire({location:this.location})}constructor(e,n,i,s,o){var r;super(),this.container=e,this.accessor=n,this.id=i,this.options=s,this.groupPanel=o,this._isGroupActive=!1,this._locked=!1,this._location={type:"grid"},this.mostRecentlyUsed=[],this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._width=0,this._height=0,this._panels=[],this._panelDisposables=new Map,this._onMove=new xe,this.onMove=this._onMove.event,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new xe,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onTabDragStart=new xe,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new xe,this.onGroupDragStart=this._onGroupDragStart.event,this._onDidAddPanel=new xe,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPanelTitleChange=new xe,this.onDidPanelTitleChange=this._onDidPanelTitleChange.event,this._onDidPanelParametersChange=new xe,this.onDidPanelParametersChange=this._onDidPanelParametersChange.event,this._onDidRemovePanel=new xe,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidActivePanelChange=new xe,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onUnhandledDragOverEvent=new xe,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._overwriteRenderContainer=null,gt(this.container,"groupview",!0),this._api=new Ch(this.accessor),this.tabsContainer=new mG(this.accessor,this.groupPanel),this.contentContainer=new cG(this.accessor,this),e.append(this.tabsContainer.element,this.contentContainer.element),this.header.hidden=!!s.hideHeader,this.locked=(r=s.locked)!==null&&r!==void 0?r:!1,this.addDisposables(this._onTabDragStart,this._onGroupDragStart,this._onWillShowOverlay,this.tabsContainer.onTabDragStart(a=>{this._onTabDragStart.fire(a)}),this.tabsContainer.onGroupDragStart(a=>{this._onGroupDragStart.fire(a)}),this.tabsContainer.onDrop(a=>{this.handleDropEvent("header",a.event,"center",a.index)}),this.contentContainer.onDidFocus(()=>{this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.onDidBlur(()=>{}),this.contentContainer.dropTarget.onDrop(a=>{this.handleDropEvent("content",a.nativeEvent,a.position)}),this.tabsContainer.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(a)}),this.contentContainer.dropTarget.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(new Sh(a,{kind:"content",panel:this.activePanel,api:this._api,group:this.groupPanel,getData:bi}))}),this._onMove,this._onDidChange,this._onDidDrop,this._onWillDrop,this._onDidAddPanel,this._onDidRemovePanel,this._onDidActivePanelChange,this._onUnhandledDragOverEvent)}focusContent(){this.contentContainer.element.focus()}set renderContainer(e){this.panels.forEach(n=>{this.renderContainer.detatch(n)}),this._overwriteRenderContainer=e,this.panels.forEach(n=>{this.rerender(n)})}get renderContainer(){var e;return(e=this._overwriteRenderContainer)!==null&&e!==void 0?e:this.accessor.overlayRenderContainer}initialize(){this.options.panels&&this.options.panels.forEach(e=>{this.doAddPanel(e)}),this.options.activePanel&&this.openPanel(this.options.activePanel),this.setActive(this.isActive,!0),this.updateContainer(),this.accessor.options.createRightHeaderActionComponent&&(this._rightHeaderActions=this.accessor.options.createRightHeaderActionComponent(this.groupPanel),this.addDisposables(this._rightHeaderActions),this._rightHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setRightActionsElement(this._rightHeaderActions.element)),this.accessor.options.createLeftHeaderActionComponent&&(this._leftHeaderActions=this.accessor.options.createLeftHeaderActionComponent(this.groupPanel),this.addDisposables(this._leftHeaderActions),this._leftHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setLeftActionsElement(this._leftHeaderActions.element)),this.accessor.options.createPrefixHeaderActionComponent&&(this._prefixHeaderActions=this.accessor.options.createPrefixHeaderActionComponent(this.groupPanel),this.addDisposables(this._prefixHeaderActions),this._prefixHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setPrefixActionsElement(this._prefixHeaderActions.element))}rerender(e){this.contentContainer.renderPanel(e,{asActive:!1})}indexOf(e){return this.tabsContainer.indexOf(e.id)}toJSON(){var e;const n={views:this.tabsContainer.panels,activeView:(e=this._activePanel)===null||e===void 0?void 0:e.id,id:this.id};return this.locked!==!1&&(n.locked=this.locked),this.header.hidden&&(n.hideHeader=!0),n}moveToNext(e){e||(e={}),e.panel||(e.panel=this.activePanel);const n=e.panel?this.panels.indexOf(e.panel):-1;let i;if(n<this.panels.length-1)i=n+1;else if(!e.suppressRoll)i=0;else return;this.openPanel(this.panels[i])}moveToPrevious(e){if(e||(e={}),e.panel||(e.panel=this.activePanel),!e.panel)return;const n=this.panels.indexOf(e.panel);let i;if(n>0)i=n-1;else if(!e.suppressRoll)i=this.panels.length-1;else return;this.openPanel(this.panels[i])}containsPanel(e){return this.panels.includes(e)}init(e){}update(e){}focus(){var e;(e=this._activePanel)===null||e===void 0||e.focus()}openPanel(e,n={}){(typeof n.index!="number"||n.index>this.panels.length)&&(n.index=this.panels.length);const i=!!n.skipSetActive;if(e.updateParentGroup(this.groupPanel,{skipSetActive:n.skipSetActive}),this.doAddPanel(e,n.index,{skipSetActive:i}),this._activePanel===e){this.contentContainer.renderPanel(e,{asActive:!0});return}i||this.doSetActivePanel(e),n.skipSetGroupActive||this.accessor.doSetGroupActive(this.groupPanel),n.skipSetActive||this.updateContainer()}removePanel(e,n={skipSetActive:!1}){const i=typeof e=="string"?e:e.id,s=this._panels.find(o=>o.id===i);if(!s)throw new Error("invalid operation");return this._removePanel(s,n)}closeAllPanels(){if(this.panels.length>0){const e=[...this.panels];for(const n of e)this.doClose(n)}else this.accessor.removeGroup(this.groupPanel)}closePanel(e){this.doClose(e)}doClose(e){this.accessor.removePanel(e)}isPanelActive(e){return this._activePanel===e}updateActions(e){this.tabsContainer.setRightActionsElement(e)}setActive(e,n=!1){!n&&this.isActive===e||(this._isGroupActive=e,gt(this.container,"active-group",e),gt(this.container,"inactive-group",!e),this.tabsContainer.setActive(this.isActive),!this._activePanel&&this.panels.length>0&&this.doSetActivePanel(this.panels[0]),this.updateContainer())}layout(e,n){var i;this._width=e,this._height=n,this.contentContainer.layout(this._width,this._height),!((i=this._activePanel)===null||i===void 0)&&i.layout&&this._activePanel.layout(this._width,this._height)}_removePanel(e,n){const i=this._activePanel===e;if(this.doRemovePanel(e),i&&this.panels.length>0){const s=this.mostRecentlyUsed[0];this.openPanel(s,{skipSetActive:n.skipSetActive,skipSetGroupActive:n.skipSetActiveGroup})}return this._activePanel&&this.panels.length===0&&this.doSetActivePanel(void 0),n.skipSetActive||this.updateContainer(),e}doRemovePanel(e){const n=this.panels.indexOf(e);if(this._activePanel===e&&this.contentContainer.closePanel(),this.tabsContainer.delete(e.id),this._panels.splice(n,1),this.mostRecentlyUsed.includes(e)){const s=this.mostRecentlyUsed.indexOf(e);this.mostRecentlyUsed.splice(s,1)}const i=this._panelDisposables.get(e.id);i&&(i.dispose(),this._panelDisposables.delete(e.id)),this._onDidRemovePanel.fire({panel:e})}doAddPanel(e,n=this.panels.length,i={skipSetActive:!1}){const o=this._panels.indexOf(e)>-1;this.tabsContainer.show(),this.contentContainer.show(),this.tabsContainer.openPanel(e,n),i.skipSetActive||this.contentContainer.openPanel(e),!o&&(this.updateMru(e),this.panels.splice(n,0,e),this._panelDisposables.set(e.id,new Nt(e.api.onDidTitleChange(r=>this._onDidPanelTitleChange.fire(r)),e.api.onDidParametersChange(r=>this._onDidPanelParametersChange.fire(r)))),this._onDidAddPanel.fire({panel:e}))}doSetActivePanel(e){this._activePanel!==e&&(this._activePanel=e,e&&(this.tabsContainer.setActivePanel(e),e.layout(this._width,this._height),this.updateMru(e),this._onDidActivePanelChange.fire({panel:e})))}updateMru(e){this.mostRecentlyUsed.includes(e)&&this.mostRecentlyUsed.splice(this.mostRecentlyUsed.indexOf(e),1),this.mostRecentlyUsed=[e,...this.mostRecentlyUsed]}updateContainer(){var e,n;if(gt(this.container,"empty",this.isEmpty),this.panels.forEach(i=>i.runEvents()),this.isEmpty&&!this.watermark){const i=this.accessor.createWatermarkComponent();i.init({containerApi:this._api,group:this.groupPanel}),this.watermark=i,sn(this.watermark.element,"pointerdown",()=>{this.isActive||this.accessor.doSetGroupActive(this.groupPanel)}),this.tabsContainer.hide(),this.contentContainer.element.appendChild(this.watermark.element),this.watermark.updateParentGroup(this.groupPanel,!0)}!this.isEmpty&&this.watermark&&(this.watermark.element.remove(),(n=(e=this.watermark).dispose)===null||n===void 0||n.call(e),this.watermark=void 0,this.tabsContainer.show())}canDisplayOverlay(e,n,i){const s=new Q$(e,i,n,bi,this.accessor.getPanel(this.id));return this._onUnhandledDragOverEvent.fire(s),s.isAccepted}handleDropEvent(e,n,i,s){if(this.locked==="no-drop-target")return;function o(){switch(e){case"header":return typeof s=="number"?"tab":"header_space";case"content":return"content"}}const r=typeof s=="number"?this.panels[s]:void 0,a=new eE({nativeEvent:n,position:i,panel:r,getData:()=>bi(),kind:o(),group:this.groupPanel,api:this._api});if(this._onWillDrop.fire(a),a.defaultPrevented)return;const l=bi();if(l&&l.viewId===this.accessor.id){if(l.panelId===null){const{groupId:h}=l;this._onMove.fire({target:i,groupId:h,index:s});return}if(this.tabsContainer.indexOf(l.panelId)!==-1&&this.tabsContainer.size===1)return;const{groupId:u,panelId:d}=l;if(this.id===u&&!i&&this.tabsContainer.indexOf(d)===s)return;this._onMove.fire({target:i,groupId:l.groupId,itemId:l.panelId,index:s})}else this._onDidDrop.fire(new hx({nativeEvent:n,position:i,panel:r,getData:()=>bi(),group:this.groupPanel,api:this._api}))}dispose(){var e,n,i;super.dispose(),(e=this.watermark)===null||e===void 0||e.element.remove(),(i=(n=this.watermark)===null||n===void 0?void 0:n.dispose)===null||i===void 0||i.call(n),this.watermark=void 0;for(const s of this.panels)s.dispose();this.tabsContainer.dispose(),this.contentContainer.dispose()}}class fx extends J${constructor(e,n,i){super(e,n),this._onDidConstraintsChangeInternal=new xe,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new xe,this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new xe,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange),i&&this.initialize(i)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class tE extends dx{get priority(){return this._priority}get snap(){return this._snap}get minimumWidth(){const e=typeof this._minimumWidth=="function"?this._minimumWidth():this._minimumWidth;return e!==this._evaluatedMinimumWidth&&(this._evaluatedMinimumWidth=e,this.updateConstraints()),e}get minimumHeight(){const e=typeof this._minimumHeight=="function"?this._minimumHeight():this._minimumHeight;return e!==this._evaluatedMinimumHeight&&(this._evaluatedMinimumHeight=e,this.updateConstraints()),e}get maximumHeight(){const e=typeof this._maximumHeight=="function"?this._maximumHeight():this._maximumHeight;return e!==this._evaluatedMaximumHeight&&(this._evaluatedMaximumHeight=e,this.updateConstraints()),e}get maximumWidth(){const e=typeof this._maximumWidth=="function"?this._maximumWidth():this._maximumWidth;return e!==this._evaluatedMaximumWidth&&(this._evaluatedMaximumWidth=e,this.updateConstraints()),e}get isActive(){return this.api.isActive}get isVisible(){return this.api.isVisible}constructor(e,n,i,s){super(e,n,s??new fx(e,n)),this._evaluatedMinimumWidth=0,this._evaluatedMaximumWidth=Number.MAX_SAFE_INTEGER,this._evaluatedMinimumHeight=0,this._evaluatedMaximumHeight=Number.MAX_SAFE_INTEGER,this._minimumWidth=0,this._minimumHeight=0,this._maximumWidth=Number.MAX_SAFE_INTEGER,this._maximumHeight=Number.MAX_SAFE_INTEGER,this._snap=!1,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,typeof(i==null?void 0:i.minimumWidth)=="number"&&(this._minimumWidth=i.minimumWidth),typeof(i==null?void 0:i.maximumWidth)=="number"&&(this._maximumWidth=i.maximumWidth),typeof(i==null?void 0:i.minimumHeight)=="number"&&(this._minimumHeight=i.minimumHeight),typeof(i==null?void 0:i.maximumHeight)=="number"&&(this._maximumHeight=i.maximumHeight),this.api.initialize(this),this.addDisposables(this.api.onWillVisibilityChange(o=>{const{isVisible:r}=o,{accessor:a}=this._params;a.setVisible(this,r)}),this.api.onActiveChange(()=>{const{accessor:o}=this._params;o.doSetGroupActive(this)}),this.api.onDidConstraintsChangeInternal(o=>{(typeof o.minimumWidth=="number"||typeof o.minimumWidth=="function")&&(this._minimumWidth=o.minimumWidth),(typeof o.minimumHeight=="number"||typeof o.minimumHeight=="function")&&(this._minimumHeight=o.minimumHeight),(typeof o.maximumWidth=="number"||typeof o.maximumWidth=="function")&&(this._maximumWidth=o.maximumWidth),(typeof o.maximumHeight=="number"||typeof o.maximumHeight=="function")&&(this._maximumHeight=o.maximumHeight)}),this.api.onDidSizeChange(o=>{this._onDidChange.fire({height:o.height,width:o.width})}),this._onDidChange)}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}init(e){e.maximumHeight&&(this._maximumHeight=e.maximumHeight),e.minimumHeight&&(this._minimumHeight=e.minimumHeight),e.maximumWidth&&(this._maximumWidth=e.maximumWidth),e.minimumWidth&&(this._minimumWidth=e.minimumWidth),this._priority=e.priority,this._snap=!!e.snap,super.init(e),typeof e.isVisible=="boolean"&&this.setVisible(e.isVisible)}updateConstraints(){this.api._onDidConstraintsChange.fire({minimumWidth:this._evaluatedMinimumWidth,maximumWidth:this._evaluatedMaximumWidth,minimumHeight:this._evaluatedMinimumHeight,maximumHeight:this._evaluatedMaximumHeight})}toJSON(){const e=super.toJSON(),n=s=>s===Number.MAX_SAFE_INTEGER?void 0:s,i=s=>s<=0?void 0:s;return Object.assign(Object.assign({},e),{minimumHeight:i(this.minimumHeight),maximumHeight:n(this.maximumHeight),minimumWidth:i(this.minimumWidth),maximumWidth:n(this.maximumWidth),snap:this.snap,priority:this.priority})}}const mc="dockview: DockviewGroupPanelApiImpl not initialized";class wG extends fx{get location(){if(!this._group)throw new Error(mc);return this._group.model.location}constructor(e,n){super(e,"__dockviewgroup__"),this.accessor=n,this._mutableDisposable=new Xi,this._onDidLocationChange=new xe,this.onDidLocationChange=this._onDidLocationChange.event,this._onDidActivePanelChange=new xe,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this.addDisposables(this._onDidLocationChange,this._onDidActivePanelChange,this._mutableDisposable)}close(){if(this._group)return this.accessor.removeGroup(this._group)}getWindow(){return this.location.type==="popout"?this.location.getWindow():window}moveTo(e){var n,i,s;if(!this._group)throw new Error(mc);const o=(n=e.group)!==null&&n!==void 0?n:this.accessor.addGroup({direction:Q4((i=e.position)!==null&&i!==void 0?i:"right"),skipSetActive:!0});this.accessor.moveGroupOrPanel({from:{groupId:this._group.id},to:{group:o,position:e.group&&(s=e.position)!==null&&s!==void 0?s:"center"}})}maximize(){if(!this._group)throw new Error(mc);this.location.type==="grid"&&this.accessor.maximizeGroup(this._group)}isMaximized(){if(!this._group)throw new Error(mc);return this.accessor.isMaximizedGroup(this._group)}exitMaximized(){if(!this._group)throw new Error(mc);this.isMaximized()&&this.accessor.exitMaximizedGroup()}initialize(e){this._group=e,queueMicrotask(()=>{this._mutableDisposable.value=this._group.model.onDidActivePanelChange(n=>{this._onDidActivePanelChange.fire(n)})})}}const CG=100,SG=100;class Zw extends tE{get panels(){return this._model.panels}get activePanel(){return this._model.activePanel}get size(){return this._model.size}get model(){return this._model}get locked(){return this._model.locked}set locked(e){this._model.locked=e}get header(){return this._model.header}constructor(e,n,i){super(n,"groupview_default",{minimumHeight:SG,minimumWidth:CG},new wG(n,e)),this.api.initialize(this),this._model=new yG(this.element,e,n,i,this)}focus(){this.api.isActive||this.api.setActive(),super.focus()}initialize(){this._model.initialize()}setActive(e){super.setActive(e),this.model.setActive(e)}layout(e,n){super.layout(e,n),this.model.layout(e,n)}getComponent(){return this._model}toJSON(){return this.model.toJSON()}}class IG extends fx{get location(){return this.group.api.location}get title(){return this.panel.title}get isGroupActive(){return this.group.isActive}get renderer(){return this.panel.renderer}set group(e){const n=this._group;this._group!==e&&(this._group=e,this._onDidGroupChange.fire({}),this.setupGroupEventListeners(n),this._onDidLocationChange.fire({location:this.group.api.location}))}get group(){return this._group}get tabComponent(){return this._tabComponent}constructor(e,n,i,s,o){super(e.id,s),this.panel=e,this.accessor=i,this._onDidTitleChange=new xe,this.onDidTitleChange=this._onDidTitleChange.event,this._onDidActiveGroupChange=new xe,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._onDidGroupChange=new xe,this.onDidGroupChange=this._onDidGroupChange.event,this._onDidRendererChange=new xe,this.onDidRendererChange=this._onDidRendererChange.event,this._onDidLocationChange=new xe,this.onDidLocationChange=this._onDidLocationChange.event,this.groupEventsDisposable=new Xi,this._tabComponent=o,this.initialize(e),this._group=n,this.setupGroupEventListeners(),this.addDisposables(this.groupEventsDisposable,this._onDidRendererChange,this._onDidTitleChange,this._onDidGroupChange,this._onDidActiveGroupChange,this._onDidLocationChange)}getWindow(){return this.group.api.getWindow()}moveTo(e){var n;this.accessor.moveGroupOrPanel({from:{groupId:this._group.id,panelId:this.panel.id},to:{group:e.group,position:(n=e.position)!==null&&n!==void 0?n:"center",index:e.index}})}setTitle(e){this.panel.setTitle(e)}setRenderer(e){this.panel.setRenderer(e)}close(){this.group.model.closePanel(this.panel)}maximize(){this.group.api.maximize()}isMaximized(){return this.group.api.isMaximized()}exitMaximized(){this.group.api.exitMaximized()}setupGroupEventListeners(e){var n;let i=(n=e==null?void 0:e.isActive)!==null&&n!==void 0?n:!1;this.groupEventsDisposable.value=new Nt(this.group.api.onDidVisibilityChange(s=>{const o=!s.isVisible&&this.isVisible,r=s.isVisible&&!this.isVisible,a=this.group.model.isPanelActive(this.panel);(o||r&&a)&&this._onDidVisibilityChange.fire(s)}),this.group.api.onDidLocationChange(s=>{this.group===this.panel.group&&this._onDidLocationChange.fire(s)}),this.group.api.onDidActiveChange(()=>{this.group===this.panel.group&&i!==this.isGroupActive&&(i=this.isGroupActive,this._onDidActiveGroupChange.fire({isActive:this.isGroupActive}))}))}}class Za extends Nt{get params(){return this._params}get title(){return this._title}get group(){return this._group}get renderer(){var e;return(e=this._renderer)!==null&&e!==void 0?e:this.accessor.renderer}constructor(e,n,i,s,o,r,a,l){super(),this.id=e,this.accessor=s,this.containerApi=o,this.view=a,this._renderer=l.renderer,this._group=r,this.api=new IG(this,this._group,s,n,i),this.addDisposables(this.api.onActiveChange(()=>{s.setActivePanel(this)}),this.api.onDidSizeChange(c=>{this.group.api.setSize(c)}),this.api.onDidRendererChange(()=>{this.group.model.rerender(this)}))}init(e){this._params=e.params,this.view.init(Object.assign(Object.assign({},e),{api:this.api,containerApi:this.containerApi})),this.setTitle(e.title)}focus(){const e=new Y$;this.api._onWillFocus.fire(e),!e.defaultPrevented&&(this.api.isActive||this.api.setActive())}toJSON(){return{id:this.id,contentComponent:this.view.contentComponent,tabComponent:this.view.tabComponent,params:Object.keys(this._params||{}).length>0?this._params:void 0,title:this.title,renderer:this._renderer}}setTitle(e){e!==this.title&&(this._title=e,this.api._onDidTitleChange.fire({title:e}))}setRenderer(e){e!==this.renderer&&(this._renderer=e,this.api._onDidRendererChange.fire({renderer:e}))}update(e){var n;this._params=Object.assign(Object.assign({},(n=this._params)!==null&&n!==void 0?n:{}),e.params);for(const i of Object.keys(e.params))e.params[i]===void 0&&delete this._params[i];this.view.update({params:this._params})}updateParentGroup(e,n){this._group=e,this.api.group=this._group;const i=this._group.model.isPanelActive(this),s=this.group.api.isActive&&i;n!=null&&n.skipSetActive||this.api.isActive!==s&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&i}),this.api.isVisible!==i&&this.api._onDidVisibilityChange.fire({isVisible:i})}runEvents(){const e=this._group.model.isPanelActive(this),n=this.group.api.isActive&&e;this.api.isActive!==n&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&e}),this.api.isVisible!==e&&this.api._onDidVisibilityChange.fire({isVisible:e})}layout(e,n){this.api._onDidDimensionChange.fire({width:e,height:n}),this.view.layout(e,n)}dispose(){this.api.dispose(),this.view.dispose()}}const px=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"height",t.height),e.setAttributeNS(null,"width",t.width),e.setAttributeNS(null,"viewBox",t.viewbox),e.setAttributeNS(null,"aria-hidden","false"),e.setAttributeNS(null,"focusable","false"),e.classList.add("dockview-svg");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttributeNS(null,"d",t.path),e.appendChild(n),e},nE=()=>px({width:"11",height:"11",viewbox:"0 0 28 28",path:"M2.1 27.3L0 25.2L11.55 13.65L0 2.1L2.1 0L13.65 11.55L25.2 0L27.3 2.1L15.75 13.65L27.3 25.2L25.2 27.3L13.65 15.75L2.1 27.3Z"}),$G=()=>px({width:"11",height:"11",viewbox:"0 0 24 15",path:"M12 14.15L0 2.15L2.15 0L12 9.9L21.85 0.0499992L24 2.2L12 14.15Z"}),EG=()=>px({width:"11",height:"11",viewbox:"0 0 15 25",path:"M2.15 24.1L0 21.95L9.9 12.05L0 2.15L2.15 0L14.2 12.05L2.15 24.1Z"});class Qw extends Nt{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-default-tab",this._content=document.createElement("div"),this._content.className="dv-default-tab-content",this.action=document.createElement("div"),this.action.className="dv-default-tab-action",this.action.appendChild(nE()),this._element.appendChild(this._content),this._element.appendChild(this.action),this.addDisposables(sn(this.action,"mousedown",e=>{e.preventDefault()})),this.render()}init(e){this._title=e.title,this.addDisposables(e.api.onDidTitleChange(n=>{this._title=n.title,this.render()}),sn(this.action,"mousedown",n=>{n.preventDefault()}),sn(this.action,"click",n=>{n.defaultPrevented||(n.preventDefault(),e.api.close())})),this.render()}render(){var e;this._content.textContent!==this._title&&(this._content.textContent=(e=this._title)!==null&&e!==void 0?e:"")}}class iE{get content(){return this._content}get tab(){return this._tab}constructor(e,n,i,s){this.accessor=e,this.id=n,this.contentComponent=i,this.tabComponent=s,this._content=this.createContentComponent(this.id,i),this._tab=this.createTabComponent(this.id,s)}init(e){this.content.init(e),this.tab.init(e)}updateParentGroup(e,n){}layout(e,n){var i,s;(s=(i=this.content).layout)===null||s===void 0||s.call(i,e,n)}update(e){var n,i,s,o;(i=(n=this.content).update)===null||i===void 0||i.call(n,e),(o=(s=this.tab).update)===null||o===void 0||o.call(s,e)}dispose(){var e,n,i,s;(n=(e=this.content).dispose)===null||n===void 0||n.call(e),(s=(i=this.tab).dispose)===null||s===void 0||s.call(i)}createContentComponent(e,n){return this.accessor.options.createComponent({id:e,name:n})}createTabComponent(e,n){const i=n??this.accessor.options.defaultTabComponent;if(i){if(this.accessor.options.createTabComponent){const s=this.accessor.options.createTabComponent({id:e,name:i});return s||new Qw}console.warn(`dockview: tabComponent '${n}' was not found. falling back to the default tab.`)}return new Qw}}class NG{constructor(e){this.accessor=e}fromJSON(e,n){var i,s;const o=e.id,r=e.params,a=e.title,l=e.view,c=l?l.content.id:(i=e.contentComponent)!==null&&i!==void 0?i:"unknown",u=l?(s=l.tab)===null||s===void 0?void 0:s.id:e.tabComponent,d=new iE(this.accessor,o,c,u),f=new Za(o,c,u,this.accessor,new Ch(this.accessor),n,d,{renderer:e.renderer});return f.init({title:a??o,params:r??{}}),f}}class kG extends Nt{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="watermark";const e=document.createElement("div");e.className="watermark-title";const n=document.createElement("span");n.style.flexGrow="1";const i=document.createElement("div");i.className="watermark-content",this._element.appendChild(e),this._element.appendChild(i);const s=document.createElement("div");s.className="actions-container";const o=document.createElement("div");o.className="close-action",o.appendChild(nE()),s.appendChild(o),e.appendChild(n),e.appendChild(s),this.addDisposables(sn(o,"click",r=>{var a;r.preventDefault(),this._group&&((a=this._api)===null||a===void 0||a.removeGroup(this._group))}))}update(e){}focus(){}layout(e,n){}init(e){this._api=e.containerApi,this.render()}updateParentGroup(e,n){this._group=e,this.render()}dispose(){super.dispose()}render(){const e=!!(this._api&&this._api.size<=1);gt(this.element,"has-actions",e)}}const sE=999;class DG{constructor(){this._orderedList=[]}push(e){this._orderedList=[...this._orderedList.filter(n=>n!==e),e],this.update()}destroy(e){this._orderedList=this._orderedList.filter(n=>n!==e),this.update()}update(){for(let e=0;e<this._orderedList.length;e++)this._orderedList[e].setAttribute("aria-level",`${e}`),this._orderedList[e].style.zIndex=`${sE+e*2}`}}const Md=new DG;class cr extends Nt{set minimumInViewportWidth(e){this.options.minimumInViewportWidth=e}set minimumInViewportHeight(e){this.options.minimumInViewportHeight=e}get element(){return this._element}constructor(e){super(),this.options=e,this._element=document.createElement("div"),this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._onDidChangeEnd=new xe,this.onDidChangeEnd=this._onDidChangeEnd.event,this.addDisposables(this._onDidChange,this._onDidChangeEnd),this._element.className="dv-resize-container",this.setupResize("top"),this.setupResize("bottom"),this.setupResize("left"),this.setupResize("right"),this.setupResize("topleft"),this.setupResize("topright"),this.setupResize("bottomleft"),this.setupResize("bottomright"),this._element.appendChild(this.options.content),this.options.container.appendChild(this._element),this.setBounds(Object.assign(Object.assign(Object.assign(Object.assign({height:this.options.height,width:this.options.width},"top"in this.options&&{top:this.options.top}),"bottom"in this.options&&{bottom:this.options.bottom}),"left"in this.options&&{left:this.options.left}),"right"in this.options&&{right:this.options.right})),Md.push(this._element)}bringToFront(){Md.push(this._element)}setBounds(e={}){typeof e.height=="number"&&(this._element.style.height=`${e.height}px`),typeof e.width=="number"&&(this._element.style.width=`${e.width}px`),"top"in e&&typeof e.top=="number"&&(this._element.style.top=`${e.top}px`,this._element.style.bottom="auto",this.verticalAlignment="top"),"bottom"in e&&typeof e.bottom=="number"&&(this._element.style.bottom=`${e.bottom}px`,this._element.style.top="auto",this.verticalAlignment="bottom"),"left"in e&&typeof e.left=="number"&&(this._element.style.left=`${e.left}px`,this._element.style.right="auto",this.horiziontalAlignment="left"),"right"in e&&typeof e.right=="number"&&(this._element.style.right=`${e.right}px`,this._element.style.left="auto",this.horiziontalAlignment="right");const n=this.options.container.getBoundingClientRect(),i=this._element.getBoundingClientRect(),s=Math.max(0,this.getMinimumWidth(i.width)),o=Math.max(0,this.getMinimumHeight(i.height));if(this.verticalAlignment==="top"){const r=fn(i.top-n.top,-o,Math.max(0,n.height-i.height+o));this._element.style.top=`${r}px`,this._element.style.bottom="auto"}if(this.verticalAlignment==="bottom"){const r=fn(n.bottom-i.bottom,-o,Math.max(0,n.height-i.height+o));this._element.style.bottom=`${r}px`,this._element.style.top="auto"}if(this.horiziontalAlignment==="left"){const r=fn(i.left-n.left,-s,Math.max(0,n.width-i.width+s));this._element.style.left=`${r}px`,this._element.style.right="auto"}if(this.horiziontalAlignment==="right"){const r=fn(n.right-i.right,-s,Math.max(0,n.width-i.width+s));this._element.style.right=`${r}px`,this._element.style.left="auto"}this._onDidChange.fire()}toJSON(){const e=this.options.container.getBoundingClientRect(),n=this._element.getBoundingClientRect(),i={};return this.verticalAlignment==="top"?i.top=parseFloat(this._element.style.top):this.verticalAlignment==="bottom"?i.bottom=parseFloat(this._element.style.bottom):i.top=n.top-e.top,this.horiziontalAlignment==="left"?i.left=parseFloat(this._element.style.left):this.horiziontalAlignment==="right"?i.right=parseFloat(this._element.style.right):i.left=n.left-e.left,i.width=n.width,i.height=n.height,i}setupDrag(e,n={inDragMode:!1}){const i=new Xi,s=()=>{let o=null;const r=yh();i.value=new Nt({dispose:()=>{r.release()}},zo(window,"mousemove",a=>{const l=this.options.container.getBoundingClientRect(),c=a.clientX-l.left,u=a.clientY-l.top;gt(this._element,"dv-resize-container-dragging",!0);const d=this._element.getBoundingClientRect();o===null&&(o={x:a.clientX-d.left,y:a.clientY-d.top});const f=Math.max(0,this.getMinimumWidth(d.width)),h=Math.max(0,this.getMinimumHeight(d.height)),p=fn(u-o.y,-h,Math.max(0,l.height-d.height+h)),m=fn(o.y-u+l.height-d.height,-h,Math.max(0,l.height-d.height+h)),g=fn(c-o.x,-f,Math.max(0,l.width-d.width+f)),v=fn(o.x-c+l.width-d.width,-f,Math.max(0,l.width-d.width+f)),x={};p<=m?x.top=p:x.bottom=m,g<=v?x.left=g:x.right=v,this.setBounds(x)}),zo(window,"mouseup",()=>{gt(this._element,"dv-resize-container-dragging",!1),i.dispose(),this._onDidChangeEnd.fire()}))};this.addDisposables(i,sn(e,"mousedown",o=>{if(o.defaultPrevented){o.preventDefault();return}Xw(o)||s()}),sn(this.options.content,"mousedown",o=>{o.defaultPrevented||Xw(o)||o.shiftKey&&s()}),sn(this.options.content,"mousedown",()=>{Md.push(this._element)},!0)),n.inDragMode&&s()}setupResize(e){const n=document.createElement("div");n.className=`dv-resize-handle-${e}`,this._element.appendChild(n);const i=new Xi;this.addDisposables(i,sn(n,"mousedown",s=>{s.preventDefault();let o=null;const r=yh();i.value=new Nt(zo(window,"mousemove",a=>{const l=this.options.container.getBoundingClientRect(),c=this._element.getBoundingClientRect(),u=a.clientY-l.top,d=a.clientX-l.left;o===null&&(o={originalY:u,originalHeight:c.height,originalX:d,originalWidth:c.width});let f,h,p,m,g,v;const x=()=>{f=fn(u,-Number.MAX_VALUE,o.originalY+o.originalHeight>l.height?this.getMinimumHeight(l.height):Math.max(0,o.originalY+o.originalHeight-cr.MINIMUM_HEIGHT)),p=o.originalY+o.originalHeight-f,h=l.height-f-p},b=()=>{f=o.originalY-o.originalHeight,p=fn(u-f,f<0&&typeof this.options.minimumInViewportHeight=="number"?-f+this.options.minimumInViewportHeight:cr.MINIMUM_HEIGHT,Number.MAX_VALUE),h=l.height-f-p},w=()=>{m=fn(d,-Number.MAX_VALUE,o.originalX+o.originalWidth>l.width?this.getMinimumWidth(l.width):Math.max(0,o.originalX+o.originalWidth-cr.MINIMUM_WIDTH)),v=o.originalX+o.originalWidth-m,g=l.width-m-v},y=()=>{m=o.originalX-o.originalWidth,v=fn(d-m,m<0&&typeof this.options.minimumInViewportWidth=="number"?-m+this.options.minimumInViewportWidth:cr.MINIMUM_WIDTH,Number.MAX_VALUE),g=l.width-m-v};switch(e){case"top":x();break;case"bottom":b();break;case"left":w();break;case"right":y();break;case"topleft":x(),w();break;case"topright":x(),y();break;case"bottomleft":b(),w();break;case"bottomright":b(),y();break}const C={};f<=h?C.top=f:C.bottom=h,m<=g?C.left=m:C.right=g,C.height=p,C.width=v,this.setBounds(C)}),{dispose:()=>{r.release()}},zo(window,"mouseup",()=>{i.dispose(),this._onDidChangeEnd.fire()}))}))}getMinimumWidth(e){return typeof this.options.minimumInViewportWidth=="number"?e-this.options.minimumInViewportWidth:0}getMinimumHeight(e){return typeof this.options.minimumInViewportHeight=="number"?e-this.options.minimumInViewportHeight:0}dispose(){Md.destroy(this._element),this._element.remove(),super.dispose()}}cr.MINIMUM_HEIGHT=20;cr.MINIMUM_WIDTH=20;class TG extends Nt{constructor(e,n){super(),this.group=e,this.overlay=n,this.addDisposables(n)}position(e){this.overlay.setBounds(e)}}const Fd=100,sr={left:100,top:100,width:300,height:300};function RG(){const t=document.createElement("div");return t.tabIndex=-1,t}class eC extends Nt{constructor(e,n){super(),this.element=e,this.accessor=n,this.map={},this._disposed=!1,this.addDisposables(Oi.from(()=>{for(const i of Object.values(this.map))i.disposable.dispose(),i.destroy.dispose();this._disposed=!0}))}detatch(e){if(this.map[e.api.id]){const{disposable:n,destroy:i}=this.map[e.api.id];return n.dispose(),i.dispose(),delete this.map[e.api.id],!0}return!1}attach(e){const{panel:n,referenceContainer:i}=e;if(!this.map[n.api.id]){const u=RG();u.className="dv-render-overlay",this.map[n.api.id]={panel:n,disposable:Oi.NONE,destroy:Oi.NONE,element:u}}const s=this.map[n.api.id].element;n.view.content.element.parentElement!==s&&s.appendChild(n.view.content.element),s.parentElement!==this.element&&this.element.appendChild(s);const o=()=>{const u=qw(i.element),d=qw(this.element);s.style.left=`${u.left-d.left}px`,s.style.top=`${u.top-d.top}px`,s.style.width=`${u.width}px`,s.style.height=`${u.height}px`,gt(s,"dv-render-overlay-float",n.group.api.location.type==="floating")},r=()=>{n.api.isVisible&&o(),s.style.display=n.api.isVisible?"":"none"},a=new Xi,l=()=>{n.api.location.type==="floating"?queueMicrotask(()=>{const u=this.accessor.floatingGroups.find(p=>p.group===n.api.group);if(!u)return;const d=u.overlay.element,f=()=>{const p=Number(d.getAttribute("aria-level"));s.style.zIndex=`${sE+p*2+1}`},h=new MutationObserver(()=>{f()});a.value=Oi.from(()=>h.disconnect()),h.observe(d,{attributeFilter:["aria-level"],attributes:!0}),f()}):s.style.zIndex=""},c=new Nt(a,new q$(s,{onDragEnd:u=>{i.dropTarget.dnd.onDragEnd(u)},onDragEnter:u=>{i.dropTarget.dnd.onDragEnter(u)},onDragLeave:u=>{i.dropTarget.dnd.onDragLeave(u)},onDrop:u=>{i.dropTarget.dnd.onDrop(u)},onDragOver:u=>{i.dropTarget.dnd.onDragOver(u)}}),n.api.onDidVisibilityChange(()=>{r()}),n.api.onDidDimensionsChange(()=>{n.api.isVisible&&o()}),n.api.onDidLocationChange(()=>{l()}));return this.map[n.api.id].destroy=Oi.from(()=>{var u;n.view.content.element.parentElement===s&&s.removeChild(n.view.content.element),(u=s.parentElement)===null||u===void 0||u.removeChild(s)}),l(),queueMicrotask(()=>{this.isDisposed||r()}),this.map[n.api.id].disposable.dispose(),this.map[n.api.id].disposable=c,s}}var _G=function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function a(u){try{c(i.next(u))}catch(d){r(d)}}function l(u){try{c(i.throw(u))}catch(d){r(d)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};class AG extends Nt{get window(){var e,n;return(n=(e=this._window)===null||e===void 0?void 0:e.value)!==null&&n!==void 0?n:null}constructor(e,n,i){super(),this.target=e,this.className=n,this.options=i,this._onWillClose=new xe,this.onWillClose=this._onWillClose.event,this._onDidClose=new xe,this.onDidClose=this._onDidClose.event,this._window=null,this.addDisposables(this._onWillClose,this._onDidClose,{dispose:()=>{this.close()}})}dimensions(){if(!this._window)return null;const e=this._window.value.screenX,n=this._window.value.screenY,i=this._window.value.innerWidth,s=this._window.value.innerHeight;return{top:n,left:e,width:i,height:s}}close(){var e,n;this._window&&(this._onWillClose.fire(),(n=(e=this.options).onWillClose)===null||n===void 0||n.call(e,{id:this.target,window:this._window.value}),this._window.disposable.dispose(),this._window.value.close(),this._window=null,this._onDidClose.fire())}open(){var e,n;return _G(this,void 0,void 0,function*(){if(this._window)throw new Error("instance of popout window is already open");const i=`${this.options.url}`,s=Object.entries({top:this.options.top,left:this.options.left,width:this.options.width,height:this.options.height}).map(([l,c])=>`${l}=${c}`).join(","),o=window.open(i,this.target,s);if(!o)return null;const r=new Nt;this._window={value:o,disposable:r},r.addDisposables(zo(window,"beforeunload",()=>{this.close()}));const a=this.createPopoutWindowContainer();return this.className&&a.classList.add(this.className),(n=(e=this.options).onDidOpen)===null||n===void 0||n.call(e,{id:this.target,window:o}),new Promise(l=>{o.addEventListener("unload",c=>{}),o.addEventListener("load",()=>{const c=o.document;c.title=document.title,c.body.appendChild(a),B4(c,window.document.styleSheets),zo(o,"beforeunload",()=>{this.close()}),l(a)})})})}createPopoutWindowContainer(){const e=document.createElement("div");return e.classList.add("dv-popout-window"),e.id="dv-popout-window",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0px",e.style.left="0px",e}}const OG={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function ym(t){const e=t.from.activePanel;[...t.from.panels].map(i=>{const s=t.from.model.removePanel(i);return t.from.model.renderContainer.detatch(i),s}).forEach(i=>{t.to.model.openPanel(i,{skipSetActive:e!==i,skipSetGroupActive:!0})})}function PG(t){function e(s){const o=[];for(let r=0;r<s.classList.length;r++)o.push(s.classList.item(r));return o}let n,i=t;for(;i!==null&&(n=e(i).find(s=>s.startsWith("dockview-theme-")),typeof n!="string");)i=i.parentElement;return n}class MG extends j${get orientation(){return this.gridview.orientation}get totalPanels(){return this.panels.length}get panels(){return this.groups.flatMap(e=>e.panels)}get options(){return this._options}get activePanel(){const e=this.activeGroup;if(e)return e.activePanel}get renderer(){var e;return(e=this.options.defaultRenderer)!==null&&e!==void 0?e:"onlyWhenVisible"}get api(){return this._api}get gap(){return this.gridview.margin}get floatingGroups(){return this._floatingGroups}constructor(e,n){var i;super({proportionalLayout:!0,orientation:ot.HORIZONTAL,styles:n.hideBorders?{separatorBorder:"transparent"}:void 0,parentElement:e,disableAutoResizing:n.disableAutoResizing,locked:n.locked,margin:n.gap,className:n.className}),this.nextGroupId=lx(),this._deserializer=new NG(this),this.watermark=null,this._onWillDragPanel=new xe,this.onWillDragPanel=this._onWillDragPanel.event,this._onWillDragGroup=new xe,this.onWillDragGroup=this._onWillDragGroup.event,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new xe,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onUnhandledDragOverEvent=new xe,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._onDidRemovePanel=new xe,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidAddPanel=new xe,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidLayoutFromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutFromJSON.event,this._onDidActivePanelChange=new xe,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onDidMovePanel=new xe,this.onDidMovePanel=this._onDidMovePanel.event,this._floatingGroups=[],this._popoutGroups=[],this._onDidRemoveGroup=new xe,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new xe,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidActiveGroupChange=new xe,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._moving=!1,this.overlayRenderContainer=new eC(this.gridview.element,this),gt(this.gridview.element,"dv-dockview",!0),gt(this.element,"dv-debug",!!n.debug),this.addDisposables(this.overlayRenderContainer,this._onWillDragPanel,this._onWillDragGroup,this._onWillShowOverlay,this._onDidActivePanelChange,this._onDidAddPanel,this._onDidRemovePanel,this._onDidLayoutFromJSON,this._onDidDrop,this._onWillDrop,this._onDidMovePanel,this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this._onUnhandledDragOverEvent,this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.updateWatermark()}),this.onDidAdd(s=>{this._moving||this._onDidAddGroup.fire(s)}),this.onDidRemove(s=>{this._moving||this._onDidRemoveGroup.fire(s)}),this.onDidActiveChange(s=>{this._moving||this._onDidActiveGroupChange.fire(s)}),ra.any(this.onDidAdd,this.onDidRemove)(()=>{this.updateWatermark()}),ra.any(this.onDidAddPanel,this.onDidRemovePanel,this.onDidAddGroup,this.onDidRemove,this.onDidMovePanel,this.onDidActivePanelChange)(()=>{this._bufferOnDidLayoutChange.fire()}),Oi.from(()=>{for(const s of[...this._floatingGroups])s.dispose();for(const s of[...this._popoutGroups])s.disposable.dispose()})),this._options=n,this._rootDropTarget=new Uo(this.element,{canDisplayOverlay:(s,o)=>{const r=bi();if(r)return r.viewId!==this.id?!1:o==="center"?this.gridview.length===0:!0;if(o==="center"&&this.gridview.length!==0)return!1;const a=new Q$(s,"edge",o,bi);return this._onUnhandledDragOverEvent.fire(a),a.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:(i=this.options.rootOverlayModel)!==null&&i!==void 0?i:OG}),this.addDisposables(this._rootDropTarget,this._rootDropTarget.onWillShowOverlay(s=>{this.gridview.length>0&&s.position==="center"||this._onWillShowOverlay.fire(new Sh(s,{kind:"edge",panel:void 0,api:this._api,group:void 0,getData:bi}))}),this._rootDropTarget.onDrop(s=>{var o;const r=new eE({nativeEvent:s.nativeEvent,position:s.position,panel:void 0,api:this._api,group:void 0,getData:bi,kind:"edge"});if(this._onWillDrop.fire(r),r.defaultPrevented)return;const a=bi();a?this.moveGroupOrPanel({from:{groupId:a.groupId,panelId:(o=a.panelId)!==null&&o!==void 0?o:void 0},to:{group:this.orthogonalize(s.position),position:"center"}}):this._onDidDrop.fire(new hx({nativeEvent:s.nativeEvent,position:s.position,panel:void 0,api:this._api,group:void 0,getData:bi}))}),this._rootDropTarget),this._api=new Ch(this),this.updateWatermark()}addPopoutGroup(e,n){var i,s,o;if(e instanceof Za&&e.group.size===1)return this.addPopoutGroup(e.group,n);const r=PG(this.gridview.element),a=this.element;function l(){return n!=null&&n.position?n.position:e instanceof Zw?e.element.getBoundingClientRect():e.group?e.group.element.getBoundingClientRect():a.getBoundingClientRect()}const c=l(),u=(s=(i=n==null?void 0:n.overridePopoutGroup)===null||i===void 0?void 0:i.id)!==null&&s!==void 0?s:this.getNextGroupId();e.api.location.type==="grid"&&e.api.setVisible(!1);const d=new AG(`${this.id}-${u}`,r??"",{url:(o=n==null?void 0:n.popoutUrl)!==null&&o!==void 0?o:"/popout.html",left:window.screenX+c.left,top:window.screenY+c.top,width:c.width,height:c.height,onDidOpen:n==null?void 0:n.onDidOpen,onWillClose:n==null?void 0:n.onWillClose}),f=new Nt(d,d.onDidClose(()=>{f.dispose()}));return d.open().then(h=>{var p;if(d.isDisposed)return;if(h===null){f.dispose();return}const m=document.createElement("div");m.className="dv-overlay-render-container";const g=new eC(m,this),v=e instanceof Za?e.group:e,x=e.api.location.type,b=(p=n==null?void 0:n.overridePopoutGroup)!==null&&p!==void 0?p:this.createGroup({id:u});if(b.model.renderContainer=g,n!=null&&n.overridePopoutGroup||this._onDidAddGroup.fire(b),e instanceof Za)this.movingLock(()=>{const C=v.model.removePanel(e);b.model.openPanel(C)});else switch(this.movingLock(()=>ym({from:v,to:b})),x){case"grid":v.api.setVisible(!1);break;case"floating":case"popout":this.removeGroup(v);break}h.classList.add("dv-dockview"),h.style.overflow="hidden",h.appendChild(m),h.appendChild(b.element),b.model.location={type:"popout",getWindow:()=>d.window},this.doSetGroupAndPanelActive(b),f.addDisposables(b.api.onDidActiveChange(C=>{var I;C.isActive&&((I=d.window)===null||I===void 0||I.focus())}),b.api.onWillFocus(()=>{var C;(C=d.window)===null||C===void 0||C.focus()}));let w;const y={window:d,popoutGroup:b,referenceGroup:this.getPanel(v.id)?v.id:void 0,disposable:{dispose:()=>(f.dispose(),w)}};f.addDisposables(zo(d.window,"resize",()=>{b.layout(window.innerWidth,window.innerHeight)}),g,Oi.from(()=>{if(this.getPanel(v.id))this.movingLock(()=>ym({from:b,to:v})),v.api.isVisible||v.api.setVisible(!0),this.getPanel(b.id)&&this.doRemoveGroup(b,{skipPopoutAssociated:!0});else if(this.getPanel(b.id)){const C=this.doRemoveGroup(b,{skipDispose:!0,skipActive:!0});C.model.renderContainer=this.overlayRenderContainer,C.model.location={type:"grid"},w=C}})),this._popoutGroups.push(y),this.updateWatermark()}).catch(h=>{console.error("dockview: failed to create popout window",h)})}addFloatingGroup(e,n){var i,s,o,r,a;let l;if(e instanceof Za)l=this.createGroup(),this._onDidAddGroup.fire(l),this.movingLock(()=>this.removePanel(e,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})),this.movingLock(()=>l.model.openPanel(e,{skipSetGroupActive:!0}));else{l=e;const m=(i=this._popoutGroups.find(x=>x.popoutGroup===l))===null||i===void 0?void 0:i.referenceGroup,g=m?this.getPanel(m):void 0;typeof(n==null?void 0:n.skipRemoveGroup)=="boolean"&&n.skipRemoveGroup||(g?(this.movingLock(()=>ym({from:e,to:g})),this.doRemoveGroup(e,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(g,{skipDispose:!0}),l=g):this.doRemoveGroup(e,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}function c(){if(n!=null&&n.position){const m={};return"left"in n.position?m.left=Math.max(n.position.left,0):"right"in n.position?m.right=Math.max(n.position.right,0):m.left=sr.left,"top"in n.position?m.top=Math.max(n.position.top,0):"bottom"in n.position?m.bottom=Math.max(n.position.bottom,0):m.top=sr.top,typeof n.width=="number"?m.width=Math.max(n.width,0):m.width=sr.width,typeof n.height=="number"?m.height=Math.max(n.height,0):m.height=sr.height,m}return{left:typeof(n==null?void 0:n.x)=="number"?Math.max(n.x,0):sr.left,top:typeof(n==null?void 0:n.y)=="number"?Math.max(n.y,0):sr.top,width:typeof(n==null?void 0:n.width)=="number"?Math.max(n.width,0):sr.width,height:typeof(n==null?void 0:n.height)=="number"?Math.max(n.height,0):sr.height}}const u=c(),d=new cr(Object.assign(Object.assign({container:this.gridview.element,content:l.element},u),{minimumInViewportWidth:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(o=(s=this.options.floatingGroupBounds)===null||s===void 0?void 0:s.minimumWidthWithinViewport)!==null&&o!==void 0?o:Fd,minimumInViewportHeight:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(a=(r=this.options.floatingGroupBounds)===null||r===void 0?void 0:r.minimumHeightWithinViewport)!==null&&a!==void 0?a:Fd})),f=l.element.querySelector(".void-container");if(!f)throw new Error("failed to find drag handle");d.setupDrag(f,{inDragMode:typeof(n==null?void 0:n.inDragMode)=="boolean"?n.inDragMode:!1});const h=new TG(l,d),p=new Nt(l.api.onDidActiveChange(m=>{m.isActive&&d.bringToFront()}),V$(l.element,m=>{const{width:g,height:v}=m.contentRect;l.layout(g,v)}));h.addDisposables(d.onDidChange(()=>{l.layout(l.width,l.height)}),d.onDidChangeEnd(()=>{this._bufferOnDidLayoutChange.fire()}),l.onDidChange(m=>{d.setBounds({height:m==null?void 0:m.height,width:m==null?void 0:m.width})}),{dispose:()=>{p.dispose(),bm(this._floatingGroups,h),l.model.location={type:"grid"},this.updateWatermark()}}),this._floatingGroups.push(h),l.model.location={type:"floating"},n!=null&&n.skipActiveGroup||this.doSetGroupAndPanelActive(l),this.updateWatermark()}orthogonalize(e){switch(e){case"top":case"bottom":this.gridview.orientation===ot.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===ot.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break}switch(e){case"top":case"left":case"center":return this.createGroupAtLocation([0]);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length]);default:throw new Error(`unsupported position ${e}`)}}updateOptions(e){var n,i;super.updateOptions(e);const s="floatingGroupBounds"in e&&e.floatingGroupBounds!==this.options.floatingGroupBounds,o="rootOverlayModel"in e&&e.rootOverlayModel!==this.options.rootOverlayModel;if(this._options=Object.assign(Object.assign({},this.options),e),s)for(const r of this._floatingGroups){switch(this.options.floatingGroupBounds){case"boundedWithinViewport":r.overlay.minimumInViewportHeight=void 0,r.overlay.minimumInViewportWidth=void 0;break;case void 0:r.overlay.minimumInViewportHeight=Fd,r.overlay.minimumInViewportWidth=Fd;break;default:r.overlay.minimumInViewportHeight=(n=this.options.floatingGroupBounds)===null||n===void 0?void 0:n.minimumHeightWithinViewport,r.overlay.minimumInViewportWidth=(i=this.options.floatingGroupBounds)===null||i===void 0?void 0:i.minimumWidthWithinViewport}r.overlay.setBounds()}o&&this._rootDropTarget.setOverlayModel(e.rootOverlayModel),"gap"in e&&e.gap===void 0&&(this.gridview.margin=0),typeof e.gap=="number"&&(this.gridview.margin=e.gap),this.layout(this.gridview.width,this.gridview.height,!0)}layout(e,n,i){if(super.layout(e,n,i),this._floatingGroups)for(const s of this._floatingGroups)s.overlay.setBounds()}focus(){var e;(e=this.activeGroup)===null||e===void 0||e.focus()}getGroupPanel(e){return this.panels.find(n=>n.id===e)}setActivePanel(e){e.group.model.openPanel(e),this.doSetGroupAndPanelActive(e.group)}moveToNext(e={}){var n;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[e.group.panels.length-1]){e.group.model.moveToNext({suppressRoll:!0});return}const i=bn(e.group.element),s=(n=this.gridview.next(i))===null||n===void 0?void 0:n.view;this.doSetGroupAndPanelActive(s)}moveToPrevious(e={}){var n;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[0]){e.group.model.moveToPrevious({suppressRoll:!0});return}const i=bn(e.group.element),s=(n=this.gridview.previous(i))===null||n===void 0?void 0:n.view;s&&this.doSetGroupAndPanelActive(s)}toJSON(){var e;const n=this.gridview.serialize(),i=this.panels.reduce((a,l)=>(a[l.id]=l.toJSON(),a),{}),s=this._floatingGroups.map(a=>({data:a.group.toJSON(),position:a.overlay.toJSON()})),o=this._popoutGroups.map(a=>({data:a.popoutGroup.toJSON(),gridReferenceGroup:a.referenceGroup,position:a.window.dimensions()})),r={grid:n,panels:i,activeGroup:(e=this.activeGroup)===null||e===void 0?void 0:e.id};return s.length>0&&(r.floatingGroups=s),o.length>0&&(r.popoutGroups=o),r}fromJSON(e){var n,i,s;if(this.clear(),typeof e!="object"||e===null)throw new Error("serialized layout must be a non-null object");const{grid:o,panels:r,activeGroup:a}=e;if(o.root.type!=="branch"||!Array.isArray(o.root.data))throw new Error("root must be of type branch");try{const l=this.width,c=this.height,u=h=>{const{id:p,locked:m,hideHeader:g,views:v,activeView:x}=h;if(typeof p!="string")throw new Error("group id must be of type string");const b=this.createGroup({id:p,locked:!!m,hideHeader:!!g}),w=[];for(const y of v){const C=this._deserializer.fromJSON(r[y],b);w.push(C)}this._onDidAddGroup.fire(b);for(let y=0;y<v.length;y++){const C=w[y],I=typeof x=="string"&&x===C.id;b.model.openPanel(C,{skipSetActive:!I,skipSetGroupActive:!0})}return!b.activePanel&&b.panels.length>0&&b.model.openPanel(b.panels[b.panels.length-1],{skipSetGroupActive:!0}),b};this.gridview.deserialize(o,{fromJSON:h=>u(h.data)}),this.layout(l,c,!0);const d=(n=e.floatingGroups)!==null&&n!==void 0?n:[];for(const h of d){const{data:p,position:m}=h,g=u(p);this.addFloatingGroup(g,{position:m,width:m.width,height:m.height,skipRemoveGroup:!0,inDragMode:!1})}const f=(i=e.popoutGroups)!==null&&i!==void 0?i:[];for(const h of f){const{data:p,position:m,gridReferenceGroup:g}=h,v=u(p);this.addPopoutGroup((s=g?this.getPanel(g):void 0)!==null&&s!==void 0?s:v,{skipRemoveGroup:!0,position:m??void 0,overridePopoutGroup:g?v:void 0})}for(const h of this._floatingGroups)h.overlay.setBounds();if(typeof a=="string"){const h=this.getPanel(a);h&&this.doSetGroupAndPanelActive(h)}}catch(l){for(const c of this.groups)for(const u of c.panels)this.removePanel(u,{removeEmptyGroup:!1,skipDispose:!1});for(const c of this.groups)c.dispose(),this._groups.delete(c.id),this._onDidRemoveGroup.fire(c);for(const c of[...this._floatingGroups])c.dispose();throw this.clear(),l}this.updateWatermark(),this._onDidLayoutFromJSON.fire()}clear(){const e=Array.from(this._groups.values()).map(i=>i.value),n=!!this.activeGroup;for(const i of e)this.removeGroup(i,{skipActive:!0});n&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()}closeAllGroups(){for(const e of this._groups.entries()){const[n,i]=e;i.value.model.closeAllPanels()}}addPanel(e){var n,i;if(this.panels.find(r=>r.id===e.id))throw new Error(`panel with id ${e.id} already exists`);let s;if(e.position&&e.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");if(e.position)if(gG(e.position)){const r=typeof e.position.referencePanel=="string"?this.getGroupPanel(e.position.referencePanel):e.position.referencePanel;if(!r)throw new Error(`referencePanel '${e.position.referencePanel}' does not exist`);s=this.findGroup(r)}else if(vG(e.position)){if(s=typeof e.position.referenceGroup=="string"?(n=this._groups.get(e.position.referenceGroup))===null||n===void 0?void 0:n.value:e.position.referenceGroup,!s)throw new Error(`referenceGroup '${e.position.referenceGroup}' does not exist`)}else{const r=this.orthogonalize(Jw(e.position.direction)),a=this.createPanel(e,r);return r.model.openPanel(a,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(r),a}else s=this.activeGroup;let o;if(s){const r=wh(((i=e.position)===null||i===void 0?void 0:i.direction)||"within");if(e.floating){const a=this.createGroup();this._onDidAddGroup.fire(a);const l=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(a,Object.assign(Object.assign({},l),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),o=this.createPanel(e,a),a.model.openPanel(o,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive})}else if(s.api.location.type==="floating"||r==="center")o=this.createPanel(e,s),s.model.openPanel(o,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(s);else{const a=bn(s.element),l=ro(this.gridview.orientation,a,r),c=this.createGroupAtLocation(l);o=this.createPanel(e,c),c.model.openPanel(o,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(c)}}else if(e.floating){const r=this.createGroup();this._onDidAddGroup.fire(r);const a=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(r,Object.assign(Object.assign({},a),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),o=this.createPanel(e,r),r.model.openPanel(o,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive})}else{const r=this.createGroupAtLocation();o=this.createPanel(e,r),r.model.openPanel(o,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(r)}return o}removePanel(e,n={removeEmptyGroup:!0,skipDispose:!1}){const i=e.group;if(!i)throw new Error(`cannot remove panel ${e.id}. it's missing a group.`);i.model.removePanel(e,{skipSetActiveGroup:n.skipSetActiveGroup}),n.skipDispose||(e.group.model.renderContainer.detatch(e),e.dispose()),i.size===0&&n.removeEmptyGroup&&this.removeGroup(i,{skipActive:n.skipSetActiveGroup})}createWatermarkComponent(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new kG}updateWatermark(){var e,n;if(this.groups.filter(i=>i.api.location.type==="grid"&&i.api.isVisible).length===0){if(!this.watermark){this.watermark=this.createWatermarkComponent(),this.watermark.init({containerApi:new Ch(this)});const i=document.createElement("div");i.className="dv-watermark-container",W4(i,"watermark-component"),i.appendChild(this.watermark.element),this.gridview.element.appendChild(i)}}else this.watermark&&(this.watermark.element.parentElement.remove(),(n=(e=this.watermark).dispose)===null||n===void 0||n.call(e),this.watermark=null)}addGroup(e){var n;if(e){let i;if(xG(e)){const l=typeof e.referencePanel=="string"?this.panels.find(c=>c.id===e.referencePanel):e.referencePanel;if(!l)throw new Error(`reference panel ${e.referencePanel} does not exist`);if(i=this.findGroup(l),!i)throw new Error(`reference group for reference panel ${e.referencePanel} does not exist`)}else if(bG(e)){if(i=typeof e.referenceGroup=="string"?(n=this._groups.get(e.referenceGroup))===null||n===void 0?void 0:n.value:e.referenceGroup,!i)throw new Error(`reference group ${e.referenceGroup} does not exist`)}else{const l=this.orthogonalize(Jw(e.direction));return e.skipSetActive||this.doSetGroupAndPanelActive(l),l}const s=wh(e.direction||"within"),o=bn(i.element),r=ro(this.gridview.orientation,o,s),a=this.createGroup(e);return this.doAddGroup(a,r),e.skipSetActive||this.doSetGroupAndPanelActive(a),a}else{const i=this.createGroup(e);return this.doAddGroup(i),this.doSetGroupAndPanelActive(i),i}}removeGroup(e,n){this.doRemoveGroup(e,n)}doRemoveGroup(e,n){var i;const s=[...e.panels];if(!(n!=null&&n.skipDispose))for(const a of s)this.removePanel(a,{removeEmptyGroup:!1,skipDispose:(i=n==null?void 0:n.skipDispose)!==null&&i!==void 0?i:!1});const o=this.activePanel;if(e.api.location.type==="floating"){const a=this._floatingGroups.find(l=>l.group===e);if(a){if(n!=null&&n.skipDispose||(a.group.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)),bm(this._floatingGroups,a),a.dispose(),!(n!=null&&n.skipActive)&&this._activeGroup===e){const l=Array.from(this._groups.values());this.doSetGroupAndPanelActive(l.length>0?l[0].value:void 0)}return a.group}throw new Error("failed to find floating group")}if(e.api.location.type==="popout"){const a=this._popoutGroups.find(l=>l.popoutGroup===e);if(a){if(!(n!=null&&n.skipDispose)){if(!(n!=null&&n.skipPopoutAssociated)){const c=a.referenceGroup?this.getPanel(a.referenceGroup):void 0;c&&this.removeGroup(c)}a.popoutGroup.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)}bm(this._popoutGroups,a);const l=a.disposable.dispose();if(!(n!=null&&n.skipPopoutReturn)&&l&&(this.doAddGroup(l,[0]),this.doSetGroupAndPanelActive(l)),!(n!=null&&n.skipActive)&&this._activeGroup===e){const c=Array.from(this._groups.values());this.doSetGroupAndPanelActive(c.length>0?c[0].value:void 0)}return this.updateWatermark(),a.popoutGroup}throw new Error("failed to find popout group")}const r=super.doRemoveGroup(e,n);return n!=null&&n.skipActive||this.activePanel!==o&&this._onDidActivePanelChange.fire(this.activePanel),r}movingLock(e){const n=this._moving;try{return this._moving=!0,e()}finally{this._moving=n}}moveGroupOrPanel(e){var n;const i=e.to.group,s=e.from.groupId,o=e.from.panelId,r=e.to.position,a=e.to.index,l=s?(n=this._groups.get(s))===null||n===void 0?void 0:n.value:void 0;if(!l)throw new Error(`Failed to find group id ${s}`);if(o===void 0){this.moveGroup({from:{group:l},to:{group:i,position:r}});return}if(!r||r==="center"){const c=this.movingLock(()=>l.model.removePanel(o,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!c)throw new Error(`No panel with id ${o}`);l.model.size===0&&this.doRemoveGroup(l,{skipActive:!0}),this.movingLock(()=>i.model.openPanel(c,{index:a,skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(i),this._onDidMovePanel.fire({panel:c,from:l})}else{const c=bn(i.element),u=ro(this.gridview.orientation,c,r);if(l.size<2){const[d,f]=Bo(u);if(l.api.location.type==="grid"){const g=bn(l.element),[v,x]=Bo(g);if(H$(v,d)){this.gridview.moveView(v,x,f),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:l});return}}if(l.api.location.type==="popout"){const g=this._popoutGroups.find(b=>b.popoutGroup===l),v=this.movingLock(()=>g.popoutGroup.model.removePanel(g.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0}));this.doRemoveGroup(l,{skipActive:!0});const x=this.createGroupAtLocation(u);this.movingLock(()=>x.model.openPanel(v,{skipSetActive:!0})),this.doSetGroupAndPanelActive(x),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:l});return}const h=this.movingLock(()=>this.doRemoveGroup(l,{skipActive:!0,skipDispose:!0})),p=bn(i.element),m=ro(this.gridview.orientation,p,r);this.movingLock(()=>this.doAddGroup(h,m)),this.doSetGroupAndPanelActive(h),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:l})}else{const d=this.movingLock(()=>l.model.removePanel(o,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!d)throw new Error(`No panel with id ${o}`);const f=ro(this.gridview.orientation,c,r),h=this.createGroupAtLocation(f);this.movingLock(()=>h.model.openPanel(d,{skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(h),this._onDidMovePanel.fire({panel:d,from:l})}}}moveGroup(e){const n=e.from.group,i=e.to.group,s=e.to.position;if(s==="center"){const o=n.activePanel,r=this.movingLock(()=>[...n.panels].map(a=>n.model.removePanel(a.id,{skipSetActive:!0})));(n==null?void 0:n.model.size)===0&&this.doRemoveGroup(n,{skipActive:!0}),this.movingLock(()=>{for(const a of r)i.model.openPanel(a,{skipSetActive:a!==o,skipSetGroupActive:!0})}),this.doSetGroupAndPanelActive(i)}else{switch(n.api.location.type){case"grid":this.gridview.removeView(bn(n.element));break;case"floating":{const a=this._floatingGroups.find(l=>l.group===n);if(!a)throw new Error("failed to find floating group");a.dispose();break}case"popout":{const a=this._popoutGroups.find(l=>l.popoutGroup===n);if(!a)throw new Error("failed to find popout group");a.disposable.dispose()}}const o=bn(i.element),r=ro(this.gridview.orientation,o,s);this.gridview.addView(n,is.Distribute,r)}n.panels.forEach(o=>{this._onDidMovePanel.fire({panel:o,from:n})})}doSetGroupActive(e){super.doSetGroupActive(e);const n=this.activePanel;!this._moving&&n!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(n)}doSetGroupAndPanelActive(e){super.doSetGroupActive(e);const n=this.activePanel;e&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(e)&&this.exitMaximizedGroup(),!this._moving&&n!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(n)}getNextGroupId(){let e=this.nextGroupId.next();for(;this._groups.has(e);)e=this.nextGroupId.next();return e}createGroup(e){e||(e={});let n=e==null?void 0:e.id;if(n&&this._groups.has(e.id)&&(console.warn(`dockview: Duplicate group id ${e==null?void 0:e.id}. reassigning group id to avoid errors`),n=void 0),!n)for(n=this.nextGroupId.next();this._groups.has(n);)n=this.nextGroupId.next();const i=new Zw(this,n,e);if(i.init({params:{},accessor:this}),!this._groups.has(i.id)){const s=new Nt(i.model.onTabDragStart(o=>{this._onWillDragPanel.fire(o)}),i.model.onGroupDragStart(o=>{this._onWillDragGroup.fire(o)}),i.model.onMove(o=>{const{groupId:r,itemId:a,target:l,index:c}=o;this.moveGroupOrPanel({from:{groupId:r,panelId:a},to:{group:i,position:l,index:c}})}),i.model.onDidDrop(o=>{this._onDidDrop.fire(o)}),i.model.onWillDrop(o=>{this._onWillDrop.fire(o)}),i.model.onWillShowOverlay(o=>{if(this.options.disableDnd){o.preventDefault();return}this._onWillShowOverlay.fire(o)}),i.model.onUnhandledDragOverEvent(o=>{this._onUnhandledDragOverEvent.fire(o)}),i.model.onDidAddPanel(o=>{this._moving||this._onDidAddPanel.fire(o.panel)}),i.model.onDidRemovePanel(o=>{this._moving||this._onDidRemovePanel.fire(o.panel)}),i.model.onDidActivePanelChange(o=>{this._moving||o.panel===this.activePanel&&this._onDidActivePanelChange.value!==o.panel&&this._onDidActivePanelChange.fire(o.panel)}),ra.any(i.model.onDidPanelTitleChange,i.model.onDidPanelParametersChange)(()=>{this._bufferOnDidLayoutChange.fire()}));this._groups.set(i.id,{value:i,disposable:s})}return i.initialize(),i}createPanel(e,n){var i,s,o;const r=e.component,a=(i=e.tabComponent)!==null&&i!==void 0?i:this.options.defaultTabComponent,l=new iE(this,e.id,r,a),c=new Za(e.id,r,a,this,this._api,n,l,{renderer:e.renderer});return c.init({title:(s=e.title)!==null&&s!==void 0?s:e.id,params:(o=e==null?void 0:e.params)!==null&&o!==void 0?o:{}}),c}createGroupAtLocation(e=[0]){const n=this.createGroup();return this.doAddGroup(n,e),n}findGroup(e){var n;return(n=Array.from(this._groups.values()).find(i=>i.value.model.containsPanel(e)))===null||n===void 0?void 0:n.value}}class FG extends j${get orientation(){return this.gridview.orientation}set orientation(e){this.gridview.orientation=e}get options(){return this._options}get deserializer(){return this._deserializer}set deserializer(e){this._deserializer=e}constructor(e,n){super({parentElement:e,proportionalLayout:n.proportionalLayout,orientation:n.orientation,styles:n.styles,disableAutoResizing:n.disableAutoResizing,className:n.className}),this._onDidLayoutfromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidRemoveGroup=new xe,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new xe,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidActiveGroupChange=new xe,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._options=n,this.addDisposables(this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this.onDidAdd(i=>{this._onDidAddGroup.fire(i)}),this.onDidRemove(i=>{this._onDidRemoveGroup.fire(i)}),this.onDidActiveChange(i=>{this._onDidActiveGroupChange.fire(i)})),this.options.components||(this.options.components={}),this.options.frameworkComponents||(this.options.frameworkComponents={})}updateOptions(e){super.updateOptions(e);const n=typeof e.orientation=="string"&&this.gridview.orientation!==e.orientation;this._options=Object.assign(Object.assign({},this.options),e),n&&(this.gridview.orientation=e.orientation),this.layout(this.gridview.width,this.gridview.height,!0)}removePanel(e){this.removeGroup(e)}toJSON(){var e;return{grid:this.gridview.serialize(),activePanel:(e=this.activeGroup)===null||e===void 0?void 0:e.id}}setVisible(e,n){this.gridview.setViewVisible(bn(e.element),n)}setActive(e){this._groups.forEach((n,i)=>{n.value.setActive(e===n.value)})}focus(){var e;(e=this.activeGroup)===null||e===void 0||e.focus()}fromJSON(e){this.clear();const{grid:n,activePanel:i}=e;try{const s=[],o=this.width,r=this.height;if(this.gridview.deserialize(n,{fromJSON:a=>{var l,c;const{data:u}=a,d=lr(u.id,u.component,(l=this.options.components)!==null&&l!==void 0?l:{},(c=this.options.frameworkComponents)!==null&&c!==void 0?c:{},this.options.frameworkComponentFactory?{createComponent:this.options.frameworkComponentFactory.createComponent}:void 0);return s.push(()=>d.init({params:u.params,minimumWidth:u.minimumWidth,maximumWidth:u.maximumWidth,minimumHeight:u.minimumHeight,maximumHeight:u.maximumHeight,priority:u.priority,snap:!!u.snap,accessor:this,isVisible:a.visible})),this._onDidAddGroup.fire(d),this.registerPanel(d),d}}),this.layout(o,r,!0),s.forEach(a=>a()),typeof i=="string"){const a=this.getPanel(i);a&&this.doSetGroupActive(a)}}catch(s){for(const o of this.groups)o.dispose(),this._groups.delete(o.id),this._onDidRemoveGroup.fire(o);throw this.clear(),s}this._onDidLayoutfromJSON.fire()}clear(){const e=this.activeGroup,n=Array.from(this._groups.values());for(const i of n)i.disposable.dispose(),this.doRemoveGroup(i.value,{skipActive:!0});e&&this.doSetGroupActive(void 0),this.gridview.clear()}movePanel(e,n){var i;let s;const o=this.gridview.remove(e),r=(i=this._groups.get(n.reference))===null||i===void 0?void 0:i.value;if(!r)throw new Error(`reference group ${n.reference} does not exist`);const a=wh(n.direction);if(a==="center")throw new Error(`${a} not supported as an option`);{const l=bn(r.element);s=ro(this.gridview.orientation,l,a)}this.doAddGroup(o,s,n.size)}addPanel(e){var n,i,s,o,r,a;let l=(n=e.location)!==null&&n!==void 0?n:[0];if(!((i=e.position)===null||i===void 0)&&i.referencePanel){const u=(s=this._groups.get(e.position.referencePanel))===null||s===void 0?void 0:s.value;if(!u)throw new Error(`reference group ${e.position.referencePanel} does not exist`);const d=wh(e.position.direction);if(d==="center")throw new Error(`${d} not supported as an option`);{const f=bn(u.element);l=ro(this.gridview.orientation,f,d)}}const c=lr(e.id,e.component,(o=this.options.components)!==null&&o!==void 0?o:{},(r=this.options.frameworkComponents)!==null&&r!==void 0?r:{},this.options.frameworkComponentFactory?{createComponent:this.options.frameworkComponentFactory.createComponent}:void 0);return c.init({params:(a=e.params)!==null&&a!==void 0?a:{},minimumWidth:e.minimumWidth,maximumWidth:e.maximumWidth,minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight,priority:e.priority,snap:!!e.snap,accessor:this,isVisible:!0}),this.registerPanel(c),this.doAddGroup(c,l,e.size),this.doSetGroupActive(c),c}registerPanel(e){const n=new Nt(e.api.onDidFocusChange(i=>{i.isFocused&&this._groups.forEach(s=>{const o=s.value;o!==e?o.setActive(!1):o.setActive(!0)})}));this._groups.set(e.id,{value:e,disposable:n})}moveGroup(e,n,i){const s=this.getPanel(n);if(!s)throw new Error("invalid operation");const o=bn(e.element),r=ro(this.gridview.orientation,o,i),[a,l]=Bo(r),c=bn(s.element),[u,d]=Bo(c);if(H$(u,a)){this.gridview.moveView(u,d,l);return}const f=this.doRemoveGroup(s,{skipActive:!0,skipDispose:!0}),h=bn(e.element),p=ro(this.gridview.orientation,h,i);this.doAddGroup(f,p)}removeGroup(e){super.removeGroup(e)}dispose(){super.dispose(),this._onDidLayoutfromJSON.dispose()}}class LG extends cx{get panels(){return this.splitview.getViews()}get options(){return this._options}get length(){return this._panels.size}get orientation(){return this.splitview.orientation}get splitview(){return this._splitview}set splitview(e){this._splitview=e,this._splitviewChangeDisposable.value=new Nt(this._splitview.onDidSashEnd(()=>{this._onDidLayoutChange.fire(void 0)}),this._splitview.onDidAddView(n=>this._onDidAddView.fire(n)),this._splitview.onDidRemoveView(n=>this._onDidRemoveView.fire(n)))}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get height(){return this.splitview.orientation===ot.HORIZONTAL?this.splitview.orthogonalSize:this.splitview.size}get width(){return this.splitview.orientation===ot.HORIZONTAL?this.splitview.size:this.splitview.orthogonalSize}constructor(e,n){var i,s;super(e,n.disableAutoResizing),this._splitviewChangeDisposable=new Xi,this._panels=new Map,this._onDidLayoutfromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidAddView=new xe,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new xe,this.onDidRemoveView=this._onDidRemoveView.event,this._onDidLayoutChange=new xe,this.onDidLayoutChange=this._onDidLayoutChange.event,this.classNames=[],this.classNames=(s=(i=n.className)===null||i===void 0?void 0:i.split(" "))!==null&&s!==void 0?s:[];for(const o of this.classNames)gt(this.element,o,!0);this._options=n,n.components||(n.components={}),n.frameworkComponents||(n.frameworkComponents={}),this.splitview=new Bc(this.element,n),this.addDisposables(this._onDidAddView,this._onDidLayoutfromJSON,this._onDidRemoveView,this._onDidLayoutChange)}updateOptions(e){var n,i;if("className"in e){for(const o of this.classNames)gt(this.element,o,!1);this.classNames=(i=(n=e.className)===null||n===void 0?void 0:n.split(" "))!==null&&i!==void 0?i:[];for(const o of this.classNames)gt(this.element,o,!0)}const s=typeof e.orientation=="string"&&this.options.orientation!==e.orientation;this._options=Object.assign(Object.assign({},this.options),e),s&&(this.splitview.orientation=e.orientation),this.splitview.layout(this.splitview.size,this.splitview.orthogonalSize)}focus(){var e;(e=this._activePanel)===null||e===void 0||e.focus()}movePanel(e,n){this.splitview.moveView(e,n)}setVisible(e,n){const i=this.panels.indexOf(e);this.splitview.setViewVisible(i,n)}setActive(e,n){this._activePanel=e,this.panels.filter(i=>i!==e).forEach(i=>{i.api._onDidActiveChange.fire({isActive:!1}),n||i.focus()}),e.api._onDidActiveChange.fire({isActive:!0}),n||e.focus()}removePanel(e,n){const i=this._panels.get(e.id);if(!i)throw new Error(`unknown splitview panel ${e.id}`);i.dispose(),this._panels.delete(e.id);const s=this.panels.findIndex(a=>a===e);this.splitview.removeView(s,n).dispose();const r=this.panels;r.length>0&&this.setActive(r[r.length-1])}getPanel(e){return this.panels.find(n=>n.id===e)}addPanel(e){var n,i,s;if(this._panels.has(e.id))throw new Error(`panel ${e.id} already exists`);const o=lr(e.id,e.component,(n=this.options.components)!==null&&n!==void 0?n:{},(i=this.options.frameworkComponents)!==null&&i!==void 0?i:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.createComponent}:void 0);o.orientation=this.splitview.orientation,o.init({params:(s=e.params)!==null&&s!==void 0?s:{},minimumSize:e.minimumSize,maximumSize:e.maximumSize,snap:e.snap,priority:e.priority,accessor:this});const r=typeof e.size=="number"?e.size:is.Distribute,a=typeof e.index=="number"?e.index:void 0;return this.splitview.addView(o,r,a),this.doAddView(o),this.setActive(o),o}layout(e,n){const[i,s]=this.splitview.orientation===ot.HORIZONTAL?[e,n]:[n,e];this.splitview.layout(i,s)}doAddView(e){const n=e.api.onDidFocusChange(i=>{i.isFocused&&this.setActive(e,!0)});this._panels.set(e.id,n)}toJSON(){var e;return{views:this.splitview.getViews().map((i,s)=>({size:this.splitview.getViewSize(s),data:i.toJSON(),snap:!!i.snap,priority:i.priority})),activeView:(e=this._activePanel)===null||e===void 0?void 0:e.id,size:this.splitview.size,orientation:this.splitview.orientation}}fromJSON(e){this.clear();const{views:n,orientation:i,size:s,activeView:o}=e,r=[],a=this.width,l=this.height;if(this.splitview=new Bc(this.element,{orientation:i,proportionalLayout:this.options.proportionalLayout,descriptor:{size:s,views:n.map(c=>{var u,d;const f=c.data;if(this._panels.has(f.id))throw new Error(`panel ${f.id} already exists`);const h=lr(f.id,f.component,(u=this.options.components)!==null&&u!==void 0?u:{},(d=this.options.frameworkComponents)!==null&&d!==void 0?d:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.createComponent}:void 0);return r.push(()=>{var p;h.init({params:(p=f.params)!==null&&p!==void 0?p:{},minimumSize:f.minimumSize,maximumSize:f.maximumSize,snap:c.snap,priority:c.priority,accessor:this})}),h.orientation=i,this.doAddView(h),setTimeout(()=>{this._onDidAddView.fire(h)},0),{size:c.size,view:h}})}}),this.layout(a,l),r.forEach(c=>c()),typeof o=="string"){const c=this.getPanel(o);c&&this.setActive(c)}this._onDidLayoutfromJSON.fire()}clear(){for(const e of this._panels.values())e.dispose();for(this._panels.clear();this.splitview.length>0;)this.splitview.removeView(0,is.Distribute,!0).dispose()}dispose(){for(const n of this._panels.values())n.dispose();this._panels.clear();const e=this.splitview.getViews();this._splitviewChangeDisposable.dispose(),this.splitview.dispose();for(const n of e)n.dispose();super.dispose()}}class tC extends Nt{get element(){return this._element}constructor(){super(),this._expandedIcon=$G(),this._collapsedIcon=EG(),this.disposable=new Xi,this.apiRef={api:null},this._element=document.createElement("div"),this.element.className="default-header",this._content=document.createElement("span"),this._expander=document.createElement("div"),this._expander.className="dockview-pane-header-icon",this.element.appendChild(this._expander),this.element.appendChild(this._content),this.addDisposables(sn(this._element,"click",()=>{var e;(e=this.apiRef.api)===null||e===void 0||e.setExpanded(!this.apiRef.api.isExpanded)}))}init(e){this.apiRef.api=e.api,this._content.textContent=e.title,this.updateIcon(),this.disposable.value=e.api.onDidExpansionChange(()=>{this.updateIcon()})}updateIcon(){var e;const n=!!(!((e=this.apiRef.api)===null||e===void 0)&&e.isExpanded);gt(this._expander,"collapsed",!n),n?(this._expander.contains(this._collapsedIcon)&&this._collapsedIcon.remove(),this._expander.contains(this._expandedIcon)||this._expander.appendChild(this._expandedIcon)):(this._expander.contains(this._expandedIcon)&&this._expandedIcon.remove(),this._expander.contains(this._collapsedIcon)||this._expander.appendChild(this._collapsedIcon))}update(e){}dispose(){this.disposable.dispose(),super.dispose()}}const zG=lx();class nC extends lG{constructor(e){super(e.accessor,e.id,e.component,e.headerComponent,e.orientation,e.isExpanded,e.disableDnd),this.options=e}getBodyComponent(){return this.options.body}getHeaderComponent(){return this.options.header}}class BG extends cx{get id(){return this._id}get panels(){return this.paneview.getPanes()}set paneview(e){this._paneview=e,this._disposable.value=new Nt(this._paneview.onDidChange(()=>{this._onDidLayoutChange.fire(void 0)}),this._paneview.onDidAddView(n=>this._onDidAddView.fire(n)),this._paneview.onDidRemoveView(n=>this._onDidRemoveView.fire(n)))}get paneview(){return this._paneview}get minimumSize(){return this.paneview.minimumSize}get maximumSize(){return this.paneview.maximumSize}get height(){return this.paneview.orientation===ot.HORIZONTAL?this.paneview.orthogonalSize:this.paneview.size}get width(){return this.paneview.orientation===ot.HORIZONTAL?this.paneview.size:this.paneview.orthogonalSize}get options(){return this._options}constructor(e,n){var i,s;super(e,n.disableAutoResizing),this._id=zG.next(),this._disposable=new Xi,this._viewDisposables=new Map,this._onDidLayoutfromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidLayoutChange=new xe,this.onDidLayoutChange=this._onDidLayoutChange.event,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,this._onDidAddView=new xe,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new xe,this.onDidRemoveView=this._onDidRemoveView.event,this.classNames=[],this.addDisposables(this._onDidLayoutChange,this._onDidLayoutfromJSON,this._onDidDrop,this._onDidAddView,this._onDidRemoveView),this.classNames=(s=(i=n.className)===null||i===void 0?void 0:i.split(" "))!==null&&s!==void 0?s:[];for(const o of this.classNames)gt(this.element,o,!0);this._options=n,n.components||(n.components={}),n.frameworkComponents||(n.frameworkComponents={}),this.paneview=new Yw(this.element,{orientation:ot.VERTICAL}),this.addDisposables(this._disposable)}setVisible(e,n){const i=this.panels.indexOf(e);this.paneview.setViewVisible(i,n)}focus(){}updateOptions(e){var n,i;if("className"in e){for(const s of this.classNames)gt(this.element,s,!1);this.classNames=(i=(n=e.className)===null||n===void 0?void 0:n.split(" "))!==null&&i!==void 0?i:[];for(const s of this.classNames)gt(this.element,s,!0)}this._options=Object.assign(Object.assign({},this.options),e)}addPanel(e){var n,i,s,o;const r=lr(e.id,e.component,(n=this.options.components)!==null&&n!==void 0?n:{},(i=this.options.frameworkComponents)!==null&&i!==void 0?i:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.body.createComponent}:void 0);let a;e.headerComponent?a=lr(e.id,e.headerComponent,(s=this.options.headerComponents)!==null&&s!==void 0?s:{},this.options.headerframeworkComponents,this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.header.createComponent}:void 0):a=new tC;const l=new nC({id:e.id,component:e.component,headerComponent:e.headerComponent,header:a,body:r,orientation:ot.VERTICAL,isExpanded:!!e.isExpanded,disableDnd:!!this.options.disableDnd,accessor:this});this.doAddPanel(l);const c=typeof e.size=="number"?e.size:is.Distribute,u=typeof e.index=="number"?e.index:void 0;return l.init({params:(o=e.params)!==null&&o!==void 0?o:{},minimumBodySize:e.minimumBodySize,maximumBodySize:e.maximumBodySize,isExpanded:e.isExpanded,title:e.title,containerApi:new Vc(this),accessor:this}),this.paneview.addPane(l,c,u),l.orientation=this.paneview.orientation,l}removePanel(e){const i=this.panels.findIndex(s=>s===e);this.paneview.removePane(i),this.doRemovePanel(e)}movePanel(e,n){this.paneview.moveView(e,n)}getPanel(e){return this.panels.find(n=>n.id===e)}layout(e,n){const[i,s]=this.paneview.orientation===ot.HORIZONTAL?[e,n]:[n,e];this.paneview.layout(i,s)}toJSON(){const e=s=>s===Number.MAX_SAFE_INTEGER||s===Number.POSITIVE_INFINITY?void 0:s,n=s=>s<=0?void 0:s;return{views:this.paneview.getPanes().map((s,o)=>({size:this.paneview.getViewSize(o),data:s.toJSON(),minimumSize:n(s.minimumBodySize),maximumSize:e(s.maximumBodySize),expanded:s.isExpanded()})),size:this.paneview.size}}fromJSON(e){this.clear();const{views:n,size:i}=e,s=[],o=this.width,r=this.height;this.paneview=new Yw(this.element,{orientation:ot.VERTICAL,descriptor:{size:i,views:n.map(a=>{var l,c,u,d;const f=a.data,h=lr(f.id,f.component,(l=this.options.components)!==null&&l!==void 0?l:{},(c=this.options.frameworkComponents)!==null&&c!==void 0?c:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.body.createComponent}:void 0);let p;f.headerComponent?p=lr(f.id,f.headerComponent,(u=this.options.headerComponents)!==null&&u!==void 0?u:{},(d=this.options.headerframeworkComponents)!==null&&d!==void 0?d:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.header.createComponent}:void 0):p=new tC;const m=new nC({id:f.id,component:f.component,headerComponent:f.headerComponent,header:p,body:h,orientation:ot.VERTICAL,isExpanded:!!a.expanded,disableDnd:!!this.options.disableDnd,accessor:this});return this.doAddPanel(m),s.push(()=>{var g;m.init({params:(g=f.params)!==null&&g!==void 0?g:{},minimumBodySize:a.minimumSize,maximumBodySize:a.maximumSize,title:f.title,isExpanded:!!a.expanded,containerApi:new Vc(this),accessor:this}),m.orientation=this.paneview.orientation}),setTimeout(()=>{this._onDidAddView.fire(m)},0),{size:a.size,view:m}})}}),this.layout(o,r),s.forEach(a=>a()),this._onDidLayoutfromJSON.fire()}clear(){for(const[e,n]of this._viewDisposables.entries())n.dispose();this._viewDisposables.clear(),this.paneview.dispose()}doAddPanel(e){const n=e.onDidDrop(i=>{this._onDidDrop.fire(i)});this._viewDisposables.set(e.id,n)}doRemovePanel(e){const n=this._viewDisposables.get(e.id);n&&(n.dispose(),this._viewDisposables.delete(e.id))}dispose(){super.dispose();for(const[e,n]of this._viewDisposables.entries())n.dispose();this._viewDisposables.clear(),this.paneview.dispose()}}class VG extends dx{get priority(){return this._priority}set orientation(e){this._orientation=e}get orientation(){return this._orientation}get minimumSize(){const e=typeof this._minimumSize=="function"?this._minimumSize():this._minimumSize;return e!==this._evaluatedMinimumSize&&(this._evaluatedMinimumSize=e,this.updateConstraints()),e}get maximumSize(){const e=typeof this._maximumSize=="function"?this._maximumSize():this._maximumSize;return e!==this._evaluatedMaximumSize&&(this._evaluatedMaximumSize=e,this.updateConstraints()),e}get snap(){return this._snap}constructor(e,n){super(e,n,new Z$(e,n)),this._evaluatedMinimumSize=0,this._evaluatedMaximumSize=Number.POSITIVE_INFINITY,this._minimumSize=0,this._maximumSize=Number.POSITIVE_INFINITY,this._snap=!1,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this.api.initialize(this),this.addDisposables(this._onDidChange,this.api.onWillVisibilityChange(i=>{const{isVisible:s}=i,{accessor:o}=this._params;o.setVisible(this,s)}),this.api.onActiveChange(()=>{const{accessor:i}=this._params;i.setActive(this)}),this.api.onDidConstraintsChangeInternal(i=>{(typeof i.minimumSize=="number"||typeof i.minimumSize=="function")&&(this._minimumSize=i.minimumSize),(typeof i.maximumSize=="number"||typeof i.maximumSize=="function")&&(this._maximumSize=i.maximumSize),this.updateConstraints()}),this.api.onDidSizeChange(i=>{this._onDidChange.fire({size:i.size})}))}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}layout(e,n){const[i,s]=this.orientation===ot.HORIZONTAL?[e,n]:[n,e];super.layout(i,s)}init(e){super.init(e),this._priority=e.priority,e.minimumSize&&(this._minimumSize=e.minimumSize),e.maximumSize&&(this._maximumSize=e.maximumSize),e.snap&&(this._snap=e.snap)}toJSON(){const e=i=>i===Number.MAX_SAFE_INTEGER||i===Number.POSITIVE_INFINITY?void 0:i,n=i=>i<=0?void 0:i;return Object.assign(Object.assign({},super.toJSON()),{minimumSize:n(this.minimumSize),maximumSize:e(this.maximumSize)})}updateConstraints(){this.api._onDidConstraintsChange.fire({maximumSize:this._evaluatedMaximumSize,minimumSize:this._evaluatedMinimumSize})}}function WG(t,e){return new MG(t,e).api}function GG(t,e){const n=new LG(t,e);return new K$(n)}function HG(t,e){const n=new FG(t,e);return new X$(n)}function UG(t,e){const n=new BG(t,e);return new Vc(n)}const oE=(t,e)=>{const[n,i]=ce.useState(),s=ce.useRef(t.componentProps);return ce.useImperativeHandle(e,()=>({update:o=>{s.current=Object.assign(Object.assign({},s.current),o),i(Date.now())}}),[]),ce.createElement(t.component,s.current)};oE.displayName="DockviewReactJsBridge";const jG=(()=>{let t=1;return{next:()=>`dockview_react_portal_key_${(t++).toString()}`}})(),KG=ce.createContext({});class _a{constructor(e,n,i,s,o){this.parent=e,this.portalStore=n,this.component=i,this.parameters=s,this.context=o,this._initialProps={},this.disposed=!1,this.createPortal()}update(e){if(this.disposed)throw new Error("invalid operation: resource is already disposed");this.componentInstance?this.componentInstance.update(e):this._initialProps=Object.assign(Object.assign({},this._initialProps),e)}createPortal(){if(this.disposed)throw new Error("invalid operation: resource is already disposed");if(!XG(this.component))throw new Error("Dockview: Only React.memo(...), React.ForwardRef(...) and functional components are accepted as components");const e=ce.createElement(ce.forwardRef(oE),{component:this.component,componentProps:this.parameters,ref:s=>{this.componentInstance=s,Object.keys(this._initialProps).length>0&&(this.componentInstance.update(this._initialProps),this._initialProps={})}}),n=this.context?ce.createElement(KG.Provider,{value:this.context},e):e,i=jm.createPortal(n,this.parent,jG.next());this.ref={portal:i,disposable:this.portalStore.addPortal(i)}}dispose(){var e;(e=this.ref)===null||e===void 0||e.disposable.dispose(),this.disposed=!0}}const bf=()=>{const[t,e]=ce.useState([]);ce.useDebugValue(`Portal count: ${t.length}`);const n=ce.useCallback(i=>{e(o=>[...o,i]);let s=!1;return Oi.from(()=>{if(s)throw new Error("invalid operation: resource already disposed");s=!0,e(o=>o.filter(r=>r!==i))})},[]);return[t,n]};function XG(t){return typeof t=="function"||!!(t!=null&&t.$$typeof)}class iC{get element(){return this._element}constructor(e,n,i){this.id=e,this.component=n,this.reactPortalStore=i,this._onDidFocus=new xe,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new xe,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(e){this.part=new _a(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,containerApi:e.containerApi})}update(e){var n;(n=this.part)===null||n===void 0||n.update({params:e.params})}layout(e,n){}dispose(){var e;this._onDidFocus.dispose(),this._onDidBlur.dispose(),(e=this.part)===null||e===void 0||e.dispose()}}class sC{get element(){return this._element}constructor(e,n,i){this.id=e,this.component=n,this.reactPortalStore=i,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(e){this.part=new _a(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,containerApi:e.containerApi})}update(e){var n;(n=this.part)===null||n===void 0||n.update({params:e.params})}layout(e,n){}dispose(){var e;(e=this.part)===null||e===void 0||e.dispose()}}class oC{get element(){return this._element}constructor(e,n,i){this.id=e,this.component=n,this.reactPortalStore=i,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(e){this.part=new _a(this.element,this.reactPortalStore,this.component,{group:e.group,containerApi:e.containerApi})}focus(){}update(e){var n,i,s;this.parameters&&(this.parameters.params=e.params),(n=this.part)===null||n===void 0||n.update({params:(s=(i=this.parameters)===null||i===void 0?void 0:i.params)!==null&&s!==void 0?s:{}})}layout(e,n){}updateParentGroup(e,n){}dispose(){var e;(e=this.part)===null||e===void 0||e.dispose()}}class qG{get element(){return this._element}get part(){return this._part}constructor(e,n,i){this.component=e,this.reactPortalStore=n,this._group=i,this.mutableDisposable=new Xi,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(e){this.mutableDisposable.value=new Nt(this._group.model.onDidAddPanel(()=>{this.updatePanels()}),this._group.model.onDidRemovePanel(()=>{this.updatePanels()}),this._group.model.onDidActivePanelChange(()=>{this.updateActivePanel()}),e.api.onDidActiveChange(()=>{this.updateGroupActive()})),this._part=new _a(this.element,this.reactPortalStore,this.component,{api:e.api,containerApi:e.containerApi,panels:this._group.model.panels,activePanel:this._group.model.activePanel,isGroupActive:this._group.api.isActive,group:this._group})}dispose(){var e;this.mutableDisposable.dispose(),(e=this._part)===null||e===void 0||e.dispose()}update(e){var n;(n=this._part)===null||n===void 0||n.update(e.params)}updatePanels(){this.update({params:{panels:this._group.model.panels}})}updateActivePanel(){this.update({params:{activePanel:this._group.model.activePanel}})}updateGroupActive(){this.update({params:{isGroupActive:this._group.api.isActive}})}}function Ka(t,e){return t?n=>new qG(t,e,n):void 0}const Ld="props.defaultTabComponent";function YG(t){return xg.reduce((n,i)=>(i in t&&(n[i]=t[i]),n),{})}const JG=ce.forwardRef((t,e)=>{const n=ce.useRef(null),i=ce.useRef(),[s,o]=bf();ce.useImperativeHandle(e,()=>n.current,[]);const r=ce.useRef({});return ce.useEffect(()=>{const a={};xg.forEach(l=>{const c=l,u=t[c];c in t&&u!==r.current[c]&&(a[c]=u)}),i.current&&i.current.updateOptions(a),r.current=t},xg.map(a=>t[a])),ce.useEffect(()=>{var a;if(!n.current)return;const l=(a=t.tabComponents)!==null&&a!==void 0?a:{};t.defaultTabComponent&&(l[Ld]=t.defaultTabComponent);const c={createLeftHeaderActionComponent:Ka(t.leftHeaderActionsComponent,{addPortal:o}),createRightHeaderActionComponent:Ka(t.rightHeaderActionsComponent,{addPortal:o}),createPrefixHeaderActionComponent:Ka(t.prefixHeaderActionsComponent,{addPortal:o}),createComponent:h=>new iC(h.id,t.components[h.name],{addPortal:o}),createTabComponent(h){return new sC(h.id,l[h.name],{addPortal:o})},createWatermarkComponent:t.watermarkComponent?()=>new oC("watermark",t.watermarkComponent,{addPortal:o}):void 0,defaultTabComponent:t.defaultTabComponent?Ld:void 0},u=WG(n.current,Object.assign(Object.assign({},YG(t)),c)),{clientWidth:d,clientHeight:f}=n.current;return u.layout(d,f),t.onReady&&t.onReady({api:u}),i.current=u,()=>{u.dispose()}},[]),ce.useEffect(()=>{if(!i.current)return()=>{};const a=i.current.onDidDrop(l=>{t.onDidDrop&&t.onDidDrop(l)});return()=>{a.dispose()}},[t.onDidDrop]),ce.useEffect(()=>{if(!i.current)return()=>{};const a=i.current.onUnhandledDragOverEvent(l=>{var c;!((c=t.showDndOverlay)===null||c===void 0)&&c.call(t,l)&&l.accept()});return()=>{a.dispose()}},[t.showDndOverlay]),ce.useEffect(()=>{if(!i.current)return()=>{};const a=i.current.onWillDrop(l=>{t.onWillDrop&&t.onWillDrop(l)});return()=>{a.dispose()}},[t.onWillDrop]),ce.useEffect(()=>{i.current&&i.current.updateOptions({createComponent:a=>new iC(a.id,t.components[a.name],{addPortal:o})})},[t.components]),ce.useEffect(()=>{var a;if(!i.current)return;const l=(a=t.tabComponents)!==null&&a!==void 0?a:{};t.defaultTabComponent&&(l[Ld]=t.defaultTabComponent),i.current.updateOptions({defaultTabComponent:t.defaultTabComponent?Ld:void 0,createTabComponent(c){return new sC(c.id,l[c.name],{addPortal:o})}})},[t.tabComponents,t.defaultTabComponent]),ce.useEffect(()=>{i.current&&i.current.updateOptions({createWatermarkComponent:t.watermarkComponent?()=>new oC("watermark",t.watermarkComponent,{addPortal:o}):void 0})},[t.watermarkComponent]),ce.useEffect(()=>{i.current&&i.current.updateOptions({createRightHeaderActionComponent:Ka(t.rightHeaderActionsComponent,{addPortal:o})})},[t.rightHeaderActionsComponent]),ce.useEffect(()=>{i.current&&i.current.updateOptions({createLeftHeaderActionComponent:Ka(t.leftHeaderActionsComponent,{addPortal:o})})},[t.leftHeaderActionsComponent]),ce.useEffect(()=>{i.current&&i.current.updateOptions({createPrefixHeaderActionComponent:Ka(t.prefixHeaderActionsComponent,{addPortal:o})})},[t.prefixHeaderActionsComponent]),ce.createElement("div",{className:t.className,style:{height:"100%",width:"100%"},ref:n},s)});JG.displayName="DockviewComponent";class ZG extends VG{constructor(e,n,i,s){super(e,n),this.reactComponent=i,this.reactPortalStore=s}getComponent(){var e,n;return new _a(this.element,this.reactPortalStore,this.reactComponent,{params:(n=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&n!==void 0?n:{},api:this.api,containerApi:new K$(this._params.accessor)})}}const QG=ce.forwardRef((t,e)=>{const n=ce.useRef(null),i=ce.useRef(),[s,o]=bf();return ce.useImperativeHandle(e,()=>n.current,[]),ce.useEffect(()=>{var r;const a=GG(n.current,{disableAutoResizing:t.disableAutoResizing,orientation:(r=t.orientation)!==null&&r!==void 0?r:ot.HORIZONTAL,frameworkComponents:t.components,frameworkWrapper:{createComponent:(u,d,f)=>new ZG(u,d,f,{addPortal:o})},proportionalLayout:typeof t.proportionalLayout=="boolean"?t.proportionalLayout:!0,styles:t.hideBorders?{separatorBorder:"transparent"}:void 0}),{clientWidth:l,clientHeight:c}=n.current;return a.layout(l,c),t.onReady&&t.onReady({api:a}),i.current=a,()=>{a.dispose()}},[]),ce.useEffect(()=>{i.current&&i.current.updateOptions({frameworkComponents:t.components})},[t.components]),ce.createElement("div",{className:t.className,style:{height:"100%",width:"100%"},ref:n},s)});QG.displayName="SplitviewComponent";class eH extends tE{constructor(e,n,i,s){super(e,n),this.reactComponent=i,this.reactPortalStore=s}getComponent(){var e,n;return new _a(this.element,this.reactPortalStore,this.reactComponent,{params:(n=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&n!==void 0?n:{},api:this.api,containerApi:new X$(this._params.accessor)})}}const tH=ce.forwardRef((t,e)=>{const n=ce.useRef(null),i=ce.useRef(),[s,o]=bf();return ce.useImperativeHandle(e,()=>n.current,[]),ce.useEffect(()=>{var r;if(!n.current)return()=>{};const a=HG(n.current,{disableAutoResizing:t.disableAutoResizing,proportionalLayout:typeof t.proportionalLayout=="boolean"?t.proportionalLayout:!0,orientation:(r=t.orientation)!==null&&r!==void 0?r:ot.HORIZONTAL,frameworkComponents:t.components,frameworkComponentFactory:{createComponent:(u,d,f)=>new eH(u,d,f,{addPortal:o})},styles:t.hideBorders?{separatorBorder:"transparent"}:void 0}),{clientWidth:l,clientHeight:c}=n.current;return a.layout(l,c),t.onReady&&t.onReady({api:a}),i.current=a,()=>{a.dispose()}},[]),ce.useEffect(()=>{i.current&&i.current.updateOptions({frameworkComponents:t.components})},[t.components]),ce.createElement("div",{className:t.className,style:{height:"100%",width:"100%"},ref:n},s)});tH.displayName="GridviewComponent";class nH{get element(){return this._element}constructor(e,n,i){this.id=e,this.component=n,this.reactPortalStore=i,this._element=document.createElement("div"),this._element.style.height="100%",this._element.style.width="100%"}init(e){this.part=new _a(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,title:e.title,containerApi:e.containerApi})}toJSON(){return{id:this.id}}update(e){var n;(n=this.part)===null||n===void 0||n.update(e.params)}dispose(){var e;(e=this.part)===null||e===void 0||e.dispose()}}const iH=ce.forwardRef((t,e)=>{const n=ce.useRef(null),i=ce.useRef(),[s,o]=bf();return ce.useImperativeHandle(e,()=>n.current,[]),ce.useEffect(()=>{const r=(u,d,f)=>new nH(u,f,{addPortal:o}),a=UG(n.current,{disableAutoResizing:t.disableAutoResizing,frameworkComponents:t.components,components:{},headerComponents:{},disableDnd:t.disableDnd,headerframeworkComponents:t.headerComponents,frameworkWrapper:{header:{createComponent:r},body:{createComponent:r}},showDndOverlay:t.showDndOverlay}),{clientWidth:l,clientHeight:c}=n.current;return a.layout(l,c),t.onReady&&t.onReady({api:a}),i.current=a,()=>{a.dispose()}},[]),ce.useEffect(()=>{i.current&&i.current.updateOptions({frameworkComponents:t.components})},[t.components]),ce.useEffect(()=>{i.current&&i.current.updateOptions({headerframeworkComponents:t.headerComponents})},[t.headerComponents]),ce.useEffect(()=>{if(!i.current)return()=>{};const r=i.current,a=r.onDidDrop(l=>{t.onDidDrop&&t.onDidDrop(Object.assign(Object.assign({},l),{api:r}))});return()=>{a.dispose()}},[t.onDidDrop]),ce.useEffect(()=>{i.current&&i.current.updateOptions({showDndOverlay:t.showDndOverlay})},[t.showDndOverlay]),ce.createElement("div",{className:t.className,style:{height:"100%",width:"100%"},ref:n},s)});iH.displayName="PaneviewComponent";var ci=(t=>(t.Neuron="neuron",t.Axon="axon",t))(ci||{}),aa=(t=>(t.Input="input",t.Hidden="hidden",t.Output="output",t))(aa||{});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=1e-7,oH=1e-4;class rE{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class mx{refCount(e){return Bi("refCount")}incRef(e){return Bi("incRef")}timerAvailable(){return!0}time(e){return Bi("time")}read(e){return Bi("read")}readSync(e){return Bi("readSync")}readToGPU(e,n){return Bi("readToGPU")}numDataIds(){return Bi("numDataIds")}disposeData(e,n){return Bi("disposeData")}write(e,n,i){return Bi("write")}move(e,n,i,s,o){return Bi("move")}createTensorFromGPUData(e,n,i){return Bi("createTensorFromGPUData")}memory(){return Bi("memory")}floatPrecision(){return Bi("floatPrecision")}epsilon(){return this.floatPrecision()===32?sH:oH}dispose(){return Bi("dispose")}}function Bi(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Qa(t,e,n)}function fa(t,e,n){return Math.max(t,Math.min(e,n))}function gx(t){return t%2===0?t:t+1}function Qa(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function aH(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function F(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function vx(t,e,n=""){F(Wt(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function aE(t){F(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function pe(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Wt(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Dl(t){return t%1===0}function bg(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function ll(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function rC(t,e=s=>0,n,i){return new Promise((s,o)=>{let r=0;const a=()=>{if(t()){s();return}r++;const l=e(r);if(n!=null&&r>=n){o();return}i!=null?i(a,l):setTimeout(a,l)};a()})}function lE(t,e){let n=1,i=-1;for(let o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(t[o]===-1){if(i!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${o}`);i=o}else if(t[o]<0)throw Error(`Shapes can not be < 0. Found ${t[o]} at dim ${o}`);if(i===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[i]=e/n,s}function St(t,e){const n=e.length;return t=t==null?e.map((i,s)=>s):[].concat(t),F(t.every(i=>i>=-n&&i<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),F(t.every(i=>Dl(i)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(i=>i<0?n+i:i)}function Dr(t,e){const n=[],i=[],s=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||s?null:St(e,t).sort();let r=0;for(let a=0;a<t.length;++a){if(o!=null){if(o[r]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(o[r]==null||o[r]>a)&&t[a]===1&&(n.push(t[a]),i.push(a)),o[r]<=a&&r++}t[a]!==1&&(n.push(t[a]),i.push(a))}return{newShape:n,keptDims:i}}function di(t,e){return wn(t,e)}function wn(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function lH(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${e} being uploaded contains ${i}.`)}}function cH(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function cE(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Ih(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function uH(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function au(t){return typeof t=="string"||t instanceof String}function dH(t){return typeof t=="boolean"}function yg(t){return typeof t=="number"}function Yl(t){return Array.isArray(t)?Yl(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":yg(t)?"float32":au(t)?"string":dH(t)?"bool":"float32"}function wg(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Cg(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Ye(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let i=e-3;i>=0;--i)n[i]=n[i+1]*t[i+1];return n}function uE(t,e,n,i=!1){const s=new Array;if(e.length===1){const o=e[0]*(i?2:1);for(let r=0;r<o;r++)s[r]=n[t+r]}else{const o=e[0],r=e.slice(1),a=r.reduce((l,c)=>l*c)*(i?2:1);for(let l=0;l<o;l++)s[l]=uE(t+l*a,r,n,i)}return s}function Hs(t,e,n=!1){if(t.length===0)return e[0];const i=t.reduce((s,o)=>s*o)*(n?2:1);if(i===0)return[];if(i!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return uE(0,t,e,n)}function hH(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function xx(t,e){const n=hi(t,e);for(let i=0;i<n.length;i++)n[i]=1;return n}function hi(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function dE(t,e){const n=t.reduce((i,s)=>i*s,1);if(e==null||e==="float32")return Hs(t,new Float32Array(n));if(e==="int32")return Hs(t,new Int32Array(n));if(e==="bool")return Hs(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Qo(t){t.forEach(e=>{F(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function mo(t,e,n){if(e===0)return 0;if(e===1)return t[0];let i=t[t.length-1];for(let s=0;s<t.length-1;++s)i+=n[s]*t[s];return i}function Jl(t,e,n){if(e===0)return[];if(e===1)return[t];const i=new Array(e);for(let s=0;s<i.length-1;++s)i[s]=Math.floor(t/n[s]),t-=i[s]*n[s];return i[i.length-1]=t,i}function bx(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aC="tfjsflags";class fH{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=pH,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(le().getBool("IS_TEST")||le().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,i){if(this.flagRegistry[e]={evaluationFn:n,setHook:i},this.urlFlags[e]!=null){const s=this.urlFlags[e];le().getBool("IS_TEST")||le().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(bx(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);aC in e&&e[aC].split(",").forEach(i=>{const[s,o]=i.split(":");this.urlFlags[s]=gH(s,o)})}}function pH(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...i)=>(mH(e,i[0],i[1]),i.join("="))),e}function mH(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function gH(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function le(){return hE}let hE=null;function vH(t){hE=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wm;function fE(){if(wm==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");wm=t}return wm}function xH(){const t=fE();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function yx(t,e){const n=xH();if(n.has(t))return n.get(t);{const i=e();return n.set(t,i),n.get(t)}}const yf="Abs",lu="Acos",cu="Acosh",Zl="Add",wx="AddN",Cx="All",Sx="Any",wf="ArgMax",Cf="ArgMin",uu="Asin",du="Asinh",hu="Atan",fu="Atanh",pu="Atan2",Sf="AvgPool",Ix="AvgPoolGrad",If="AvgPool3D",$x="AvgPool3DGrad",$f="BatchMatMul",Ef="BatchToSpaceND",Ex="Bincount",Nx="BitwiseAnd",bH="BroadcastTo",pE="BroadcastArgs",mu="Cast",gu="Ceil",vu="ClipByValue",kx="Complex",Nf="ComplexAbs",kf="Concat",Df="Conv2D",Dx="Conv2DBackpropFilter",Tf="Conv2DBackpropInput",Rf="Conv3D",Tx="Conv3DBackpropFilterV2",Rx="Conv3DBackpropInputV2",xu="Cos",bu="Cosh",_x="Cumprod",_f="Cumsum",Ax="CropAndResize",Ox="DenseBincount",Px="DepthToSpace",Af="DepthwiseConv2dNative",Mx="DepthwiseConv2dNativeBackpropFilter",Fx="DepthwiseConv2dNativeBackpropInput",mE="Diag",Of="Dilation2D",Sg="Dilation2DBackpropInput",Ig="Dilation2DBackpropFilter",yH="Draw",yu="RealDiv",Lx="Einsum",wu="Elu",zx="EluGrad",Cu="Erf",Pf="Equal",Su="Exp",Mf="ExpandDims",Iu="Expm1",Bx="FFT",Vx="Fill",Wx="FlipLeftRight",$u="Floor",Eu="FloorDiv",Ff="FusedBatchNorm",Lf="GatherV2",gE="GatherNd",zf="Greater",Nu="GreaterEqual",ku="Identity",Gx="IFFT",Hx="Imag",Du="IsFinite",Tu="IsInf",Ru="IsNan",Bf="LeakyRelu",Vf="Less",Wf="LessEqual",vE="LinSpace",_u="Log",Au="Log1p",Gf="LogicalAnd",Hf="LogicalNot",Uf="LogicalOr",wH="LogSoftmax",jf="LRN",Ux="LRNGrad",Kf="Max",Ou="Maximum",Xf="MaxPool",jx="MaxPoolGrad",qf="MaxPool3D",Kx="MaxPool3DGrad",xE="MaxPoolWithArgmax",Yf="Mean",Jf="Min",Pu="Minimum",Zf="MirrorPad",Mu="Mod",bE="Multinomial",Fu="Multiply",Qf="Neg",ep="NotEqual",Xx="NonMaxSuppressionV3",qx="NonMaxSuppressionV4",Yx="NonMaxSuppressionV5",tp="OnesLike",np="OneHot",ip="Pack",sp="PadV2",Lu="Pow",op="Prelu",rp="Prod",yE="RaggedGather",wE="RaggedRange",CE="RaggedTensorToTensor",Jx="Range",Zx="Real",zu="Reciprocal",Bu="Relu",ap="Reshape",lp="ResizeNearestNeighbor",Qx="ResizeNearestNeighborGrad",cp="ResizeBilinear",e0="ResizeBilinearGrad",Vu="Relu6",up="Reverse",Wu="Round",Gu="Rsqrt",SE="ScatterNd",IE="TensorScatterUpdate",$E="SearchSorted",dp="Select",Hu="Selu",hp="Slice",Uu="Sin",ju="Sinh",Ku="Sign",Xu="Sigmoid",qu="Softplus",Yu="Sqrt",fp="Sum",pp="SpaceToBatchND",mp="SplitV",gp="Softmax",EE="SparseFillEmptyRows",NE="SparseReshape",kE="SparseSegmentMean",DE="SparseSegmentSum",TE="SparseToDense",Ju="SquaredDifference",t0="Square",n0="StaticRegexReplace",i0="StridedSlice",RE="StringNGrams",_E="StringSplit",AE="StringToHashBucketFast",Zu="Sub",Qu="Tan",ed="Tanh",td="Tile",s0="TopK",o0="Transform",cl="Transpose",r0="Unique",vp="Unpack",xp="UnsortedSegmentSum",bp="ZerosLike",nd="Step",CH="FromPixels",a0="RotateWithOffset",$h="_FusedMatMul",Eh="FusedConv2D",OE="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ns(...t){le().getBool("IS_TEST")||le().getBool("PROD")||console.warn(...t)}function SH(...t){le().getBool("IS_TEST")||le().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nh=yx("kernelRegistry",()=>new Map),$g=yx("gradRegistry",()=>new Map);function lC(t,e){const n=ME(t,e);return Nh.get(n)}function cC(t){return $g.get(t)}function uC(t){const e=Nh.entries(),n=[];for(;;){const{done:i,value:s}=e.next();if(i)break;const[o,r]=s,[a]=o.split("_");a===t&&n.push(r)}return n}function PE(t){const{kernelName:e,backendName:n}=t,i=ME(e,n);Nh.has(i)&&ns(`The kernel '${e}' for backend '${n}' is already registered`),Nh.set(i,t)}function IH(t){const{kernelName:e}=t;$g.has(e)&&le().getBool("DEBUG")&&ns(`Overriding the gradient for '${e}'`),$g.set(e,t)}function ME(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FE(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var LE=rn,Ss=null;try{Ss=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function rn(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}rn.prototype.__isLong__;Object.defineProperty(rn.prototype,"__isLong__",{value:!0});function Qi(t){return(t&&t.__isLong__)===!0}rn.isLong=Qi;var dC={},hC={};function Aa(t,e){var n,i,s;return e?(t>>>=0,(s=0<=t&&t<256)&&(i=hC[t],i)?i:(n=an(t,(t|0)<0?-1:0,!0),s&&(hC[t]=n),n)):(t|=0,(s=-128<=t&&t<128)&&(i=dC[t],i)?i:(n=an(t,t<0?-1:0,!1),s&&(dC[t]=n),n))}rn.fromInt=Aa;function Is(t,e){if(isNaN(t))return e?Qr:$s;if(e){if(t<0)return Qr;if(t>=zE)return WE}else{if(t<=-pC)return Hi;if(t+1>=pC)return VE}return t<0?Is(-t,e).neg():an(t%Tl|0,t/Tl|0,e)}rn.fromNumber=Is;function an(t,e,n){return new rn(t,e,n)}rn.fromBits=an;var kh=Math.pow;function l0(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return $s;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return l0(t.substring(1),e,n).neg();for(var s=Is(kh(n,8)),o=$s,r=0;r<t.length;r+=8){var a=Math.min(8,t.length-r),l=parseInt(t.substring(r,r+a),n);if(a<8){var c=Is(kh(n,a));o=o.mul(c).add(Is(l))}else o=o.mul(s),o=o.add(Is(l))}return o.unsigned=e,o}rn.fromString=l0;function Js(t,e){return typeof t=="number"?Is(t,e):typeof t=="string"?l0(t,e):an(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}rn.fromValue=Js;var fC=65536,$H=1<<24,Tl=fC*fC,zE=Tl*Tl,pC=zE/2,mC=Aa($H),$s=Aa(0);rn.ZERO=$s;var Qr=Aa(0,!0);rn.UZERO=Qr;var il=Aa(1);rn.ONE=il;var BE=Aa(1,!0);rn.UONE=BE;var Eg=Aa(-1);rn.NEG_ONE=Eg;var VE=an(-1,2147483647,!1);rn.MAX_VALUE=VE;var WE=an(-1,-1,!0);rn.MAX_UNSIGNED_VALUE=WE;var Hi=an(0,-2147483648,!1);rn.MIN_VALUE=Hi;var _e=rn.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*Tl+(this.low>>>0):this.high*Tl+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Hi)){var n=Is(e),i=this.div(n),s=i.mul(n).sub(this);return i.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Is(kh(e,6),this.unsigned),r=this,a="";;){var l=r.div(o),c=r.sub(l.mul(o)).toInt()>>>0,u=c.toString(e);if(r=l,r.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Hi)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return Qi(e)||(e=Js(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(Qi(e)||(e=Js(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Hi)?Hi:this.not().add(il)};_e.neg=_e.negate;_e.add=function(e){Qi(e)||(e=Js(e));var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,r=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,d=0,f=0,h=0;return h+=o+c,f+=h>>>16,h&=65535,f+=s+l,d+=f>>>16,f&=65535,d+=i+a,u+=d>>>16,d&=65535,u+=n+r,u&=65535,an(f<<16|h,u<<16|d,this.unsigned)};_e.subtract=function(e){return Qi(e)||(e=Js(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return $s;if(Qi(e)||(e=Js(e)),Ss){var n=Ss.mul(this.low,this.high,e.low,e.high);return an(n,Ss.get_high(),this.unsigned)}if(e.isZero())return $s;if(this.eq(Hi))return e.isOdd()?Hi:$s;if(e.eq(Hi))return this.isOdd()?Hi:$s;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(mC)&&e.lt(mC))return Is(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,s=this.high&65535,o=this.low>>>16,r=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,d=0,f=0,h=0,p=0;return p+=r*u,h+=p>>>16,p&=65535,h+=o*u,f+=h>>>16,h&=65535,h+=r*c,f+=h>>>16,h&=65535,f+=s*u,d+=f>>>16,f&=65535,f+=o*c,d+=f>>>16,f&=65535,f+=r*l,d+=f>>>16,f&=65535,d+=i*u+s*c+o*l+r*a,d&=65535,an(h<<16|p,d<<16|f,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(Qi(e)||(e=Js(e)),e.isZero())throw Error("division by zero");if(Ss){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Ss.div_u:Ss.div_s)(this.low,this.high,e.low,e.high);return an(n,Ss.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qr:$s;var i,s,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qr;if(e.gt(this.shru(1)))return BE;o=Qr}else{if(this.eq(Hi)){if(e.eq(il)||e.eq(Eg))return Hi;if(e.eq(Hi))return il;var r=this.shr(1);return i=r.div(e).shl(1),i.eq($s)?e.isNegative()?il:Eg:(s=this.sub(e.mul(i)),o=i.add(s.div(e)),o)}else if(e.eq(Hi))return this.unsigned?Qr:$s;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=$s}for(s=this;s.gte(e);){i=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),l=a<=48?1:kh(2,a-48),c=Is(i),u=c.mul(e);u.isNegative()||u.gt(s);)i-=l,c=Is(i,this.unsigned),u=c.mul(e);c.isZero()&&(c=il),o=o.add(c),s=s.sub(u)}return o};_e.div=_e.divide;_e.modulo=function(e){if(Qi(e)||(e=Js(e)),Ss){var n=(this.unsigned?Ss.rem_u:Ss.rem_s)(this.low,this.high,e.low,e.high);return an(n,Ss.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return an(~this.low,~this.high,this.unsigned)};_e.and=function(e){return Qi(e)||(e=Js(e)),an(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return Qi(e)||(e=Js(e)),an(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return Qi(e)||(e=Js(e)),an(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return Qi(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?an(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):an(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return Qi(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?an(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):an(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(Qi(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var i=this.low;return an(i>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?an(n,0,this.unsigned):an(n>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?an(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:an(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};rn.fromBytes=function(e,n,i){return i?rn.fromBytesLE(e,n):rn.fromBytesBE(e,n)};rn.fromBytesLE=function(e,n){return new rn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};rn.fromBytesBE=function(e,n){return new rn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const GE=c1(LE),EH=CA({__proto__:null,default:GE},[LE]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qr=GE||EH;function yp(t){return qr.fromString(t,!0,16)}const HE=yp("c3a5c85c97cb3127"),jr=yp("b492b66fbe98f273"),yi=yp("9ae16a3b2f90404f");function Ng(t){return t.xor(t.shru(47))}function UE(t,e,n){const i=t.slice(e,e+n);return qr.fromBytes(Array.from(i),!0,!0)}function Zt(t,e){return UE(t,e,8)}function gC(t,e){return UE(t,e,4)}function Kn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function pr(t,e,n=yp("9ddfea08eb382d69")){let i=t.xor(e).mul(n);i=i.xor(i.shru(47));let s=e.xor(i).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function NH(t,e,n,i,s,o){s=s.add(t),o=Kn(o.add(s).add(i),21);const r=s;return s=s.add(e),s=s.add(n),o=o.add(Kn(s,44)),[s.add(i),o.add(r)]}function zd(t,e,n,i){return NH(Zt(t,e),Zt(t,e+8),Zt(t,e+16),Zt(t,e+24),n,i)}function kH(t,e=t.length){if(e>=8){const n=yi.add(e*2),i=Zt(t,0).add(yi),s=Zt(t,e-8),o=Kn(s,37).mul(n).add(i),r=Kn(i,25).add(s).mul(n);return pr(o,r,n)}if(e>=4){const n=yi.add(e*2),i=gC(t,0);return pr(i.shl(3).add(e),gC(t,e-4),n)}if(e>0){const n=t[0],i=t[e>>1],s=t[e-1],o=n+(i<<8),r=e+(s<<2);return Ng(yi.mul(o).xor(HE.mul(r))).mul(yi)}return yi}function DH(t,e=t.length){const n=yi.add(e*2),i=Zt(t,0).mul(jr),s=Zt(t,8),o=Zt(t,e-8).mul(n),r=Zt(t,e-16).mul(yi);return pr(Kn(i.add(s),43).add(Kn(o,30)).add(r),i.add(Kn(s.add(yi),18)).add(o),n)}function TH(t,e=t.length){const n=yi.add(e*2),i=Zt(t,0).mul(yi),s=Zt(t,8),o=Zt(t,e-8).mul(n),r=Zt(t,e-16).mul(yi),a=Kn(i.add(s),43).add(Kn(o,30)).add(r),l=pr(a,i.add(Kn(s.add(yi),18)).add(o),n),c=Zt(t,16).mul(n),u=Zt(t,24),d=a.add(Zt(t,e-32)).mul(n),f=l.add(Zt(t,e-24)).mul(n);return pr(Kn(c.add(u),43).add(Kn(d,30)).add(f),c.add(Kn(u.add(i),18)).add(d),n)}function RH(t,e=t.length){const n=qr.fromNumber(81,!0);if(e<=32)return e<=16?kH(t,e):DH(t,e);if(e<=64)return TH(t,e);let i=n,s=n.mul(jr).add(113),o=Ng(s.mul(yi).add(113)).mul(yi),r=[qr.UZERO,qr.UZERO],a=[qr.UZERO,qr.UZERO];i=i.mul(yi).add(Zt(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do i=Kn(i.add(s).add(r[0]).add(Zt(t,l+8)),37).mul(jr),s=Kn(s.add(r[1]).add(Zt(t,l+48)),42).mul(jr),i=i.xor(a[1]),s=s.add(r[0]).add(Zt(t,l+40)),o=Kn(o.add(a[0]),33).mul(jr),r=zd(t,l,r[1].mul(jr),i.add(a[0])),a=zd(t,l+32,o.add(a[1]),s.add(Zt(t,l+16))),[o,i]=[i,o],l+=64;while(l!==c);const d=jr.add(o.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),r[0]=r[0].add(a[0]),a[0]=a[0].add(r[0]),i=Kn(i.add(s).add(r[0]).add(Zt(t,l+8)),37).mul(d),s=Kn(s.add(r[1]).add(Zt(t,l+48)),42).mul(d),i=i.xor(a[1].mul(9)),s=s.add(r[0].mul(9).add(Zt(t,l+40))),o=Kn(o.add(a[0]),33).mul(d),r=zd(t,l,r[1].mul(d),i.add(a[0])),a=zd(t,l+32,o.add(a[1]),s.add(Zt(t,l+16))),[o,i]=[i,o],pr(pr(r[0],a[0],d).add(Ng(s).mul(HE)).add(o),pr(r[1],a[1],d).add(i),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tr(t,e){return e==="string"?mr(t):Oa([t],e)}function _H(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Oa(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=pa(t)),le().getBool("DEBUG")&&lH(t,e),_H(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let i=0;i<n.length;++i)Math.round(t[i])!==0&&(n[i]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Ri(){return le().platform.now()}function mr(t,e="utf-8"){return e=e||"utf-8",le().platform.encode(t,e)}function Cr(t,e="utf-8"){return e=e||"utf-8",le().platform.decode(t,e)}function Ds(t){return le().platform.isTypedArray!=null?le().platform.isTypedArray(t):FE(t)}function pa(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||bx(t)||t==null||Ds(t)&&n)e.push(t);else if(Array.isArray(t)||Ds(t))for(let i=0;i<t.length;++i)pa(t[i],e,n);else{let i=-1;for(const s of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(s)&&(i=Math.max(i,Number(s)));for(let s=0;s<=i;s++)pa(t[s],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AH{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new PH)}profileKernel(e,n,i){let s;const o=()=>{s=i()};let r;const a=Ri();if(this.backendTimer.timerAvailable())r=this.backendTimer.time(o);else{o();for(const c of s)c.dataSync();r=Promise.resolve({kernelMs:Ri()-a})}if(le().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<s.length;c++){const u=s[c];u.data().then(d=>{OH(d,u.dtype,e)})}return{kernelName:e,outputs:s,inputs:n,timeMs:r.then(c=>c.kernelMs),extraInfo:r.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:i,timeMs:s,inputs:o,extraInfo:r}=e;i.forEach(a=>{Promise.all([a.data(),s,r]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],o,l[2])})})}}function OH(t,e,n){if(e!=="float32")return!1;for(let i=0;i<t.length;i++){const s=t[i];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${n}'`),!0}return!1}class PH{logKernelProfile(e,n,i,s,o,r){const a=typeof s=="number"?ll(`${s}ms`,9):s.error,l=ll(e,25),c=n.rank,u=n.size,d=ll(n.shape.toString(),14);let f="";for(const h in o){const p=o[h];if(p!=null){const m=p.shape||n.shape,g=m.length;f+=`${h}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${f}	%c${r}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MH(t,e,n){const i={},s={};for(let l=0;l<e.length;l++)i[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const d in u){const f=u[d];let h=!1;for(let p=0;p<e.length;p++)if(i[f.id]){c.outputs.forEach(m=>i[m.id]=!0),h=!0,s[c.id]=!0;break}if(h)break}}const o={};o[n.id]=!0;const r={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(o[c.outputs[d].id]){for(const f in u)o[u[f].id]=!0,r[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(s[c.id]&&r[c.id]){const u={};for(const f in c.inputs){const h=c.inputs[f];i[h.id]&&(u[f]=h)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function FH(t,e,n,i){for(let s=e.length-1;s>=0;s--){const o=e[s],r=[];if(o.outputs.forEach(l=>{const c=t[l.id];c!=null?r.push(c):r.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(r);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=o.inputs[l];if(!Wt(c.shape,u.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const d=t[u.id];t[u.id]=i(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vC=20,gc=3,Cm=7;function LH(t,e,n,i){const s=Ye(e),o=zH(t,e,n,s),r=e.length,a=ah(t,e,n,s,o),l=["Tensor"];return i&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${r}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function zH(t,e,n,i){const s=pe(e),o=i[i.length-1],r=new Array(o).fill(0),a=e.length,l=n==="complex64"?wc(t):t;if(a>1)for(let c=0;c<s/o;c++){const u=c*o;for(let d=0;d<o;d++)r[d]=Math.max(r[d],yc(l[u+d],0,n).length)}return r}function yc(t,e,n){let i;return Array.isArray(t)?i=`${parseFloat(t[0].toFixed(Cm))} + ${parseFloat(t[1].toFixed(Cm))}j`:au(t)?i=`'${t}'`:n==="bool"?i=jE(t):i=parseFloat(t.toFixed(Cm)).toString(),ll(i,e)}function jE(t){return t===0?"false":"true"}function ah(t,e,n,i,s,o=!0){const r=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=wc(t);return[yc(m[0],0,n)]}return n==="bool"?[jE(t[0])]:[t[0].toString()]}if(l===1){if(a>vC){const g=gc*r;let v=Array.from(t.slice(0,g)),x=Array.from(t.slice((a-gc)*r,a*r));return n==="complex64"&&(v=wc(v),x=wc(x)),["["+v.map((b,w)=>yc(b,s[w],n)).join(", ")+", ..., "+x.map((b,w)=>yc(b,s[a-gc+w],n)).join(", ")+"]"]}return["["+(n==="complex64"?wc(t):Array.from(t)).map((g,v)=>yc(g,s[v],n)).join(", ")+"]"]}const c=e.slice(1),u=i.slice(1),d=i[0]*r,f=[];if(a>vC){for(let m=0;m<gc;m++){const g=m*d,v=g+d;f.push(...ah(t.slice(g,v),c,n,u,s,!1))}f.push("...");for(let m=a-gc;m<a;m++){const g=m*d,v=g+d;f.push(...ah(t.slice(g,v),c,n,u,s,m===a-1))}}else for(let m=0;m<a;m++){const g=m*d,v=g+d;f.push(...ah(t.slice(g,v),c,n,u,s,m===a-1))}const h=l===2?",":"";f[0]="["+(a>0?f[0]+h:"");for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+h;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":p),f}function wc(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ti{constructor(e,n,i){if(this.dtype=n,this.shape=e.slice(),this.size=pe(e),i!=null){const s=i.length;F(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=i||wn(n,this.size),this.strides=Ye(e)}set(e,...n){n.length===0&&(n=[0]),F(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const i=this.locToIndex(n);this.values[i]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const s of e){if(s<0||s>=this.shape[n]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}n++}let i=e[e.length-1];for(let s=0;s<e.length-1;++s)i+=this.strides[s]*e[s];return this.values[i]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let i=0;i<e.length-1;++i)n+=this.strides[i]*e[i];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let i=0;i<n.length-1;++i)n[i]=Math.floor(e/this.strides[i]),e-=n[i]*this.strides[i];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Vs().makeTensor(this.values,this.shape,this.dtype)}}let Vs=null,el=null;function BH(t){Vs=t}function VH(t){el=t}class Mn{constructor(e,n,i,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=pe(e),this.strides=Ye(e),this.dataId=i,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return el.buffer(this.shape,this.dtype,e)}bufferSync(){return el.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Hs(this.shape,e,this.dtype==="complex64")}arraySync(){return Hs(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Vs().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(i=>Cr(i))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Vs().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Vs().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Cr(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Vs().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Vs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return el.print(this,e)}clone(){return this.throwIfDisposed(),el.clone(this)}toString(e=!1){const n=this.dataSync();return LH(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),el.cast(this,e)}variable(e=!0,n,i){return this.throwIfDisposed(),Vs().makeVariable(this,e,n,i)}}Object.defineProperty(Mn,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function fe(){return yx("Tensor",()=>Mn)}fe();class Dh extends Mn{constructor(e,n,i,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=n,this.name=i}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Wt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Vs().disposeTensor(this),this.dataId=e.dataId,Vs().incRef(this,null)}dispose(){Vs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Dh,Symbol.hasInstance,{value:t=>t instanceof Mn&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xC;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(xC||(xC={}));var kg;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(kg||(kg={}));var Dg;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(Dg||(Dg={}));var Tg;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(Tg||(Tg={}));var Rg;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(Rg||(Rg={}));const WH={float32:Tg,int32:kg,bool:Dg,complex64:Rg};function qi(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return WH[t][e]}function c0(t){return qi(t,"int32")}function KE(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function XE(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sn(t,e){if(t.dtype===e.dtype)return[t,e];const n=qi(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function qE(t){const e=[];return YE(t,e,new Set),e}function YE(t,e,n){if(t==null)return;if(t instanceof Mn){e.push(t);return}if(!GH(t))return;const i=t;for(const s in i){const o=i[s];n.has(o)||(n.add(o),YE(o,e,n))}}function GH(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sm(t){return t.kernelName!=null}class bC{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Rl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bC}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const i=e[n];if(await this.initializeBackend(i).success){await this.setBackend(i);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,i=1){return e in this.registryFactory?(ns(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:i},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:i}=this.initializeBackend(e);if(!(i?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new AH(this.backendInstance),!0}setupRegisteredKernels(){uC(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){uC(e).forEach(i=>{i.disposeFunc!=null&&i.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const i=n.factory();if(i&&!(i instanceof mx)&&typeof i.then=="function"){const s=++this.pendingBackendInitId,o=i.then(r=>s<this.pendingBackendInitId?!1:(this.registry[e]=r,this.pendingBackendInit=null,!0)).catch(r=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,ns(`Initialization of backend ${e} failed`),ns(r.stack||r.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(i){return ns(`Initialization of backend ${e} failed`),ns(i.stack||i.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const i=e[n],{success:s,asyncInit:o}=this.initializeBackend(i);if(o||s)return{name:i,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const i=this.state.tensorInfo.get(n),s=i.backend,o=this.readSync(n),r=s.refCount(n);s.disposeData(n,!0),i.backend=e,e.move(n,o,i.shape,i.dtype,r),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let i=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}let s;return this.scopedRun(()=>this.startScope(i),()=>this.endScope(s),()=>(s=n(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,n,i){e();try{const s=i();return n(),s}catch(s){throw n(),s}}nextTensorId(){return Rl.nextTensorId++}nextVariableId(){return Rl.nextVariableId++}clone(e){const n=K.runKernel(ku,{x:e}),i={x:e},s=r=>({x:()=>{const a="float32",l={x:r},c={dtype:a};return K.runKernel(mu,l,c)}}),o=[];return this.addTapeNode(this.state.activeScope.name,i,[n],s,o,{}),n}runKernel(e,n,i){if(this.backendName==null&&this.backend,!(lC(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:i})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,i){const s=this.backend.numDataIds();let o=0;i.forEach(l=>{o+=l.dtype==="complex64"?3:1});const r=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-n-o-r;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,i=[];const s=this.isTapeOn(),o=this.state.numBytes,r=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Sm(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Sm(e)){const{kernelName:p,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const v=lC(p,this.backendName);F(v!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const x=this.backend.numDataIds();l=v.kernelFunc({inputs:m,attrs:g,backend:this.backend});const b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,x,b);const w=b.map(y=>y.rank!=null?y:this.makeTensorFromTensorInfo(y));if(s){const y=this.getTensorsForGradient(p,m,w);i=this.saveTensorsForBackwardMode(y)}return w}}else{const{forwardFunc:p}=e,m=g=>{s&&(i=g.map(v=>this.keep(this.clone(v))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const v=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,g,v),v}}const{inputs:u,attrs:d}=e,f=Sm(e)?null:e.backwardsFunc;let h;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(h=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),n=h.outputs)}),s&&this.addTapeNode(c,u,n,f,i,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-r,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(i=>this.keep(this.clone(i)))}getTensorsForGradient(e,n,i){const s=cC(e);if(s!=null){const o=s.inputsToSave||[],r=s.outputsToSave||[];let a;s.saveAllInputs?(F(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=o.map(c=>n[c]);const l=i.filter((c,u)=>r[u]);return a.concat(l)}return[]}makeTensor(e,n,i,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");i=i||"float32",s=s||this.backend;let o=e;i==="string"&&au(e[0])&&(o=e.map(l=>mr(l)));const r=s.write(o,n,i),a=new Mn(n,i,r,this.nextTensorId());if(this.trackTensor(a,s),i==="string"){const l=this.state.tensorInfo.get(r),c=uH(o);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,i,s){i=i||"float32";const o={dataId:e,shape:n,dtype:i};return this.makeTensorFromTensorInfo(o,s)}makeTensorFromTensorInfo(e,n){const{dataId:i,shape:s,dtype:o}=e,r=new Mn(s,o,i,this.nextTensorId());return this.trackTensor(r,n),r}makeVariable(e,n=!0,i,s){i=i||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const o=new Dh(e,n,i,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*Ih(e.dtype)),this.state.numBytes+=i,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:i})),e instanceof Dh||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const i=e.size*Ih(e.dtype);this.state.numBytes-=i}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,i=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-i;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,i,s,o,r){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:i,saved:o},l=cC(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const f=i[d],h=hi(f.size,f.dtype);return this.makeTensor(h,f.shape,f.dtype)}return u}),s(c.length>1?c:c[0],o,r))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=qE(e),i=new Set(n.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const r=this.state.activeScope.track[o];!r.kept&&!i.has(r.id)&&r.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(o=>{!o.kept&&o.scopeId===s.id&&this.track(o)})}gradients(e,n,i,s=!1){if(F(n.length>0,()=>"gradients() received an empty list of xs."),i!=null&&i.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${i.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));F(o instanceof Mn,()=>"The result y returned by f() must be a tensor.");const r=MH(this.state.activeTape,n,o);if(!s&&r.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=i??HH(o.shape),FH(a,r,c=>this.tidy(c),UH);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return F(wg(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{F(n.every(a=>a instanceof Mn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let i;const s={};n.forEach((a,l)=>{s[l]=a});const o=(a,l)=>(i=e(...n,l),F(i.value instanceof Mn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),F(wg(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),r=(a,l)=>{const c=i.gradFunc(a,l),u=Array.isArray(c)?c:[c];F(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),F(u.every(f=>f instanceof Mn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((f,h)=>{d[h]=()=>f}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:r,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Ri(),i=await this.backend.time(e);return i.wallMs=Ri()-n,i}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bC;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Rl.nextTensorId=0;Rl.nextVariableId=0;function HH(t){const e=xx(pe(t),"float32");return K.makeTensor(e,t,"float32")}function JE(){const t=fE();if(t._tfengine==null){const e=new fH(t);t._tfengine=new Rl(e)}return vH(t._tfengine.ENV),BH(()=>t._tfengine),t._tfengine}const K=JE();function UH(t,e){const n={a:t,b:e};return K.runKernel(Zl,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jH(){return typeof navigator<"u"&&navigator!=null}function ZE(t){if(t||jH()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function QE(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fi=le();Fi.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Fi.registerFlag("IS_BROWSER",()=>QE());Fi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Fi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Fi.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Fi.registerFlag("PROD",()=>!1);Fi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Fi.getBool("DEBUG"));Fi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Fi.registerFlag("IS_TEST",()=>!1);Fi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Fi.getBool("DEBUG"));Fi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Fi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Fi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(t,e){let n=t;if(Ds(t))return e==="string"?[]:[t.length];if(KE(t)){const s=t.channels||"RGBA";return[t.height,t.width*s.length]}else if(XE(t))return[t.buffer.size/(e==null?4:Ih(e))];if(!Array.isArray(t))return[];const i=[];for(;Array.isArray(n)||Ds(n)&&e!=="string";)i.push(n.length),n=n[0];return Array.isArray(t)&&le().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&e2(t,i,[]),i}function e2(t,e,n){if(n=n||[],!Array.isArray(t)&&!Ds(t)){F(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}F(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),F(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const i=e.slice(1);for(let s=0;s<t.length;++s)e2(t[s],i,n.concat(s))}function yC(t,e,n,i){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${i}' must be ${t} tensor, but got ${e} tensor`)}}function V(t,e,n,i="numeric"){if(t instanceof fe())return yC(i,t.dtype,e,n),t;let s=Yl(t);if(s!=="string"&&["bool","int32","float32"].indexOf(i)>=0&&(s=i),yC(i,s,e,n),t==null||!Ds(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const o=wp(t,s);!Ds(t)&&!Array.isArray(t)&&(t=[t]);const a=s!=="string"?Oa(t,s):pa(t,[],!0);return K.makeTensor(a,o,s)}function t2(t,e,n,i="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((o,r)=>V(o,`${e}[${r}]`,n,i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH="__op";function Q(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const i=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+KH;const s=(...o)=>{K.startScope(n);try{const r=i(...o);return bx(r)&&console.error("Cannot return a Promise inside of tidy."),K.endScope(r),r}catch(r){throw K.endScope(null),r}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XH(t,e){const n=V(t,"real","complex"),i=V(e,"imag","complex");vx(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const s={real:n,imag:i};return K.runKernel(kx,s)}const ma=Q({complex_:XH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cp(t,e,n,i){if(i==null)i=Yl(t);else if(i==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(XE(t)||KE(t)){if(i!=="float32"&&i!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${i}.`);return K.backend.createTensorFromGPUData(t,e||n,i)}if(!Ds(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Qo(e);const s=pe(e),o=pe(n);F(s===o,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${o}`);for(let r=0;r<n.length;++r){const a=n[r],l=r===n.length-1?a!==pe(e.slice(r)):!0;F(n[r]===e[r]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Ds(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=i!=="string"?Oa(t,i):pa(t,[],!0),K.makeTensor(t,e,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ul(t,e,n){const i=wp(t,n);return Cp(t,e,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Th={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Rr{static join(e){return new Rr(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(i=>Ds(i)?i.buffer:i),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let i=0;i<e.length;i++){const s=e[i];i!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=n+s.byteLength;this.shards.push({buffer:s,start:n,end:o}),n=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const i=this.findShardForByte(e);if(i===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=n-e,o=new ArrayBuffer(s),r=new Uint8Array(o);let a=0;for(let l=i;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,f=a,p=Math.min(n,c.end)-c.start,m=new Uint8Array(c.buffer,d,p-d);if(r.set(m,f),a+=m.length,n<c.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(s){return e<s.start?-1:e>=s.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const i=qH(this.shards,n);return i===-1?-1:(this.previousShardIndex=i,this.previousShardIndex)}}function qH(t,e){let n=0,i=t.length;for(;n<=i;){const s=Math.floor((i-n)/2)+n,o=e(t[s]);if(o===0)return s;o<0?i=s:n=s+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(){return K}function wC(){return K.memory()}function ie(t,e){return K.tidy(t,e)}function bt(t){qE(t).forEach(n=>n.dispose())}function go(t){return K.keep(t)}function YH(t){return K.setBackend(t)}function n2(t,e,n=1){return K.registerBackend(t,e,n)}function JH(){return K.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _l=4;async function CC(t,e){const n=[],i=[],s=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);for(let r=0;r<s.length;++r){const a=s[r],l=Array.isArray(t)?t[r].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const f=await l.bytes(),h=f.reduce((g,v)=>g+v.length,0)+_l*f.length,p=new Uint8Array(h);let m=0;for(let g=0;g<f.length;g++){const v=f[g],x=new Uint8Array(new Uint32Array([v.length]).buffer);p.set(x,m),m+=_l,p.set(v,m),m+=v.length}d(p)});i.push(u)}else i.push(l.data());e!=null&&(c.group=e),n.push(c)}const o=await Promise.all(i);return{data:tU(o),specs:n}}function ZH(t,e){const n=new Rr(t),i={};let s=0;for(const o of e){const r=QH(o,(a,l)=>n.slice(s+a,s+l));i[o.name]=eU(o,n.slice(s,s+r)),s+=r}return i}function QH(t,e){const n=pe(t.shape);let i;if("quantization"in t){const s=t.quantization;i=Th[s.dtype]}else if(t.dtype==="string"){let s=0;for(let o=0;o<n;o++)s+=_l+new Uint32Array(e(s,s+_l))[0];return s}else i=Th[t.dtype];return n*i}function eU(t,e){const n=t.name,i=t.dtype,s=t.shape,o=pe(s);let r,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(i!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${i}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=Th[l.dtype],u=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(i==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){r=new Float32Array(u.length);for(let d=0;d<u.length;d++){const f=u[d];r[d]=f*l.scale+l.min}}else if(l.dtype==="float16")r=dU()(u);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(i==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);r=new Int32Array(u.length);for(let d=0;d<u.length;d++){const f=u[d];r[d]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${i}`);a+=o*c}else if(i==="string"){const l=pe(t.shape);r=[];for(let c=0;c<l;c++){const u=new Uint32Array(e.slice(a,a+_l))[0];a+=_l;const d=new Uint8Array(e.slice(a,a+u));r.push(d),a+=u}}else{const l=Th[i];if(i==="float32")r=new Float32Array(e);else if(i==="int32")r=new Int32Array(e);else if(i==="bool")r=new Uint8Array(e);else if(i==="complex64"){r=new Float32Array(e);const c=new Float32Array(r.length/2),u=new Float32Array(r.length/2);for(let p=0;p<c.length;p++)c[p]=r[p*2],u[p]=r[p*2+1];const d=ul(c,s,"float32"),f=ul(u,s,"float32"),h=ma(d,f);return d.dispose(),f.dispose(),h}else throw new Error(`Unsupported dtype in weight '${n}': ${i}`);a+=o*l}return ul(r,s,i)}function tU(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(o=>{if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const i=new Uint8Array(e);let s=0;return n.forEach(o=>{i.set(new Uint8Array(o.buffer),s),s+=o.byteLength}),i.buffer}const u0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function SC(t){return u0?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function nU(t){if(u0)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let i=0,s=e.length;i<s;i++)n+=String.fromCharCode(e[i]);return btoa(n)}function iU(t){if(u0){const i=Buffer.from(t,"base64");return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let i=0;i<e.length;++i)n.set([e.charCodeAt(i)],i);return n.buffer}function sU(t){return Rr.join(t)}function oU(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function rU(t,e,n){const i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(i.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=e,i.weightData=n}return t.signature!=null&&(i.signature=t.signature),t.userDefinedMetadata!=null&&(i.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(i.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(i.initializerSignature=t.initializerSignature),i}async function aU(t,e){let n,i;return t.weightsManifest!=null&&([n,i]=await e(t.weightsManifest)),rU(t,n,i)}function d0(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:SC(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:SC(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Rr(t.weightData).byteLength}}function IC(t){const e=[];for(const n of t)e.push(...n.weights);return e}function lU(){const t=n=>{let i=n<<13,s=0;for(;!(i&8388608);)s-=8388608,i<<=1;return i&=-8388609,s+=947912704,i|s},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function cU(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function uU(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function dU(){const t=lU(),e=cU(),n=uU();return i=>{const s=new ArrayBuffer(4*i.length),o=new Uint32Array(s);for(let r=0;r<i.length;r++){const a=i[r],l=t[n[a>>10]+(a&1023)]+e[a>>10];o[r]=l}return new Float32Array(s)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return jn.instance==null&&(jn.instance=new jn),jn.instance}static registerSaveRouter(e){jn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){jn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return jn.getHandlers(e,"save")}static getLoadHandlers(e,n){return jn.getHandlers(e,"load",n)}static getHandlers(e,n,i){const s=[];return(n==="load"?jn.getInstance().loadRouters:jn.getInstance().saveRouters).forEach(r=>{const a=r(e,i);a!==null&&s.push(a)}),s}}const hU=t=>jn.getSaveHandlers(t),fU=(t,e)=>jn.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _g="tensorflowjs",Ag=1,ea="models_store",ur="model_info_store";function i2(){if(!le().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Og(t){const e=t.result;e.createObjectStore(ea,{keyPath:"modelPath"}),e.createObjectStore(ur,{keyPath:"modelPath"})}class ga{constructor(e){if(this.indexedDB=i2(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((i,s)=>{const o=this.indexedDB.open(_g,Ag);o.onupgradeneeded=()=>Og(o),o.onsuccess=()=>{const r=o.result;if(n==null){const a=r.transaction(ea,"readonly"),c=a.objectStore(ea).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return r.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));i(c.result.modelArtifacts)},c.onerror=u=>(r.close(),s(c.error)),a.oncomplete=()=>r.close()}else{n.weightData=Rr.join(n.weightData);const a=d0(n),l=r.transaction(ur,"readwrite");let c=l.objectStore(ur),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return s(f)}let d;u.onsuccess=()=>{d=r.transaction(ea,"readwrite");const f=d.objectStore(ea);let h;try{h=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return s(p)}h.onsuccess=()=>i({modelArtifactsInfo:a}),h.onerror=p=>{c=l.objectStore(ur);const m=c.delete(this.modelPath);m.onsuccess=()=>(r.close(),s(h.error)),m.onerror=g=>(r.close(),s(h.error))}},u.onerror=f=>(r.close(),s(u.error)),l.oncomplete=()=>{d==null?r.close():d.oncomplete=()=>r.close()}}},o.onerror=r=>s(o.error)})}}ga.URL_SCHEME="indexeddb://";const s2=t=>le().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ga.URL_SCHEME)?pU(t.slice(ga.URL_SCHEME.length)):null;jn.registerSaveRouter(s2);jn.registerLoadRouter(s2);function pU(t){return new ga(t)}function mU(t){return t.startsWith(ga.URL_SCHEME)?t.slice(ga.URL_SCHEME.length):t}class gU{constructor(){this.indexedDB=i2()}async listModels(){return new Promise((e,n)=>{const i=this.indexedDB.open(_g,Ag);i.onupgradeneeded=()=>Og(i),i.onsuccess=()=>{const s=i.result,o=s.transaction(ur,"readonly"),a=o.objectStore(ur).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(s.close(),n(a.error)),o.oncomplete=()=>s.close()},i.onerror=s=>n(i.error)})}async removeModel(e){return e=mU(e),new Promise((n,i)=>{const s=this.indexedDB.open(_g,Ag);s.onupgradeneeded=()=>Og(s),s.onsuccess=()=>{const o=s.result,r=o.transaction(ur,"readwrite"),a=r.objectStore(ur),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return o.close(),i(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=o.transaction(ea,"readwrite");const h=c.objectStore(ea).delete(e);h.onsuccess=()=>n(l.result.modelArtifactsInfo),h.onerror=p=>i(l.error)};u.onsuccess=d,u.onerror=f=>(d(),o.close(),i(l.error))}},l.onerror=u=>(o.close(),i(l.error)),r.oncomplete=()=>{c==null?o.close():c.oncomplete=()=>o.close()}},s.onerror=o=>i(s.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fo="/",tl="tensorflowjs_models",o2="info",vU="model_topology",xU="weight_specs",bU="weight_data",yU="model_metadata";function r2(t){return{info:[tl,t,o2].join(Fo),topology:[tl,t,vU].join(Fo),weightSpecs:[tl,t,xU].join(Fo),weightData:[tl,t,bU].join(Fo),modelMetadata:[tl,t,yU].join(Fo)}}function a2(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function wU(t){const e=t.split(Fo);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Fo)}function CU(t){return t.startsWith(va.URL_SCHEME)?t.slice(va.URL_SCHEME.length):t}class va{constructor(e){if(!le().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=r2(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),i=JSON.stringify(e.weightSpecs),s=d0(e),o=Rr.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,nU(o));const r={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(r)),{modelArtifactsInfo:s}}catch{throw a2(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},i=JSON.parse(this.LS.getItem(this.keys.topology));if(i==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=i;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=s;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const r=this.LS.getItem(this.keys.weightData);if(r==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=iU(r),n}}va.URL_SCHEME="localstorage://";const l2=t=>le().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(va.URL_SCHEME)?SU(t.slice(va.URL_SCHEME.length)):null;jn.registerSaveRouter(l2);jn.registerLoadRouter(l2);function SU(t){return new va(t)}class IU{constructor(){F(le().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),F(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=tl+Fo,i=Fo+o2;for(let s=0;s<this.LS.length;++s){const o=this.LS.key(s);if(o.startsWith(n)&&o.endsWith(i)){const r=wU(o);e[r]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=CU(e);const n=r2(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const i=JSON.parse(this.LS.getItem(n.info));return a2(n),i}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $C="://";class oo{constructor(){this.managers={}}static getInstance(){return oo.instance==null&&(oo.instance=new oo),oo.instance}static registerManager(e,n){F(e!=null,()=>"scheme must not be undefined or null."),e.endsWith($C)&&(e=e.slice(0,e.indexOf($C))),F(e.length>0,()=>"scheme must not be an empty string.");const i=oo.getInstance();F(i.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),i.managers[e]=n}static getManager(e){const n=oo.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(oo.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $U{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!le().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",i=>{if(i.source===window&&i.data.name===this.messageName){i.stopPropagation();const s=this.functionRefs[i.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return FE(e)}}if(le().get("IS_BROWSER")){le().setPlatform("browser",new $U);try{oo.registerManager(va.URL_SCHEME,new IU)}catch{}try{oo.registerManager(ga.URL_SCHEME,new gU)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={importFetch:()=>require("node-fetch")};let Im;class NU{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return le().global.fetch!=null?le().global.fetch(e,n):(Im==null&&(Im=EU.importFetch()),Im(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}le().get("IS_NODE")&&!le().get("IS_BROWSER")&&le().setPlatform("node",new NU);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ct(t,e="float32",n){return e=e||"float32",Qo(t),new ti(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kU(t,e){const n=V(t,"x","cast");if(!cH(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const i={x:n},s={dtype:e};return K.runKernel(mu,i,s)}const Fe=Q({cast_:kU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DU(t){const n={x:V(t,"x","clone","string_or_numeric")};return K.runKernel(ku,n)}const la=Q({clone_:DU});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */JE();const RU={buffer:Ct,cast:Fe,clone:la,print:TU};VH(RU);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _U(t,e){let n=V(t,"a","add"),i=V(e,"b","add");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(Zl,s)}const Se=Q({add_:_U});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AU(t,e){let n=V(t,"a","floorDiv"),i=V(e,"b","floorDiv");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(Eu,s)}const c2=Q({floorDiv_:AU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OU(t,e){let n=V(t,"a","div"),i=V(e,"b","div");if([n,i]=Sn(n,i),n.dtype==="int32"&&i.dtype==="int32")return c2(n,i);const s={a:n,b:i},o={};return K.runKernel(yu,s,o)}const nt=Q({div_:OU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(t,e){let n=V(t,"a","mul"),i=V(e,"b","mul");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(Fu,s)}const U=Q({mul_:PU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(t){const e=V(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return K.runKernel(Nf,n)}else{const n={x:e};return K.runKernel(yf,n)}}const xi=Q({abs_:MU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FU(t){const n={x:V(t,"x","acos")};return K.runKernel(lu,n)}const LU=Q({acos_:FU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zU(t){const n={x:V(t,"x","acosh")};return K.runKernel(cu,n)}const BU=Q({acosh_:zU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VU(t,e=null,n=!1){const s={x:V(t,"x","all","bool")},o={axis:e,keepDims:n};return K.runKernel(Cx,s,o)}const u2=Q({all_:VU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WU(t,e=null,n=!1){const s={x:V(t,"x","any","bool")},o={axis:e,keepDims:n};return K.runKernel(Sx,s,o)}const Pg=Q({any_:WU});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GU(t,e=0){const i={x:V(t,"x","argMax")},s={axis:e};return K.runKernel(wf,i,s)}const Wc=Q({argMax_:GU});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HU(t,e=0){const i={x:V(t,"x","argMin")},s={axis:e};return K.runKernel(Cf,i,s)}const UU=Q({argMin_:HU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(t){const n={x:V(t,"x","asin")};return K.runKernel(uu,n)}const KU=Q({asin_:jU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XU(t){const n={x:V(t,"x","asinh")};return K.runKernel(du,n)}const qU=Q({asinh_:XU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YU(t){const n={x:V(t,"x","atan")};return K.runKernel(hu,n)}const JU=Q({atan_:YU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZU(t,e){let n=V(t,"a","atan2"),i=V(e,"b","atan2");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(pu,s)}const QU=Q({atan2_:ZU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(t){const n={x:V(t,"x","atanh")};return K.runKernel(fu,n)}const t6=Q({atanh_:e6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(t,e,n,i,s="NHWC",o){const r=t[3],a=[...e,r],l=tr(s);return ni(t,a,n,o,i,null,null,l)}function As(t,e,n,i,s,o,r="channelsLast"){const[a,l]=Gc(e);let c;if(r==="channelsLast")c=[a,l,t[3],t[3]];else if(r==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${r}`);return ni(t,c,n,i,s,o,!1,r)}function er(t,e,n,i,s,o,r="NDHWC"){const[a,l,c]=Mg(e);let u,d;if(r==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(r==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${r}`);return _r(t,u,n,i,s,!1,d,o)}function ni(t,e,n,i,s,o,r=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,h,,p]=e,[m,g]=Gc(n),[v,x]=Gc(i),b=dl(f,v),w=dl(h,x),{padInfo:y,outHeight:C,outWidth:I}=s6(s,c,u,m,g,b,w,o,a),$=r?p*d:p;let E;return a==="channelsFirst"?E=[l,$,C,I]:a==="channelsLast"&&(E=[l,C,I,$]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:C,outWidth:I,outChannels:$,padInfo:y,strideHeight:m,strideWidth:g,filterHeight:f,filterWidth:h,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:v,dilationWidth:x,inShape:t,outShape:E,filterShape:e}}function _r(t,e,n,i,s,o=!1,r="channelsLast",a){let[l,c,u,d,f]=[-1,-1,-1,-1,-1];if(r==="channelsLast")[l,c,u,d,f]=t;else if(r==="channelsFirst")[l,f,c,u,d]=t;else throw new Error(`Unknown dataFormat ${r}`);const[h,p,m,,g]=e,[v,x,b]=Mg(n),[w,y,C]=Mg(i),I=dl(h,w),$=dl(p,y),E=dl(m,C),{padInfo:N,outDepth:k,outHeight:D,outWidth:_}=o6(s,c,u,d,v,x,b,I,$,E,a),R=o?g*f:g;let T;return r==="channelsFirst"?T=[l,R,k,D,_]:r==="channelsLast"&&(T=[l,k,D,_,R]),{batchSize:l,dataFormat:r,inDepth:c,inHeight:u,inWidth:d,inChannels:f,outDepth:k,outHeight:D,outWidth:_,outChannels:R,padInfo:N,strideDepth:v,strideHeight:x,strideWidth:b,filterDepth:h,filterHeight:p,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:$,effectiveFilterWidth:E,dilationDepth:w,dilationHeight:y,dilationWidth:C,inShape:t,outShape:T,filterShape:e}}function n6(t,e,n,i,s){i==null&&(i=h0(t,e,n));const o=t[0],r=t[1],a=Hc((o-e+2*i)/n+1,s),l=Hc((r-e+2*i)/n+1,s);return[a,l]}function i6(t,e,n,i,s,o){s==null&&(s=h0(t,e[0],i[0]));const r=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*s>=e[a]&&(r[a]=Hc((t[a]-e[a]+2*s)/i[a]+1,o));return r}function h0(t,e,n,i=1){const s=dl(e,i);return Math.floor((t[0]*(n-1)-n+s)/2)}function Gc(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function Mg(t){return typeof t=="number"?[t,t,t]:t}function dl(t,e){return e<=1?t:t+(t-1)*(e-1)}function s6(t,e,n,i,s,o,r,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const h=n6([e,n],o,i,t,a);u=h[0],d=h[1]}else if(t==="same"){u=Math.ceil(e/i),d=Math.ceil(n/s);const f=Math.max(0,(u-1)*i+o-e),h=Math.max(0,(d-1)*s+r-n),p=Math.floor(f/2),m=f-p,g=Math.floor(h/2),v=h-g;c={top:p,bottom:m,left:g,right:v,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-o+1)/i),d=Math.ceil((n-r+1)/s);else if(typeof t=="object"){const f=l==="channelsLast"?t[1][0]:t[2][0],h=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];c={top:f,bottom:h,left:p,right:m,type:f===0&&h===0&&p===0&&m===0?"VALID":"EXPLICIT"},u=Hc((e-o+f+h)/i+1,a),d=Hc((n-r+p+m)/s+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function o6(t,e,n,i,s,o,r,a,l,c,u){let d,f,h,p;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=i6([e,n,i,1],[a,l,c],1,[s,o,r],t,u);f=g[0],h=g[1],p=g[2]}else if(t==="same"){f=Math.ceil(e/s),h=Math.ceil(n/o),p=Math.ceil(i/r);const m=(f-1)*s+a-e,g=(h-1)*o+l-n,v=(p-1)*r+c-i,x=Math.floor(m/2),b=m-x,w=Math.floor(g/2),y=g-w,C=Math.floor(v/2),I=v-C;d={top:w,bottom:y,left:C,right:I,front:x,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:f,outHeight:h,outWidth:p}}function Hc(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function xa(t){const[e,n,i]=Gc(t);return e===1&&n===1&&i===1}function pi(t,e){return xa(t)||xa(e)}function ba(t){return Gc(t).every(e=>e>0)}function tr(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function zi(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")F(Dl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(i=>{i.forEach(s=>{F(Dl(s),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${s}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(t,e){const i={x:V(t,"x","reshape","string_or_numeric")},s={shape:e};return K.runKernel(ap,i,s)}const Z=Q({reshape_:r6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(t,e,n,i,s){const o=V(t,"x","avgPool","float32"),r=1;F(pi(n,r),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),zi("avgPool",i,s);const c={x:a},u={filterSize:e,strides:n,pad:i,dimRoundingMode:s};let d=K.runKernel(Sf,c,u);return d=Fe(d,o.dtype),l?Z(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const f0=Q({avgPool_:a6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(t,e,n,i,s,o="NDHWC"){const r=V(t,"x","avgPool3d","float32");let a=r,l=!1;r.rank===4&&(l=!0,a=Z(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),F(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),F(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),F(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),zi("avgPool3d",i,s);const c={x:a},u={filterSize:e,strides:n,pad:i,dimRoundingMode:s,dataFormat:o};let d=K.runKernel(If,c,u);return d=Fe(d,a.dtype),l?Z(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const c6=Q({avgPool3d_:l6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(t,e=0){F(t.length>=1,()=>"Pass at least one tensor to concat");const n=t2(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),n.length===1)return la(n[0]);const i=n,s={axis:e};return K.runKernel(kf,i,s)}const Mi=Q({concat_:u6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(t,e,n=!1,i=!1){let s=V(t,"a","matMul"),o=V(e,"b","matMul");[s,o]=Sn(s,o);const r={a:s,b:o},a={transposeA:n,transposeB:i};return K.runKernel($f,r,a)}const Bt=Q({matMul_:d6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(t){const n={x:V(t,"x","sigmoid","float32")};return K.runKernel(Xu,n)}const Ql=Q({sigmoid_:h6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(t,e,n){const i=V(t,"x","slice","string_or_numeric");if(i.rank===0)throw new Error("Slicing scalar is not possible");const s={x:i},o={begin:e,size:n};return K.runKernel(hp,s,o)}const Qt=Q({slice_:f6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(t){const n={x:V(t,"x","tanh","float32")};return K.runKernel(ed,n)}const Sp=Q({tanh_:p6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(t,e,n){const i=V(t,"x","batchToSpaceND"),s=e.reduce((a,l)=>a*l);F(i.rank>=1+e.length,()=>`input rank is ${i.rank} but should be > than blockShape.length ${e.length}`),F(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),F(i.shape[0]%s===0,()=>`input tensor batch is ${i.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const o={x:i},r={blockShape:e,crops:n};return K.runKernel(Ef,o,r)}const p0=Q({batchToSpaceND_:m6});function g6(t){let e;return t.rank===0||t.rank===1?e=Z(t,[1,1,1,t.size]):t.rank===2?e=Z(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=Z(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(t,e,n,i,s,o){o==null&&(o=.001);const r=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let c;s!=null&&(c=V(s,"scale","batchNorm"));let u;i!=null&&(u=V(i,"offset","batchNorm")),F(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:g6(r),scale:c,offset:u,mean:a,variance:l},h={varianceEpsilon:o},p=K.runKernel(Ff,f,h);return Z(p,r.shape)}const Ip=Q({batchNorm_:v6});function x6(t,e,n,i,s,o){const r=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let c;s!=null&&(c=V(s,"scale","batchNorm"));let u;return i!=null&&(u=V(i,"offset","batchNorm")),F(r.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${r.rank}.`),F(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),F(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Ip(r,a,l,u,c,o)}const b6=Q({batchNorm2d_:x6});function y6(t,e,n,i,s,o){const r=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let c;s!=null&&(c=V(s,"scale","batchNorm"));let u;return i!=null&&(u=V(i,"offset","batchNorm")),F(r.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${r.rank}.`),F(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),F(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Ip(r,a,l,u,c,o)}const w6=Q({batchNorm3d_:y6});function C6(t,e,n,i,s,o){const r=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let c;s!=null&&(c=V(s,"scale","batchNorm"));let u;return i!=null&&(u=V(i,"offset","batchNorm")),F(r.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${r.rank}.`),F(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),F(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Ip(r,a,l,u,c,o)}const S6=Q({batchNorm4d_:C6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6(t,e,n){const i=V(t,"x","bincount"),s=V(e,"weights","bincount");F(i.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${i.dtype}`),F(n>=0,()=>`size must be non-negative, but got ${n}.`),F(s.size===i.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${i.shape}, weights shape: ${s.shape}.`);const o={x:i,weights:s},r={size:n};return K.runKernel(Ex,o,r)}const $6=Q({bincount_:I6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6(t,e){let n=V(t,"broadcastTo","x");const i=n.shape;if(Qo(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=Z(n,c)}const s=n.shape,o=Array.from(e);for(let c=e.length-1;c>=0;c--)if(s[c]===e[c])o[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${e}].`);if(o.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return la(n);const a={x:n},l={reps:o};return K.runKernel(td,a,l)}const _c=Q({broadcastTo_:E6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6(t){const n={x:V(t,"x","ceil","float32")};return K.runKernel(gu,n)}const k6=Q({ceil_:N6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $p(t,e,n){Qo(t),n=n||Yl(e);const i={shape:t,value:e,dtype:n};return K.runKernel(Vx,{},i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D6(t,e,n){const i=V(t,"x","clipByValue");if(F(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return $p(i.shape,e,i.dtype);const s={x:i},o={clipValueMin:e,clipValueMax:n};return K.runKernel(vu,s,o)}const ls=Q({clipByValue_:D6});function T6(t){return Mi(t,0)}const R6=Q({concat1d_:T6});function _6(t,e){return Mi(t,e)}const A6=Q({concat2d_:_6});function O6(t,e){return Mi(t,e)}const P6=Q({concat3d_:O6});function M6(t,e){return Mi(t,e)}const F6=Q({concat4d_:M6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(t,e,n,i,s="NHWC",o=[1,1],r){const a=V(t,"x","conv2d","float32"),l=V(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=Z(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),zi("conv2d",i,r);const d=s==="NHWC"?c.shape[3]:c.shape[1];F(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),F(pi(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),F(ba(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),F(ba(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},h={strides:n,pad:i,dataFormat:s,dilations:o,dimRoundingMode:r},p=K.runKernel(Df,f,h);return u?Z(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const ya=Q({conv2d_:L6});function z6(t,e,n,i,s="NWC",o=1,r){const a=V(t,"x","conv1d"),l=V(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=Z(a,[1,a.shape[0],a.shape[1]])),F(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),F(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),zi("conv1d",i,r),F(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),F(pi(n,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`),F(ba(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),F(ba(n),()=>"Error in conv1D: Stride should be larger than 0."),F(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=Z(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=ya(f,d,[1,n],i,"NHWC",[1,o],r);return u?Z(g,[g.shape[2],g.shape[3]]):Z(g,[g.shape[0],g.shape[2],g.shape[3]])}const d2=Q({conv1d_:z6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(t,e,n,i,s,o="NHWC",r){F(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),F(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),F(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),F(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];F(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),F(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),zi("conv2dDerInput",s,r);const f={dy:l,filter:n},h={strides:i,pad:s,dataFormat:o,dimRoundingMode:r,inputShape:a},p=K.runKernel(Tf,f,h);return c?Z(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const m0=Q({conv2DBackpropInput_:B6});function V6(t,e,n,i,s,o){const r=V(t,"x","conv2dTranspose"),a=V(e,"filter","conv2dTranspose");return m0(n,r,a,i,s,"NHWC",o)}const h2=Q({conv2dTranspose_:V6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(t,e,n,i,s="NDHWC",o=[1,1,1]){const r=V(t,"x","conv3d"),a=V(e,"filter","conv3d");let l=r,c=!1;r.rank===4&&(c=!0,l=Z(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),F(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),F(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),F(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),F(pi(n,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),F(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),F(ba(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),F(ba(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:n,pad:i,dataFormat:s,dilations:o},f=K.runKernel(Rf,u,d);return c?Z(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const G6=Q({conv3d_:W6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(t,e,n,i,s){F(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let o=t,r=e,a=!1;e.rank===4&&(a=!0,r=Z(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const l=o[4],c=r.shape[4];F(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),F(r.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${r.rank}`),F(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),F(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),F(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:r,filter:n},d={pad:s,strides:i,inputShape:o},f=K.runKernel(Rx,u,d);return a?Z(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const f2=Q({conv3DBackpropInput_:H6});function U6(t,e,n,i,s){const o=V(t,"x","conv3dTranspose"),r=V(e,"filter","conv3dTranspose");return f2(n,o,r,i,s)}const j6=Q({conv3dTranspose_:U6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(t){const n={x:V(t,"x","cos","float32")};return K.runKernel(xu,n)}const g0=Q({cos_:K6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(t){const n={x:V(t,"x","cosh","float32")};return K.runKernel(bu,n)}const p2=Q({cosh_:X6});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t,e=0,n=!1,i=!1){const o={x:V(t,"x","cumprod")},r={axis:e,exclusive:n,reverse:i};return K.runKernel(_x,o,r)}const Fg=Q({cumprod_:q6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(t,e=0,n=!1,i=!1){const o={x:V(t,"x","cumsum")},r={axis:e,exclusive:n,reverse:i};return K.runKernel(_f,o,r)}const m2=Q({cumsum_:Y6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(t,e,n,i=!1){const s=V(t,"x","denseBincount"),o=V(e,"weights","denseBincount");F(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),F(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),F(n>=0,()=>`size must be non-negative, but got ${n}.`),F(o.size===s.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`);const r={x:s,weights:o},a={size:n,binaryOutput:i};return K.runKernel(Ox,r,a)}const EC=Q({denseBincount_:J6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(t,e,n="NHWC"){const i=V(t,"x","depthToSpace","float32"),s=n==="NHWC"?i.shape[1]:i.shape[2],o=n==="NHWC"?i.shape[2]:i.shape[3],r=n==="NHWC"?i.shape[3]:i.shape[1];F(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),F(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${i.shape}`),F(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${i.shape}`),F(r%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${r} for depthToSpace with input shape ${i.shape}`);const a={x:i},l={blockSize:e,dataFormat:n};return K.runKernel(Px,a,l)}const Q6=Q({depthToSpace_:Z6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(t,e,n,i,s="NHWC",o=[1,1],r){const a=V(t,"x","depthwiseConv2d","float32"),l=V(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=Z(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=s==="NHWC"?c.shape[3]:c.shape[1];F(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),zi("depthwiseConv2d",i,r);const f={x:c,filter:l},h={strides:n,pad:i,dataFormat:s,dilations:o,dimRoundingMode:r},p=K.runKernel(Af,f,h);return u?Z(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const v0=Q({depthwiseConv2d_:ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(t,e,n,i,s=[1,1],o="NHWC"){const r=V(t,"x","dilation2d"),a=V(e,"filter","dilation2d");F(r.rank===3||r.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${r.rank}.`),F(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),F(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=r,c=!1;r.rank===3&&(l=Z(r,[1,r.shape[0],r.shape[1],r.shape[2]]),c=!0),F(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:n,pad:i,dilations:s},f=K.runKernel(Of,u,d);return c?Z(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const nj=Q({dilation2d_:tj});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Al(t,e){const n=t.length,i=[];for(let s=0;s<n;s++){const o=n-1-s,r=t[o]||1;(e[e.length-1-s]||1)>1&&r===1&&i.unshift(o)}return i}function Vn(t,e){const n=[];for(let i=0;i<e.length;i++){const s=t[t.length-i-1],o=e.length-i-1,r=e[o];(s==null||s===1&&r>1)&&n.unshift(o)}return n}function mt(t,e){const n=Math.max(t.length,e.length),i=new Array(n);for(let s=0;s<n;s++){let o=t[t.length-s-1];o==null&&(o=1);let r=e[e.length-s-1];if(r==null&&(r=1),o===1)i[n-s-1]=r;else if(r===1)i[n-s-1]=o;else if(o!==r){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else i[n-s-1]=o}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ij(t,e){let n=V(t,"a","equal","string_or_numeric"),i=V(e,"b","equal","string_or_numeric");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Pf,s)}const So=Q({equal_:ij});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sj(t,e,n){const i=V(e,"a","where"),s=V(n,"b","where"),o=V(t,"condition","where","bool"),r=mt(mt(o.shape,i.shape),s.shape),a=_c(o,r),l=_c(i,r),c=_c(s,r),u={condition:a,t:l,e:c};return K.runKernel(dp,u)}const Ci=Q({where_:sj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oj(t){const n={x:V(t,"x","zerosLike")};return K.runKernel(bp,n)}const At=Q({zerosLike_:oj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(t,e){let n=V(t,"a","div"),i=V(e,"b","div");[n,i]=Sn(n,i);const s=nt(n,i),o=At(s),r=So(i,o);return Ci(r,o,s)}const aj=Q({divNoNan_:rj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lj(t,e){const n=V(t,"t1","dot"),i=V(e,"t2","dot");F((n.rank===1||n.rank===2)&&(i.rank===1||i.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${i.rank}.`);const s=n.rank===1?n.size:n.shape[1],o=i.rank===1?i.size:i.shape[0];if(F(s===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`),n.rank===1&&i.rank===1){const r=Z(n,[1,-1]),a=Z(i,[-1,1]),l=Bt(r,a);return Z(l,[])}else if(n.rank===1&&i.rank===2){const r=Z(n,[1,-1]),a=Z(i,[i.shape[0],i.shape[1]]),l=Bt(r,a);return Z(l,[l.size])}else if(n.rank===2&&i.rank===1){const r=Z(i,[-1,1]),a=Bt(n,r);return Z(a,[a.size])}else{const r=Z(i,[i.shape[0],i.shape[1]]);return Bt(n,r)}}const cj=Q({dot_:lj});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uj(t,...e){const n=e.map((s,o)=>V(s,`tensors${o}`,"einsum")),i={equation:t};return K.runKernel(Lx,n,i)}const vc=Q({einsum_:uj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dj(t){const n={x:V(t,"x","elu","float32")};return K.runKernel(wu,n)}const Ep=Q({elu_:dj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hj(t){let e=V(t,"x","erf");F(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Fe(e,"float32"));const n={x:e};return K.runKernel(Cu,n)}const g2=Q({erf_:hj});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function v2(t,e,n){const i=t.length+e.length,s=[];let o=0,r=0;for(let a=0;a<i;a++)n.indexOf(a)===-1?s.push(t[o++]):s.push(e[r++]);return s}function Yn(t,e){const n=[],i=t.length;for(let o=0;o<i;o++)e.indexOf(o)===-1&&n.push(t[o]);const s=e.map(o=>t[o]);return[n,s]}function Rn(t,e){const n=e.map(i=>1);return v2(t,n,e)}function ii(t,e,n){F(x0(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function mn(t,e){if(x0(t,e))return null;const n=[];for(let i=0;i<e;++i)t.indexOf(i)===-1&&n.push(i);return t.forEach(i=>n.push(i)),n}function Ar(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Nn(t,e){const n=[];for(let i=e-t;i<e;++i)n.push(i);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fj(t,e=null,n=!1){const s={x:V(t,"x","max")},o={reductionIndices:e,keepDims:n};return K.runKernel(Kf,s,o)}const Us=Q({max_:fj});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pj(t,e=null,n=!1){const s={x:V(t,"x","min")},o={axis:e,keepDims:n};return K.runKernel(Jf,s,o)}const Rh=Q({min_:pj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(t,e){let n=V(t,"base","pow"),i=V(e,"exp","pow");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(Lu,s)}const wa=Q({pow_:mj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(t,e){if((Ds(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ds(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Cp(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gj(t){const n={x:V(t,"x","sqrt","float32")};return K.runKernel(Yu,n)}const fi=Q({sqrt_:gj});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vj(t){const e=V(t,"x","square"),n={};return K.runKernel("Square",{x:e},n)}const on=Q({square_:vj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(t,e=null,n=!1){let i=V(t,"x","sum");i.dtype==="bool"&&(i=Fe(i,"int32"));const s={x:i},o={axis:e,keepDims:n};return K.runKernel(fp,s,o)}const Qe=Q({sum_:xj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bj(t,e="euclidean",n=null,i=!1){t=V(t,"x","norm");const s=x2(t,e,n);let o=s.shape;if(i){const r=St(n,t.shape);o=Rn(s.shape,r)}return Z(s,o)}function x2(t,e,n=null){if(t.rank===0)return xi(t);if(t.rank!==1&&n===null)return x2(Z(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return Qe(xi(t),n);if(e===1/0)return Us(xi(t),n);if(e===-1/0)return Rh(xi(t),n);if(e==="euclidean"||e===2)return fi(Qe(wa(xi(t),Vt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Us(Qe(xi(t),n[0]),n[1]-1);if(e===1/0)return Us(Qe(xi(t),n[1]),n[0]);if(e===-1/0)return Rh(Qe(xi(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return fi(Qe(on(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Np=Q({norm_:bj});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yj(t,e=null,n=!1){return Np(t,"euclidean",e,n)}const wj=Q({euclideanNorm_:yj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cj(t){const n={x:V(t,"x","exp")};return K.runKernel(Su,n)}const Io=Q({exp_:Cj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(t,e=0){const n=V(t,"x","expandDims","string_or_numeric");F(e<=n.rank,()=>"Axis must be <= rank of the tensor");const i={input:n},s={dim:e};return K.runKernel(Mf,i,s)}const _i=Q({expandDims_:Sj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ij(t){const n={x:V(t,"x","expm1")};return K.runKernel(Iu,n)}const $j=Q({expm1_:Ij});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ej(t,e){const n=V(t,"x","tile","string_or_numeric");F(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const i={x:n},s={reps:e};return K.runKernel(td,i,s)}const Gs=Q({tile_:Ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(t,e,n,i="float32"){e==null&&(e=t);const s=Ct([t,e],i),o=t<=e?t:e;for(let a=0;a<o;++a)s.set(1,a,a);const r=Z(s.toTensor(),[t,e]);if(n==null)return r;if(n.length===1)return Gs(_i(r,0),[n[0],1,1]);if(n.length===2)return Gs(_i(_i(r,0),0),[n[0],n[1],1,1]);if(n.length===3)return Gs(_i(_i(_i(r,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const b2=Q({eye_:Nj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(t){const n={x:V(t,"x","floor","float32")};return K.runKernel($u,n)}const kp=Q({floor_:kj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dj(t,e,n=0,i=0){const s=V(t,"x","gather"),o=V(e,"indices","gather","int32"),r={x:s,indices:o},a={axis:n,batchDims:i};return K.runKernel(Lf,r,a)}const b0=Q({gather_:Dj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tj(t,e){let n=V(t,"a","greater","string_or_numeric"),i=V(e,"b","greater","string_or_numeric");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(zf,s)}const cs=Q({greater_:Tj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rj(t,e){let n=V(t,"a","greaterEqual","string_or_numeric"),i=V(e,"b","greaterEqual","string_or_numeric");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Nu,s)}const Pa=Q({greaterEqual_:Rj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _j(t){const n={input:V(t,"input","imag")};return K.runKernel(Hx,n)}const y0=Q({imag_:_j});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aj(t){const n={x:V(t,"x","isFinite")};return K.runKernel(Du,n)}const Oj=Q({isFinite_:Aj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pj(t){const n={x:V(t,"x","isInf")};return K.runKernel(Tu,n)}const Mj=Q({isInf_:Pj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(t){const n={x:V(t,"x","isNaN")};return K.runKernel(Ru,n)}const Lj=Q({isNaN_:Fj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(t,e=.2){const i={x:V(t,"x","leakyRelu")},s={alpha:e};return K.runKernel(Bf,i,s)}const w0=Q({leakyRelu_:zj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bj(t,e){let n=V(t,"a","less","string_or_numeric"),i=V(e,"b","less","string_or_numeric");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Vf,s)}const _h=Q({less_:Bj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(t,e){let n=V(t,"a","lessEqual","string_or_numeric"),i=V(e,"b","lessEqual","string_or_numeric");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Wf,s)}const ec=Q({lessEqual_:Vj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(t,e=5,n=1,i=1,s=.5){const o=V(t,"x","localResponseNormalization");F(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),F(Dl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let r=o,a=!1;o.rank===3&&(a=!0,r=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:r},c={depthRadius:e,bias:n,alpha:i,beta:s},u=K.runKernel(jf,l,c);return a?Z(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Gj=Q({localResponseNormalization_:Wj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(t){const n={x:V(t,"x","log","float32")};return K.runKernel(_u,n)}const $o=Q({log_:Hj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(t){const n={x:V(t,"x","log1p")};return K.runKernel(Au,n)}const y2=Q({log1p_:Uj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(t,e){F(wg(t),()=>"The f passed in variableGrads(f) must be a function"),F(e==null||Array.isArray(e)&&e.every(c=>c instanceof Dh),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in K.registeredVariables)e.push(K.registeredVariables[c])}const i=n?e.filter(c=>!c.trainable):null,s=e.length;e=e.filter(c=>c.trainable),F(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const o=!0,{value:r,grads:a}=K.gradients(t,e,null,o);F(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),F(r.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${r.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),i!=null&&i.forEach(c=>l[c.name]=null),{value:r,grads:l}}function Ol(t){return K.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kj(t){const n={x:V(t,"x","neg")};return K.runKernel(Qf,n)}const Cn=Q({neg_:Kj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xj(t){const n={x:V(t,"x","softplus")};return K.runKernel(qu,n)}const sd=Q({softplus_:Xj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(t){const e=V(t,"x","logSigmoid");return Ol(i=>({value:Cn(sd(Cn(i))),gradFunc:r=>U(r,Ql(Cn(i)))}))(e)}const Yj=Q({logSigmoid_:qj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jj(t,e){let n=V(t,"a","sub"),i=V(e,"b","sub");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(Zu,s)}const rt=Q({sub_:Jj});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(t,e=-1){const n=V(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Ol((s,o)=>{const a=Us(s,e,!0),l=rt(s,a),c=rt(Fe(l,"float32"),$o(Qe(Io(l),e,!0)));return o([c]),{value:c,gradFunc:(d,f)=>{const[h]=f,p=!0,m=Io(h);return rt(d,U(Qe(d,e,p),m))}}})(n)}const w2=Q({logSoftmax_:Zj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(t,e=null,n=!1){const i=V(t,"x","logSumExp"),s=St(e,i.shape),o=Us(i,s,!0),r=rt(i,o),a=Io(r),l=Qe(a,s),c=$o(l),u=Se(Z(o,c.shape),c);if(n){const d=Rn(u.shape,s);return Z(u,d)}return u}const C2=Q({logSumExp_:Qj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(t,e){const n=V(t,"a","logicalAnd","bool"),i=V(e,"b","logicalAnd","bool");mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Gf,s)}const jo=Q({logicalAnd_:eK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(t){const n={x:V(t,"x","logicalNot","bool")};return K.runKernel(Hf,n)}const C0=Q({logicalNot_:tK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(t,e){const n=V(t,"a","logicalOr","bool"),i=V(e,"b","logicalOr","bool");mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Uf,s)}const S2=Q({logicalOr_:nK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(t,e){const n=V(t,"a","logicalXor","bool"),i=V(e,"b","logicalXor","bool");return mt(n.shape,i.shape),jo(S2(t,e),C0(jo(t,e)))}const sK=Q({logicalXor_:iK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(t,e,n,i,s){const o=V(t,"x","maxPool"),r=1;let a=o,l=!1;o.rank===3&&(l=!0,a=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),F(pi(n,r),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),zi("maxPool",i,s);const c={x:a},u={filterSize:e,strides:n,pad:i,dimRoundingMode:s},d=K.runKernel(Xf,c,u);return l?Z(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const S0=Q({maxPool_:oK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(t,e=[1,1,1],n,i,s,o="NDHWC"){const r=V(t,"x","maxPool3d");let a=r,l=!1;r.rank===4&&(l=!0,a=Z(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),F(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),F(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),zi("maxPool3d",i,s);const c={x:a},u={filterSize:e,strides:n,pad:i,dimRoundingMode:s,dataFormat:o},d=K.runKernel(qf,c,u);return l?Z(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const aK=Q({maxPool3d_:rK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(t,e){let n=V(t,"a","maximum"),i=V(e,"b","maximum");[n,i]=Sn(n,i),n.dtype==="bool"&&(n=Fe(n,"int32"),i=Fe(i,"int32")),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Ou,s)}const Or=Q({maximum_:lK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(t,e=null,n=!1){const s={x:V(t,"x","mean")},o={axis:e,keepDims:n};return K.runKernel(Yf,s,o)}const Tn=Q({mean_:cK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xn(t,e="float32"){if(Qo(t),e==="complex64"){const i=Xn(t,"float32"),s=Xn(t,"float32");return ma(i,s)}const n=hi(pe(t),e);return K.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pr(t,e="float32"){if(Qo(t),e==="complex64"){const i=Pr(t,"float32"),s=Xn(t,"float32");return ma(i,s)}const n=xx(pe(t),e);return K.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uK(t,e){let n=V(t,"a","minimum"),i=V(e,"b","minimum");[n,i]=Sn(n,i),n.dtype==="bool"&&(n=Fe(n,"int32"),i=Fe(i,"int32")),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(Pu,s)}const Uc=Q({minimum_:uK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(t,e,n){F(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const i=V(t,"x","mirrorPad");if(i.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");F(e.length===i.rank,()=>`Padding doesn't match input. Must be ${i.rank}. Got ${e.length}.`);const s=n==="reflect"?1:0;for(let a=0;a<i.rank;a++)F(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),F(e[a][0]>=0&&e[a][0]<=i.shape[a]-s&&e[a][1]>=0&&e[a][1]<=i.shape[a]-s,()=>`Padding in dimension ${a} cannot be greater than or equal to ${i.shape[a]-s} or less than 0 for input of shape ${i.shape}`);const o={paddings:e,mode:n},r={x:i};return K.runKernel(Zf,r,o)}const hK=Q({mirrorPad_:dK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(t,e){let n=V(t,"a","mod"),i=V(e,"b","mod");[n,i]=Sn(n,i);const s={a:n,b:i};return K.runKernel(Mu,s)}const pK=Q({mod_:fK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(t,e=null,n=!1){t=V(t,"x","moments");const i=St(e,t.shape),s=Tn(t,i,n);let o=s.shape;n||(o=Rn(s.shape,i));const r=on(rt(Fe(t,"float32"),Z(s,o))),a=Tn(r,i,n);return{mean:s,variance:a}}const I0=Q({moments_:mK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(t,e){let n=V(t,"a","notEqual","string_or_numeric"),i=V(e,"b","notEqual","string_or_numeric");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i};return K.runKernel(ep,s)}const Ah=Q({notEqual_:gK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(t,e,n=1,i=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const r={indices:V(t,"indices","oneHot","int32")},a={dtype:s,depth:e,onValue:n,offValue:i};return K.runKernel(np,r,a)}const I2=Q({oneHot_:vK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(t){const n={x:V(t,"x","onesLike")};return K.runKernel(tp,n)}const Ts=Q({onesLike_:xK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(t,e,n=0){const i=V(t,"x","pad");if(i.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:i};return K.runKernel(sp,o,s)}const $0=Q({pad_:bK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(t,e,n){const i=V(t,"x","spaceToBatchND");F(i.rank>=1+e.length,()=>`input rank ${i.rank} should be > than [blockShape] ${e.length}`),F(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),F(i.shape.reduce((r,a,l)=>l>0&&l<=e.length?r&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:r,!0),()=>`input spatial dimensions ${i.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:i},o={blockShape:e,paddings:n};return K.runKernel(pp,s,o)}const E0=Q({spaceToBatchND_:yK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(t,e,n,i,s,o,r){s==null&&(s=[1,1]),o==null&&(o=1),i===0&&(i="valid");const a=V(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=Z(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(pi(o,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`);const u=As(l.shape,e,o,s,i),d=[u.dilationHeight,u.dilationWidth];let f;i==="same"?f=SK([u.filterHeight,u.filterWidth],d):f=[[0,0],[0,0]];const h=d[0]===1&&d[1]===1,[p,m]=CK([u.inHeight,u.inWidth],d,f),g=h?i:"valid",v=h?l:E0(l,d,p),b=(n==="avg"?()=>f0(v,e,o,g,r):()=>S0(v,e,o,g,r))(),w=h?b:p0(b,d,m);return c?Z(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function CK(t,e,n){const i=n.map(u=>u[0]),s=n.map(u=>u[1]),o=t.concat(i,s),r=e.map((u,d)=>(u-o[d]%u)%u),a=s.map((u,d)=>u+r[d]),l=e.map((u,d)=>[i[d],a[d]]),c=e.map((u,d)=>[0,r[d]]);return[l,c]}function SK(t,e){const i=t.map((r,a)=>r+(r-1)*(e[a]-1)).map(r=>r-1),s=i.map(r=>Math.floor(r/2)),o=i.map((r,a)=>r-s[a]);return i.map((r,a)=>[s[a],o[a]])}const IK=Q({pool_:wK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(t,e){const n=V(t,"x","prelu"),i=V(e,"alpha","prelu"),s={x:n,alpha:i};return K.runKernel(op,s)}const N0=Q({prelu_:$K});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(t,e=null,n=!1){let i=V(t,"x","prod");i.dtype==="bool"&&(i=Fe(i,"int32"));const s={x:i},o={axis:e,keepDims:n};return K.runKernel(rp,s,o)}const NK=Q({prod_:EK});var k0={exports:{}};k0.exports;(function(t){(function(e,n,i){function s(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function o(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function r(l,c){var u=new s(l),d=c&&c.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=r:this.alea=r})(po,t)})(k0);var kK=k0.exports,D0={exports:{}};D0.exports;(function(t){(function(e,n,i){function s(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function r(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=r:this.xor128=r})(po,t)})(D0);var DK=D0.exports,T0={exports:{}};T0.exports;(function(t){(function(e,n,i){function s(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function r(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=r:this.xorwow=r})(po,t)})(T0);var TK=T0.exports,R0={exports:{}};R0.exports;(function(t){(function(e,n,i){function s(a){var l=this;l.next=function(){var u=l.x,d=l.i,f,h;return f=u[d],f^=f>>>7,h=f^f<<24,f=u[d+1&7],h^=f^f>>>10,f=u[d+3&7],h^=f^f>>>3,f=u[d+4&7],h^=f^f<<7,f=u[d+7&7],f=f^f<<13,h^=f^f<<9,u[d]=h,l.i=d+1&7,h};function c(u,d){var f,h=[];if(d===(d|0))h[0]=d;else for(d=""+d,f=0;f<d.length;++f)h[f&7]=h[f&7]<<15^d.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],u.x=h,u.i=0,f=256;f>0;--f)u.next()}c(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function r(a,l){a==null&&(a=+new Date);var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.x&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=r:this.xorshift7=r})(po,t)})(R0);var RK=R0.exports,_0={exports:{}};_0.exports;(function(t){(function(e,n,i){function s(a){var l=this;l.next=function(){var u=l.w,d=l.X,f=l.i,h,p;return l.w=u=u+1640531527|0,p=d[f+34&127],h=d[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=d[f]=p^h,l.i=f,p+(u^u>>>16)|0};function c(u,d){var f,h,p,m,g,v=[],x=128;for(d===(d|0)?(h=d,d=null):(d=d+"\0",h=0,x=Math.max(x,d.length)),p=0,m=-32;m<x;++m)d&&(h^=d.charCodeAt((m+32)%d.length)),m===0&&(g=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,m>=0&&(g=g+1640531527|0,f=v[m&127]^=h+g,p=f==0?p+1:0);for(p>=128&&(v[(d&&d.length||0)&127]=-1),p=127,m=4*128;m>0;--m)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;u.w=g,u.X=v,u.i=p}c(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function r(a,l){a==null&&(a=+new Date);var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.X&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=r:this.xor4096=r})(po,t)})(_0);var _K=_0.exports,A0={exports:{}};A0.exports;(function(t){(function(e,n,i){function s(a){var l=this,c="";l.next=function(){var d=l.b,f=l.c,h=l.d,p=l.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-h|0,l.d=h<<16^f>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function r(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=r:this.tychei=r})(po,t)})(A0);var AK=A0.exports,$2={exports:{}};(function(t){(function(e,n,i){var s=256,o=6,r=52,a="random",l=i.pow(s,o),c=i.pow(2,r),u=c*2,d=s-1,f;function h(w,y,C){var I=[];y=y==!0?{entropy:!0}:y||{};var $=v(g(y.entropy?[w,b(n)]:w??x(),3),I),E=new p(I),N=function(){for(var k=E.g(o),D=l,_=0;k<c;)k=(k+_)*s,D*=s,_=E.g(1);for(;k>=u;)k/=2,D/=2,_>>>=1;return(k+_)/D};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,v(b(E.S),n),(y.pass||C||function(k,D,_,R){return R&&(R.S&&m(R,E),k.state=function(){return m(E,{})}),_?(i[a]=k,D):k})(N,$,"global"in y?y.global:this==i,y.state)}function p(w){var y,C=w.length,I=this,$=0,E=I.i=I.j=0,N=I.S=[];for(C||(w=[C++]);$<s;)N[$]=$++;for($=0;$<s;$++)N[$]=N[E=d&E+w[$%C]+(y=N[$])],N[E]=y;(I.g=function(k){for(var D,_=0,R=I.i,T=I.j,A=I.S;k--;)D=A[R=d&R+1],_=_*s+A[d&(A[R]=A[T=d&T+D])+(A[T]=D)];return I.i=R,I.j=T,_})(s)}function m(w,y){return y.i=w.i,y.j=w.j,y.S=w.S.slice(),y}function g(w,y){var C=[],I=typeof w,$;if(y&&I=="object")for($ in w)try{C.push(g(w[$],y-1))}catch{}return C.length?C:I=="string"?w:w+"\0"}function v(w,y){for(var C=w+"",I,$=0;$<C.length;)y[d&$]=d&(I^=y[d&$]*19)+C.charCodeAt($++);return b(y)}function x(){try{var w;return f&&(w=f.randomBytes)?w=w(s):(w=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var y=e.navigator,C=y&&y.plugins;return[+new Date,e,C,e.screen,b(n)]}}function b(w){return String.fromCharCode.apply(0,w)}if(v(i.random(),n),t.exports){t.exports=h;try{f=G_}catch{}}else i["seed"+a]=h})(typeof self<"u"?self:po,[],Math)})($2);var OK=$2.exports,PK=kK,MK=DK,FK=TK,LK=RK,zK=_K,BK=AK,Ma=OK;Ma.alea=PK;Ma.xor128=MK;Ma.xorwow=FK;Ma.xorshift7=LK;Ma.xor4096=zK;Ma.tychei=BK;var O0=Ma;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2{constructor(e,n,i,s,o){this.mean=e,this.stdDev=n,this.dtype=i,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const r=o||Math.random();this.random=O0.alea(r.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,n,i=!1;for(;!i;){let s,o,r;do s=2*this.random()-1,o=2*this.random()-1,r=s*s+o*o;while(r>=1||r===0);const a=Math.sqrt(-2*Math.log(r)/r);e=this.mean+this.stdDev*s*a,n=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(i=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class VK{constructor(e=0,n=1,i,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=i,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=O0.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(t,e=0,n=1,i,s){if(Qo(t),i!=null&&i==="bool")throw new Error(`Unsupported data type ${i}`);const o=new E2(e,n,i,!1,s),r=Ct(t,i);for(let a=0;a<r.values.length;a++)r.values[a]=o.nextValue();return r.toTensor()}const N2=Q({randomNormal_:WK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GK(t,e=0,n=1,i="float32",s){Qo(t);const o=Ct(t,i),r=new VK(e,n,null,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const od=Q({randomUniform_:GK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jc(t,e,n=1,i="float32"){if(n===0)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:i};return K.runKernel(Jx,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(t){const n={input:V(t,"input","real")};return K.runKernel(Zx,n)}const Oh=Q({real_:HK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK(t){const n={x:V(t,"x","reciprocal")};return K.runKernel(zu,n)}const jK=Q({reciprocal_:UK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(t){const n={x:V(t,"x","relu")};return K.runKernel(Bu,n)}const Fa=Q({relu_:KK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(t){const n={x:V(t,"x","relu6")};return K.runKernel(Vu,n)}const k2=Q({relu6_:XK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qK(t,e){const i={x:V(t,"x","reverse")},s={dims:e};return K.runKernel(up,i,s)}const Ca=Q({reverse_:qK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(t){const n={x:V(t,"x","round")};return K.runKernel(Wu,n)}const D2=Q({round_:YK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(t){const n={x:V(t,"x","rsqrt","float32")};return K.runKernel(Gu,n)}const T2=Q({rsqrt_:JK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(t){const n={x:V(t,"x","selu")};return K.runKernel(Hu,n)}const R2=Q({selu_:ZK});function QK(t,e,n,i,s,o=[1,1],r="NHWC"){const a=V(t,"x","separableConv2d"),l=V(e,"depthwiseFilter","separableConv2d"),c=V(n,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=Z(a,[1,a.shape[0],a.shape[1],a.shape[2]])),r==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),F(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),F(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),F(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],h=l.shape[3];F(c.shape[2]===f*h,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*h}, but got ${c.shape[2]}.`);const p=v0(u,l,i,s,r,o),g=ya(p,c,1,"valid",r);return d?Z(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const _2=Q({separableConv2d_:QK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(t){const n={x:V(t,"x","sign")};return K.runKernel(Ku,n)}const t5=Q({sign_:e5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(t){const n={x:V(t,"x","sin","float32")};return K.runKernel(Uu,n)}const A2=Q({sin_:n5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(t){const n={x:V(t,"x","sinh")};return K.runKernel(ju,n)}const O2=Q({sinh_:i5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(t,e,n){const i=V(t,"x","slice1d");return F(i.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${i.rank} tensor`),Qt(i,[e],[n])}const P0=Q({slice1d_:s5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(t,e,n){const i=V(t,"x","slice2d");return F(i.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${i.rank} tensor`),Qt(i,e,n)}const P2=Q({slice2d_:o5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(t,e,n){const i=V(t,"x","slice3d");return F(i.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${i.rank} tensor`),Qt(i,e,n)}const M0=Q({slice3d_:r5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(t,e,n){const i=V(t,"x","slice4d");return F(i.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${i.rank} tensor`),Qt(i,e,n)}const Ph=Q({slice4d_:a5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(t,e=-1){const n=V(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const i={logits:n},s={dim:e};return K.runKernel(gp,i,s)}const F0=Q({softmax_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return K.runKernel(Bx,e)}const M2=Q({fft_:c5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return K.runKernel(Gx,e)}const Lg=Q({ifft_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(t){const e=t.shape[t.shape.length-1],n=t.size/e;let i;if(e<=2){const s=Z(t,[n,e]);i=Lg(s)}else{const s=[n,2*(e-1)],o=Z(Oh(t),[n,e]),r=Z(y0(t),[n,e]),a=Ca(Qt(o,[0,1],[n,e-2]),1),l=U(Ca(Qt(r,[0,1],[n,e-2]),1),Vt(-1)),c=Mi([o,a],1),u=Mi([r,l],1),d=Z(ma(c,u),[s[0],s[1]]);i=Lg(d)}if(i=Oh(i),t.rank===3&&t.shape[0]!==0){const s=i,o=t.shape[0];i=Z(i,[o,i.shape[0]/o,i.shape[1]]),s.dispose()}return i}const h5=Q({irfft_:d5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(t,e,n=0){const s={x:V(t,"x","split")},o={numOrSizeSplits:e,axis:n};return K.runKernel(mp,s,o)}const rs=Q({split_:f5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(t,e){F(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const i=t.size/n;let s;if(e!=null&&e<n){const p=t.shape.map(g=>0),m=t.shape.map(g=>g);m[t.shape.length-1]=e,s=Qt(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,s=Mi([t,Xn(p)],t.shape.length-1),n=e}else s=t;const o=At(s),r=Z(ma(s,o),[i,n]),a=M2(r),l=Math.floor(n/2)+1,c=Oh(a),u=y0(a),d=rs(c,[l,n-l],c.shape.length-1),f=rs(u,[l,n-l],u.shape.length-1),h=s.shape.slice();return h[s.shape.length-1]=l,Z(ma(d[0],f[0]),h)}const m5=Q({rfft_:p5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(t,e){let n=V(t,"a","squaredDifference"),i=V(e,"b","squaredDifference");[n,i]=Sn(n,i),mt(n.shape,i.shape);const s={a:n,b:i},o={};return K.runKernel(Ju,s,o)}const v5=Q({squaredDifference_:g5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(t,e){const n=V(t,"x","squeeze","string_or_numeric");return Z(n,Dr(n.shape,e).newShape)}const rd=Q({squeeze_:x5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(t,e=0){const n=t2(t,"tensors","stack","string_or_numeric");F(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&F(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const i=n,s={axis:e};return K.runKernel(ip,i,s)}const Ko=Q({stack_:b5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(t,e=0){const i={x:V(t,"x","step")},s={alpha:e};return K.runKernel(nd,i,s)}const ad=Q({step_:y5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(t,e,n,i,s=0,o=0,r=0,a=0,l=0){const u={x:V(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:i,beginMask:s,endMask:o,ellipsisMask:r,newAxisMask:a,shrinkAxisMask:l};return K.runKernel(i0,u,d)}const C5=Q({stridedSlice_:w5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(t){const n={x:V(t,"x","tan","float32")};return K.runKernel(Qu,n)}const I5=Q({tan_:S5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ui(t,e){aE(t);const n=wp(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Cp(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lh(t,e,n){if(aE(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const i=wp(t,n);if(i.length!==2&&i.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(i.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Cp(t,e,i,n)}function F2(t,e,n){const i=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${i}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<i+(n.rank-s))throw new Error(o+` Output shape length < ${i+(n.rank-s)}`);if(n.rank!==s+t.length-i)throw new Error(o+` update.rank != ${s+t.length-i}`);for(let r=0;r<s;++r)if(n.shape[r]!==e.shape[r])throw new Error(o+` updates.shape[${r}] (${n.shape[r]}) != indices.shape[${r}] (${e.shape[r]}).`);for(let r=0;r<n.rank-s;++r)if(n.shape[r+s]!==t[r+i])throw new Error(o+` updates.shape[${r+s}] (${n.shape[r+s]}) != shape[${r+s}] (${t[r+s]})`)}function $5(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}F2(n,e,t)}function La(t,e,n){const i=e.shape.length,s=i>1?e.shape[i-1]:1,o=n.length;let r=1;for(let d=s;d<o;++d)r*=n[d];const a=s<1?1:s,l=pe(e.shape)/a,c=[...Ye(n.slice(0,s)),1],u=pe(n);return{sliceRank:s,numUpdates:l,sliceSize:r,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(t,e=1,n=!0){const i=V(t,"x","topk");if(i.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=i.shape[i.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:i},r={k:e,sorted:n},[a,l]=K.runKernel(s0,o,r);return{values:a,indices:l}}const N5=Q({topk_:E5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5(t,e=0,n=1,i,s){if(Qo(t),i!=null&&i==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new E2(e,n,i,!0,s),r=Ct(t,i);for(let a=0;a<r.values.length;a++)r.values[a]=o.nextValue();return r.toTensor()}const L2=Q({truncatedNormal_:k5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5(t,e=0){const n=V(t,"x","unique","string_or_numeric");F(n.rank>0,()=>"The input tensor must be at least 1D");const i={x:n},s={axis:e},[o,r]=K.runKernel(r0,i,s);return{values:o,indices:r}}const T5=Q({unique_:D5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(t,e,n){const i=V(t,"x","unsortedSegmentSum"),s=V(e,"segmentIds","unsortedSegmentSum","int32");F(Dl(n),()=>"numSegments must be of dtype int");const o={x:i,segmentIds:s},r={numSegments:n};return K.runKernel(xp,o,r)}const z2=Q({unsortedSegmentSum_:R5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(t,e=0){const n=V(t,"x","unstack","string_or_numeric");F(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const i={value:n},s={axis:e};return K.runKernel(vp,i,s)}const Sa=Q({unstack_:_5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5(t,e=!0,n,i){return K.makeVariable(t,e,n,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B2(t,e){const n=[];for(let o=0;o<e.length;o++)e[o]&&n.push(o);const i=Ct(t,"int32"),s=Ct([n.length,t.length],"int32");for(let o=0;o<n.length;o++){const r=i.indexToLoc(n[o]),a=o*t.length;s.values.set(r,a)}return s.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(t,e,n){const i=V(t,"x","transpose");if(e==null&&(e=i.shape.map((r,a)=>a).reverse()),F(i.rank===e.length,()=>`Error in transpose: rank of input ${i.rank} must match length of perm ${e}.`),e.forEach(r=>{F(r>=0&&r<i.rank,()=>`All entries in 'perm' must be between 0 and ${i.rank-1} but got ${e}`)}),i.rank<=1)return i.clone();const s={x:i},o={perm:e};return i.dtype==="complex64"?ie(()=>{let r=Oh(i),a=y0(i);return r=K.runKernel(cl,{x:r},o),a=K.runKernel(cl,{x:a},o),n&&(a=Cn(a)),ma(r,a)}):K.runKernel(cl,s,o)}const _t=Q({transpose_:O5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(t,e){if(e==null)return t.shape.slice();if(Wt(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let i=0;i<t.shape.length;i++)e[i]==null&&t.shape[i]!=null?n.push(t.shape[i]):n.push(e[i]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(t,e,n,i){const s=V(t,"x","dropout");if(F(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),F(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Mn?s.clone():s;const o=P5(s,n),r=1-e,a=nt(kp(Se(od(o,0,1,"float32",i),r)),r);return U(s,a)}const F5=Q({dropout_:M5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(t,e,n,i,s,o="NHWC",r){let a=t;t.rank===3&&(a=Z(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]])),F(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),F(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),F(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=o==="NHWC"?a.shape[3]:a.shape[1],u=o==="NHWC"?l.shape[3]:l.shape[1];F(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),F(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),zi("conv2dDerFilter",s,r);const d={x:a,dy:l},f={strides:i,pad:s,dataFormat:o,dimRoundingMode:r,filterShape:n};return K.runKernel(Dx,d,f)}const L0=Q({conv2DBackpropFilter_:L5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z0(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return U(t,ad(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function B0(t,e){let n=e;const i=Vn(t.shape,e.shape);return i.length>0&&(n=Qe(n,i)),Z(n,t.shape)}function V0(t,e,n,i){if(e==="linear")return t;if(e==="relu")return Fa(t);if(e==="elu")return Ep(t);if(e==="relu6")return k2(t);if(e==="prelu")return N0(t,n);if(e==="leakyrelu")return w0(t,i);if(e==="sigmoid")return Ql(t);throw new Error(`Unknown fused activation ${e}.`)}const W0=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5({x:t,filter:e,strides:n,pad:i,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:r,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",W0(K.state.gradientDepth,l)===!1){F(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=ya(t,e,n,i,s,o,r);return a!=null&&(C=Se(C,a)),V0(C,l,c,u)}const d=V(t,"x","conv2d","float32"),f=V(e,"filter","conv2d","float32");let h=d,p=!1;d.rank===3&&(p=!0,h=Z(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(h.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${h.rank}.`),F(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),zi("fused conv2d",i,r);const m=s==="NHWC"?h.shape[3]:h.shape[1];F(f.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${f.shape[2]}.`),F(pi(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);const g=ni(h.shape,f.shape,n,o,i,r);let v;a!=null&&(v=V(a,"bias","fused conv2d"),[v]=Sn(v,d),s==="NHWC"?mt(g.outShape,v.shape):(F(v.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${v.shape.length}.`),F(v.shape.length===0||v.shape[0]===g.outChannels||v.shape[0]===1,()=>`Error in fused conv2d: bias shape (${v.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let x;if(c!=null){const C=c.shape;if(F(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)F(C[0]===1||C[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${g.outChannels}).`);else if(C.length===3)try{mt(C,g.outShape)}catch{const $=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error($)}x=V(c,"prelu weights","fused conv2d")}const b=(C,I)=>{F(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[$,E,N,k]=I,D=z0(C,N,l);F(xa(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const _=m0(E.shape,D,$,n,i),R=L0(E,D,$.shape,n,i),T=[_,R];if(k!=null){const A=B0(k,D);T.push(A)}return T},w={x:h,filter:f,bias:v,preluActivationWeights:x},y={strides:n,pad:i,dataFormat:s,dilations:o,dimRoundingMode:r,activation:l,leakyreluAlpha:u};return a==null?Ol((I,$,E)=>{let N=K.runKernel(Eh,w,y);return E([$,I,N]),p&&(N=Z(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:b}})(h,f):Ol((I,$,E,N)=>{let k=K.runKernel(Eh,w,y);return N([$,I,k,E]),p&&(k=Z(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:b}})(h,f,v)}const B5=Q({fusedConv2d_:z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(t,e,n,i,s,o=[1,1],r){let a=t;t.rank===3&&(a=Z(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:i,pad:s,dimRoundingMode:r,dilations:o,filterShape:n};return K.runKernel(Mx,c,u)}const W5=Q({depthwiseConv2dNativeBackpropFilter_:V5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(t,e,n,i,s,o=[1,1],r){let a=e,l=!1;e.rank===3&&(l=!0,a=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:i,pad:s,dimRoundingMode:r,dilations:o,inputShape:t},d=K.runKernel(Fx,c,u);return l?Z(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const H5=Q({depthwiseConv2dNativeBackpropInput_:G5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5({a:t,b:e,transposeA:n=!1,transposeB:i=!1,bias:s,activation:o="linear",preluActivationWeights:r,leakyreluAlpha:a=.2}){if(W0(K.state.gradientDepth,o)===!1){let k=Bt(t,e,n,i);return s!=null&&(k=Se(k,s)),V0(k,o,r,a)}let l=V(t,"a","fused matMul"),c=V(e,"b","fused matMul");[l,c]=Sn(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=i?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],h=i?c.shape[c.rank-2]:c.shape[c.rank-1],p=l.shape.slice(0,-2),m=c.shape.slice(0,-2),g=pe(p),v=pe(m);F(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${i} must match.`);const b=mt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,h]),w=n?Z(l,[g,u,f]):Z(l,[g,f,u]),y=i?Z(c,[v,h,d]):Z(c,[v,d,h]);let C;s!=null&&(C=V(s,"bias","fused matMul"),[C]=Sn(C,l),mt(b,C.shape));let I;r!=null&&(I=V(r,"prelu weights","fused matMul"));const $=(k,D)=>{const[_,R,T,A]=D,O=z0(Z(k,T.shape),T,o);let P,M;if(!n&&!i?(P=Bt(O,R,!1,!0),M=Bt(_,O,!0,!1)):!n&&i?(P=Bt(O,R,!1,!1),M=Bt(O,_,!0,!1)):n&&!i?(P=Bt(R,O,!1,!0),M=Bt(_,O,!1,!1)):(P=Bt(R,O,!0,!0),M=Bt(O,_,!0,!0)),s!=null){const z=B0(A,O);return[P,M,z]}else return[P,M]},E={a:w,b:y,bias:C,preluActivationWeights:I},N={transposeA:n,transposeB:i,activation:o,leakyreluAlpha:a};return s==null?Ol((D,_,R)=>{const T=K.runKernel($h,E,N);return R([D,_,T]),{value:Z(T,b),gradFunc:$}})(w,y):Ol((D,_,R,T)=>{const A=K.runKernel($h,E,N);return T([D,_,A,R]),{value:Z(A,b),gradFunc:$}})(w,y,C)}const NC=Q({fusedMatMul_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5(t,e,n,i,s="bilinear",o=0){const r=V(t,"image","cropAndResize"),a=V(e,"boxes","cropAndResize","float32"),l=V(n,"boxInd","cropAndResize","int32"),c=a.shape[0];F(r.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${r.rank}.`),F(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),F(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),F(i.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${i.length}.`),F(i[0]>=1&&i[1]>=1,()=>`cropSize must be atleast [1,1], but was ${i}`),F(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const u={image:r,boxes:a,boxInd:l},d={method:s,extrapolationValue:o,cropSize:i};return K.runKernel(Ax,u,d)}const K5=Q({cropAndResize_:j5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(t){const e=V(t,"image","flipLeftRight","float32");F(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return K.runKernel(Wx,n,{})}const q5=Q({flipLeftRight_:X5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(t){const e=V(t,"image","grayscaleToRGB"),n=e.rank-1,i=e.shape[n];F(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),F(i===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${i}.`);const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,Gs(e,s)}const J5=Q({grayscaleToRGB_:Y5});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(t){const e=V(t,"image","RGBToGrayscale"),n=e.rank-1,i=e.shape[n];F(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),F(i===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${i}.`);const s=e.dtype,o=Fe(e,"float32"),r=Ui([.2989,.587,.114]);let a;switch(e.rank){case 2:a=vc("ij,j->i",o,r);break;case 3:a=vc("ijk,k->ij",o,r);break;case 4:a=vc("ijkl,l->ijk",o,r);break;case 5:a=vc("ijklm,m->ijkl",o,r);break;case 6:a=vc("ijklmn,n->ijklm",o,r);break;default:throw new Error("Not a valid tensor rank.")}return a=_i(a,-1),Fe(a,s)}const Q5=Q({rgbToGrayscale_:Z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(t,e,n=0,i=.5){const s=V(t,"image","rotateWithOffset","float32");F(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const o={image:s},r={radians:e,fillValue:n,center:i};return K.runKernel(a0,o,r)}const t8=Q({rotateWithOffset_:e8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(t,e,n,i,s,o){i==null&&(i=.5),s==null&&(s=Number.NEGATIVE_INFINITY),o==null&&(o=0);const r=t.shape[0];return n=Math.min(n,r),F(0<=i&&i<=1,()=>`iouThreshold must be in [0, 1], but was '${i}'`),F(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),F(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),F(e.rank===1,()=>"scores must be a 1D tensor"),F(e.shape[0]===r,()=>`scores has incompatible shape with boxes. Expected ${r}, but was ${e.shape[0]}`),F(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:n,iouThreshold:i,scoreThreshold:s,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(t,e,n,i=.5,s=Number.NEGATIVE_INFINITY){const o=V(t,"boxes","nonMaxSuppression","float32"),r=V(e,"scores","nonMaxSuppression","float32"),a=tc(o,r,n,i,s);n=a.maxOutputSize,i=a.iouThreshold,s=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:i,scoreThreshold:s};return K.runKernel(Xx,{boxes:o,scores:r},l)}const i8=Q({nonMaxSuppression_:n8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8(t,e,n){const i=o8(t,e,n),s=i<0?-(i+1):i;t.splice(s,0,e)}function o8(t,e,n){return a8(t,e,n||r8)}function r8(t,e){return t>e?1:t<e?-1:0}function a8(t,e,n){let i=0,s=t.length,o=0,r=!1;for(;i<s;){o=i+(s-i>>>1);const a=n(e,t[o]);a>0?i=o+1:(s=o,r=!a)}return r?i:-i-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0(t,e,n,i,s){return j0(t,e,n,i,s,0)}function H0(t,e,n,i,s,o){return j0(t,e,n,i,s,0,!1,o,!0)}function U0(t,e,n,i,s,o){return j0(t,e,n,i,s,o,!0)}function j0(t,e,n,i,s,o,r=!1,a=!1,l=!1){const c=[];for(let g=0;g<e.length;g++)e[g]>s&&c.push({score:e[g],boxIndex:g,suppressBeginIndex:0});c.sort(kC);const u=o>0?-.5/o:0,d=[],f=[];for(;d.length<n&&c.length>0;){const g=c.pop(),{score:v,boxIndex:x,suppressBeginIndex:b}=g;if(v<s)break;let w=!1;for(let y=d.length-1;y>=b;--y){const C=l8(t,x,d[y]);if(C>=i){w=!0;break}if(g.score=g.score*c8(i,u,C),g.score<=s)break}g.suppressBeginIndex=d.length,w||(g.score===v?(d.push(x),f.push(g.score)):g.score>s&&s8(c,g,kC))}const h=d.length,p=n-h;a&&p>0&&(d.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const m={selectedIndices:d};return r&&(m.selectedScores=f),l&&(m.validOutputs=h),m}function l8(t,e,n){const i=t.subarray(e*4,e*4+4),s=t.subarray(n*4,n*4+4),o=Math.min(i[0],i[2]),r=Math.min(i[1],i[3]),a=Math.max(i[0],i[2]),l=Math.max(i[1],i[3]),c=Math.min(s[0],s[2]),u=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),f=Math.max(s[1],s[3]),h=(a-o)*(l-r),p=(d-c)*(f-u);if(h<=0||p<=0)return 0;const m=Math.max(o,c),g=Math.max(r,u),v=Math.min(a,d),x=Math.min(l,f),b=Math.max(v-m,0)*Math.max(x-g,0);return b/(h+p-b)}function c8(t,e,n){const i=Math.exp(e*n*n);return n<=t?i:0}function kC(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function u8(t,e,n,i=.5,s=Number.NEGATIVE_INFINITY){const o=V(t,"boxes","nonMaxSuppressionAsync"),r=V(e,"scores","nonMaxSuppressionAsync"),a=tc(o,r,n,i,s);n=a.maxOutputSize,i=a.iouThreshold,s=a.scoreThreshold;const l=await Promise.all([o.data(),r.data()]),c=l[0],u=l[1],{selectedIndices:d}=G0(c,u,n,i,s);return o!==t&&o.dispose(),r!==e&&r.dispose(),Ui(d,"int32")}const d8=u8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h8(t,e,n,i=.5,s=Number.NEGATIVE_INFINITY,o=0){const r=V(t,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=tc(r,a,n,i,s,o);n=l.maxOutputSize,i=l.iouThreshold,s=l.scoreThreshold,o=l.softNmsSigma;const c={boxes:r,scores:a},u={maxOutputSize:n,iouThreshold:i,scoreThreshold:s,softNmsSigma:o},d=K.runKernel(Yx,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const f8=Q({nonMaxSuppressionWithScore_:h8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function p8(t,e,n,i=.5,s=Number.NEGATIVE_INFINITY,o=0){const r=V(t,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=tc(r,a,n,i,s,o);n=l.maxOutputSize,i=l.iouThreshold,s=l.scoreThreshold,o=l.softNmsSigma;const c=await Promise.all([r.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:f,selectedScores:h}=U0(u,d,n,i,s,o);return r!==t&&r.dispose(),a!==e&&a.dispose(),{selectedIndices:Ui(f,"int32"),selectedScores:Ui(h)}}const m8=p8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(t,e,n,i=.5,s=Number.NEGATIVE_INFINITY,o=!1){const r=V(t,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=tc(r,a,n,i,s,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,f={boxes:r,scores:a},h={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:o},p=K.runKernel(qx,f,h);return{selectedIndices:p[0],validOutputs:p[1]}}const v8=Q({nonMaxSuppressionPadded_:g8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function x8(t,e,n,i=.5,s=Number.NEGATIVE_INFINITY,o=!1){const r=V(t,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=tc(r,a,n,i,s,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[f,h]=await Promise.all([r.data(),a.data()]),{selectedIndices:p,validOutputs:m}=H0(f,h,c,u,d,o);return r!==t&&r.dispose(),a!==e&&a.dispose(),{selectedIndices:Ui(p,"int32"),validOutputs:Vt(m,"int32")}}const b8=x8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(t,e,n=!1,i=!1){const s=V(t,"images","resizeBilinear");F(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),F(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),F(i===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=s,r=!1;s.rank===3&&(r=!0,o=Z(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:i,size:e},c=K.runKernel(cp,a,l);return r?Z(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const V2=Q({resizeBilinear_:y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w8(t,e,n=!1,i=!1){const s=V(t,"images","resizeNearestNeighbor");F(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),F(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),F(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),F(i===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=s,r=!1;s.rank===3&&(r=!0,o=Z(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:i,size:e},c=K.runKernel(lp,a,l);return r?Z(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const W2=Q({resizeNearestNeighbor_:w8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(t,e="binary",n=!1,i=.5){const s=V(t,"image","threshold"),o=.2989,r=.587,a=.114,l=s.shape[0]*s.shape[1];let c=U(Ui([i]),255),u,d,f,h;if(F(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),F(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),F(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),F(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[u,d,f]=rs(s,[1,1,1],-1);const g=U(u,o),v=U(d,r),x=U(f,a);h=Se(Se(g,v),x)}else h=t;if(e==="otsu"){const g=$6(Fe(D2(h),"int32"),ul([]),256);c=S8(g,l)}const p=n?ec(h,c):cs(h,c);return Fe(U(p,255),"int32")}function S8(t,e){let n=Ui([-1]),i=Ui([0]),s=Ui([0]),o,r,a,l,c,u;for(let d=0;d<t.size-1;d++){o=Qt(t,0,d+1),r=Qt(t,d+1),c=nt(Qe(o),e),u=nt(Qe(r),e);const f=Qe(U(o,jc(0,o.size)));a=nt(f,Qe(o));const h=$p(r.shape,o.size),p=Se(jc(0,r.size),h),m=U(r,p);l=nt(Qe(m),Qe(r));const g=rt(a,l),v=rt(a,l),x=U(c,u);s=U(U(x,g),v);const b=cs(s,i);i=Ci(b,s,i),n=Ci(b,Ui([d]),n)}return n}const I8=Q({threshold_:C8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(t,e,n="nearest",i="constant",s=0,o){const r=V(t,"image","transform","float32"),a=V(e,"transforms","transform","float32");F(r.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${r.rank}.`),F(a.rank===2&&(a.shape[0]===r.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),F(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:r,transforms:a},c={interpolation:n,fillMode:i,fillValue:s,outputShape:o};return K.runKernel(o0,l,c)}const E8=Q({transform_:$8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(t,e,n){const i=V(t,"a","bandPart");F(i.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${i.rank}.`);const s=i.shape,[o,r]=i.shape.slice(-2);let a,l;typeof e=="number"?(F(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),F(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=V(e<0?o:e,"numLower","bandPart")):(F(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Ci(_h(e,0),o,Uc(e,o))),typeof n=="number"?(F(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),F(n<=r,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${r}).`),l=V(n<0?r:n,"numUpper","bandPart")):(F(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Ci(_h(n,0),r,Uc(n,r)));const c=Z(jc(0,o,1,"int32"),[-1,1]),u=jc(0,r,1,"int32"),d=rt(c,u),f=jo(ec(d,a),Pa(d,Cn(l))),h=Xn([o,r],i.dtype);return Z(Ko(Sa(Z(i,[-1,o,r])).map(p=>Ci(f,p,h))),s)}const k8=Q({bandPart_:N8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(t){let e;if(Array.isArray(t)){e=!1,F(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=t[0].shape[0];for(let o=1;o<t.length;++o)F(t[o].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[o].shape[0]} vs. ${s})`)}else e=!0,t=rs(t,t.shape[0],0).map(s=>rd(s,[0]));F(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],i=t;for(let s=0;s<t.length;++s)n.push(K.tidy(()=>{let o=i[s];if(s>0)for(let r=0;r<s;++r){const a=U(Qe(U(n[r],o)),n[r]);o=rt(o,a)}return nt(o,Np(o,"euclidean"))}));return e?Ko(n,0):n}const T8=Q({gramSchmidt_:D8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(t,e=!1){if(F(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return DC(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),i=Sa(Z(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];i.forEach(l=>{const[c,u]=DC(l,e);s.push(c),o.push(u)});const r=Z(Ko(s,0),t.shape),a=Z(Ko(o,0),t.shape);return[r,a]}}function DC(t,e=!1){return K.tidy(()=>{F(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],i=t.shape[1];let s=b2(n),o=la(t);const r=lh([[1]],[1,1]);let a=la(r);const l=n>=i?i:n;for(let c=0;c<l;++c){const u=o,d=a,f=s;[a,o,s]=K.tidy(()=>{const h=Qt(o,[c,c],[n-c,1]),p=Np(h),m=Qt(o,[c,c],[1,1]),g=Ci(cs(m,0),lh([[-1]]),lh([[1]])),v=rt(m,U(g,p)),x=nt(h,v);x.shape[0]===1?a=la(r):a=Mi([r,Qt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);const b=Cn(nt(Bt(g,v),p)),w=Qt(o,[c,0],[n-c,i]),y=U(b,a),C=_t(a);if(c===0)o=rt(w,Bt(y,Bt(C,w)));else{const E=rt(w,Bt(y,Bt(C,w)));o=Mi([Qt(o,[0,0],[c,i]),E],0)}const I=_t(y),$=Qt(s,[0,c],[n,s.shape[1]-c]);if(c===0)s=rt($,Bt(Bt($,a),I));else{const E=rt($,Bt(Bt($,a),I));s=Mi([Qt(s,[0,0],[n,c]),E],1)}return[a,o,s]}),bt([u,d,f])}return!e&&n>i&&(s=Qt(s,[0,0],[n,i]),o=Qt(o,[0,0],[i,i])),[s,o]})}const _8=Q({qr_:R8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vo={flipLeftRight:q5,grayscaleToRGB:J5,resizeNearestNeighbor:W2,resizeBilinear:V2,rgbToGrayscale:Q5,rotateWithOffset:t8,cropAndResize:K5,nonMaxSuppression:i8,nonMaxSuppressionAsync:d8,nonMaxSuppressionWithScore:f8,nonMaxSuppressionWithScoreAsync:m8,nonMaxSuppressionPadded:v8,nonMaxSuppressionPaddedAsync:b8,threshold:I8,transform:E8},A8={bandPart:k8,gramSchmidt:T8,qr:_8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8=new Map,P8=new Map;class nc{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Cs{constructor(){this.classNameMap={}}static getMap(){return Cs.instance==null&&(Cs.instance=new Cs),Cs.instance}static register(e){Cs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ce(t,e,n){F(t.className!=null,()=>"Class being registered does not have the static className property defined."),F(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),F(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const i=n,s=e+">"+i;return Cs.register(t),O8.set(s,t),P8.set(t,s),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mr extends nc{minimize(e,n=!1,i){const{value:s,grads:o}=this.computeGradients(e,i);if(i!=null){const r=i.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(r)}else this.applyGradients(o);return bt(o),n?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return jj(e,n)}dispose(){this.iterations_!=null&&bt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Vt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Mr,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G2 extends Mr{static get className(){return"Adadelta"}constructor(e,n,i=null){super(),this.learningRate=e,this.rho=n,this.epsilon=i,this.accumulatedGrads=[],this.accumulatedUpdates=[],i==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,s)=>{const o=K.registeredVariables[i],r=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${i}/accum_grad`,variable:ie(()=>At(o).variable(r))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${i}/accum_var`,variable:ie(()=>At(o).variable(r))});const a=Array.isArray(e)?e[s].tensor:e[i];if(a==null)return;const l=this.accumulatedGrads[s].variable,c=this.accumulatedUpdates[s].variable;ie(()=>{const u=Se(U(l,this.rho),U(on(a),1-this.rho)),d=U(nt(fi(Se(c,this.epsilon)),fi(Se(l,this.epsilon))),a),f=Se(U(c,this.rho),U(on(d),1-this.rho));l.assign(u),c.assign(f);const h=Se(U(d,-this.learningRate),o);o.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(bt(this.accumulatedGrads.map(e=>e.variable)),bt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,i=!1;this.accumulatedGrads=e.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(i)})),this.accumulatedUpdates=e.slice(n,n*2).map(s=>({originalName:s.name,variable:s.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H2 extends Mr{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,s)=>{const o=K.registeredVariables[i];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${i}/accumulator`,variable:ie(()=>$p(o.shape,this.initialAccumulatorValue).variable(!1))});const r=Array.isArray(e)?e[s].tensor:e[i];if(r==null)return;const a=this.accumulatedGrads[s].variable;ie(()=>{const l=Se(a,on(r));a.assign(l);const c=Se(U(nt(r,fi(Se(l,K.backend.epsilon()))),-this.learningRate),o);o.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&bt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U2 extends Mr{static get className(){return"Adam"}constructor(e,n,i,s=null){super(),this.learningRate=e,this.beta1=n,this.beta2=i,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ie(()=>{this.accBeta1=Vt(n).variable(),this.accBeta2=Vt(i).variable()}),s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ie(()=>{const i=rt(1,this.accBeta1),s=rt(1,this.accBeta2);n.forEach((o,r)=>{const a=K.registeredVariables[o],l=!1;this.accumulatedFirstMoment[r]==null&&(this.accumulatedFirstMoment[r]={originalName:`${o}/m`,variable:ie(()=>At(a).variable(l))}),this.accumulatedSecondMoment[r]==null&&(this.accumulatedSecondMoment[r]={originalName:`${o}/v`,variable:ie(()=>At(a).variable(l))});const c=Array.isArray(e)?e[r].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[r].variable,d=this.accumulatedSecondMoment[r].variable,f=Se(U(u,this.beta1),U(c,1-this.beta1)),h=Se(U(d,this.beta2),U(on(c),1-this.beta2)),p=nt(f,i),m=nt(h,s);u.assign(f),d.assign(h);const g=Se(U(nt(p,Se(fi(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(U(this.accBeta1,this.beta1)),this.accBeta2.assign(U(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&bt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&bt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),ie(()=>{this.accBeta1.assign(wa(this.beta1,this.iterations_+1)),this.accBeta2.assign(wa(this.beta2,this.iterations_+1))});const n=e.length/2,i=!1;this.accumulatedFirstMoment=e.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(i)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(s=>({originalName:s.name,variable:s.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j2 extends Mr{static get className(){return"Adamax"}constructor(e,n,i,s=null,o=0){super(),this.learningRate=e,this.beta1=n,this.beta2=i,this.epsilon=s,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ie(()=>{this.iteration=Vt(0).variable(),this.accBeta1=Vt(n).variable()}),s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ie(()=>{const i=rt(1,this.accBeta1),s=nt(-this.learningRate,Se(U(this.iteration,this.decay),1));n.forEach((o,r)=>{const a=K.registeredVariables[o],l=!1;this.accumulatedFirstMoment[r]==null&&(this.accumulatedFirstMoment[r]={originalName:`${o}/m`,variable:At(a).variable(l)}),this.accumulatedWeightedInfNorm[r]==null&&(this.accumulatedWeightedInfNorm[r]={originalName:`${o}/v`,variable:At(a).variable(l)});const c=Array.isArray(e)?e[r].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[r].variable,d=this.accumulatedWeightedInfNorm[r].variable,f=Se(U(u,this.beta1),U(c,1-this.beta1)),h=U(d,this.beta2),p=xi(c),m=Or(h,p);u.assign(f),d.assign(m);const g=Se(U(nt(s,i),nt(f,Se(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(Se(this.iteration,1)),this.accBeta1.assign(U(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&bt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&bt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K0 extends Mr{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,s)=>{const o=Array.isArray(e)?e[s].tensor:e[i];if(o==null)return;const r=K.registeredVariables[i];ie(()=>{const a=Se(U(this.c,o),r);r.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=go(Vt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K2 extends K0{static get className(){return"Momentum"}constructor(e,n,i=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=i,this.accumulations=[],this.m=Vt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,s)=>{const o=K.registeredVariables[i];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${i}/momentum`,variable:ie(()=>At(o).variable(!1))});const r=this.accumulations[s].variable,a=Array.isArray(e)?e[s].tensor:e[i];a!=null&&ie(()=>{let l;const c=Se(U(this.m,r),a);this.useNesterov?l=Se(U(this.c,Se(a,U(c,this.m))),o):l=Se(U(this.c,c),o),r.assign(c),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&bt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X2 extends Mr{static get className(){return"RMSProp"}constructor(e,n=.9,i=0,s=null,o=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=i,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,s==null&&(this.epsilon=K.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,s)=>{const o=K.registeredVariables[i],r=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${i}/rms`,variable:ie(()=>At(o).variable(r))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${i}/momentum`,variable:ie(()=>At(o).variable(r))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${i}/mg`,variable:ie(()=>At(o).variable(r))});const a=Array.isArray(e)?e[s].tensor:e[i];if(a==null)return;const l=this.accumulatedMeanSquares[s].variable,c=this.accumulatedMoments[s].variable;ie(()=>{const u=Se(U(l,this.decay),U(on(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[s].variable,f=Se(U(d,this.decay),U(a,1-this.decay)),h=nt(U(a,this.learningRate),fi(rt(u,Se(on(f),this.epsilon)))),p=Se(U(c,this.momentum),h);l.assign(u),d.assign(f),c.assign(p);const m=rt(o,p);o.assign(m)}else{const d=Se(U(l,this.decay),U(on(a),1-this.decay)),f=Se(U(c,this.momentum),nt(U(a,this.learningRate),fi(Se(d,this.epsilon))));l.assign(d),c.assign(f);const h=rt(o,f);o.assign(h)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&bt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&bt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&bt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,i=!1;this.accumulatedMeanSquares=e.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(i)})),this.accumulatedMoments=e.slice(n,n*2).map(s=>({originalName:s.name,variable:s.tensor.variable(i)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(s=>({originalName:s.name,variable:s.tensor.variable(i)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8=[G2,H2,U2,j2,K2,X2,K0];function F8(){for(const t of M8)Ce(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TC(t,e,n,i){r(t),n=n??0,i=i??1,a(n,i);let s=0;const o=l=>(l.then(c=>{const u=n+ ++s/t.length*(i-n);return e(u),c}),l);function r(l){F(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){F(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),F(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),F(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function L8(t,e){e==null&&(e={});const n=e.fetchFunc==null?le().platform.fetch:e.fetchFunc,i=t.map(d=>n(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(i):await TC(i,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await TC(a,e.onProgress,.5,1)}function z8(t,e){var n;const i=e.fetchFunc==null?le().platform.fetch:e.fetchFunc;let s=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async r=>{for(var a;s<t.length;){o||(o=(await i(t[s],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await o.read();if(l){s++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,s/t.length);continue}r.enqueue(c);return}r.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8="application/octet-stream",V8="application/json";class X0{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(F(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=le().platform.fetch,F(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&F(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const i=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s=oU(e,i);if(n.body.append("model.json",new Blob([JSON.stringify(s)],{type:V8}),"model.json"),e.weightData!=null){const r=Rr.join(e.weightData);n.body.append("model.weights.bin",new Blob([r],{type:B8}),"model.weights.bin")}const o=await this.fetch(this.path,n);if(o.ok)return{modelArtifactsInfo:d0(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let r=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r)}const i=n.modelTopology,s=n.weightsManifest;if(i==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return aU(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),i=IC(e.weightsManifest),s=()=>z8(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:i,getWeightStream:s})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[i,s]=W8(n),o=this.weightPathPrefix||i,r=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):r.push(o+c+s);return this.weightUrlConverter&&r.push(...await Promise.all(a)),r}async loadWeights(e){const n=await this.getWeightUrls(e),i=IC(e),s=await L8(n,this.loadOptions);return[i,s]}}X0.URL_SCHEME_REGEX=/^https?:\/\//;function W8(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),i=t.substring(0,e),s=n>e?t.substring(n):"";return[i+"/",s]}function RC(t){return t.match(X0.URL_SCHEME_REGEX)!=null}const q2=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(i=>RC(i)):n=RC(t),n)return Y2(t,e)}return null};jn.registerSaveRouter(q2);jn.registerLoadRouter(q2);function Y2(t,e){return new X0(t,e)}function G8(t,e){return Y2(t,e)}function q0(t,e){const n=t.shape.length,i=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[i-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[i-1]} vs. ${n}`);if(pe(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let r=1;for(let d=0;d<s.length-1;++d)r*=s[d];const a=t.shape,l=s.slice();l.pop();let c=1;for(let d=o;d<n;++d)c*=a[d],l.push(a[d]);const u=[...Ye(t.shape).map(d=>d/c),1].slice(0,o);return[l,r,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zg=-2,H8=-1;function Y0(t,e,n){const i=t.shape.length;F(i===e.length,()=>`Error in slice${i}D: Length of begin ${e} must match the rank of the array (${i}).`),F(i===n.length,()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`);for(let s=0;s<i;++s)F(e[s]+n[s]<=t.shape[s],()=>`Error in slice${i}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`)}function U8(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function J0(t,e,n){const i=[];for(let s=0;s<t.length;s++)i[s]=Math.ceil((e[s]-t[s])/n[s]);return i}function J2(t,e,n,i){const s=[...t];for(let o=s.length;o<i.length;o++)s.push(1);for(let o=0;o<n;o++)o===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function Z2(t,e,n){return n<=t?n:n-(e-1)}function Q2(t,e){const n=[];for(let i=0;i<t;i++)n.push(e+i);return n}function j8(t,e,n,i,s,o,r,a,l){const c=t.length;let u=new Array(c),d=new Array(c),f=new Array(c);if(e.length&&n>0){const h=e[0],p=n+1;u=eN(r,h,p,i,t),d=tN(a,h,p,s,t),f=J2(o,h,p,t)}else for(let h=0;h<c;h++)u[h]=iN(r,i,o,t,h,l),d[h]=sN(a,s,o,t,h,l),f[h]=nN(o,h,l);return{begin:u,end:d,strides:f}}function eN(t,e,n,i,s){const o=[...s],r=Q2(n,e);for(let a=0;a<o.length;a++)if(r.indexOf(a)>-1)o[a]=0;else{const l=Z2(e,n,a);let c=i[l];t&1<<l&&(c=0),o[a]=c}return o}function tN(t,e,n,i,s){const o=[...s],r=Q2(n,e);for(let a=0;a<o.length;a++)if(r.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=Z2(e,n,a);let c=i[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),o[a]=c}for(let a=0;a<o.length;a++){const l=s[a];o[a]<0&&(o[a]+=l),o[a]=fa(0,o[a],s[a])}return o}function nN(t,e,n){let i=t[e];return(n&1<<e||i==null)&&(i=1),i}function iN(t,e,n,i,s,o){let r=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||r==null)&&(a>0?r=Number.MIN_SAFE_INTEGER:r=Number.MAX_SAFE_INTEGER);const l=i[s];return r<0&&(r+=l),r=fa(0,r,l-1),r}function sN(t,e,n,i,s,o){let r=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||r==null)&&(a>0?r=Number.MAX_SAFE_INTEGER:r=Number.MIN_SAFE_INTEGER);const l=i[s];return r<0&&(r+=l),a>0?r=fa(0,r,l):r=fa(-1,r,l-1),r}function Z0(t,e,n){let i=n.length;for(let s=0;s<n.length;s++)if(n[s]>1){i=s;break}for(let s=i+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0}function Q0(t,e){let n=t.length>0?t[t.length-1]:1;for(let i=0;i<t.length-1;i++)n+=t[i]*e[i];return n}function Dp(t,e,n){let i;const s=t.shape.length;typeof e=="number"?i=[e,...new Array(s-1).fill(0)]:e.length<s?i=e.concat(new Array(s-e.length).fill(0)):i=e.slice(),i.forEach(r=>{F(r!==-1,()=>"slice() does not support negative begin indexing.")});let o;return n==null?o=new Array(s).fill(-1):typeof n=="number"?o=[n,...new Array(s-1).fill(-1)]:n.length<s?o=n.concat(new Array(s-n.length).fill(-1)):o=n,o=o.map((r,a)=>r>=0?r:(F(r===-1,()=>`Negative size values should be exactly -1 but got ${r} for the slice() size at index ${a}.`),t.shape[a]-i[a])),[i,o]}function eb(t,e,n,i,s,o,r,a,l){let c;if(i==null?(c=new Array(e.length),c.fill(1)):c=i,r!=null&&r&r-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:r,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<d.dims;b++)u&&1<<b&a&&d.numAddAxisAfterEllipsis++,1<<b&r&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};K8(d,f);let h=!0,p=!0,m=!0;const g=[],v=[];for(let b=0;b<t.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const w=!!(f.shrinkAxisMask&1<<b),y=t[b];if(y===-1){g.push(w?1:-1);continue}const C=[f.beginMask&1<<b,f.endMask&1<<b],I=[f.strides[b]>0?0:-1,f.strides[b]>0?y:y-1];if(w&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&f.strides[b]===1;const $=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(w){const D=f.begin[b]<0?y+f.begin[b]:f.begin[b];if(f.begin[b]=D,f.end[b]=f.begin[b]+1,D<0||D>=y)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=_C(f.begin[b],0,f.strides[b],y,C,I),f.end[b]=_C(f.end[b],1,f.strides[b],y,C,I);const k=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===y;h=h&&k,p=p&&(b===0&&f.strides[b]===1||k)}else h=h&&f.strides[b]===1&&$,p=p&&(b===0&&f.strides[b]===1||$);let E,N=!1;if(f.beginValid&&f.endValid?(E=f.end[b]-f.begin[b],N=!0):w?(E=1,N=!0):$&&y>=0&&(f.strides[b]<0?E=-y:E=y,N=!0),N){let k;E===0||E<0!=f.strides[b]<0?k=0:k=Math.trunc(E/f.strides[b])+(E%f.strides[b]!==0?1:0),g.push(k)}else g.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){const w=f.finalShapeGatherIndices[b];w>=0?v.push(g[w]):w===zg&&v.push(1)}return{finalShapeSparse:v.filter((b,w)=>f.finalShapeGatherIndices[w]!==zg),finalShape:v,isIdentity:h,sliceDim0:p,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function K8(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let i=0;i<t.dims;i++)if(1<<i&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-i)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=i}else if(1<<i&t.newAxisMask)e.finalShapeGatherIndices.push(zg),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[i]),t.end!=null&&(e.end[n]=t.end[i]),e.strides[n]=t.strides[i],t.beginMask&1<<i&&(e.beginMask|=1<<n),t.endMask&1<<i&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<i?(e.finalShapeGatherIndices.push(H8),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(i)),e.inputShapeGatherIndicesSparse[n]=i,n++}}function _C(t,e,n,i,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const r=t<0?i+t:t;return r<o[0]?o[0]:r>o[1]?o[1]:r}}const X8=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Y0,computeFlatOffset:Q0,computeOutShape:J0,getNormalizedAxes:j8,isSliceContinous:Z0,maskToAxes:U8,parseSliceParams:Dp,sliceInfo:eb,startForAxis:iN,startIndicesWithElidedDims:eN,stopForAxis:sN,stopIndicesWithElidedDims:tN,stridesForAxis:nN,stridesWithElidedDims:J2},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q8{static sgd(e){return new K0(e)}static momentum(e,n,i=!1){return new K2(e,n,i)}static rmsprop(e,n=.9,i=0,s=null,o=!1){return new X2(e,n,i,s,o)}static adam(e=.001,n=.9,i=.999,s=null){return new U2(e,n,i,s)}static adadelta(e=.001,n=.95,i=null){return new G2(e,n,i)}static adamax(e=.002,n=.9,i=.999,s=null,o=0){return new j2(e,n,i,s,o)}static adagrad(e,n=.1){return new H2(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xa=q8;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function oN(){return new Promise(t=>Y8(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tb(t,e){const n=t[0].length;t.forEach((s,o)=>{F(s.length===n,()=>`Error in concat${n}D: rank of tensors[${o}] must be the same as the rank of the rest (${n})`)}),F(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const i=t[0];t.forEach((s,o)=>{for(let r=0;r<n;r++)F(r===e||s[r]===i[r],()=>`Error in concat${n}D: Shape of tensors[${o}] (${s}) does not match the shape of the rest (${i}) along the non-concatenated axis ${o}.`)})}function vo(t,e){const n=t[0].slice();for(let i=1;i<t.length;i++)n[e]+=t[i][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ws;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Ws||(Ws={}));function rN(t,e,n){let i=new Array;if(n==null&&e==null)return i;if(e==null)for(;i.length<t+n.length;)i.push(-1);else i=e.slice();if(n==null)return i;if(t+n.length!==i.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${i.length}`);for(let s=1;s<n.length;++s){const o=n[s],r=i[i.length-n.length+s],a=i[r];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+t}] = ${o} but shape[${s+t}] = ${a}`)}else i[r]=o}return i}function aN(t){const e={FIRST_DIM_SIZE:Ws.FIRST_DIM_SIZE,VALUE_ROWIDS:Ws.VALUE_ROWIDS,ROW_LENGTHS:Ws.ROW_LENGTHS,ROW_SPLITS:Ws.ROW_SPLITS,ROW_LIMITS:Ws.ROW_LIMITS,ROW_STARTS:Ws.ROW_STARTS},n=[];for(const i of t)if(i in e)n.push(e[i]);else break;return n}function lN(t){return t.length===0?0:t[0]===Ws.FIRST_DIM_SIZE?t.length-1:t.length}function cN(t,e){if(t==null||e==null)return;const n=t.length,i=e.length;if(n>=i)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${i})`);for(let s=0;s<Math.min(n,i-1);++s){const o=t[s],r=e[s+1];if(o>=0&&r>=0&&o!==1&&o!==r)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-t.length}] = ${o} but ragged tensor input.flatValues.shape[${s-t.length}] = ${r}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nb=30;function Tp(t){return t<=nb?t:Cg(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ib(t,e,n){const i=n*(typeof t=="number"?t:t[0]),s=e*(typeof t=="number"?t:t[1]);return[i,s]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ld(t,e,n,i=!0){let s=[];if(i)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const o=e.length;for(let r=0;r<o;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(o+1))}return s}function cd(t,e,n=!0){const i=[];if(n){i.push(e);for(let s=e+1;s<t;++s)s<=2*e?(i.push(s),i.push(s-(e+1))):i.push(s)}else{const s=[],o=[];for(let r=1;r<t;++r)r>=e*2+1||r%2===1?o.push(r):s.push(r);i.push(...s),i.push(0),i.push(...o)}return i}function ud(t,e,n,i=!0){const s=[];i?s.push(t[0]/n):s.push(t[0]*n);for(let o=1;o<t.length;++o)o<=e.length?i?s.push(e[o-1]*t[o]):s.push(t[o]/e[o-1]):s.push(t[o]);return s}function sb(t,e){const n=[0];for(let i=0;i<e;++i)n.push(t[i][0]);return n}function ob(t,e,n){const i=t.slice(0,1);for(let s=0;s<n;++s)i.push(t[s+1]-e[s][0]-e[s][1]);return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rp=1.7580993408473768,_p=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rb=.3275911,ab=.254829592,lb=-.284496736,cb=1.421413741,ub=-1.453152027,db=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let i=0;i<n.length;i+=2)n[i]=t[i/2],n[i+1]=e[i/2];return n}function uN(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let i=0;i<t.length;i+=2)e[i/2]=t[i],n[i/2]=t[i+1];return{real:e,imag:n}}function dN(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let s=0;s<t.length;s+=4)n[Math.floor(s/4)]=t[s],i[Math.floor(s/4)]=t[s+1];return{real:n,imag:i}}function hN(t){const e=Math.floor(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let s=2;s<t.length;s+=4)n[Math.floor(s/4)]=t[s],i[Math.floor(s/4)]=t[s+1];return{real:n,imag:i}}function hb(t,e){const n=t[e*2],i=t[e*2+1];return{real:n,imag:i}}function fN(t,e,n,i){t[i*2]=e,t[i*2+1]=n}function pN(t,e){const n=new Float32Array(t/2),i=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),i[s]=Math.sin(o)}return{real:n,imag:i}}function mN(t,e,n){const i=(n?2:-2)*Math.PI*(t/e),s=Math.cos(i),o=Math.sin(i);return{real:s,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $m="->",J8=/->/g,AC=",",OC="...";function fb(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(J8,"").length)/$m.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${$m}").`);const[i,s]=t.split($m);F(i.indexOf(OC)===-1,()=>`The ellipsis notation ("${OC}") is not supported yet.`);const o=i.split(AC),r=o.length;if(e!==r)throw new Error(`Expected ${r} input tensors, received ${e}`);if(r>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<s.length;++f){const h=s[f];if(!o.some(p=>p.indexOf(h)!==-1))throw new Error(`Output subscripts contain the label ${h} not present in the input subscripts.`);a.indexOf(h)===-1&&a.push(h)}for(let f=0;f<i.length;++f){const h=i[f];a.indexOf(h)===-1&&h!==AC&&a.push(h)}const l=new Array(o.length);for(let f=0;f<r;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let h=0;h<o[f].length;++h)l[f].push(a.indexOf(o[f][h]))}const c=a.length,u=s.length,d=[];for(let f=u;f<c;++f)d.push(f);return{allDims:a,summedDims:d,idDims:l}}function pb(t,e){let n=new Array(t);n.fill(-1);for(let s=0;s<e.length;++s)n[e[s]]=s;const i=[];for(let s=0;s<t;++s)n[s]===-1&&i.push(s);return n=n.filter(s=>s!==-1),{permutationIndices:n,expandDims:i}}function mb(t,e,n){const i=new Array(t);for(let s=0;s<n.length;++s){const o=n[s].shape;for(let r=0;r<e[s].length;++r)i[e[s][r]]===void 0?i[e[s][r]]=o[r]:F(i[e[s][r]]===o[r],()=>`Expected dimension ${i[e[s][r]]} at axis ${r} of input shaped ${JSON.stringify(o)}, but got dimension ${o[r]}`)}}function gb(t,e){const n=t,i=[];let s=0;t.length===0&&n.push(-1),s=t.length+1;for(let r=0;r<s;++r)i.push([]);const o=[];for(let r=0;r<n.length;++r){const a=n[r],l=Z8(e,a);for(const c of l)o.indexOf(c)===-1&&(i[r].push(c),o.push(c))}return{path:n,steps:i}}function vb(t){return t.every((e,n)=>e===n)}function Z8(t,e){const n=[];for(let i=0;i<t.length;++i)(t[i].length===0||t[i].indexOf(e)!==-1||e===-1)&&n.push(i);return n}function xb(t,e,n=0){let i=[];if(typeof e=="number")F(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),i=new Array(e).fill(t.shape[n]/e);else{const s=e.reduce((r,a)=>(a===-1&&(r+=1),r),0);F(s<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const r=e.reduce((a,l)=>l>0?a+l:a);e[o]=t.shape[n]-r}F(t.shape[n]===e.reduce((r,a)=>r+a),()=>"The sum of sizes must match the size of the axis dimension."),i=e}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gN(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function vN(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function xN(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bN(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function yN(t,e){return`size ${t} must be non-negative, not ${e}`}function wN(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function CN(t,e){const n=pe(t),i=pe(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${i}. inputShape=${t} outputShape= ${e}`}function SN(t,e){const n=pe(t),i=pe(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${i}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bg(){return"segment ids must be >= 0"}function IN(){return"segment ids are not increasing"}function $N(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function EN(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NN(t,e){let n=!1,i;for(t<=nb?(i=t,n=!0):i=Cg(t,Math.floor(Math.sqrt(t)));!n;)i>e||i===t?n=!0:i=Cg(t,i+1);return i}function kN(t,e,n){const i=[],s=t.length;for(let o=0;o<s;o++)o!==e?i.push(t[o]):i.push(n);return i}function bb(t,e,n,i){const s=e.shape.length,o=t.shape.length;if(i!==0&&(i<-s||i>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${i}`);if(i<0&&(i+=s),i>o)throw new Error(`batchDims (${i}) must be less than rank(x) (
    ${o}).`);if(n<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${n}).`);for(let d=0;d<i;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const r=t.shape[n],a=[];let l=1,c=1,u=1;for(let d=0;d<i;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=i;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=i;d<s;d++)a.push(e.shape[d]);for(let d=n+1;d<o;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:r,outputShape:a}}const Q8=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:bb,computeOutShape:kN,segOpComputeOptimalWindowSize:NN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qo(t){try{return t.map(e=>Cr(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function DN(t){return t.map(e=>mr(e))}const e7=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:ab,ERF_A2:lb,ERF_A3:cb,ERF_A4:ub,ERF_A5:db,ERF_P:rb,PARALLELIZE_THRESHOLD:nb,get RowPartitionType(){return Ws},SELU_SCALE:_p,SELU_SCALEALPHA:Rp,applyActivation:V0,assertAndGetBroadcastShape:mt,assertAxesAreInnerMostDims:ii,assertParamsConsistent:tb,assignToTypedArray:fN,axesAreInnerMostDims:x0,calculateShapes:La,checkEinsumDimSizes:mb,checkPadOnDimRoundingMode:zi,combineLocations:v2,combineRaggedTensorToTensorShapes:rN,complexWithEvenIndex:dN,complexWithOddIndex:hN,computeConv2DInfo:ni,computeConv3DInfo:_r,computeDefaultPad:h0,computeDilation2DInfo:id,computeOptimalWindowSize:Tp,computeOutAndReduceShapes:Yn,computeOutShape:vo,computePool2DInfo:As,computePool3DInfo:er,convertConv2DDataFormat:tr,decodeEinsumEquation:fb,eitherStridesOrDilationsAreOne:pi,expandShapeToKeepDim:Rn,exponent:mN,exponents:pN,fromStringArrayToUint8:DN,fromUint8ToStringArray:qo,getAxesPermutation:mn,getBroadcastDims:Al,getComplexWithIndex:hb,getEinsumComputePath:gb,getEinsumPermutation:pb,getFusedBiasGradient:B0,getFusedDyActivation:z0,getImageCenter:ib,getInnerMostAxes:Nn,getPermuted:cd,getRaggedRank:lN,getReductionAxes:Vn,getReshaped:ld,getReshapedPermuted:ud,getRowPartitionTypesHelper:aN,getSliceBeginCoords:sb,getSliceSize:ob,getSparseFillEmptyRowsIndicesDenseShapeMismatch:gN,getSparseFillEmptyRowsNegativeIndexErrorMessage:vN,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:xN,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:wN,getSparseReshapeInputOutputMismatchErrorMessage:SN,getSparseReshapeInputOutputMultipleErrorMessage:CN,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:bN,getSparseReshapeNegativeOutputDimErrorMessage:yN,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:EN,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Bg,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:IN,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:$N,getUndoAxesPermutation:Ar,isIdentityPermutation:vb,log:SH,mergeRealAndImagArrays:Xo,prepareAndValidate:q0,prepareSplitSize:xb,segment_util:Q8,shouldFuse:W0,slice_util:X8,splitRealAndImagArrays:uN,stridesOrDilationsArePositive:ba,tupleValuesAreOne:xa,upcastType:qi,validateDefaultValueShape:cN,validateInput:$5,validateUpdateShape:F2,warn:ns},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F8();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TN={kernelName:yf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,ad(Fe(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t7={kernelName:lu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const i=on(Fe(n,"float32")),s=fi(rt(Vt(1),i));return Cn(nt(t,s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n7={kernelName:cu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const i=fi(rt(on(Fe(n,"float32")),1));return nt(t,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i7={kernelName:Zl,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{let a=t;const l=Vn(n.shape,s);return l.length>0&&(a=Qe(a,l)),Z(a,n.shape)},b:()=>{let a=t;const l=Vn(i.shape,s);return l.length>0&&(a=Qe(a,l)),Z(a,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7={kernelName:wx,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((i,s)=>{n[s]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7={kernelName:wf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>At(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r7={kernelName:Cf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>At(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a7={kernelName:uu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,fi(rt(Vt(1),on(Fe(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l7={kernelName:du,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const i=fi(Se(Vt(1),on(Fe(n,"float32"))));return nt(t,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7={kernelName:pu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{const a=Se(on(n),on(i));let l=U(t,nt(i,a));const c=Vn(n.shape,s);return c.length>0&&(l=Qe(l,c)),Z(l,n.shape)},b:()=>{const a=Se(on(n),on(i));let l=Cn(U(t,nt(n,a)));const c=Vn(i.shape,s);return c.length>0&&(l=Qe(l,c)),Z(l,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u7={kernelName:hu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,Se(on(Fe(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7={kernelName:fu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,rt(Vt(1),on(Fe(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(t,e,n,i,s,o){const r=V(t,"dy","avgPool3dGrad"),a=V(e,"input","avgPool3dGrad");let l=r,c=a,u=!1;a.rank===4&&(u=!0,l=Z(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]),c=Z(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),F(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),zi("avgPool3dGrad",s,o);const d={dy:l,input:c},f={filterSize:n,strides:i,pad:s,dimRoundingMode:o},h=K.runKernel($x,d,f);return u?Z(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const f7=Q({avgPool3dGrad_:h7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7={kernelName:If,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{filterSize:s,strides:o,pad:r,dimRoundingMode:a}=n;return{x:()=>f7(t,i,s,o,r,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7(t,e,n,i,s){const o=V(t,"dy","avgPoolGrad"),r=V(e,"input","avgPoolGrad");F(r.rank===o.rank,()=>`Rank of input (${r.rank}) does not match rank of dy (${o.rank})`);let a=r,l=o,c=!1;r.rank===3&&(c=!0,a=Z(r,[1,r.shape[0],r.shape[1],r.shape[2]]),l=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),F(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:n,strides:i,pad:s},f=K.runKernel(Ix,u,d);return c?Z(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const g7=Q({avgPoolGrad_:m7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7={kernelName:Sf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{filterSize:s,strides:o,pad:r}=n;return{x:()=>g7(t,i,s,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7={kernelName:$f,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[i,s]=e,{transposeA:o,transposeB:r}=n;return!o&&!r?{a:()=>Bt(t,s,!1,!0),b:()=>Bt(i,t,!0,!1)}:!o&&r?{a:()=>Bt(t,s,!1,!1),b:()=>Bt(t,i,!0,!1)}:o&&!r?{a:()=>Bt(s,t,!1,!0),b:()=>Bt(i,t,!1,!1)}:{a:()=>Bt(s,t,!0,!0),b:()=>Bt(t,i,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7={kernelName:Ef,gradFunc:(t,e,n)=>{const{blockShape:i,crops:s}=n;return{x:()=>E0(t,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7={kernelName:bH,gradFunc:(t,e,n)=>{const i=n,s=i.inputShape,o=i.shape,r=Array.from(o);for(let l=s.length-1;l>=0;l--)if(s[l]===o[l])r[l]=1;else if(s[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<r.length;l++)r[l]>1&&a.push(l);return{x:()=>Qe(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7={kernelName:mu,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7={kernelName:gu,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7={kernelName:vu,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{clipValueMin:s,clipValueMax:o}=n;return{x:()=>Ci(jo(Pa(i,s),ec(i,o)),t,At(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7={kernelName:Nf,inputsToSave:["x"],gradFunc:TN.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7={kernelName:kf,saveAllInputs:!0,gradFunc:(t,e,n)=>{const i=e.map(l=>l.shape),{axis:s}=n,o=St(s,e[0].shape)[0],r=i.map(l=>l[o]);return rs(t,r,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7={kernelName:Df,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[i,s]=e,{dilations:o,strides:r,pad:a,dataFormat:l}=n;return F(xa(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>m0(i.shape,t,s,r,a,l),filter:()=>L0(i,t,s.shape,r,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7={kernelName:Tf,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[i,s]=e,{strides:o,pad:r,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>ya(t,s,o,r,a,1,l),filter:()=>L0(t,i,s.shape,o,r,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(t,e,n,i,s){let o=t;t.rank===4&&(o=Z(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let r=e;r.rank===4&&(r=Z(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),F(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),F(r.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${r.shape}.`),F(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),F(o.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`),F(r.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${r.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:o,dy:r},l={strides:i,pad:s,filterShape:n};return K.runKernel(Tx,a,l)}const D7=Q({conv3DBackpropFilter_:k7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7={kernelName:Rf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:i,strides:s,pad:o}=n;F(xa(i),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const[r,a]=e;return{x:()=>f2(r.shape,t,a,s,o),filter:()=>D7(r,t,a.shape,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7={kernelName:xu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Cn(A2(Fe(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7={kernelName:bu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(O2(Fe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7={kernelName:_f,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:s,exclusive:o,reverse:r}=n;return{x:()=>{const a=mn([s],i.rank);let l=m2(t,s,o,!r);return a!=null&&(l=_t(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7={kernelName:Af,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:i,strides:s,pad:o,dimRoundingMode:r}=n,a=i??[1,1];F(xa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return F(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),F(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),F(pi(s,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${a}'.`),zi("depthwiseConv2d",o,r),{x:()=>H5(l.shape,t,c,s,o,a,r),filter:()=>W5(l,t,c.shape,s,o,a,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7={kernelName:Of,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[i,s]=e,o={x:i,filter:s,dy:t},r={x:i,filter:s,dy:t};return{x:()=>K.runKernel(Sg,o,n),filter:()=>K.runKernel(Ig,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7={kernelName:wu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,i={dy:t,y:n};return{x:()=>K.runKernel(zx,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7={kernelName:Cu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,i=U(Io(Cn(on(n))),2/Math.sqrt(Math.PI));return{x:()=>U(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7={kernelName:Su,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7={kernelName:Mf,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>Z(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7={kernelName:Iu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Io(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7={kernelName:$u,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7={kernelName:Eu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{const a=nt(t,Fe(i,"float32")),l=Vn(n.shape,s);return l.length>0?Z(Qe(a,l),n.shape):a},b:()=>{let a=U(t,Fe(n,"float32"));const l=Vn(i.shape,s);l.length>0&&(a=Z(Qe(a,l),i.shape));const c=on(i);return Cn(nt(a,Fe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7={kernelName:Ff,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:i}=n,[s,o,r,a]=e,l=a??Vt(1),c=Vn(o.shape,s.shape),u=[];if(o.rank===1){for(let w=0;w<s.shape.length-1;++w)u.push(s.shape[w]);u.push(1)}const d=rt(s,o),f=U(t,l),h=T2(Se(r,Vt(i))),p=U(U(U(h,h),h),Vt(-.5));return{x:()=>o.rank===1?Z(U(U(t,Gs(Z(h,[1,1,1,o.shape[0]]),u)),l),s.shape):Z(U(U(t,h),l),s.shape),mean:()=>{let w=U(U(h,Vt(-1)),f);return o.rank===1&&(w=Qe(w,c)),Z(w,o.shape)},variance:()=>{let w=U(U(p,d),f);return o.rank===1&&(w=Qe(w,c)),Z(w,o.shape)},scale:()=>{const w=U(d,h);let y=U(t,w);return o.rank===1&&(y=Qe(y,c)),Z(y,o.shape)},offset:()=>{let w=t;return o.rank===1&&(w=Qe(w,c)),Z(w,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7={kernelName:Lf,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[i,s]=e,{axis:o,batchDims:r}=n,a=St(o,i.shape)[0],l=(c,u,d)=>()=>{const f=c.shape,h=u.size,p=f.slice(0,a),m=p.length,g=f.slice(o,f.length).slice(1),v=g.length,x=PC(0,m),b=PC(m+1,m+1+v),w=MC([p,[h],g]),y=Z(d,w),C=Z(u,[h]),I=MC([[m],x,b]),$=_t(y,I);let E=z2($,C,c.shape[a]);const N=Ar(I);return E=_t(E,N),E};if(r===1){const c=i.shape[0],u=i.split(c,0);return{x:()=>Ko(u.map((h,p)=>l(h,s.slice(p,1),t.slice(p,1))())).reshape(i.shape),indices:()=>s}}else return{x:l(i,s,t),indices:()=>s}}};function PC(t,e){const n=[];for(let i=t;i<e;++i)n.push(i);return n}function MC(t){const e=[];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)e.push(t[n][i]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7={kernelName:Nu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>At(n),b:()=>At(i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7={kernelName:ku,gradFunc:t=>({x:()=>Fe(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7={kernelName:Du,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7={kernelName:Tu,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7={kernelName:Ru,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7={kernelName:Bf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{alpha:s}=n,o=cs(i,0);return{x:()=>Ci(o,t,U(t,s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7={kernelName:Au,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,Se(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7={kernelName:_u,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,Fe(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7={kernelName:wH,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i]=e,{axis:s}=n;return{logits:()=>{const r=Io(i);return rt(t,U(Qe(t,s,!0),r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(t,e,n,i=5,s=1,o=1,r=.5){const a={x:t,y:e,dy:n},l={depthRadius:i,bias:s,alpha:o,beta:r};return K.runKernel(Ux,a,l)}const tX=Q({localResponseNormalizationBackprop_:eX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX={kernelName:jf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,s]=e,{depthRadius:o,bias:r,alpha:a,beta:l}=n;return{x:()=>tX(i,s,t,o,r,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RN(t,e,n,i){return e.rank<n.rank&&(e=Z(e,Rn(e.shape,i))),t.rank<n.rank&&(t=Z(t,Rn(t.shape,i))),{x:()=>U(t,Fe(So(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FC={kernelName:Kf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const i=n,{reductionIndices:s}=i,o=e[0],r=e[1],a=St(s,o.shape),l=RN(t,r,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX={kernelName:Ou,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>U(t,Fe(Pa(n,i),"float32")),b:()=>U(t,Fe(_h(n,i),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(t,e,n,i,s,o,r){const a=V(t,"dy","maxPool3dGrad"),l=V(e,"input","maxPool3dGrad"),c=V(n,"output","maxPool3dGrad");let u=a,d=l,f=c,h=!1;l.rank===4&&(h=!0,u=Z(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=Z(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),F(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),F(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),F(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),zi("maxPool3dGrad",o,r);const p={dy:u,input:d,output:f},m={filterSize:i,strides:s,pad:o,dimRoundingMode:r},g=K.runKernel(Kx,p,m);return h?Z(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const oX=Q({maxPool3dGrad_:sX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rX={kernelName:qf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,s]=e,{filterSize:o,strides:r,pad:a,dimRoundingMode:l}=n;return{x:()=>oX(t,i,s,o,r,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(t,e,n,i,s,o,r){const a=V(t,"dy","maxPoolGrad"),l=V(e,"input","maxPoolGrad"),c=V(n,"output","maxPoolGrad");F(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),F(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),F(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),zi("maxPoolGrad",o,r);const u={dy:a,input:l,output:c},d={filterSize:i,strides:s,pad:o,dimRoundingMode:r};return K.runKernel(jx,u,d)}const lX=Q({maxPoolGrad_:aX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cX={kernelName:Xf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,s]=e,{filterSize:o,strides:r,pad:a}=n;return{x:()=>lX(t,i,s,o,r,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX={kernelName:Yf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:s}=n,o=St(s,i.shape),a=Yn(i.shape,o)[1],l=pe(a);return{x:()=>{const u=i.shape.slice();o.forEach(h=>{u[h]=1});const d=Z(t,u);return nt(U(d,Pr(i.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dX={kernelName:Jf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const i=n,{axis:s}=i,[o,r]=e,a=St(s,o.shape),l=RN(t,r,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hX={kernelName:Pu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>U(t,Fe(ec(n,i),"float32")),b:()=>U(t,Fe(cs(n,i),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX={kernelName:Zf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const i=e[0],{paddings:s}=n,o=s.map(r=>r[0]);return{x:()=>Qt(t,o,i.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX={kernelName:Mu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{const a=Vn(n.shape,s);return a.length>0?Z(Qe(t,a),n.shape):t},b:()=>{const a=U(t,Cn(kp(nt(n,i)))),l=Vn(i.shape,s);return l.length>0?Z(Qe(a,l),i.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX={kernelName:Fu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{const a=U(t,Fe(i,"float32")),l=Vn(n.shape,s);return l.length>0?Z(Qe(a,l),n.shape):a},b:()=>{const a=U(t,Fe(n,"float32")),l=Vn(i.shape,s);return l.length>0?Z(Qe(a,l),i.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gX={kernelName:Qf,gradFunc:t=>({x:()=>Cn(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX={kernelName:np,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Xn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX={kernelName:tp,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bX={kernelName:ip,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:i}=n;return Sa(t,i).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LC={kernelName:sp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const i=e[0],{paddings:s}=n,o=s.map(r=>r[0]);return{x:()=>Qt(t,o,i.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yX={kernelName:Lu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,i,s]=e,o=n,r=i,a=mt(o.shape,r.shape);return{a:()=>{const u=Fe(r,"float32");let d=U(t,U(u,wa(o,rt(u,Vt(1)))));const f=Vn(o.shape,a);return f.length>0&&(d=Qe(d,f)),Z(d,o.shape)},b:()=>{const u=cs(o,0),d=Ci(u,$o(o),At(o));let f=U(t,U(s,d));const h=Vn(r.shape,a);return h.length>0&&(f=Qe(f,h)),Z(f,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX={kernelName:op,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,i]=e,s=cs(n,0);return{x:()=>Ci(s,t,U(t,i)),alpha:()=>{let o=Ci(s,At(t),U(t,n));const r=Vn(i.shape,t.shape);return r.length>0&&(o=Qe(o,r)),Z(o,i.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(t,e,n){const i=t.shape.slice();i[n]=1;const s=Z(e,i),o=Fg(t,n,!0,!1),r=Fg(t,n,!0,!0),a=U(o,r);return U(s,a)}function SX(t,e,n){const i=t.shape.length,s=i-n.length,o=mn(n,i);let r=t;o!=null&&(r=_t(t,o));const a=r.shape.slice(),c=a.splice(i-n.length,n.length).reduce((f,h)=>f*h,1);a.push(c);const u=r.reshape(a);let d=CX(u,e,s);if(d=d.reshape(r.shape),o!=null){const f=Ar(o);d=_t(d,f)}return d}const IX={kernelName:rp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:s}=n;let o=[];return s==null?o=i.shape.map((r,a)=>a):typeof s=="number"?o=[s]:o=s,{x:()=>SX(i,t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $X={kernelName:yu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{const a=nt(t,Fe(i,"float32")),l=Vn(n.shape,s);return l.length>0?Z(Qe(a,l),n.shape):a},b:()=>{let a=U(t,Fe(n,"float32"));const l=Vn(i.shape,s);l.length>0&&(a=Z(Qe(a,l),i.shape));const c=on(i);return Cn(nt(a,Fe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX={kernelName:zu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,Cn(on(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX={kernelName:Vu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,i=U(ec(n,6),ad(n));return{x:()=>U(t,Fe(i,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX={kernelName:Bu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Fe(ad(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DX={kernelName:ap,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Z(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX={kernelName:cp,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[i]=e,s={dy:t,images:i};return{images:()=>K.runKernel(e0,s,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX={kernelName:lp,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[i]=e,s={dy:t,images:i};return{images:()=>K.runKernel(Qx,s,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X={kernelName:up,gradFunc:(t,e,n)=>{const{dims:i}=n,s=St(i,t.shape);return{x:()=>Ca(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX={kernelName:Wu,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OX={kernelName:Gu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Cn(nt(t,U(wa(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX={kernelName:dp,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Fe(At(n),"float32"),t:()=>U(t,Fe(n,t.dtype)),e:()=>U(t,Fe(C0(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MX={kernelName:Hu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const i=cs(n,Vt(0)),s=Vt(Rp),o=Vt(_p),r=U(t,o),a=U(U(t,s),Io(Fe(n,"float32")));return Ci(i,r,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX={kernelName:Xu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(n,rt(Vt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LX={kernelName:Ku,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX={kernelName:Uu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(g0(Fe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BX={kernelName:ju,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(p2(Fe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VX={kernelName:hp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{begin:s,size:o}=n,r=i.shape,[a,l]=Dp(i,s,o),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],r[u]-a[u]-l[u]]);return{x:()=>$0(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WX={kernelName:gp,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i]=e,{dim:s}=n,o=!0,r=U(t,i);return{logits:()=>rt(r,U(Qe(r,[s],o),i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GX={kernelName:qu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Ql(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zC={kernelName:pp,gradFunc:(t,e,n)=>{const{blockShape:i,paddings:s}=n;return{x:()=>p0(t,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BC={kernelName:mp,gradFunc:(t,e,n)=>{const{axis:i}=n;return{x:()=>Mi(t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HX={kernelName:Yu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,U(fi(Fe(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UX={kernelName:t0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(Fe(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jX={kernelName:Ju,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=Vt(2);return{a:()=>U(t,U(s,rt(n,i))),b:()=>U(t,U(s,rt(i,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KX={kernelName:nd,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XX={kernelName:Zu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,s=mt(n.shape,i.shape);return{a:()=>{let a=t;const l=Vn(n.shape,s);return l.length>0&&(a=Qe(a,l)),Z(a,n.shape)},b:()=>{let a=t;const l=Vn(i.shape,s);return l.length>0&&(a=Qe(a,l)),Z(Cn(a),i.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qX={kernelName:fp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,s=i.shape.slice(),{axis:o}=n;St(o,i.shape).forEach(c=>{s[c]=1});const a=Z(t,s),l=U(a,Pr(i.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YX={kernelName:Qu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nt(t,on(g0(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX={kernelName:ed,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(rt(Vt(1),on(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZX={kernelName:td,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{reps:s}=n;return{x:()=>{let r=At(i);if(i.rank===1)for(let a=0;a<s[0];++a)r=Se(r,Qt(t,[a*i.shape[0]],[i.shape[0]]));else if(i.rank===2)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)r=Se(r,Qt(t,[a*i.shape[0],l*i.shape[1]],[i.shape[0],i.shape[1]]));else if(i.rank===3)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let c=0;c<s[2];++c)r=Se(r,Qt(t,[a*i.shape[0],l*i.shape[1],c*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else if(i.rank===4)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let c=0;c<s[2];++c)for(let u=0;u<s[3];++u)r=Se(r,Qt(t,[a*i.shape[0],l*i.shape[1],c*i.shape[2],u*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);return r}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QX={kernelName:cl,gradFunc:(t,e,n)=>{const i=n,{perm:s}=i,o=Ar(s);return{x:()=>_t(t,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eq={kernelName:vp,gradFunc:(t,e,n)=>{const i=n,{axis:s}=i;return{value:()=>Ko(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tq={kernelName:xp,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>nq(t,n)}}};function nq(t,e){const n=Or(e,At(e)),i=b0(t,n);let s=Pa(e,Vt(0,"int32"));const o=i.rank-s.rank;for(let a=0;a<o;++a)s=_i(s,a+1);s=jo(s,Pr(i.shape,"bool"));const r=At(i);return Ci(s,i,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iq={kernelName:bp,gradFunc:t=>({x:()=>At(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq=[TN,t7,n7,i7,s7,o7,r7,a7,l7,c7,u7,d7,p7,v7,x7,b7,y7,w7,C7,S7,I7,$7,N7,E7,T7,R7,_7,A7,O7,P7,$X,M7,F7,L7,z7,B7,W7,V7,G7,H7,U7,j7,K7,X7,q7,Y7,J7,Z7,Q7,nX,FC,FC,iX,rX,cX,uX,dX,hX,fX,pX,mX,gX,vX,xX,bX,LC,LC,yX,wX,IX,EX,NX,kX,DX,TX,RX,_X,AX,OX,PX,MX,FX,LX,zX,BX,VX,WX,GX,zC,zC,BC,BC,HX,jX,UX,KX,XX,qX,YX,JX,ZX,QX,eq,tq,iq];for(const t of sq)IH(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.abs=function(){return this.throwIfDisposed(),xi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.acos=function(){return this.throwIfDisposed(),LU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.acosh=function(){return this.throwIfDisposed(),BU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.add=function(t){return this.throwIfDisposed(),Se(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.all=function(t,e){return this.throwIfDisposed(),u2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.any=function(t,e){return this.throwIfDisposed(),Pg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.argMax=function(t){return this.throwIfDisposed(),Wc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.argMin=function(t){return this.throwIfDisposed(),UU(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asScalar=function(){return this.throwIfDisposed(),F(this.size===1,()=>"The array must have only 1 element."),Z(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asType=function(t){return this.throwIfDisposed(),Fe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as1D=function(){return this.throwIfDisposed(),Z(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as2D=function(t,e){return this.throwIfDisposed(),Z(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),Z(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as4D=function(t,e,n,i){return this.throwIfDisposed(),Z(this,[t,e,n,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as5D=function(t,e,n,i,s){return this.throwIfDisposed(),Z(this,[t,e,n,i,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asin=function(){return this.throwIfDisposed(),KU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asinh=function(){return this.throwIfDisposed(),qU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atan=function(){return this.throwIfDisposed(),JU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atan2=function(t){return this.throwIfDisposed(),QU(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atanh=function(){return this.throwIfDisposed(),t6(this)};fe().prototype.avgPool=function(t,e,n,i){return this.throwIfDisposed(),f0(this,t,e,n,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),p0(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.batchNorm=function(t,e,n,i,s){return this.throwIfDisposed(),Ip(this,t,e,n,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.broadcastTo=function(t){return this.throwIfDisposed(),_c(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cast=function(t){return this.throwIfDisposed(),Fe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.ceil=function(){return this.throwIfDisposed(),k6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),ls(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Mn&&(t=[t]),Mi([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv1d=function(t,e,n,i,s,o){return this.throwIfDisposed(),d2(this,t,e,n,i,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv2dTranspose=function(t,e,n,i,s){return this.throwIfDisposed(),h2(this,t,e,n,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv2d=function(t,e,n,i,s,o){return this.throwIfDisposed(),ya(this,t,e,n,i,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cos=function(){return this.throwIfDisposed(),g0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cosh=function(){return this.throwIfDisposed(),p2(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),Fg(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),m2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Q6(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.depthwiseConv2d=function(t,e,n,i,s,o){return this.throwIfDisposed(),v0(this,t,e,n,i,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.dilation2d=function(t,e,n,i,s){return this.throwIfDisposed(),nj(this,t,e,n,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.divNoNan=function(t){return this.throwIfDisposed(),aj(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.div=function(t){return this.throwIfDisposed(),nt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.dot=function(t){return this.throwIfDisposed(),cj(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.elu=function(){return this.throwIfDisposed(),Ep(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.equal=function(t){return this.throwIfDisposed(),So(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.erf=function(){return this.throwIfDisposed(),g2(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),wj(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.exp=function(){return this.throwIfDisposed(),Io(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.expandDims=function(t){return this.throwIfDisposed(),_i(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.expm1=function(){return this.throwIfDisposed(),$j(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.fft=function(){return this.throwIfDisposed(),M2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.flatten=function(){return this.throwIfDisposed(),Z(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.floor=function(){return this.throwIfDisposed(),kp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.floorDiv=function(t){return this.throwIfDisposed(),c2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.gather=function(t,e,n){return this.throwIfDisposed(),b0(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Pa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.greater=function(t){return this.throwIfDisposed(),cs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.ifft=function(){return this.throwIfDisposed(),Lg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.irfft=function(){return this.throwIfDisposed(),h5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isFinite=function(){return this.throwIfDisposed(),Oj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isInf=function(){return this.throwIfDisposed(),Mj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isNaN=function(){return this.throwIfDisposed(),Lj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.leakyRelu=function(t){return this.throwIfDisposed(),w0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.lessEqual=function(t){return this.throwIfDisposed(),ec(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.less=function(t){return this.throwIfDisposed(),_h(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.localResponseNormalization=function(t,e,n,i){return this.throwIfDisposed(),Gj(this,t,e,n,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSigmoid=function(){return this.throwIfDisposed(),Yj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSoftmax=function(t){return this.throwIfDisposed(),w2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),C2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.log=function(){return this.throwIfDisposed(),$o(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.log1p=function(){return this.throwIfDisposed(),y2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalAnd=function(t){return this.throwIfDisposed(),jo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalNot=function(){return this.throwIfDisposed(),C0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalOr=function(t){return this.throwIfDisposed(),S2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalXor=function(t){return this.throwIfDisposed(),sK(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Bt(this,t,e,n)};fe().prototype.maxPool=function(t,e,n,i){return this.throwIfDisposed(),S0(this,t,e,n,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.max=function(t,e){return this.throwIfDisposed(),Us(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.maximum=function(t){return this.throwIfDisposed(),Or(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mean=function(t,e){return this.throwIfDisposed(),Tn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.min=function(t,e){return this.throwIfDisposed(),Rh(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.minimum=function(t){return this.throwIfDisposed(),Uc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),hK(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mod=function(t){return this.throwIfDisposed(),pK(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mul=function(t){return this.throwIfDisposed(),U(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.neg=function(){return this.throwIfDisposed(),Cn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Np(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.notEqual=function(t){return this.throwIfDisposed(),Ah(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),I2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.onesLike=function(){return this.throwIfDisposed(),Ts(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.pad=function(t,e){return this.throwIfDisposed(),$0(this,t,e)};fe().prototype.pool=function(t,e,n,i,s,o){return this.throwIfDisposed(),IK(this,t,e,n,i,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.pow=function(t){return this.throwIfDisposed(),wa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.prelu=function(t){return this.throwIfDisposed(),N0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.prod=function(t,e){return this.throwIfDisposed(),NK(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reciprocal=function(){return this.throwIfDisposed(),jK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.relu=function(){return this.throwIfDisposed(),Fa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.relu6=function(){return this.throwIfDisposed(),k2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reshapeAs=function(t){return this.throwIfDisposed(),Z(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reshape=function(t){return this.throwIfDisposed(),Z(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),V2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),W2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reverse=function(t){return this.throwIfDisposed(),Ca(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.rfft=function(){return this.throwIfDisposed(),m5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.round=function(){return this.throwIfDisposed(),D2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.rsqrt=function(){return this.throwIfDisposed(),T2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.selu=function(){return this.throwIfDisposed(),R2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.separableConv2d=function(t,e,n,i,s,o){return this.throwIfDisposed(),_2(this,t,e,n,i,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sigmoid=function(){return this.throwIfDisposed(),Ql(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sign=function(){return this.throwIfDisposed(),t5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sin=function(){return this.throwIfDisposed(),A2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sinh=function(){return this.throwIfDisposed(),O2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.slice=function(t,e){return this.throwIfDisposed(),Qt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.softmax=function(t){return this.throwIfDisposed(),F0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.softplus=function(){return this.throwIfDisposed(),sd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),E0(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.split=function(t,e){return this.throwIfDisposed(),rs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sqrt=function(){return this.throwIfDisposed(),fi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.square=function(){return this.throwIfDisposed(),on(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.squaredDifference=function(t){return this.throwIfDisposed(),v5(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.squeeze=function(t){return this.throwIfDisposed(),rd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Mn?[this,t]:[this,...t];return Ko(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.step=function(t){return this.throwIfDisposed(),ad(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.stridedSlice=function(t,e,n,i,s,o,r,a){return this.throwIfDisposed(),C5(this,t,e,n,i,s,o,r,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sub=function(t){return this.throwIfDisposed(),rt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sum=function(t,e){return this.throwIfDisposed(),Qe(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tan=function(){return this.throwIfDisposed(),I5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tanh=function(){return this.throwIfDisposed(),Sp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tile=function(t){return this.throwIfDisposed(),Gs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toBool=function(){return this.throwIfDisposed(),Fe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toFloat=function(){return this.throwIfDisposed(),Fe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toInt=function(){return this.throwIfDisposed(),Fe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.topk=function(t,e){return this.throwIfDisposed(),N5(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.transpose=function(t){return this.throwIfDisposed(),_t(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unique=function(t){return this.throwIfDisposed(),T5(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),z2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unstack=function(t){return this.throwIfDisposed(),Sa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.where=function(t,e){return this.throwIfDisposed(),Ci(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.zerosLike=function(){return this.throwIfDisposed(),At(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ao extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ao.prototype)}}class Es extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Es.prototype)}}class G extends Error{constructor(e){super(e),Object.setPrototypeOf(this,G.prototype)}}class xt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,xt.prototype)}}class yb extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yb.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _N{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const i=this.cache.keys().next().value;this.cache.delete(i)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const i=this.cache.keys().next().value;this.cache.delete(i)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ia(t,e){if(Array.isArray(t)){let n=[];for(let i=0;i<e;i++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function lo(t,e){if(!t)throw new yb(e)}function VC(t,e){let n=0;for(const i of t)i===e&&n++;return n}function Ai(t){return t.length===1?t[0]:t}function Gt(t){return Array.isArray(t)?t:[t]}function Ao(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Yr(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let gs={};function wb(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function Vg(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>Vg(e));else{const e=Object.keys(t);for(const n of e){const i=t[n];i!=null&&typeof i=="object"&&(!Array.isArray(i)&&i.type==="ndarray"&&typeof i.value=="number"?t[n]=i.value:Vg(i))}}}function dd(t,e={},n={},i="object",s=!1){if(typeof t=="string"){const o=t;let r;if(o in n)r=n[o];else if(o in gs)r=gs[o];else if(r=e[o],r==null)throw new G(`Unknown ${i}: ${t}. This may be due to one of the following reasons:
1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return r}else{const o=t;if(o.className==null||o.config==null)throw new G(`${i}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const r=o.className;let a,l;if(r in n?[a,l]=n[r]:r in gs?[a,l]=gs.className:r in e&&([a,l]=e[r]),a==null)throw new G(`Unknown ${i}: ${r}. This may be due to one of the following reasons:
1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const h of Object.keys(gs))c[h]=gs[h];for(const h of Object.keys(n))c[h]=n[h];const u=o.config;u.customObjects=c;const d=Object.assign({},gs);for(const h of Object.keys(n))gs[h]=n[h];Vg(o.config);const f=l(a,o.config,n,s);return gs=Object.assign({},d),f}else{const c=Object.assign({},gs);for(const d of Object.keys(n))gs[d]=n[d];const u=new a(o.config);return gs=Object.assign({},c),u}}}function oq(t,e){return t<e?-1:t>e?1:0}function Bd(t,e){return-1*oq(t,e)}function gr(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function rq(t){if(t==null)throw new G(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function za(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new G(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Cb(t,e,n=0,i=1/0){return lo(n>=0),lo(i>=n),Array.isArray(t)&&t.length>=n&&t.length<=i&&t.every(s=>typeof s===e)}function qn(t,e){Array.isArray(t)?(F(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,i)=>qn(n,`element ${i+1} of ${e}`))):F(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${AN(t)}.`)}function AN(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>AN(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function aq(t,e,n){let i=n!=null?n():Ri(),s;return(...r)=>{const a=n!=null?n():Ri();return a-i<e||(i=a,s=t(...r)),s}}function ON(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let lq=0;function PN(){return lq++}const Vd={};function Ap(t=""){return t in Vd||(Vd[t]=0),Vd[t]+=1,t+Vd[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const cq=["channelsFirst","channelsLast"],uq=["nearest","bilinear"],dq=["valid","same","causal"],hq=["max","avg"],fq=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qa=new Map;function kn(t){za(cq,"DataFormat",t)}function pq(t){za(uq,"InterpolationFormat",t)}function us(t){za(dq,"PaddingMode",t)}function MN(t){za(hq,"PoolMode",t)}const Ac=[],WC="/";function ca(t,e){Ac.push(t);try{const n=e();return Ac.pop(),n}catch(n){throw Ac.pop(),n}}function mq(){return Ac.length===0?"":Ac.join(WC)+WC}function FN(t){if(!zN(t))throw new Error("Not a valid tensor name: '"+t+"'");return mq()+t}function LN(t){if(!zN(t))throw new Error("Not a valid tensor name: '"+t+"'");qa.has(t)||qa.set(t,0);const e=qa.get(t);if(qa.set(t,qa.get(t)+1),e>0){const n=`${t}_${e}`;return qa.set(n,1),n}else return t}const gq=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function zN(t){return!!t.match(gq)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vq(t){return t===parseInt(t.toString(),10)}function vr(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let i=1;for(let s=e;s<n;++s)i*=t[s];return i}function Pl(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const i=t[n];i<e&&(e=i)}return e}function Sr(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const i=t[n];i>e&&(e=i)}return e}function Ks(t,e){if(e<t)throw new G(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let i=t;i<e;++i)n.push(i);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Em;function Fn(){return Em==null&&(Em=JH().epsilon()),Em}function Xs(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xo(t,e){return Fe(t,e)}function hd(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),Z(t,n)}function xq(t,e){return ie(()=>{if(t.shape.length!==2)throw new G(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=hd(t,1);return Wg(n,[1,e,1])})}function bq(t){const e=[vr(t.shape)];return Z(t,e)}function yq(t){if(t.rank<=1)throw new G(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],vr(t.shape,1)];return Z(t,e)}function ua(t,e,n){return ie(()=>{switch(t.rank){case 1:return P0(t,e,n);case 2:return P2(t,[e,0],[n,t.shape[1]]);case 3:return M0(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Ph(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Qt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Qt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new G(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Nm(t,e,n){return ie(()=>{switch(t.rank){case 1:return P0(t,e,n);case 2:return P2(t,[0,e],[t.shape[0],n]);case 3:return M0(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Ph(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Wd(t,e,n,i){return ie(()=>{switch(t.rank){case 1:return P0(t,e,n);case 2:switch(i){case 1:return ua(t,e,n);case 2:return Nm(t,e,n);default:throw new G(`The axis is not within the rank of the tensor ${i}`)}case 3:switch(i){case 1:return ua(t,e,n);case 2:return M0(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Nm(t,e,n);default:throw new G(`The axis is not within the rank of the tensor ${i}`)}case 4:switch(i){case 1:return ua(t,e,n);case 2:return Ph(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Ph(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Nm(t,e,n);default:throw new G(`The axis is not within the rank of the tensor ${i}`)}default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Sb(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Mi(t,e)}function GC(t,e){switch(t.rank){case 1:return R6([t,e]);case 2:return A6([t,e],0);case 3:return P6([t,e],0);case 4:return F6([t,e],0);default:throw new G(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Wg(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new G(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Gs(t,e)}function Op(t,e=0,n=1,i,s){return N2(t,e,n,i,s)}function bo(t,e,n,i){if(t.rank<2||e.rank<2)throw new xt(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=t.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(s!==o)throw new xt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return NC({a:t,b:e,transposeA:!1,transposeB:!1,bias:i?Gg(t.rank,i,Xs()):null,activation:n});{const s=t.shape.slice(),o=s.pop();t=Z(t,[-1,o]);const r=e.shape.slice(),a=r.pop(),l=r.pop(),c=[...r,a],u=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=Z(_t(e,u),[l,-1]);const d=[...s,...c];return Z(NC({a:t,b:e,transposeA:!1,transposeB:!1,bias:i?Gg(t.rank,i,Xs()):null,activation:n}),d)}}function BN(t,e,n){return ie(()=>(Array.isArray(e)?e=Ui(e,"int32"):e=Fe(e,"int32"),b0(t,e,n)))}function fd(t){return U(t,t)}function Gg(t,e,n){const i=e.shape;if(e.rank!==1&&e.rank!==t)throw new G(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return i.length===1?Z(e,[1,i[0],1,1,1]):Z(e,[1,i[3],i[0],i[1],i[2]]);if(n==="channelsLast")return i.length===1?Z(e,[1,1,1,1,i[0]]):Z(e,[1].concat(i))}else if(t===4){if(n==="channelsFirst")return i.length===1?Z(e,[1,i[0],1,1]):Z(e,[1,i[2],i[0],i[1]]);if(n==="channelsLast")return i.length===1?Z(e,[1,1,1,i[0]]):Z(e,[1].concat(i))}else if(t===3){if(n==="channelsFirst")return i.length===1?Z(e,[1,i[0],1]):Z(e,[1,i[1],i[0]]);if(n==="channelsLast")return i.length===1?Z(e,[1,1,i[0]]):Z(e,[1].concat(i))}else if(t<3)return e;throw new G(`Unsupported input rank by biasAdd: ${e.rank}`)}function Zs(t,e,n){return ie(()=>(n==null&&(n=Xs()),kn(n),Se(t,Gg(t.rank,e,n))))}function wq(t,e=1){if(e!==1)throw new xt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Ep(t)}function Cq(t){return ie(()=>nt(t,Se(xi(t),1)))}function VN(t,e,n,i){return ie(()=>F5(t,e,n,i))}function Sq(t){return ie(()=>{const e=Se(.5,U(.2,t));return ls(e,0,1)})}function pd(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Iq=["fanIn","fanOut","fanAvg"],$q=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eq(t){za(Iq,"FanMode",t)}function Nq(t){za($q,"Distribution",t)}class Os extends nc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class WN extends Os{apply(e,n){return Xn(e,n)}}WN.className="Zeros";Ce(WN);class Ib extends Os{apply(e,n){return Pr(e,n)}}Ib.className="Ones";Ce(Ib);class GN extends Os{constructor(e){if(super(),typeof e!="object")throw new G(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new G(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return ie(()=>U(Vt(this.value),Pr(e,n)))}getConfig(){return{value:this.value}}}GN.className="Constant";Ce(GN);class HN extends Os{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return od(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}HN.className="RandomUniform";Ce(HN);class UN extends Os{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new xt(`randomNormal does not support dType ${n}.`);return Op(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}UN.className="RandomNormal";Ce(UN);class jN extends Os{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new xt(`truncatedNormal does not support dType ${n}.`);return L2(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}jN.className="TruncatedNormal";Ce(jN);class KN extends Os{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return ie(()=>{if(e.length!==2||e[0]!==e[1])throw new G("Identity matrix initializer can only be used for 2D square matrices.");return U(this.gain,b2(e[0]))})}getConfig(){return{gain:this.gain}}}KN.className="Identity";Ce(KN);function kq(t,e="channelsLast"){let n,i;if(kn(e),t.length===2)n=t[0],i=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const s=vr(t,2);n=t[1]*s,i=t[0]*s}else if(e==="channelsLast"){const s=vr(t,0,t.length-2);n=t[t.length-2]*s,i=t[t.length-1]*s}}else{const s=vr(t);n=Math.sqrt(s),i=Math.sqrt(s)}return[n,i]}class Yi extends Os{constructor(e){if(super(),e.scale<0)throw new G(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Eq(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Nq(this.distribution),this.seed=e.seed}apply(e,n){const i=kq(e),s=i[0],o=i[1];let r=this.scale;if(this.mode==="fanIn"?r/=Math.max(1,s):this.mode==="fanOut"?r/=Math.max(1,o):r/=Math.max(1,(s+o)/2),this.distribution==="normal"){const a=Math.sqrt(r);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new xt(`${this.getClassName()} does not support dType ${n}.`);return L2(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*r);return od(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Yi.className="VarianceScaling";Ce(Yi);class $b extends Yi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Yi.className}}$b.className="GlorotUniform";Ce($b);class Eb extends Yi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Yi.className}}Eb.className="GlorotNormal";Ce(Eb);class Nb extends Yi{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Yi.className}}Nb.className="HeNormal";Ce(Nb);class kb extends Yi{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Yi.className}}kb.className="HeUniform";Ce(kb);class Db extends Yi{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Yi.className}}Db.className="LeCunNormal";Ce(Db);class Tb extends Yi{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Yi.className}}Tb.className="LeCunUniform";Ce(Tb);class XN extends Os{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return ie(()=>{if(e.length<2)throw new xt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const i=pe(e.slice(0,-1)),s=e[e.length-1],o=i*s;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const r=[Math.max(s,i),Math.min(s,i)],a=Op(r,0,1,n,this.seed),l=A8.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(s,i)*Math.min(s,i)],[Math.min(s,i)+1]);return c=U(c,d.sign()),i<s&&(c=c.transpose()),U(Vt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}XN.className="Orthogonal";Ce(XN);const HC={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function UC(t,e={}){return dd(t,Cs.getMap().classNameMap,e,"initializer")}function pn(t){return wb(t)}function ln(t){if(typeof t=="string"){const e=t in HC?HC[t]:t;if(e==="GlorotNormal")return new Eb;if(e==="GlorotUniform")return new $b;if(e==="HeNormal")return new Nb;if(e==="HeUniform")return new kb;if(e==="LeCunNormal")return new Db;if(e==="LeCunUniform")return new Tb;{const n={};return n.className=e,n.config={},UC(n)}}else return t instanceof Os?t:UC(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hg(t){return Array.isArray(t)&&Array.isArray(t[0])}function Mh(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function at(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new G(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Lt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new G(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fh(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((i,s)=>i*s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jC="Variable";class Dq{constructor(e,n="float32",i=jC,s=!0,o=null){this.dtype=n??"float32",this.shape=e.shape,this.id=PN(),i=i??jC,this.originalName=FN(i),this.name=LN(this.originalName),this.trainable_=s,this.constraint=o,this.val=A5(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Tq(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Tq(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function Ug(t){return t.map(e=>e.read())}function Rb(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ln{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Eo{constructor(e,n,i,s,o,r,a){this.dtype=e,this.shape=n,this.sourceLayer=i,this.inputs=s,this.callArgs=o,this.outputTensorIndex=a,this.id=PN(),r!=null&&(this.originalName=FN(r),this.name=LN(this.originalName)),this.rank=n.length}}let Rq=0;class Pp{constructor(e,n){this.callArgs=n,this.id=Rq++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const i of e.inboundLayers)i!=null&&i.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let _q=0;class It extends nc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=_q++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const i=this.getClassName();n=Ao(i)+"_"+Ap(i)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let i;if(e.batchInputShape!=null)i=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),i=[o].concat(e.inputShape)}this.batchInputShape=i;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Es(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new G(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Ai(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Ai(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ao(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ao(`Layer ${this.name} is not connected, no input to return.`);return Ai(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ao(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ao(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ai(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=Gt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const i=Gt(this.inputSpec);if(n.length!==i.length)throw new G(`Layer ${this.name} expects ${i.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let s=0;s<n.length;s++){const o=n[s],r=i[s];if(r==null)continue;const a=o.rank;if(r.ndim!=null&&a!==r.ndim)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${r.ndim}, found ndim=${a}`);if(r.maxNDim!=null&&a>r.maxNDim)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${r.maxNDim}, found ndim=${a}`);if(r.minNDim!=null&&a<r.minNDim)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${r.minNDim}, found ndim=${a}.`);if(r.dtype!=null&&o.dtype!==r.dtype)throw new G(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${r.dtype}, found dtype=${o.dtype}.`);if(r.axes){const l=o.shape;for(const c in r.axes){const u=Number(c),d=r.axes[c],f=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(f)===-1)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(r.shape!=null)for(let l=0;l<r.shape.length;++l){const c=r.shape[l],u=o.shape[l];if(c!=null&&u!=null&&c!==u)throw new G(`Input ${s} is incompatible with layer ${this.name}: expected shape=${r.shape}, found shape=${o.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const i=Gt(e),s=Pq(e),o=Mq(e);if(s===o)throw new G("Arguments to apply() must be all SymbolicTensors or all Tensors");return ca(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const r=[];for(const a of Gt(e))r.push(a.shape);this.build(Ai(r)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let r=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,r);const a=Gt(r),l=[];for(let c of a)i.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(r=Ai(l),this.activityRegularizer!=null)throw new xt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}else{const r=Aq(e),a=this.computeOutputShape(r);let l;const c=Oq(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?r[0]:r),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new Eo(c,u,this,Gt(e),n,this.name,d)):l=new Eo(c,a,this,Gt(e),n,this.name),this.addInboundNode(e,l,null,null,r,a,n),this._refCount++,this.activityRegularizer!=null)throw new xt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((i,s)=>{i!=null&&e[s]!=null&&e[s]!==i&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ao(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const i=JSON.stringify(n.outputShapes);e.indexOf(i)===-1&&e.push(i)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new ao(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Es(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Fh(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Ug(e?this.trainableWeights:this.weights)}setWeights(e){ie(()=>{const n=this.weights;if(n.length!==e.length)throw new G(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const i=[],s=Ug(n);for(let o=0;o<s.length;++o){const r=s[o],a=n[o],l=e[o];if(!Wt(r.shape,l.shape))throw new G(`Layer weight shape ${r.shape} not compatible with provided weight shape ${l.shape}`);i.push([a,l])}Rb(i)})}addWeight(e,n,i,s,o,r,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new G(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),i==null&&(i="float32"),this.fastWeightInitDuringBuild&&(s=l!=null?l():ln("zeros"));const c=s.apply(n,i),u=new Dq(c,i,e,r,a);return c.dispose(),o!=null&&this.addLoss(()=>o.apply(u.read())),r==null&&(r=!0),r?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Gt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(i=>{if(i!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,i){if(!this.supportsMasking)return;const s=this.computeMask(e,i),o=Gt(n),r=Gt(s);if(o.length!==r.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=r[a]}addInboundNode(e,n,i,s,o,r,a=null){const l=Gt(e);n=Gt(n),i=Gt(i),s=Gt(s),o=Mh(o),r=Mh(r);const c=[],u=[],d=[];for(const f of l)c.push(f.sourceLayer),u.push(f.nodeIndex),d.push(f.tensorIndex);new Pp({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:i,outputMasks:s,inputShapes:o,outputShapes:r},a);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Aq(t){t=Gt(t);const e=[];for(const n of t)e.push(n.shape);return Ai(e)}function Oq(t){return"float32"}function qN(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const i=e.inboundNodes[n];if(i.inboundLayers.length===0)return i.inputTensors;{const s=[];for(let o=0;o<i.inboundLayers.length;o++){const r=i.inputTensors[o],a=i.inboundLayers[o],l=i.nodeIndices[o],c=qN(r,a,l);for(const u of c)s.indexOf(u)===-1&&s.push(u)}return s}}}function Pq(t){let e=!0;for(const n of Gt(t))if(!(n instanceof Eo)){e=!1;break}return e}function Mq(t){let e=!0;for(const n of Gt(t))if(n instanceof Eo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class md extends It{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Ap("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new G("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new G("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new G("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const i=e.dtype||"float32";this.batchInputShape=n,this.dtype=i,this.inputSpec=[{shape:n}];const s=new Eo(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new Pp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new G(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}md.className="InputLayer";Ce(md);function Fq(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new G("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new md({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lq(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Fe(e,t.dtype)}catch{throw new G(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class dr{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof dr)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,i){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Lq(e,n),this.name2Id[e.name]=e.id,i!=null&&(this.id2Mask[e.id]=i);else throw new G(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Eo){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Eo){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&bt(this.id2Mask)}}const Lh=new _N,zh=new _N;function zq(t){Lh!=null&&Lh.setMaxEntries(t),zh!=null&&zh.setMaxEntries(t)}function Cc(t,e,n,i){const s=n==null?!1:n.training,o=Array.isArray(t),r=o?t:[t],a=r.map(p=>p.name),l=[],c=e.names();for(const p of a)c.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const u=a.join(",")+"|"+e.names().sort().join(",");let d=Lh.get(u),f;if(d==null){const p=Bq(r,e);d=p.sorted,f=p.recipientCounts,Lh.put(u,d),zh.put(u,f)}f={},s||Object.assign(f,zh.get(u));const h=new dr(e);for(let p=0;p<d.length;++p){const m=d[p],g=m.sourceLayer;if(g instanceof md)continue;const v=[],x=[],b=[];let w=!1;for(const E of m.inputs){const N=h.getValue(E),k=h.getMask(E);v.push(N),x.push(k),k!=null&&(w=!0),s||(f[E.name]--,f[E.name]===0&&!e.hasKey(E)&&a.indexOf(E.name)===-1&&!N.isDisposed&&E.sourceLayer.stateful!==!0&&b.push(N))}w&&(n=n||{},n.mask=x[0]);const y=Gt(g.apply(v,n));let C=null;g.supportsMasking&&(C=g.computeMask(v,x));const I=Wq(m),$=Array.isArray(I)?I:[I];for(let E=0;E<$.length;++E){h.hasKey($[E])||h.add($[E],y[E],Array.isArray(C)?C[0]:C);const N=a.indexOf($[E].name);N!==-1&&(l[N]=y[E])}s||bt(b)}return h.disposeMasks(),o?l:l[0]}function Bq(t,e){F(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],i={};if(t.length===1){const s=KC(t[0],e);n=s.sorted,i=s.recipientMap}else{const s=new Set;for(const o of t){const{sorted:r,recipientMap:a}=KC(o,e);for(const l of r)s.has(l.name)||(n.push(l),s.add(l.name));for(const l in a)i[l]==null&&(i[l]=new Set),a[l].forEach(c=>i[l].add(c))}}return{sorted:n,recipientCounts:Vq(i)}}function Vq(t){const e={};for(const n in t)e[n]=t[n].size;return e}function KC(t,e){const n=new Set,i=[],s={};for(const a of e.names())n.add(a);const o=[],r=[];for(o.push(t);o.length>0;){const a=o[o.length-1];if(n.has(a.name)){o.pop();continue}const l=r[r.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),i.push(a),n.add(a.name),l&&r.pop();else{r.push(o.length-1);for(const c of a.inputs)s[c.name]==null&&(s[c.name]=new Set),s[c.name].add(a.name),!n.has(c.name)&&o.push(c)}}return{sorted:i,recipientMap:s}}function Wq(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let i=0;i<t.sourceLayer.inboundNodes.length;++i)for(const s of t.sourceLayer.inboundNodes[i].outputTensors)if(s.id===t.id){n=i;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq=le();Gq.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,zq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _b(t,e){return ie(()=>fi(Qe(U(t,t),e,!0)))}class gd extends nc{getConfig(){return{}}}class YN extends gd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>{const n=_b(e,this.axis),i=ls(n,0,this.maxValue);return U(e,nt(i,Se(Fn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}YN.className="MaxNorm";Ce(YN);class JN extends gd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>nt(e,Se(Fn(),_b(e,this.axis))))}getConfig(){return{axis:this.axis}}}JN.className="UnitNorm";Ce(JN);class ZN extends gd{apply(e){return Fa(e)}}ZN.className="NonNeg";Ce(ZN);class QN extends gd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>{const n=_b(e,this.axis),i=Se(U(this.rate,ls(n,this.minValue,this.maxValue)),U(1-this.rate,n));return U(e,nt(i,Se(Fn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}QN.className="MinMaxNorm";Ce(QN);const XC={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function zn(t){return wb(t)}function qC(t,e={}){return dd(t,Cs.getMap().classNameMap,e,"constraint")}function Bn(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in XC?XC[t]:t,config:{}};return qC(n)}else return t instanceof gd?t:qC(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Hr(t){if(t==null)return;const e=[],n=[],i=[];for(const s in t){const o=t[s];if(typeof o!="number"){const r=o;e.push(r.data()),n.push(s),i.push(r)}}if(e.length>0){const s=await Promise.all(e);for(let o=0;o<s.length;++o)t[n[o]]=s[o][0];bt(i)}}function ek(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var YC;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(YC||(YC={}));const Hq=125;class Kc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class Uq{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const i of this.callbacks)await i.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const i of this.callbacks)await i.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const i of this.callbacks)await i.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const i of this.callbacks)await i.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class jq extends Kc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const i=n.size==null?0:n.size;this.seen+=i;for(const s in n){const o=n[s];if(typeof o=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+o*i;else{let r;s in this.totals?r=this.totals[s]:this.totals[s]=0;const a=ie(()=>Se(this.totals[s],U(o,i)));this.totals[s]=a,r!=null&&r.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const i of this.params.metrics)this.totals[i]!=null&&(typeof this.totals[i]=="number"?n[i]=this.totals[i]/this.seen:ie(()=>{const s=U(nt(1,this.seen),this.totals[i]);n[i]=s,this.totals[i].dispose(),go(n[i])}))}}class Kq extends Kc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const i in n)this.history[i]==null&&(this.history[i]=[]),this.history[i].push(n[i])}async syncData(){const e=[],n=[],i=[];for(const o in this.history){const r=this.history[o];for(let a=0;a<r.length;++a)if(typeof r[a]!="number"){const l=r[a];e.push(l.data()),n.push(o),i.push(a)}}const s=await Promise.all(e);for(let o=0;o<s.length;++o)this.history[n[o]][i[o]].dispose(),this.history[n[o]][i[o]]=s[o][0]}}class Xq extends Kc{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||oN,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Hq),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");yg(this.yieldEvery)&&(this.maybeWait=aq(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,i){const s=[];this.yield!=null&&(await Hr(i),s.push(this.yield(e,n,i))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Hr(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const i=[];this.epochEnd!=null&&(await Hr(n),i.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&i.push(this.nextFrameFunc()),await Promise.all(i)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Hr(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const i=[];this.batchEnd!=null&&(await Hr(n),i.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?i.push(this.nextFrameFunc()):yg(this.yieldEvery)&&i.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(i)}async onTrainBegin(e){this.trainBegin!=null&&(await Hr(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Hr(e),await this.trainEnd(e))}}function tk(t,e){return t==null&&(t={}),t instanceof Kc?[t]:Array.isArray(t)&&t[0]instanceof Kc?t:Gt(t).map(i=>new Xq(i,e))}class ys{constructor(){}static registerCallbackConstructor(e,n){F(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ys.checkForDuplicate(n),ys.constructors[e]==null&&(ys.constructors[e]=[]),ys.constructors[e].push(n)}static checkForDuplicate(e){for(const n in ys.constructors)ys.constructors[+n].forEach(s=>{if(s===e)throw new G("Duplicate callback constructor.")})}static clear(){ys.constructors={}}static createCallbacks(e){const n=[];for(const i in ys.constructors){const s=+i;e>=s&&n.push(...ys.constructors[s])}return n.map(i=>new i)}}ys.constructors={};function nk(t,e,n,i,s,o,r,a,l){const c=new Kq,u=[new jq,...ys.createCallbacks(e)];t!=null&&u.push(...t),u.push(c);const d=new Uq(u);return d.setParams({epochs:n,initialEpoch:i,samples:s,steps:o,batchSize:r,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yo(t,e={},n=!1){return dd(t,Cs.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bh(t,e){return ie(()=>{t.dtype!=="float32"&&(t=Fe(t,"float32"));const n=Qe(fd(t),e,!0),i=$p(n.shape,Fn()),s=fi(Or(n,i));return nt(t,s)})}function Mp(t,e){return ie(()=>Tn(fd(rt(e,t)),-1))}function Ab(t,e){return ie(()=>Tn(xi(rt(e,t)),-1))}function Ob(t,e){return ie(()=>{const n=rt(t,e),i=ls(xi(t),Fn(),Number.MAX_VALUE),s=xi(nt(n,i));return U(100,Tn(s,-1))})}function qq(t,e){return ie(()=>{const n=ls(e,Fn(),Number.MAX_VALUE),i=$o(Se(1,n)),s=ls(t,Fn(),Number.MAX_VALUE),o=$o(Se(1,s));return Tn(fd(rt(i,o)),-1)})}function Yq(t,e){return ie(()=>{const n=Or(0,rt(1,U(t,e)));return Tn(fd(n),-1)})}function Jq(t,e){return ie(()=>{const n=Or(0,rt(1,U(t,e)));return Tn(n,-1)})}function Zq(t,e){return ie(()=>{const n=Qe(U(t,e),-1),i=Us(U(rt(1,t),e),-1);return Or(0,Se(1,rt(i,n)))})}function Qq(t,e){return ie(()=>{const n=Math.log(2),i=rt(e,t),s=rt(Se(i,sd(U(-2,i))),n);return Tn(s,-1)})}function Xc(t,e,n=!1){return ie(()=>{if(n)e=F0(e);else{const i=Qe(e,e.shape.length-1,!0);e=nt(e,i)}return e=ls(e,Fn(),1-Fn()),Cn(Qe(U(Fe(t,"float32"),$o(e)),e.shape.length-1))})}function Vh(t,e,n=!1){return ie(()=>{const i=Fe(kp(bq(t)),"int32");e=ls(e,Fn(),1-Fn());const s=e.shape,o=Z(I2(i,s[s.length-1]),s);return Xc(o,e,n)})}function e9(t,e){if(!Wt(t.shape,e.shape))throw new G(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return ie(()=>{const n=Fa(e),i=Cn(xi(e));return Se(rt(n,U(e,t)),y2(Io(i)))})}function Fp(t,e){return ie(()=>{let n;return n=ls(e,Fn(),1-Fn()),n=$o(nt(n,rt(1,n))),Tn(e9(t,n),-1)})}function t9(t,e){return ie(()=>{const n=ls(t,Fn(),1),i=ls(e,Fn(),1);return Qe(U(t,$o(nt(n,i))),-1)})}function n9(t,e){return ie(()=>{const n=$o(Se(Fn(),e));return Tn(rt(e,U(t,n)),-1)})}function ik(t,e){return ie(()=>{const n=Bh(t,-1),i=Bh(e,-1),s=U(n,i);return Cn(Qe(s,-1))})}const Wh={meanSquaredError:Mp,meanAbsoluteError:Ab,meanAbsolutePercentageError:Ob,meanSquaredLogarithmicError:qq,squaredHinge:Yq,hinge:Jq,categoricalHinge:Zq,logcosh:Qq,categoricalCrossentropy:Xc,sparseCategoricalCrossentropy:Vh,binaryCrossentropy:Fp,kullbackLeiblerDivergence:t9,poisson:n9,cosineProximity:ik};function km(t){if(typeof t=="string"){if(t in Wh)return Wh[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new G(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sk(t,e){return ie(()=>{const n=U(.5,Ts(e)),i=xo(cs(e,n),t.dtype);return Tn(So(t,i),-1)})}function ok(t,e){return ie(()=>xo(So(Wc(t,-1),Wc(e,-1)),"float32"))}function i9(t,e){return ie(()=>Fe(Qe(jo(So(t,1),So(e,1))),"float32"))}function s9(t,e){return ie(()=>Fe(Qe(jo(So(t,0),So(e,1))),"float32"))}function o9(t,e){return ie(()=>{const n=i9(t,e),i=s9(t,e),s=Se(n,i);return Fe(Ci(cs(s,0),nt(n,s),0),"float32")})}function r9(t,e){return Fp(t,e)}function a9(t,e){return t.rank===e.rank&&(t=rd(t,[t.rank-1])),e=Wc(e,-1),e.dtype!==t.dtype&&(e=Fe(e,t.dtype)),Fe(So(t,e),"float32")}const l9=Mp,c9=Mp,u9=Ab,d9=Ab,h9=Ob,f9=Ob,rk=Xc,p9=ik,ak=Vh,Gh={binaryAccuracy:sk,categoricalAccuracy:ok,precision:o9,categoricalCrossentropy:rk,sparseCategoricalCrossentropy:ak,mse:l9,MSE:c9,mae:u9,MAE:d9,mape:h9,MAPE:f9,cosine:p9};function m9(t){if(typeof t=="string"&&t in Gh)return Gh[t];if(typeof t!="string"&&t!=null)return t;throw new G(`Unknown metric ${t}`)}function Gd(t){if(lo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Wh))if(Wh[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Gh))if(Gh[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function g9(t){const e={Adagrad:()=>Xa.adagrad(.01),Adadelta:()=>Xa.adadelta(1,.95,Fn()),Adam:()=>Xa.adam(.001,.9,.999,Fn()),Adamax:()=>Xa.adamax(.002,.9,.999,Fn(),0),RMSProp:()=>Xa.rmsprop(.001,.9,0,Fn()),SGD:()=>Xa.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new G(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const JC=1*1024*1024;function ZC(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!jg(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const i=JSON.stringify(t);i.length>JC&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${i.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${JC}.`)}}function jg(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!jg(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!jg(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function v9(t,e,n,i=console.log){const s=b9(t),o=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(e*u)));let r;if(!s){o.push("Receives inputs"),r=[];for(const u in t.nodesByDepth)r.push(...t.nodesByDepth[u])}i("_".repeat(e)),Hh(o,n,i),i("=".repeat(e));const a=t.layers;for(let u=0;u<a.length;++u)s?y9(a[u],n,i):w9(a[u],n,r,i),i((u===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=x9(t),c=Fh(t.nonTrainableWeights);i(`Total params: ${l+c}`),i(`Trainable params: ${l}`),i(`Non-trainable params: ${c}`),i("_".repeat(e))}function x9(t){let e;return t.collectedTrainableWeights!=null?e=Fh(t.collectedTrainableWeights):e=Fh(t.trainableWeights),e}function b9(t){let e=!0;const n=[],i=[];for(const s in t.nodesByDepth)n.push(t.nodesByDepth[s]);for(const s of n){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}i.push(...s)}if(e)for(const s of t.layers){let o=!1;for(const r of s.inboundNodes)if(i.indexOf(r)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Hh(t,e,n=console.log){let i="";for(let s=0;s<t.length;++s)s>0&&(i=i.slice(0,i.length-1)+" "),i+=t[s],i=i.slice(0,e[s]),i+=" ".repeat(e[s]-i.length);n(i)}function y9(t,e,n){let i,s;try{s=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{s="multiple"}try{i=JSON.stringify(t.outputShape)}catch{i="multiple"}const o=t.name,r=t.getClassName(),a=[`${o} (${r})`,s,i,t.countParams().toString()];Hh(a,e,n)}function w9(t,e,n,i){let s,o;try{o=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const r=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let f=0;f<d.inboundLayers.length;++f){const h=d.inboundLayers[f].name,p=d.nodeIndices[f],m=d.tensorIndices[f];r.push(`${h}[${p}][${m}]`)}const a=t.name,l=t.getClassName(),c=r.length===0?"":r[0],u=[`${a} (${l})`,o,s,t.countParams().toString(),c];Hh(u,e,i);for(let d=1;d<r.length;++d)Hh(["","","","",r[d]],e,i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lk(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Uh(t,e){if(t===null)return null;if(typeof t=="string")return Yr(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],i=t.length;for(let s=0;s<i;++s){const o=t[s];lk(e,s,o)?n.push(o):n.push(Uh(o,e))}return n}else{const n={};for(const i of Object.keys(t)){const s=t[i];if(i==="name"&&typeof s=="string")n[i]=s;else{const o=Yr(i);n[o]=Uh(s,o)}}return n}}function Kg(t,e){if(t==null)return null;if(typeof t=="string")return Ao(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],i=t.length;for(let s=0;s<i;++s){const o=t[s];lk(e,s,o)?n.push(o):n.push(Kg(o,e))}return n}else{const n={};for(const i of Object.keys(t)){const s=t[i],o=Ao(i);(i==="name"||i==="className")&&typeof s=="string"?n[o]=s:n[o]=Kg(s,i)}return n}}/** @license See the LICENSE file. */const ck="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const C9=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Bs extends It{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const x=this.getClassName().toLowerCase();this.name=Ap(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],gr(this.inputs).length!==this.inputs.length)throw new G(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);gr(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const x of this.outputs){const b=x.sourceLayer,w=x.nodeIndex,y=x.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(y)}for(const x of this.inputs){const b=x.sourceLayer,w=x.nodeIndex,y=x.tensorIndex;lo(w===0,"input layer has >1 nodes"),lo(y===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(y)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){const b=this.inputLayers[x];if(!(b instanceof md))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${x} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(const x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);const n={},i={},s={},o={},r={},a=[],l=(x,b,w,y,C,I)=>{(y==null||C==null||I==null)&&(y=x.sourceLayer,C=x.nodeIndex,I=x.tensorIndex);const $=y.inboundNodes[C];if(w.indexOf($)!==-1)throw new Es(`The tensor ${x.name} at layer "${y.name}" is part of a cycle.`);if(b.indexOf($)!==-1)return;this.containerNodes.add(Bs.nodeKey(y,C)),y.id in r||(r[y.id]=Object.keys(r).length),w.indexOf($)===-1&&w.push($);const E=$.inboundLayers.length;for(let N=0;N<E;N++){const k=$.inputTensors[N],D=$.inboundLayers[N],_=$.nodeIndices[N],R=$.tensorIndices[N];l(k,b,w,D,_,R)}for(b.push($);w.indexOf($)>=0;)w.splice(w.indexOf($),1);a.push($)},c=[],u=[];for(const x of this.outputs)l(x,c,u);const d=a.slice().reverse();for(const x of d){i[x.id]=x,x.id in n||(n[x.id]=0);let b=n[x.id];const w=s[x.outboundLayer.id]==null?0:s[x.outboundLayer.id];b=Math.max(b,w),s[x.outboundLayer.id]=b,o[x.outboundLayer.id]=x.outboundLayer,n[x.id]=b;for(let y=0;y<x.inboundLayers.length;y++){const C=x.inboundLayers[y],I=x.nodeIndices[y],$=C.inboundNodes[I],E=n[$.id]==null?0:n[$.id];n[$.id]=Math.max(b+1,E),i[$.id]=$}}const f={};for(const x in n){const b=n[x];b in f||(f[b]=[]),f[b].push(i[x])}const h={};for(const x in s){const b=s[x];b in h||(h[b]=[]),h[b].push(o[x])}let p=Object.keys(h).map(x=>parseInt(x,10)).sort(Bd);this.layers=[];for(const x of p){const b=h[x];b.sort((w,y)=>{const C=r[w.id],I=r[y.id];return C<I?-1:C>I?1:0});for(const w of b)w instanceof Bs&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=h,p=Object.keys(f).map(x=>parseInt(x,10)).sort(Bd);const m=this.inputs.slice(),g=[];for(const x of p)for(const b of f[x]){const w=b.outboundLayer;if(w!=null){for(const y of b.inputTensors)if(m.indexOf(y)===-1)throw new Es(`Graph disconnected: cannot obtain value for tensor ${y} at layer "${w.name}". The following previous layers were accessed without issue: ${g}`);for(const y of b.outputTensors)m.push(y);g.push(w.name)}}this.nodesByDepth=f;const v=this.layers.map(x=>x.name);for(const x of v){const b=v.filter(w=>w===x).length;if(b!==1)throw new Es(`The name "${x}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new Pp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(i=>i.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new G("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const i of this.layers)n.push(...i.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const i={};let s=0;const o=C9(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=o?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(i[u]!=null)throw new G(`Duplicate weight name: ${u}`);i[u]=c,s++}const r=[];for(const a in e){let l=a;if(i[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(i[l]!=null)r.push([i[l],e[a]]);else if(n)throw new G(`Provided weight data has no target variable: ${a}`);delete i[l]}if(n){const a=[];for(const l in i)a.push(l);if(a.length>0)throw new G(`${a.length} of ${s} weights are not set: ${a}`)}Rb(r)}parseWeights(e){for(const n in Object.keys(e)){const i=n.split("/"),s=["vars","layer_checkpoint_dependencies"],o=i.map(r=>r.startsWith("_")?r.slice(1):r).filter(r=>!s.includes(r)).join("/");o!==n&&(e[o]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${ck}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const i=Kg(this.updatedConfig());return n?JSON.stringify(i):i}call(e,n){return ie(()=>{e=Gt(e);const i=new dr;for(let s=0;s<this.inputs.length;++s)i.add(this.inputs[s],e[s]);return Cc(this.outputs,i,n)})}computeMask(e,n){return ie(()=>{e=Gt(e);let i;return n==null?i=Ia(null,e.length):i=Gt(n),this.runInternalGraph(e,i)[1]})}computeOutputShape(e){const n=Mh(e);if(n.length!==this.inputLayers.length)throw new G(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const i={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],u=l.name+"_0_0";i[u]=c}const s=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Bd);if(s.length>1)for(const a of s){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;const d=[];for(let m=0;m<c.inboundLayers.length;m++){const g=c.inboundLayers[m],v=c.nodeIndices[m],x=c.tensorIndices[m],b=`${g.name}_${v}_${x}`,w=i[b];d.push(w)}const f=u.computeOutputShape(Ai(d)),h=Mh(f),p=u.inboundNodes.indexOf(c);for(let m=0;m<h.length;m++){const g=`${u.name}_${p}_${m}`;i[g]=h[m]}}}const o=[],r=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;r.push(d)}for(let a=0;a<r.length;a++){const l=r[a];lo(l in i),o.push(i[l])}return Ai(o)}runInternalGraph(e,n){n==null&&(n=Ia(null,e.length));const i={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=n[l];i[c.id]=[u,d]}const s=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Bd);for(const l of s){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,f=u.inputTensors,h=u.outputTensors,p=new Array;for(const m of f)m.id in i&&p.push(i[m.id]);if(p.length===f.length){let m={},g,v,x,b;if(u.callArgs!=null&&(m=u.callArgs),p.length===1){const[w,y]=p[0];m.mask==null&&(m.mask=y),x=Gt(d.call(w,m)),b=Gt(d.computeMask(w,y)),g=[w],v=[y]}else g=p.map(w=>w[0]),v=p.map(w=>w[1]),m.mask==null&&(m.mask=v),x=Gt(d.call(g,m)),b=Gt(d.computeMask(g,v));if(d.activityRegularizer)throw new xt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<h.length;++w){const y=h[w],C=x[w],I=b[w];i[y.id]=[C,I]}}}}const o=[],r=[],a=[];for(const l of this.outputs){lo(l.id in i,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=i[l.id];a.push(c.shape),o.push(c),r.push(u)}return[o,r,a]}buildNodeConversionMap(e){const n={};let i;for(const s of this.layers){i=s instanceof Bs?1:0;for(let o=0;o<s.inboundNodes.length;o++){const r=Bs.nodeKey(s,o);this.containerNodes.has(r)&&(n[r]=i,i+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new G("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const i of this.layers)if(i.name===e)return i;throw new G(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new G(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ie(()=>{const e=[];for(const n of this.layers)for(let i=0;i<n.inboundNodes.length;++i){const s=Bs.nodeKey(n,i);this.containerNodes.has(s)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),i=[];for(const r of this.layers){const a=r.getClassName(),l=r.getConfig(),c=[];for(let d=0;d<r.inboundNodes.length;d++){const f=r.inboundNodes[d],h=Bs.nodeKey(r,d);let p={};if(this.containerNodes.has(h)){if(f.callArgs)try{JSON.stringify(f.callArgs),p=f.callArgs}catch{console.warn(`Layer ${r.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(f.inboundLayers.length>0){const m=[];for(let g=0;g<f.inboundLayers.length;g++){const v=f.inboundLayers[g],x=f.nodeIndices[g],b=f.tensorIndices[g],w=Bs.nodeKey(v,x);let y=n[w];y==null&&(y=0),m.push([v.name,y,b,p])}c.push(m)}}}const u={};u.name=r.name,u.className=a,u.config=l,u.inboundNodes=c,i.push(u)}e.layers=i;const s=[];for(let r=0;r<this.inputLayers.length;r++){const a=this.inputLayers[r],l=this.inputLayersNodeIndices[r],c=Bs.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[r];s.push([a.name,u,d])}e.inputLayers=s;const o=[];for(let r=0;r<this.outputLayers.length;r++){const a=this.outputLayers[r],l=this.outputLayersNodeIndices[r],c=Bs.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[r];o.push([a.name,u,d])}return e.outputLayers=o,e}static fromConfig(e,n,i={},s=!1){const o={},r={};function a(g,v){g.name in r?r[g.name].push(v):r[g.name]=[v]}function l(g,v){const x=[];let b;for(const w of v){const y=w[0],C=w[1],I=w[2];if(b=w[3]==null?{}:w[3],!(y in o)){a(g,v);return}const $=o[y];if($.inboundNodes.length<=C){a(g,v);return}const E=$.inboundNodes[C];x.push(E.outputTensors[I])}x.length>0&&g.apply(Ai(x),b)}function c(g){const v=g.name,x=yo(g,n.customObjects!=null?n.customObjects:{});x.setFastWeightInitDuringBuild(s),o[v]=x,g.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new G(`Corrupted configuration, expected array for nodeData: ${w}`);a(x,w)})}const u=n.name,d=n.layers;for(const g of d)c(g);for(;!rq(r);)for(const g of d){const v=o[g.name];if(v.name in r){const x=r[v.name];delete r[v.name];for(const b of x)l(v,b)}}const f=[],h=[],p=n.inputLayers;for(const g of p){const v=g[0],x=g[1],b=g[2];lo(v in o);const y=o[v].inboundNodes[x].outputTensors;f.push(y[b])}const m=n.outputLayers;for(const g of m){const v=g[0],x=g[1],b=g[2];lo(v in o);const y=o[v].inboundNodes[x].outputTensors;h.push(y[b])}return new e({inputs:f,outputs:h,name:u})}get stateful(){if(this._stateful)throw new G("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ie(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function S9(t,e,n){const i=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>null);if(i===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==i)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const s=[];return e.forEach(o=>{o in t?s.push(t[o]):s.push(null)}),s}else throw new Error(`The model has multiple (${i}) outputs, so ${n} must be either an array with ${i} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function uk(t,e){return S9(t,e,"classWeight")}async function dk(t,e,n,i){if(n!=null){const s=ie(()=>{if(t.shape.length===1)return la(t);if(t.shape.length===2){if(t.shape[1]>1)return Wc(t,1);if(t.shape[1]===1)return Z(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await s.data());bt(s);const r=[];return o.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);r.push(n[a])}),Ui(r,"float32")}else return null}function I9(t,e){return U(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $9=32;function hk(t,e){let n,i;const s=e;n=s.xs,i=s.ys,F(n!=null&&i!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=QC("input",t.inputNames,n),r=QC("output",t.outputNames,i),a=o[0].shape[0];F(o.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),F(r.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${r.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<o.length;l++)F(o[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<r.length;l++)F(r[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${r[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:o,ys:r}}function QC(t,e,n){if(n instanceof Mn)return[n];if(Array.isArray(n))return F(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const i=[];for(const s of e){if(n[s]==null)throw new G(`The feature data generated by the dataset lacks the required ${t} key '${s}'.`);i.push(n[s])}return i}}function E9(t){if(t.length===3)throw new xt("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function N9(t,e,n){const i=n.batchesPerEpoch!=null;if(F(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),F(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),F(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),F(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),F(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const s=n.validationData!=null;let o,r;if(s)if(eS(n.validationData))F(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=E9(n.validationData);o=g.xs,r=g.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;s?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();const u=tk(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:f,history:h}=nk(u,d,n.epochs,null,null,k9(e,n),null,s,c);f.setModel(t),t.history=h,await f.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const g={};await f.onEpochBegin(p);let v=0,x=0;for(i||(m=await e.iterator());!i||v<n.batchesPerEpoch;){const b=await m.next();if(i&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){const{xs:w,ys:y}=hk(t,b.value),C={};C.batch=x,C.size=w[0].shape[0],await f.onBatchBegin(x,C);const I=[];if(n.classWeight!=null){const N=uk(n.classWeight,t.outputNames);for(let k=0;k<N.length;++k)I.push(await dk(y[k],null,N[k]))}const $=w.concat(y).concat(I),E=a($);bt($);for(let N=0;N<l.length;++N){const k=l[N],D=E[N];C[k]=D,go(D)}await f.onBatchEnd(x,C),ek(C),x++,v++}if(i?v>=n.batchesPerEpoch:b.done){if(s){let w;eS(n.validationData)?w=Gt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):w=Gt(t.evaluate(o,r,{batchSize:n.validationBatchSize==null?$9:n.validationBatchSize,verbose:0}));for(let y=0;y<t.metricsNames.length;++y)g[`val_${t.metricsNames[y]}`]=w[y]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(p,g),p++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function k9(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function eS(t){return typeof t.iterator=="function"}function D9(t){return typeof t.next=="function"}async function T9(t,e,n){n=n||{};const i=n.batches!=null,s=t.testFunction;let o=[];if(n.verbose>0)throw new xt("Verbose mode is not implemented yet.");F(!i||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const r=D9(e)?e:await e.iterator();let a=0,l=0;for(;!i||l<n.batches;){const c=await r.next();if(o=ie(()=>{if(c.value){const{xs:u,ys:d}=hk(t,c.value),f=u.concat(d),h=ie(()=>s(f));if(bt(f),l===0)for(let m=0;m<h.length;++m)o.push(Vt(0));const p=f[0].shape[0];for(let m=0;m<h.length;++m){const g=h[m],v=o[m];o[m]=ie(()=>Se(o[m],U(p,g))),l>0&&bt(v)}bt(h),a+=p,++l}return o}),c.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<o.length;++c){const u=o[c];o[c]=nt(o[c],a),bt(u)}return Ai(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dm(t){F(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function xc(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(i=>ua(i,e,n-e)):ua(t,e,n-e)}function Xg(t,e){return ie(()=>t==null?null:Array.isArray(t)?t.map(n=>Xg(n,e)):BN(t,e.dtype==="int32"?e:Fe(e,"int32")))}function Tm(t,e){const n=[];let i=0,s=null;for(;i<t;)s=i+e,s>=t&&(s=t),n.push([i,s]),i=s;return n}function fk(t){const e=[];t instanceof Mn&&(t=[t]);for(let n=0;n<t.length;++n){const i=t[n];if(i.rank===1)e.push(hd(i,1));else{if(i.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(i)}}return e}function zs(t,e){if(t==null)return;const n=[];if(e instanceof Mn)n.push(e.id);else if(Array.isArray(e))e.forEach(s=>n.push(s.id));else if(e!=null)for(const s in e){const o=e[s];n.push(o.id)}const i=[];if(t instanceof Mn)n.indexOf(t.id)===-1&&i.push(t);else if(Array.isArray(t))t.forEach(s=>{n.indexOf(s.id)===-1&&i.push(s)});else if(t!=null)for(const s in t){const o=t[s];n.indexOf(o.id)===-1&&i.push(o)}i.forEach(s=>{s.isDisposed||s.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function R9(t){return t instanceof Mn}function qg(t){return Array.isArray(t)}function tS(t){return!R9(t)&&!qg(t)}function nS(t,e,n,i=!0,s=""){if(e==null||e.length===0){if(t!=null){let r=!1;if(qg(t)&&t.length>0)r=!0;else if(tS(t)){for(const a in t)if(t.hasOwnProperty(a)){r=!0;break}}else r=!0;if(r)throw new G(`Error when checking model ${s} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(r=>null);let o;if(tS(t)){t=t,o=[];for(const r of e){if(t[r]==null)throw new G(`No data provided for "${r}". Need data for each key in: ${e}`);o.push(t[r])}}else if(qg(t)){if(t=t,t.length!==e.length)throw new G(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);o=t}else{if(t=t,e.length>1)throw new G(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);o=[t]}if(o=fk(o),n!=null)for(let r=0;r<e.length;++r){if(n[r]==null)continue;const a=o[r];if(a.shape.length!==n[r].length)throw new G(`Error when checking ${s}: expected ${e[r]} to have ${n[r].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[r].length;++l){if(l===0&&!i)continue;const c=a.shape[l],u=n[r][l];if(u!=null&&u>=0&&c!==u)throw new G(`${s} expected a batch of elements where each example has shape [${n[r].slice(1,n[r].length)}] (i.e.,tensor shape [*,${n[r].slice(1,n[r].length)}]) but the ${s} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function _9(t,e,n){const i=gr(t.map(o=>o.shape[0]));i.sort();const s=gr(e.map(o=>o.shape[0]));if(s.sort(),i.length>1)throw new G(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(s.length>1)throw new G(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(i.length>0&&s.length>0&&!Wt(i,s))throw new G(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${s[0]} target sample(s).`)}function A9(t,e,n){const i=[Mp,Fp,Xc];for(let s=0;s<t.length;++s){const o=t[s],r=e[s],a=n[s];if(r!=null){if(r===Xc&&o.shape[o.shape.length-1]===1)throw new G(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(i.indexOf(r)!==-1){const l=o.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],f=c[u];if(f!=null&&d!==f)throw new G(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function iS(t,e,n,i=!0,s=""){let o;if(Array.isArray(t)){if(t.length!==e.length)throw new G(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);o=t}else{if(e.length>1)throw new G(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);o=[t]}if(n!=null)for(let r=0;r<e.length;++r){if(n[r]==null)continue;const a=o[r];if(a.shape.length!==n[r].length)throw new G(`Error when checking ${s}: expected ${e[r]} to have ${n[r].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[r].length;++l){if(l===0&&!i)continue;const c=a.shape[l],u=n[r][l];if(u!=null&&u!==c)throw new G(`Error when checking ${s}: expected ${e[r]} to have shape ${JSON.stringify(n[r])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function O9(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(i=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(i=>n);{const i=[];for(const s of e){let o=n.hasOwnProperty(s)?n[s]:[];Array.isArray(o)||(o=[o]),i.push(o)}return i}}const P9="layers-model";class hl extends Bs{constructor(e){super(e),this.isTraining=!1}summary(e,n,i=console.log){if(!this.built)throw new G("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");v9(this,e,n,i)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=g9(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Mr))throw new G("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const r in e.loss)if(this.outputNames.indexOf(r)===-1)throw new G(`Unknown entry in loss dictionary: "${r}". Only expected the following keys: ${this.outputNames}`);for(const r of this.outputNames)e.loss[r]==null&&console.warn(`Output "${r}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${r} during training`),n.push(km(e.loss[r]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new G(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>km(a))}else{const r=km(e.loss);this.outputs.forEach(a=>{n.push(r)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let r=0;r<this.outputs.length;++r){const a=this.internalOutputShapes[r],l=this.outputNames[r];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[r])}const i=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ca("loss",()=>{for(let r=0;r<this.outputs.length;++r){if(i.indexOf(r)!==-1)continue;const a=this.lossFunctions[r];this.outputs.length>1&&(this.metricsTensors.push([a,r]),this.metricsNames.push(this.outputNames[r]+"_loss"))}});const s=O9(e.metrics,this.outputNames),o=(r,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[r]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,r])};ca("metric",()=>{for(let r=0;r<this.outputs.length;++r){if(i.indexOf(r)!==-1)continue;const a=s[r];(c=>{const u="";let d,f,h;for(const p of c){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[r];g[g.length-1]===1||this.lossFunctions[r]===Fp?["accuracy","acc"].indexOf(p)!==-1?f=sk:["crossentropy","ce"].indexOf(p)!==-1&&(f=r9):this.lossFunctions[r]===Vh?["accuracy","acc"].indexOf(p)!==-1?f=a9:["crossentropy","ce"].indexOf(p)!==-1&&(f=ak):["accuracy","acc"].indexOf(p)!==-1?f=ok:["crossentropy","ce"].indexOf(p)!==-1&&(f=rk);let v;["accuracy","acc"].indexOf(p)!==-1?v="acc":["crossentropy","ce"].indexOf(p)!==-1&&(v="ce"),h=f,d=u+v}else h=m9(p),d=u+Gd(p);let m;ca(d,()=>{m=h}),o(r,d,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,i={}){const s=i.batchSize==null?32:i.batchSize;Dm(s);const r=this.standardizeUserDataXY(e,n,!0,s);try{const a=r[0].concat(r[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,s,i.verbose,i.steps);return Ai(c)}finally{zs(r[0],e),zs(r[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),T9(this,e,n)}checkNumSamples(e,n,i,s="steps"){let o;if(i!=null){if(o=null,n!=null)throw new G(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new G(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return o}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new G("`outputs` is an empty Array, which is not allowed.");const i=Array.isArray(n),s=i?n:[n],o=this.retrieveSymbolicTensors(s),r=new dr;if(e instanceof Mn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new G(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)r.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new G(`No value is provided for the model's input ${l.name}`);r.add(l,c)}const a=Cc(o,r);return i?a:a[0]}retrieveSymbolicTensors(e){const n=Ia(null,e.length);let i=e.length;for(const s of this.layers){const o=Array.isArray(s.output)?s.output:[s.output],r=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=r.indexOf(e[a]);if(l!==-1&&(n[a]=o[l],i--),i===0)break}if(i===0)break}if(i>0){const s=[];throw n.forEach((o,r)=>{o==null&&s.push(e[r])}),new G(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return n}predictLoop(e,n=32,i=!1){return ie(()=>{const s=this.checkNumSamples(e);if(i)throw new xt("Verbose predictLoop() is not implemented yet.");const o=Tm(s,n),r=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ie(()=>{const c=o[a][0],u=o[a][1],d=xc(e,c,u),f=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)f.push({key:this.inputs[p],value:d[p]});else f.push({key:this.inputs[0],value:d});const h=new dr(f);return Cc(this.outputs,h)}).forEach((c,u)=>r[u].push(c));return Ai(r.map(a=>Mi(a,0)))})}predict(e,n={}){const i=fk(e);iS(i,this.inputNames,this.feedInputShapes,!1);try{const s=n.batchSize==null?32:n.batchSize;return Dm(s),this.predictLoop(i,s)}finally{zs(i,e)}}predictOnBatch(e){iS(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,i=!0,s){if(this.optimizer_==null)throw new Es("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let r=0;r<this.feedOutputShapes.length;++r){const a=this.feedOutputShapes[r];this.feedLossFns[r]===Vh?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=nS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=nS(n,this.feedOutputNames,o,!1,"target"),_9(e,n),A9(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new G(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,i,s,o=!0,r){const[a,l]=this.standardizeUserDataXY(e,n,o,r);if(i!=null)throw new Error("sample weight is not supported yet.");let c=null;if(s!=null){const u=uk(s,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await dk(l[d],null,u[d]))}return[a,l,c]}testLoop(e,n,i,s=0,o){return ie(()=>{const r=this.checkNumSamples(n,i,o,"steps"),a=[];if(s>0)throw new xt("Verbose mode is not implemented yet.");if(o!=null)throw new xt("steps mode in testLoop() is not implemented yet");{const l=Tm(r,i),c=Ui(Ks(0,r));for(let u=0;u<l.length;++u){const d=l[u][0],f=l[u][1],h=ua(c,d,f-d),p=Xg(n,h),m=e(p);if(u===0)for(let g=0;g<m.length;++g)a.push(Vt(0));for(let g=0;g<m.length;++g){const v=m[g];a[g]=Se(a[g],U(f-d,v))}}for(let u=0;u<a.length;++u)a[u]=nt(a[u],r)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let i=0;i<e.length;++i){const s=e[i];let o=s;if(VC(e,s)>1){const r=VC(e.slice(0,i),s);o+=`_${r}`}n.push(o)}return n}makeTrainFunction(){return e=>{const n=[],i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),r=[],a=()=>{const d=[];for(let m=0;m<this.inputs.length;++m)d.push({key:this.inputs[m],value:i[m]});const f=new dr(d),h=Cc(this.outputs,f,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let v=g(s[m],h[m]);o[m]!=null&&(v=I9(v,o[m]));const x=Tn(v);n.push(x),m===0?p=v:p=Se(p,v)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const v=this.metricsTensors[m][0],x=this.metricsTensors[m][1];g=Tn(v(s[x],h[x]))}go(g),r.push(g)}return p=Tn(p),this.calculateLosses().forEach(m=>{p=Se(p,m)}),p},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(r)}}makeTestFunction(){this.testFunction=e=>ie(()=>{const n=[];let i;const s=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=[];for(let c=0;c<this.inputs.length;++c)r.push({key:this.inputs[c],value:s[c]});const a=new dr(r),l=Cc(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=Tn(u(o[c],l[c]));c===0?i=d:i=Se(i,d),n.push(i)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],f=Tn(u(o[d],l[d]));n.push(f)}return n})}async fit(e,n,i={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,o,r,a,l,c,u,d,f;try{const h=i.batchSize==null?32:i.batchSize;Dm(h);const m=await this.standardizeUserData(e,n,i.sampleWeight,i.classWeight,!1,h);s=m[0],o=m[1],f=m[2];let g=!1,v;if(i.validationData!=null&&i.validationData.length>0){if(g=!0,i.validationData.length===2)l=i.validationData[0],c=i.validationData[1];else throw i.validationData.length===3?new xt("validationData including sample weights is not supported yet."):new G(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${i.validationData} is invalid.`);const N=await this.standardizeUserData(l,c,null,null,!0,h);u=N[0],d=N[1],v=u.concat(d)}else if(i.validationSplit!=null&&i.validationSplit>0&&i.validationSplit<1){g=!0;const E=Math.floor(s[0].shape[0]*(1-i.validationSplit)),N=s[0].shape[0];u=xc(s,E,N),r=s,s=xc(s,0,E),d=xc(o,E,N),a=o,o=xc(o,0,E),v=u.concat(d)}else i.validationSteps!=null&&(g=!0);const x=s.concat(o).concat(f);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let y,C;g?(this.makeTestFunction(),y=this.testFunction,C=w.slice().concat(w.map(E=>"val_"+E))):(y=null,v=[],C=w.slice());const I=tk(i.callbacks,i.yieldEvery);return await this.fitLoop(b,x,w,h,i.epochs,i.verbose,I,y,v,i.shuffle,C,i.initialEpoch,null,null)}finally{this.isTraining=!1,zs(s,e),zs(o,n),zs(r,e),zs(a,n),zs(u,l),zs(d,c),f!=null&&bt(f)}}async fitLoop(e,n,i,s,o,r,a,l,c,u,d,f,h,p){s==null&&(s=32),o==null&&(o=1),u==null&&(u=!0),f==null&&(f=0);let m=!1;if(l!=null&&c!=null&&(m=!0),p!=null&&(m=!0,h==null))throw new G("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(n,s,h,"steps_per_epoch");let v;g!=null&&(v=Ks(0,g)),r==null&&(r=1);const{callbackList:x,history:b}=nk(a,r,o,f,g,h,s,m,d);x.setModel(this),this.history=b,await x.onTrainBegin(),this.stopTraining_=!1;for(let w=f;w<o;++w){await x.onEpochBegin(w);const y={};if(h!=null)throw new xt("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new xt("batch shuffling is not implemneted yet");u&&rH(v);const C=Ui(v),I=Tm(g,s);for(let $=0;$<I.length;++$){const E={};if(await x.onBatchBegin($,E),ie(()=>{const N=I[$][0],k=I[$][1],D=ua(C,N,k-N);E.batch=$,E.size=k-N;const _=Xg(n,D),R=e(_);for(let T=0;T<i.length;++T){const A=i[T],O=R[T];E[A]=O,go(O)}if($===I.length-1&&m){const T=this.testLoop(l,c,s);for(let A=0;A<i.length;++A){const O=i[A],P=T[A];go(P),y["val_"+O]=P}}}),await x.onBatchEnd($,E),ek(E),this.stopTraining_)break}C.dispose()}if(await x.onEpochEnd(w,y),this.stopTraining_)break}return await x.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return N9(this,e,n)}async trainOnBatch(e,n){const i=await this.standardizeUserData(e,n),s=i[0],o=i[1],a=this.makeTrainFunction()(s.concat(o)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return bt(a),zs(i[0],e),zs(i[1],n),Ai(l)}getNamedWeights(e){const n=[],i=e!=null&&e.trainableOnly,s=i?this.trainableWeights:this.weights,o=this.getWeights(i);for(let r=0;r<s.length;++r)i&&!s[r].trainable||n.push({name:s[r].originalName,tensor:o[r]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=wC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-wC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ao(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Ao(n))}else{const n=Object.keys(this.loss);e={};const i=this.loss;for(const s of n)if(typeof i[s]=="string")e[s]=Ao(i[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ao(Gd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ao(Gd(e)));{const e={};for(const n in this.metrics)e[n]=Ao(Gd(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Uh(e.optimizer_config),i=yo(n);let s;if(typeof e.loss=="string")s=Yr(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(r=>Yr(r));else if(e.loss!=null){s={};for(const r in e.loss)s[r]=Yr(e.loss[r])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(r=>Yr(r));else if(e.metrics!=null){o={};for(const r in e.metrics)o[r]=Yr(e.metrics[r])}this.compile({loss:s,metrics:o,optimizer:i})}async save(e,n){if(typeof e=="string"){const c=hU(e);if(c.length===0)throw new G(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new G(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new G("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const i=await CC(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:P9,generatedBy:`TensorFlow.js tfjs-layers v${ck}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await CC(await this.optimizer.getWeights(),c);i.specs.push(...d),i.data=sU([i.data,u])}return this.userDefinedMetadata!=null&&(ZC(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=i.data,a.weightSpecs=i.specs,e.save(a)}setUserDefinedMetadata(e){ZC(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}hl.className="Model";Ce(hl);class pk extends hl{}pk.className="Functional";Ce(pk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function mk(t,e){if(e==null&&(e={}),typeof t=="string"){const n=fU(t,e);if(n.length===0)n.push(G8(t,e));else if(n.length>1)throw new G(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return M9(t,void 0,e)}async function M9(t,e,n){if(n==null&&(n={}),t.load==null)throw new G("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const i=await t.load();let s=i.modelTopology;s.model_config!=null&&(s=s.model_config);const o=n.strict==null?!0:n.strict,r=i.weightData!=null&&i.weightSpecs!=null&&o,a=yo(Uh(s),e,r),l=i.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),i.userDefinedMetadata!=null&&a.setUserDefinedMetadata(i.userDefinedMetadata),i.weightData!=null){if(i.weightSpecs==null)throw new G("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=F9(i.weightData,i.weightSpecs);a.loadWeights(c,o),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),bt(c),bt(u.map(d=>d.tensor))}return a}function F9(t,e){const n=ZH(t,e),i={},s=[];return e.forEach(o=>{o.group==="optimizer"?s.push({name:o.name,tensor:n[o.name]}):i[o.name]=n[o.name]}),{modelWeights:i,optimizerWeights:s}}class Ml extends hl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Ap("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(i=>i<0))throw new G(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof Ml||e instanceof hl;let i;if(n){if(i=e,i.outputs.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(i.inputs.length!==1)throw new G("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new G("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=Fq({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(n)this.outputs=i.outputs,this.inputs=i.inputs;else{if(e.inboundNodes.length!==1)throw new G(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=qN(this.outputs[0])}this.inboundNodes=[],new Pp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ia(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(Lt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new hl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,i=console.log){this.built||this.build(),super.summary(e,n,i)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,i={}){if(!this.built)throw new Es("The model needs to be compiled before being used.");return this.model.evaluate(e,n,i)}async evaluateDataset(e,n){if(!this.built)throw new Es("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,i={}){if(!this.built)throw new Es("The model needs to be compiled before being used.");return this.model.fit(e,n,i)}async fitDataset(e,n){if(!this.built)throw new Es("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,i={},s=!1){let o,r={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new G("Legacy serialization format not supported yet.");o=n}else F(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=n.layers,delete n.layers,r=n;const a=new e(r);if(!(a instanceof Ml))throw new xt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const u=yo(l,void 0,s);s&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new G("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new G("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const i={};i.className=n.getClassName(),i.config=n.getConfig(),e.push(i)}return{name:this.name,layers:e}}}Ml.className="Sequential";Ce(Ml);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function L9(t){return new Ml(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let mi=class extends nc{getConfig(){return{}}};class gk extends mi{apply(e,n=1){return wq(e,n)}}gk.className="elu";Ce(gk);class vk extends mi{apply(e){return R2(e)}}vk.className="selu";Ce(vk);class xk extends mi{apply(e){return Fa(e)}}xk.className="relu";Ce(xk);class bk extends mi{apply(e){return ie(()=>Uc(6,Fa(e)))}}bk.className="relu6";Ce(bk);class yk extends mi{apply(e){return e}}yk.className="linear";Ce(yk);class wk extends mi{apply(e){return Ql(e)}}wk.className="sigmoid";Ce(wk);class Ck extends mi{apply(e){return Sq(e)}}Ck.className="hardSigmoid";Ce(Ck);class Sk extends mi{apply(e){return sd(e)}}Sk.className="softplus";Ce(Sk);class Ik extends mi{apply(e){return Cq(e)}}Ik.className="softsign";Ce(Ik);class $k extends mi{apply(e){return Sp(e)}}$k.className="tanh";Ce($k);let Pb=class extends mi{apply(e,n=-1){return F0(e,n)}};Pb.className="softmax";Ce(Pb);class Ek extends mi{apply(e,n=-1){return w2(e,n)}}Ek.className="logSoftmax";Ce(Ek);class Nk extends mi{apply(e){return ie(()=>ie(()=>{const n=Math.sqrt(2),i=U(.5,Se(1,g2(nt(e,n))));return U(e,i)}))}}Nk.className="gelu";Ce(Nk);class kk extends mi{apply(e){return ie(()=>U(.5,U(e,Se(1,Sp(U(fi(nt(2,Math.PI)),Se(e,U(.044715,wa(e,3)))))))))}}kk.className="gelu_new";Ce(kk);class Dk extends mi{apply(e){return ie(()=>U(e,Sp(sd(e))))}}Dk.className="mish";Ce(Dk);class Tk extends mi{apply(e,n=1){return ie(()=>U(Ql(U(e,n)),e))}}Tk.className="swish";Ce(Tk);function Ir(t){return t.getClassName()}function Rm(t,e={}){return dd(t,Cs.getMap().classNameMap,e,"activation")}function $r(t){if(t==null){const e={};return e.className="linear",e.config={},Rm(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Rm(e)}else return t instanceof mi?t:Rm(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function z9(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class Rk extends nc{}class _k extends Rk{constructor(e){super(),z9(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ie(()=>{let n=Xn([1]);return this.hasL1&&(n=Se(n,Qe(U(this.l1,xi(e))))),this.hasL2&&(n=Se(n,Qe(U(this.l2,fd(e))))),Z(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}_k.className="L1L2";Ce(_k);const sS={l1l2:"L1L2"};function Jt(t){return wb(t)}function oS(t,e={}){return dd(t,Cs.getMap().classNameMap,e,"regularizer")}function cn(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in sS?sS[t]:t,config:{}};return oS(n)}else return t instanceof Rk?t:oS(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ak extends It{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=at(e);let i=Fa(e);return this.maxValue!=null&&(i=ls(i,0,this.maxValue)),i}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}Ak.className="ReLU";Ce(Ak);class Ok extends It{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const i=at(e);return w0(i,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}Ok.className="LeakyReLU";Ce(Ok);class Pk extends It{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=ln(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=cn(e.alphaRegularizer),this.alphaConstraint=Bn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new G(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Lt(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)n[s-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const i={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)i[s]=e[s];this.inputSpec=[new Ln({ndim:e.length,axes:i})],this.built=!0}call(e,n){return e=at(e),N0(e,this.alpha.read())}getConfig(){const e={alphaInitializer:pn(this.alphaInitializer),alphaRegularizer:Jt(this.alphaRegularizer),alphaConstraint:zn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}Pk.className="PReLU";Ce(Pk);let Mk=class extends It{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new xt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const i=at(e);return Ep(i)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};Mk.className="ELU";Ce(Mk);class Fk extends It{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const i=at(e);return U(i,Fe(cs(i,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}Fk.className="ThresholdedReLU";Ce(Fk);class Lk extends It{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Pb().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return ie(()=>{let i=at(e);const s=n.mask;if(s!=null){const o=U(rt(Pr(i.shape),Fe(s,i.dtype)),Vt(-1e9));i=Se(i,o)}return this.axis instanceof Array?this.axis.length>1?Io(rt(i,C2(i,this.axis,!0))):this.softmax(i,this.axis[0]):this.softmax(i,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}Lk.className="Softmax";Ce(Lk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fl(t,e,n){if(typeof t=="number")return Ia(t,e);if(t.length!==e)throw new G(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let i=0;i<e;++i){const s=t[i];if(!vq(s))throw new G(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${s}`)}return t}function js(t,e,n,i,s=1){if(t==null)return t;const o=e+(e-1)*(s-1);let r;return n==="same"?r=t:r=t-o+1,Math.floor((r+i-1)/i)}function co(t,e,n,i){if(t==null)return null;if(i==="valid")t=t*e+Sr([n-e,0]);else if(i==="same")t=t*e;else throw new G(`Unsupport padding mode: ${i}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mb(t,e){return ie(()=>(kn(e),e==="channelsFirst"?_t(t,[0,2,3,1]):t))}function zk(t,e){return ie(()=>(kn(e),e==="channelsFirst"?_t(t,[0,2,3,4,1]):t))}function B9(t,e,n,i=1,s="valid",o,r=1){return ie(()=>{if(o==null&&(o=Xs()),kn(o),t.shape.length!==3)throw new G(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new G(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new G(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(o==="channelsFirst"&&(t=_t(t,[0,2,1])),s==="causal")throw new xt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=d2(t,e,i,s==="same"?"same":"valid","NWC",r);return n!=null&&(a=Zs(a,n)),a})}function rS(t,e,n,i=[1,1],s="valid",o,r,a=null){return ie(()=>{if(o==null&&(o=Xs()),kn(o),t.rank!==3&&t.rank!==4)throw new G(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new G(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Mb(t,o);if(s==="causal")throw new xt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=B5({x:l,filter:e,strides:i,pad:s==="same"?"same":"valid",dilations:r,dataFormat:"NHWC",bias:n,activation:a}),o==="channelsFirst"&&(l=_t(l,[0,3,1,2])),l})}function V9(t,e,n,i=[1,1,1],s="valid",o,r){return ie(()=>{if(o==null&&(o=Xs()),kn(o),t.rank!==4&&t.rank!==5)throw new G(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new G(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=zk(t,o);if(s==="causal")throw new xt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=G6(a,e,i,s==="same"?"same":"valid","NDHWC",r),n!=null&&(a=Zs(a,n)),o==="channelsFirst"&&(a=_t(a,[0,4,1,2,3])),a})}class Lp extends It{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Lp.verifyArgs(n),this.rank=e,qn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new xt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=fl(n.kernelSize,e,"kernelSize"),this.strides=fl(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,us(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,kn(this.dataFormat),this.activation=$r(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=ln(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Bn(n.biasConstraint),this.biasRegularizer=cn(n.biasRegularizer),this.activityRegularizer=cn(n.activityRegularizer),this.dilationRate=fl(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new G(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new G(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new G(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(lo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Cb(e.kernelSize,"number",1,3))throw new G(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ir(this.activation),useBias:this.useBias,biasInitializer:pn(this.biasInitializer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),biasConstraint:zn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class ic extends Lp{constructor(e,n){super(e,n),this.kernel=null,ic.verifyArgs(n),this.filters=n.filters,qn(this.filters,"filters"),this.kernelInitializer=ln(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Bn(n.kernelConstraint),this.kernelRegularizer=cn(n.kernelRegularizer)}build(e){e=Lt(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[n]}`);const i=e[n],s=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:i}}],this.built=!0}call(e,n){return ie(()=>{e=at(e);let i;const s=this.bias==null?null:this.bias.read(),o=ON(this.activation.getClassName());if(o!=null&&this.rank===2)i=rS(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)i=B9(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)i=rS(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)i=V9(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new xt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(i=this.activation.apply(i))}return i})}computeOutputShape(e){e=Lt(e);const n=[],i=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<i.length;++o){const r=js(i[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);n.push(r)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s}getConfig(){const e={filters:this.filters,kernelInitializer:pn(this.kernelInitializer),kernelRegularizer:Jt(this.kernelRegularizer),kernelConstraint:zn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new G(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class vd extends ic{constructor(e){super(2,e),vd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Cb(e.kernelSize,"number",1,2))throw new G(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}vd.className="Conv2D";Ce(vd);class xd extends ic{constructor(e){super(3,e),xd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new G(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}xd.className="Conv3D";Ce(xd);class Bk extends vd{constructor(e){if(super(e),this.inputSpec=[new Ln({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Lt(e),e.length!==4)throw new G("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const i=e[n],s=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:4,axes:{[n]:i}})],this.built=!0}call(e,n){return ie(()=>{let i=at(e);if(i.shape.length!==4)throw new G(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);const s=i.shape,o=s[0];let r,a;this.dataFormat==="channelsFirst"?(r=2,a=3):(r=1,a=2);const l=s[r],c=s[a],u=this.kernelSize[0],d=this.kernelSize[1],f=this.strides[0],h=this.strides[1],p=co(l,f,u,this.padding),m=co(c,h,d,this.padding),g=[o,p,m,this.filters];this.dataFormat!=="channelsLast"&&(i=_t(i,[0,2,3,1]));let v=h2(i,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=_t(v,[0,3,1,2])),this.bias!=null&&(v=Zs(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=Lt(e);const n=e.slice();let i,s,o;this.dataFormat==="channelsFirst"?(i=1,s=2,o=3):(i=3,s=1,o=2);const r=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[i]=this.filters,n[s]=co(n[s],l,r,this.padding),n[o]=co(n[o],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Bk.className="Conv2DTranspose";Ce(Bk);class Vk extends xd{constructor(e){if(super(e),this.inputSpec=[new Ln({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Lt(e),e.length!==5)throw new G("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const i=e[n],s=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:5,axes:{[n]:i}})],this.built=!0}call(e,n){return ie(()=>{let i=at(e);if(i.shape.length!==5)throw new G(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);const s=i.shape,o=s[0];let r,a,l;this.dataFormat==="channelsFirst"?(l=2,r=3,a=4):(l=1,r=2,a=3);const c=s[l],u=s[r],d=s[a],f=this.kernelSize[0],h=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],v=this.strides[2],x=co(c,m,f,this.padding),b=co(u,g,h,this.padding),w=co(d,v,p,this.padding),y=[o,x,b,w,this.filters];this.dataFormat!=="channelsLast"&&(i=_t(i,[0,2,3,4,1]));let C=j6(i,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=_t(C,[0,4,1,2,3])),this.bias!==null&&(C=Zs(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=Lt(e);const n=e.slice();let i,s,o,r;this.dataFormat==="channelsFirst"?(i=1,s=2,o=3,r=4):(i=4,s=1,o=2,r=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],f=this.strides[2];return n[i]=this.filters,n[s]=co(n[s],u,a,this.padding),n[o]=co(n[o],d,l,this.padding),n[r]=co(n[r],f,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Vk.className="Conv3DTranspose";Ce(Vk);class Wk extends ic{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new G("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new G("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new G(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=ln(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=cn(n.depthwiseRegularizer),this.depthwiseConstraint=Bn(n.depthwiseConstraint),this.pointwiseInitializer=ln(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=cn(n.pointwiseRegularizer),this.pointwiseConstraint=Bn(n.pointwiseConstraint)}build(e){if(e=Lt(e),e.length<this.rank+2)throw new G(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new G(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const i=e[n],s=this.kernelSize.concat([i,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(i*this.depthMultiplier,this.filters);const r=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,r,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,r,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,r,this.biasConstraint):this.bias=null,this.inputSpec=[new Ln({ndim:this.rank+2,axes:{[n]:i}})],this.built=!0}call(e,n){return ie(()=>{e=at(e);let i;if(this.rank===1)throw new xt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=_t(e,[0,2,3,1])),i=_2(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(i=Zs(i,this.bias.read(),this.dataFormat)),this.activation!=null&&(i=this.activation.apply(i)),this.dataFormat==="channelsFirst"&&(i=_t(i,[0,3,1,2])),i})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=pn(this.depthwiseInitializer),e.pointwiseInitializer=pn(this.pointwiseInitializer),e.depthwiseRegularizer=Jt(this.depthwiseRegularizer),e.pointwiseRegularizer=Jt(this.pointwiseRegularizer),e.depthwiseConstraint=zn(this.depthwiseConstraint),e.pointwiseConstraint=zn(this.pointwiseConstraint),e}}Wk.className="SeparableConv";class Gk extends Wk{constructor(e){super(2,e)}}Gk.className="SeparableConv2D";Ce(Gk);class zp extends ic{constructor(e){super(1,e),zp.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Cb(e.kernelSize,"number",1,1))throw new G(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}zp.className="Conv1D";Ce(zp);class Hk extends It{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return ie(()=>{if(e=at(e),this.dataFormat==="channelsLast"){const i=Wd(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Wd(i,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const i=Wd(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Wd(i,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}Hk.className="Cropping2D";Ce(Hk);class Uk extends It{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,pq(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],i=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,i]}else{const n=e[1]==null?null:this.size[0]*e[1],i=e[2]==null?null:this.size[1]*e[2];return[e[0],n,i,e[3]]}}call(e,n){return ie(()=>{let i=at(e);const s=i.shape;if(this.dataFormat==="channelsFirst"){i=_t(i,[0,2,3,1]);const o=this.size[0]*s[2],r=this.size[1]*s[3],a=this.interpolation==="nearest"?Vo.resizeNearestNeighbor(i,[o,r]):Vo.resizeBilinear(i,[o,r]);return _t(a,[0,3,1,2])}else{const o=this.size[0]*s[1],r=this.size[1]*s[2];return this.interpolation==="nearest"?Vo.resizeNearestNeighbor(i,[o,r]):Vo.resizeBilinear(i,[o,r])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}Uk.className="UpSampling2D";Ce(Uk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function W9(t,e,n=[1,1],i="valid",s,o){return ie(()=>{s==null&&(s=Xs()),kn(s);let r=Mb(t,s);if(t.rank!==4)throw new G(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new G(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return r=v0(r,e,n,i==="same"?"same":"valid","NHWC",o),s==="channelsFirst"&&(r=_t(r,[0,3,1,2])),r})}class jk extends Lp{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=ln(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Bn(e.depthwiseConstraint),this.depthwiseRegularizer=cn(e.depthwiseRegularizer)}build(e){if(e=Lt(e),e.length<4)throw new G(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new G(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const i=e[n],s=[this.kernelSize[0],this.kernelSize[1],i,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[i*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return ie(()=>{e=at(e);let i=W9(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(i=Zs(i,this.bias.read(),this.dataFormat)),this.activation!=null&&(i=this.activation.apply(i)),i})}computeOutputShape(e){e=Lt(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=js(n,this.kernelSize[0],this.padding,this.strides[0]),r=js(i,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,o,r]:[e[0],o,r,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=pn(this.depthwiseInitializer),e.depthwiseRegularizer=Jt(this.depthwiseRegularizer),e.depthwiseConstraint=zn(this.depthwiseRegularizer),e}}jk.className="DepthwiseConv2D";Ce(jk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kk(t,e,n,i){if(Array.isArray(t)){if(e!=null||n!=null)throw new G("When inputs is an array, neither initialState or constants should be provided");i!=null&&(n=t.slice(t.length-i,t.length),t=t.slice(0,t.length-i)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function s(o){return o==null||Array.isArray(o)?o:[o]}return e=s(e),n=s(n),{inputs:t,initialState:e,constants:n}}function Xk(t,e,n,i=!1,s,o,r=!1,a=!1){return ie(()=>{const l=e.shape.length;if(l<3)throw new G(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Ks(2,l));e=_t(e,c),r&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=Fe(Fe(s,"bool"),"float32"),s.rank===l-1&&(s=_i(s,-1)),s=_t(s,c)),i&&(e=Ca(e,0),s!=null&&(s=Ca(s,0)));const u=[];let d,f=n;const h=e.shape[0],p=Sa(e);let m;s!=null&&(m=Sa(s));for(let v=0;v<h;++v){const x=p[v],b=ie(()=>t(x,f));if(s==null)d=b[0],f=b[1];else{const w=ie(()=>{const y=m[v],C=rt(Ts(y),y),I=Se(U(b[0],y),U(f[0],C)),$=f.map((E,N)=>Se(U(b[1][N],y),U(E,C)));return{output:I,newStates:$}});d=w.output,f=w.newStates}a&&u.push(d)}let g;return a&&(g=Ko(u,1)),[d,g,f]})}class Fr extends It{constructor(e){super(e);let n;if(e.cell==null)throw new G("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new zb({cells:e.cell}):n=e.cell,n.stateSize==null)throw new G("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Ln({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ks(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Hg(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const i=n[0];let s;if(this.returnSequences?s=[e[0],e[1],i]:s=[e[0],i],this.returnState){const o=[];for(const r of n)o.push([e[0],r]);return[s].concat(o)}else return s}computeMask(e,n){return ie(()=>{Array.isArray(n)&&(n=n[0]);const i=this.returnSequences?n:null;if(this.returnState){const s=this.states.map(o=>null);return[i].concat(s)}else return i})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let i=0;i<e;++i)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new xt("Constants support is not implemented in RNN yet.");Hg(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Ln({shape:[n,null,...i]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Wt(this.stateSpec.map(r=>r.shape[r.shape.length-1]),o))throw new G(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(r=>new Ln({shape:[null,r]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){ie(()=>{if(!this.stateful)throw new ao("Cannot call resetStates() on an RNN Layer that is not stateful.");const i=this.inputSpec[0].shape[0];if(i==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Xn([i,s])):this.states_=[Xn([i,this.cell.stateSize])];else if(e==null)bt(this.states_),this.keptStates!=null&&(bt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Xn([i,s])):this.states_[0]=Xn([i,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):bt(this.states_);for(let s=0;s<this.states_.length;++s){const o=e[s],r=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,a=[i,r];if(!Wt(o.shape,a))throw new G(`State ${s} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[s]=o}}this.states_=this.states_.map(s=>go(s.clone()))})}apply(e,n){let i=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});const o=Kk(e,i,s,this.numConstants);e=o.inputs,i=o.initialState,s=o.constants;let r=[],a=[];if(i!=null){n.initialState=i,r=r.concat(i),this.stateSpec=[];for(const c of i)this.stateSpec.push(new Ln({shape:c.shape}));a=a.concat(this.stateSpec)}if(s!=null&&(n.constants=s,r=r.concat(s),this.numConstants=s.length),r[0]instanceof Eo){const c=[e].concat(r),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const f=super.apply(c,n);return this.inputSpec=d,f}else return super.apply(e,n)}call(e,n){return ie(()=>{const i=n==null?null:n.mask,s=n==null?null:n.training;let o=n==null?null:n.initialState;e=at(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const r=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==r)throw new G(`RNN Layer has ${r} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:s},c=Xk((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},e,o,this.goBackwards,i,null,this.unroll,this.returnSequences),u=c[0],d=c[1],f=c[2];this.stateful&&this.resetStates(f,s);const h=this.returnSequences?d:u;return this.returnState?[h].concat(f):h})}getInitialState(e){return ie(()=>{let n=Xn(e.shape);return n=Qe(n,[1,2]),n=hd(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(i=>i>1?Wg(n,[1,i]):n):this.cell.stateSize>1?[Wg(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const i=this.cell.getConfig();return this.getClassName()===Fr.className&&(n.cell={className:this.cell.getClassName(),config:i}),Object.assign(Object.assign(Object.assign({},i),e),n)}static fromConfig(e,n,i={}){const s=n.cell,o=yo(s,i);return new e(Object.assign(n,{cell:o}))}}Fr.className="RNN";Ce(Fr);class Bp extends It{}class Fb extends Bp{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qn(this.units,"units"),this.activation=$r(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=ln(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ln(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ln(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=cn(e.kernelRegularizer),this.recurrentRegularizer=cn(e.recurrentRegularizer),this.biasRegularizer=cn(e.biasRegularizer),this.kernelConstraint=Bn(e.kernelConstraint),this.recurrentConstraint=Bn(e.recurrentConstraint),this.biasConstraint=Bn(e.biasConstraint),this.dropout=Pl([1,Sr([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Pl([1,Sr([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Lt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return ie(()=>{if(e=e,e.length!==2)throw new G(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let i=e[1];e=e[0];const s=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Er({ones:()=>Ts(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Er({ones:()=>Ts(i),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let o;const r=this.dropoutMask,a=this.recurrentDropoutMask;r!=null?o=bo(U(e,r),this.kernel.read()):o=bo(e,this.kernel.read()),this.bias!=null&&(o=Zs(o,this.bias.read())),a!=null&&(i=U(i,a));let l=Se(o,bo(i,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ir(this.activation),useBias:this.useBias,kernelInitializer:pn(this.kernelInitializer),recurrentInitializer:pn(this.recurrentInitializer),biasInitializer:pn(this.biasInitializer),kernelRegularizer:Jt(this.kernelRegularizer),recurrentRegularizer:Jt(this.recurrentRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:zn(this.kernelConstraint),recurrentConstraint:zn(this.recurrentConstraint),biasConstraint:zn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Fb.className="SimpleRNNCell";Ce(Fb);class qk extends Fr{constructor(e){e.cell=new Fb(e),super(e)}call(e,n){return ie(()=>{this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=n==null?null:n.mask,s=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:i,training:s,initialState:o})})}static fromConfig(e,n){return new e(n)}}qk.className="SimpleRNN";Ce(qk);class Lb extends Bp{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new G("GRUCell does not support reset_after parameter set to true.");this.units=e.units,qn(this.units,"units"),this.activation=$r(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=$r(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=ln(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ln(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ln(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=cn(e.kernelRegularizer),this.recurrentRegularizer=cn(e.recurrentRegularizer),this.biasRegularizer=cn(e.biasRegularizer),this.kernelConstraint=Bn(e.kernelConstraint),this.recurrentConstraint=Bn(e.recurrentConstraint),this.biasConstraint=Bn(e.biasConstraint),this.dropout=Pl([1,Sr([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Pl([1,Sr([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Lt(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return ie(()=>{if(e=e,e.length!==2)throw new G(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const i=n.training==null?!1:n.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Er({ones:()=>Ts(e),rate:this.dropout,training:i,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Er({ones:()=>Ts(s),rate:this.recurrentDropout,training:i,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,r=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=U(e,o[0]));let u=bo(e,this.kernel.read());this.useBias&&(u=Zs(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=U(s,r[0]));const d=this.recurrentKernel.read(),[f,h]=rs(d,[2*this.units,this.units],d.rank-1),p=bo(s,f),[m,g,v]=rs(u,3,u.rank-1),[x,b]=rs(p,2,p.rank-1);a=this.recurrentActivation.apply(Se(m,x)),l=this.recurrentActivation.apply(Se(g,b));const w=bo(U(l,s),h);c=this.activation.apply(Se(v,w));const y=Se(U(a,s),U(Se(1,Cn(a)),c));return[y,y]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ir(this.activation),recurrentActivation:Ir(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pn(this.kernelInitializer),recurrentInitializer:pn(this.recurrentInitializer),biasInitializer:pn(this.biasInitializer),kernelRegularizer:Jt(this.kernelRegularizer),recurrentRegularizer:Jt(this.recurrentRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:zn(this.kernelConstraint),recurrentConstraint:zn(this.recurrentConstraint),biasConstraint:zn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}Lb.className="GRUCell";Ce(Lb);class Yk extends Fr{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Lb(e),super(e)}call(e,n){return ie(()=>{this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=n==null?null:n.mask,s=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:i,training:s,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}Yk.className="GRU";Ce(Yk);class Vp extends Bp{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qn(this.units,"units"),this.activation=$r(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=$r(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=ln(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ln(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ln(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=cn(e.kernelRegularizer),this.recurrentRegularizer=cn(e.recurrentRegularizer),this.biasRegularizer=cn(e.biasRegularizer),this.kernelConstraint=Bn(e.kernelConstraint),this.recurrentConstraint=Bn(e.recurrentConstraint),this.biasConstraint=Bn(e.biasConstraint),this.dropout=Pl([1,Sr([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Pl([1,Sr([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=Lt(e);const i=e[e.length-1];this.kernel=this.addWeight("kernel",[i,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,r=this.units;s=new(n=class extends Os{apply(l,c){const u=o.apply([r]),d=new Ib().apply([r]),f=o.apply([r*2]);return GC(GC(u,d),f)}},n.className="CustomInit",n)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return ie(()=>{const i=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new G(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Er({ones:()=>Ts(e),rate:this.dropout,training:i,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Er({ones:()=>Ts(s),rate:this.recurrentDropout,training:i,count:4,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=U(e,r[0]));let f=bo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=U(s,a[0])),f=Se(f,bo(s,this.recurrentKernel.read())),this.useBias&&(f=Zs(f,this.bias.read()));const[h,p,m,g]=rs(f,4,f.rank-1);l=this.recurrentActivation.apply(h),c=this.recurrentActivation.apply(p),u=Se(U(c,o),U(l,this.activation.apply(m))),d=this.recurrentActivation.apply(g);const v=U(d,this.activation.apply(u));return[v,v,u]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ir(this.activation),recurrentActivation:Ir(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pn(this.kernelInitializer),recurrentInitializer:pn(this.recurrentInitializer),biasInitializer:pn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Jt(this.kernelRegularizer),recurrentRegularizer:Jt(this.recurrentRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:zn(this.kernelConstraint),recurrentConstraint:zn(this.recurrentConstraint),biasConstraint:zn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}Vp.className="LSTMCell";Ce(Vp);class Jk extends Fr{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Vp(e),super(e)}call(e,n){return ie(()=>{this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=n==null?null:n.mask,s=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:i,training:s,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}Jk.className="LSTM";Ce(Jk);class zb extends Bp{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return ie(()=>{e=e;let i=e.slice(1);const s=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?s.push(i.splice(0,a.stateSize.length)):s.push(i.splice(0,1));s.reverse();const o=[];let r;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];i=s[a],a===0?r=[e[0]].concat(i):r=[r[0]].concat(i),r=l.call(r,n),o.push(r.slice(1))}i=[];for(const a of o.slice().reverse())i.push(...a);return[r[0]].concat(i)})}build(e){Hg(e)&&(e=e[0]),e=e;let n;this.cells.forEach((i,s)=>{ca(`RNNCell_${s}`,()=>{i.build(e),Array.isArray(i.stateSize)?n=i.stateSize[0]:n=i.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=o=>({className:o.getClassName(),config:o.getConfig()}),s={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,n,i={}){const s=[];for(const o of n.cells)s.push(yo(o,i));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const i of this.cells)n.push(...i.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return Ug(e)}setWeights(e){const n=[];for(const i of this.cells){const s=i.weights.length,o=e.splice(s);for(let r=0;r<i.weights.length;++r)n.push([i.weights[r],o[r]])}Rb(n)}}zb.className="StackedRNNCells";Ce(zb);function Er(t){const{ones:e,rate:n,training:i=!1,count:s=1,dropoutFunc:o}=t,r=()=>o!=null?o(e(),n):VN(e(),n),a=()=>pd(r,e,i);return!s||s<=1?go(a().clone()):Array(s).fill(void 0).map(a).map(c=>go(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var G9=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]]);return n};class Zk extends Fr{constructor(e){if(e.unroll)throw new xt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new xt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Ln({ndim:5})]}call(e,n){return ie(()=>{if(this.cell.dropoutMask!=null&&(bt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(bt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new G("ConvRNN2D cell does not support constants");const i=n==null?null:n.mask,s=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:i,training:s,initialState:o})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return ie(()=>{const{stateSize:n}=this.cell,i=e.shape,s=this.computeSingleOutputShape(i),o=[s[0],...s.slice(2)],r=Xn(o);return Array.isArray(n)?Array(n.length).fill(r):[r]})}resetStates(e,n=!1){ie(()=>{if(!this.stateful)throw new ao("Cannot call resetStates() on an RNN Layer that is not stateful.");const i=this.inputSpec[0].shape,s=this.computeSingleOutputShape(i),o=[s[0],...s.slice(2)];if(i[0]==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Xn(o)):this.states_=[Xn(o)];else if(e==null)bt(this.states_),this.keptStates!=null&&(bt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Xn(o)):this.states_[0]=Xn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):bt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=o;if(!Wt(l.shape,c))throw new G(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>go(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:i,kernelSize:s,padding:o,strides:r,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=js(c,s[0],o,r[0],a[0]),f=js(u,s[1],o,r[1],a[1]);return[...e.slice(0,2),...l?[i,d,f]:[d,f,i]]}}Zk.className="ConvRNN2D";class Bb extends Vp{constructor(e){const{filters:n,kernelSize:i,strides:s,padding:o,dataFormat:r,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,qn(this.filters,"filters"),this.kernelSize=fl(i,2,"kernelSize"),this.kernelSize.forEach(l=>qn(l,"kernelSize")),this.strides=fl(s||1,2,"strides"),this.strides.forEach(l=>qn(l,"strides")),this.padding=o||"valid",us(this.padding),this.dataFormat=r||"channelsLast",kn(this.dataFormat),this.dilationRate=fl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>qn(l,"dilationRate"))}build(e){var n;e=Lt(e);const i=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[i]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[i]}`);const s=e[i],o=4,r=this.kernelSize.concat([s,this.filters*o]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(n=class extends Os{apply(f,h){const p=c.apply([u]),m=Pr([u]),g=c.apply([u*2]);return Sb([p,m,g])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return ie(()=>{if(e.length!==3)throw new G(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const i=n.training||!1,s=e[0],o=e[1],r=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Er({ones:()=>Ts(s),rate:this.dropout,training:i,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(z,L,W)=>!L||!L[W]?z:U(L[W],z);let u=c(s,l,0),d=c(s,l,1),f=c(s,l,2),h=c(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Er({ones:()=>Ts(o),rate:this.recurrentDropout,training:i,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=c(o,p,0),g=c(o,p,1),v=c(o,p,2),x=c(o,p,3);const b=3,[w,y,C,I]=rs(this.kernel.read(),a,b),[$,E,N,k]=this.useBias?rs(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,w,$,this.padding),d=this.inputConv(d,y,E,this.padding),f=this.inputConv(f,C,N,this.padding),h=this.inputConv(h,I,k,this.padding);const[D,_,R,T]=rs(this.recurrentKernel.read(),a,b);m=this.recurrentConv(m,D),g=this.recurrentConv(g,_),v=this.recurrentConv(v,R),x=this.recurrentConv(x,T);const A=this.recurrentActivation.apply(Se(u,m)),O=this.recurrentActivation.apply(Se(d,g)),P=Se(U(O,r),U(A,this.activation.apply(Se(f,v)))),M=U(this.recurrentActivation.apply(Se(h,x)),this.activation.apply(P));return[M,M,P]})}getConfig(){const e=super.getConfig(),n=G9(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),i)}inputConv(e,n,i,s){const o=ya(e,n,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return i?Zs(o,i,this.dataFormat):o}recurrentConv(e,n){return ya(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Bb.className="ConvLSTM2DCell";Ce(Bb);class Qk extends Zk{constructor(e){const n=new Bb(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}Qk.className="ConvLSTM2D";Ce(Qk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Vb extends It{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,i=[];for(let s=0;s<this.noiseShape.length;++s)i.push(this.noiseShape[s]==null?n[s]:this.noiseShape[s]);return i}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e);if(0<this.rate&&this.rate<1){const s=n.training==null?!1:n.training,o=this.getNoiseShape(i);return pd(()=>VN(i,this.rate,o,this.seed),()=>i,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Vb.className="Dropout";Ce(Vb);class eD extends Vb{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}eD.className="SpatialDropout1D";Ce(eD);class Wb extends It{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,qn(this.units,"units"),this.activation=$r(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=ln(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=ln(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Bn(e.kernelConstraint),this.biasConstraint=Bn(e.biasConstraint),this.kernelRegularizer=cn(e.kernelRegularizer),this.biasRegularizer=cn(e.biasRegularizer),this.activityRegularizer=cn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Lt(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=Lt(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e),s=ON(this.activation.getClassName());let o;return s!=null?o=bo(i,this.kernel.read(),s,this.bias?this.bias.read():null):(o=bo(i,this.kernel.read()),this.bias!=null&&(o=Zs(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:Ir(this.activation),useBias:this.useBias,kernelInitializer:pn(this.kernelInitializer),biasInitializer:pn(this.biasInitializer),kernelRegularizer:Jt(this.kernelRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:zn(this.kernelConstraint),biasConstraint:zn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Wb.className="Dense";Ce(Wb);class tD extends It{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Lt(e);for(const n of e.slice(1))if(n==null)throw new G(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],vr(e,1)]}call(e,n){return ie(()=>{this.invokeCallHook(e,n);let i=at(e);if(this.dataFormat==="channelsFirst"&&i.rank>1){const s=[0];for(let o=2;o<i.rank;++o)s.push(o);s.push(1),i=_t(i,s)}return yq(i)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}tD.className="Flatten";Ce(tD);class nD extends It{constructor(e){super(e),this.supportsMasking=!0,this.activation=$r(e.activation)}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e);return this.activation.apply(i)})}getConfig(){const e={activation:Ir(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}nD.className="Activation";Ce(nD);class iD extends It{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return ie(()=>(e=at(e),xq(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}iD.className="RepeatVector";Ce(iD);class sD extends It{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const i="Total size of new array must be unchanged.",s=n.slice();let o=1,r=null;for(let l=0;l<s.length;++l){const c=s[l];if(this.isUnknown(c))if(r===null)r=l;else throw new G("Can only specifiy one unknown dimension.");else o*=c}const a=vr(e);if(r!==null){if(o===0||a%o!==0)throw new G(i);s[r]=a/o}else if(a!==o)throw new G(i);return s}computeOutputShape(e){let n=!1;for(let i=0;i<e.length;++i)if(this.isUnknown(e[i])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e),s=i.shape,o=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return Z(i,o)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}sD.className="Reshape";Ce(sD);class oD extends It{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Ks(1,e.dims.length+1);if(!Wt(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Ln({ndim:this.dims.length+1})]}computeOutputShape(e){e=Lt(e);const n=e.slice();return this.dims.forEach((i,s)=>{n[s+1]=e[i]}),n}call(e,n){return _t(at(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}oD.className="Permute";Ce(oD);class rD extends It{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const i=at(e);return Pg(Ah(i,this.maskValue),-1)}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e),r=Pg(Ah(i,this.maskValue),-1,!0);return U(i,Fe(r,i.dtype))})}}rD.className="Masking";Ce(rD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aD extends It{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Gt(e.inputLength))}this.inputDim=e.inputDim,qn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,qn(this.outputDim,"outputDim"),this.embeddingsInitializer=ln(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=cn(e.embeddingsRegularizer),this.activityRegularizer=cn(e.activityRegularizer),this.embeddingsConstraint=Bn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return ie(()=>this.maskZero?(e=at(e),Ah(e,At(e))):null)}computeOutputShape(e){if(e=Lt(e),this.inputLength==null)return[...e,this.outputDim];const n=Gt(this.inputLength);if(n.length!==e.length-1)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let i=0;for(let s=0;s<n.length;++s){const o=n[s],r=e[s+1];if(o!=null&&r!=null&&o!==r)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(n[i]=r),i++}}return[e[0],...n,this.outputDim]}call(e,n){return ie(()=>{this.invokeCallHook(e,n);let i=at(e);i.dtype!=="int32"&&(i=xo(i,"int32"));const s=BN(this.embeddings.read(),Z(i,[i.size]));return Z(s,Lt(this.computeOutputShape(i.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:pn(this.embeddingsInitializer),embeddingsRegularizer:Jt(this.embeddingsRegularizer),activityRegularizer:Jt(this.activityRegularizer),embeddingsConstraint:zn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}aD.className="Embedding";Ce(aD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ba extends It{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new xt}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const i=e.slice(0,e.length-n.length);for(let s=0;s<n.length;++s){const o=e[e.length-n.length+s],r=n[s];if(o==null||r==null||o<0||r<0)i.push(null);else if(o===1)i.push(r);else if(r===1)i.push(o);else{if(o!==r)throw new G("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));i.push(o)}}return i}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Lt(e)]),e=e,e.length<2)throw new G(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const o of e)o!=null&&o[0]!==null&&n.push(o[0]);if(n=gr(n),n.length>1)throw new G(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let i=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const r=e[o]==null?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,r)}const s=e.map(o=>o.length);e.indexOf(null)===-1&&gr(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return ie(()=>{if(e=e,this.reshapeRequired){const i=[],s=e.map(o=>o.rank);if(s.indexOf(null)===-1){const o=Sr(s);for(let r of e){const a=r.rank;for(let l=0;l<o-a;++l)r=hd(r,1);i.push(r)}return this.mergeFunction(i)}else{let o=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],f=u.slice(1).concat([d]);let h=Z(l,[d].concat(vr(u.slice(1))));h=_t(h,[1,0]),h=Z(h,f),i.push(h),o=!0}else if(c>1){const u=Ks(1,c).concat([0]);i.push(_t(l,u)),o=!0}else i.push(l)}let r=this.mergeFunction(i);const a=r.rank;if(o){if(a==null){const l=r.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));r=Z(_t(Z(r,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Ks(0,a-1));r=_t(r,l)}}return r}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let s=1;s<e.length;++s){const o=e[s]==null?null:e[s].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}let i=[];for(const s of e)s!=null&&s[0]!==null&&i.push(s[0]);return i=gr(i),i.length===1?n=i.concat(n):n=[null].concat(n),n}computeMask(e,n){return ie(()=>{if(n==null)return null;if(!Array.isArray(n))throw new G("`mask` should be an Array");if(!Array.isArray(e))throw new G("`inputs` should be an Array");if(n.length!==e.length)throw new G(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(s=>s==null))return null;n=n.map(s=>s==null?s:_i(s,0));let i=n[0];for(let s=1;s<n.length-1;++s)i=jo(i,n[s]);return i})}}class lD extends Ba{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let n=e[0].clone();for(let i=1;i<e.length;++i)n=Se(n,e[i]);return n})}}lD.className="Add";Ce(lD);class cD extends Ba{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let n=e[0].clone();for(let i=1;i<e.length;++i)n=U(n,e[i]);return n})}}cD.className="Multiply";Ce(cD);class uD extends Ba{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let n=e[0].clone();for(let i=1;i<e.length;++i)n=Se(n,e[i]);return U(1/e.length,n)})}}uD.className="Average";Ce(uD);class dD extends Ba{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let n=e[0];for(let i=1;i<e.length;++i)n=Or(n,e[i]);return n})}}dD.className="Maximum";Ce(dD);class hD extends Ba{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let n=e[0];for(let i=1;i<e.length;++i)n=Uc(n,e[i]);return n})}}hD.className="Minimum";Ce(hD);class fD extends Ba{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new G("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const s of e)if(s!=null){n=!1;break}if(n)return;const i=[];for(let s=0;s<e.length;++s){const o=e[s].slice();o.splice(this.axis,1);let r=!1;for(const a of i)if(Wt(a,o)){r=!0;break}r||i.push(o)}if(i.length>1)throw new G("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ie(()=>Sb(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new G("A `Concatenate` layer should be called on a list of inputs.");const n=e,i=n[0].slice(),s=this.axis<0?i.length+this.axis:this.axis;for(const o of n.slice(1)){if(i[s]==null||o[s]==null){i[s]=null;break}i[s]+=o[s]}return i}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new G("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new G("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new G(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return ie(()=>{let i=!0;if(n.forEach(r=>{if(r!=null){i=!1;return}}),i)return null;const s=[];for(let r=0;r<e.length;++r)n[r]==null?s.push(Fe(Ts(e[r]),"bool")):n[r].rank<e[r].rank?s.push(_i(n[r],-1)):s.push(n[r]);const o=Mi(s,this.axis);return u2(o,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}fD.className="Concatenate";Ce(fD);function bc(t,e){for(;t<0;)t+=e;return t}function H9(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new xt("batchDot is not implemented for tensors of 4D or higher rank yet");if(F(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),F(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new xt("batchDot is not implemented for complex64-type Tensors yet.");const i=t.shape.length,s=e.shape.length;n==null&&(n=[i-1,s-2]);const o=n;return ie(()=>{let r;if(i>s){r=i-s;const l=[];for(let c=0;c<r;++c)l.push(1);e=Z(e,e.shape.concat(l))}else if(s>i){r=s-i;const l=[];for(let c=0;c<r;++c)l.push(1);t=Z(t,t.shape.concat(l))}else r=0;let a;if(t.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=Qe(U(t,e),o[0]):a=Qe(U(_t(t,[1,0]),e),o[1]);else{const l=o[0]!==t.shape.length-1,c=o[1]===e.shape.length-1;a=Bt(t,e,l,c)}if(r>0){let l;i>s?l=i+s-3:l=i-1;const c=[];for(let u=l;u<l+r;++u)c.push(u);a=rd(a,c)}return a.shape.length===1&&(a=_i(a,1)),a})}class pD extends Ba{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){F(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],i=e[1];if(n.length>3||i.length>3)throw new xt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(n,i);if(n[s[0]]!==i[s[1]])throw new G(`Dimension incompatibility: ${n[s[0]]} !== ${i[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new G(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],i=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((o,r)=>bc(o,e[r].shape.length)):s=[bc(this.axes,n.shape.length),bc(this.axes,i.shape.length)],this.normalize&&(n=Bh(n,s[0]),i=Bh(i,s[1])),H9(n,i,s)}interpretAxes(e,n){let i;return Array.isArray(this.axes)?i=this.axes:i=[bc(this.axes,e.length),bc(this.axes,n.length)],i}computeOutputShape(e){F(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),i=e[1].slice();if(n.length>3||i.length>3)throw new xt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(n,i);n.splice(s[0],1),i.splice(s[1],1),i.splice(0,1);const o=n.concat(i);return o.length===1&&o.push(1),o}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}pD.className="Dot";Ce(pD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mD extends It{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e);return pd(()=>Se(Op(i.shape,0,this.stddev),i),()=>i,n.training||!1)})}}mD.className="GaussianNoise";Ce(mD);class gD extends It{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return ie(()=>{this.invokeCallHook(e,n);const i=at(e);return this.rate>0&&this.rate<1?pd(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return U(i,Op(i.shape,1,o))},()=>i,n.training||!1):i})}}gD.className="GaussianDropout";Ce(gD);class vD extends It{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||at(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return ie(()=>{if(this.rate<1&&this.rate>0){const i=this._getNoiseShape(e);return pd(()=>{const o=at(e),l=-1.6732632423543772*1.0507009873554805;let c=Pa(od(i),this.rate);c=xo(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,f=Se(U(o,c),U(Se(c,-1),l));return Se(U(f,u),d)},()=>at(e),n.training||!1)}return e})}}vD.className="AlphaDropout";Ce(vD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qc(t,e,n,i,s,o=.001){let r;if(t.rank===2)r=b6(t,e,n,i,s,o);else if(t.rank===3)r=w6(t,e,n,i,s,o);else if(t.rank===4)r=S6(t,e,n,i,s,o);else throw new xt(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return r}function U9(t,e,n,i,s=.001){return ie(()=>{const o=I0(t,i),r=o.mean,a=o.variance;return[qc(t,r,a,n,e,s),r,a]})}function j9(t,e,n,i,s=.001){return ie(()=>{const o=I0(t,i),r=o.mean,a=o.variance,l=[];for(const p of Ks(0,t.rank))i.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const c=Z(r,l),u=Z(a,l),d=e==null?null:Z(e,l),f=n==null?null:Z(n,l);return[qc(t,c,u,f,d,s),r,a]})}function K9(t,e,n,i,s=.001){return Wt(i.slice().sort(),Ks(0,t.rank-1))?U9(t,e,n,i,s):j9(t,e,n,i,s)}class xD extends It{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=ln(e.betaInitializer||"zeros"),this.gammaInitializer=ln(e.gammaInitializer||"ones"),this.movingMeanInitializer=ln(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=ln(e.movingVarianceInitializer||"ones"),this.betaConstraint=Bn(e.betaConstraint),this.gammaConstraint=Bn(e.gammaConstraint),this.betaRegularizer=cn(e.betaRegularizer),this.gammaRegularizer=cn(e.gammaRegularizer)}build(e){e=Lt(e);const n=this.axis>=0?this.axis:this.axis+e.length,i=e[n];if(i==null)throw new G(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Ln({ndim:e.length,axes:{[n]:i}})];const s=[i];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return ie(()=>{const i=n.training==null?!1:n.training,s=at(e),o=s.shape,r=o.length,a=Ks(0,r),l=this.axis>=0?this.axis:this.axis+r;a.splice(l,1);const c=Ia(1,r);c[l]=o[l];const u=a.slice();u.sort();const d=!Wt(u,Ks(0,r).slice(0,r-1)),f=()=>{if(d){const x=Z(this.movingMean.read(),c),b=Z(this.movingVariance.read(),c),w=this.center?Z(this.beta.read(),c):null,y=this.scale?Z(this.gamma.read(),c):null;return qc(s,x,b,w,y,this.epsilon)}else return qc(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!i)return f();const[h,p,m]=K9(s,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(x,b,w)=>{ie(()=>{const y=1-w,C=x.read(),I=U(rt(C,b),y);x.write(rt(C,I))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pn(this.betaInitializer),gammaInitializer:pn(this.gammaInitializer),movingMeanInitializer:pn(this.movingMeanInitializer),movingVarianceInitializer:pn(this.movingVarianceInitializer),betaRegularizer:Jt(this.betaRegularizer),gammaRegularizer:Jt(this.gammaRegularizer),betaConstraint:zn(this.betaConstraint),gammaConstraint:zn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}xD.className="BatchNormalization";Ce(xD);class bD extends It{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=ln(e.betaInitializer||"zeros"),this.gammaInitializer=ln(e.gammaInitializer||"ones"),this.betaRegularizer=cn(e.betaRegularizer),this.gammaRegularizer=cn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Lt(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=n);for(const o of this.axis)if(o<0||o>=n)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==gr(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const i=this.axis.map(o=>e[o]),s=!0;this.scale?this.gamma=this.addWeight("gamma",i,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",i,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,n){const i=at(e),s=i.shape,o=s.length;return ie(()=>{let{mean:a,variance:l}=I0(i,this.axis,!0);const c=Ia(1,o);for(const m of this.axis)c[m]=s[m];const u=m=>m!=null&&m.shape.length!==o?Z(m,c):m;let d=this.scale?u(this.gamma.read()):null,f=this.center?u(this.beta.read()):null;const h=[],p=[];for(let m=0;m<o;++m)this.axis.indexOf(m)!==-1?(h.push(s[m]),p.push(1)):(h.push(1),p.push(s[m]));return a=Gs(a,h),l=Gs(l,h),d!=null&&(d=Gs(d,p)),f!=null&&(f=Gs(f,p)),qc(i,a,l,f,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pn(this.betaInitializer),gammaInitializer:pn(this.gammaInitializer),betaRegularizer:Jt(this.betaRegularizer),gammaRegularizer:Jt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}bD.className="LayerNormalization";Ce(bD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function X9(t,e,n){return ie(()=>{if(t.rank!==4)throw new G(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new G("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Xs()),n!=="channelsLast"&&n!=="channelsFirst")throw new G(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let i;return n==="channelsFirst"?i=[[0,0],[0,0],e[0],e[1]]:i=[[0,0],e[0],e[1],[0,0]],$0(t,i)})}class yD extends It{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Xs():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new G(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,i;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new G(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new G(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);i=e.padding[1]}this.padding=[n,i]}this.inputSpec=[new Ln({ndim:4})]}computeOutputShape(e){e=Lt(e);let n,i;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?i=e[3]+this.padding[1][0]+this.padding[1][1]:i=null,[e[0],e[1],n,i]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?i=e[2]+this.padding[1][0]+this.padding[1][1]:i=null,[e[0],n,i,e[3]])}call(e,n){return ie(()=>X9(at(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}yD.className="ZeroPadding2D";Ce(yD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wp(t,e,n,i,s,o){return ie(()=>{kn(s),MN(o),us(i),n==null&&(n=[1,1]),i==null&&(i="valid"),s==null&&(s=Xs()),o==null&&(o="max"),t=Mb(t,s);let r;const a=i==="same"?"same":"valid";return o==="max"?r=S0(t,e,n,a):r=f0(t,e,n,a),s==="channelsFirst"&&(r=_t(r,[0,3,1,2])),r})}function wD(t,e,n,i,s,o){return ie(()=>{kn(s),MN(o),us(i),n==null&&(n=[1,1,1]),i==null&&(i="valid"),s==null&&(s=Xs()),o==null&&(o="max"),t=zk(t,s);let r;const a=i==="same"?"same":"valid";return o==="max"?r=aK(t,e,n,a):r=c6(t,e,n,a),s==="channelsFirst"&&(r=_t(r,[0,4,1,2,3])),r})}class CD extends It{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new G(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(qn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new G(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,us(this.padding),this.inputSpec=[new Ln({ndim:3})]}computeOutputShape(e){e=Lt(e);const n=js(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return ie(()=>{this.invokeCallHook(e,n),e=hd(at(e),2);const i=this.poolingFunction(at(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return rd(i,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class SD extends CD{constructor(e){super(e)}poolingFunction(e,n,i,s,o){return kn(o),us(s),Wp(e,n,i,s,o,"max")}}SD.className="MaxPooling1D";Ce(SD);class ID extends CD{constructor(e){super(e)}poolingFunction(e,n,i,s,o){return kn(o),us(s),Wp(e,n,i,s,o,"avg")}}ID.className="AveragePooling1D";Ce(ID);class $D extends It{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new G(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kn(this.dataFormat),us(this.padding),this.inputSpec=[new Ln({ndim:4})]}computeOutputShape(e){e=Lt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=js(n,this.poolSize[0],this.padding,this.strides[0]),i=js(i,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,i]:[e[0],n,i,e[3]]}call(e,n){return ie(()=>(this.invokeCallHook(e,n),this.poolingFunction(at(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class ED extends $D{constructor(e){super(e)}poolingFunction(e,n,i,s,o){return kn(o),us(s),Wp(e,n,i,s,o,"max")}}ED.className="MaxPooling2D";Ce(ED);class ND extends $D{constructor(e){super(e)}poolingFunction(e,n,i,s,o){return kn(o),us(s),Wp(e,n,i,s,o,"avg")}}ND.className="AveragePooling2D";Ce(ND);class kD extends It{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new G(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kn(this.dataFormat),us(this.padding),this.inputSpec=[new Ln({ndim:5})]}computeOutputShape(e){e=Lt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=js(n,this.poolSize[0],this.padding,this.strides[0]),i=js(i,this.poolSize[1],this.padding,this.strides[1]),s=js(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,i,s]:[e[0],n,i,s,e[4]]}call(e,n){return ie(()=>(this.invokeCallHook(e,n),this.poolingFunction(at(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class DD extends kD{constructor(e){super(e)}poolingFunction(e,n,i,s,o){return kn(o),us(s),wD(e,n,i,s,o,"max")}}DD.className="MaxPooling3D";Ce(DD);class TD extends kD{constructor(e){super(e)}poolingFunction(e,n,i,s,o){return kn(o),us(s),wD(e,n,i,s,o,"avg")}}TD.className="AveragePooling3D";Ce(TD);class RD extends It{constructor(e){super(e),this.inputSpec=[new Ln({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new xt}}class _D extends RD{constructor(e){super(e||{})}call(e,n){return ie(()=>{const i=at(e);return Tn(i,1)})}}_D.className="GlobalAveragePooling1D";Ce(_D);class AD extends RD{constructor(e){super(e||{})}call(e,n){return ie(()=>{const i=at(e);return Us(i,1)})}}AD.className="GlobalMaxPooling1D";Ce(AD);class OD extends It{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,kn(this.dataFormat),this.inputSpec=[new Ln({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new xt}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class PD extends OD{call(e,n){return ie(()=>{const i=at(e);return this.dataFormat==="channelsLast"?Tn(i,[1,2]):Tn(i,[2,3])})}}PD.className="GlobalAveragePooling2D";Ce(PD);class MD extends OD{call(e,n){return ie(()=>{const i=at(e);return this.dataFormat==="channelsLast"?Us(i,[1,2]):Us(i,[2,3])})}}MD.className="GlobalMaxPooling2D";Ce(MD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FD extends It{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,i={}){const s=n.layer,o=yo(s,i);delete n.layer;const r={layer:o};return Object.assign(r,n),new e(r)}}class LD extends FD{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Lt(e),e.length<3)throw new G(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Lt(e);const n=[e[0]].concat(e.slice(2)),i=this.layer.computeOutputShape(n),s=e[1];return[i[0],s].concat(i.slice(1))}call(e,n){return ie(()=>(e=at(e),Xk((r,a)=>[at(this.layer.call(r,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}LD.className="TimeDistributed";Ce(LD);function q9(t){za(fq,"BidirectionalMergeMode",t)}const Y9="concat";class zD extends FD{constructor(e){super(e);const n=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=n,this.forwardLayer=yo(i),n.goBackwards=n.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=n,this.backwardLayer=yo(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Y9:e.mergeMode,q9(this.mergeMode),e.weights)throw new xt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,i=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,i)),this.backwardLayer.setWeights(e.slice(i))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let i,s,o;return this.returnState&&(o=n.slice(1)),i=n[0],i=i,this.mergeMode==="concat"?(i[i.length-1]*=2,s=[i]):this.mergeMode==null?s=[i,i.slice()]:s=[i],this.returnState?this.mergeMode==null?s.concat(o).concat(o.slice()):[i].concat(o).concat(o.slice()):Ai(s)}apply(e,n){let i=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});const o=Kk(e,i,s,this.numConstants);if(e=o.inputs,i=o.initialState,s=o.constants,Array.isArray(e)&&(i=e.slice(1),e=e[0]),(i==null||i.length===0)&&s==null)return super.apply(e,n);const r=[],a=[];if(i!=null){const c=i.length;if(c%2>0)throw new G("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=i,r.push(...i);const u=i.map(d=>new Ln({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(s!=null)throw new xt("Support for constants in Bidirectional layers is not implemented yet.");const l=r[0]instanceof Eo;for(const c of r)if(c instanceof Eo!==l)throw new G("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(r),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const f=super.apply(c,n);return this.inputSpec=d,f}else return super.apply(e,n)}call(e,n){return ie(()=>{const i=n.initialState;let s,o;if(i==null)s=this.forwardLayer.call(e,n),o=this.backwardLayer.call(e,n);else{const l=i.slice(0,i.length/2),c=i.slice(i.length/2);s=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let r;this.returnState&&(Array.isArray(s)&&(r=s.slice(1).concat(o.slice(1))),s=s[0],o=o[0]),this.returnSequences&&(o=Ca(o,1));let a;return this.mergeMode==="concat"?a=Sb([s,o]):this.mergeMode==="sum"?a=Se(s,o):this.mergeMode==="ave"?a=U(.5,Se(s,o)):this.mergeMode==="mul"?a=U(s,o):this.mergeMode==null&&(a=[s,o]),this.returnState?this.mergeMode==null?a.concat(r):[a].concat(r):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ca(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ca(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let i;if(this.returnSequences?this.mergeMode==null?i=[n,n]:i=n:this.mergeMode==null?i=[null,null]:i=null,this.returnState){const o=this.forwardLayer.states.map(r=>null);return Array.isArray(i)?i.concat(o).concat(o):[i].concat(o).concat(o)}else return i}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const i=yo(n.layer);if(delete n.layer,n.numConstants!=null)throw new xt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=n;return s.layer=i,new e(s)}}zD.className="Bidirectional";Ce(zD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BD extends It{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return ie(()=>(e=at(e),e.dtype!=="float32"&&(e=xo(e,"float32")),Se(U(e,this.scale),this.offset)))}}BD.className="Rescaling";Ce(BD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:J9,cropAndResize:Z9}=Vo;class VD extends It{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,i,s,o,r,a,l){return ie(()=>{let c,u=!1;const d=n/r,f=i/a,h=(s+n)/r,p=(o+i)/a,m=[d,f,h,p],g=[];e.rank===3?(u=!0,c=Ko([e])):c=e;for(let y=0;y<c.shape[0];y++)g.push(m);const v=ul(g,[g.length,4]),x=jc(0,g.length,1,"int32"),w=Z9(c,v,x,[s,o],"nearest");return xo(u?at(Sa(w)):w,l)})}upsize(e,n,i,s){return ie(()=>{const o=J9(e,[n,i]);return xo(o,s)})}call(e,n){return ie(()=>{const i=at(e),s=i.dtype,o=i.shape,r=o[o.length-3],a=o[o.length-2];let l=0;r!==this.height&&(l=Math.floor((r-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(i,l,c,this.height,this.width,r,a,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Lt(e);const n=e.length-3,i=e.length-2;return e[n]=this.height,e[i]=this.width,e}}VD.className="CenterCrop";Ce(VD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Q9(t,e,n,i){let s=at(t);if(s.dtype!=="int32"&&(s=xo(s,"int32")),e==="int")return s;const o=s.shape;if(s.rank===0&&(s=_i(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=_i(s,-1)),s.rank>2)throw new G(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${s.rank}.`);const r=["multiHot","oneHot"].includes(e),a=s;let l;if(typeof i<"u"&&e==="count"?l=EC(a,i,n,r):l=EC(a,[],n,r),e!=="tfIdf")return l;if(i)return U(l,i);throw new G("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WD extends It{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=Lt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return ie(()=>{e=at(e),e.dtype!=="int32"&&(e=xo(e,"int32"));let i;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new G(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);i=at(n.countWeights)}const s=Us(e),o=Rh(e),r=cs(this.numTokens,s).bufferSync().get(0),a=Pa(o,0).bufferSync().get(0);if(!(r&&a))throw new G(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Q9(e,this.outputMode,this.numTokens,i)})}}WD.className="CategoryEncoding";Ce(WD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const eY=["bilinear","nearest"],aS=new Set(eY);class GD extends It{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(aS.has(e.interpolation))this.interpolation=e.interpolation;else throw new G(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Lt(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return ie(()=>{const i=[this.height,this.width];if(this.interpolation==="bilinear")return Vo.resizeBilinear(e,i,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Vo.resizeNearestNeighbor(e,i,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...aS]} are supported`)})}}GD.className="Resizing";Ce(GD);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HD{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}HD.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UD extends It{constructor(e){super(e),this.randomGenerator=new HD(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}UD.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tY=["bilinear","nearest"],lS=new Set(tY);class jD extends UD{constructor(e){super(e);const{factor:n,interpolation:i="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new G(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new G(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new G(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(i)if(lS.has(i))this.interpolation=i;else throw new G(`Invalid interpolation parameter: ${i} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Lt(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return ie(()=>{const i=at(e);this.imgHeight=i.shape[i.shape.length-3];const s=i.shape[i.shape.length-2];this.widthFactor=od([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*s;o=Math.round(o);const r=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Vo.resizeBilinear(e,r);case"nearest":return Vo.resizeNearestNeighbor(e,r);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...lS]} are supported`)}})}}jD.className="RandomWidth";Ce(jD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _m(t){return new Wb(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY=le();nY.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var cS;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(cS||(cS={}));var uS;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(uS||(uS={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var dS;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(dS||(dS={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ge(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&F(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY=B2;class Gp extends mx{nextDataId(){return Gp.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new rE(this,so())}write(e,n,i){this.firstUse&&(this.firstUse=!1,le().get("IS_NODE")&&ns(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:i,refCount:1}),s}makeTensorInfo(e,n,i){let s;if(n==="string"&&i!=null&&i.length>0&&au(i[0])){const o=i.map(r=>mr(r));s=this.write(o,e,n)}else s=this.write(i,e,n);return{dataId:s,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,i,s,o){this.data.set(e,{values:n,dtype:s,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:i}=this.data.get(e);if(n==="complex64"){const s=this.readSync(i.real.dataId),o=this.readSync(i.imag.dataId);return Xo(s,o)}return hH(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const i=n.map(s=>Cr(s));return Ct(e.shape,e.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ct(e.shape,e.dtype,n)}makeOutput(e,n,i){return so().makeTensorFromTensorInfo(this.makeTensorInfo(n,i,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:i}=this.data.get(e);i!=null&&(this.disposeData(i.real.dataId,!0),this.disposeData(i.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Ri();return e(),{kernelMs:Ri()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ge([e],"where");const n=this.readSync(e.dataId);return iY(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Gp.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KD(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const sY=t=>{const{x:e}=t.inputs,n=t.backend;Ge(e,"abs");let i=new Float32Array(pe(e.shape));const s=n.data.get(e.dataId).values;return i=KD(s),n.makeOutput(i,e.shape,e.dtype)},oY={kernelName:yf,backendName:"cpu",kernelFunc:sY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dn(t){return(e,n,i,s,o)=>{const r=mt(e,n),a=r.length,l=Ye(r),c=pe(r),u=di(o,c),d=e.length,f=n.length,h=Ye(e),p=Ye(n),m=Al(e,r),g=Al(n,r);if(m.length+g.length===0)for(let v=0;v<u.length;++v)u[v]=t(i[v%i.length],s[v%s.length]);else for(let v=0;v<u.length;++v){const x=Jl(v,a,l),b=x.slice(-d);m.forEach(I=>b[I]=0);const w=mo(b,d,h),y=x.slice(-f);g.forEach(I=>y[I]=0);const C=mo(y,f,p);u[v]=t(i[w],s[C])}return[u,r]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gi(t){const{inputs:e,backend:n}=t,{real:i,imag:s}=e,o=n.data.get(i.dataId).values,r=n.data.get(s.dataId).values,a=n.makeTensorInfo(i.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(i.shape,"float32",o),imag:n.makeTensorInfo(s.shape,"float32",r)},a}const rY={kernelName:kx,backendName:"cpu",kernelFunc:Gi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jh(t,e,n="float32"){if(n==="complex64"){const s=jh(t,e,"float32"),o=jh(t,e,"float32");return Gi({inputs:{real:s,imag:o},backend:t})}const i=hi(pe(e),n);return t.makeTensorInfo(e,n,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function No(t){const{inputs:e,backend:n}=t,{x:i}=e;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const aY={kernelName:ku,backendName:"cpu",kernelFunc:No};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(t){const{inputs:e,backend:n}=t,{input:i}=e,s=n.data.get(i.dataId).complexTensorInfos.real,o=n.data.get(s.dataId).values;return n.makeTensorInfo(s.shape,s.dtype,o)}const lY={kernelName:Zx,backendName:"cpu",kernelFunc:$a};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(t,e,n,i){if(i==="int32"){const s=Int32Array.from(t);return[e,"int32",s]}if(i==="bool"){const s=Oa([0],n),[o,r]=Dn((a,l)=>a!==l?1:0)(e,[],t,s,"bool");return[r,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}function Nr(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{dtype:o}=i;if(o==="complex64"){if(s.dtype==="complex64")return No({inputs:{x:s},backend:n});const u=jh(n,s.shape,s.dtype),d=Nr({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),f=Gi({inputs:{real:d,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),f}if(s.dtype==="complex64"){const u=$a({inputs:{input:s},backend:n}),d=Nr({inputs:{x:u},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(u),d}if(!cE(s.dtype,o)){const u=No({inputs:{x:s},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:o}}const r=n.data.get(s.dataId).values,[a,l,c]=XD(r,s.shape,s.dtype,o);return n.makeTensorInfo(a,l,c)}const cY={kernelName:mu,backendName:"cpu",kernelFunc:Nr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wn(t,e,n,i){return n==null?({inputs:s,backend:o})=>{const{a:r,b:a}=s,l=o;Ge([r,a],t);const c=l.data.get(r.dataId).values,u=l.data.get(a.dataId).values,d=r.dtype==="string"?qo(c):c,f=r.dtype==="string"?qo(u):u,h=i||r.dtype,[p,m]=e(r.shape,a.shape,d,f,h);return l.makeTensorInfo(m,h,p)}:({inputs:s,backend:o})=>{const{a:r,b:a}=s,l=o;if(r.dtype==="complex64"||a.dtype==="complex64"){const c=Nr({inputs:{x:r},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,h=l.data.get(d.dataId).values,p=l.data.get(f.dataId).values,m=Nr({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),v=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,b=l.data.get(v.dataId).values,w=l.data.get(x.dataId).values,[y,C,I]=n(r.shape,a.shape,h,p,b,w),$=l.makeTensorInfo(I,"float32",y),E=l.makeTensorInfo(I,"float32",C),N=Gi({inputs:{real:$,imag:E},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo($),l.disposeIntermediateTensorInfo(E),N}else{const c=l.data.get(r.dataId).values,u=l.data.get(a.dataId).values,d=i||r.dtype,[f,h]=e(r.shape,a.shape,c,u,d);return l.makeTensorInfo(h,d,f)}}}function Gb(t){return(e,n,i,s,o,r)=>{const a=mt(e,n),l=pe(a),c=a.length,u=Ye(a),d=di("float32",l),f=di("float32",l),h=Al(e,a),p=Al(n,a),m=Xo(i,s),g=Xo(o,r),v=e.length,x=Ye(e),b=n.length,w=Ye(n);if(h.length+p.length===0)for(let y=0;y<d.length;y++){const C=y%m.length,I=y%g.length,$=t(m[C*2],m[C*2+1],g[I*2],g[I*2+1]);d[y]=$.real,f[y]=$.imag}else for(let y=0;y<d.length;y++){const C=Jl(y,c,u),I=C.slice(-v);h.forEach(D=>I[D]=0);const $=mo(I,v,x),E=C.slice(-b);p.forEach(D=>E[D]=0);const N=mo(E,b,w),k=t(m[$*2],m[$*2+1],g[N*2],g[N*2+1]);d[y]=k.real,f[y]=k.imag}return[d,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD=Dn((t,e)=>t+e),uY=Gb((t,e,n,i)=>({real:t+n,imag:e+i})),Fl=Wn(Zl,qD,uY),dY={kernelName:Zl,backendName:"cpu",kernelFunc:Fl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hb(t,e,n,i,s){const o=pe(i),r=hi(s,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=s||(o>0?r[l]+=e[a]:r[l]+=1)}return r}function YD(t,e,n,i=!1){const s=t.shape[0],o=t.shape[1],r=Ct([s,n],e.dtype);for(let a=0;a<s;a++)for(let l=0;l<o;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(i?r.set(1,a,c):e.size>0?r.set(r.get(a,c)+e.get(a,l),a,c):r.set(r.get(a,c)+1,a,c))}return r}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JD=Dn((t,e)=>t&e),hY=Wn(Nx,JD),fY={kernelName:Nx,backendName:"cpu",kernelFunc:hY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ko(t){return(e,n,i)=>{const s=wn(n,e.length);for(let o=0;o<e.length;++o)s[o]=t(e[o],i);return s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ht(t,e,n){const i=ko(e);return Lr(t,i,n)}function Lr(t,e,n){return({inputs:i,attrs:s,backend:o})=>{const{x:r}=i;Ge(r,t);const a=o,l=a.data.get(r.dataId).values;let c;if(r.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=qo(l)}else c=l;const u=n||r.dtype,d=e(c,u,s);return a.makeTensorInfo(r.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZD=ko(t=>Math.ceil(t)),pY=Lr(gu,ZD),mY={kernelName:gu,backendName:"cpu",kernelFunc:pY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(t,e,n,i){const s=wn(n,pe(e));if(i&&n!=="string"){let o=0;t.forEach(r=>{const a=pe(r.shape);s.set(r.vals,o),o+=a})}else{let o=0;t.forEach(r=>{const a=n==="string"?qo(r.vals):r.vals;let l=0;for(let c=0;c<r.shape[0];++c){const u=c*e[1]+o;for(let d=0;d<r.shape[1];++d)s[u+d]=a[l++]}o+=r.shape[1]})}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eT=Dn((t,e)=>t===e?1:0),tT=Wn(Pf,eT,null,"bool"),gY={kernelName:Pf,backendName:"cpu",kernelFunc:tT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nT=ko(t=>Math.exp(t)),iT=Lr(Su,nT,"float32"),vY={kernelName:Su,backendName:"cpu",kernelFunc:iT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sT=ko(t=>Math.expm1(t)),xY=Lr(Iu,sT),bY={kernelName:Iu,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oT=ko(t=>Math.floor(t)),yY=Lr($u,oT),wY={kernelName:$u,backendName:"cpu",kernelFunc:yY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rT=Dn((t,e)=>Math.floor(t/e)),CY=Wn(Eu,rT,null,"int32"),SY={kernelName:Eu,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aT(t,e,n,i,s,o,r,a,l){const c=Ct([i,o],n);for(let u=0;u<i;u++){const d=[];let f=0;for(let h=0;h<s;h++){const p=t[u*s+h];f+=p*r[h],d.push(p)}if(f<0||f>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let h=0;h<o;h++)c.values[u*o+h]=e.get(...e.indexToLoc(f*o+h))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lT(t,e,n){const i=Ct(n,t.dtype);for(let s=0;s<i.size;++s){const r=i.indexToLoc(s).slice(),a=r[0],l=r[2],c=e.locToIndex([a,l]);r[2]=e.values[c];const u=t.locToIndex(r);0<=u&&u<t.values.length&&(i.values[s]=t.values[u])}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cT=Dn((t,e)=>t>e?1:0),IY=Wn(zf,cT,null,"bool"),$Y={kernelName:zf,backendName:"cpu",kernelFunc:IY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uT=Dn((t,e)=>t>=e?1:0),EY=Wn(Nu,uT,null,"bool"),NY={kernelName:Nu,backendName:"cpu",kernelFunc:EY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dT=Dn((t,e)=>t<e?1:0),kY=Wn(Vf,dT,null,"bool"),DY={kernelName:Vf,backendName:"cpu",kernelFunc:kY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hT=Dn((t,e)=>t<=e?1:0),TY=Wn(Wf,hT,null,"bool"),RY={kernelName:Wf,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(t,e,n){const i=(e-t)/(n-1),s=hi(n,"float32");s[0]=t;for(let o=1;o<s.length;o++)s[o]=s[o-1]+i;return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pT=ko(t=>Math.log(t)),_Y=Lr(_u,pT),AY={kernelName:_u,backendName:"cpu",kernelFunc:_Y};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(t,e,n,i){const s=di(i,pe(n));for(let o=0;o<s.length;++o){const r=o*e;let a=t[r];for(let l=0;l<e;++l){const c=t[r+l];(Number.isNaN(c)||c>a)&&(a=c)}s[o]=a}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gT=Dn((t,e)=>Math.max(t,e)),OY=Wn(Ou,gT),PY={kernelName:Ou,backendName:"cpu",kernelFunc:OY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vT=Dn((t,e)=>Math.min(t,e)),MY=Wn(Pu,vT),FY={kernelName:Pu,backendName:"cpu",kernelFunc:MY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ub=Dn((t,e)=>t*e),LY=Gb((t,e,n,i)=>({real:t*n-e*i,imag:t*i+e*n})),Hp=Wn(Fu,Ub,LY),zY={kernelName:Fu,backendName:"cpu",kernelFunc:Hp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(t,e,n){const i=Tr(-1,n);return Ub([],e,i,t,n)}function BY(t){const{inputs:e,backend:n}=t,{x:i}=e;Ge(i,"neg");const s=n.data.get(i.dataId).values,[o,r]=xT(s,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,o)}const VY={kernelName:Qf,backendName:"cpu",kernelFunc:BY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bT=Dn((t,e)=>t!==e?1:0),WY=Wn(ep,bT,null,"bool"),GY={kernelName:ep,backendName:"cpu",kernelFunc:WY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jb(t,e,n,i,s){const o=e.length,r=pe(e),a=Ye(e),l=Ye(s),c=di(n,pe(s));for(let u=0;u<r;++u){const d=Jl(u,o,a),f=new Array(d.length);for(let p=0;p<f.length;p++)f[p]=d[i[p]];const h=mo(f,o,l);c[h]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(t){const{inputs:e,attrs:n,backend:i}=t,{x:s}=e,{perm:o}=n;Ge(s,"transpose");const r=s.shape.length,a=new Array(r);for(let d=0;d<a.length;d++)a[d]=s.shape[o[d]];const l=i.data.get(s.dataId).values,c=jb(l,s.shape,s.dtype,o,a);return{dataId:i.write(c,a,s.dtype),shape:a,dtype:s.dtype}}const HY={kernelName:cl,backendName:"cpu",kernelFunc:Li};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(t,e,n,i){const[s,o]=Yn(t,i),r=qi(e,"int32"),a=hi(pe(s),r),l=pe(o);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let f=0;f<l;++f)d*=n[u+f];a[c]=d}return{outVals:a,outShape:s,outDtype:r}}function UY(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i;Ge(s,"prod");const a=s.shape.length,l=St(o,s.shape),c=mn(l,a);let u=l,d=s;const f=[];c!=null&&(d=Li({inputs:{x:s},backend:n,attrs:{perm:c}}),f.push(d),u=Nn(u.length,a));const h=n.data.get(d.dataId).values,{outVals:p,outShape:m,outDtype:g}=yT(d.shape,d.dtype,h,u);let v=m;return r&&(v=Rn(m,l)),f.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(v,g,p)}const jY={kernelName:rp,backendName:"cpu",kernelFunc:UY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(t,e,n){t.forEach((i,s)=>{if(i<0||i>=n){const o=Jl(s,e.length,Ye(e)).join(",");throw new Error(`indices[${o}] = ${i} is not in [0, ${n})`)}})}function XY(t,e){for(let n=0;n<t.length;++n){const i=t[n],s=n===t.length-1?e:t[n+1].length;if(i.length===0)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>s)throw new Error("Ragged splits must not point past values");for(let o=1;o<i.length;++o)if(i[o-1]>i[o])throw new Error("Ragged splits must be sorted in ascending order")}}function qY(t,e,n,i){const s=[];let o=0;const r=e.length-1+n.length,a=new Array(r).fill(null).map(()=>[0]);XY(n,i);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<t.length;++c){let u=t[c],d=t[c]+1;for(let f=0;f<n.length;++f){const h=n[f],p=f+e.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-h[u];for(let v=u;v<d;++v)a[p].push(h[v+1]+g)}u=h[u],d=h[d]}d!==u&&(s.push([u,d]),o+=d-u)}return{outSplits:a,valueSlices:s,numValues:o}}function YY(t){const e=[];for(let n=0;n<t.length;++n){const i=t[n].length,s=wn("int32",i);e.push(s),t[n].forEach((o,r)=>s[r]=o)}return e}function hS(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let i=e;i<t.length;i++)n[e-1]*=t[i];return n}function JY(t,e,n,i,s,o){const r=hS(e,2)[1],a=hS(o,2)[1];let l=0;for(const c of n)for(let u=c[0];u<c[1];++u){for(let d=0;d<i;++d)s[l*a+d]=t[u*r+d];++l}}function ZY(t,e,n,i,s){const o=e.slice();o[0]=s;const r=wn(n,pe(o)),a=t.length,l=a===0?0:a/e[0];return JY(t,e,i,l,r,o),[r,o]}function wT(t,e,n,i,s,o,r,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(KY(o,r,l),i.length===0)throw new Error("params.rank must be nonzero");const c=i[0],{outSplits:u,valueSlices:d,numValues:f}=qY(o,r,t,c),h=YY(u),p=ZY(n,i,s,d,f);return[h,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fS=2147483647;function CT(t,e,n,i,s,o,r){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(r.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=s.length===0,c=r.length===0,u=[];a||u.push(e[0]),l||u.push(s[0]),c||u.push(r[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],f=wn("int32",d+1);f[0]=0;for(let g=0;g<d;++g){const v=a?t[0]:t[g],x=l?i[0]:i[g],b=c?o[0]:o[g];if(b===0)throw new Error("Requires delta != 0");let w;if(b>0&&x<v||b<0&&x>v)w=0;else if(w=Math.ceil(Math.abs((x-v)/b)),w>fS)throw new Error(`Requires ((limit - start) / delta) <= ${fS}`);f[g+1]=f[g]+w}const h=f[d],p=wn(n,h);let m=0;for(let g=0;g<d;++g){const v=f[g+1]-f[g];let x=a?t[0]:t[g];const b=c?o[0]:o[g];for(let w=0;w<v;++w)p[m++]=x,x+=b}return[f,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vs=Ws;class Kh{constructor(e,n,i,s,o,r,a,l,c,u){this.shape=e,this.shapeShape=n,this.values=i,this.valuesShape=s,this.valuesDType=o,this.defaultValue=r,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=aN(u),this.raggedRank=lN(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===vs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===vs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case vs.VALUE_ROWIDS:return Kh.getMaxWidthValueRowID(n);case vs.ROW_SPLITS:return Kh.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${vs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let i=0;for(let s=0;s<n-1;++s){const o=e[s+1]-e[s];o>i&&(i=o)}return i}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let i=0,s=e[0],o=0;for(let r=1;r<n;++r){const a=e[r];a!==s&&(s=a,o=Math.max(r-i,o),i=r)}return Math.max(n-i,o)}tensorShapeFromTensor(e,n,i=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return mS(e,i)}calculateOutputSize(e){const n=this.valuesShape,i=this.defaultValueShape;cN(i,n);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=rN(this.raggedRank,s,n);r[0]<0&&(r[0]=e);for(let a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}calculateFirstParentOutputIndex(e,n,i){const s=Math.min(e,i),o=[];let r=0;for(let a=0;a<s;++a,r+=n)o.push(r);for(let a=s;a<e;++a)o.push(-1);return F(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,n,i,s){const o=e.length,r=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let c=Math.min(s,l),u=n[a];u===-1&&(c=0);for(let d=0;d<c;++d)r.push(u),u+=i;for(let d=0;d<l-c;++d)r.push(-1)}if(o>0&&r.length!==e[o-1])throw new Error("Invalid row split size.");return r}calculateOutputIndexValueRowID(e,n,i,s){const o=e.length,r=[];if(o===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];r.push(c);for(let u=1;u<o;++u){const d=e[u];if(d===l)c>=0&&(++a,a<s?c+=i:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}r.push(c)}if(r.length!==e.length)throw new Error("Invalid row ids.");return r}calculateOutputIndex(e,n,i,s){const o=this.getRowPartitionTensor(e),r=this.getRowPartitionTypeByDimension(e);switch(r){case vs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,n,i,s);case vs.ROW_SPLITS:if(o.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(o,n,i,s);default:throw new Error(`Unsupported partition type: ${vs[r]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case vs.FIRST_DIM_SIZE:return e[0];case vs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${vs[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),i=this.calculateOutputSize(n),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let l=s.length-2;l>=0;--l)s[l]=s[l+1]*i[l+1];const o=mS(i,!1),r=wn(this.valuesDType,pe(o));if(s[0]*i[0]>0){let l=this.calculateFirstParentOutputIndex(n,s[0],i[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,s[c],i[c]);this.setOutput(this.raggedRank,l,r,o)}return[o,r]}setOutput(e,n,i,s){if(i.length===0)return;const o=this.values,r=i;let a=s.slice();a=a.slice(e+1);const l=pe(a),c=n.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const p=this.defaultValueShape;ie(()=>{const m=Z(u,p);u=_c(m,a).dataSync()})}let d=0,f=0,h=0;for(let p=0;p<=c;++p){let m=p<c?n[p]:-1;if(m===h){++h;continue}if(f<h){const g=o.subarray(d*l),v=r.subarray(f*l),x=(h-f)*l;pS(v,g,x)}if(p>=c){const g=i.length;m=Math.floor(g/l)}if(m>h)if(this.defaultValue.length===1)r.subarray(h*l,m*l).fill(this.defaultValue[0]),h=m;else for(;m>h;){const g=r.slice(h*l);pS(g,u,l),++h}m<0?(d=p+1,f=h):(d=p,f=h,h=f+1)}}}function pS(t,e,n){for(let i=0;i<n;i++)t[i]=e[i]}function mS(t,e){const n=[];for(let i of t){if(i<0){if(!e)throw new Error(`Dimension ${i} must be >= 0`);if(i<-1)throw new Error(`Dimension ${i} must be >= -1`);i=-1}n.push(i)}return n}function ST(t,e,n,i,s,o,r,a,l,c){return new Kh(t,e,n,i,s,o,r,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IT(t,e,n,i){const s=t===e,o=t<e&&n<0,r=e<t&&n>1;if(s||o||r)return hi(0,i);const a=Math.abs(Math.ceil((e-t)/n)),l=hi(a,i);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $T=ko(t=>1/Math.sqrt(t)),QY=Lr(Gu,$T),eJ={kernelName:Gu,backendName:"cpu",kernelFunc:QY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ta(t,e,n,i,s,o,r,a,l,c){const u=[i/s,s],d=t.values,f=e.values;if(i===0)return Ct(n,e.dtype);const h=l instanceof ti?l:Ct(u,e.dtype);typeof l=="string"||typeof l=="number"?h.values.fill(l):typeof l=="boolean"&&h.values.fill(+l);for(let p=0;p<o;p++){const m=[];let g=0;for(let v=0;v<r;v++){const x=d[p*r+v];m.push(x),g+=x*a[v]}if(g<0||g>=i/s)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let v=0;v<s;v++)c?h.values[g*s+v]+=f[p*s+v]:h.values[g*s+v]=e.rank===0?f[0]:f[p*s+v]}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tJ=ko(t=>1/(1+Math.exp(-t))),ET=Ht(Xu,t=>1/(1+Math.exp(-t))),nJ={kernelName:Xu,backendName:"cpu",kernelFunc:ET};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(t,e,n,i,s){const o=Z0(i,e,n),r=pe(n),a=Ye(i);if(o){const d=Q0(e,a);return s==="string"?t.slice(d,d+r):t.subarray(d,d+r)}const l=s==="string"?qo(t):t,c=Ct(i,s,l),u=Ct(n,s);for(let d=0;d<u.size;++d){const f=u.indexToLoc(d),h=f.map((p,m)=>p+e[m]);u.set(c.get(...h),...f)}return s==="string"?DN(u.values):u.values}function Ea(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{begin:o,size:r}=i;Ge(s,"slice");const[a,l]=Dp(s,o,r);Y0(s,a,l);const c=n.data.get(s.dataId).values,u=NT(c,a,l,s.shape,s.dtype);return n.makeTensorInfo(l,s.dtype,u)}const iJ={kernelName:hp,backendName:"cpu",kernelFunc:Ea};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kT(t,e,n,i,s,o,r){const a=e[0],l=o[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(gN(a));const g=wn(n,0),v=wn(s,0);return[g,[0,d],v,c,u]}let f=!0,h=0;const p=new Array(l).fill(0);for(let g=0;g<a;++g){const v=t[g*d];if(v<0)throw new Error(vN(g,v));if(v>=l)throw new Error(xN(g,v,l));++p[v],f=f&&v>=h,h=v}let m=!0;for(let g=0;g<l;++g){const v=p[g]===0;c[g]=v,m=m&&!v,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&f){const g=t,v=i;for(let x=0;x<a;++x)u[x]=x;return[g,[a,d],v,c,u]}else{const g=p[l-1],v=wn(n,g*d),x=wn(s,g),b=new Array(l).fill(0);for(let w=0;w<a;++w){const y=t[w*d],C=b[y],I=(y===0?0:p[y-1])+C;b[y]++;for(let $=0;$<d;++$)v[I*d+$]=t[w*d+$];x[I]=i[w],u[w]=I}for(let w=0;w<l;++w)if(b[w]===0){const C=w===0?0:p[w-1];v[C*d+0]=w;for(let I=1;I<d;++I)v[C*d+I]=0;x[C]=r}return[v,[g,d],x,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DT(t,e,n,i,s){const o=pe(i),r=e[0],a=s.length,l=[];let c=1,u=-1;for(let g=0;g<a;++g){const v=s[g];if(v===-1){if(u!==-1)throw new Error(bN(u,g));u=g,l.push(1)}else{if(v<0)throw new Error(yN(g,v));c*=v,l.push(v)}}if(u!==-1){if(c<=0)throw new Error(wN());const g=Math.trunc(o/c);if(c*g!==o)throw new Error(CN(i,l));l[u]=g}if(pe(l)!==o)throw new Error(SN(i,l));const f=i.length,h=[];if(f>0){h[f-1]=1;for(let g=f-2;g>=0;--g)h[g]=h[g+1]*i[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*l[g+1]}const m=wn(n,r*a);for(let g=0;g<r;++g){let v=0;for(let x=0;x<f;++x)v+=t[g*f+x]*h[x];for(let x=0;x<a;++x)m[g*a+x]=Math.trunc(v/p[x]),v%=p[x]}return[m,[r,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kb(t,e,n,i,s,o=!1,r=0){const a=i.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?s[a-1]+1:0;if(d<0)throw new Error(Bg());const f=e.slice();f[0]=d;const h=f.reduce((b,w)=>b*w,1),p=wn(n,h);if(a===0)return d>0&&p.fill(r),[p,f];if(d<=0)throw new Error(Bg());let m=0,g=1,v=0,x=s[m];for(;;){let b=0;if(g<a){if(b=s[g],x===b){++g;continue}if(x>=b)throw new Error(IN())}if(x<0||x>=d)throw new Error($N(x,d));x>v&&p.fill(r,v*c,x*c);for(let w=m;w<g;++w){const y=i[w];if(y<0||y>=l[0])throw new Error(EN(w,i[w],l[0]));for(let C=0;C<c;C++)p[x*c+C]+=t[y*c+C]}if(o)for(let w=0;w<c;w++)p[x*c+w]/=g-m;if(m=g,++g,v=x+1,x=b,g>a)break}return v<d&&p.fill(r,v*c,d*c),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sJ=ko(t=>Math.sqrt(t)),oJ=Ht(Yu,t=>Math.sqrt(t)),rJ={kernelName:Yu,backendName:"cpu",kernelFunc:oJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TT=Dn((t,e)=>{const n=t-e;return n*n}),aJ=Wn(Ju,TT),lJ={kernelName:Ju,backendName:"cpu",kernelFunc:aJ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RT=ko((t,e)=>{const{pattern:n,replaceGlobal:i,rewrite:s}=e;return t.replace(new RegExp(n,i?"g":""),s)}),cJ=Lr(n0,RT),uJ={kernelName:n0,backendName:"cpu",kernelFunc:cJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _T(t,e,n,i){const s=Ct(t,e.dtype);for(let o=0;o<s.size;o++){const r=s.indexToLoc(o),a=new Array(r.length);for(let l=0;l<a.length;l++)a[l]=r[l]*n[l]+i[l];s.set(e.get(...a),...r)}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dJ{constructor(e,n,i,s,o,r){this.separator=mr(e),this.nGramWidths=n,this.leftPad=mr(i),this.rightPad=mr(s),this.padWidth=o,this.preserveShort=r}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const i=this.getPadWidth(n);return Math.max(0,e+2*i-n+1)}createNGrams(e,n,i,s,o,r){for(let a=0;a<o;++a){const l=this.getPadWidth(r),c=Math.max(0,l-a),u=Math.max(0,l-(o-(a+1))),d=r-(c+u),f=n+(c>0?0:a-l);let h=0;h+=c*this.leftPad.length;for(let x=0;x<d;++x)h+=e[f+x].length;h+=u*this.rightPad.length;const p=c+u+d-1;h+=p*this.separator.length,i[s+a]=new Uint8Array(h);const m=i[s+a];let g=0;const v=x=>x.forEach(b=>m[g++]=b);for(let x=0;x<c;++x)v(this.leftPad),v(this.separator);for(let x=0;x<d-1;++x)v(e[f+x]),v(this.separator);if(d>0){v(e[f+d-1]);for(let x=0;x<u;++x)v(this.separator),v(this.rightPad)}else{for(let x=0;x<u-1;++x)v(this.rightPad),v(this.separator);v(this.rightPad)}}}compute(e,n){const i=e.length,s=n.length;if(s>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<s;++c){let u=n[c]>=l;if(u=u&&n[c]<=i,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${i}]`);l=n[c]}if(l!==i)throw new Error(`Last split value must be data size. Expected ${i}, got ${l}`)}const o=s-1,r=wn("int32",s);if(i===0||s===0){const l=new Array(i);for(let c=0;c<=o;++c)r[c]=0;return[l,r]}r[0]=0;for(let l=1;l<=o;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),r[l]=r[l-1]+u}const a=new Array(r[o]);for(let l=0;l<o;++l){const c=n[l];let u=r[l];if(this.nGramWidths.forEach(d=>{const f=n[l+1]-n[l],h=this.getNumNGrams(f,d);this.createNGrams(e,c,a,u,h,d),u+=h}),this.preserveShort&&u===r[l]){const d=n[l+1]-n[l];if(d===0)continue;const f=d+2*this.padWidth;this.createNGrams(e,c,a,u,1,f)}}return[a,r]}}function AT(t,e,n,i,s,o,r,a){return new dJ(n,i,s,o,r,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(t,e,n,i){if(!t.length)return;if(e.length===0){for(let o=0;o<t.length;++o)i.push(t.subarray(o,o+1));return}if(e.length===1){const o=e[0];let r=t.indexOf(o);for(;r!==-1;){const a=t.subarray(0,r);(!n||a.length!==0)&&i.push(a),t=t.subarray(r+1),r=t.indexOf(o)}(!n||t.length!==0)&&i.push(t);return}let s=0;for(let o=0;o<t.length+1;o++)if(o===t.length||e.indexOf(t[o])!==-1){const r=t.subarray(s,o);(!n||r.length!==0)&&i.push(r),s=o+1}}function OT(t,e,n){const i=t.length,s=[];let o=0,r=0;const a=new Array(i);for(let f=0;f<i;++f){const h=s.length;hJ(t[f],e,n,s);const p=s.length-h;a[f]=p,o+=p,r=Math.max(r,p)}const l=wn("int32",o*2),c=new Array(o),u=[i,r];let d=0;for(let f=0;f<i;++f)for(let h=0;h<a[f];++h)l[d*2]=f,l[d*2+1]=h,c[d]=s[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(t,e){const n=wn("int32",t.length);for(let i=0;i<t.length;++i)n[i]=RH(t[i]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MT=Dn((t,e)=>t-e),fJ=Gb((t,e,n,i)=>({real:t-n,imag:e-i})),Xb=Wn(Zu,MT,fJ),pJ={kernelName:Zu,backendName:"cpu",kernelFunc:Xb};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FT(t,e){const n=new Array(t.rank);for(let s=0;s<n.length;s++)n[s]=t.shape[s]*e[s];const i=Ct(n,t.dtype);for(let s=0;s<i.values.length;++s){const o=i.indexToLoc(s),r=new Array(t.rank);for(let l=0;l<r.length;l++)r[l]=o[l]%t.shape[l];const a=t.locToIndex(r);i.values[s]=t.values[a]}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function LT(t,e,n=0,i=t.length-1){for(;i>n;){if(i-n>600){const a=i-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),f=Math.max(n,Math.floor(e-l*u/a+d)),h=Math.min(i,Math.floor(e+(a-l)*u/a+d));LT(t,e,f,h)}const s=t[e];let o=n,r=i;for(Qa(t,n,e),Sc(t[i],s)>0&&Qa(t,n,i);o<r;){for(Qa(t,o,r),o++,r--;Sc(t[o],s)<0;)o=o+1;for(;Sc(t[r],s)>0;)r=r-1}Sc(t[n],s)===0?Qa(t,n,r):(r=r+1,Qa(t,r,i)),r<=e&&(n=r+1),e<=r&&(i=r-1)}}function zT(t,e,n,i,s){const o=e[e.length-1],[r,a]=[t.length/o,o],l=di(n,r*i),c=di("int32",r*i);for(let d=0;d<r;d++){const f=d*a,h=t.subarray(f,f+a);let p=new Array(h.length);h.forEach((x,b)=>p[b]={value:x,index:b}),i<p.length&&(LT(p,i),p=p.slice(0,i)),s&&p.sort(Sc);const m=d*i,g=l.subarray(m,m+i),v=c.subarray(m,m+i);for(let x=0;x<i;x++)g[x]=p[x].value,v[x]=p[x].index}const u=e.slice();return u[u.length-1]=i,[Ct(u,n,l),Ct(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BT(t,e,n,i){const s=St(e,n)[0],o=[1,n[0],1];for(let p=0;p<s;p++)o[0]*=n[p];o[1]=n[s];for(let p=s+1;p<n.length;p++)o[2]*=n[p];const r=new Map,a=new Int32Array(n[s]),l=new ti(o,i,t),c=[],u=o[0]===1&&o[2]===1;for(let p=0;p<n[s];p++){let m;if(u)m=t[p].toString();else{const v=[];for(let x=0;x<o[0];x++)for(let b=0;b<o[2];b++)v.push(l.get(x,p,b));m=v.join(",")}const g=r.get(m);if(g!=null)a[p]=g;else{const v=r.size;r.set(m,v),a[p]=v,c.push(p)}}const d=o.slice();d[1]=r.size;const f=new ti(d,i);c.forEach((p,m)=>{for(let g=0;g<o[0];g++)for(let v=0;v<o[2];v++)f.set(l.get(g,p,v),g,m,v)});const h=n.slice();return h[s]=d[1],{outputValues:f.values,outputShape:h,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mJ=Object.freeze(Object.defineProperty({__proto__:null,addImpl:qD,bincountImpl:Hb,bincountReduceImpl:YD,bitwiseAndImpl:JD,castImpl:XD,ceilImpl:ZD,concatImpl:QD,equalImpl:eT,expImpl:nT,expm1Impl:sT,floorDivImpl:rT,floorImpl:oT,gatherNdImpl:aT,gatherV2Impl:lT,greaterEqualImpl:uT,greaterImpl:cT,lessEqualImpl:hT,lessImpl:dT,linSpaceImpl:fT,logImpl:pT,maxImpl:mT,maximumImpl:gT,minimumImpl:vT,multiplyImpl:Ub,negImpl:xT,notEqualImpl:bT,prodImpl:yT,raggedGatherImpl:wT,raggedRangeImpl:CT,raggedTensorToTensorImpl:ST,rangeImpl:IT,rsqrtImpl:$T,scatterImpl:ta,sigmoidImpl:tJ,simpleAbsImpl:KD,sliceImpl:NT,sparseFillEmptyRowsImpl:kT,sparseReshapeImpl:DT,sparseSegmentReductionImpl:Kb,sqrtImpl:sJ,squaredDifferenceImpl:TT,staticRegexReplaceImpl:RT,stridedSliceImpl:_T,stringNGramsImpl:AT,stringSplitImpl:OT,stringToHashBucketFastImpl:PT,subImpl:MT,tileImpl:FT,topKImpl:zT,transposeImpl:jb,uniqueImpl:BT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */n2("cpu",()=>new Gp,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VT=Ht(wu,t=>t>=0?t:Math.exp(t)-1),gJ={kernelName:wu,backendName:"cpu",kernelFunc:VT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WT(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{alpha:o}=i;Ge([s],"leakyRelu");const r=pe(s.shape),a=n.data.get(s.dataId).values,l=di("float32",r);for(let c=0;c<a.length;c++)l[c]=a[c]<0?o*a[c]:a[c];return n.makeTensorInfo(s.shape,"float32",l)}const vJ={kernelName:Bf,backendName:"cpu",kernelFunc:WT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ=Dn((t,e)=>t<0?e*t:t);function GT(t){const{inputs:e,backend:n}=t,{x:i,alpha:s}=e;Ge([i,s],"prelu");const o=n.data.get(i.dataId).values,r=n.data.get(s.dataId).values,[a,l]=xJ(i.shape,s.shape,o,r,"float32");return n.makeTensorInfo(l,"float32",a)}const bJ={kernelName:op,backendName:"cpu",kernelFunc:GT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HT=Ht(Bu,t=>Math.max(0,t)),yJ={kernelName:Bu,backendName:"cpu",kernelFunc:HT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UT=Ht(Vu,t=>Math.min(Math.max(0,t),6)),wJ={kernelName:Vu,backendName:"cpu",kernelFunc:UT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(t,e,n,i,s){if(n==="linear")return No({inputs:{x:e},backend:t});if(n==="relu")return HT({inputs:{x:e},backend:t});if(n==="elu")return VT({inputs:{x:e},backend:t});if(n==="relu6")return UT({inputs:{x:e},backend:t});if(n==="prelu")return GT({inputs:{x:e,alpha:i},backend:t});if(n==="leakyrelu")return WT({inputs:{x:e},backend:t,attrs:{alpha:s}});if(n==="sigmoid")return ET({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{shape:o}=i,r=pe(s.shape),a=lE(o,r),l=pe(a);F(r===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${s.shape}) has ${r} elements. The new shape and old shape must have the same number of elements.`),n.incRef(s.dataId);const c=n.data.get(s.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:s.dataId,shape:a,dtype:s.dtype}}const CJ={kernelName:ap,backendName:"cpu",kernelFunc:tn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jT(t){const{inputs:e,backend:n,attrs:i}=t,{a:s,b:o}=e,{transposeA:r,transposeB:a}=i;Ge([s,o],"matMul");const l=s.shape.length,c=o.shape.length,u=r?s.shape[l-2]:s.shape[l-1],d=a?o.shape[c-1]:o.shape[c-2],f=r?s.shape[l-1]:s.shape[l-2],h=a?o.shape[c-2]:o.shape[c-1],p=s.shape.slice(0,-2),m=o.shape.slice(0,-2),g=pe(p),v=pe(m),b=mt(s.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,h]);F(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${s.shape} and ${o.shape} and transposeA=${r} and transposeB=${a} must match.`);const w=r?[g,u,f]:[g,f,u],y=a?[v,h,d]:[v,d,h],C=tn({inputs:{x:s},backend:n,attrs:{shape:w}}),I=tn({inputs:{x:o},backend:n,attrs:{shape:y}}),$=r?C.shape[1]:C.shape[2],E=r?C.shape[2]:C.shape[1],N=a?I.shape[1]:I.shape[2],k=Math.max(g,v),D=n.data.get(C.dataId).values,_=n.data.get(I.dataId).values,R=Ye(C.shape),T=Ye(I.shape),[A,O,P]=r?[R[0],1,R[1]]:[R[0],R[1],1],[M,z,L]=a?[1,T[1],T[0]]:[T[1],1,T[0]],W=E*N,B=Ct([k,E,N],C.dtype),q=B.values,H=n.blockSize;for(let ne=0;ne<k;ne++){const te=ne%g,ae=ne%v;for(let re=0;re<E;re+=H){const ee=Math.min(re+H,E);for(let j=0;j<N;j+=H){const Y=Math.min(j+H,N);for(let se=0;se<$;se+=H){const J=Math.min(se+H,$);for(let ue=re;ue<ee;ue++)for(let oe=j;oe<Y;oe++){let be=0;for(let de=se;de<J;de++){const Ie=D[te*A+ue*O+de*P],ge=_[de*M+oe*z+ae*L];be+=Ie*ge}q[ne*W+(ue*N+oe)]+=be}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(I),n.makeTensorInfo(b,B.dtype,B.values)}const SJ={kernelName:$f,backendName:"cpu",kernelFunc:jT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IJ(t){const{inputs:e,backend:n,attrs:i}=t,{a:s,b:o,bias:r,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=i;let f,h,p;const m=[];f=jT({inputs:{a:s,b:o},attrs:{transposeA:l,transposeB:c},backend:n}),r&&(h=Fl({inputs:{a:f,b:r},backend:n}),m.push(f),f=h),u&&(p=Xh(n,f,u,a,d),m.push(f),f=p);for(const v of m)n.disposeIntermediateTensorInfo(v);return f}const $J={kernelName:$h,backendName:"cpu",kernelFunc:IJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ=Ht(lu,t=>Math.acos(t)),NJ={kernelName:lu,backendName:"cpu",kernelFunc:EJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kJ=Ht(cu,t=>Math.acosh(t)),DJ={kernelName:cu,backendName:"cpu",kernelFunc:kJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TJ(t){const{inputs:e,backend:n}=t,i=e;Ge(e,"addN");const s=i.map(a=>n.data.get(a.dataId).values),o=Ct(i[0].shape,i[0].dtype),r=o.values;for(let a=0;a<i.length;a++){const l=s[a];for(let c=0;c<r.length;c++)r[c]+=l[c]}return n.makeTensorInfo(o.shape,o.dtype,o.values)}const RJ={kernelName:wx,backendName:"cpu",kernelFunc:TJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _J(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i;Ge(s,"all");const a=St(o,s.shape);let l=a;const c=mn(l,s.shape.length);let u=s;c!=null&&(u=Li({inputs:{x:s},backend:n,attrs:{perm:c}}),l=Nn(l.length,s.shape.length)),ii("all",l,u.shape.length);const[d,f]=Yn(u.shape,l),h=pe(f),p=hi(pe(d),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const x=v*h;let b=m[x];for(let w=0;w<h;++w){const y=m[x+w];b=b&&y}p[v]=b}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(r){const v=Rn(d,a),x=tn({inputs:{x:g},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(g),x}return g}const AJ={kernelName:Cx,backendName:"cpu",kernelFunc:_J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OJ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i;Ge(s,"any");const a=St(o,s.shape);let l=a;const c=mn(l,s.shape.length);let u=s;c!=null&&(u=Li({inputs:{x:s},backend:n,attrs:{perm:c}}),l=Nn(l.length,s.shape.length)),ii("any",l,u.shape.length);const[d,f]=Yn(u.shape,l),h=pe(f),p=hi(pe(d),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const x=v*h;let b=m[x];for(let w=0;w<h;++w){const y=m[x+w];b=b||y}p[v]=b}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(r){const v=Rn(d,a),x=tn({inputs:{x:g},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(g),x}return g}const PJ={kernelName:Sx,backendName:"cpu",kernelFunc:OJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o}=i;Ge(s,"argMax");let r=St(o,s.shape);const a=mn(r,s.shape.length);let l=s;const c=[];a!=null&&(l=Li({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(l),r=Nn(r.length,l.shape.length)),r=[r[0]],ii("argMax",r,l.shape.length);const[u,d]=Yn(l.shape,r),f=pe(u),h=hi(f,"int32"),p=pe(d),m=n.data.get(l.dataId).values;for(let g=0;g<h.length;++g){const v=g*p;let x=m[v],b=0;for(let w=0;w<p;++w){const y=m[v+w];y>x&&(x=y,b=w)}h[g]=b}return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(u,"int32",h)}const FJ={kernelName:wf,backendName:"cpu",kernelFunc:MJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o}=i;Ge(s,"argMin");let r=St(o,s.shape);const a=mn(r,s.shape.length);let l=s;const c=[];a!=null&&(l=Li({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(l),r=Nn(r.length,l.shape.length)),r=[r[0]],ii("argMin",r,l.shape.length);const[u,d]=Yn(l.shape,r),f=pe(u),h=hi(f,"int32"),p=pe(d),m=n.data.get(l.dataId).values;for(let g=0;g<h.length;++g){const v=g*p;let x=m[v],b=0;for(let w=0;w<p;++w){const y=m[v+w];y<x&&(x=y,b=w)}h[g]=b}return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(u,"int32",h)}const zJ={kernelName:Cf,backendName:"cpu",kernelFunc:LJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BJ=Ht(uu,t=>Math.asin(t)),VJ={kernelName:uu,backendName:"cpu",kernelFunc:BJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WJ=Ht(du,t=>Math.asinh(t)),GJ={kernelName:du,backendName:"cpu",kernelFunc:WJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HJ=Ht(hu,t=>Math.atan(t)),UJ={kernelName:hu,backendName:"cpu",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jJ=Dn((t,e)=>Math.atan2(t,e)),KJ=Wn(pu,jJ),XJ={kernelName:pu,backendName:"cpu",kernelFunc:KJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qJ=Ht(fu,t=>Math.atanh(t)),YJ={kernelName:fu,backendName:"cpu",kernelFunc:qJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(t,e,n,i,s,o){const r=s.strideHeight,a=s.strideWidth,l=s.dilationHeight,c=s.dilationWidth,u=s.effectiveFilterHeight,d=s.effectiveFilterWidth,f=s.padInfo.top,h=s.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Ct(s.outShape,n),g=m.values,v=s.outShape[1]*s.outShape[2]*s.outShape[3],x=s.outShape[2]*s.outShape[3],b=s.outShape[3];for(let w=0;w<s.batchSize;++w){const y=w*v,C=w*i[0];for(let I=0;I<s.inChannels;++I)for(let $=0;$<s.outHeight;++$){const E=$*r-f,N=Math.max(0,E),k=Math.min(s.inHeight,u+E),D=y+$*x;for(let _=0;_<s.outWidth;++_){const R=_*a-h,T=Math.max(0,R),A=Math.min(s.inWidth,d+R);let O=p,P=0,M=0;for(let L=N;L<k;L+=l){const W=C+L*i[1];for(let B=T;B<A;B+=c){const q=W+B*i[2],H=t[q+I];o==="max"&&H>O?O=H:o==="avg"&&(P+=H,M++)}if(isNaN(O))break}const z=D+_*b+I;g[z]=o==="avg"?P/M:O}}}return m}function KT(t,e,n,i,s=!1,o=!1){const r=Ct(i.outShape,"int32"),a=i.strideHeight,l=i.strideWidth,c=i.dilationHeight,u=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=i.padInfo.top,p=i.padInfo.left,m=Ct(e,n,t);for(let g=0;g<i.batchSize;++g)for(let v=0;v<i.inChannels;++v)for(let x=0;x<i.outHeight;++x){const b=x*a-h;let w=b;for(;w<0;)w+=c;const y=Math.min(i.inHeight,d+b);for(let C=0;C<i.outWidth;++C){const I=C*l-p;let $=I;for(;$<0;)$+=u;const E=Math.min(i.inWidth,f+I);let N=Number.NEGATIVE_INFINITY,k=-1;for(let D=w;D<y;D+=c){const _=D-b;for(let R=$;R<E;R+=u){const T=R-I,A=m.get(g,D,R,v);A>N&&(N=A,s?k=o?((g*i.inHeight+D)*i.inWidth+R)*i.inChannels+v:(D*i.inWidth+R)*i.inChannels+v:k=_*f+T)}}r.set(k,g,x,C,v)}}return r}function XT(t,e,n,i,s,o){const r=s.strideDepth,a=s.strideHeight,l=s.strideWidth,c=s.dilationDepth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterDepth,h=s.effectiveFilterHeight,p=s.effectiveFilterWidth,m=s.padInfo.front,g=s.padInfo.top,v=s.padInfo.left,x=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Ct(s.outShape,n),w=b.values,y=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],C=s.outShape[2]*s.outShape[3]*s.outShape[4],I=s.outShape[3]*s.outShape[4],$=s.outShape[4];for(let E=0;E<s.batchSize;++E){const N=E*y,k=E*i[0];for(let D=0;D<s.inChannels;++D)for(let _=0;_<s.outDepth;++_){const R=_*r-m;let T=R;for(;T<0;)T+=c;const A=Math.min(s.inDepth,f+R),O=N+_*C;for(let P=0;P<s.outHeight;++P){const M=P*a-g;let z=M;for(;z<0;)z+=u;const L=Math.min(s.inHeight,h+M),W=O+P*I;for(let B=0;B<s.outWidth;++B){const q=B*l-v;let H=q;for(;H<0;)H+=d;const ne=Math.min(s.inWidth,p+q),te=W+B*$;let ae=x,re=0,ee=0;for(let Y=T;Y<A;Y+=c){const se=k+Y*i[1];for(let J=z;J<L;J+=u){const ue=se+J*i[2];for(let oe=H;oe<ne;oe+=d){const be=ue+oe*i[3],de=t[be+D];if(o==="max"&&de>ae?ae=de:o==="avg"&&(re+=de,ee++),isNaN(ae))break}if(isNaN(ae))break}if(isNaN(ae))break}const j=te+D;w[j]=o==="avg"?re/Math.max(ee,1):ae}}}}return b}function JJ(t,e){const n=Ct(e.outShape,"int32"),i=e.strideDepth,s=e.strideHeight,o=e.strideWidth,r=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,h=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let v=0;v<e.outDepth;++v){const x=v*i-f;let b=x;for(;b<0;)b+=r;const w=Math.min(e.inDepth,c+x);for(let y=0;y<e.outHeight;++y){const C=y*s-h;let I=C;for(;I<0;)I+=a;const $=Math.min(e.inHeight,u+C);for(let E=0;E<e.outWidth;++E){const N=E*o-p;let k=N;for(;k<0;)k+=l;const D=Math.min(e.inWidth,d+N);let _=Number.NEGATIVE_INFINITY,R=-1;for(let T=b;T<w;T+=r){const A=T-x;for(let O=I;O<$;O+=a){const P=O-C;for(let M=k;M<D;M+=l){const z=M-N,L=t.get(m,T,O,M,g);L>=_&&(_=L,R=A*u*d+P*u+z)}}}n.set(R,m,v,y,E,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZJ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e;Ge(s,"avgPool");const{filterSize:o,strides:r,pad:a,dimRoundingMode:l}=i,c=1;F(pi(r,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const u=As(s.shape,o,r,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Wt(u.inShape,u.outShape))d=No({inputs:{x:s},backend:n});else{const f=n.data.get(s.dataId).values,h=Ye(s.shape),p=qb(f,s.shape,s.dtype,h,u,"avg");d=n.makeTensorInfo(u.outShape,s.dtype,p.values)}return d}const QJ={kernelName:Sf,backendName:"cpu",kernelFunc:ZJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{filterSize:o,strides:r,pad:a,dimRoundingMode:l,dataFormat:c}=i;Ge(s,"avgPool3d");const u=er(s.shape,o,r,1,a,l,c),d=n.data.get(s.dataId).values,f=XT(d,s.shape,s.dtype,Ye(s.shape),u,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const tZ={kernelName:If,backendName:"cpu",kernelFunc:eZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o}=e,{filterSize:r,strides:a,pad:l,dimRoundingMode:c}=i;Ge([s,o],"avgPool3DGrad");const u=er(o.shape,r,a,1,l,c),d=u.strideDepth,f=u.strideHeight,h=u.strideWidth,p=u.filterDepth,m=u.filterHeight,g=u.filterWidth,v=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,w=u.effectiveFilterDepth,y=u.effectiveFilterHeight,C=u.effectiveFilterWidth,I=w-1-u.padInfo.front,$=C-1-u.padInfo.left,E=y-1-u.padInfo.top,N=Ct(o.shape,"float32"),k=1/(p*m*g),D=n.bufferSync(s);for(let _=0;_<u.batchSize;++_)for(let R=0;R<u.inChannels;++R)for(let T=0;T<u.inDepth;++T)for(let A=0;A<u.inHeight;++A)for(let O=0;O<u.inWidth;++O){const P=T-I,M=A-E,z=O-$;let L=0;for(let W=0;W<w;W+=v){const B=(P+W)/d;if(!(B<0||B>=u.outDepth||Math.floor(B)!==B))for(let q=0;q<y;q+=x){const H=(M+q)/f;if(!(H<0||H>=u.outHeight||Math.floor(H)!==H))for(let ne=0;ne<C;ne+=b){const te=(z+ne)/h;if(te<0||te>=u.outWidth||Math.floor(te)!==te)continue;const ae=D.get(_,B,H,te,R);L+=ae}}}N.set(L*k,_,T,A,O,R)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const iZ={kernelName:$x,backendName:"cpu",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o}=e,r=o;Ge([s,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=i,u=As(r.shape,a,l,1,c),d=u.strideHeight,f=u.strideWidth,h=u.filterHeight,p=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,v=u.effectiveFilterHeight,x=u.effectiveFilterWidth,b=x-1-u.padInfo.left,w=v-1-u.padInfo.top,y=Ct(r.shape,"float32"),C=1/(h*p),I=n.data.get(s.dataId).values,$=Ct(s.shape,"float32",I);for(let E=0;E<u.batchSize;++E)for(let N=0;N<u.inChannels;++N)for(let k=0;k<u.inHeight;++k)for(let D=0;D<u.inWidth;++D){const _=k-w,R=D-b;let T=0;for(let A=0;A<v;A+=m){const O=(_+A)/d;if(!(O<0||O>=u.outHeight||Math.floor(O)!==O))for(let P=0;P<x;P+=g){const M=(R+P)/f;if(M<0||M>=u.outWidth||Math.floor(M)!==M)continue;const z=$.get(E,O,M,N);T+=z}}y.set(T*C,E,k,D,N)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const oZ={kernelName:Ix,backendName:"cpu",kernelFunc:sZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,scale:o,offset:r,mean:a,variance:l}=e;F(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(r==null||a.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ge([s,a,l,o,r],"batchNorm");let{varianceEpsilon:c}=i;c==null&&(c=.001);const u=n.data.get(s.dataId).values,d=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,h=o?n.data.get(o.dataId).values:new Float32Array([1]),p=r?n.data.get(r.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=p.length,v=h.length,x=f.length,b=d.length;let w=0,y=0,C=0,I=0;for(let $=0;$<u.length;++$)m[$]=p[w++]+(u[$]-d[y++])*h[C++]/Math.sqrt(f[I++]+c),w>=g&&(w=0),y>=b&&(y=0),C>=v&&(C=0),I>=x&&(I=0);return n.makeTensorInfo(s.shape,s.dtype,m)}const aZ={kernelName:Ff,backendName:"cpu",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{blockShape:o,crops:r}=i;Ge([s],"batchToSpaceND");const a=o.reduce((v,x)=>v*x),l=ld(s.shape,o,a),c=cd(l.length,o.length),u=ud(s.shape,o,a),d=sb(r,o.length),f=ob(u,r,o.length),h=tn({inputs:{x:s},backend:n,attrs:{shape:l}}),p=Li({inputs:{x:h},backend:n,attrs:{perm:c}}),m=tn({inputs:{x:p},backend:n,attrs:{shape:u}}),g=Ea({inputs:{x:m},backend:n,attrs:{begin:d,size:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const cZ={kernelName:Ef,backendName:"cpu",kernelFunc:lZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,weights:o}=e,{size:r}=i,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,c=Hb(a,l,o.dtype,o.shape,r);return n.makeTensorInfo([r],o.dtype,c)}const dZ={kernelName:Ex,backendName:"cpu",kernelFunc:uZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(t){const{inputs:e,backend:n}=t,{s0:i,s1:s}=e,o=n.data.get(i.dataId).values,r=n.data.get(s.dataId).values,a=mt(Array.from(o),Array.from(r));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const fZ={kernelName:pE,backendName:"cpu",kernelFunc:hZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pZ=Ht(vu,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),mZ={kernelName:vu,backendName:"cpu",kernelFunc:pZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gZ=t=>{const{x:e}=t.inputs,n=t.backend,i=new Float32Array(pe(e.shape)),s=n.data.get(e.dataId),o=s.complexTensorInfos.real,r=s.complexTensorInfos.imag,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];i[c]=Math.hypot(u,d)}return n.makeOutput(i,e.shape,"float32")},vZ={kernelName:Nf,backendName:"cpu",kernelFunc:gZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ll(t){const{inputs:e,backend:n}=t,{input:i}=e,s=n.data.get(i.dataId).complexTensorInfos.imag,o=n.data.get(s.dataId).values;return n.makeTensorInfo(s.shape,s.dtype,o)}const xZ={kernelName:Hx,backendName:"cpu",kernelFunc:Ll};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zl(t){const{inputs:e,backend:n,attrs:i}=t,{axis:s}=i,o=St(s,e[0].shape)[0],r=e.map(m=>m.shape);tb(r,o);let a=vo(e.map(m=>m.shape),o);if(pe(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>pe(m.shape)>0);if(l.length===1)return No({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(w=>$a({inputs:{input:w},backend:n})),g=l.map(w=>Ll({inputs:{input:w},backend:n})),v=zl({inputs:m,backend:n,attrs:{axis:o}}),x=zl({inputs:g,backend:n,attrs:{axis:o}}),b=Gi({inputs:{real:v,imag:x},backend:n});return m.forEach(w=>n.disposeIntermediateTensorInfo(w)),g.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),b}const c=l.map(m=>{const v=[-1,pe(m.shape.slice(o))];return tn({inputs:{x:m},backend:n,attrs:{shape:v}})}),u=c.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=vo(c.map(m=>m.shape),1);const d=c[0].shape[0]===1,f=QD(u,a,e[0].dtype,d),h=vo(l.map(m=>m.shape),o),p=n.makeTensorInfo(h,e[0].dtype,f);return c.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const bZ={kernelName:kf,backendName:"cpu",kernelFunc:zl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qT(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=i;Ge([s,o],"conv2d");const d=tr(l),f=ni(s.shape,o.shape,r,c,a,u,!1,d),h=f.filterHeight,p=f.filterWidth,m=f.dilationHeight,g=f.dilationWidth,v=f.padInfo.left,x=f.padInfo.top,b=f.dataFormat==="channelsLast",w=new ti(f.outShape,s.dtype),y=Ye(s.shape),C=Ye(o.shape),I=y[0],$=b?y[1]:y[2],E=b?y[2]:1,N=b?1:y[1],k=w.strides[0],D=b?w.strides[1]:w.strides[2],_=b?w.strides[2]:1,R=b?1:w.strides[1],T=n.data.get(s.dataId).values,A=n.data.get(o.dataId).values,O=w.values;for(let P=0;P<f.batchSize;++P){const M=P*I,z=P*k;for(let L=0;L<f.outHeight;++L){const W=z+L*D,B=L*f.strideHeight-x;for(let q=0;q<h;++q){const H=B+q*m;if(H<0||H>=f.inHeight)continue;const ne=q*C[0],te=M+H*$;for(let ae=0;ae<f.outWidth;++ae){const re=W+ae*_,ee=ae*f.strideWidth-v;for(let j=0;j<p;++j){const Y=ee+j*g;if(Y<0||Y>=f.inWidth)continue;const se=ne+j*C[1],J=te+Y*E;let ue=se;for(let oe=0;oe<f.inChannels;++oe){const be=T[J+oe*N];for(let de=0;de<f.outChannels;++de)O[re+de*R]+=be*A[ue+de];ue+=f.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,O)}const yZ={kernelName:Df,backendName:"cpu",kernelFunc:qT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,dy:o}=e,{strides:r,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=i;Ge([s,o],"conv2dBackpropFilter");const d=tr(l),f=ni(s.shape,u,r,1,a,c,!1,d),{strideHeight:h,strideWidth:p,filterHeight:m,filterWidth:g}=f,v=f.dataFormat==="channelsLast",x=new ti(f.filterShape,"float32"),b=f.padInfo.left,w=f.padInfo.top,y=n.data.get(s.dataId).values,C=n.data.get(o.dataId).values,I=new ti(s.shape,s.dtype,y),$=new ti(o.shape,o.dtype,C);for(let E=0;E<m;++E){const N=Math.max(0,Math.ceil((w-E)/h)),k=Math.min(f.outHeight,(f.inHeight+w-E)/h);for(let D=0;D<g;++D){const _=Math.max(0,Math.ceil((b-D)/p)),R=Math.min(f.outWidth,(f.inWidth+b-D)/p);for(let T=0;T<f.inChannels;++T)for(let A=0;A<f.outChannels;++A){let O=0;for(let P=0;P<f.batchSize;++P)for(let M=N;M<k;++M){const z=E+M*h-w;for(let L=_;L<R;++L){const W=D+L*p-b;v?O+=I.get(P,z,W,T)*$.get(P,M,L,A):O+=I.get(P,T,z,W)*$.get(P,A,M,L)}}x.set(O,E,D,T,A)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const CZ={kernelName:Dx,backendName:"cpu",kernelFunc:wZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,filter:o}=e,{inputShape:r,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=i;Ge([s,o],"conv2dBackpropInput");const d=Ye(o.shape),f=Ye(s.shape);let h=tr(c);const p=ni(r,o.shape,a,1,l,u,!1,h),m=new ti(p.inShape,"float32"),g=m.values,v=n.data.get(s.dataId).values,x=n.data.get(o.dataId).values,[b,w,y]=d,{batchSize:C,filterHeight:I,filterWidth:$,inChannels:E,inHeight:N,inWidth:k,outChannels:D,outHeight:_,outWidth:R,strideHeight:T,strideWidth:A}=p;h=p.dataFormat;const O=I-1-p.padInfo.top,P=$-1-p.padInfo.left,M=h==="channelsLast",z=m.strides[0],L=M?m.strides[1]:m.strides[2],W=M?m.strides[2]:1,B=M?1:m.strides[1],q=f[0],H=M?f[1]:f[2],ne=M?f[2]:1,te=M?1:f[1];for(let ae=0;ae<C;++ae)for(let re=0;re<E;++re)for(let ee=0;ee<N;++ee){const j=ee-O,Y=Math.max(0,Math.ceil(j/T)),se=Math.min(_,(I+j)/T);for(let J=0;J<k;++J){const ue=J-P,oe=Math.max(0,Math.ceil(ue/A)),be=Math.min(R,($+ue)/A);let de=0;for(let ge=Y;ge<se;++ge){const $e=ge*T-j;for(let De=oe;De<be;++De){const ve=De*A-ue,we=q*ae+H*ge+ne*De,Re=b*(I-1-$e)+w*($-1-ve)+y*re;for(let Ne=0;Ne<D;++Ne){const Ke=v[we+te*Ne],We=x[Re+Ne];de+=Ke*We}}}const Ie=z*ae+L*ee+W*J+B*re;g[Ie]=de}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const IZ={kernelName:Tf,backendName:"cpu",kernelFunc:SZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dilations:l}=i;Ge([s,o],"conv3d");const c=_r(s.shape,o.shape,r,l,a),{filterDepth:u,filterHeight:d,filterWidth:f,dilationDepth:h,dilationHeight:p,dilationWidth:m,padInfo:g}=c,v=g.front,x=g.left,b=g.top,w=new ti(c.outShape,s.dtype),y=n.data.get(s.dataId).values,C=n.data.get(o.dataId).values,I=w.values,$=Ye(s.shape),E=Ye(o.shape);for(let N=0;N<c.batchSize;++N){const k=N*$[0],D=N*w.strides[0];for(let _=0;_<c.outDepth;++_){const R=D+_*w.strides[1],T=_*c.strideDepth-v;for(let A=0;A<u;++A){const O=T+A*h;if(O<0||O>=c.inDepth)continue;const P=A*E[0],M=k+O*$[1];for(let z=0;z<c.outHeight;++z){const L=R+z*w.strides[2],W=z*c.strideHeight-b;for(let B=0;B<d;++B){const q=W+B*p;if(q<0||q>=c.inHeight)continue;const H=P+B*E[1],ne=M+q*$[2];for(let te=0;te<c.outWidth;++te){const ae=L+te*c.outChannels,re=te*c.strideWidth-x;for(let ee=0;ee<f;++ee){const j=re+ee*m;if(j<0||j>=c.inWidth)continue;const Y=H+ee*E[2],se=ne+j*c.inChannels;let J=Y;for(let ue=0;ue<c.inChannels;++ue){const oe=y[se+ue];for(let be=0;be<c.outChannels;++be)I[ae+be]+=oe*C[J+be];J+=c.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const EZ={kernelName:Rf,backendName:"cpu",kernelFunc:$Z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,dy:o}=e,{strides:r,pad:a,filterShape:l}=i;Ge([s,o],"conv3dBackpropFilterV2");const c=Ye(s.shape),u=Ye(o.shape),d=_r(s.shape,l,r,1,a),f=d.strideDepth,h=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,v=d.filterWidth,x=new ti(d.filterShape,"float32"),b=x.values,[w,y,C,I]=x.strides,$=n.data.get(o.dataId).values,[E,N,k,D]=u,_=n.data.get(s.dataId).values,[R,T,A,O]=c,P=d.padInfo.front,M=d.padInfo.left,z=d.padInfo.top;for(let L=0;L<m;++L){const W=Math.max(0,Math.ceil((P-L)/f)),B=Math.min(d.outDepth,(d.inDepth+P-L)/f),q=L*w;for(let H=0;H<g;++H){const ne=Math.max(0,Math.ceil((z-H)/h)),te=Math.min(d.outHeight,(d.inHeight+z-H)/h),ae=H*y+q;for(let re=0;re<v;++re){const ee=Math.max(0,Math.ceil((M-re)/p)),j=Math.min(d.outWidth,(d.inWidth+M-re)/p),Y=re*C+ae;for(let se=0;se<d.inChannels;++se){const J=se*I+Y;for(let ue=0;ue<d.outChannels;++ue){let oe=0;for(let be=0;be<d.batchSize;++be){const de=be*R,Ie=be*E;for(let ge=W;ge<B;++ge){const De=(L+ge*f-P)*T+de,ve=ge*N+Ie;for(let we=ne;we<te;++we){const Ne=(H+we*h-z)*A+De,Ke=we*k+ve;for(let We=ee;We<j;++We){const Ee=(re+We*p-M)*O+Ne,lt=We*D+Ke;oe+=_[Ee+se]*$[lt+ue]}}}}b[J+ue]=oe}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const kZ={kernelName:Tx,backendName:"cpu",kernelFunc:NZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,filter:o}=e,{pad:r,strides:a,inputShape:l}=i;Ge([s],"conv3dBackpropInputV2");const c=Ye(s.shape),u=Ye(o.shape),d=_r(l,o.shape,a,1,r),f=new ti(d.inShape,"float32"),h=f.values,[p,m,g,v]=f.strides,x=n.data.get(s.dataId).values,[b,w,y,C]=c,I=n.data.get(o.dataId).values,[$,E,N,k]=u,{batchSize:D,filterDepth:_,filterHeight:R,filterWidth:T,inChannels:A,inDepth:O,inHeight:P,inWidth:M,outChannels:z,outDepth:L,outHeight:W,outWidth:B,strideDepth:q,strideHeight:H,strideWidth:ne}=d,te=_-1-d.padInfo.front,ae=R-1-d.padInfo.top,re=T-1-d.padInfo.left;for(let ee=0;ee<D;++ee)for(let j=0;j<A;++j)for(let Y=0;Y<O;++Y){const se=Y-te,J=Math.max(0,Math.ceil(se/q)),ue=Math.min(L,(_+se)/q);for(let oe=0;oe<P;++oe){const be=oe-ae,de=Math.max(0,Math.ceil(be/H)),Ie=Math.min(W,(R+be)/H);for(let ge=0;ge<M;++ge){const $e=ge-re,De=Math.max(0,Math.ceil($e/ne)),ve=Math.min(B,(T+$e)/ne);let we=0;for(let Re=J;Re<ue;++Re){const Ne=Re*q-se;for(let Ke=de;Ke<Ie;++Ke){const We=Ke*H-be;for(let ct=De;ct<ve;++ct){const Ee=ct*ne-$e,lt=b*ee+w*Re+y*Ke+C*ct,Xe=$*(_-1-Ne)+E*(R-1-We)+N*(T-1-Ee)+k*j;for(let Le=0;Le<z;++Le){const Pe=x[lt+Le],ut=I[Xe+Le];we+=Pe*ut}}}}h[p*ee+m*Y+g*oe+v*ge+j]=we}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const TZ={kernelName:Rx,backendName:"cpu",kernelFunc:DZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RZ=Ht(xu,t=>Math.cos(t)),_Z={kernelName:xu,backendName:"cpu",kernelFunc:RZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AZ=Ht(bu,t=>Math.cosh(t)),OZ={kernelName:bu,backendName:"cpu",kernelFunc:AZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(t){const{inputs:e,backend:n,attrs:i}=t,{image:s,boxes:o,boxInd:r}=e,{cropSize:a,method:l,extrapolationValue:c}=i,[u,d,f,h]=s.shape,p=o.shape[0],[m,g]=a,v=Ct([p,m,g,h],"float32"),x=n.data.get(o.dataId).values,b=n.data.get(r.dataId).values,w=n.data.get(s.dataId).values,y=Ye(s.shape),C=Ye(v.shape);for(let I=0;I<p;I++){const $=I*4,E=x[$],N=x[$+1],k=x[$+2],D=x[$+3],_=b[I];if(_>=u)continue;const R=m>1?(k-E)*(d-1)/(m-1):0,T=g>1?(D-N)*(f-1)/(g-1):0;for(let A=0;A<m;A++){const O=m>1?E*(d-1)+A*R:.5*(E+k)*(d-1);if(O<0||O>d-1){for(let P=0;P<g;P++)for(let M=0;M<h;M++){const z=M+P*C[2]+A*C[1]+I*C[0];v.values[z]=c}continue}if(l==="bilinear"){const P=Math.floor(O),M=Math.ceil(O),z=O-P;for(let L=0;L<g;L++){const W=g>1?N*(f-1)+L*T:.5*(N+D)*(f-1);if(W<0||W>f-1){for(let ne=0;ne<h;ne++){const te=ne+L*C[2]+A*C[1]+I*C[0];v.values[te]=c}continue}const B=Math.floor(W),q=Math.ceil(W),H=W-B;for(let ne=0;ne<h;ne++){let te=ne+B*y[2]+P*y[1]+_*y[0];const ae=w[te];te=ne+q*y[2]+P*y[1]+_*y[0];const re=w[te];te=ne+B*y[2]+M*y[1]+_*y[0];const ee=w[te];te=ne+q*y[2]+M*y[1]+_*y[0];const j=w[te],Y=ae+(re-ae)*H,se=ee+(j-ee)*H;te=ne+L*C[2]+A*C[1]+I*C[0],v.values[te]=Y+(se-Y)*z}}}else for(let P=0;P<g;++P){const M=g>1?N*(f-1)+P*T:.5*(N+D)*(f-1);if(M<0||M>f-1){for(let W=0;W<h;W++){const B=W+P*C[2]+A*C[1]+I*C[0];v.values[B]=c}continue}const z=Math.round(M),L=Math.round(O);for(let W=0;W<h;W++){const B=W+z*y[2]+L*y[1]+_*y[0],q=W+P*C[2]+A*C[1]+I*C[0];v.values[q]=w[B]}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const MZ={kernelName:Ax,backendName:"cpu",kernelFunc:PZ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,exclusive:r,reverse:a}=i;Ge(s,"cumprod");const l=mn([o],s.shape.length);let c=s;l!=null&&(c=Li({inputs:{x:s},backend:n,attrs:{perm:l}}));const u=Nn(1,s.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=qi(c.dtype,"int32"),f=xx(pe(c.shape),d),h=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,x)=>v+p-x-1:(v,x)=>v+x;for(let v=0;v<h.length;v+=p)for(let x=0;x<p;x++){const b=m(v,x);if(x===0)f[b]=r?1:h[b];else{const w=m(v,x-1);f[b]=r?h[w]*f[w]:h[b]*f[w]}}const g=n.makeTensorInfo(c.shape,d,f);if(l!=null){const v=Ar(l),x=Li({inputs:{x:g},backend:n,attrs:{perm:v}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),x}return g}const LZ={kernelName:_x,backendName:"cpu",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,exclusive:r,reverse:a}=i;Ge(s,"cumsum");const l=mn([o],s.shape.length);let c=s;l!=null&&(c=Li({inputs:{x:s},backend:n,attrs:{perm:l}}));const u=Nn(1,s.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=qi(c.dtype,"int32"),f=hi(pe(c.shape),d),h=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,x)=>v+p-x-1:(v,x)=>v+x;for(let v=0;v<h.length;v+=p)for(let x=0;x<p;x++){const b=m(v,x);if(x===0)f[b]=r?0:h[b];else{const w=m(v,x-1);f[b]=r?h[w]+f[w]:h[b]+f[w]}}const g=n.makeTensorInfo(c.shape,d,f);if(l!=null){const v=Ar(l),x=Li({inputs:{x:g},backend:n,attrs:{perm:v}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),x}return g}const BZ={kernelName:_f,backendName:"cpu",kernelFunc:zZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,weights:o}=e,{size:r,binaryOutput:a}=i;if(s.shape.length===1){const l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,u=Hb(l,c,o.dtype,o.shape,r);return n.makeTensorInfo([r],o.dtype,u)}else if(s.shape.length===2){const l=n.bufferSync(s),c=n.bufferSync(o),u=YD(l,c,r,a);return n.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const WZ={kernelName:Ox,backendName:"cpu",kernelFunc:VZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{blockSize:o,dataFormat:r}=i;F(r==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${r}`);const a=s.shape[0],l=s.shape[1],c=s.shape[2],u=s.shape[3],d=l*o,f=c*o,h=u/(o*o),p=n.data.get(s.dataId).values,m=new Float32Array(a*d*f*h);let g=0;for(let v=0;v<a;++v)for(let x=0;x<d;++x){const b=Math.floor(x/o),w=x%o;for(let y=0;y<f;++y){const C=Math.floor(y/o),I=y%o,$=(w*o+I)*h;for(let E=0;E<h;++E){const k=E+$+u*(C+c*(b+l*v));m[g++]=p[k]}}}return n.makeTensorInfo([a,d,f,h],s.dtype,m)}const HZ={kernelName:Px,backendName:"cpu",kernelFunc:GZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dilations:l,dimRoundingMode:c}=i;Ge([s,o],"depthwiseConv2DNative");const u=Ye(s.shape),d=Ye(o.shape);let f=l;f==null&&(f=[1,1]),F(pi(r,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${r} and dilations '${f}'`);const h=ni(s.shape,o.shape,r,f,a,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:v,padInfo:x}=h,b=x.left,w=x.top,y=h.outChannels/h.inChannels,C=new ti(h.outShape,s.dtype),I=n.data.get(s.dataId).values,$=n.data.get(o.dataId).values,E=C.values;for(let N=0;N<h.batchSize;++N){const k=N*u[0],D=N*C.strides[0];for(let _=0;_<h.outHeight;++_){const R=D+_*C.strides[1],T=_*h.strideHeight-w;for(let A=0;A<p;++A){const O=T+A*g;if(O<0||O>=h.inHeight)continue;const P=A*d[0],M=k+O*u[1];for(let z=0;z<h.outWidth;++z){const L=R+z*C.strides[2],W=z*h.strideWidth-b;for(let B=0;B<m;++B){const q=W+B*v;if(q<0||q>=h.inWidth)continue;const H=P+B*d[1],ne=M+q*h.inChannels;let te=L,ae=H;for(let re=0;re<h.inChannels;++re){const ee=I[ne+re];for(let j=0;j<y;++j)E[te+j]+=ee*$[ae+j];te+=y,ae+=y}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const UZ={kernelName:Af,backendName:"cpu",kernelFunc:YT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jZ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,dy:o}=e,{strides:r,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=i;Ge([s,o],"depthwiseConv2dNativeBackpropFilter");const d=ni(s.shape,u,r,a,l,c,!0),{strideHeight:f,strideWidth:h,filterHeight:p,filterWidth:m}=d,g=new ti(d.filterShape,"float32"),v=d.padInfo.left,x=d.padInfo.top,b=d.outChannels/d.inChannels,w=n.data.get(s.dataId).values,y=new ti(s.shape,s.dtype,w),C=n.data.get(o.dataId).values,I=new ti(o.shape,o.dtype,C);for(let $=0;$<p;++$){const E=Math.max(0,Math.ceil((x-$)/f)),N=Math.min(d.outHeight,(d.inHeight+x-$)/f);for(let k=0;k<m;++k){const D=Math.max(0,Math.ceil((v-k)/h)),_=Math.min(d.outWidth,(d.inWidth+v-k)/h);for(let R=0;R<d.outChannels;++R){const T=Math.trunc(R/b),A=R%b;let O=0;for(let P=0;P<d.batchSize;++P)for(let M=E;M<N;++M){const z=$+M*f-x;for(let L=D;L<_;++L){const W=k+L*h-v;O+=y.get(P,z,W,T)*I.get(P,M,L,R)}}g.set(O,$,k,T,A)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const KZ={kernelName:Mx,backendName:"cpu",kernelFunc:jZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,filter:o}=e,{strides:r,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=i;Ge([s,o],"depthwiseConv2DNativeBackpropInput");const d=Ye(s.shape),f=Ye(o.shape),h=ni(u,o.shape,r,a,l,c,!0),p=new ti(h.inShape,"float32"),m=p.values,[g,v,x]=p.strides,b=n.data.get(s.dataId).values,[w,y,C]=d,I=n.data.get(o.dataId).values,[$,E,N]=f,{batchSize:k,filterHeight:D,filterWidth:_,inChannels:R,inHeight:T,inWidth:A,outChannels:O,outHeight:P,outWidth:M,strideHeight:z,strideWidth:L}=h,W=D-1-h.padInfo.top,B=_-1-h.padInfo.left,q=O/R;for(let H=0;H<k;++H)for(let ne=0;ne<R;++ne)for(let te=0;te<T;++te){const ae=te-W,re=Math.max(0,Math.ceil(ae/z)),ee=Math.min(P,(D+ae)/z);for(let j=0;j<A;++j){const Y=j-B,se=Math.max(0,Math.ceil(Y/L)),J=Math.min(M,(_+Y)/L);let ue=0;for(let oe=re;oe<ee;++oe){const be=oe*z-ae;for(let de=se;de<J;++de){const Ie=de*L-Y,ge=w*H+y*oe+C*de,$e=$*(D-1-be)+E*(_-1-Ie)+N*ne;for(let De=0;De<q;++De){const ve=ne*q+De,we=b[ge+ve],Re=I[$e+De];ue+=we*Re}}}m[g*H+v*te+x*j+ne]=ue}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const qZ={kernelName:Fx,backendName:"cpu",kernelFunc:XZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(t){const{inputs:e,backend:n}=t,{x:i}=e,s=pe(i.shape),o=n.data.get(i.dataId).values,r=Ct([s,s],i.dtype),a=r.values;for(let c=0;c<o.length;c++)a[c*s+c]=o[c];const l=[...i.shape,...i.shape];return n.makeTensorInfo(l,r.dtype,r.values)}const JZ={kernelName:mE,backendName:"cpu",kernelFunc:YZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZZ={kernelName:Of,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:s}=t,{strides:o,pad:r,dilations:a}=n,l=e,c=l.data.get(i.dataId).values,u=i.shape.length,d=l.data.get(s.dataId).values,f=s.shape.length,{batchSize:h,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:x,padInfo:b,strideHeight:w,strideWidth:y,filterHeight:C,filterWidth:I,dilationHeight:$,dilationWidth:E,outShape:N}=id(i.shape,s.shape,o,r,"NHWC",a),k=pe(N),D=N.length,_=wn(i.dtype,k);for(let T=0;T<h;++T)for(let A=0;A<v;++A){const O=A*w-b.top;for(let P=0;P<x;++P){const M=P*y-b.left;for(let z=0;z<g;++z){let L=Number.MIN_SAFE_INTEGER;for(let B=0;B<C;++B){const q=O+B*$;if(q>=0&&q<p)for(let H=0;H<I;++H){const ne=M+H*E;if(ne>=0&&ne<m){const te=mo([T,q,ne,z],u,Ye(i.shape)),ae=mo([B,H,z],f,Ye(s.shape)),re=c[te]+d[ae];re>L&&(L=re)}}}const W=mo([T,A,P,z],D,Ye(N));_[W]=L}}}return{dataId:l.write(Oa(_,i.dtype),N,i.dtype),shape:N,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QZ={kernelName:Ig,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:s,dy:o}=t,{strides:r,pad:a,dilations:l}=n,c=e,u=Hs(i.shape,c.data.get(i.dataId).values),d=Hs(s.shape,c.data.get(s.dataId).values),{batchSize:f,inHeight:h,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:y,filterWidth:C,dilationHeight:I,dilationWidth:$,outShape:E}=id(i.shape,s.shape,r,a,"NHWC",l);F(o.rank===E.length,()=>`Error in ${Ig}, dy must have the same rank as output ${E.length}, but got ${o.rank}`);const N=Hs(E,c.data.get(o.dataId).values),k=dE(s.shape,s.dtype);for(let _=0;_<f;++_)for(let R=0;R<g;++R){const T=R*b-x.top;for(let A=0;A<v;++A){const O=A*w-x.left;for(let P=0;P<m;++P){let M=Number.MIN_SAFE_INTEGER,z=0,L=0;for(let W=0;W<y;++W){const B=T+W*I;if(B>=0&&B<h)for(let q=0;q<C;++q){const H=O+q*$;if(H>=0&&H<p){const ne=u[_][B][H][P]+d[W][q][P];ne>M&&(M=ne,z=W,L=q)}}}k[z][L][P]+=N[_][R][A][P]}}}return{dataId:c.write(Oa(k,i.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eQ={kernelName:Sg,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:s,dy:o}=t,{strides:r,pad:a,dilations:l}=n,c=e,u=Hs(i.shape,c.data.get(i.dataId).values),d=Hs(s.shape,c.data.get(s.dataId).values),{batchSize:f,inHeight:h,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:y,filterWidth:C,dilationHeight:I,dilationWidth:$,outShape:E}=id(i.shape,s.shape,r,a,"NHWC",l);F(o.rank===E.length,()=>`Error in ${Sg}, dy must have the same rank as output ${E.length}, but got ${o.rank}`);const N=Hs(E,c.data.get(o.dataId).values),k=dE(i.shape,i.dtype);for(let _=0;_<f;++_)for(let R=0;R<g;++R){const T=R*b-x.top;for(let A=0;A<v;++A){const O=A*w-x.left;for(let P=0;P<m;++P){let M=Number.MIN_SAFE_INTEGER,z=T<0?0:T,L=O<0?0:O;for(let W=0;W<y;++W){const B=T+W*I;if(B>=0&&B<h)for(let q=0;q<C;++q){const H=O+q*$;if(H>=0&&H<p){const ne=u[_][B][H][P]+d[W][q][P];ne>M&&(M=ne,z=B,L=H)}}}k[_][z][L][P]+=N[_][R][A][P]}}}return{dataId:c.write(Oa(k,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(t){const{inputs:e,backend:n,attrs:i}=t,{image:s}=e,{canvas:o,options:r}=i,{contextOptions:a,imageOptions:l}=r||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[f,h]=s.shape.slice(0,2),p=s.shape.length===2?1:s.shape[2],m=n.data.get(s.dataId).values,g=s.dtype==="float32"?255:1,v=new Uint8ClampedArray(h*f*4);for(let b=0;b<f*h;++b){const w=[0,0,0,255*c];for(let C=0;C<p;C++){const I=m[b*p+C];if(s.dtype==="float32"){if(I<0||I>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${I}.`)}else if(s.dtype==="int32"&&(I<0||I>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${I}.`);p===1?(w[0]=I*g,w[1]=I*g,w[2]=I*g):w[C]=I*g}const y=b*4;v[y+0]=Math.round(w[0]),v[y+1]=Math.round(w[1]),v[y+2]=Math.round(w[2]),v[y+3]=Math.round(w[3])}o.width=h,o.height=f;const x=new ImageData(v,h,f);return d.putImageData(x,0,0),s}const nQ={kernelName:yH,backendName:"cpu",kernelFunc:tQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bd(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i;Ge(s,"sum");let a;s.dtype==="bool"?a=Nr({inputs:{x:s},backend:n,attrs:{dtype:"int32"}}):a=No({inputs:{x:s},backend:n});const l=a.shape.length,c=St(o,a.shape),u=mn(c,l);let d=c,f=a;u!=null&&(f=Li({inputs:{x:a},backend:n,attrs:{perm:u}}),d=Nn(d.length,l)),ii("sum",d,f.shape.length);const[h,p]=Yn(f.shape,d),m=qi(f.dtype,"int32");let g=jh(n,h,m);const v=pe(p),x=n.data.get(g.dataId).values,b=n.data.get(f.dataId).values;for(let w=0;w<x.length;++w){const y=w*v;let C=0;for(let I=0;I<v;++I)C+=b[y+I];x[w]=C}if(r){const w=Rn(g.shape,c),y=g;g=tn({inputs:{x:g},backend:n,attrs:{shape:w}}),n.disposeIntermediateTensorInfo(y)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(f),g}const iQ={kernelName:fp,backendName:"cpu",kernelFunc:bd};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(t){const{inputs:e,backend:n,attrs:i}=t,{equation:s}=i,o=e,{allDims:r,summedDims:a,idDims:l}=fb(s,o.length);mb(r.length,l,o);const{path:c,steps:u}=gb(a,l),d=u.length;let f=null,h=r.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:v,expandDims:x}=pb(h,l[g]);let b;vb(v)?b=o[g]:(b=Li({inputs:{x:o[g]},backend:n,attrs:{perm:v}}),p.push(b));const w=b.shape.slice();for(let y=0;y<x.length;++y)w.splice(x[y],0,1);Wt(b.shape,w)||(b=tn({inputs:{x:b},backend:n,attrs:{shape:w}}),p.push(b)),f===null?f=b:(f=Hp({inputs:{a:b,b:f},backend:n}),p.push(f))}m<d-1&&(c[m]>=0&&(f=bd({inputs:{x:f},backend:n,attrs:{axis:c[m]-(r.length-h),keepDims:!1}}),p.push(f)),h--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const oQ={kernelName:Lx,backendName:"cpu",kernelFunc:sQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(t){const{inputs:e,backend:n}=t,{dy:i,y:s}=e;Ge([i,s],"eluGrad");const o=new Float32Array(pe(s.shape)),r=n.data.get(s.dataId).values,a=n.data.get(i.dataId).values;for(let l=0;l<r.length;++l){const c=r[l];c>=0?o[l]=a[l]:o[l]=a[l]*(c+1)}return n.makeTensorInfo(s.shape,"float32",o)}const aQ={kernelName:zx,backendName:"cpu",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lQ=rb,cQ=ab,uQ=lb,dQ=cb,hQ=ub,fQ=db,pQ=Ht(Cu,t=>{const e=Math.sign(t),n=Math.abs(t),i=1/(1+lQ*n);return e*(1-((((fQ*i+hQ)*i+dQ)*i+uQ)*i+cQ)*i*Math.exp(-n*n))}),mQ={kernelName:Cu,backendName:"cpu",kernelFunc:pQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qh(t){const{inputs:e,backend:n,attrs:i}=t,{input:s}=e,{dim:o}=i,r=s.shape.length,a=s.shape.slice();let l=o;return o<0&&(F(-(r+1)<=o,()=>`Axis must be in the interval [${-(r+1)}, ${r}]`),l=r+o+1),a.splice(l,0,1),tn({inputs:{x:s},backend:n,attrs:{shape:a}})}const gQ={kernelName:Mf,backendName:"cpu",kernelFunc:qh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vQ=Dn((t,e)=>t/e),Yb=Wn(yu,vQ),Yg={kernelName:yu,backendName:"cpu",kernelFunc:Yb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JT(t,e,n){const i=t.shape,s=i[0],o=i[1],r=n.data.get(t.dataId),a=r.complexTensorInfos.real,l=r.complexTensorInfos.imag,c=[s,o],u=pe(c),d=di("float32",u),f=di("float32",u);for(let g=0;g<s;g++){const v=Ea({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,o]}}),x=Ea({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,o]}}),b=Gi({inputs:{real:v,imag:x},backend:n}),{real:w,imag:y}=xQ(b,e,n),C=Xo(w,y);for(let I=0;I<o;I++){const $=hb(C,I);d[g*o+I]=$.real,f[g*o+I]=$.imag}n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b)}const h=n.makeTensorInfo(c,"float32",d),p=n.makeTensorInfo(c,"float32",f),m=Gi({inputs:{real:h,imag:p},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),m}function xQ(t,e,n){const i=pe(t.shape),s=n.data.get(t.dataId),o=n.data.get(s.complexTensorInfos.real.dataId).values,r=n.data.get(s.complexTensorInfos.imag.dataId).values;if(bQ(i)){const a=Jg(o,r,i,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),u=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",Tr(i,"float32")),f=No({inputs:{x:d},backend:n}),h=Yg.kernelFunc({inputs:{a:c,b:d},backend:n}),p=Yg.kernelFunc({inputs:{a:u,b:f},backend:n}),m=n.data.get(h.dataId).values,g=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=Xo(o,r),l=yQ(a,i,e);return uN(l)}}function bQ(t){return(t&t-1)===0}function Jg(t,e,n,i,s){if(n===1)return{real:t,imag:e};const o=Xo(t,e),r=n/2,a=dN(o),l=a.real,c=a.imag,u=[l.length],d=s.makeTensorInfo(u,"float32",l),f=s.makeTensorInfo(u,"float32",c),h=Gi({inputs:{real:d,imag:f},backend:s}),p=hN(o),m=p.real,g=p.imag,v=[m.length],x=s.makeTensorInfo(v,"float32",m),b=s.makeTensorInfo(v,"float32",g),w=Gi({inputs:{real:x,imag:b},backend:s}),y=Jg(l,c,r,i,s),C=y.real,I=y.imag,$=[C.length],E=s.makeTensorInfo($,"float32",C),N=s.makeTensorInfo($,"float32",I),k=Gi({inputs:{real:E,imag:N},backend:s}),D=Jg(m,g,r,i,s),_=D.real,R=D.imag,T=[_.length],A=s.makeTensorInfo(T,"float32",_),O=s.makeTensorInfo(T,"float32",R),P=Gi({inputs:{real:A,imag:O},backend:s}),M=pN(n,i),z=[M.real.length],L=s.makeTensorInfo(z,"float32",M.real),W=s.makeTensorInfo(z,"float32",M.imag),B=Gi({inputs:{real:L,imag:W},backend:s}),q=Hp({inputs:{a:B,b:P},backend:s}),H=Fl({inputs:{a:k,b:q},backend:s}),ne=Xb({inputs:{a:k,b:q},backend:s}),te=$a({inputs:{input:H},backend:s}),ae=$a({inputs:{input:ne},backend:s}),re=Ll({inputs:{input:H},backend:s}),ee=Ll({inputs:{input:ne},backend:s}),j=zl({inputs:[te,ae],backend:s,attrs:{axis:0}}),Y=zl({inputs:[re,ee],backend:s,attrs:{axis:0}}),se=s.data.get(j.dataId).values,J=s.data.get(Y.dataId).values;return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(w),s.disposeIntermediateTensorInfo(E),s.disposeIntermediateTensorInfo(N),s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(A),s.disposeIntermediateTensorInfo(O),s.disposeIntermediateTensorInfo(P),s.disposeIntermediateTensorInfo(L),s.disposeIntermediateTensorInfo(W),s.disposeIntermediateTensorInfo(B),s.disposeIntermediateTensorInfo(q),s.disposeIntermediateTensorInfo(H),s.disposeIntermediateTensorInfo(ne),s.disposeIntermediateTensorInfo(te),s.disposeIntermediateTensorInfo(re),s.disposeIntermediateTensorInfo(ae),s.disposeIntermediateTensorInfo(ee),s.disposeIntermediateTensorInfo(j),s.disposeIntermediateTensorInfo(Y),{real:se,imag:J}}function yQ(t,e,n){const i=new Float32Array(e*2);for(let s=0;s<e;s++){let o=0,r=0;for(let a=0;a<e;a++){const l=mN(s*a,e,n),c=hb(t,a);o+=c.real*l.real-c.imag*l.imag,r+=c.real*l.imag+c.imag*l.real}n&&(o/=e,r/=e),fN(i,o,r,s)}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(t){const{inputs:e,backend:n}=t,{input:i}=e,s=pe(i.shape),o=i.shape[i.shape.length-1],r=s/o,a=tn({inputs:{x:i},backend:n,attrs:{shape:[r,o]}}),l=JT(a,!1,n),c=tn({inputs:{x:l},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const CQ={kernelName:Bx,backendName:"cpu",kernelFunc:wQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jb(t){const{backend:e,attrs:n}=t,{shape:i,value:s,dtype:o}=n,r=o||Yl(s),a=wn(r,pe(i));return IQ(a,s,r),e.makeTensorInfo(i,r,a)}const SQ={kernelName:Vx,backendName:"cpu",kernelFunc:Jb};function IQ(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Q={kernelName:Wx,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,s=n,o=di(i.dtype,pe(i.shape)),[r,a,l,c]=i.shape,u=s.data.get(i.dataId).values;for(let f=0;f<r;f++){const h=f*l*a*c;for(let p=0;p<a;p++){const m=p*(l*c);for(let g=0;g<l;g++){const v=g*c;for(let x=0;x<c;x++){const b=Math.round(l-g-1),w=h+m+v+x;let y=u[w];if(b>=0&&b<l){const C=b*c,I=h+m+C+x;y=u[I]}o[w]=y}}}}return{dataId:s.write(o,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o,bias:r,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=i;let m=qT({inputs:{x:s,filter:o},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f}});if(r){const g=m;if(u==="NCHW"&&r.shape.length===1&&r.shape[0]!==1){const v=tn({inputs:{x:r},backend:n,attrs:{shape:[r.shape[0],1,1]}});m=Fl({inputs:{a:m,b:v},backend:n}),n.disposeIntermediateTensorInfo(v)}else m=Fl({inputs:{a:m,b:r},backend:n});n.disposeIntermediateTensorInfo(g)}if(h){const g=m;if(u==="NCHW"&&h==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const v=tn({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=Xh(n,m,h,v,p),n.disposeIntermediateTensorInfo(v)}else m=Xh(n,m,h,a,p);n.disposeIntermediateTensorInfo(g)}return m}const NQ={kernelName:Eh,backendName:"cpu",kernelFunc:EQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o,bias:r,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=i;let m=YT({inputs:{x:s,filter:o},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f}});if(r){const g=m;m=Fl({inputs:{a:m,b:r},backend:n}),n.disposeIntermediateTensorInfo(g)}if(h){const g=m;m=Xh(n,m,h,a,p),n.disposeIntermediateTensorInfo(g)}return m}const DQ={kernelName:OE,backendName:"cpu",kernelFunc:kQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(t){const{inputs:e,backend:n}=t,{params:i,indices:s}=e,o=pe(i.shape),r=s.shape,a=r[r.length-1],[l,c,u,d]=q0(i,s);if(c===0)return n.makeTensorInfo(l,i.dtype,[]);const f=n.data.get(s.dataId).values,h=n.bufferSync(i),p=aT(f,h,i.dtype,c,a,u,d,i.shape,o);return n.makeTensorInfo(l,i.dtype,p.values)}const RQ={kernelName:gE,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,indices:o}=e,{axis:r,batchDims:a}=i;Ge([s,o],"gatherV2");const l=St(r,s.shape)[0],c=n.data.get(o.dataId).values,u=s.shape[l];for(let w=0;w<c.length;++w){const y=c[w];F(y<=u-1&&y>=0,()=>`GatherV2: the index value ${y} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const f=pe(o.shape),h=bb(s,o,l,d),p=tn({inputs:{x:s},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),m=tn({inputs:{x:o},backend:n,attrs:{shape:[h.batchSize,f/h.batchSize]}}),g=[h.batchSize,h.outerSize,f/h.batchSize,h.sliceSize],v=n.bufferSync(m),x=n.bufferSync(p),b=lT(x,v,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(h.outputShape,b.dtype,b.values)}const AQ={kernelName:Lf,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(t){const{inputs:e,backend:n}=t,{input:i}=e,s=pe(i.shape),o=i.shape[i.shape.length-1],r=s/o,a=tn({inputs:{x:i},backend:n,attrs:{shape:[r,o]}}),l=JT(a,!0,n),c=tn({inputs:{x:l},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const PQ={kernelName:Gx,backendName:"cpu",kernelFunc:OQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MQ=Ht(Du,t=>Number.isFinite(t)?1:0,"bool"),FQ={kernelName:Du,backendName:"cpu",kernelFunc:MQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ=Ht(Tu,t=>Math.abs(t)===1/0?1:0,"bool"),zQ={kernelName:Tu,backendName:"cpu",kernelFunc:LQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ=Ht(Ru,t=>Number.isNaN(t)?1:0,"bool"),VQ={kernelName:Ru,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WQ(t){const{backend:e,attrs:n}=t,{start:i,stop:s,num:o}=n,r=fT(i,s,o);return e.makeTensorInfo([r.length],"float32",r)}const GQ={kernelName:vE,backendName:"cpu",kernelFunc:WQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HQ=Ht(Au,t=>Math.log1p(t)),UQ={kernelName:Au,backendName:"cpu",kernelFunc:HQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jQ=Dn((t,e)=>t&&e),KQ=Wn(Gf,jQ,null,"bool"),XQ={kernelName:Gf,backendName:"cpu",kernelFunc:KQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ=Ht(Hf,t=>t?0:1,"bool"),YQ={kernelName:Hf,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JQ=Dn((t,e)=>t||e),ZQ=Wn(Uf,JQ,null,"bool"),QQ={kernelName:Uf,backendName:"cpu",kernelFunc:ZQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{depthRadius:o,bias:r,alpha:a,beta:l}=i;Ge(s,"LRN");const c=s.shape[3],u=c-1,d=n.data.get(s.dataId).values,f=pe(s.shape),h=new Float32Array(f);function p(m){const g=m%c;let v=m-g+Math.max(0,g-o);const x=m-g+Math.min(g+o,u);let b=0;for(;v<=x;v++){const w=d[v];b+=w*w}return b}for(let m=0;m<f;m++){const g=p(m),v=d[m]*Math.pow(r+a*g,-l);h[m]=v}return n.makeTensorInfo(s.shape,s.dtype,h)}const tee={kernelName:jf,backendName:"cpu",kernelFunc:eee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,y:o,dy:r}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=i;Ge(r,"LRNGrad");const d=pe(r.shape),f=r.shape[3],h=n.data.get(r.dataId).values,p=n.data.get(s.dataId).values,m=n.data.get(o.dataId).values,g=new Float32Array(d),v=d;for(let x=0;x<v;x++){const b=x%f,w=x-b+Math.max(0,b-a),y=x-b+Math.min(f,b+a+1);let C=0;for(let I=w;I<y;I++)C+=Math.pow(p[I],2);C=c*C+l;for(let I=w;I<y;I++){let $=-2*c*u*p[I]*m[x]/C;x===I&&($+=Math.pow(C,-u)),$*=h[x],g[I]+=$}}return n.makeTensorInfo(r.shape,s.dtype,g)}const iee={kernelName:Ux,backendName:"cpu",kernelFunc:nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{reductionIndices:o,keepDims:r}=i,a=n;let l=s.shape;const c=l.length,u=St(o,l);let d=u;const f=mn(d,c);let h=a.data.get(s.dataId).values;if(f!=null){const w=new Array(c);for(let y=0;y<w.length;y++)w[y]=l[f[y]];h=jb(h,l,s.dtype,f,w),d=Nn(d.length,c),l=w}Ge(s,"max"),ii("max",d,c);const[p,m]=Yn(l,d),g=pe(m),v=mT(h,g,p,s.dtype),x=a.write(v,p,s.dtype);let b=p;return r&&(b=Rn(p,u)),{dataId:x,shape:b,dtype:s.dtype}}const see={kernelName:Kf,backendName:"cpu",kernelFunc:ZT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e;Ge(s,"maxPool");const{filterSize:o,strides:r,pad:a,dimRoundingMode:l}=i,c=1;F(pi(r,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const u=As(s.shape,o,r,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Wt(u.inShape,u.outShape))d=No({inputs:{x:s},backend:n});else{const f=n.data.get(s.dataId).values,h=Ye(s.shape),p=qb(f,s.shape,s.dtype,h,u,"max");d=n.makeTensorInfo(u.outShape,s.dtype,p.values)}return d}const ree={kernelName:Xf,backendName:"cpu",kernelFunc:oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{filterSize:o,strides:r,pad:a,dimRoundingMode:l,dataFormat:c}=i;Ge(s,"maxPool3d");const u=er(s.shape,o,r,1,a,l,c),d=n.data.get(s.dataId).values,f=XT(d,s.shape,s.dtype,Ye(s.shape),u,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const lee={kernelName:qf,backendName:"cpu",kernelFunc:aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cee(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o}=e,{filterSize:r,strides:a,pad:l,dimRoundingMode:c}=i;Ge([s,o],"maxPool3DGrad");const u=er(o.shape,r,a,1,l,c),d=n.bufferSync(o),f=JJ(d,u),h=u.strideDepth,p=u.strideHeight,m=u.strideWidth,g=u.dilationDepth,v=u.dilationHeight,x=u.dilationWidth,b=u.effectiveFilterDepth,w=u.effectiveFilterHeight,y=u.effectiveFilterWidth,C=b-1-u.padInfo.front,I=y-1-u.padInfo.left,$=w-1-u.padInfo.top,E=Ct(o.shape,"float32"),N=n.bufferSync(s);for(let k=0;k<u.batchSize;++k)for(let D=0;D<u.inChannels;++D)for(let _=0;_<u.inDepth;++_)for(let R=0;R<u.inHeight;++R)for(let T=0;T<u.inWidth;++T){const A=_-C,O=R-$,P=T-I;let M=0;for(let z=0;z<b;z+=g){const L=(A+z)/h;if(!(L<0||L>=u.outDepth||Math.floor(L)!==L))for(let W=0;W<w;W+=v){const B=(O+W)/p;if(!(B<0||B>=u.outHeight||Math.floor(B)!==B))for(let q=0;q<y;q+=x){const H=(P+q)/m;if(H<0||H>=u.outWidth||Math.floor(H)!==H)continue;const ne=b*w*y-1-f.get(k,L,B,H,D),te=z*w*y+W*y+q,ae=ne===te?1:0;if(ae===0)continue;const re=N.get(k,L,B,H,D);M+=re*ae}}}E.set(M,k,_,R,T,D)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const uee={kernelName:Kx,backendName:"cpu",kernelFunc:cee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dee(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o,output:r}=e,a=o;Ge([o,r],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=i,f=As(a.shape,l,c,1,u,d),h=n.data.get(a.dataId).values,p=Ct(f.outShape,a.dtype,KT(h,a.shape,a.dtype,f).values),m=f.strideHeight,g=f.strideWidth,v=f.dilationHeight,x=f.dilationWidth,b=f.effectiveFilterHeight,w=f.effectiveFilterWidth,y=w-1-f.padInfo.left,C=b-1-f.padInfo.top,I=Ct(a.shape,"float32"),$=n.data.get(s.dataId).values,E=Ct(s.shape,"float32",$);for(let N=0;N<f.batchSize;++N)for(let k=0;k<f.inChannels;++k)for(let D=0;D<f.inHeight;++D)for(let _=0;_<f.inWidth;++_){const R=D-C,T=_-y;let A=0;for(let O=0;O<b;O+=v){const P=(R+O)/m;if(!(P<0||P>=f.outHeight||Math.floor(P)!==P))for(let M=0;M<w;M+=x){const z=(T+M)/g;if(z<0||z>=f.outWidth||Math.floor(z)!==z)continue;const L=b*w-1-p.get(N,P,z,k),W=O*w+M,B=L===W?1:0;if(B===0)continue;const q=E.get(N,P,z,k);A+=q*B}}I.set(A,N,D,_,k)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const hee={kernelName:jx,backendName:"cpu",kernelFunc:dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(t,e,n,i,s){const o=Ye(e),r=qb(t,e,n,o,s,"max"),a=KT(t,e,n,s,!0,i);return[r.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pee={kernelName:xE,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:s,strides:o,pad:r,includeBatchInIndex:a}=e,l=n;Ge(i,"MaxPoolWithArgmax");const c=l.data.get(i.dataId).values,u=As(i.shape,s,o,[1,1],r),[d,f]=fee(c,i.shape,i.dtype,a,u),h=l.write(d,u.outShape,i.dtype),p=l.write(f,u.outShape,i.dtype);return[{dataId:h,shape:u.outShape,dtype:i.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i,a=St(o,s.shape),c=Yn(s.shape,a)[1],u=pe(c),d=[],f=n.makeTensorInfo([],"float32",new Float32Array([u]));d.push(f);const h=Nr({inputs:{x:s},backend:n,attrs:{dtype:"float32"}});d.push(h);const p=Yb({inputs:{a:h,b:f},backend:n});d.push(p);const m=bd({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:r}});return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const gee={kernelName:Yf,backendName:"cpu",kernelFunc:mee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i;Ge(s,"min");const a=St(o,s.shape);let l=a;const c=mn(l,s.shape.length);let u=s;c!=null&&(u=Li({inputs:{x:s},backend:n,attrs:{perm:c}}),l=Nn(l.length,s.shape.length)),ii("min",l,u.shape.length);const[d,f]=Yn(u.shape,l),h=pe(f),p=hi(pe(d),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const x=v*h;let b=m[x];for(let w=0;w<h;++w){const y=m[x+w];(Number.isNaN(y)||y<b)&&(b=y)}p[v]=b}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(r){const v=Rn(d,a),x=tn({inputs:{x:g},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(g),x}return g}const xee={kernelName:Jf,backendName:"cpu",kernelFunc:vee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{paddings:o,mode:r}=i;Ge(s,"mirrorPad");const a=o.map((b,w)=>b[0]+s.shape[w]+b[1]),l=o.map(b=>b[0]),c=o.map((b,w)=>b[0]+s.shape[w]),u=r==="reflect"?0:1,d=n.data.get(s.dataId).values,f=s.shape.length,h=Ye(s.shape),p=pe(a),m=a.length,g=Ye(a),v=di(s.dtype,p);for(let b=0;b<p;b++){let w=Jl(b,m,g);for(let C=0;C<m;C++)w[C]<l[C]?w[C]=l[C]*2-w[C]-u:w[C]>=c[C]&&(w[C]=(c[C]-1)*2-w[C]+u);w=w.map((C,I)=>C-l[I]);const y=mo(w,f,h);v[b]=d[y]}return{dataId:n.write(v,a,s.dtype),shape:a,dtype:s.dtype}}const yee={kernelName:Zf,backendName:"cpu",kernelFunc:bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wee=Dn((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),Cee=Wn(Mu,wee),See={kernelName:Mu,backendName:"cpu",kernelFunc:Cee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QT(t){const{inputs:e,backend:n,attrs:i}=t,{logits:s}=e,{dim:o}=i,r=s.shape.length;let a=o;if(a===-1&&(a=r-1),a!==r-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${r} and dim was ${a}`);const l=St([a],s.shape),c=ZT({inputs:{x:s},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Rn(c.shape,l),d=tn({inputs:{x:c},backend:n,attrs:{shape:u}}),f=Xb({inputs:{a:s,b:d},backend:n}),h=iT({inputs:{x:f},backend:n}),p=bd({inputs:{x:h},backend:n,attrs:{axis:l,keepDims:!1}}),m=tn({inputs:{x:p},backend:n,attrs:{shape:u}}),g=Yb({inputs:{a:h,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const Iee={kernelName:gp,backendName:"cpu",kernelFunc:QT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ee(t){const{inputs:e,backend:n,attrs:i}=t,{logits:s}=e,{numSamples:o,seed:r,normalized:a}=i;Ge(s,"multinomial");const l=a?s:QT({inputs:{logits:s},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=n.data.get(l.dataId).values,f=[c,o],h=hi(pe(f),"int32");for(let p=0;p<c;++p){const m=p*u,g=new Float32Array(u-1);g[0]=d[m];for(let b=1;b<g.length;++b)g[b]=g[b-1]+d[m+b];const v=O0.alea(r.toString()),x=p*o;for(let b=0;b<o;++b){const w=v();h[x+b]=g.length;for(let y=0;y<g.length;y++)if(w<g[y]){h[x+b]=y;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(f,"int32",h)}const Eee={kernelName:bE,backendName:"cpu",kernelFunc:$ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nee=G0;function kee(t){const{inputs:e,backend:n,attrs:i}=t,{boxes:s,scores:o}=e,{maxOutputSize:r,iouThreshold:a,scoreThreshold:l}=i;Ge(s,"NonMaxSuppression");const c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values,{selectedIndices:d}=Nee(c,u,r,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Dee={kernelName:Xx,backendName:"cpu",kernelFunc:kee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee=H0;function Ree(t){const{inputs:e,backend:n,attrs:i}=t,{boxes:s,scores:o}=e,{maxOutputSize:r,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=i;Ge(s,"NonMaxSuppressionPadded");const u=n.data.get(s.dataId).values,d=n.data.get(o.dataId).values,{selectedIndices:f,validOutputs:h}=Tee(u,d,r,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}const _ee={kernelName:qx,backendName:"cpu",kernelFunc:Ree};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aee=U0;function Oee(t){const{inputs:e,backend:n,attrs:i}=t,{boxes:s,scores:o}=e,{maxOutputSize:r,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=i;Ge(s,"NonMaxSuppressionWithScore");const u=n.data.get(s.dataId).values,d=n.data.get(o.dataId).values,f=r,h=a,p=l,m=c,{selectedIndices:g,selectedScores:v}=Aee(u,d,f,h,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const Pee={kernelName:Yx,backendName:"cpu",kernelFunc:Oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mee(t){const{inputs:e,backend:n,attrs:i}=t,{indices:s}=e,{dtype:o,depth:r,onValue:a,offValue:l}=i;Ge(s,"oneHot");const c=pe(s.shape),u=new Float32Array(c*r);u.fill(l);const d=n.data.get(s.dataId).values;for(let f=0;f<c;++f)d[f]>=0&&d[f]<r&&(u[f*r+d[f]]=a);return n.makeTensorInfo([...s.shape,r],o,u)}const Fee={kernelName:np,backendName:"cpu",kernelFunc:Mee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yh(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(i.dtype==="complex64"){const s=$a({inputs:{input:i},backend:n}),o=Yh({inputs:{x:s},backend:n}),r=Ll({inputs:{input:i},backend:n}),a=Yh({inputs:{x:r},backend:n}),l=Gi({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),l}else return Jb({backend:n,attrs:{shape:i.shape,value:0,dtype:i.dtype}})}const Lee={kernelName:bp,backendName:"cpu",kernelFunc:Yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(i.dtype==="complex64"){const s=$a({inputs:{input:i},backend:n}),o=eR({inputs:{x:s},backend:n}),r=Ll({inputs:{input:i},backend:n}),a=Yh({inputs:{x:r},backend:n}),l=Gi({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),l}else return Jb({backend:n,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}const zee={kernelName:tp,backendName:"cpu",kernelFunc:eR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tR(t){const{inputs:e,backend:n,attrs:i}=t,{axis:s}=i;if(e.length===1)return qh({inputs:{input:e[0]},backend:n,attrs:{dim:s}});const o=e[0].shape,r=e[0].dtype;e.forEach(u=>{vx(o,u.shape,"All tensors passed to stack must have matching shapes"),F(r===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=qh({inputs:{input:u},backend:n,attrs:{dim:s}});return a.push(d),d}),c=zl({inputs:l,backend:n,attrs:{axis:s}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const Bee={kernelName:ip,backendName:"cpu",kernelFunc:tR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vee(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{paddings:o,constantValue:r}=i;Ge(s,"pad");const a=o.map((x,b)=>x[0]+s.shape[b]+x[1]),l=o.map(x=>x[0]),c=n.data.get(s.dataId).values,u=pe(s.shape),d=s.shape.length,f=Ye(s.shape),h=pe(a),p=a.length,m=Ye(a),g=di(s.dtype,h);r!==0&&g.fill(r);for(let x=0;x<u;x++){const w=Jl(x,d,f).map((C,I)=>C+l[I]),y=mo(w,p,m);g[y]=c[x]}return{dataId:n.write(g,a,s.dtype),shape:a,dtype:s.dtype}}const nR={kernelName:sp,backendName:"cpu",kernelFunc:Vee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wee=Dn((t,e)=>Math.pow(t,e)),Gee=Wn(Lu,Wee),Hee={kernelName:Lu,backendName:"cpu",kernelFunc:Gee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(t){const{inputs:e,backend:n,attrs:i}=t,{paramsNestedSplits:s,paramsDenseValues:o,indices:r}=e,a=s.map(g=>n.data.get(g.dataId).values),l=s.map(g=>g.shape),c=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values,[d,f,h]=wT(a,l,c,o.shape,o.dtype,u,r.shape),p=d.map(g=>n.makeTensorInfo([g.length],"int32",g)),m=n.makeTensorInfo(h,o.dtype,f);return p.concat([m])}const jee={kernelName:yE,backendName:"cpu",kernelFunc:Uee};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kee(t){const{inputs:e,backend:n}=t,{starts:i,limits:s,deltas:o}=e,r=n.data.get(i.dataId).values,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,[c,u]=CT(r,i.shape,i.dtype,a,s.shape,l,o.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([u.length],i.dtype,u);return[d,f]}const Xee={kernelName:wE,backendName:"cpu",kernelFunc:Kee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qee(t){const{inputs:e,backend:n,attrs:i}=t,{shape:s,values:o,defaultValue:r,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=i,c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values,d=n.data.get(r.dataId).values,f=a.map(g=>n.data.get(g.dataId).values),h=a.map(g=>g.shape),[p,m]=ST(c,s.shape,u,o.shape,o.dtype,d,r.shape,f,h,l);return n.makeTensorInfo(p,o.dtype,m)}const Yee={kernelName:CE,backendName:"cpu",kernelFunc:qee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jee(t){const{backend:e,attrs:n}=t,{start:i,stop:s,dtype:o,step:r}=n,a=IT(i,s,r,o);return e.makeTensorInfo([a.length],o,a)}const Zee={kernelName:Jx,backendName:"cpu",kernelFunc:Jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qee=Ht(zu,t=>1/t),ete={kernelName:zu,backendName:"cpu",kernelFunc:Qee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tte(t){const{inputs:e,backend:n,attrs:i}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:r,size:a}=i;Ge(s,"resizeBilinear");const l=Ye(s.shape),[c,u]=a,[d,f,h,p]=s.shape,m=n.data.get(s.dataId).values,g=new Float32Array(pe([d,c,u,p])),v=[o&&c>1?f-1:f,o&&u>1?h-1:h],x=[o&&c>1?c-1:c,o&&u>1?u-1:u];let b=0;const w=v[0]/x[0],y=v[1]/x[1];for(let C=0;C<d;C++)for(let I=0;I<c;I++){let $;r?$=w*(I+.5)-.5:$=w*I;const E=Math.max(0,Math.floor($)),N=$-E,k=Math.min(f-1,Math.ceil($)),D=C*l[0]+E*l[1],_=C*l[0]+k*l[1];for(let R=0;R<u;R++){let T;r?T=y*(R+.5)-.5:T=y*R;const A=Math.max(0,Math.floor(T)),O=T-A,P=Math.min(h-1,Math.ceil(T)),M=D+A*l[2],z=_+A*l[2],L=D+P*l[2],W=_+P*l[2];for(let B=0;B<p;B++){const q=m[M+B],H=m[z+B],ne=m[L+B],te=m[W+B],ae=q+(ne-q)*O,re=H+(te-H)*O,ee=ae+(re-ae)*N;g[b++]=ee}}}return n.makeTensorInfo([d,c,u,p],"float32",g)}const nte={kernelName:cp,backendName:"cpu",kernelFunc:tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(t){const{inputs:e,backend:n,attrs:i}=t,{images:s,dy:o}=e,{alignCorners:r}=i;Ge([o,s],"resizeBilinearGrad");const a=Ye(s.shape),[l,c,u,d]=s.shape,[,f,h]=o.shape,p=new Float32Array(l*c*u*d),m=[r&&f>1?c-1:c,r&&h>1?u-1:u],g=[r&&f>1?f-1:f,r&&h>1?h-1:h],v=m[0]/g[0],x=m[1]/g[1],b=n.data.get(o.dataId).values;let w=0;for(let y=0;y<l;y++){const C=y*a[0];for(let I=0;I<f;I++){const $=I*v,E=Math.floor($),N=Math.min(Math.ceil($),c-1),k=C+E*a[1],D=C+N*a[1],_=$-E,R=1-_;for(let T=0;T<h;T++){const A=T*x,O=Math.floor(A),P=Math.min(Math.ceil(A),u-1),M=A-O,z=1-M,L=k+O*a[2],W=k+P*a[2],B=D+O*a[2],q=D+P*a[2],H=R*z,ne=R*M,te=_*z,ae=_*M;for(let re=0;re<d;re++){const ee=b[w++];p[L+re]+=ee*H,p[W+re]+=ee*ne,p[B+re]+=ee*te,p[q+re]+=ee*ae}}}}return n.makeTensorInfo([l,u,c,d],"float32",p)}const ste={kernelName:e0,backendName:"cpu",kernelFunc:ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ote(t){const{inputs:e,backend:n,attrs:i}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:r,size:a}=i;Ge(s,"resizeNearestNeighbor");const l=Ye(s.shape),[c,u]=a,[d,f,h,p]=s.shape,m=n.data.get(s.dataId).values,g=new Float32Array(d*c*u*p),v=[o&&c>1?f-1:f,o&&u>1?h-1:h],x=[o&&c>1?c-1:c,o&&u>1?u-1:u],b=v[0]/x[0],w=v[1]/x[1];let y=0;for(let C=0;C<d;C++){const I=C*l[0];for(let $=0;$<c;$++){const E=r?b*($+.5):b*$;let N=Math.min(f-1,o?Math.round(E):Math.floor(E));r&&(N=Math.max(0,N));const k=I+N*l[1];for(let D=0;D<u;D++){const _=r?w*(D+.5):w*D;let R=Math.min(h-1,o?Math.round(_):Math.floor(_));r&&(R=Math.max(0,R));const T=k+R*l[2];for(let A=0;A<p;A++){const O=m[T+A];g[y++]=O}}}}return n.makeTensorInfo([d,c,u,p],s.dtype,g)}const rte={kernelName:lp,backendName:"cpu",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ate(t){const{inputs:e,backend:n,attrs:i}=t,{images:s,dy:o}=e,{alignCorners:r}=i;Ge([o,s],"resizeNearestNeighborGrad");const a=Ye(s.shape),l=Ye(o.shape),[c,u,d,f]=s.shape,[,h,p]=o.shape,m=new Float32Array(c*u*d*f),g=n.data.get(o.dataId).values,v=[r&&h>1?u-1:u,r&&p>1?d-1:d],x=[r&&h>1?h-1:h,r&&p>1?p-1:p],b=v[0]/x[0],w=v[1]/x[1],y=1/b,C=1/w,I=Math.ceil(y)*2+2,$=Math.ceil(C)*2+2;for(let E=0;E<c;E++){const N=E*a[0];for(let k=0;k<u;k++){const D=N+k*a[1],_=Math.floor(k*y),R=Math.floor(_-I/2);for(let T=0;T<d;T++){const A=D+T*a[2],O=Math.floor(T*C),P=Math.floor(O-$/2);for(let M=0;M<f;M++){let z=0;for(let L=0;L<I;L++){const W=L+R;if(W<0||W>=h)continue;const B=N+W*l[1],q=W*b,H=Math.min(u-1,r?Math.round(q):Math.floor(q));if(k===H)for(let ne=0;ne<$;ne++){const te=ne+P;if(te<0||te>=p)continue;const ae=B+te*l[2],re=te*w,ee=Math.min(d-1,r?Math.round(re):Math.floor(re));T===ee&&(z+=g[ae+M])}}m[A+M]=z}}}}return n.makeTensorInfo(s.shape,s.dtype,m)}const lte={kernelName:Qx,backendName:"cpu",kernelFunc:ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cte(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{dims:o}=i;Ge(s,"reverse");const r=s.shape.length,a=St(o,s.shape);if(r===0)return No({inputs:{x:s},backend:n});const l=new ti(s.shape,s.dtype),c=n.bufferSync(s);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),f=d.slice();a.forEach(h=>f[h]=s.shape[h]-1-f[h]),l.set(c.get(...f),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const ute={kernelName:up,backendName:"cpu",kernelFunc:cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dte={kernelName:a0,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:s,fillValue:o,center:r}=e,a=n,l=di(i.dtype,pe(i.shape)),[c,u,d,f]=i.shape,[h,p]=ib(r,u,d),m=255,g=Math.sin(s),v=Math.cos(s),x=a.data.get(i.dataId).values;for(let w=0;w<c;w++){const y=w*d*u*f;for(let C=0;C<u;C++){const I=C*(d*f);for(let $=0;$<d;$++){const E=$*f;for(let N=0;N<f;N++){const k=[c,C,$,N],D=k[2],_=k[1];let R=(D-h)*v-(_-p)*g,T=(D-h)*g+(_-p)*v;R=Math.round(R+h),T=Math.round(T+p);let A=o;if(typeof o!="number"&&(N===3?A=m:A=o[N]),R>=0&&R<d&&T>=0&&T<u){const P=T*(d*f),M=R*f,z=y+P+M+N;A=x[z]}const O=y+I+E+N;l[O]=A}}}}return{dataId:a.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hte=Ht(Wu,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),fte={kernelName:Wu,backendName:"cpu",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pte(t){const{inputs:e,backend:n,attrs:i}=t,{indices:s,updates:o}=e,{shape:r}=i,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=La(o,s,r),f=!0,h=n.bufferSync(s),p=n.bufferSync(o),m=ta(h,p,r,d,c,l,a,u,0,f);return n.makeTensorInfo(r,m.dtype,m.values)}const mte={kernelName:SE,backendName:"cpu",kernelFunc:pte};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gte(t,e){let n=0,i=t.length,s=0;for(;n<i;)s=Math.floor((n+i)/2),t[s]<e?n=s+1:i=s;return i}function vte(t,e){let n=0,i=t.length,s=0;for(;n<i;)s=Math.floor((n+i)/2),t[s]<=e?n=s+1:i=s;return i}function xte(t,e,n,i,s,o){const r=wn("int32",n*s);for(let a=0;a<n;++a){const l=t.slice(a*i,(a+1)*i),c=a*s;for(let u=0;u<s;++u)r[c+u]=o==="left"?gte(l,e[u+c]):vte(l,e[u+c])}return r}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bte(t){const{inputs:e,backend:n,attrs:i}=t,{sortedSequence:s,values:o}=e,{side:r}=i,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,c=xte(a,l,s.shape[0],s.shape[1],o.shape[1],r);return n.makeTensorInfo(o.shape,"int32",c)}const yte={kernelName:$E,backendName:"cpu",kernelFunc:bte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wte(t){const{inputs:e,backend:n}=t,{condition:i,t:s,e:o}=e;Ge([i,s,o],"select");const r=i.shape.length,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,u=qi(s.dtype,o.dtype),d=hi(pe(s.shape),u);let f=0;const h=r===0||r>1||s.shape.length===1?1:pe(s.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<h;m++)a[p]===1?d[f++]=l[p]:d[f++]=c[p];return n.makeTensorInfo(s.shape,u,d)}const Cte={kernelName:dp,backendName:"cpu",kernelFunc:wte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ste=Rp,Ite=_p,$te=Ht(Hu,t=>t>=0?Ite*t:Ste*(Math.exp(t)-1)),Ete={kernelName:Hu,backendName:"cpu",kernelFunc:$te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte=Ht(Ku,t=>t<0?-1:t>0?1:0),kte={kernelName:Ku,backendName:"cpu",kernelFunc:Nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dte=Ht(Uu,t=>Math.sin(t)),Tte={kernelName:Uu,backendName:"cpu",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=Ht(ju,t=>Math.sinh(t)),_te={kernelName:ju,backendName:"cpu",kernelFunc:Rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ate=11920928955078125e-23,gS=Math.log(Ate)+2,Ote=Ht(qu,t=>{const e=t>-gS,n=t<gS,i=Math.exp(t);let s;return n?s=i:e?s=t:s=Math.log(1+i),s}),Pte={kernelName:qu,backendName:"cpu",kernelFunc:Ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mte(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{blockShape:o,paddings:r}=i;Ge([s],"spaceToBatchND");const a=pe(o),l=[[0,0]];l.push(...r);for(let C=1+o.length;C<s.shape.length;++C)l.push([0,0]);const c=nR.kernelFunc({inputs:{x:s},backend:n,attrs:{paddings:l,constantValue:0}}),u=ld(c.shape,o,a,!1),d=cd(u.length,o.length,!1),f=ud(c.shape,o,a,!1),m=tn({inputs:{x:c},backend:n,attrs:{shape:u}}),x=Li({inputs:{x:m},backend:n,attrs:{perm:d}}),y=tn({inputs:{x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),y}const Fte={kernelName:pp,backendName:"cpu",kernelFunc:Mte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lte(t){const{inputs:e,backend:n}=t,{indices:i,values:s,denseShape:o,defaultValue:r}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${i.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${r.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values[0],[d,f,h,p,m]=kT(a,i.shape,i.dtype,l,s.dtype,c,u);return[n.makeTensorInfo(f,i.dtype,d),n.makeTensorInfo([f[0]],s.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}const zte={kernelName:EE,backendName:"cpu",kernelFunc:Lte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bte(t){const{inputs:e,backend:n}=t,{inputIndices:i,inputShape:s,newShape:o}=e;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${i.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const r=Array.from(n.data.get(s.dataId).values),a=n.data.get(i.dataId).values,l=Array.from(n.data.get(o.dataId).values),[c,u,d]=DT(a,i.shape,i.dtype,r,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const Vte={kernelName:NE,backendName:"cpu",kernelFunc:Bte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wte(t){const{inputs:e,backend:n}=t,{data:i,indices:s,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(s.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const r=n.data.get(i.dataId).values,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,[c,u]=Kb(r,i.shape,i.dtype,a,l,!0);return n.makeTensorInfo(u,i.dtype,c)}const Gte={kernelName:kE,backendName:"cpu",kernelFunc:Wte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(t){const{inputs:e,backend:n}=t,{data:i,indices:s,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(s.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const r=n.data.get(i.dataId).values,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,[c,u]=Kb(r,i.shape,i.dtype,a,l);return n.makeTensorInfo(u,i.dtype,c)}const Ute={kernelName:DE,backendName:"cpu",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jte(t){const{inputs:e,backend:n,attrs:i}=t,{sparseIndices:s,sparseValues:o,defaultValue:r}=e,{outputShape:a}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:f}=La(o,s,a),h=!1,p=n.bufferSync(s);let m;switch(o.dtype){case"bool":{const g=n.bufferSync(o),v=!!n.data.get(r.dataId).values[0];m=ta(p,g,a,f,u,c,l,d,v,h);break}case"float32":{const g=n.bufferSync(o),v=n.data.get(r.dataId).values[0];m=ta(p,g,a,f,u,c,l,d,v,h);break}case"int32":{const g=n.bufferSync(o),v=n.data.get(r.dataId).values[0];m=ta(p,g,a,f,u,c,l,d,v,h);break}case"string":{const g=n.bufferSync(o),v=Cr(n.data.get(r.dataId).values[0]);m=ta(p,g,a,f,u,c,l,d,v,h);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const Kte={kernelName:TE,backendName:"cpu",kernelFunc:jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xte(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{numOrSizeSplits:o,axis:r}=i,a=St(r,s.shape)[0],l=xb(s,o,a),c=new Array(s.shape.length).fill(0),u=s.shape.slice();return l.map(d=>{const f=[...u];f[a]=d;const h=Ea({inputs:{x:s},backend:n,attrs:{begin:c,size:f}});return c[a]+=d,h})}const qte={kernelName:mp,backendName:"cpu",kernelFunc:Xte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yte={kernelName:t0,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,i=e;Ge(n,"square");const s=i.data.get(n.dataId).values,o=new Float32Array(s.length);for(let a=0;a<s.length;++a){const l=s[a];o[a]=l*l}return{dataId:i.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte=Ht(nd,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),Zte={kernelName:nd,backendName:"cpu",kernelFunc:Jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qte(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{begin:o,end:r,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:f}=i;Ge(s,"stridedSlice");const{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:x,end:b,strides:w}=eb(s.shape,o,r,a,l,c,u,d,f);let y;if(m)y=tn({inputs:{x:s},backend:n,attrs:{shape:p}});else if(g||v){F(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const C=J0(x,b,w),I=Ea({inputs:{x:s},backend:n,attrs:{begin:x,size:C}});y=tn({inputs:{x:I},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(I)}else{const C=n.bufferSync(s),I=_T(h,C,w,x);y=n.makeTensorInfo(p,I.dtype,I.values)}return y}const ene={kernelName:i0,backendName:"cpu",kernelFunc:Qte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tne(t){const{inputs:e,backend:n,attrs:i}=t,{separator:s,nGramWidths:o,leftPad:r,rightPad:a,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:d}=e,f=n.data.get(u.dataId).values,h=n.data.get(d.dataId).values,[p,m]=AT(f,h,s,o,r,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const nne={kernelName:RE,backendName:"cpu",kernelFunc:tne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ine(t){const{inputs:e,backend:n,attrs:i}=t,{skipEmpty:s}=i,{input:o,delimiter:r}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(r.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${r.shape}`);const a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values[0],[c,u,d]=OT(a,l,s),f=u.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const sne={kernelName:_E,backendName:"cpu",kernelFunc:ine};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(t){const{inputs:e,backend:n,attrs:i}=t,{numBuckets:s}=i,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const r=n.data.get(o.dataId).values,a=PT(r,s);return n.makeTensorInfo(o.shape,"int32",a)}const rne={kernelName:AE,backendName:"cpu",kernelFunc:one};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane=Ht(Qu,t=>Math.tan(t)),lne={kernelName:Qu,backendName:"cpu",kernelFunc:ane};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cne=Ht(ed,t=>Math.tanh(t)),une={kernelName:ed,backendName:"cpu",kernelFunc:cne};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(t){const{inputs:e,backend:n}=t,{tensor:i,indices:s,updates:o}=e,{sliceRank:r,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=La(o,s,i.shape),d=!1,f=n.bufferSync(s),h=n.bufferSync(o),p=n.bufferSync(i),m=ta(f,h,i.shape,u,l,a,r,c,p,d);return n.makeTensorInfo(i.shape,m.dtype,m.values)}const hne={kernelName:IE,backendName:"cpu",kernelFunc:dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fne(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{reps:o}=i;Ge(s,"tile");const r=FT(n.bufferSync(s),o);return n.makeTensorInfo(r.shape,r.dtype,r.values)}const pne={kernelName:td,backendName:"cpu",kernelFunc:fne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{k:o,sorted:r}=i;Ge(s,"topk");const a=n.data.get(s.dataId).values,[l,c]=zT(a,s.shape,s.dtype,o,r);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const gne={kernelName:s0,backendName:"cpu",kernelFunc:mne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vne(t){const{inputs:e,attrs:n,backend:i}=t,{image:s,transforms:o}=e,{interpolation:r,fillMode:a,fillValue:l,outputShape:c}=n,[u,d,f,h]=s.shape,[p,m]=c??[d,f],g=[u,p,m,h],v=Ye(s.shape),x=v[0],b=v[1],w=v[2],y=Ye(g),C=y[0],I=y[1],$=y[2],E=di(s.dtype,pe(g));E.fill(l);const N=i.data.get(s.dataId).values,k=i.data.get(o.dataId).values;for(let _=0;_<u;++_){const R=o.shape[0]===1?k:k.subarray(_*8,_*8+8);for(let T=0;T<p;++T)for(let A=0;A<m;++A)for(let O=0;O<h;++O){let P;const M=R[6]*A+R[7]*T+1;if(M===0)continue;const z=(R[0]*A+R[1]*T+R[2])/M,L=(R[3]*A+R[4]*T+R[5])/M,W=vS(z,f,a),B=vS(L,d,a);switch(r){case"nearest":P=Sne(N,d,f,x,b,w,_,B,W,O,l);break;case"bilinear":P=Ine(N,d,f,x,b,w,_,B,W,O,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${r}`)}const q=_*C+T*I+A*$+O;E[q]=P}return i.makeTensorInfo(g,s.dtype,E)}return{dataId:i.write(E,g,s.dtype),shape:s.shape,dtype:s.dtype}}const xne={kernelName:o0,backendName:"cpu",kernelFunc:vne};function vS(t,e,n){switch(n){case"reflect":return bne(t,e);case"wrap":return yne(t,e);case"nearest":return Cne(t,e);case"constant":default:return wne(t)}}function bne(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const i=2*e;n<i&&(n=i*Math.trunc(-n/i)+n),n=n<-e?n+i:-n-1}else if(n>e-1)if(e<=1)n=0;else{const i=2*e;n-=i*Math.trunc(n/i),n>=e&&(n=i-n-1)}return fa(0,n,e-1)}function yne(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const i=e-1;n+=e*(Math.trunc(-n/i)+1)}else if(n>e-1)if(e<=1)n=0;else{const i=e-1;n-=e*Math.trunc(n/i)}return fa(0,n,e-1)}function wne(t,e){return t}function Cne(t,e){return fa(0,t,e-1)}function Ic(t,e,n,i,s,o,r,a,l,c,u){const d=r*i+a*s+l*o+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:u}function Sne(t,e,n,i,s,o,r,a,l,c,u){const d=Math.round(a),f=Math.round(l);return Ic(t,e,n,i,s,o,r,d,f,c,u)}function Ine(t,e,n,i,s,o,r,a,l,c,u){const d=Math.floor(a),f=Math.floor(l),h=d+1,p=f+1,m=(p-l)*Ic(t,e,n,i,s,o,r,d,f,c,u)+(l-f)*Ic(t,e,n,i,s,o,r,d,p,c,u),g=(p-l)*Ic(t,e,n,i,s,o,r,h,f,c,u)+(l-f)*Ic(t,e,n,i,s,o,r,h,p,c,u);return(h-a)*m+(a-d)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ne(t){const{inputs:e,attrs:n,backend:i}=t,{axis:s}=n,{x:o}=e;Ge(o,"unique");const r=i.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:c}=BT(r,s,o.shape,o.dtype);return[i.makeTensorInfo(l,o.dtype,a),i.makeTensorInfo([c.length],"int32",c)]}const Ene={kernelName:r0,backendName:"cpu",kernelFunc:$ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nne(t){const{inputs:e,backend:n,attrs:i}=t,{value:s}=e;let{axis:o}=i;o<0&&(o+=s.shape.length);const r=s.shape.length,a=s.shape[o],l=new Array(r-1);let c=0;for(let h=0;h<r;h++)h!==o&&(l[c++]=s.shape[h]);const u=new Array(r).fill(0),d=s.shape.slice();d[o]=1;const f=new Array(a);for(let h=0;h<f.length;h++){u[o]=h;const p=Ea({inputs:{x:s},backend:n,attrs:{begin:u,size:d}});f[h]=tn({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return f}const kne={kernelName:vp,backendName:"cpu",kernelFunc:Nne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dne(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,segmentIds:o}=e,{numSegments:r}=i;Ge(s,"unsortedSegmentSum");const a=s.shape.length,l=o.shape.length,c=[],u=[],d=a-l;let f=o;for(let p=0;p<d;++p){const m=qh({inputs:{input:f},backend:n,attrs:{dim:p+1}});f=m,u.push(m)}for(let p=0;p<r;++p){const m=Tr(p,"int32"),g=n.makeTensorInfo([],"int32",m),v=tT({inputs:{a:g,b:f},backend:n}),x=Nr({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),b=Hp({inputs:{a:x,b:s},backend:n}),w=bd({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});c.push(w),u.push(g),u.push(v),u.push(x),u.push(b),u.push(w)}const h=tR({inputs:c,backend:n,attrs:{axis:0}});return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),h}const Tne={kernelName:xp,backendName:"cpu",kernelFunc:Dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rne=[$J,oY,NJ,DJ,dY,RJ,AJ,PJ,FJ,zJ,VJ,GJ,UJ,XJ,YJ,QJ,tZ,iZ,oZ,SJ,aZ,cZ,dZ,fY,fZ,cY,mY,mZ,rY,vZ,bZ,yZ,CZ,IZ,EZ,kZ,TZ,_Z,OZ,MZ,LZ,BZ,WZ,HZ,UZ,KZ,qZ,JZ,ZZ,QZ,eQ,nQ,oQ,gJ,aQ,gY,mQ,vY,gQ,bY,CQ,SQ,$Q,wY,SY,NQ,DQ,RQ,AQ,$Y,NY,aY,PQ,xZ,FQ,zQ,VQ,vJ,DY,RY,GQ,AY,UQ,XQ,YQ,QQ,tee,iee,see,PY,ree,lee,uee,hee,pee,gee,xee,FY,yee,See,Eee,zY,VY,Dee,_ee,Pee,GY,Fee,zee,Bee,nR,Hee,bJ,jY,jee,Xee,Yee,Zee,lY,Yg,ete,yJ,wJ,CJ,nte,ste,rte,lte,ute,dte,fte,eJ,mte,yte,Cte,Ete,nJ,kte,Tte,_te,iJ,Iee,Pte,Fte,zte,Vte,Gte,Ute,Kte,qte,rJ,Yte,lJ,uJ,Zte,ene,nne,sne,rne,pJ,iQ,lne,une,hne,pne,gne,xne,HY,Ene,kne,Tne,Lee];for(const t of Rne)PE(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jr={},Hd={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function _ne(t,e){Jr[t]=e}function qs(t,e){if(!(t in Jr)||e!=null){const i=One(t,e);if(i!==null)Jr[t]=i;else return console.log("Could not get context for WebGL version",t),null}const n=Jr[t];return n==null||n.isContextLost()?(delete Jr[t],qs(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Jr[t])}function Ane(t){if(!le().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function One(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??Ane(t);return n.addEventListener("webglcontextlost",i=>{i.preventDefault(),delete Jr[t]},!1),le().getBool("SOFTWARE_WEBGL_ENABLED")&&(Hd.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",Hd)||n.getContext("experimental-webgl",Hd):n.getContext("webgl2",Hd)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yc;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Yc||(Yc={}));var ss;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(ss||(ss={}));var ei;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ei||(ei={}));function yd(t,e){return[e,t]}function Pne(t,e){return t*e}function Ud(t){const e=pe(t),n=Math.ceil(e/4);return bg(n)}function sc(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Mne(t,e){const[n,i]=sc(t,e);return n*i*4}function Zb(t,e){const n=t;let i,s,o,r,a,l,c,u,d,f;return le().getNumber("WEBGL_VERSION")===2?(i=n.R32F,s=n.R16F,o=n.RGBA16F,r=n.RGBA32F,a=n.RED,c=4,u=1,d=n.HALF_FLOAT,f=n.FLOAT,l=n.RGBA8):(i=t.RGBA,s=t.RGBA,o=t.RGBA,r=n.RGBA,a=t.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:r,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Me(t,e){const n=e();return le().getBool("DEBUG")&&Fne(t),n}function Fne(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Vne(t,e))}const Lne=596e-10,zne=65504;function Bne(t){return!!(le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Lne<Math.abs(t)&&Math.abs(t)<zne)}function Vne(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function jd(t,e){return nr(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function Wne(t,e){const n=nr(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Me(t,()=>t.shaderSource(n,e)),Me(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Gne(t,e){const n=nr(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Me(t,()=>t.shaderSource(n,e)),Me(t,()=>t.compileShader(n)),le().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw iR(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Hne=/ERROR: [0-9]+:([0-9]+):/g;function iR(t,e){const n=Hne.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const i=+n[1],s=t.split(`
`),o=s.length.toString().length+2,r=s.map((d,f)=>ll((f+1).toString(),o)+d);let a=0;for(let d=0;d<r.length;d++)a=Math.max(r[d].length,a);const l=r.slice(0,i-1),c=r.slice(i-1,i),u=r.slice(i);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${ll(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function Une(t){return nr(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function jne(t,e){if(Me(t,()=>t.linkProgram(e)),!le().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Am(t,e){if(Me(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Kne(t,e){const n=nr(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Me(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Me(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Xne(t,e){const n=nr(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Me(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),Me(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function qne(t){return nr(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Yne(t,e){const n=le().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const i=`[${t}x${e}]`;throw new Error("Requested texture size "+i+" is invalid.")}if(t>n||e>n){const i=`[${t}x${e}]`,s=`[${n}x${n}]`;throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+s+".")}}function Jne(t){return nr(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function xS(t,e,n,i,s,o,r){const a=t.getAttribLocation(e,n);return a===-1?!1:(Me(t,()=>t.bindBuffer(t.ARRAY_BUFFER,i)),Me(t,()=>t.vertexAttribPointer(a,s,t.FLOAT,!1,o,r)),Me(t,()=>t.enableVertexAttribArray(a)),!0)}function Zne(t,e,n){iie(t,n),Me(t,()=>t.activeTexture(t.TEXTURE0+n)),Me(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function Qne(t,e,n){return nr(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function eie(t,e,n){return t.getUniformLocation(e,n)}function tie(t,e,n,i){Me(t,()=>Zne(t,e,i)),Me(t,()=>t.uniform1i(n,i))}function Om(t,e,n){Me(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Me(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function bS(t,e){Me(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Me(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Kd(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+nie(t,e))}function nie(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function nr(t,e,n){const i=Me(t,()=>e());if(i==null)throw new Error(n);return i}function iie(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=e+t.TEXTURE0;if(i<t.TEXTURE0||i>n){const s=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${s}.`)}}function Bl(t,e=2){return pe(t.slice(0,t.length-e))}function Vl(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Xd(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Bl(t),...Vl(t)]),e}function sie(t,e=!1){let n=le().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=le().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");i===1/0&&le().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=n/2),e&&(n=n*2,i=i*2,t=t.map((a,l)=>l>=t.length-2?gx(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Dr(t).newShape);let s=pe(t),o=null;t.length<=1&&s<=n?o=[1,s]:t.length===2&&t[0]<=n&&t[1]<=n?o=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?o=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?o=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?o=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(o=[t[0],t[1]*t[2]*t[3]]);const r=o!=null&&Math.max(...o)>i&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||r)if(e){const a=Bl(t);let l=2,c=2;t.length&&([l,c]=Vl(t)),s=a*(l/2)*(c/2),o=bg(s).map(u=>u*2)}else o=bg(s);return o}function qd(t){return t%2===0}function Jh(t,e){if(t=t.slice(-2),e=e.slice(-2),Wt(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],i=e[e.length-1];if(n===i||qd(n)&&qd(i)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&qd(t[0])&&qd(e[0])}let Pm,Mm;function oie(t){if(Pm==null){const e=qs(t);Pm=e.getParameter(e.MAX_TEXTURE_SIZE)}return Pm}function rie(t){if(Mm==null){const e=qs(t);Mm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Mm)}function aie(t){if(t===0)return 0;let e;const n=qs(t);return Ns(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Ns(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ns(t,e){return t.getExtension(e)!=null}function yS(t){try{if(qs(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function lie(t){if(t===0)return!1;const e=qs(t);if(t===1){if(!Ns(e,"OES_texture_float"))return!1}else if(!Ns(e,"EXT_color_buffer_float"))return!1;return Zg(e)}function cie(t){if(t===0)return!1;const e=qs(t);if(t===1){if(!Ns(e,"OES_texture_float")||!Ns(e,"WEBGL_color_buffer_float"))return!1}else{if(Ns(e,"EXT_color_buffer_float"))return Zg(e);const i="EXT_color_buffer_half_float";if(Ns(e,i)){const s=e.getExtension(i);return uie(e,s)}return!1}return Zg(e)}function Zg(t){const e=Zb(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const r=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),r}function uie(t,e){const n=Zb(t,e),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(i),t.deleteFramebuffer(r),a}function die(t){return t!==2?!1:qs(t).fenceSync!=null}function wd(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&F(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const He=le();He.registerFlag("HAS_WEBGL",()=>He.getNumber("WEBGL_VERSION")>0);He.registerFlag("WEBGL_VERSION",()=>yS(2)?2:yS(1)?1:0);He.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);He.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>He.get("WEBGL_VERSION")===2);He.registerFlag("WEBGL_CPU_FORWARD",()=>!0);He.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);He.registerFlag("WEBGL_PACK",()=>He.getBool("HAS_WEBGL"));He.registerFlag("WEBGL_PACK_NORMALIZATION",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_CLIP",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_REDUCE",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_LAZILY_UNPACK",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_CONV_IM2COL",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>He.getBool("WEBGL_PACK"));He.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>oie(He.getNumber("WEBGL_VERSION")));He.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>rie(He.getNumber("WEBGL_VERSION")));He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=He.getNumber("WEBGL_VERSION");return t===0?0:aie(t)});He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>He.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ZE());He.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>lie(He.getNumber("WEBGL_VERSION")));He.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>He.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:He.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));He.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>cie(He.getNumber("WEBGL_VERSION")));He.registerFlag("WEBGL_FENCE_API_ENABLED",()=>die(He.getNumber("WEBGL_VERSION")));He.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>He.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);He.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});He.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>ZE()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});He.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);He.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);He.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);He.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);He.registerFlag("WEBGL_EXP_CONV",()=>!1);He.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>He.getBool("IS_TEST"));He.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);He.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);He.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);He.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(){let t,e,n,i,s,o,r,a,l,c;return le().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",i="in",s="texture",o="outputColor",r="out vec4 outputColor;",a=le().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",i="varying",s="texture2D",o="gl_FragColor",r="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:i,texture2D:s,output:o,defineOutput:r,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Va(t,e,n="index"){const i=Ye(e);return i.map((s,o)=>{const r=`int ${t[o]} = ${n} / ${s}`,a=o===i.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${s}`:`index -= ${t[o]} * ${s}`;return`${r}; ${a};`}).join("")}function Up(t,e,n="index"){const i=Ye(e);return i.map((s,o)=>{const r=`int ${t[o]} = ${n} / outShapeStrides[${o}]`,a=o===i.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * outShapeStrides[${o}]`:`index -= ${t[o]} * outShapeStrides[${o}]`;return`${r}; ${a};`}).join("")}function hie(t,e){const n=t.length,i=t.map(o=>`${e}[${o}]`),s=new Array(n-1);s[n-2]=i[n-1];for(let o=n-3;o>=0;--o)s[o]=`(${s[o+1]} * ${i[o+1]})`;return s}function fie(t,e,n="index"){const i=t.map((o,r)=>r),s=hie(i,e);return s.map((o,r)=>{const a=`int ${t[r]} = ${n} / ${s[r]}`,l=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${s[r]}`:`index -= ${t[r]} * ${s[r]}`;return`${a}; ${l};`}).join("")}function Qb(t){const e=Ye(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function ey(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const sR=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:oR}=e7;function pie(t,e,n){const i=[];if(t.forEach(h=>{const p=pe(h.shapeInfo.logicalShape);if(h.shapeInfo.isUniform?i.push(`uniform float ${h.name}${p>1?`[${p}]`:""};`):(i.push(`uniform sampler2D ${h.name};`),i.push(`uniform int offset${h.name};`)),n.enableShapeUniforms){const{uniformShape:m}=ty(n.packedInputs,h.shapeInfo.logicalShape,h.shapeInfo.texShape);switch(m.length){case 1:i.push(`uniform int ${h.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${h.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${h.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${h.name}Shape;`);break}i.push(`uniform ivec2 ${h.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;");break}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(h=>{i.push(`uniform ${h.type} ${h.name}${h.arrayIndex?`[${h.arrayIndex}]`:""};`)});const s=i.join(`
`),o=t.map(h=>mie(h,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),r=e.texShape,a=Ni(),l=xie(a);let c,u,d=wie(a);return e.isPacked?(c=gie(e.logicalShape,r,n.enableShapeUniforms),u=yie(a)):(c=vie(e.logicalShape,r,n.enableShapeUniforms),u=bie(a)),n.packedInputs&&(d+=$ie),[d,l,u,s,c,o,n.userCode].join(`
`)}function oc(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return Fie(t,e);case 1:return zie(t,e);case 2:return Vie(t,e);case 3:return Gie(t,e);case 4:return Uie(t,e);case 5:return jie(t);case 6:return Kie(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function rR(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Mie(t);case 1:return Lie(t,e);case 2:return Bie(t,e);case 3:return Wie(t,e);default:return Hie(t,e)}}function mie(t,e,n=!1,i){let s="";n?s+=rR(t,i):s+=oc(t,i);const o=t.shapeInfo.logicalShape,r=e.logicalShape;return o.length<=r.length&&(n?s+=Xie(t,e):s+=qie(t,e)),s}function gie(t,e,n){switch(t.length){case 0:return aR();case 1:return Eie(t,e,n);case 2:return Oie(t,e,n);case 3:return kie(t,e,n);default:return Tie(t,e,n)}}function vie(t,e,n){switch(t.length){case 0:return aR();case 1:return Nie(t,e,n);case 2:return Pie(t,e,n);case 3:return Die(t,e,n);case 4:return Rie(t,e,n);case 5:return _ie(t,e);case 6:return Aie(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function xie(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function bie(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function yie(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function wie(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Cie}
    ${Sie}
    ${Iie}
  `}const Cie=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Sie=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Iie=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$ie=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function aR(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Eie(t,e,n){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return i[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${i[1]}.0);
      }
    `:i[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${i[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);
    }
  `}function Nie(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function kie(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[2]/2),o=s*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function Die(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Up(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const i=Va(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec3(r, c, d);
    }
  `}function Tie(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[t.length-1]/2),o=s*Math.ceil(t[t.length-2]/2);let r=o,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)r*=t[t.length-c-1],a=`
      int b${c} = index / ${r};
      index -= b${c} * ${r};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${t.length}(${l});
    }
  `}function Rie(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Up(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const i=Va(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec4(r, c, d, d2);
    }
  `}function _ie(t,e){const n=Va(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Aie(t,e){const n=Va(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Oie(t,e,n){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Wt(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));
      }
    `;const s=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));

      int index = resTexRC.x * ${i[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function Pie(t,e,n){return Wt(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Wa(t){return`offset${t}`}function Mie(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),i=Ni();return`
    vec4 ${n}() {
      return ${i.texture2D}(${e}, halfCR);
    }
  `}function Fie(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${i}() {return ${n};}`;const[s,o]=t.shapeInfo.texShape;if(s===1&&o===1)return`
      float ${i}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const r=Wa(n);if(e)return`
    float ${i}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${r});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${i}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${r});
      return sampleTexture(${n}, uv);
    }
  `}function Lie(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,o=Ni();if(e)return`
    vec4 ${i}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${n}, uv);
    }
  `;const r=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${i}(int index) {
      vec2 uv = packedUVfrom1D(
        ${r[0]}, ${r[1]}, index);
      return ${o.texture2D}(${n}, uv);
    }
  `}function zie(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${i}(int index) {
        ${rc(t)}
      }
    `;const s=t.shapeInfo.texShape,o=s[0],r=s[1];if(r===1&&o===1)return`
      float ${i}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Wa(n);return r===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${r}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${o}, ${r}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Bie(t,e){const n=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape,r=o[0],a=o[1],l=Ni();if(o!=null&&Wt(n,o))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);

        return ${l.texture2D}(${i}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${r}.0);

        return ${l.texture2D}(${i}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${i}, uv);
    }
  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${i}, uv);
    }
  `}function Vie(t,e){const n=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape;if(o!=null&&Wt(n,o)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `;const f=o[0],h=o[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${h}.0, ${f}.0);
      return sampleTexture(${i}, uv);
    }
  `}const{newShape:r,keptDims:a}=Dr(n),l=r;if(l.length<n.length){const f=ac(t,l),h=["row","col"];return`
      ${oc(f,e)}
      float ${s}(int row, int col) {
        return ${s}(${lc(h,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${rc(t)}
      }
    `;const c=o[0],u=o[1],d=Wa(i);return u===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${i}, uv);
    }
  `:c===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${i}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
        return sampleTexture(${i}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${i}, uv);
  }
`}function Wie(t,e){const n=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape,r=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){const f=n.slice(1),h=[1,2],p=ac(t,f),m=["b","row","col"];return`
        ${rR(p,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${lc(m,h)});
        }
      `}const a=Ni();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `;const l=r[0],c=r[1],u=Math.ceil(n[2]/2),d=u*Math.ceil(n[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `}function Gie(t,e){const n=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[1]*n[2],r=n[2],{newShape:a,keptDims:l}=Dr(n),c=a;if(c.length<n.length){const m=ac(t,c),g=["row","col","depth"];return`
        ${oc(m,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${lc(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${r}, 1)));
        ${rc(t)}
      }
    `;const u=t.shapeInfo.texShape,d=u[0],f=u[1],h=t.shapeInfo.flatOffset;if(f===o&&h==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${i}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${r}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${i}, uv);
        }
      `;if(f===r&&h==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${i}, uv);
    }
  `;const p=Wa(i);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${i}Shape[1] * ${i}Shape[2];
      int stride1 = ${i}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
      return sampleTexture(${i}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${r} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${i}, uv);
      }
  `}function Hie(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),s=Ni();if(e)return`
    vec4 ${i}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${n}, uv);
    }
  `;const o=t.shapeInfo.logicalShape,r=o.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(o[r-1]/2);let f=d*Math.ceil(o[r-2]/2),h="int b, int row, int col",p=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<r-1;m++)h=`int b${m}, `+h,f*=o[r-m-1],p=`b${m} * ${f} + `+p;return`
    vec4 ${i}(${h}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${s.texture2D}(${n}, uv);
    }
  `}function Uie(t,e){const n=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[3],r=n[2]*o,a=n[1]*r,{newShape:l,keptDims:c}=Dr(n);if(l.length<n.length){const x=ac(t,l),b=["row","col","depth","depth2"];return`
      ${oc(x,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${lc(b,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${r}, ${o}, 1)));
        ${rc(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],h=d[1],p=`int stride2 = ${i}Shape[3];`,m=`int stride1 = ${i}Shape[2] * stride2;`,g=`int stride0 = ${i}Shape[1] * stride1;`;if(h===a&&u==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${r}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${i}, uv);
      }
    `;if(h===o&&u==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${i}, uv);
      }
    `;const v=Wa(i);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${v});
      return sampleTexture(${i}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${r} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${h}, index + ${v});
      return sampleTexture(${i}, uv);
    }
  `}function jie(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e[4],o=e[3]*s,r=e[2]*o,a=e[1]*r,{newShape:l,keptDims:c}=Dr(e);if(l.length<e.length){const m=ac(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${oc(m)}
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        return ${i}(${lc(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${r}, ${o}, ${s})) +
          depth3;
        ${rc(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],h=d[1];if(h===a&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${r}, ${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(h===s&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Wa(n);return`
    float ${i}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${r} + depth * ${o} +
          depth2 * ${s} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${h}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Kie(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:s,keptDims:o}=Dr(e);if(s.length<e.length){const g=ac(t,s),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${oc(g)}
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${i}(${lc(v,o)});
      }
    `}const r=e[5],a=e[4]*r,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${r}, 1)));
        ${rc(t)}
      }
    `;const d=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,h=f[0],p=f[1];if(p===u&&d==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${r})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&d==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Wa(n);return`
    float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${r} + depth4 + ${m};
      vec2 uv = uvFromFlat(${h}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function rc(t){const e=t.name,n=pe(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Xie(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),s="get"+i+"AtOutCoords",o=t.shapeInfo.logicalShape.length,r=e.logicalShape.length,a=oR(t.shapeInfo.logicalShape,e.logicalShape),l=qt(r),c=r-o;let u;const d=["x","y","z","w","u","v"];o===0?u="":r<2&&a.length>=1?u="coords = 0;":u=a.map(x=>`coords.${d[x+c]} = 0;`).join(`
`);let f="";r<2&&o>0?f="coords":f=t.shapeInfo.logicalShape.map((x,b)=>`coords.${d[b+c]}`).join(", ");let h="return outputValue;";const m=pe(t.shapeInfo.logicalShape)===1,v=pe(e.logicalShape)===1;if(o===1&&!m&&!v)h=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!v)r===1?h=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:h=`
        return vec4(outputValue.x);
      `;else if(a.length){const x=o-2,b=o-1;a.indexOf(x)>-1&&a.indexOf(b)>-1?h="return vec4(outputValue.x);":a.indexOf(x)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${i}(${f});
      ${h}
    }
  `}function qie(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),s="get"+i+"AtOutCoords",o=e.texShape,r=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&Wt(r,o))return`
      float ${s}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=qt(l),u=oR(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let f;const h=["x","y","z","w","u","v"];a===0?f="":l<2&&u.length>=1?f="coords = 0;":f=u.map(m=>`coords.${h[m+d]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,g)=>`coords.${h[g+d]}`).join(", "),`
    float ${s}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${i}(${p});
    }
  `}function qt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function ty(t,e,n){const{newShape:i,keptDims:s}=Dr(e),o=e.length,r=t&&o===3&&e[0]===1,a=r?e.slice(1):i,l=!t&&o>1&&!Wt(e,n)&&i.length<o||r;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:s}}function ac(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function lc(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(t,e,n,i){const s=n.map((u,d)=>{const f={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(f.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:f}}),o=s.map(u=>u.shapeInfo),r={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},a=pie(s,r,e),l=Gne(t.gl,a),c=t.createProgram(l);return le().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:r,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:r},lR(t,e,c)))}function lR(t,e,n){const i=[],s=[];let o,r,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),le().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const f={name:d,uniform:t.getUniformLocation(n,d,u),offset:t.getUniformLocation(n,`offset${d}`,u)};e.enableShapeUniforms&&(f.shape=t.getUniformLocation(n,`${d}Shape`,u),f.texShape=t.getUniformLocation(n,`${d}TexShape`,u)),i.push(f)}if(e.enableShapeUniforms&&(o=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),r=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)s.push(t.getUniformLocation(n,d.name,u));return{variablesLocations:i,customUniformLocations:s,infLoc:l,nanLoc:c,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:r}}function wS(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,i)=>{const s=n.logicalShape,o=e[i],r=o.shape;if(!Wt(s,r))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${r} must match`);if(n.isUniform&&o.isUniform)return;const a=n.texShape,l=o.isUniform?null:o.texData.texShape;if(!Wt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Jie(t,e,n,i,s){e.program.enableShapeUniforms||(wS(e.inShapeInfos,n),wS([e.outShapeInfo],[i]));const o=i.texData.texture,r=i.texData.texShape;i.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,r[0],r[1]):t.setOutputMatrixTexture(o.texture,r[0],r[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),le().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:u,offset:d,shape:f,texShape:h}=e.variablesLocations[l];if(f){const{uniformShape:p}=ty(e.program.packedInputs,c.shape,c.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(f,new Int32Array(p));break;case 2:t.gl.uniform2iv(f,new Int32Array(p));break;case 3:t.gl.uniform3iv(f,new Int32Array(p));break;case 4:t.gl.uniform4iv(f,new Int32Array(p));break}}if(h&&t.gl.uniform2i(h,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(pe(c.shape)<2)t.gl.uniform1f(u,c.uniformValues[0]);else{let p=c.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(i.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(i.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(i.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(i.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(i.shape));break}if(e.outShapeStridesLocation){const l=Ye(i.shape);switch(i.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),e.program.customUniforms&&s)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=s[l];if(c.type==="float")t.gl.uniform1fv(u,d);else if(c.type==="vec2")t.gl.uniform2fv(u,d);else if(c.type==="vec3")t.gl.uniform3fv(u,d);else if(c.type==="vec4")t.gl.uniform4fv(u,d);else if(c.type==="int")t.gl.uniform1iv(u,d);else if(c.type==="ivec2")t.gl.uniform2iv(u,d);else if(c.type==="ivec3")t.gl.uniform3iv(u,d);else if(c.type==="ivec4")t.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function Zie(t,e,n){let i="";e.concat(n).forEach(r=>{const a=r.texData!=null&&r.texData.slice!=null&&r.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!r.isUniform){const l=r.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=ty(t.packedInputs,r.shape,l);let f="",h="",p="";if(u.length===1&&t.packedInputs){const y=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${y[0]>1}_${y[1]>1}`}else if(u.length===2&&!t.packedInputs)h=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const y=Ye(u);p=`${y[0]===l[1]}_${y[y.length-1]===l[1]}`}const m=r.shape.length,g=u.length===2&&Wt(r.shape,l),v=pe(r.shape)===1,x=Al(r.shape,n.shape),b=!t.packedInputs&&m===n.shape.length&&Wt(l,n.texData.texShape),w=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;i+=`${m}_${b}_${c?d:""}_${u.length}_${v}_${x}_${g}_${f}_${h}_${p}_${w}_${a}`}else{const l=r.isUniform?"uniform":r.texData.texShape;i+=`${r.shape}_${l}_${a}`}});const s=t.userCode;let o=t.constructor.name;return o+="_"+i+"_"+s+`${le().getNumber("WEBGL_VERSION")}`,o}function gi(t){return le().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qie{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Yc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ni();this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Up(["r","c","d"],e):Va(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ese{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Yc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ni();this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Up(["r","c","d"],e):Va(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tse{constructor(e){this.variableNames=["A"],this.outTexUsage=ss.DOWNLOAD;const n=Ni();this.outputShape=e,this.userCode=`
      ${sR}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nse{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ss.DOWNLOAD;const n=Ni();this.outputShape=e,this.userCode=`
      ${sR}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise={R:0,G:1,B:2,A:3};class CS{constructor(e,n=!1,i="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Ni();this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length);let o="result";n&&(o="floor(result * 255. + 0.5)");let r="";for(let a=0;a<i.length;a++){const l=i[a];r+=`
          if(offset == ${a}) {
            result = values[${ise[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?ey():Qb(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${i.length});

        flatIndex = idiv(flatIndex, ${i.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${r}
        }
        ${s.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sse{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=Ni();this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length);let s="",o="result";n&&(o="floor(result * 255. + 0.5)");for(let r=0;r<=1;r++)for(let a=0;a<=1;a++){const l=r*2+a;s+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${r} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${r};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${i.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?ey():Qb(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${i.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ose(t){const e=Ni(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Wne(t,n)}function rse(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Kne(t,e)}function ase(t){const e=new Uint16Array([0,1,2,2,1,3]);return Xne(t,e)}function Cd(t,e,n,i,s,o){Yne(e,n);const r=qne(t),a=t.TEXTURE_2D;return Me(t,()=>t.bindTexture(a,r)),Me(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Me(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Me(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Me(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),le().getNumber("WEBGL_VERSION")===1?Me(t,()=>t.texImage2D(a,0,i,e,n,0,s,o,null)):Me(t,()=>t.texStorage2D(a,1,i,e,n)),Me(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:r,texShape:[n,e]}}function cR(t){return t.internalFormatFloat}function lse(t,e,n,i){const[s,o]=yd(e,n);return Cd(t,s,o,cR(i),i.textureFormatFloat,t.FLOAT)}function uR(t){return t.internalFormatHalfFloat}function cse(t,e,n,i){const[s,o]=yd(e,n);return Cd(t,s,o,uR(i),i.textureFormatFloat,i.textureTypeHalfFloat)}function dR(t){return t.downloadTextureFormat}function use(t,e,n,i){const[s,o]=yd(e,n);return Cd(t,s,o,dR(i),t.RGBA,t.UNSIGNED_BYTE)}function hR(t){return t.internalFormatPackedFloat}function dse(t,e,n,i){const[s,o]=sc(e,n);return Cd(t,s,o,hR(i),t.RGBA,t.FLOAT)}function fR(t){return t.internalFormatPackedHalfFloat}function hse(t,e,n,i){const[s,o]=sc(e,n);return Cd(t,s,o,fR(i),t.RGBA,i.textureTypeHalfFloat)}function fse(t,e,n){return Me(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),xS(t,e,"clipSpacePos",n,3,20,0)&&xS(t,e,"uv",n,2,20,12)}function pse(t,e,n,i,s,o){Me(t,()=>t.bindTexture(t.TEXTURE_2D,e));let r,a,l;s instanceof Uint8Array?(r=new Uint8Array(n*i*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(r=new Float32Array(n*i*4),a=t.FLOAT,l=o.internalFormatPackedFloat),r.set(s),le().getNumber("WEBGL_VERSION")===2?Me(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,i,t.RGBA,a,r)):Me(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,i,0,t.RGBA,a,r)),Me(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function mse(t,e,n){Me(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?le().getNumber("WEBGL_VERSION")===2?Me(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):Me(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):le().getNumber("WEBGL_VERSION")===2?Me(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):Me(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),Me(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function gse(t,e,n,i){const s=t.createBuffer();Me(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,s));const a=4*4*e*n;return Me(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Me(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),Me(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),s}function vse(t,e,n){const i=t,s=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,s),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),s}function xse(t,e,n,i){const[s,o]=yd(e,n),r=4,a=new Uint8Array(Pne(e*n,r));return Me(t,()=>t.readPixels(0,0,s,o,i.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function bse(t,e,n,i,s,o,r,a){const l=t,c=new Float32Array(Mne(o,r));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function yse(t,e,n){const i=new Float32Array(e*n*4);return Me(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,i)),i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fm{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=le().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,_ne(n,e)):this.gl=qs(n),e=this.gl,le().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Me(o,()=>o.createVertexArray()),this.bindVertexArray=r=>Me(o,()=>o.bindVertexArray(r)),this.deleteVertexArray=r=>Me(o,()=>o.deleteVertexArray(r)),this.getVertexArray=()=>Me(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Me(e,()=>o.createVertexArrayOES()),this.bindVertexArray=r=>Me(e,()=>o.bindVertexArrayOES(r)),this.deleteVertexArray=r=>Me(e,()=>o.deleteVertexArrayOES(r)),this.getVertexArray=()=>Me(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let i="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),le().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",r="OES_texture_half_float";if(this.textureFloatExtension=jd(this.gl,o),Ns(this.gl,r))this.textureHalfFloatExtension=jd(this.gl,r);else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),Ns(this.gl,s))this.colorBufferHalfFloatExtension=jd(this.gl,s);else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",Ns(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(Ns(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=rse(this.gl),this.indexBuffer=ase(this.gl),this.framebuffer=Jne(this.gl),this.textureConfig=Zb(this.gl,this.textureHalfFloatExtension)}get debug(){return le().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Me(e,()=>e.finish()),Me(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Me(e,()=>e.deleteFramebuffer(this.framebuffer)),Me(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Me(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Me(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),lse(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),cse(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),use(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),mse(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,i,s){this.throwIfDisposed(),pse(this.gl,e,n,i,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),hse(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),dse(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(bS(this.gl,this.framebuffer),this.outputTexture=null),Me(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,i){return this.downloadMatrixDriver(e,()=>xse(this.gl,n,i,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,i,s,o,r){return bse(this.gl,e,n,i,s,o,r,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return vse(this.gl,e,n)}createBufferFromTexture(e,n,i){this.bindTextureToFrameBuffer(e);const s=gse(this.gl,n,i,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,i;if(le().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,o=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),i=()=>{const r=s.clientWaitSync(o,0,0);return r===s.ALREADY_SIGNALED||r===s.CONDITION_SATISFIED},n=o}else le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),i=()=>this.isQueryAvailable(n,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):i=()=>!0;return{query:n,isFencePassed:i}}downloadMatrixFromPackedTexture(e,n,i){return this.downloadMatrixDriver(e,()=>yse(this.gl,n,i))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=ose(n));const i=Une(n);Me(n,()=>n.attachShader(i,this.vertexShader)),Me(n,()=>n.attachShader(i,e)),jne(n,i);const s=Object.assign(i,{vao:this.createVertexArray()});return this.debug&&Am(n,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;Me(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),fse(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Me(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Am(this.gl,this.program),Me(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,i=!0){return this.throwIfDisposed(),i?Qne(this.gl,e,n):eie(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),Me(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,i){this.throwIfDisposed(),this.throwIfNoProgram(),tie(this.gl,e,n,i)}setOutputMatrixTexture(e,n,i){this.setOutputMatrixTextureDriver(e,i,n)}setOutputPackedMatrixTexture(e,n,i){this.throwIfDisposed();const[s,o]=sc(n,i);this.setOutputMatrixTextureDriver(e,s,o)}setOutputMatrixWriteRegion(e,n,i,s){this.setOutputMatrixWriteRegionDriver(i,e,s,n)}setOutputPackedMatrixWriteRegion(e,n,i,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Am(this.gl,this.program),Kd(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Me(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Me(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=jd(this.gl,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const i=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=i.createQuery();return i.beginQuery(s.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,i=this.getQueryTimerExtensionWebGL2();n.endQuery(i.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await rC(()=>this.disposed||this.isQueryAvailable(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const i=this.gl;return i.getQueryParameter(e,i.QUERY_RESULT)/1e6}else{const i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const i=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=i.getQueryParameter(e,i.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const i=this.getQueryTimerExtensionWebGL1(),s=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=wse(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:i}=this.itemsToPoll[n];i()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let i;"setTimeoutCustom"in le().platform&&(i=le().platform.setTimeoutCustom.bind(le().platform)),rC(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,i)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Om(this.gl,e,this.framebuffer),this.debug&&Kd(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Om(this.gl,this.outputTexture,this.framebuffer),this.debug&&Kd(this.gl)):bS(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const i=n();return this.unbindTextureToFrameBuffer(),i}setOutputMatrixTextureDriver(e,n,i){this.throwIfDisposed();const s=this.gl;Om(s,e,this.framebuffer),this.debug&&Kd(s),this.outputTexture=e,Me(s,()=>s.viewport(0,0,n,i)),Me(s,()=>s.scissor(0,0,n,i))}setOutputMatrixWriteRegionDriver(e,n,i,s){this.throwIfDisposed(),Me(this.gl,()=>this.gl.scissor(e,n,i,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function wse(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Cse,bincountImpl:pR,bincountReduceImpl:Sse,bitwiseAndImpl:Ise,castImpl:$se,ceilImpl:Ese,concatImpl:Nse,equalImpl:kse,expImpl:Dse,expm1Impl:Tse,floorImpl:Rse,gatherNdImpl:_se,gatherV2Impl:Ase,greaterImpl:Ose,greaterEqualImpl:Pse,lessImpl:Mse,lessEqualImpl:Fse,linSpaceImpl:Lse,logImpl:zse,maxImpl:Bse,maximumImpl:Vse,minimumImpl:Wse,multiplyImpl:Gse,negImpl:Hse,notEqualImpl:Use,prodImpl:jse,raggedGatherImpl:Kse,raggedRangeImpl:Xse,raggedTensorToTensorImpl:qse,rangeImpl:Yse,rsqrtImpl:Jse,scatterImpl:Zse,sigmoidImpl:Qse,simpleAbsImpl:mR,sliceImpl:eoe,sparseFillEmptyRowsImpl:toe,sparseReshapeImpl:noe,sparseSegmentReductionImpl:gR,sqrtImpl:ioe,staticRegexReplaceImpl:soe,stridedSliceImpl:ooe,stringNGramsImpl:roe,stringSplitImpl:aoe,stringToHashBucketFastImpl:loe,subImpl:coe,tileImpl:uoe,topKImpl:doe,transposeImpl:ny,uniqueImpl:hoe}=mJ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vR(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function wi(t,e){return e===1?[t]:vR(t,e)}function foe(t,e){if(t===1)return"rc";let n="";for(let i=0;i<t;i++)n+=e[i],i<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class poe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=gi(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=wi("rc",this.rank),i=qt(this.rank),s=this.getOutOfBoundsCondition(n),o=this.getSetup(n),r=this.getOutput(n);this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${r}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){let o=`${i===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let r=2;r<this.rank;r++)o=`${e[e.length-1-r]},`+o;n.push(o)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let i=this.rank-2;i<this.rank;i++)n+=`${e[i]} >= ${this.enableShapeUniforms?`outShape[${i}]`:this.outputShape[i]}`,i<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),i=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${i};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xR{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length);let i="";for(let s=0;s<4;s++){let o="thisRC = rc;";s%2===1&&(o+="thisRC.z += 1;"),s>1&&(o+="thisRC.y += 1;"),i+=`
        ${o}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${moe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?ey():Qb(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${i}

        setOutput(result);
      }
    `}}function moe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?fie(["r","c","d"],"inputShape"):Va(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class goe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,i){const s=IS(n,i),o=$S(e,s,i);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const r=SS(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,i);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=r,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return s===ei.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===ei.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===ei.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===ei.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===ei.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=r,this.log(),a}releaseTexture(e,n,i,s){if(this.freeTextures==null)return;const o=IS(i,s),r=$S(n,o,s);r in this.freeTextures||(this.freeTextures[r]=[]);const a=SS(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,s),l=le().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[r].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[r],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function voe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function SS(t,e,n,i,s){const o=xoe(e,i);let r;if(s){const[l,c]=sc(t[0],t[1]);r=l*c}else{const[l,c]=yd(t[0],t[1]);r=l*c}const a=voe(n,o);return r*a}function xoe(t,e){switch(t){case ei.PACKED_2X2_FLOAT32:return hR(e);case ei.PACKED_2X2_FLOAT16:return fR(e);case ei.UNPACKED_FLOAT32:return cR(e);case ei.UNPACKED_FLOAT16:return uR(e);case ei.PACKED_4X1_UNSIGNED_BYTE:return dR(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function boe(t){return le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?ei.PACKED_2X2_FLOAT32:ei.UNPACKED_FLOAT32:t?ei.PACKED_2X2_FLOAT16:ei.UNPACKED_FLOAT16}function IS(t,e){if(t===ss.UPLOAD)return ei.PACKED_2X2_FLOAT32;if(t===ss.RENDER||t==null)return boe(e);if(t===ss.DOWNLOAD||t===ss.PIXELS)return ei.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function $S(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uo{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Ps="if (isnan(x)) return x;",yoe="return x;",ES="return abs(x);",woe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Coe=Ps+`
  return (x < 0.0) ? 0.0 : x;
`,Soe=Ps+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ar="return x;",Ioe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $oe="return x;",Eoe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Noe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,koe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Doe="return 1.0 / (1.0 + exp(-1.0 * x));";class hr{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Toe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length);const n=e.length,i=wi("rc",n),s=qt(n),o=foe(n,i),r=i.slice(-2),a=n<=1?"rc":`vec2(${r.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Roe=B2,_oe=1e-7,Aoe=1e-4,Yd={};function Ooe(t){return t in Yd||(Yd[t]={}),Yd[t]}const Poe=le().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Moe=600;function Foe(){return le().global.screen==null?1024:le().global.screen.height*le().global.screen.width*window.devicePixelRatio*Moe/1024/1024}class jp extends mx{nextDataId(){return jp.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!le().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof Fm)n=e;else{const i=qs(le().getNumber("WEBGL_VERSION"),e);n=new Fm(i)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const i=qs(le().getNumber("WEBGL_VERSION"));n=new Fm(i),this.binaryCache=Ooe(le().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new goe(this.gpgpu),this.numMBBeforeWarning=Foe(),this.texData=new rE(this,so())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,i,s,o,r){const a=this.makeTensorInfo(n,i),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[s,o]},l.texShape=[s,o];const c=Xd(n),u=new CS(c,!1,r),d=this.runWebGLProgram(u,[a],i,[[s,o]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,i){if((le().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||le().getBool("DEBUG"))&&this.checkNumericalProblems(e),i==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:n,dtype:i,values:e,usage:ss.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,i,s,o){if(le().getBool("DEBUG")&&this.checkNumericalProblems(n),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:s,values:n,usage:ss.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:i,dtype:s,complexTensorInfos:o,slice:r,shape:a,isPacked:l}=n;if(r!=null){let f;l?f=new hr(a,ar):f=new uo(a,ar);const h=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:s}],s),p=this.readSync(h.dataId);return this.disposeIntermediateTensorInfo(h),p}if(i!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return i;const c=this.activeTimers!=null;let u;c&&(u=Ri());let d;if(s==="complex64"){const f=this.readSync(o.real.dataId),h=this.readSync(o.imag.dataId);d=Xo(f,h)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Ri()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:i,shape:s,slice:o,dtype:r,complexTensorInfos:a,isPacked:l}=n;if(o!=null){let p;l?p=new hr(s,ar):p=new uo(s,ar);const m=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:r}],r),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(i!=null)return this.convertAndCacheOnCPU(e);if(le().getBool("DEBUG")&&!le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&le().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(r!=="complex64"&&le().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const p=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(p.texture.texture,...Ud(s))}this.pendingRead.set(e,[]),r!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(r==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];d=Xo(m,g)}else if(c==null)d=this.getValuesFromTexture(e);else{const p=pe(s);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const p=this.gpgpu.gl;Me(p,()=>p.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,d),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(p=>p(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&so().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,n={}){const i=this.texData.get(e),{values:s,shape:o,slice:r,dtype:a,isPacked:l,texture:c}=i;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(r!=null){let h;l?h=new hr(o,ar):h=new uo(o,ar);const p=this.runWebGLProgram(h,[{dataId:e,shape:o,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(c==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),d=so().makeTensorFromTensorInfo(u),f=this.texData.get(u.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const i=n.map(s=>Cr(s));return Ct(e.shape,e.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ct(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const i=e[n];if(!Bne(i))throw le().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${i} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${i} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:i,isPacked:s}=this.texData.get(e),o=pe(n);if(le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),h=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(h.texture.texture,...Ud(n)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),p}const r=le().getBool("WEBGL_PACK")&&s===!0,a=r?Xd(n):n,l=r?new nse(a):new tse(a),c=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,i=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=i,s=!0):this.activeTimers.push(i),this.activeTimers=i,e();const o=pa(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),r=pa(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,s&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=aH(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:r[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ri(),endMs:null}}endTimer(e){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ri(),e)}async getQueryTime(e){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:i}=this.texData.get(e);return i!=null&&(this.disposeData(i.real.dataId,n),this.disposeData(i.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:i,texShape:s,usage:o,isPacked:r,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(s,i),this.textureManager.releaseTexture(n,s,o,r)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=Poe){return le().getBool("WEBGL_CPU_FORWARD")&&e.every(i=>this.texData.get(i.dataId).texture==null&&pe(i.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){ns("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return Roe(e.shape,n)}packedUnaryOp(e,n,i){const s=new hr(e.shape,n),o=this.compileAndRun(s,[e],i);return so().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=mR(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ES,e.dtype);const n=new uo(e.shape,ES),i=this.compileAndRun(n,[e]);return so().makeTensorFromTensorInfo(i)}makeTensorInfo(e,n,i){let s;if(n==="string"&&i!=null&&i.length>0&&au(i[0])){const o=i.map(r=>mr(r));s=this.write(o,e,n)}else s=this.write(i,e,n);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:n}}makeOutput(e,n,i){return so().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,i),this)}unpackTensor(e){const n=new Toe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new poe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const i=[Bl(e.shape),...Vl(e.shape)],s={dtype:e.dtype,shape:i,dataId:e.dataId},o=[Bl(n),...Vl(n)],r=new xR(o,i),a=!0,l=[i],c=this.runWebGLProgram(r,[s],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const i=this.texData.get(e),{isPacked:s,shape:o,dtype:r}=i;if(n!=null){const f=pe(o),h=n[0]*n[1]*4;F(f<=h,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Xd(o);let l;s?l=new ese(a):l=new Qie(a);const c=!0,u=[n??Ud(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],r,u,c,n);return{dtype:r,shape:o,dataId:d.dataId}}runWebGLProgram(e,n,i,s,o=!1,r){const a=this.makeTensorInfo(e.outputShape,i),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Yc.DENSE){const v=r??Ud(e.outputShape);l.texShape=v.map(x=>x*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),pe(a.shape)===0)return l.values=di(a.dtype,0),a;const c=[],u=n.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let x=this.texData.get(v.dataId);if(x.texture==null){if(!e.packedInputs&&pe(v.shape)<=le().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!x.isPacked!=!!e.packedInputs)v=x.isPacked?this.unpackTensor(v):this.packTensor(v),c.push(v),x=this.texData.get(v.dataId);else if(x.isPacked&&!Jh(x.shape,v.shape)){const b=v,w=v.shape;v.shape=x.shape,v=this.packedReshape(v,w),c.push(v),x=this.texData.get(v.dataId),b.shape=w}return{shape:v.shape,texData:x,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},f=Zie(e,u,d),h=this.getAndSaveBinary(f,()=>Yie(this.gpgpu,e,u,d)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),le().get("ENGINE_COMPILE_ONLY")||Jie(this.gpgpu,h,u,d,s),c.forEach(v=>this.disposeIntermediateTensorInfo(v)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=le().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const v=Ri();v-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!le().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const v=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),v}return a}compileAndRun(e,n,i,s,o=!1){return i=i||n[0].dtype,this.runWebGLProgram(e,n,i,s,o)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(le().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ie(()=>{if(!le().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=le().getBool("DEBUG");le().set("DEBUG",!1);const n=this.abs(Vt(1e-8)).dataSync()[0];if(le().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?_oe:Aoe}uploadToGPU(e){const n=this.texData.get(e),{shape:i,dtype:s,values:o,texture:r,usage:a,isPacked:l}=n;if(r!=null)return;const c=this.activeTimers!=null;let u;c&&(u=Ri());let d=n.texShape;if(d==null&&(d=sie(i,l),n.texShape=d),o!=null){const f=Xd(i);let h,p=d[1],m=d[0];const g=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!g)&&([p,m]=sc(d[0],d[1])),l?h=new sse(f,g):h=new CS(f,g);const v=g?[m,p]:d,x=this.makeTensorInfo(v,s),b=this.texData.get(x.dataId);g?b.usage=ss.PIXELS:b.usage=ss.UPLOAD,b.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),p,m,o);const w=[[m,p]],C=this.runWebGLProgram(h,[x],s,w,!0),I=this.texData.get(C.dataId);n.texShape=I.texShape,n.isPacked=I.isPacked,n.usage=I.usage,le().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=I.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(x),c&&(this.uploadWaitMs+=Ri()-u)}else{const f=this.acquireTexture(d,a,s,l);n.texture=f}}convertAndCacheOnCPU(e,n){const i=this.texData.get(e),{dtype:s}=i;return n!=null&&(i.values=Loe(n,s)),i.values}acquireTexture(e,n,i,s){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,s)}computeBytes(e,n){return e[0]*e[1]*Ih(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const i=new Promise(s=>{try{this.checkCompletion_(n),s(!0)}catch(o){throw o}});e.push(i)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await oN(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(iR(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:i,infLoc:s,nanLoc:o,outShapeLocation:r,outShapeStridesLocation:a,outTexShapeLocation:l}=lR(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=i,e.infLoc=s,e.nanLoc=o,e.outShapeLocation=r,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,i){e.channels=e.channels||"RGBA";const{texture:s,height:o,width:r,channels:a}=e,l=so().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(s,n,i,o,r,a);return so().makeTensorFromDataId(c,n,i,l)}}jp.nextDataId=0;function Loe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let i=0;i<n.length;++i)n[i]=Math.round(t[i]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */QE()&&n2("webgl",()=>new jp,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iy=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Na{constructor(e,n,i){this.variableNames=["A","B"],this.outputShape=mt(n,i),this.enableShapeUniforms=gi(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ga=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class cc{constructor(e,n,i,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=mt(n,i);const o=this.outputShape.length;this.enableShapeUniforms=gi(o);let r="";if(s)if(o===0||pe(this.outputShape)===1)r=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(r=`
          ${qt(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?r+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:r+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=wi("coords",o);this.enableShapeUniforms?r+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:r+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${r}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ji(t){const{inputs:e,backend:n}=t,{x:i}=e;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const zoe={kernelName:ku,backendName:"webgl",kernelFunc:Ji};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zr(t){const{inputs:e,backend:n}=t,{real:i,imag:s}=e,o=n.makeTensorInfo(i.shape,"complex64"),r=n.texData.get(o.dataId),a=Ji({inputs:{x:i},backend:n}),l=Ji({inputs:{x:s},backend:n});return r.complexTensorInfos={real:a,imag:l},o}const Boe={kernelName:kx,backendName:"webgl",kernelFunc:zr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bR="return (a < 0.) ? b * a : a;",yR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Voe(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{alpha:o}=i,r=n.makeTensorInfo([],"float32",Tr(o,"float32")),a=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cc(yR,s.shape,r.shape):new Na(bR,s.shape,r.shape),l=n.runWebGLProgram(a,[s,r],"float32");return n.disposeIntermediateTensorInfo(r),l}const Woe={kernelName:Bf,backendName:"webgl",kernelFunc:Voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wR="return (a < 0.) ? b * a : a;",CR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Goe(t){const{inputs:e,backend:n}=t,{x:i,alpha:s}=e,o=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cc(CR,i.shape,s.shape):new Na(wR,i.shape,s.shape);return n.runWebGLProgram(o,[i,s],"float32")}const Hoe={kernelName:op,backendName:"webgl",kernelFunc:Goe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uc="if (isnan(x)) return x;";function Ot({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:i}){return({inputs:s,backend:o})=>{const{x:r}=s,a=o,l=i||r.dtype;if(a.shouldExecuteOnCPU([r])&&n!=null){const d=a.texData.get(r.dataId),f=n(d.values,l);return a.makeTensorInfo(r.shape,l,f)}const c=le().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new hr(r.shape,e):u=new uo(r.shape,t),a.runWebGLProgram(u,[r],l)}}function si({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:s,dtype:o}){return({inputs:r,backend:a})=>{const{a:l,b:c}=r,u=a;if(i&&l.dtype==="complex64"){const p=u.texData.get(l.dataId),m=u.texData.get(c.dataId),[g,v]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{const[w,y]=b,C={dataId:w.dataId,dtype:w.dtype,shape:l.shape},I={dataId:y.dataId,dtype:y.dtype,shape:c.shape},$=new Na(t,l.shape,c.shape);return u.runWebGLProgram($,[C,I],qi(w.dtype,y.dtype))}),x=zr({inputs:{real:g,imag:v},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(v),x}const d=o||qi(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&s!=null){const p=u.texData.get(l.dataId).values,m=u.texData.get(c.dataId).values,g=l.dtype==="string"?qo(p):p,v=l.dtype==="string"?qo(m):m,[x,b]=s(l.shape,c.shape,g,v,d),w=u.makeTensorInfo(b,d),y=u.texData.get(w.dataId);return y.values=x,w}const f=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let h;return f?h=new cc(e,l.shape,c.shape,n):h=new Na(t,l.shape,c.shape),u.runWebGLProgram(h,[l,c],d)}}function Jc(t,e=!1){if(t==="linear")return e?$oe:yoe;if(t==="relu")return e?Noe:Coe;if(t==="elu")return e?Eoe:woe;if(t==="relu6")return e?koe:Soe;if(t==="prelu")return e?CR:wR;if(t==="leakyrelu")return e?yR:bR;if(t==="sigmoid")return e?Doe:Ioe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SR{constructor(e,n,i,s=!1,o=!1,r=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i,this.enableShapeUniforms=gi(this.outputShape.length);const u=s?e[1]:e[2],d=Math.ceil(u/2),f=s?"i * 2, rc.y":"rc.y, i * 2",h=o?"rc.z, i * 2":"i * 2, rc.z",p=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",v="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,v="result = activation(result);");const x=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";e[0]<n[0]?b=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(w=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${w};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${h});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${v}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class kS{constructor(e,n,i){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=mt(n,i),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DS="return a * b;";function sy(t){const{inputs:e,backend:n}=t,{a:i,b:s}=e,o=qi(i.dtype,s.dtype);if(i.dtype==="complex64"){const a=n.texData.get(i.dataId),l=n.texData.get(s.dataId),c=new kS(NS.REAL,i.shape,s.shape),u=new kS(NS.IMAG,i.shape,s.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:i.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],f=n.runWebGLProgram(c,d,"float32"),h=n.runWebGLProgram(u,d,"float32"),p=zr({inputs:{real:f,imag:h},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),p}if(n.shouldExecuteOnCPU([i,s])){const a=n.texData.get(i.dataId),l=n.texData.get(s.dataId),[c,u]=Gse(i.shape,s.shape,a.values,l.values,o),d=n.makeTensorInfo(u,o),f=n.texData.get(d.dataId);return f.values=c,d}let r;return le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?r=new cc(DS,i.shape,s.shape):r=new Na(DS,i.shape,s.shape),n.runWebGLProgram(r,[i,s],o)}const Uoe={kernelName:Fu,backendName:"webgl",kernelFunc:sy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(t,e,n){const i=[Bl(t.shape),...Vl(t.shape)],s={dtype:t.dtype,shape:i,dataId:t.dataId},o=[Bl(e),...Vl(e)],r=new xR(o,i),a=!0,l=[i],c=n.runWebGLProgram(r,[s],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{shape:o}=i,r=n,a=pe(s.shape),l=lE(o,a),c=pe(l);F(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=r.texData.get(s.dataId);return u.isPacked&&!Jh(s.shape,l)&&!(u.texture!==null&&Jh(u.shape,l))?joe(s,l,r):(r.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype})}const Koe={kernelName:ap,backendName:"webgl",kernelFunc:Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TS{constructor(e,n){this.variableNames=["x"];const{windowSize:i,batchSize:s,inSize:o,outSize:r}=e;this.outputShape=[s,r];const a=Math.floor(i/4)*4,l=i%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${Dl(d)?d.toPrecision(2):d}, ones);`}let u="";o%i>0&&(u=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xoe{constructor(e,n){this.variableNames=["x"];const{windowSize:i,batchSize:s,inSize:o,outSize:r}=e;this.outputShape=[s,r];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(i/4)*4,d=i%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,h="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");let p="";o%i>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],i=Tp(n);e.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return e}function Ha(t,e,n,i){const s=qoe(t.shape);let o=t;for(let r=0;r<s.length;r++){const{inSize:a,windowSize:l,outSize:c}=s[r];let u,d;n==="mean"?u=r===0?new TS({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new TS({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new Xoe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=o,o=i.runWebGLProgram(u,[o],e),d.dataId!==t.dataId&&i.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yoe{constructor(e,n){this.variableNames=["A"];const i=new Array(e.length);for(let r=0;r<i.length;r++)i[r]=e[n[r]];this.outputShape=i,this.rank=i.length;const s=qt(this.rank),o=Joe(n);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function Joe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(e);for(let s=0;s<t.length;s++)i[t[s]]=n[s];return i.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zoe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const i=new Array(e.length);for(let u=0;u<i.length;u++)i[u]=e[n[u]];if(this.outputShape=i,this.rank=i.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=qt(this.rank),o=vR("rc",this.rank),r=new Array(this.rank);for(let u=0;u<n.length;u++)r[n[u]]=o[u];const a=`vec2(${r.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${i[this.rank-1]}`,c=`getChannel(getA(${r.join()}), ${a})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${i[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kp(t,e,n){const i=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zoe(t.shape,e):new Yoe(t.shape,e);return n.runWebGLProgram(i,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qoe(t,e,n,i){const s=e,o=t.shape.length,r=St(s,t.shape);let a=r;const l=mn(a,o),c=l!=null;let u=t;c&&(u=Kp(t,l,i),a=Nn(a.length,o)),ii("sum",a,o);const[d,f]=Yn(u.shape,a);let h=d;n&&(h=Rn(d,r));const p=pe(f),g=pe(t.shape)/p,v=Te({inputs:{x:u},attrs:{shape:[g,p]},backend:i}),x=c0(t.dtype),b=Ha(v,x,"sum",i),w=Te({inputs:{x:b},attrs:{shape:h},backend:i});return i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(b),c&&i.disposeIntermediateTensorInfo(u),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xp(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i;return Qoe(s,o,r,n)}const ere={kernelName:fp,backendName:"webgl",kernelFunc:Xp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $i(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{perm:o}=i,r=n,a=s.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=s.shape[o[u]];let c;if(r.shouldExecuteOnCPU([s])){const d=r.texData.get(s.dataId).values,f=ny(d,s.shape,s.dtype,o,l);c=r.makeTensorInfo(l,s.dtype);const h=r.texData.get(c.dataId);h.values=f}else c=Kp(s,o,r);return c}const tre={kernelName:cl,backendName:"webgl",kernelFunc:$i};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IR=1e3;function Zh({a:t,b:e,transposeA:n,transposeB:i,backend:s,bias:o=null,preluActivationWeights:r=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],f=i?e.shape[u-1]:e.shape[u-2],h=n?t.shape[c-1]:t.shape[c-2],p=i?e.shape[u-2]:e.shape[u-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),v=pe(m),x=pe(g),w=mt(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([h,p]);F(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${i} must match.`);const y=n?[v,d,h]:[v,h,d],C=i?[x,p,f]:[x,f,p],I=Te({inputs:{x:t},backend:s,attrs:{shape:y}}),$=Te({inputs:{x:e},backend:s,attrs:{shape:C}}),E=[I,$],N=Math.max(v,x),k=n?I.shape[1]:I.shape[2],D=o!=null,_=r!=null,R=l==="leakyrelu",T=l!=null?Jc(l,!0):null,A=D||_||R||T!=null;let O;if((h===1||p===1)&&k>IR&&A===!1){let M=I,z=$;n&&(M=$i({inputs:{x:I},backend:s,attrs:{perm:[0,2,1]}}),E.push(M)),i&&(z=$i({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),E.push(z));const L=p!==1,W=p===1;let B=M;L&&(B=Te({inputs:{x:M},backend:s,attrs:{shape:[N,k,1]}}),E.push(B));const q=p===1?2:1;let H=z;W&&(H=Te({inputs:{x:z},backend:s,attrs:{shape:[N,1,k]}}),E.push(H));const ne=sy({inputs:{a:B,b:H},backend:s});O=Xp({inputs:{x:ne},backend:s,attrs:{axis:q,keepDims:!0}}),E.push(ne)}else{const M=qi(t.dtype,e.dtype),z=new SR(y,C,[N,h,p],n,i,D,T,_,R),L=[I,$];if(o!=null&&L.push(o),_&&L.push(r),R){const W=s.makeTensorInfo([],"float32",Tr(a,"float32"));L.push(W),E.push(W)}O=s.runWebGLProgram(z,L,M)}const P=Te({inputs:{x:O},backend:s,attrs:{shape:w}});E.push(O);for(const M of E)s.disposeIntermediateTensorInfo(M);return P}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nre(t){const{inputs:e,backend:n,attrs:i}=t,{a:s,b:o,bias:r,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=i;return Zh({a:s,b:o,transposeA:l,transposeB:c,backend:n,bias:r,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const ire={kernelName:$h,backendName:"webgl",kernelFunc:nre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RS="return abs(x);";function sre(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])&&i.dtype!=="complex64"){const o=n.texData.get(i.dataId),r=mR(o.values);return n.makeTensorInfo(i.shape,i.dtype,r)}let s;return le().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new hr(i.shape,RS):s=new uo(i.shape,RS),n.runWebGLProgram(s,[i],i.dtype)}const ore={kernelName:yf,backendName:"webgl",kernelFunc:sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rre=Ps+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,are=Ot({opSnippet:rre}),lre={kernelName:lu,backendName:"webgl",kernelFunc:are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cre=Ps+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,ure=Ot({opSnippet:cre}),dre={kernelName:cu,backendName:"webgl",kernelFunc:ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _S="return a + b;",hre=si({opSnippet:_S,packedOpSnippet:_S,supportsComplex:!0,cpuKernelImpl:Cse}),fre={kernelName:Zl,backendName:"webgl",kernelFunc:hre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pre{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((o,r)=>`T${r}`);const i=[];this.variableNames.forEach(o=>{i.push(`float v${o} = get${o}AtOutCoords();`)});const s=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mre{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((o,r)=>`T${r}`);const i=[];this.variableNames.forEach(o=>{i.push(`vec4 v${o} = get${o}AtOutCoords();`)});const s=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ch(t){const{inputs:e,backend:n}=t,i=e;if(i.length===1)return Ji({inputs:{x:i[0]},backend:n});if(i.length>le().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(i.length/2),c=ch({inputs:i.slice(0,l),backend:n}),u=ch({inputs:i.slice(l),backend:n});return ch({inputs:[c,u],backend:n})}const s=i.map(l=>l.dtype).reduce((l,c)=>qi(l,c)),o=i.map(l=>l.shape),a=le().getBool("WEBGL_PACK")?new mre(i[0].shape,o):new pre(i[0].shape,o);return n.runWebGLProgram(a,i,s)}const gre={kernelName:wx,backendName:"webgl",kernelFunc:ch};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vre(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i,a=s.shape.length,l=St(o,s.shape);let c=l;const u=mn(c,a);let d=s;u!=null&&(d=$i({inputs:{x:s},backend:n,attrs:{perm:u}}),c=Nn(c.length,a)),ii("all",c,a);const[f,h]=Yn(d.shape,c),p=pe(h),m=Te({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=Ha(m,m.dtype,"all",n);let v;if(r){const x=Rn(f,l);v=Te({inputs:{x:g},backend:n,attrs:{shape:x}})}else v=Te({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),v}const xre={kernelName:Cx,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bre(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i,a=s.shape.length,l=St(o,s.shape);let c=l;const u=mn(c,a);let d=s;u!=null&&(d=$i({inputs:{x:s},backend:n,attrs:{perm:u}}),c=Nn(c.length,a)),ii("any",c,a);const[f,h]=Yn(d.shape,c),p=pe(h),m=Te({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=Ha(m,m.dtype,"any",n);let v;if(r){const x=Rn(f,l);v=Te({inputs:{x:g},backend:n,attrs:{shape:x}})}else v=Te({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),v}const yre={kernelName:Sx,backendName:"webgl",kernelFunc:bre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wre{constructor(e,n,i){this.variableNames=["A"];const{windowSize:s,batchSize:o,outSize:r}=e;i||this.variableNames.push("bestIndicesA"),this.outputShape=[o,r];const a=n==="max"?">":"<",l=i?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cre{constructor(e,n,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,F(e.length>2,()=>`Packed arg${i.charAt(0).toUpperCase()+i.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],r=Math.ceil(o/n);this.outputShape=e.slice(0,-1),r>1&&this.outputShape.push(r),s||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=qt(l),u=wi("coords",l);let d,f;if(r===1){f=l+1;const $=qt(f);d=`
        ${$} sourceLocR = ${$}(${u.join()}, 0);
        ++${u[l-1]};
        ${$} sourceLocG = ${$}(${u.join()}, 0);
        ++${u[l-2]};
        ${$} sourceLocA = ${$}(${u.join()}, 0);
        --${u[l-1]};
        ${$} sourceLocB = ${$}(${u.join()}, 0);
        --${u[l-2]};`}else f=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const h=["x","y","z","w","u","v"].slice(0,f),p="."+h[f-1],m=h.map($=>"int "+$),g=wi("sourceLocR",f-1).concat("inIdx.r"),v=wi("sourceLocG",f-1).concat("inIdx.g"),x=wi("sourceLocB",f-1).concat("inIdx.b"),b=wi("sourceLocA",f-1).concat("inIdx.a"),w=i==="max"?"greaterThan":"lessThan",y=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,I=s?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${h.join()}),
                                          vec2(${h.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${h.join()}),
                               vec2(${h.slice(-2).join()}));
      }
      ${I}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${y}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(t,e,n,i=null){let s=e.shape[0],o=e.shape[1];i!=null&&(s=i.shape[0],o=i.shape[1]);const r=Tp(o),a={windowSize:r,inSize:o,batchSize:s,outSize:Math.ceil(o/r)},l=new wre(a,n,i==null),c=[e];i!=null&&c.push(i);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=$R(t,e,n,u);return t.disposeIntermediateTensorInfo(u),d}function ER(t,e,n,i=null){const s=i!=null?i.shape:e.shape,o=s[s.length-1],r=Tp(o),a=new Cre(s,r,n,i==null),l=i==null?[e]:[e,i],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=ER(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function NR(t,e,n,i){const s=[n];if(ii("arg"+i.charAt(0).toUpperCase()+i.slice(1),s,e.shape.length),!le().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],r=t.texData.get(e.dataId),a=r!==null&&r.isPacked;let l=e;a&&(l=t.unpackTensor(e),o.push(l));const[c,u]=Yn(l.shape,s),d=pe(u),f=Te({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});o.push(f);const h=$R(t,f,i);o.push(h);const p=Te({inputs:{x:h},backend:t,attrs:{shape:c}});return o.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return ER(t,e,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o}=i;let r=St(o,s.shape);const a=mn(r,s.shape.length);let l=s;const c=[];a!=null&&(l=$i({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(l),r=Nn(r.length,l.shape.length)),ii("argMax",[r[0]],l.shape.length);const u=NR(n,l,r[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const Ire={kernelName:wf,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $re(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o}=i;let r=St(o,s.shape);const a=mn(r,s.shape.length);let l=s;const c=[];a!=null&&(l=$i({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(l),r=Nn(r.length,l.shape.length)),ii("argMin",[r[0]],l.shape.length);const u=NR(n,l,r[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const Ere={kernelName:Cf,backendName:"webgl",kernelFunc:$re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nre=Ps+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,kre=Ot({opSnippet:Nre}),Dre={kernelName:uu,backendName:"webgl",kernelFunc:kre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tre=Ps+"return log(x + sqrt(x * x + 1.0));",Rre=Ot({opSnippet:Tre}),_re={kernelName:du,backendName:"webgl",kernelFunc:Rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Are=Ps+`
  return atan(x);
`,Ore=Ot({opSnippet:Are}),Pre={kernelName:hu,backendName:"webgl",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mre=iy+`
  return atan(a, b);
`,Fre=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ga+`
  return result;
`,Lre=si({opSnippet:Mre,packedOpSnippet:Fre}),zre={kernelName:pu,backendName:"webgl",kernelFunc:Lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bre=Ps+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Vre=Ot({opSnippet:Bre}),Wre={kernelName:fu,backendName:"webgl",kernelFunc:Vre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zc{constructor(e,n,i,s=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const r=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,v=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let x="0.0";if(m||(x="-1.0 / 1e-20"),i){const $=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${h}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${$} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?o?g:v:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let w=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(w="avgValue / max(count, 1.0)");const y=Math.floor(r/4)*4,C=r%4,I=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${h}, ${p});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${y}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${I}
          }

          int xC = xCCorner + ${y};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${I}
          }
        }
        setOutput(${w});
      }
    `}}class oy{constructor(e,n,i,s=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const r=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,v=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg";let w="0.0";if(b||(w="-1.0 / 1e-20"),i){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${v}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${h};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const y="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const I=Math.floor(r/4)*4,$=r%4,E=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${y}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${v}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${I}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${E}
            }

            int xC = xCCorner + ${I};
            if (${$===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${$===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${$===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${E}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e;wd(s,"avgPool");const{filterSize:o,strides:r,pad:a,dimRoundingMode:l}=i,c=1;F(pi(r,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const u=As(s.shape,o,r,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Wt(u.inShape,u.outShape))return Ji({inputs:{x:s},backend:n});const d=new Zc(u,"avg",!1);return n.runWebGLProgram(d,[s],"float32")}const Hre={kernelName:Sf,backendName:"webgl",kernelFunc:Gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{filterSize:o,strides:r,pad:a,dimRoundingMode:l,dataFormat:c}=i,u=[1,1,1],d=er(s.shape,o,r,u,a,l,c),f=new oy(d,"avg",!1);return n.runWebGLProgram(f,[s],"float32")}const jre={kernelName:If,backendName:"webgl",kernelFunc:Ure};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kre{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,s=e.strideHeight,o=e.strideWidth,r=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,f=1/(n*i);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Xre{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,i=e.filterHeight,s=e.filterWidth,o=e.strideDepth,r=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=f-1-e.padInfo.top,g=h-1-e.padInfo.left,v=1/(n*i*s);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qre(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o}=e,r=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,d=[1,1,1],f=er(r.shape,a,l,d,c,u),h=new Xre(f);return n.runWebGLProgram(h,[s],r.dtype)}const Yre={kernelName:$x,backendName:"webgl",kernelFunc:qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jre(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o}=e,r=o;wd([s,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=i,u=As(r.shape,a,l,1,c),d=new Kre(u);return n.runWebGLProgram(d,[s],r.dtype)}const Zre={kernelName:Ix,backendName:"webgl",kernelFunc:Jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qre(t){const{inputs:e,backend:n,attrs:i}=t,{a:s,b:o}=e,{transposeA:r,transposeB:a}=i;return Zh({a:s,b:o,transposeA:r,transposeB:a,backend:n})}const eae={kernelName:$f,backendName:"webgl",kernelFunc:Qre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tae{constructor(e,n,i,s,o,r){this.outputShape=[],this.variableNames=["x","mean","variance"],mt(e,n),mt(e,i);let a="0.0";s!=null&&(mt(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(mt(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${r}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nae{constructor(e,n,i,s,o,r){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],mt(e,n),mt(e,i);let a="vec4(0.0)";s!=null&&(mt(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(mt(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${r}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iae=({inputs:t,backend:e,attrs:n})=>{const{x:i,mean:s,variance:o,offset:r,scale:a}=t;F(s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(r==null||s.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[i,s,o];let u=null;r!=null&&(u=r.shape,c.push(r));let d=null;a!=null&&(d=a.shape,c.push(a));const f=le().getBool("WEBGL_PACK_NORMALIZATION")?new nae(i.shape,s.shape,o.shape,u,d,l):new tae(i.shape,s.shape,o.shape,u,d,l);return e.runWebGLProgram(f,c,c[0].dtype)},sae={kernelName:Ff,backendName:"webgl",kernelFunc:iae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oae{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=qt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const i=rae(this.rank);let s;const o=e.map((r,a)=>`sourceLoc.${Qg[a]} = start[${a}] + coords.${Qg[a]};`);s=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${i}));
      }
    `}}const Qg=["x","y","z","w","u","v"];function rae(t){if(t===1)return"sourceLoc";if(t<=6)return Qg.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aae{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=qt(this.rank),i=wi("coords",this.rank),s=wi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,r=`getChannel(getSource(${s.join()}), ${o})`,a=`
      result.x = ${r};
      if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${r};
        --${s[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${i[this.rank-1]};
      if (++${i[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${r};
        if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${r};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${s[d]} = ${i[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t,e,n,i){const s=i.texData.get(t.dataId),o=i.makeTensorInfo(n,t.dtype),r=i.texData.get(o.dataId);Object.assign(r,s),r.refCount=1,r.shape=n,r.dtype=t.dtype;let a=Q0(e,Ye(t.shape));s.slice&&(a+=s.slice.flatOffset),r.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||t.dataId};const l=i.dataRefCount.get(r.slice.origDataId)||1;return i.dataRefCount.set(r.slice.origDataId,l+1),o}function dc(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{begin:o,size:r}=i,[a,l]=Dp(s,o,r);if(Y0(s,a,l),pe(l)===0)return n.makeTensorInfo(l,s.dtype,[]);if(n.shouldExecuteOnCPU([s])||s.dtype==="string"){const d=n.texData.get(s.dataId),f=eoe(d.values,a,l,s.shape,s.dtype);return n.makeTensorInfo(l,s.dtype,f)}const{isPacked:c}=n.texData.get(s.dataId),u=Z0(s.shape,a,l);if(c||!u){const d=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aae(l):new oae(l),f=[a];return n.runWebGLProgram(d,[s],s.dtype,f)}return n.uploadToGPU(s.dataId),lae(s,a,l,n)}const cae={kernelName:hp,backendName:"webgl",kernelFunc:dc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uae=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{blockShape:o,crops:r}=i;F(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((x,b)=>x*b),l=ld(s.shape,o,a),c=cd(l.length,o.length),u=ud(s.shape,o,a),d=sb(r,o.length),f=ob(u,r,o.length),h=[],p=Te({inputs:{x:s},backend:n,attrs:{shape:l}}),m=$i({inputs:{x:p},backend:n,attrs:{perm:c}}),g=Te({inputs:{x:m},backend:n,attrs:{shape:u}}),v=dc({inputs:{x:g},backend:n,attrs:{begin:d,size:f}});return h.push(p),h.push(m),h.push(g),h.forEach(x=>n.disposeIntermediateTensorInfo(x)),v},dae={kernelName:Ef,backendName:"webgl",kernelFunc:uae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,weights:o}=e,{size:r}=i,a=n.readSync(s.dataId),l=n.readSync(o.dataId),c=pR(a,l,o.dtype,o.shape,r);return n.makeTensorInfo([r],o.dtype,c)}const fae={kernelName:Ex,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pae=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,mae=`
  return float(int(a.r) & int(b.r));
`;function gae(t){const{inputs:e,backend:n}=t,{a:i,b:s}=e,o=le().getBool("WEBGL_PACK_BINARY_OPERATIONS"),r=le().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([i,s])||r===1){const l=n.texData.get(i.dataId).values,c=n.texData.get(s.dataId).values,[u,d]=Ise(i.shape,s.shape,l,c,i.dtype),f=n.makeTensorInfo(d,i.dtype),h=n.texData.get(f.dataId);return h.values=u,f}let a;return o?a=new cc(pae,i.shape,s.shape,!1):a=new Na(mae,i.shape,s.shape),n.runWebGLProgram(a,[i,s],i.dtype)}const vae={kernelName:Nx,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xae(t){const{inputs:e,backend:n}=t,{s0:i,s1:s}=e,o=n.readSync(i.dataId),r=n.readSync(s.dataId),a=mt(Array.from(o),Array.from(r));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const bae={kernelName:pE,backendName:"webgl",kernelFunc:xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yae="return float(a != b);",kR=si({opSnippet:yae,cpuKernelImpl:Use,dtype:"bool"}),wae={kernelName:ep,backendName:"webgl",kernelFunc:kR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sd(t){const{inputs:e,backend:n}=t,{input:i}=e,s=n.texData.get(i.dataId);return Ji({inputs:{x:s.complexTensorInfos.real},backend:n})}const Cae={kernelName:Zx,backendName:"webgl",kernelFunc:Sd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sae="return float(int(x));";function Iae(t,e){const n=new uo(t.shape,Sae),i=e.runWebGLProgram(n,[t],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{dtype:o}=i;if(o==="complex64"){if(s.dtype==="complex64")return Ji({inputs:{x:s},backend:n});const r=Xn(s.shape),a=ev({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),l=zr({inputs:{real:a,imag:r},backend:n});return r.dispose(),n.disposeIntermediateTensorInfo(a),l}if(s.dtype==="complex64"){const r=Sd({inputs:{input:s},backend:n}),a=ev({inputs:{x:r},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(r),a}if(!cE(s.dtype,o)){const r=Ji({inputs:{x:s},backend:n});return{dataId:r.dataId,shape:r.shape,dtype:o}}if(n.shouldExecuteOnCPU([s])){const r=n.texData.get(s.dataId).values,[a,l,c]=$se(r,s.shape,s.dtype,o);return n.makeTensorInfo(a,l,c)}if(o==="int32")return Iae(s,n);if(o==="bool"){const r=n.makeTensorInfo([],"bool",di("bool",1)),l=kR({inputs:{a:s,b:r},backend:n});return n.disposeIntermediateTensorInfo(r),l}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}const $ae={kernelName:mu,backendName:"webgl",kernelFunc:ev};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AS="return ceil(x);",Eae=Ot({opSnippet:AS,packedOpSnippet:AS,cpuKernelImpl:Ese}),Nae={kernelName:gu,backendName:"webgl",kernelFunc:Eae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kae{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tae(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{clipValueMin:o,clipValueMax:r}=i;let a;le().getBool("WEBGL_PACK_CLIP")?a=new Dae(s.shape):a=new kae(s.shape);const l=[[o],[r]];return n.runWebGLProgram(a,[s],s.dtype,l)}const Rae={kernelName:vu,backendName:"webgl",kernelFunc:Tae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ae{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OS(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function Aae(t){const{inputs:e,backend:n}=t,{x:i}=e,s=n.texData.get(i.dataId),o=new _ae(i.shape),r=[OS(i,s.complexTensorInfos.real),OS(i,s.complexTensorInfos.imag)];return n.runWebGLProgram(o,r,r[0].dtype)}const Oae={kernelName:Nf,backendName:"webgl",kernelFunc:Aae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pae{constructor(e){this.outputShape=[],this.outputShape=vo(e,1),this.variableNames=e.map((r,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let r=1;r<n.length;r++)n[r]=n[r-1]+e[r][1];const i=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let r=1;r<n.length;r++){const a=n[r-1];i.push(`else if (yC < ${n[r]}) setOutput(getT${r}(yR, yC-${a}));`)}const s=n.length,o=n[n.length-1];i.push(`else setOutput(getT${s}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${i.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mae{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vo(e,n);const i=this.outputShape,s=i.length,o=qt(s),r=wi("coords",s),a=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const c=a[n],u=a.slice(-2),d=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];f+=`
        if (${c} < ${l[m]}  && ${c} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${Jd(a,c,g)}),
            vec2(${Jd(u,c,g)}));
        }`}const h=l.length,p=l[l.length-1];f+=`
        return getChannel(
          getT${h}(${Jd(a,c,p)}),
          vec2(${Jd(u,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${r}), 0., 0., 0.);

        ${r[s-1]} = ${r[s-1]} + 1;
        if (${r[s-1]} < ${i[s-1]}) {
          result.g = getValue(${r});
        }

        ${r[s-2]} = ${r[s-2]} + 1;
        if (${r[s-2]} < ${i[s-2]}) {
          result.a = getValue(${r});
        }

        ${r[s-1]} = ${r[s-1]} - 1;
        if (${r[s-2]} < ${i[s-2]} &&
            ${r[s-1]} < ${i[s-1]}) {
          result.b = getValue(${r});
        }
        setOutput(result);
      }
    `}}function Jd(t,e,n){const i=t.indexOf(e);return t.map((o,r)=>r===i?`${o} - ${n}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qp(t){const{inputs:e,backend:n}=t,{input:i}=e,s=n.texData.get(i.dataId);return Ji({inputs:{x:s.complexTensorInfos.imag},backend:n})}const Fae={kernelName:Hx,backendName:"webgl",kernelFunc:qp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $c(t,e,n){const i=t[0].dtype;if(i==="complex64"){const h=t.map(x=>Sd({inputs:{input:x},backend:n})),p=t.map(x=>qp({inputs:{input:x},backend:n})),m=$c(h,e,n),g=$c(p,e,n),v=zr({inputs:{real:m,imag:g},backend:n});return h.forEach(x=>n.disposeIntermediateTensorInfo(x)),p.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),v}let s=n.shouldExecuteOnCPU(t);if(i==="string"&&(s=!0),s){const h=t.map(w=>{const C=[-1,pe(w.shape.slice(e))];return Te({inputs:{x:w},backend:n,attrs:{shape:C}})}),p=h.map(w=>({vals:n.readSync(w.dataId),shape:w.shape})),m=vo(h.map(w=>w.shape),1),g=h[0].shape[0]===1,v=Nse(p,m,i,g),x=vo(t.map(w=>w.shape),e),b=n.makeTensorInfo(x,i,v);return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}const o=t.filter(h=>pe(h.shape)>0),r=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const h=r?new uo(t[0].shape,ar):new hr(t[0].shape,ar);return n.runWebGLProgram(h,t,i)}const a=le().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const h=[];for(let m=0;m<o.length;m+=a){const g=o.slice(m,m+a);h.push($c(g,e,n))}const p=$c(h,e,n);for(const m of h)n.disposeIntermediateTensorInfo(m);return p}if(r){const h=new Mae(o.map(p=>p.shape),e);return n.runWebGLProgram(h,o,i)}const{tensors2D:l,outShape:c}=Lae(o,e,n),u=new Pae(l.map(h=>h.shape)),d=n.runWebGLProgram(u,l,i);l.forEach(h=>n.disposeIntermediateTensorInfo(h));const f=Te({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),f}function Lae(t,e,n){const i=vo(t.map(o=>o.shape),e);return{tensors2D:t.map(o=>Te({inputs:{x:o},attrs:{shape:[-1,pe(o.shape.slice(e))]},backend:n})),outShape:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(t){const{inputs:e,backend:n,attrs:i}=t,{axis:s}=i,o=St(s,e[0].shape)[0],r=e.map(c=>c.shape);tb(r,o);const a=vo(e.map(c=>c.shape),o);if(pe(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>pe(c.shape)>0);return l.length===1?Ji({inputs:{x:l[0]},backend:n}):$c(l,o,n)}const zae={kernelName:kf,backendName:"webgl",kernelFunc:DR};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TR{constructor(e,n=!1,i=null,s=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const r=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",v=g?1:2,x=g?2:3,b=g?3:1;let w="",y="";i&&(s?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:o?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:w=`
          float activation(float x) {
            ${i}
          }
        `,y="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${r}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${y}
        setOutput(result);
      }
    `}}class Bae{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,i=e.padInfo.top,s=e.padInfo.left,o=e.strideDepth,r=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,f=e.filterHeight,h=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${r}, ${a});
      const ivec3 pads = ivec3(${n}, ${i}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RR{constructor(e,n=!1,i=null,s=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=gi(this.outputShape.length);const r=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)f+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)f+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(d+1)/2;g++){const v=g*2;if(f+=`
           xC = xCCorner + ${v*l};
           `,a===1){if(v<u&&(r%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }
               `,l===1&&v>0?f+=`
                 xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                   } else {
                     xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xC${v} = xTexelC${v};
                 `,v+1<u)){const x=r%2===0?gx(l):l;l%2===0&&r%2===1||l%2!==0&&r%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                     xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${v+1}.zw = vec2(0.0);
                     }
                     xTexelC${v+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                     } else {
                      xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                     }
                     `:f+=`
                     xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                     `):x===1?f+=`
                     xC${v+1} = xTexelC${v};
                     `:f+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                       xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${v+1}.zw = vec2(0.0);
                       }
                       xTexelC${v+1}Ready = 1;
                     }

                     xC${v+1} = xTexelC${v+1};
                     `}}else v<u&&(r%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.0);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
               `,v+1<u&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(
                   xTexelC${v}.xy, xTexelC${v+1}.xy);
               `,v+1<u&&(f+=`
                   xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                 `)));v<u&&(f+=`
             wTexel = getW(r, ${v}, d1, d2);
             dotProd += xC${v}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${v}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<u&&(f+=`
               wTexel = getW(r, ${v+1}, d1, d2);
               dotProd += xC${v+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${v+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let h="",p="";i&&(s?h=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${i}
         }`:o?h=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${i}
         }`:h=`vec4 activation(vec4 x) {
           ${i}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${h}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vae{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=gi(this.outputShape.length);const{dataFormat:i}=n,s=Ni(),o=i==="channelsLast",r=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${r}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qh(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function _R({x:t,filter:e,convInfo:n,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:r=0,activation:a=null}){const l=t.shape,c=i.texData.get(t.dataId),u=n.inChannels,d=l[0]*l[1]*l[2],f=n.outChannels,h=n.dataFormat==="channelsLast",p=!1,m=!1;let g;const v=[];if(o!=null){const w=Qh(o.shape,h);w!=null&&(o=Te({inputs:{x:o},backend:i,attrs:{shape:w}}),v.push(o))}if(s!=null){const w=Qh(s.shape,h);w!=null&&(s=Te({inputs:{x:s},backend:i,attrs:{shape:w}}),v.push(s))}if(!((d===1||f===1)&&u>IR)&&c.isPacked&&h&&c.texture!=null&&l[2]%2!==0&&Wt(c.shape.slice(-3),l.slice(-3))){const w=l[0]*l[1]*(l[2]+1),y={dataId:t.dataId,shape:[1,w,n.inChannels],dtype:t.dtype},C=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,F(Jh(c.shape,y.shape),()=>`packed reshape ${c.shape} to ${y.shape} isn't free`);const I=Te({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});v.push(I);const $=Zh({a:y,b:I,backend:i,transposeA:p,transposeB:m,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:r}),E=i.texData.get($.dataId);F(E.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=C,E.shape=n.outShape,g=Ji({inputs:{x:$},backend:i}),g.shape=n.outShape,v.push($)}else{const w=n.outHeight*n.outWidth,y=Te({inputs:{x:t},backend:i,attrs:{shape:h?[n.batchSize,w,n.inChannels]:[n.batchSize,n.inChannels,w]}}),C=Te({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),I=Zh({a:h?y:C,b:h?C:y,transposeA:!h,transposeB:m,backend:i,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:r});g=Te({inputs:{x:I},backend:i,attrs:{shape:n.outShape}}),v.push(y),v.push(C),v.push(I)}for(const w of v)i.disposeIntermediateTensorInfo(w);return g}function AR({x:t,filter:e,convInfo:n,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:r=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:f,dataFormat:h}=n,p=h==="channelsLast",m=l*c*u,g=f*d,v=[n.batchSize,m,g],x=!0,b=!1,w=[];if(o!=null){const P=Qh(o.shape,p);P!=null&&(o=Te({inputs:{x:o},backend:i,attrs:{shape:P}}),w.push(o))}if(s!=null){const P=Qh(s.shape,p);P!=null&&(s=Te({inputs:{x:s},backend:i,attrs:{shape:P}}),w.push(s))}const y=Te({inputs:{x:e},backend:i,attrs:{shape:[1,m,pe(e.shape)/m]}});w.push(y);const C=new Vae(v,n),I=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],$=i.runWebGLProgram(C,[t],"float32",I),E=Te({inputs:{x:$},backend:i,attrs:{shape:v}});w.push($),w.push(E);const N=s!=null,k=o!=null,D=a==="leakyrelu",_=a?Jc(a,!0):null,R=new SR(p?E.shape:y.shape,p?y.shape:E.shape,p?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],x,b,N,_,k,D),T=p?[E,y]:[y,E];if(s&&T.push(s),k&&T.push(o),D){const P=i.makeTensorInfo([],"float32",Tr(r,"float32"));T.push(P),w.push(P)}const A=i.runWebGLProgram(R,T,"float32"),O=Te({inputs:{x:A},backend:i,attrs:{shape:n.outShape}});w.push(A);for(const P of w)i.disposeIntermediateTensorInfo(P);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=i,d=tr(l),f=ni(s.shape,o.shape,r,c,a,u,!1,d);let h;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))h=_R({x:s,filter:o,convInfo:f,backend:n});else if(f.strideWidth<=2&&d==="channelsLast"&&le().getBool("WEBGL_EXP_CONV")){const m=new RR(f),g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];h=n.runWebGLProgram(m,[s,o],"float32",g)}else if(le().getBool("WEBGL_CONV_IM2COL"))h=AR({x:s,filter:o,convInfo:f,backend:n});else{const m=new TR(f);h=n.runWebGLProgram(m,[s,o],"float32")}const p=Te({inputs:{x:h},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(h),p}const Gae={kernelName:Df,backendName:"webgl",kernelFunc:Wae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hae{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,i=e.strideWidth,s=e.padInfo.top,o=e.padInfo.left,r=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${r?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Uae{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,s=e.strideHeight,o=e.strideWidth,r=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=i-1-e.padInfo.left,c=r?1:2,u=r?2:3,d=r?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${r}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jae{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.padInfo.front,r=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${i} - ${r};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Kae{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,i=e.filterHeight,s=e.filterWidth,o=e.strideDepth,r=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=i-1-e.padInfo.top,u=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${i}; wR++) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${i} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,dy:o}=e,{strides:r,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=i,d=tr(l),f=ni(s.shape,u,r,1,a,c,!1,d),h=new Hae(f);return n.runWebGLProgram(h,[s,o],"float32")}const qae={kernelName:Dx,backendName:"webgl",kernelFunc:Xae};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yae{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=gi(this.outputShape.length);const n=e.filterHeight,i=e.filterWidth,s=n-1-e.padInfo.top,o=i-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            int wCPerm = ${i} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,filter:o}=e,{inputShape:r,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=i,d=tr(c),f=ni(r,o.shape,a,1,l,u,!1,d);if(le().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const h=[[f.strideHeight,f.strideWidth]],p=new Yae(f);return n.runWebGLProgram(p,[s,o],"float32",h)}else{const h=new Uae(f);return n.runWebGLProgram(h,[s,o],"float32")}}const Zae={kernelName:Tf,backendName:"webgl",kernelFunc:Jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dilations:l}=i,c=_r(s.shape,o.shape,r,l,a),u=new Bae(c);return n.runWebGLProgram(u,[s,o],"float32")}const ele={kernelName:Rf,backendName:"webgl",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,dy:o}=e,{strides:r,pad:a,filterShape:l}=i,c=_r(s.shape,l,r,1,a),u=new jae(c);return n.runWebGLProgram(u,[s,o],"float32")}const nle={kernelName:Tx,backendName:"webgl",kernelFunc:tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ile(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,filter:o}=e,{pad:r,strides:a,inputShape:l}=i,c=_r(l,o.shape,a,1,r),u=new Kae(c);return n.runWebGLProgram(u,[s,o],"float32")}const sle={kernelName:Rx,backendName:"webgl",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ole=uc+`
  return cos(x);
`,rle=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Ga}
  return result;
`,ale=Ot({opSnippet:ole,packedOpSnippet:rle}),lle={kernelName:xu,backendName:"webgl",kernelFunc:ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cle=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,ule=Ot({opSnippet:cle}),dle={kernelName:bu,backendName:"webgl",kernelFunc:ule};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hle{constructor(e,n,i,s,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[r,a,l,c]=e,[u]=n,[d,f]=i;this.outputShape=[u,d,f,c];const h=s==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[g,v,x]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,w,y]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${r}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${w};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${y};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${h} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fle=t=>{const{inputs:e,backend:n,attrs:i}=t,{image:s,boxes:o,boxInd:r}=e,{cropSize:a,method:l,extrapolationValue:c}=i,u=new hle(s.shape,o.shape,a,l,c);return n.runWebGLProgram(u,[s,o,r],"float32")},ple={kernelName:Ax,backendName:"webgl",kernelFunc:fle};var Qc;(function(t){t.Prod="*",t.Sum="+"})(Qc||(Qc={}));class PS{constructor(e,n,i,s){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,r=this.op===Qc.Prod?"1.0":"0.0",a=i?r:`getX(${MS(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";i?(c=s?`end != ${l-1}`:"end != 0",u=s?"end + 1":"end - 1"):(c=s?`end + pow2 < ${l}`:"end >= pow2",u=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${qt(o)} coords = getOutputCoords();
        int end = ${FS(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${FS(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${MS(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function MS(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function FS(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(t,e,n,i,s,o){const r=e.shape.length,a=mn([i],r);let l=e;a!=null&&(l=$i({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Nn(1,r)[0];if(c!==r-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${i}`);const u=l.shape[c];let d=Ji({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(u))-1;f++){const h=new PS(t,l.shape,!1,o),p=[[f]],m=d;d=n.runWebGLProgram(h,[d],d.dtype,p),n.disposeIntermediateTensorInfo(m)}if(s){const f=new PS(t,l.shape,s,o),h=d;d=n.runWebGLProgram(f,[d],d.dtype),n.disposeIntermediateTensorInfo(h)}if(a!=null){const f=Ar(a),h=$i({inputs:{x:d},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),h}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,exclusive:r,reverse:a}=i;return OR(Qc.Prod,s,n,o,r,a)}const gle={kernelName:_x,backendName:"webgl",kernelFunc:mle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,exclusive:r,reverse:a}=i;return OR(Qc.Sum,s,n,o,r,a)}const xle={kernelName:_f,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,weights:o}=e,{size:r,binaryOutput:a}=i;if(s.shape.length===1){const l=n.readSync(s.dataId),c=n.readSync(o.dataId),u=pR(l,c,o.dtype,o.shape,r);return n.makeTensorInfo([r],o.dtype,u)}else if(s.shape.length===2){const l=n.bufferSync(s),c=n.bufferSync(o),u=Sse(l,c,r,a);return n.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const yle={kernelName:Ox,backendName:"webgl",kernelFunc:ble};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wle{constructor(e,n,i){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=i,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{blockSize:o,dataFormat:r}=i,a=s.shape[0],l=r==="NHWC"?s.shape[1]:s.shape[2],c=r==="NHWC"?s.shape[2]:s.shape[3],u=r==="NHWC"?s.shape[3]:s.shape[1],d=l*o,f=c*o,h=u/(o*o),p=r==="NHWC"?[a,d,f,h]:[a,h,d,f],m=new wle(p,o,r);return n.runWebGLProgram(m,[s],s.dtype)}const Sle={kernelName:Px,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PR{constructor(e,n=!1,i=null,s=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=gi(this.outputShape.length);const r=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";i&&(s?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:o?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:c=`
          float activation(float x) {
            ${i}
          }
        `,u="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${r}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MR{constructor(e,n=!1,i=null,s=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=gi(this.outputShape.length);const r=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let h=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)h+=`
          vec4 xTexelC${v*2};
          int xTexelC${v*2}Ready;
          vec4 xTexelC${v*2+1};
          int xTexelC${v*2+1}Ready;
          vec4 xC${v};`;h+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let v=0;v<d;v++)h+=`
          xTexelC${v*2} = vec4(0.0);
          xTexelC${v*2}Ready = 0;
          xTexelC${v*2+1} = vec4(0.0);
          xTexelC${v*2+1}Ready = 0;
          xC${v} = vec4(0.0);`;h+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let v=0;v<(f+1)/2;v++){const x=v*2;if(h+=`
          xC = xCCorner + ${x*c};
          `,l===1){if(x<d&&(a%2===1?(h+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,c===1&&x>0?h+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:h+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):h+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<d)){const b=a%2===0?gx(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(h+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,c>1?h+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:h+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):b===1?h+=`
                    xC${x+1} = xTexelC${x};
                    `:h+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<d&&(a%2===1?(h+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<d&&(h+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(h+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<d&&(h+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<d&&(h+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<d&&(h+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}h+=`
    }
  `,h+=`
      }
    `;let p="",m="";i&&(s?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:o?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:p=`vec4 activation(vec4 x) {
          ${i}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${r};
        int q = d2 - d1 * ${r};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${h}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dilations:l,dimRoundingMode:c}=i;let u=l;u==null&&(u=[1,1]),F(pi(r,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${r} and dilations '${u}'`);const d=ni(s.shape,o.shape,r,u,a,c,!0);let f;le().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new MR(d):f=new PR(d);const h=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(f,[s,o],"float32",h)}const $le={kernelName:Af,backendName:"webgl",kernelFunc:Ile};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ele{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,i=e.strideWidth,s=e.padInfo.top,o=e.padInfo.left,r=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${r} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Nle{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,s=e.strideHeight,o=e.strideWidth,r=n-1-e.padInfo.top,a=i-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kle(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,dy:o}=e,{strides:r,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=i,d=ni(s.shape,u,r,a,l,c,!0),f=new Ele(d);return n.runWebGLProgram(f,[s,o],"float32")}const Dle={kernelName:Mx,backendName:"webgl",kernelFunc:kle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,filter:o}=e,{strides:r,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=i,d=ni(u,o.shape,r,a,l,c,!0),f=new Nle(d);return n.runWebGLProgram(f,[s,o],"float32")}const Rle={kernelName:Fx,backendName:"webgl",kernelFunc:Tle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _le{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ale(t){const{inputs:e,backend:n}=t,{x:i}=e,s=[...i.shape,...i.shape],o=pe(i.shape),r=Te({inputs:{x:i},backend:n,attrs:{shape:[o]}}),a=new _le(o),l=n.runWebGLProgram(a,[r],r.dtype),c=Te({inputs:{x:l},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(l),c}const Ole={kernelName:mE,backendName:"webgl",kernelFunc:Ale};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ple{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:i,padInfo:s,strideHeight:o,strideWidth:r,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:f}=s;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${r});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${i}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mle(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o}=e,{strides:r,pad:a,dilations:l}=i,c=id(s.shape,o.shape,r,a,"NHWC",l);let u;const d=new Ple(c);u=n.runWebGLProgram(d,[s,o],"float32");const f=Te({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),f}const Fle={kernelName:Of,backendName:"webgl",kernelFunc:Mle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lle(t){const{inputs:e,backend:n,attrs:i}=t,{equation:s}=i,o=e,{allDims:r,summedDims:a,idDims:l}=fb(s,o.length);mb(r.length,l,o);const{path:c,steps:u}=gb(a,l),d=u.length;let f=null,h=r.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:v,expandDims:x}=pb(h,l[g]);let b;vb(v)?b=o[g]:(b=$i({inputs:{x:o[g]},backend:n,attrs:{perm:v}}),p.push(b));const w=b.shape.slice();for(let y=0;y<x.length;++y)w.splice(x[y],0,1);Wt(b.shape,w)||(b=Te({inputs:{x:b},backend:n,attrs:{shape:w}}),p.push(b)),f===null?f=b:(f=sy({inputs:{a:b,b:f},backend:n}),p.push(f))}m<d-1&&(c[m]>=0&&(f=Xp({inputs:{x:f},backend:n,attrs:{axis:c[m]-(r.length-h),keepDims:!1}}),p.push(f)),h--)}for(const m of p)m!==f&&n.disposeIntermediateTensorInfo(m);return f}const zle={kernelName:Lx,backendName:"webgl",kernelFunc:Lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ble="return (x >= 0.0) ? x : (exp(x) - 1.0);",Vle=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Wle=Ot({opSnippet:Ble,packedOpSnippet:Vle}),Gle={kernelName:wu,backendName:"webgl",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hle="return (b >= 0.0) ? a : a * (b + 1.0);",Ule=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,jle=t=>{const{inputs:e,backend:n}=t,{dy:i,y:s}=e,o=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cc(Ule,i.shape,s.shape):new Na(Hle,i.shape,s.shape);return n.runWebGLProgram(o,[i,s],i.dtype)},Kle={kernelName:zx,backendName:"webgl",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle=`
  return vec4(equal(a, b));
`,qle="return float(a == b);",Yle=si({opSnippet:qle,packedOpSnippet:Xle,dtype:"bool",cpuKernelImpl:kse}),Jle={kernelName:Pf,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zle=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${rb};
  float a1 = ${ab};
  float a2 = ${lb};
  float a3 = ${cb};
  float a4 = ${ub};
  float a5 = ${db};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Qle=Ot({opSnippet:Zle}),ece={kernelName:Cu,backendName:"webgl",kernelFunc:Qle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tce=uc+`
  return exp(x);
`,nce=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FR=Ot({opSnippet:tce,packedOpSnippet:nce,cpuKernelImpl:Dse,dtype:"float32"}),ice={kernelName:Su,backendName:"webgl",kernelFunc:FR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tv(t){const{inputs:e,attrs:n,backend:i}=t,{dim:s}=n,{input:o}=e,r=o.shape.length,a=o.shape.slice();let l=s;return s<0&&(F(-(r+1)<=s,()=>`Axis must be in the interval [${-(r+1)}, ${r}]`),l=r+s+1),a.splice(l,0,1),Te({inputs:{x:o},backend:i,attrs:{shape:a}})}const sce={kernelName:Mf,backendName:"webgl",kernelFunc:tv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LS="return exp(x) - 1.0;",oce=Ot({opSnippet:LS,packedOpSnippet:LS,cpuKernelImpl:Tse}),rce={kernelName:Iu,backendName:"webgl",kernelFunc:oce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zS{constructor(e,n,i){this.variableNames=["real","imag"];const s=n[1];this.outputShape=n;const o=i?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,r=i?`${s}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${r};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(t,e,n){const i=n.texData.get(t.dataId),s=pe(t.shape),o=t.shape[t.shape.length-1],r=s/o,a=Te({inputs:{x:t},backend:n,attrs:{shape:[r,o]}}),l=a.shape,c=new zS("real",l,e),u=new zS("imag",l,e),d=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:l},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:l}],f=n.runWebGLProgram(c,d,"float32"),h=n.runWebGLProgram(u,d,"float32"),p=zr({inputs:{real:f,imag:h},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h);const m=Te({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(t){const{inputs:e,backend:n}=t,{input:i}=e;return LR(i,!1,n)}const lce={kernelName:Bx,backendName:"webgl",kernelFunc:ace};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cce{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Id(t){const{backend:e,attrs:n}=t,{shape:i,value:s}=n;let{dtype:o}=n;if(o=o||Yl(s),o==="string"){const r=wn(o,pe(i));return r.fill(s),e.makeTensorInfo(i,o,r)}else{const r=new cce(i,s),a=[[s]];return e.runWebGLProgram(r,[],o,a)}}const uce={kernelName:Vx,backendName:"webgl",kernelFunc:Id};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dce{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce={kernelName:Wx,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,i=e,s=new dce(n.shape);return i.runWebGLProgram(s,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS="return floor(x);",fce=Ot({opSnippet:BS,packedOpSnippet:BS,cpuKernelImpl:Rse}),pce={kernelName:$u,backendName:"webgl",kernelFunc:fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mce=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,gce=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,vce=si({opSnippet:mce,packedOpSnippet:gce,dtype:"int32"}),xce={kernelName:Eu,backendName:"webgl",kernelFunc:vce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bce{constructor(e){this.variableNames=["A"];const n=Ni(),[i,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${i}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yce{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Ni(),[i,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${i}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wce={kernelName:CH,backendName:"webgl",kernelFunc:Cce};let Ya,Lm=le().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Cce(t){const{inputs:e,backend:n,attrs:i}=t;let{pixels:s}=e;const{numChannels:o}=i,r=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[l,c]=r?[s.videoWidth,s.videoHeight]:[s.width,s.height],u=[c,l],d=[c,l,o];if(a||r){const m=le().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Ya==null||m!==Lm)&&(Lm=m,Ya=document.createElement("canvas").getContext("2d",{willReadFrequently:Lm})),Ya.canvas.width=l,Ya.canvas.height=c,Ya.drawImage(s,0,0,l,c),s=Ya.canvas}const f=n.makeTensorInfo(u,"int32");n.texData.get(f.dataId).usage=ss.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),s);const h=le().getBool("WEBGL_PACK")?new yce(d):new bce(d),p=n.runWebGLProgram(h,[f],"int32");return n.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sce(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o,bias:r,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=i,m=tr(u),g=ni(s.shape,o.shape,l,d,c,f,!1,m);let v;const x=[],b=r!=null,w=a!=null,y=h==="leakyrelu",C=()=>{const $=[s,o],E=(N,k)=>{if(k==="NCHW"&&N.shape.length===1&&N.shape[0]!==1){const D=Te({inputs:{x:N},backend:n,attrs:{shape:[N.shape[0],1,1]}});return x.push(D),D}return N};if(b&&$.push(E(r,u)),w&&$.push(E(a,u)),y){const N=n.makeTensorInfo([],"float32",Tr(p,"float32"));$.push(N),x.push(N)}return $};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))v=_R({x:s,filter:o,convInfo:g,backend:n,bias:r,activation:h,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&le().getBool("WEBGL_EXP_CONV")){const $=h?Jc(h,!0):null,E=new RR(g,b,$,w,y),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],k=C();v=n.runWebGLProgram(E,k,"float32",N)}else if(le().getBool("WEBGL_CONV_IM2COL"))v=AR({x:s,filter:o,convInfo:g,backend:n,bias:r,activation:h,preluActivationWeights:a,leakyreluAlpha:p});else{const $=h?Jc(h,!1):null,E=new TR(g,b,$,w,y),N=C();v=n.runWebGLProgram(E,N,"float32")}const I=Te({inputs:{x:v},backend:n,attrs:{shape:g.outShape}});return x.push(v),x.forEach($=>n.disposeIntermediateTensorInfo($)),I}const Ice={kernelName:Eh,backendName:"webgl",kernelFunc:Sce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ce(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,filter:o,bias:r,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:f,leakyreluAlpha:h}=i,p=[];let m=u;m==null&&(m=[1,1]),F(pi(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=ni(s.shape,o.shape,l,m,c,d,!0),v=le().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=f?Jc(f,v):null,b=[s,o],w=r!=null,y=a!=null,C=f==="leakyrelu";if(w&&b.push(r),y&&b.push(a),C){const N=n.makeTensorInfo([],"float32",Tr(h,"float32"));b.push(N),p.push(N)}let I;v?I=new MR(g,w,x,y,C):I=new PR(g,w,x,y,C);const $=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],E=n.runWebGLProgram(I,b,"float32",$);return p.forEach(N=>n.disposeIntermediateTensorInfo(N)),E}const Ece={kernelName:OE,backendName:"webgl",kernelFunc:$ce};class Nce{constructor(e,n,i,s){this.sliceDim=e,this.strides=n,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=i;const o=qt(i.length);let r=`
    int index;`;for(let a=0;a<this.sliceDim;a++)r+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${r}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kce(t){const{inputs:e,backend:n}=t,{params:i,indices:s}=e,o=s.shape,r=o[o.length-1],a=pe(i.shape),[l,c,u,d]=q0(i,s),f=Te({inputs:{x:s},backend:n,attrs:{shape:[c,r]}}),h=Te({inputs:{x:i},backend:n,attrs:{shape:[pe(i.shape)/u,u]}});if(n.shouldExecuteOnCPU([i,s])||i.dtype==="string"){const v=n.readSync(s.dataId),x=n.bufferSync(i),b=_se(v,x,i.dtype,c,r,u,d,i.shape,a);return n.makeTensorInfo(l,i.dtype,b.values)}const p=new Nce(r,d,[c,u],i.shape),m=n.runWebGLProgram(p,[h,f],h.dtype),g=Te({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),g}const Dce={kernelName:gE,backendName:"webgl",kernelFunc:kce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tce{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const i=qt(this.rank),s=Rce(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function Rce(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let s=0;s<t.length;s++)s===2?i.push("index"):i.push(`${n[s]}`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,indices:o}=e,{axis:r,batchDims:a}=i,l=St(r,s.shape)[0];if(le().get("DEBUG")){const x=n.readSync(o.dataId),b=s.shape[l];for(let w=0;w<x.length;++w){const y=x[w];F(y<=b-1&&y>=0,()=>`GatherV2: the index value ${y} is not in [0, ${b-1}]`)}}const c=bb(s,o,l,a),u=pe(o.shape),d=[],f=Te({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),h=Te({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(f),d.push(h);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([s,o])||s.dtype==="string"){const x=n.bufferSync(h),b=n.bufferSync(f),w=Ase(b,x,p);return d.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.makeTensorInfo(c.outputShape,w.dtype,w.values)}const m=new Tce(f.shape,p),g=n.runWebGLProgram(m,[f,h],f.dtype);d.push(g);const v=Te({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),v}const _ce={kernelName:Lf,backendName:"webgl",kernelFunc:zR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ace="return float(a > b);",Oce=`
  return vec4(greaterThan(a, b));
`,Pce=si({opSnippet:Ace,packedOpSnippet:Oce,cpuKernelImpl:Ose,dtype:"bool"}),Mce={kernelName:zf,backendName:"webgl",kernelFunc:Pce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce="return float(a >= b);",Lce=`
  return vec4(greaterThanEqual(a, b));
`,zce=si({opSnippet:Fce,packedOpSnippet:Lce,dtype:"bool",cpuKernelImpl:Pse}),Bce={kernelName:Nu,backendName:"webgl",kernelFunc:zce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vce(t){const{inputs:e,backend:n}=t,{input:i}=e;return LR(i,!0,n)}const Wce={kernelName:Gx,backendName:"webgl",kernelFunc:Vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce="return float(!isnan(x) && !isinf(x));",Hce=Ot({opSnippet:Gce,dtype:"bool"}),Uce={kernelName:Du,backendName:"webgl",kernelFunc:Hce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce="return float(isinf(x));",Kce=Ot({opSnippet:jce,dtype:"bool"}),Xce={kernelName:Tu,backendName:"webgl",kernelFunc:Kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qce="return float(isnan(x));",Yce=Ot({opSnippet:qce,dtype:"bool"}),Jce={kernelName:Ru,backendName:"webgl",kernelFunc:Yce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zce="return float(a < b);",Qce=`
  return vec4(lessThan(a, b));
`,eue=si({opSnippet:Zce,packedOpSnippet:Qce,cpuKernelImpl:Mse,dtype:"bool"}),tue={kernelName:Vf,backendName:"webgl",kernelFunc:eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue="return float(a <= b);",iue=`
  return vec4(lessThanEqual(a, b));
`,sue=si({opSnippet:nue,packedOpSnippet:iue,cpuKernelImpl:Fse,dtype:"bool"}),oue={kernelName:Wf,backendName:"webgl",kernelFunc:sue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t){const{backend:e,attrs:n}=t,{start:i,stop:s,num:o}=n,r=Lse(i,s,o);return e.makeTensorInfo([r.length],"float32",r)}const aue={kernelName:vE,backendName:"webgl",kernelFunc:rue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lue=uc+`
  return x < 0.0 ? 0./0. : log(x);
`,cue=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,uue=Ot({opSnippet:lue,packedOpSnippet:cue,cpuKernelImpl:zse}),due={kernelName:_u,backendName:"webgl",kernelFunc:uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue=uc+`
  return log(1.0 + x);
`,fue=Ot({opSnippet:hue}),pue={kernelName:Au,backendName:"webgl",kernelFunc:fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mue="return float(a >= 1.0 && b >= 1.0);",gue=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,vue=si({opSnippet:mue,packedOpSnippet:gue,dtype:"bool"}),xue={kernelName:Gf,backendName:"webgl",kernelFunc:vue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bue="return float(!(x >= 1.0));",yue=Ot({opSnippet:bue}),wue={kernelName:Hf,backendName:"webgl",kernelFunc:yue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cue="return float(a >= 1.0 || b >= 1.0);",Sue=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Iue=si({opSnippet:Cue,packedOpSnippet:Sue,dtype:"bool"}),$ue={kernelName:Uf,backendName:"webgl",kernelFunc:Iue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eue{constructor(e,n,i,s,o){this.variableNames=["x"],this.outputShape=[];const r=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${i}) + float(${s}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${r}; j <= ${r}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nue{constructor(e,n,i,s,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const r=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${i}) + float(${s}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${r};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${r}; j <= ${r}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kue=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{depthRadius:o,bias:r,alpha:a,beta:l}=i,c=le().getBool("WEBGL_PACK_NORMALIZATION")?new Nue(s.shape,o,r,a,l):new Eue(s.shape,o,r,a,l);return n.runWebGLProgram(c,[s],s.dtype)},Due={kernelName:jf,backendName:"webgl",kernelFunc:kue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tue{constructor(e,n,i,s,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=i,this.alpha=s,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${i});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rue=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:s,y:o,dy:r}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=i,d=new Tue(s.shape,a,l,c,u);return n.runWebGLProgram(d,[s,o,r],s.dtype)},_ue={kernelName:Ux,backendName:"webgl",kernelFunc:Rue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aue(t,e,n,i){const s=pe(e),r=pe(t.shape)/s,a=Te({inputs:{x:t},attrs:{shape:[r,s]},backend:i}),l=Ha(a,t.dtype,"max",i),c=Te({inputs:{x:l},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{reductionIndices:o,keepDims:r}=i,a=s.shape.length,l=St(o,s.shape);let c=l;const u=mn(c,a),d=u!=null,f=n.shouldExecuteOnCPU([s]);let h=s;if(d){if(f){const b=n.texData.get(h.dataId).values,w=new Array(a);for(let I=0;I<w.length;I++)w[I]=s.shape[u[I]];const y=ny(b,s.shape,s.dtype,u,w);h=n.makeTensorInfo(w,s.dtype);const C=n.texData.get(h.dataId);C.values=y}else h=Kp(s,u,n);c=Nn(c.length,a)}ii("max",c,a);const[p,m]=Yn(h.shape,c);let g=p;r&&(g=Rn(p,l));let v;if(f){const b=n.texData.get(h.dataId).values,w=Bse(b,pe(m),g,s.dtype);v=n.makeTensorInfo(g,s.dtype);const y=n.texData.get(v.dataId);y.values=w}else v=Aue(h,m,g,n);return d&&n.disposeIntermediateTensorInfo(h),v}const Oue={kernelName:Kf,backendName:"webgl",kernelFunc:BR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue=iy+`
  return max(a, b);
`,Mue=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ga+`
  return result;
`,Fue=si({opSnippet:Pue,packedOpSnippet:Mue,cpuKernelImpl:Vse}),Lue={kernelName:Ou,backendName:"webgl",kernelFunc:Fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zue(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e;wd(s,"maxPool");const{filterSize:o,strides:r,pad:a,dimRoundingMode:l}=i,c=1;F(pi(r,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const u=As(s.shape,o,r,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Wt(u.inShape,u.outShape))return Ji({inputs:{x:s},backend:n});const d=new Zc(u,"max",!1);return n.runWebGLProgram(d,[s],s.dtype)}const Bue={kernelName:Xf,backendName:"webgl",kernelFunc:zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vue(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{filterSize:o,strides:r,pad:a,dataFormat:l,dimRoundingMode:c}=i,u=[1,1,1],d=er(s.shape,o,r,u,a,c,l),f=new oy(d,"max",!1);return n.runWebGLProgram(f,[s],s.dtype)}const Wue={kernelName:qf,backendName:"webgl",kernelFunc:Vue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gue{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,o=e.effectiveFilterHeight,r=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=r-1-e.padInfo.left,c=o*r-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${r} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Hue{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,r=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,f=c-1-e.padInfo.top,h=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${r}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o}=e,r=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,d=[1,1,1],f=er(r.shape,a,l,d,c,u),h=new oy(f,"max",!0),p=n.runWebGLProgram(h,[r],r.dtype),m=new Hue(f),g=n.runWebGLProgram(m,[s,p],r.dtype);return n.disposeIntermediateTensorInfo(p),g}const jue={kernelName:Kx,backendName:"webgl",kernelFunc:Uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(t){const{inputs:e,backend:n,attrs:i}=t,{dy:s,input:o,output:r}=e,a=o;wd([o,r],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=i,f=As(a.shape,l,c,1,u,d),h=!0,p=new Zc(f,"max",h),m=n.runWebGLProgram(p,[a],a.dtype),g=new Gue(f),v=n.runWebGLProgram(g,[s,m],a.dtype);return n.disposeIntermediateTensorInfo(m),v}const Xue={kernelName:jx,backendName:"webgl",kernelFunc:Kue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(t,e,n,i){let s=new Zc(n,"max",!1);const o=i.runWebGLProgram(s,[t],"float32");s=new Zc(n,"max",!0,!0,e);const r=i.runWebGLProgram(s,[t],"float32");return[o,r]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yue={kernelName:xE,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:s,strides:o,pad:r,includeBatchInIndex:a}=e,l=n;F(i.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const c=[1,1];F(pi(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=As(i.shape,s,o,c,r),[d,f]=que(i,a,u,l);return[d,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jue(t,e,n,i){const s=pe(e),r=pe(t.shape)/s,a=Te({inputs:{x:t},attrs:{shape:[r,s]},backend:i}),l=Ha(a,"float32","mean",i),c=Te({inputs:{x:l},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue={kernelName:Yf,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{keepDims:s,axis:o}=e,r=n,a=i.shape.length,l=St(o,i.shape);let c=l;const u=mn(c,a),d=u!=null,f=r.shouldExecuteOnCPU([i]),h=[];let p=i;if(d){if(f){const w=r.texData.get(p.dataId).values,y=new Array(a);for(let $=0;$<y.length;$++)y[$]=i.shape[u[$]];const C=ny(w,i.shape,i.dtype,u,y);p=r.makeTensorInfo(y,i.dtype);const I=r.texData.get(p.dataId);I.values=C}else p=Kp(i,u,r);h.push(p),c=Nn(c.length,a)}ii("sum",c,a);const[m,g]=Yn(p.shape,c);let v=m;s&&(v=Rn(m,l));const x=Jue(p,g,v,r);for(const b of h)r.disposeIntermediateTensorInfo(b);return x}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i,a=s.shape.length,l=St(o,s.shape);let c=l;const u=mn(c,a);let d=s;u!=null&&(d=$i({inputs:{x:s},backend:n,attrs:{perm:u}}),c=Nn(c.length,s.shape.length)),ii("min",c,a);const[f,h]=Yn(d.shape,c),p=pe(h),m=Te({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=Ha(m,m.dtype,"min",n);let v;if(r){const x=Rn(f,l);v=Te({inputs:{x:g},backend:n,attrs:{shape:x}})}else v=Te({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),v}const ede={kernelName:Jf,backendName:"webgl",kernelFunc:Que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tde=iy+`
  return min(a, b);
`,nde=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ga+`
  return result;
`,ide=si({opSnippet:tde,packedOpSnippet:nde,cpuKernelImpl:Wse}),sde={kernelName:Pu,backendName:"webgl",kernelFunc:ide};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ode{constructor(e,n,i){this.variableNames=["x"],this.outputShape=n.map((u,d)=>u[0]+e[d]+u[1]);const s=e.length,o=qt(s),r=n.map(u=>u[0]).join(","),a=n.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),c=i==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${r};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${r});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rde{constructor(e,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const s=e.length,o=qt(s),r=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=wi("rc",s),c=wi("source",s),u=`${l[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${c.slice(-2).join()})`,f=i==="reflect"?0:1;let h="";if(s===1){const p=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;h=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[s-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const p=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;h=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[s-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[s-2]} += 1;
        if(${l[s-2]} < ${this.outputShape[s-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[s-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${r});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ade=({inputs:t,backend:e,attrs:n})=>{const{x:i}=t,{paddings:s,mode:o}=n,r=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rde(i.shape,s,o):new ode(i.shape,s,o);return e.runWebGLProgram(r,[i],i.dtype)},lde={kernelName:Zf,backendName:"webgl",kernelFunc:ade};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cde=`if (b == 0.0) return NAN;
  return mod(a, b);`,ude=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Ga+`
  return result;
`,dde=si({opSnippet:cde,packedOpSnippet:ude}),hde={kernelName:Mu,backendName:"webgl",kernelFunc:dde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fde{constructor(e,n,i){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,i],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pde=`
if (a == b) {
  return 1.0;
};
return a / b;`,mde=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,VR=si({opSnippet:pde,packedOpSnippet:mde,checkOutOfBounds:!0}),gde={kernelName:yu,backendName:"webgl",kernelFunc:VR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VS="return a - b;",WR=si({opSnippet:VS,packedOpSnippet:VS,supportsComplex:!0,cpuKernelImpl:coe}),vde={kernelName:Zu,backendName:"webgl",kernelFunc:WR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(t){const{inputs:e,backend:n,attrs:i}=t,{logits:s}=e,{dim:o}=i,r=St([o],s.shape),a=BR({inputs:{x:s},backend:n,attrs:{reductionIndices:r,keepDims:!1}}),l=Rn(a.shape,r),c=Te({inputs:{x:a},backend:n,attrs:{shape:l}}),u=WR({inputs:{a:s,b:c},backend:n}),d=FR({inputs:{x:u},backend:n}),f=Xp({inputs:{x:d},backend:n,attrs:{axis:r,keepDims:!1}}),h=Te({inputs:{x:f},backend:n,attrs:{shape:l}}),p=VR({inputs:{a:d,b:h},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),p}const xde={kernelName:gp,backendName:"webgl",kernelFunc:GR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bde(t){const{inputs:e,backend:n,attrs:i}=t,{logits:s}=e,{numSamples:o,seed:r,normalized:a}=i,l=a?s:GR({inputs:{logits:s},backend:n,attrs:{dim:s.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new fde(c,u,o),f=[[r]],h=n.runWebGLProgram(d,[l],"int32",f);return a||n.disposeIntermediateTensorInfo(l),h}const yde={kernelName:bE,backendName:"webgl",kernelFunc:bde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wde=Ps+`
  return -x;
`,Cde=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Sde(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])){const o=n.texData.get(i.dataId),[r,a]=Hse(o.values,i.shape,i.dtype);return n.makeTensorInfo(a,i.dtype,r)}let s;return le().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new hr(i.shape,Cde):s=new uo(i.shape,wde),n.runWebGLProgram(s,[i],i.dtype)}const Ide={kernelName:Qf,backendName:"webgl",kernelFunc:Sde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $de=G0;function Ede(t){ns("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:s,scores:o}=e,{maxOutputSize:r,iouThreshold:a,scoreThreshold:l}=i,c=n.readSync(s.dataId),u=n.readSync(o.dataId),{selectedIndices:d}=$de(c,u,r,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Nde={kernelName:Xx,backendName:"webgl",kernelFunc:Ede};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kde=H0;function Dde(t){ns("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:s,scores:o}=e,{maxOutputSize:r,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=i,u=n.readSync(s.dataId),d=n.readSync(o.dataId),{selectedIndices:f,validOutputs:h}=kde(u,d,r,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}const Tde={kernelName:qx,backendName:"webgl",kernelFunc:Dde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rde=U0;function _de(t){ns("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:s,scores:o}=e,{maxOutputSize:r,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=i,u=n.readSync(s.dataId),d=n.readSync(o.dataId),f=r,h=a,p=l,m=c,{selectedIndices:g,selectedScores:v}=Rde(u,d,f,h,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const Ade={kernelName:Yx,backendName:"webgl",kernelFunc:_de};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ode{constructor(e,n,i,s){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${i}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pde=t=>{const{inputs:e,backend:n,attrs:i}=t,{indices:s}=e,{dtype:o,depth:r,onValue:a,offValue:l}=i,c=pe(s.shape),u=new Ode(c,r,a,l),d=Te({inputs:{x:s},backend:n,attrs:{shape:[c]}}),f=n.runWebGLProgram(u,[d],o);n.disposeIntermediateTensorInfo(d);const h=[...s.shape,r],p=Te({inputs:{x:f},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(f),p},Mde={kernelName:np,backendName:"webgl",kernelFunc:Pde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ef(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="complex64"){const s=Sd({inputs:{input:i},backend:n}),o=ef({inputs:{x:s},backend:n}),r=qp({inputs:{input:i},backend:n}),a=ef({inputs:{x:r},backend:n}),l=zr({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),l}else return Id({attrs:{shape:i.shape,dtype:i.dtype,value:i.dtype==="string"?"":0},backend:n})}const Fde={kernelName:bp,backendName:"webgl",kernelFunc:ef};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HR(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(i.dtype==="complex64"){const s=Sd({inputs:{input:i},backend:n}),o=HR({inputs:{x:s},backend:n}),r=qp({inputs:{input:i},backend:n}),a=ef({inputs:{x:r},backend:n}),l=zr({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),l}else return Id({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:n})}const Lde={kernelName:tp,backendName:"webgl",kernelFunc:HR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zde(t){const{inputs:e,backend:n,attrs:i}=t,{axis:s}=i;if(e.length===1)return tv({inputs:{input:e[0]},backend:n,attrs:{dim:s}});const o=e[0].shape,r=e[0].dtype;e.forEach(u=>{vx(o,u.shape,"All tensors passed to stack must have matching shapes"),F(r===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=tv({inputs:{input:u},backend:n,attrs:{dim:s}});return a.push(d),d}),c=DR({inputs:l,backend:n,attrs:{axis:s}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const Bde={kernelName:ip,backendName:"webgl",kernelFunc:zde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vde{constructor(e,n,i){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const s=e.length,o=qt(s),r=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${r};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${r});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wde{constructor(e,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+e[g]+m[1]);const s=e.length,o=qt(s),r=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+e[g]).join(","),l=wi("rc",s),c=wi("source",s),u=`${l[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${l[s-1]} += 1;
       if(${u}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${l[s-2]} += 1;
       if(${l[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${l[s-1]} += 1;
         if(${u}) {`],h=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=s===1?2:4;m<g;m++)p+=`
        ${f[m]}
        if (${h}) {
          result[${m}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${d});
        }
      `;p+=s===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${r});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UR=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{paddings:o,constantValue:r}=i;if(pe(s.shape)===0){const c=o.map((u,d)=>u[0]+s.shape[d]+u[1]);return Id({backend:n,attrs:{shape:c,value:r,dtype:s.dtype}})}const a=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wde(s.shape,o,r):new Vde(s.shape,o,r),l=[[r]];return n.runWebGLProgram(a,[s],s.dtype,l)},Gde={kernelName:sp,backendName:"webgl",kernelFunc:UR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hde=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Ude=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Ga+`
  return result;
`,jde=si({opSnippet:Hde,packedOpSnippet:Ude}),Kde={kernelName:Lu,backendName:"webgl",kernelFunc:jde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xde(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{axis:o,keepDims:r}=i,a=s.shape.length,l=[],c=St(o,s.shape);let u=c;const d=mn(u,a);let f=s;d!=null&&(f=$i({inputs:{x:s},backend:n,attrs:{perm:d}}),u=Nn(u.length,a),l.push(f)),ii("prod",u,a);let h;if(n.shouldExecuteOnCPU([f])){const p=n.texData.get(f.dataId).values,{outVals:m,outShape:g,outDtype:v}=jse(f.shape,f.dtype,p,u);h=n.makeTensorInfo(g,v,m)}else{const[p,m]=Yn(f.shape,u),g=pe(m),v=Te({inputs:{x:f},backend:n,attrs:{shape:[-1,g]}}),x=c0(s.dtype),b=Ha(v,x,"prod",n);h=Te({inputs:{x:b},backend:n,attrs:{shape:p}}),l.push(v),l.push(b)}if(r){l.push(h);const p=Rn(h.shape,c);h=Te({inputs:{x:h},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),h}const qde={kernelName:rp,backendName:"webgl",kernelFunc:Xde};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(t){const{inputs:e,backend:n,attrs:i}=t,{paramsNestedSplits:s,paramsDenseValues:o,indices:r}=e,{outputRaggedRank:a}=i,l=s.map(v=>n.readSync(v.dataId)),c=s.map(v=>v.shape),u=n.readSync(o.dataId),d=n.readSync(r.dataId),[f,h,p]=Kse(l,c,u,o.shape,o.dtype,d,r.shape,a),m=f.map(v=>n.makeTensorInfo([v.length],"int32",v)),g=n.makeTensorInfo(p,o.dtype,h);return m.concat([g])}const Jde={kernelName:yE,backendName:"webgl",kernelFunc:Yde};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zde(t){const{inputs:e,backend:n}=t,{starts:i,limits:s,deltas:o}=e,r=n.readSync(i.dataId),a=n.readSync(s.dataId),l=n.readSync(o.dataId),[c,u]=Xse(r,i.shape,i.dtype,a,s.shape,l,o.shape),d=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([u.length],i.dtype,u);return[d,f]}const Qde={kernelName:wE,backendName:"webgl",kernelFunc:Zde};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ehe(t){const{inputs:e,backend:n,attrs:i}=t,{shape:s,values:o,defaultValue:r,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=i,c=n.readSync(s.dataId),u=n.readSync(o.dataId),d=n.readSync(r.dataId),f=a.map(g=>n.readSync(g.dataId)),h=a.map(g=>g.shape),[p,m]=qse(c,s.shape,u,o.shape,o.dtype,d,r.shape,f,h,l);return n.makeTensorInfo(p,o.dtype,m)}const the={kernelName:CE,backendName:"webgl",kernelFunc:ehe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jR=t=>{const{backend:e,attrs:n}=t,{start:i,stop:s,step:o,dtype:r}=n,a=Yse(i,s,o,r);return e.makeTensorInfo([a.length],r,a)},nhe={kernelName:Jx,backendName:"webgl",kernelFunc:jR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ihe="return 1.0 / x;",she=Ot({opSnippet:ihe}),ohe={kernelName:zu,backendName:"webgl",kernelFunc:she};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rhe=Ps+`
  return (x < 0.0) ? 0.0 : x;
`,ahe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lhe=Ot({opSnippet:rhe,packedOpSnippet:ahe}),che={kernelName:Bu,backendName:"webgl",kernelFunc:lhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uhe=Ps+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,dhe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hhe=Ot({opSnippet:uhe,packedOpSnippet:dhe}),fhe={kernelName:Vu,backendName:"webgl",kernelFunc:hhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class phe{constructor(e,n,i,s,o){this.variableNames=["A"],this.outputShape=[];const[r,a,l,c]=e;this.outputShape=[r,n,i,c];const u=[s&&n>1?a-1:a,s&&i>1?l-1:l],d=[s&&n>1?n-1:n,s&&i>1?i-1:i];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mhe{constructor(e,n,i,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[r,a,l,c]=e;this.outputShape=[r,n,i,c];const u=[s&&n>1?a-1:a,s&&i>1?l-1:l],d=[s&&n>1?n-1:n,s&&i>1?i-1:i];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${i-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ghe(t){const{inputs:e,backend:n,attrs:i}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:r,size:a}=i,[l,c]=a,u=le().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new mhe(s.shape,l,c,o,r):new phe(s.shape,l,c,o,r);return n.runWebGLProgram(u,[s],"float32")}const vhe={kernelName:cp,backendName:"webgl",kernelFunc:ghe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xhe{constructor(e,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,s,o]=n,[,r,a]=e,l=[i&&r>1?s-1:s,i&&a>1?o-1:o],c=[i&&r>1?r-1:r,i&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],f=1/u,h=1/d,p=Math.ceil(f)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${h});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${r}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bhe(t){const{inputs:e,backend:n,attrs:i}=t,{images:s,dy:o}=e,{alignCorners:r}=i,a=new xhe(o.shape,s.shape,r);return n.runWebGLProgram(a,[o],o.dtype)}const yhe={kernelName:e0,backendName:"webgl",kernelFunc:bhe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class whe{constructor(e,n,i,s,o){this.variableNames=["A"],this.outputShape=[];const[r,a,l,c]=e;this.outputShape=[r,n,i,c];const u=[s&&n>1?a-1:a,s&&i>1?l-1:l],d=[s&&n>1?n-1:n,s&&i>1?i-1:i],f=s?"0.5":"0.0";let h;o?h="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Che{constructor(e,n,i,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[r,a,l,c]=e;this.outputShape=[r,n,i,c];const u=[s&&n>1?a-1:a,s&&i>1?l-1:l],d=[s&&n>1?n-1:n,s&&i>1?i-1:i],f=s?"0.5":"0.0";let h;o?h="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${i-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(t){const{inputs:e,backend:n,attrs:i}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:r,size:a}=i,[l,c]=a,u=le().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Che(s.shape,l,c,o,r):new whe(s.shape,l,c,o,r);return n.runWebGLProgram(u,[s],s.dtype)}const Ihe={kernelName:lp,backendName:"webgl",kernelFunc:She};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $he{constructor(e,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,s,o]=n,[,r,a]=e,l=[i&&r>1?s-1:s,i&&a>1?o-1:o],c=[i&&r>1?r-1:r,i&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],f=1/u,h=1/d,p=Math.ceil(f)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${h});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${r}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${i} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${i} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(t){const{inputs:e,backend:n,attrs:i}=t,{images:s,dy:o}=e,{alignCorners:r}=i,a=new $he(o.shape,s.shape,r);return n.runWebGLProgram(a,[o],o.dtype)}const Nhe={kernelName:Qx,backendName:"webgl",kernelFunc:Ehe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class khe{constructor(e,n){this.variableNames=["x"];const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);if(this.outputShape=e,i===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>s(l)).join(","),r=qt(i);this.userCode=`
      void main() {
        ${r} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dhe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);this.outputShape=e;const s=wi("rc",i),o=`${s[i-1]} + 1 < ${this.outputShape[i-1]}`,r=`${s[i-2]} + 1 < ${this.outputShape[i-2]}`,a=qt(i);i===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(s.slice())};
          if(${o}){
            result.g = ${c(s.slice())};
          }
          if(${r}) {
            result.b = ${u(s.slice())};
            if(${o}) {
              result.a = ${d(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return f(p)}function c(p){return p[i-1]="("+p[i-1]+" + 1)",f(p)}function u(p){return p[i-2]="("+p[i-2]+" + 1)",f(p)}function d(p){return p[i-1]="("+p[i-1]+" + 1)",p[i-2]="("+p[i-2]+" + 1)",f(p)}function f(p){const m=e.map((x,b)=>h(b,p)),g=m.join(","),v=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${v}))`}function h(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function The(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{dims:o}=i,r=s.shape.length,a=St(o,s.shape);if(r===0)return Ji({inputs:{x:s},backend:n});const l=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Dhe(s.shape,a):new khe(s.shape,a);return n.runWebGLProgram(l,[s],s.dtype)}const Rhe={kernelName:up,backendName:"webgl",kernelFunc:The};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _he{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const i=e[1],s=e[2];this.outputShape=e;let o="";typeof n=="number"?o=`float outputValue = ${n.toFixed(2)};`:o=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${i}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ahe={kernelName:a0,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:s,fillValue:o,center:r}=e,a=n,l=new _he(i.shape,o),[c,u]=ib(r,i.shape[1],i.shape[2]),d=[[c,u,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(l,[i],i.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ohe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Phe=Ot({opSnippet:Ohe}),Mhe={kernelName:Wu,backendName:"webgl",kernelFunc:Phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fhe="return inversesqrt(x);",Lhe=Ot({opSnippet:Fhe,cpuKernelImpl:Jse}),zhe={kernelName:Gu,backendName:"webgl",kernelFunc:Lhe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ry{constructor(e,n,i,s,o,r,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=r;const c=qt(o.length),u=qt(r.length);let d="";i===1?d="i":i===2&&(d="i, j");const f=`getIndices(${d})`;let h="";s===1?h="i":s===2&&(h="i, coords[1]");const p=`getUpdates(${h})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${v};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bhe{constructor(e,n,i,s,o,r,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;const c=qt(o.length),u=qt(r.length);let d="";i===1?d="i":i===2&&(d="i, j");const f=`getIndices(${d})`;let h="";s===1?h="i":s===2&&(h="i, coords[1]");const p=`getUpdates(${h})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=n>1?"strides[j]":"strides",x=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${v};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vhe(t){const{inputs:e,backend:n,attrs:i}=t,{indices:s,updates:o}=e,{shape:r}=i,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=La(o,s,r),f=[d/c,c];if(d===0)return n.makeTensorInfo(r,s.dtype);const h=Te({inputs:{x:s},backend:n,attrs:{shape:[l,a]}}),p=Te({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;le().getBool("WEBGL_PACK")?g=new Bhe(l,a,h.shape.length,p.shape.length,u,f):g=new ry(l,a,h.shape.length,p.shape.length,u,f);const v=n.runWebGLProgram(g,[p,h,m],p.dtype),x=Te({inputs:{x:v},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),x}const Whe={kernelName:SE,backendName:"webgl",kernelFunc:Vhe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ghe{constructor(e,n,i,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,i];const o="while (left < right) {",r=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=le().getNumber("WEBGL_VERSION")===2?o:r,l=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hhe(t){const{inputs:e,backend:n,attrs:i}=t,{sortedSequence:s,values:o}=e,{side:r}=i,a=new Ghe(s.shape[0],s.shape[1],o.shape[1],r),l=[[s.shape[1]]];return n.runWebGLProgram(a,[s,o],"int32",l)}const Uhe={kernelName:$E,backendName:"webgl",kernelFunc:Hhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jhe{constructor(e,n,i){this.variableNames=["c","a","b"],this.outputShape=n;let s,o;if(i>4)throw Error(`Where for rank ${i} is not yet supported`);if(i===1)o="resRC",s="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);s=l.join(),o=c.join()}const r=qt(i);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Khe(t){const{inputs:e,backend:n}=t,{condition:i,t:s,e:o}=e,r=new jhe(i.shape.length,s.shape,s.shape.length);return n.runWebGLProgram(r,[i,s,o],qi(s.dtype,o.dtype))}const Xhe={kernelName:dp,backendName:"webgl",kernelFunc:Khe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qhe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Rp};
  float scale = ${_p};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Yhe=Ot({opSnippet:qhe}),Jhe={kernelName:Hu,backendName:"webgl",kernelFunc:Yhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zhe=uc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Qhe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,efe=Ot({opSnippet:Zhe,packedOpSnippet:Qhe,cpuKernelImpl:Qse}),tfe={kernelName:Xu,backendName:"webgl",kernelFunc:efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nfe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,ife=Ot({opSnippet:nfe}),sfe={kernelName:Ku,backendName:"webgl",kernelFunc:ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ofe=uc+`
  return sin(x);
`,rfe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Ga}
  return result;
`,afe=Ot({opSnippet:ofe,packedOpSnippet:rfe}),lfe={kernelName:Uu,backendName:"webgl",kernelFunc:afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cfe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,ufe=Ot({opSnippet:cfe}),dfe={kernelName:ju,backendName:"webgl",kernelFunc:ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hfe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ffe=Ot({opSnippet:hfe}),pfe={kernelName:qu,backendName:"webgl",kernelFunc:ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mfe=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{blockShape:o,paddings:r}=i;F(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((v,x)=>v*x),l=[[0,0]];l.push(...r);for(let v=1+o.length;v<s.shape.length;++v)l.push([0,0]);const c=[],u=UR({inputs:{x:s},backend:n,attrs:{paddings:l,constantValue:0}}),d=ld(u.shape,o,a,!1),f=cd(d.length,o.length,!1),h=ud(u.shape,o,a,!1),p=Te({inputs:{x:u},backend:n,attrs:{shape:d}}),m=$i({inputs:{x:p},backend:n,attrs:{perm:f}}),g=Te({inputs:{x:m},backend:n,attrs:{shape:h}});return c.push(u),c.push(p),c.push(m),c.forEach(v=>n.disposeIntermediateTensorInfo(v)),g},gfe={kernelName:pp,backendName:"webgl",kernelFunc:mfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vfe(t){const{inputs:e,backend:n}=t,{indices:i,values:s,denseShape:o,defaultValue:r}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${i.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${r.shape}`);const a=n.readSync(i.dataId),l=n.readSync(s.dataId),c=n.readSync(o.dataId),u=n.readSync(r.dataId)[0],[d,f,h,p,m]=toe(a,i.shape,i.dtype,l,s.dtype,c,u);return[n.makeTensorInfo(f,i.dtype,d),n.makeTensorInfo([f[0]],s.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}const xfe={kernelName:EE,backendName:"webgl",kernelFunc:vfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(t){const{inputs:e,backend:n}=t,{inputIndices:i,inputShape:s,newShape:o}=e;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const r=Array.from(n.readSync(s.dataId)),a=n.readSync(i.dataId),l=Array.from(n.readSync(o.dataId)),[c,u,d]=noe(a,i.shape,i.dtype,r,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const yfe={kernelName:NE,backendName:"webgl",kernelFunc:bfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wfe(t){const{inputs:e,backend:n}=t,{data:i,indices:s,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const r=n.readSync(i.dataId),a=n.readSync(s.dataId),l=n.readSync(o.dataId),[c,u]=gR(r,i.shape,i.dtype,a,l,!0);return n.makeTensorInfo(u,i.dtype,c)}const Cfe={kernelName:kE,backendName:"webgl",kernelFunc:wfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sfe(t){const{inputs:e,backend:n}=t,{data:i,indices:s,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const r=n.readSync(i.dataId),a=n.readSync(s.dataId),l=n.readSync(o.dataId),[c,u]=gR(r,i.shape,i.dtype,a,l);return n.makeTensorInfo(u,i.dtype,c)}const Ife={kernelName:DE,backendName:"webgl",kernelFunc:Sfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $fe(t){const{inputs:e,backend:n,attrs:i}=t,{sparseIndices:s,sparseValues:o,defaultValue:r}=e,{outputShape:a}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:f}=La(o,s,a),h=!1;if(o.dtype==="string"){const v=n.bufferSync(s),x=n.bufferSync(o),b=Cr(n.readSync(r.dataId)[0]),w=Zse(v,x,a,f,u,c,l,d,b,h);return n.makeTensorInfo(a,w.dtype,w.values)}const p=new ry(c,l,s.shape.length,o.shape.length,d,[f,1],h),m=n.runWebGLProgram(p,[o,s,r],o.dtype),g=Te({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),g}const Efe={kernelName:TE,backendName:"webgl",kernelFunc:$fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{numOrSizeSplits:o,axis:r}=i,a=St(r,s.shape)[0],l=xb(s,o,a),c=s.shape.length,u=new Array(c).fill(0),d=s.shape.slice();return l.map(f=>{const h=[...d];h[a]=f;const p=dc({inputs:{x:s},backend:n,attrs:{begin:u,size:h}});return u[a]+=f,p})}const kfe={kernelName:mp,backendName:"webgl",kernelFunc:Nfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WS="return sqrt(x);",Dfe=Ot({opSnippet:WS,packedOpSnippet:WS,cpuKernelImpl:ioe}),Tfe={kernelName:Yu,backendName:"webgl",kernelFunc:Dfe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rfe="return x * x;",_fe=Ot({opSnippet:Rfe}),Afe={kernelName:t0,backendName:"webgl",kernelFunc:_fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GS="return (a - b) * (a - b);",Ofe=si({opSnippet:GS,packedOpSnippet:GS}),Pfe={kernelName:Ju,backendName:"webgl",kernelFunc:Ofe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mfe(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const o=n.readSync(s.dataId),r=qo(o),a=soe(r,"string",i);return n.makeTensorInfo(s.shape,"string",a)}const Ffe={kernelName:n0,backendName:"webgl",kernelFunc:Mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lfe({inputs:t,attrs:e,backend:n}){const{x:i}=t,s=Ps+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new uo(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const zfe={kernelName:nd,backendName:"webgl",kernelFunc:Lfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bfe{constructor(e,n,i){this.variableNames=["x"],this.outputShape=i;const s=i.length,o=qt(i.length),r=qt(i.length);let a="";if(s===1)a="coords * strides + begin";else{let l=0;a=i.map((c,u)=>(l++,i.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${n});

      void main() {
        ${r} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vfe(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{begin:o,end:r,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:f}=i,{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:x,end:b,strides:w}=eb(s.shape,o,r,a,l,c,u,d,f);let y;if(m)y=Te({inputs:{x:s},backend:n,attrs:{shape:p}});else if(g||v){F(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const I=J0(x,b,w),$=dc({inputs:{x:s},backend:n,attrs:{begin:x,size:I}});y=Te({inputs:{x:$},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo($)}else if(n.shouldExecuteOnCPU([s])){const $=n.readSync(s.dataId),E=Ct(s.shape,s.dtype,$),N=ooe(h,E,w,x);y=n.makeTensorInfo(p,s.dtype,N.values)}else{const $=new Bfe(x,w,h);y=n.runWebGLProgram($,[s],s.dtype)}const C=Te({inputs:{x:y},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(y),C}const Wfe={kernelName:i0,backendName:"webgl",kernelFunc:Vfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gfe(t){const{inputs:e,backend:n,attrs:i}=t,{separator:s,nGramWidths:o,leftPad:r,rightPad:a,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:d}=e,f=n.readSync(u.dataId),h=n.readSync(d.dataId),[p,m]=roe(f,h,s,o,r,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const Hfe={kernelName:RE,backendName:"webgl",kernelFunc:Gfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ufe(t){const{inputs:e,backend:n,attrs:i}=t,{skipEmpty:s}=i,{input:o,delimiter:r}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(r.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${r.shape}`);const a=n.readSync(o.dataId),l=n.readSync(r.dataId)[0],[c,u,d]=aoe(a,l,s),f=u.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const jfe={kernelName:_E,backendName:"webgl",kernelFunc:Ufe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kfe(t){const{inputs:e,backend:n,attrs:i}=t,{numBuckets:s}=i,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const r=n.readSync(o.dataId),a=loe(r,s);return n.makeTensorInfo(o.shape,"int32",a)}const Xfe={kernelName:AE,backendName:"webgl",kernelFunc:Kfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qfe="return tan(x);",Yfe=Ot({opSnippet:qfe}),Jfe={kernelName:Qu,backendName:"webgl",kernelFunc:Yfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zfe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Qfe=Ot({opSnippet:Zfe}),epe={kernelName:ed,backendName:"webgl",kernelFunc:Qfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tpe(t){const{inputs:e,backend:n,attrs:i}=t,{tensor:s,indices:o,updates:r}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=La(r,o,s.shape),f=[d/c,c];if(d===0)return n.makeTensorInfo(s.shape,o.dtype);const h=Te({inputs:{x:o},backend:n,attrs:{shape:[l,a]}}),p=Te({inputs:{x:r},backend:n,attrs:{shape:[l,c]}}),m=Te({inputs:{x:s},backend:n,attrs:{shape:f}}),g=new ry(l,a,h.shape.length,p.shape.length,u,f,!1,!0),v=n.runWebGLProgram(g,[p,h,m],m.dtype),x=Te({inputs:{x:v},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),x}const npe={kernelName:IE,backendName:"webgl",kernelFunc:tpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ipe{constructor(e,n){this.variableNames=["A"];const i=new Array(e.length);for(let r=0;r<i.length;r++)i[r]=e[r]*n[r];this.outputShape=i,this.rank=i.length;const s=qt(this.rank),o=spe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function spe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let s=0;s<t.length;s++)i.push(`imod(${n[s]}, ${t[s]})`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{reps:o}=i;if(s.dtype==="string"||s.shape.length>5){const l=n.readSync(s.dataId),c=s.dtype==="string"?l.map(f=>Cr(f)):l,u=Ct(s.shape,s.dtype,c),d=uoe(u,o);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const r=new ipe(s.shape,o);return n.runWebGLProgram(r,[s],s.dtype)}const ope={kernelName:td,backendName:"webgl",kernelFunc:KR};class rpe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class ape{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ur(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function HS(t){let e=1;for(;e<t;)e*=2;return e}function lpe(t){const{inputs:e,backend:n,attrs:i}=t,{x:s}=e,{k:o,sorted:r}=i,a=le().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=le().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=s.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([s])||u<a||o>l){const N=n.readSync(s.dataId),[k,D]=doe(N,c,s.dtype,o,r);return[n.makeTensorInfo(k.shape,k.dtype,k.values),n.makeTensorInfo(D.shape,D.dtype,D.values)]}if(o===0)return c[c.length-1]=0,[n.makeTensorInfo(c,s.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[s,Id({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(s.dataId),f=d!==null&&d.isPacked,h=f?n.unpackTensor(s):s,m=pe(c)/u,g=Te({inputs:{x:h},attrs:{shape:[m,u]},backend:n});f&&Ur(n,h);const v=HS(o),x=HS(u);let b=null;const w=()=>b===null?[g,g]:[g,b],y=(N,k,D)=>{const _=w(),R=new rpe(D),A=[[u],[b===null?1:0],[Number.NEGATIVE_INFINITY],[N],[k]],O=b;b=n.runWebGLProgram(R,_,"int32",A),Ur(n,O)};for(let N=1;N<v;N*=2){const k=N*2;for(let D=N;D>=1;D/=2)y(k,D,[m,x])}for(let N=x;N>v;N/=2){const k=w(),D=new ape([m,N/2]),R=[[u],[b===null?1:0],[v]],T=b;b=n.runWebGLProgram(D,k,"int32",R),Ur(n,T);const A=v/2,O=A*2;for(let P=A;P>=1;P/=2)y(O,P,b.shape)}let C=b;b=dc({inputs:{x:b},backend:n,attrs:{begin:0,size:[m,o]}}),Ur(n,C);let I=zR({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});Ur(n,g);const $=c.slice(0,-1);$.push(o),C=b,b=Te({inputs:{x:b},attrs:{shape:$},backend:n}),Ur(n,C);const E=I;return I=Te({inputs:{x:I},attrs:{shape:$},backend:n}),Ur(n,E),[I,b]}const cpe={kernelName:s0,backendName:"webgl",kernelFunc:lpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class upe{constructor(e,n,i,s,o,r){this.variableNames=["Image","Transforms"],this.outputShape=r;const a=i==="nearest"?1:2;let l;switch(s){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dpe(t){const{inputs:e,backend:n,attrs:i}=t,{image:s,transforms:o}=e,{interpolation:r,fillMode:a,fillValue:l,outputShape:c}=i,[u,d,f,h]=s.shape,[p,m]=c??[d,f],g=[u,p,m,h],v=new upe(d,f,r,a,l,g);return n.runWebGLProgram(v,[s,o],"float32")}const hpe={kernelName:o0,backendName:"webgl",kernelFunc:dpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fpe(t){const{inputs:e,attrs:n,backend:i}=t,{axis:s}=n,{x:o}=e;wd(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const r=i.readSync(o.dataId),{outputValues:a,outputShape:l,indices:c}=hoe(r,s,o.shape,o.dtype);return[i.makeTensorInfo(l,o.dtype,a),i.makeTensorInfo([c.length],"int32",c)]}const ppe={kernelName:r0,backendName:"webgl",kernelFunc:fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mpe(t){const{inputs:e,backend:n,attrs:i}=t,{value:s}=e;let{axis:o}=i;o<0&&(o+=s.shape.length);const r=s,a=r.shape.length,l=s.shape[o],c=new Array(a-1);let u=0;for(let m=0;m<a;m++)m!==o&&(c[u++]=r.shape[m]);const d=[],f=new Array(a).fill(0),h=r.shape.slice();h[o]=1;const p=new Array(l);for(let m=0;m<p.length;m++){f[o]=m;const g=dc({inputs:{x:r},backend:n,attrs:{begin:f,size:h}}),v=Te({inputs:{x:g},backend:n,attrs:{shape:c}});p[m]=v,d.push(g)}return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const gpe={kernelName:vp,backendName:"webgl",kernelFunc:mpe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vpe{constructor(e,n){this.variableNames=["x","segmentIds"];const i=e.windowSize,s=e.batchSize,o=e.inSize,r=e.numSegments,a=r*Math.ceil(o/i);this.outputShape=[s,a];const l="0.0",c="sumValue",u=Math.floor(i/4)*4,d=i%4,f=`
        sumValue += dot(values, segFilter);
    `;let h="";o%i>0&&(h=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let p="";o%i>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${r})) * float(${i}));
        int currentSeg = int(mod(float(outIdx), float(${r})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xpe(t){const{inputs:e,backend:n,attrs:i}=t,{x:s,segmentIds:o}=e,{numSegments:r}=i,a=s.shape.length,l=[];let c=0;const u=mn([c],a);let d=s;u!=null&&(d=$i({inputs:{x:s},backend:n,attrs:{perm:u}}),l.push(d),c=Nn(1,a)[0]);const f=kN(d.shape,c,r),h=pe([d.shape[c]]),p=Te({inputs:{x:d},backend:n,attrs:{shape:[-1,h]}});l.push(p);const m=c0(s.dtype),g=(w,y,C,I,$)=>{const E=w.shape[0],N=w.shape[1],k=NN(N,$),D={windowSize:k,inSize:N,batchSize:E,numSegments:$},_=new vpe(D,y),R=n.compileAndRun(_,[w,C],I);if(l.push(R),R.shape[1]===$)return R;const T=jR({backend:n,attrs:{start:0,stop:$,step:1,dtype:"float32"}}),A=KR({inputs:{x:T},backend:n,attrs:{reps:[N/k]}});return l.push(T),l.push(A),g(R,y,A,I,$)},v=g(p,"unsortedSegmentSum",o,m,r),x=Te({inputs:{x:v},backend:n,attrs:{shape:f}});let b=x;if(u!=null){l.push(x);const w=Ar(u);b=$i({inputs:{x:b},backend:n,attrs:{perm:w}})}return l.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}const bpe={kernelName:xp,backendName:"webgl",kernelFunc:xpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ype=[ire,ore,lre,dre,fre,gre,xre,yre,Ire,Ere,Dre,_re,Pre,zre,Wre,Hre,jre,Yre,Zre,eae,sae,dae,fae,vae,bae,$ae,Nae,Rae,Boe,Oae,zae,Gae,qae,Zae,ele,nle,sle,lle,dle,ple,gle,xle,yle,Sle,$le,Dle,Rle,Ole,Fle,zle,Gle,Kle,Jle,ece,ice,sce,rce,lce,uce,hce,pce,xce,wce,Ice,Ece,Dce,_ce,Mce,Bce,zoe,Wce,Fae,Uce,Xce,Jce,Woe,tue,oue,aue,due,pue,xue,wue,$ue,Due,_ue,Oue,Lue,Bue,Wue,jue,Xue,Yue,Zue,ede,sde,lde,hde,yde,Uoe,Ide,Nde,Tde,Ade,wae,Mde,Lde,Bde,Gde,Kde,Hoe,qde,Jde,Qde,the,nhe,Cae,gde,ohe,che,fhe,Koe,vhe,yhe,Ihe,Nhe,Rhe,Ahe,Mhe,zhe,Whe,Uhe,Xhe,Jhe,tfe,sfe,lfe,dfe,cae,xde,pfe,gfe,xfe,yfe,Cfe,Ife,Efe,kfe,Tfe,Afe,Pfe,Ffe,zfe,Wfe,Hfe,jfe,Xfe,vde,ere,Jfe,epe,npe,ope,cpe,hpe,tre,ppe,gpe,bpe,Fde];for(const t of ype)PE(t);var XR={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(t,e){(function(i,s){t.exports=s()})(po,function(){return function(n){var i={};function s(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=n,s.c=i,s.d=function(o,r,a){s.o(o,r)||Object.defineProperty(o,r,{enumerable:!0,get:a})},s.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.t=function(o,r){if(r&1&&(o=s(o)),r&8||r&4&&typeof o=="object"&&o&&o.__esModule)return o;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:o}),r&2&&typeof o!="string")for(var l in o)s.d(a,l,(function(c){return o[c]}).bind(null,l));return a},s.n=function(o){var r=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(r,"a",r),r},s.o=function(o,r){return Object.prototype.hasOwnProperty.call(o,r)},s.p="",s(s.s=20)}([function(n,i){var s={};n.exports=s,function(){s._baseDelta=1e3/60,s._nextId=0,s._seed=0,s._nowStartTime=+new Date,s._warnedOnce={},s._decomp=null,s.extend=function(r,a){var l,c;typeof a=="boolean"?(l=2,c=a):(l=1,c=!0);for(var u=l;u<arguments.length;u++){var d=arguments[u];if(d)for(var f in d)c&&d[f]&&d[f].constructor===Object&&(!r[f]||r[f].constructor===Object)?(r[f]=r[f]||{},s.extend(r[f],c,d[f])):r[f]=d[f]}return r},s.clone=function(r,a){return s.extend({},a,r)},s.keys=function(r){if(Object.keys)return Object.keys(r);var a=[];for(var l in r)a.push(l);return a},s.values=function(r){var a=[];if(Object.keys){for(var l=Object.keys(r),c=0;c<l.length;c++)a.push(r[l[c]]);return a}for(var u in r)a.push(r[u]);return a},s.get=function(r,a,l,c){a=a.split(".").slice(l,c);for(var u=0;u<a.length;u+=1)r=r[a[u]];return r},s.set=function(r,a,l,c,u){var d=a.split(".").slice(c,u);return s.get(r,a,0,-1)[d[d.length-1]]=l,l},s.shuffle=function(r){for(var a=r.length-1;a>0;a--){var l=Math.floor(s.random()*(a+1)),c=r[a];r[a]=r[l],r[l]=c}return r},s.choose=function(r){return r[Math.floor(s.random()*r.length)]},s.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},s.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},s.isFunction=function(r){return typeof r=="function"},s.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},s.isString=function(r){return toString.call(r)==="[object String]"},s.clamp=function(r,a,l){return r<a?a:r>l?l:r},s.sign=function(r){return r<0?-1:1},s.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-s._nowStartTime},s.random=function(r,a){return r=typeof r<"u"?r:0,a=typeof a<"u"?a:1,r+o()*(a-r)};var o=function(){return s._seed=(s._seed*9301+49297)%233280,s._seed/233280};s.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},s.logLevel=1,s.log=function(){console&&s.logLevel>0&&s.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},s.info=function(){console&&s.logLevel>0&&s.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},s.warn=function(){console&&s.logLevel>0&&s.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},s.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");s._warnedOnce[r]||(s.warn(r),s._warnedOnce[r]=!0)},s.deprecated=function(r,a,l){r[a]=s.chain(function(){s.warnOnce("🔅 deprecated 🔅",l)},r[a])},s.nextId=function(){return s._nextId++},s.indexOf=function(r,a){if(r.indexOf)return r.indexOf(a);for(var l=0;l<r.length;l++)if(r[l]===a)return l;return-1},s.map=function(r,a){if(r.map)return r.map(a);for(var l=[],c=0;c<r.length;c+=1)l.push(a(r[c]));return l},s.topologicalSort=function(r){var a=[],l=[],c=[];for(var u in r)!l[u]&&!c[u]&&s._topologicalSort(u,l,c,r,a);return a},s._topologicalSort=function(r,a,l,c,u){var d=c[r]||[];l[r]=!0;for(var f=0;f<d.length;f+=1){var h=d[f];l[h]||a[h]||s._topologicalSort(h,a,l,c,u)}l[r]=!1,a[r]=!0,u.push(r)},s.chain=function(){for(var r=[],a=0;a<arguments.length;a+=1){var l=arguments[a];l._chained?r.push.apply(r,l._chained):r.push(l)}var c=function(){for(var u,d=new Array(arguments.length),f=0,h=arguments.length;f<h;f++)d[f]=arguments[f];for(f=0;f<r.length;f+=1){var p=r[f].apply(u,d);typeof p<"u"&&(u=p)}return u};return c._chained=r,c},s.chainPathBefore=function(r,a,l){return s.set(r,a,s.chain(l,s.get(r,a)))},s.chainPathAfter=function(r,a,l){return s.set(r,a,s.chain(s.get(r,a),l))},s.setDecomp=function(r){s._decomp=r},s.getDecomp=function(){var r=s._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof po<"u"&&(r=po.decomp)}catch{r=null}return r}}()},function(n,i){var s={};n.exports=s,function(){s.create=function(o){var r={min:{x:0,y:0},max:{x:0,y:0}};return o&&s.update(r,o),r},s.update=function(o,r,a){o.min.x=1/0,o.max.x=-1/0,o.min.y=1/0,o.max.y=-1/0;for(var l=0;l<r.length;l++){var c=r[l];c.x>o.max.x&&(o.max.x=c.x),c.x<o.min.x&&(o.min.x=c.x),c.y>o.max.y&&(o.max.y=c.y),c.y<o.min.y&&(o.min.y=c.y)}a&&(a.x>0?o.max.x+=a.x:o.min.x+=a.x,a.y>0?o.max.y+=a.y:o.min.y+=a.y)},s.contains=function(o,r){return r.x>=o.min.x&&r.x<=o.max.x&&r.y>=o.min.y&&r.y<=o.max.y},s.overlaps=function(o,r){return o.min.x<=r.max.x&&o.max.x>=r.min.x&&o.max.y>=r.min.y&&o.min.y<=r.max.y},s.translate=function(o,r){o.min.x+=r.x,o.max.x+=r.x,o.min.y+=r.y,o.max.y+=r.y},s.shift=function(o,r){var a=o.max.x-o.min.x,l=o.max.y-o.min.y;o.min.x=r.x,o.max.x=r.x+a,o.min.y=r.y,o.max.y=r.y+l}}()},function(n,i){var s={};n.exports=s,function(){s.create=function(o,r){return{x:o||0,y:r||0}},s.clone=function(o){return{x:o.x,y:o.y}},s.magnitude=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},s.magnitudeSquared=function(o){return o.x*o.x+o.y*o.y},s.rotate=function(o,r,a){var l=Math.cos(r),c=Math.sin(r);a||(a={});var u=o.x*l-o.y*c;return a.y=o.x*c+o.y*l,a.x=u,a},s.rotateAbout=function(o,r,a,l){var c=Math.cos(r),u=Math.sin(r);l||(l={});var d=a.x+((o.x-a.x)*c-(o.y-a.y)*u);return l.y=a.y+((o.x-a.x)*u+(o.y-a.y)*c),l.x=d,l},s.normalise=function(o){var r=s.magnitude(o);return r===0?{x:0,y:0}:{x:o.x/r,y:o.y/r}},s.dot=function(o,r){return o.x*r.x+o.y*r.y},s.cross=function(o,r){return o.x*r.y-o.y*r.x},s.cross3=function(o,r,a){return(r.x-o.x)*(a.y-o.y)-(r.y-o.y)*(a.x-o.x)},s.add=function(o,r,a){return a||(a={}),a.x=o.x+r.x,a.y=o.y+r.y,a},s.sub=function(o,r,a){return a||(a={}),a.x=o.x-r.x,a.y=o.y-r.y,a},s.mult=function(o,r){return{x:o.x*r,y:o.y*r}},s.div=function(o,r){return{x:o.x/r,y:o.y/r}},s.perp=function(o,r){return r=r===!0?-1:1,{x:r*-o.y,y:r*o.x}},s.neg=function(o){return{x:-o.x,y:-o.y}},s.angle=function(o,r){return Math.atan2(r.y-o.y,r.x-o.x)},s._temp=[s.create(),s.create(),s.create(),s.create(),s.create(),s.create()]}()},function(n,i,s){var o={};n.exports=o;var r=s(2),a=s(0);(function(){o.create=function(l,c){for(var u=[],d=0;d<l.length;d++){var f=l[d],h={x:f.x,y:f.y,index:d,body:c,isInternal:!1};u.push(h)}return u},o.fromPath=function(l,c){var u=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,d=[];return l.replace(u,function(f,h,p){d.push({x:parseFloat(h),y:parseFloat(p)})}),o.create(d,c)},o.centre=function(l){for(var c=o.area(l,!0),u={x:0,y:0},d,f,h,p=0;p<l.length;p++)h=(p+1)%l.length,d=r.cross(l[p],l[h]),f=r.mult(r.add(l[p],l[h]),d),u=r.add(u,f);return r.div(u,6*c)},o.mean=function(l){for(var c={x:0,y:0},u=0;u<l.length;u++)c.x+=l[u].x,c.y+=l[u].y;return r.div(c,l.length)},o.area=function(l,c){for(var u=0,d=l.length-1,f=0;f<l.length;f++)u+=(l[d].x-l[f].x)*(l[d].y+l[f].y),d=f;return c?u/2:Math.abs(u)/2},o.inertia=function(l,c){for(var u=0,d=0,f=l,h,p,m=0;m<f.length;m++)p=(m+1)%f.length,h=Math.abs(r.cross(f[p],f[m])),u+=h*(r.dot(f[p],f[p])+r.dot(f[p],f[m])+r.dot(f[m],f[m])),d+=h;return c/6*(u/d)},o.translate=function(l,c,u){u=typeof u<"u"?u:1;var d=l.length,f=c.x*u,h=c.y*u,p;for(p=0;p<d;p++)l[p].x+=f,l[p].y+=h;return l},o.rotate=function(l,c,u){if(c!==0){var d=Math.cos(c),f=Math.sin(c),h=u.x,p=u.y,m=l.length,g,v,x,b;for(b=0;b<m;b++)g=l[b],v=g.x-h,x=g.y-p,g.x=h+(v*d-x*f),g.y=p+(v*f+x*d);return l}},o.contains=function(l,c){for(var u=c.x,d=c.y,f=l.length,h=l[f-1],p,m=0;m<f;m++){if(p=l[m],(u-h.x)*(p.y-h.y)+(d-h.y)*(h.x-p.x)>0)return!1;h=p}return!0},o.scale=function(l,c,u,d){if(c===1&&u===1)return l;d=d||o.centre(l);for(var f,h,p=0;p<l.length;p++)f=l[p],h=r.sub(f,d),l[p].x=d.x+h.x*c,l[p].y=d.y+h.y*u;return l},o.chamfer=function(l,c,u,d,f){typeof c=="number"?c=[c]:c=c||[8],u=typeof u<"u"?u:-1,d=d||2,f=f||14;for(var h=[],p=0;p<l.length;p++){var m=l[p-1>=0?p-1:l.length-1],g=l[p],v=l[(p+1)%l.length],x=c[p<c.length?p:c.length-1];if(x===0){h.push(g);continue}var b=r.normalise({x:g.y-m.y,y:m.x-g.x}),w=r.normalise({x:v.y-g.y,y:g.x-v.x}),y=Math.sqrt(2*Math.pow(x,2)),C=r.mult(a.clone(b),x),I=r.normalise(r.mult(r.add(b,w),.5)),$=r.sub(g,r.mult(I,y)),E=u;u===-1&&(E=Math.pow(x,.32)*1.75),E=a.clamp(E,d,f),E%2===1&&(E+=1);for(var N=Math.acos(r.dot(b,w)),k=N/E,D=0;D<E;D++)h.push(r.add(r.rotate(C,k*D),$))}return h},o.clockwiseSort=function(l){var c=o.mean(l);return l.sort(function(u,d){return r.angle(c,u)-r.angle(c,d)}),l},o.isConvex=function(l){var c=0,u=l.length,d,f,h,p;if(u<3)return null;for(d=0;d<u;d++)if(f=(d+1)%u,h=(d+2)%u,p=(l[f].x-l[d].x)*(l[h].y-l[f].y),p-=(l[f].y-l[d].y)*(l[h].x-l[f].x),p<0?c|=1:p>0&&(c|=2),c===3)return!1;return c!==0?!0:null},o.hull=function(l){var c=[],u=[],d,f;for(l=l.slice(0),l.sort(function(h,p){var m=h.x-p.x;return m!==0?m:h.y-p.y}),f=0;f<l.length;f+=1){for(d=l[f];u.length>=2&&r.cross3(u[u.length-2],u[u.length-1],d)<=0;)u.pop();u.push(d)}for(f=l.length-1;f>=0;f-=1){for(d=l[f];c.length>=2&&r.cross3(c[c.length-2],c[c.length-1],d)<=0;)c.pop();c.push(d)}return c.pop(),u.pop(),c.concat(u)}})()},function(n,i,s){var o={};n.exports=o;var r=s(3),a=s(2),l=s(7),c=s(0),u=s(1),d=s(11);(function(){o._timeCorrection=!0,o._inertiaScale=4,o._nextCollidingGroupId=1,o._nextNonCollidingGroupId=-1,o._nextCategory=1,o._baseDelta=1e3/60,o.create=function(h){var p={id:c.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},m=c.extend(p,h);return f(m,h),m},o.nextGroup=function(h){return h?o._nextNonCollidingGroupId--:o._nextCollidingGroupId++},o.nextCategory=function(){return o._nextCategory=o._nextCategory<<1,o._nextCategory};var f=function(h,p){p=p||{},o.set(h,{bounds:h.bounds||u.create(h.vertices),positionPrev:h.positionPrev||a.clone(h.position),anglePrev:h.anglePrev||h.angle,vertices:h.vertices,parts:h.parts||[h],isStatic:h.isStatic,isSleeping:h.isSleeping,parent:h.parent||h}),r.rotate(h.vertices,h.angle,h.position),d.rotate(h.axes,h.angle),u.update(h.bounds,h.vertices,h.velocity),o.set(h,{axes:p.axes||h.axes,area:p.area||h.area,mass:p.mass||h.mass,inertia:p.inertia||h.inertia});var m=h.isStatic?"#14151f":c.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),g=h.isStatic?"#555":"#ccc",v=h.isStatic&&h.render.fillStyle===null?1:0;h.render.fillStyle=h.render.fillStyle||m,h.render.strokeStyle=h.render.strokeStyle||g,h.render.lineWidth=h.render.lineWidth||v,h.render.sprite.xOffset+=-(h.bounds.min.x-h.position.x)/(h.bounds.max.x-h.bounds.min.x),h.render.sprite.yOffset+=-(h.bounds.min.y-h.position.y)/(h.bounds.max.y-h.bounds.min.y)};o.set=function(h,p,m){var g;typeof p=="string"&&(g=p,p={},p[g]=m);for(g in p)if(Object.prototype.hasOwnProperty.call(p,g))switch(m=p[g],g){case"isStatic":o.setStatic(h,m);break;case"isSleeping":l.set(h,m);break;case"mass":o.setMass(h,m);break;case"density":o.setDensity(h,m);break;case"inertia":o.setInertia(h,m);break;case"vertices":o.setVertices(h,m);break;case"position":o.setPosition(h,m);break;case"angle":o.setAngle(h,m);break;case"velocity":o.setVelocity(h,m);break;case"angularVelocity":o.setAngularVelocity(h,m);break;case"speed":o.setSpeed(h,m);break;case"angularSpeed":o.setAngularSpeed(h,m);break;case"parts":o.setParts(h,m);break;case"centre":o.setCentre(h,m);break;default:h[g]=m}},o.setStatic=function(h,p){for(var m=0;m<h.parts.length;m++){var g=h.parts[m];p?(g.isStatic||(g._original={restitution:g.restitution,friction:g.friction,mass:g.mass,inertia:g.inertia,density:g.density,inverseMass:g.inverseMass,inverseInertia:g.inverseInertia}),g.restitution=0,g.friction=1,g.mass=g.inertia=g.density=1/0,g.inverseMass=g.inverseInertia=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.angularVelocity=0,g.speed=0,g.angularSpeed=0,g.motion=0):g._original&&(g.restitution=g._original.restitution,g.friction=g._original.friction,g.mass=g._original.mass,g.inertia=g._original.inertia,g.density=g._original.density,g.inverseMass=g._original.inverseMass,g.inverseInertia=g._original.inverseInertia,g._original=null),g.isStatic=p}},o.setMass=function(h,p){var m=h.inertia/(h.mass/6);h.inertia=m*(p/6),h.inverseInertia=1/h.inertia,h.mass=p,h.inverseMass=1/h.mass,h.density=h.mass/h.area},o.setDensity=function(h,p){o.setMass(h,p*h.area),h.density=p},o.setInertia=function(h,p){h.inertia=p,h.inverseInertia=1/h.inertia},o.setVertices=function(h,p){p[0].body===h?h.vertices=p:h.vertices=r.create(p,h),h.axes=d.fromVertices(h.vertices),h.area=r.area(h.vertices),o.setMass(h,h.density*h.area);var m=r.centre(h.vertices);r.translate(h.vertices,m,-1),o.setInertia(h,o._inertiaScale*r.inertia(h.vertices,h.mass)),r.translate(h.vertices,h.position),u.update(h.bounds,h.vertices,h.velocity)},o.setParts=function(h,p,m){var g;for(p=p.slice(0),h.parts.length=0,h.parts.push(h),h.parent=h,g=0;g<p.length;g++){var v=p[g];v!==h&&(v.parent=h,h.parts.push(v))}if(h.parts.length!==1){if(m=typeof m<"u"?m:!0,m){var x=[];for(g=0;g<p.length;g++)x=x.concat(p[g].vertices);r.clockwiseSort(x);var b=r.hull(x),w=r.centre(b);o.setVertices(h,b),r.translate(h.vertices,w)}var y=o._totalProperties(h);h.area=y.area,h.parent=h,h.position.x=y.centre.x,h.position.y=y.centre.y,h.positionPrev.x=y.centre.x,h.positionPrev.y=y.centre.y,o.setMass(h,y.mass),o.setInertia(h,y.inertia),o.setPosition(h,y.centre)}},o.setCentre=function(h,p,m){m?(h.positionPrev.x+=p.x,h.positionPrev.y+=p.y,h.position.x+=p.x,h.position.y+=p.y):(h.positionPrev.x=p.x-(h.position.x-h.positionPrev.x),h.positionPrev.y=p.y-(h.position.y-h.positionPrev.y),h.position.x=p.x,h.position.y=p.y)},o.setPosition=function(h,p,m){var g=a.sub(p,h.position);m?(h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.velocity.x=g.x,h.velocity.y=g.y,h.speed=a.magnitude(g)):(h.positionPrev.x+=g.x,h.positionPrev.y+=g.y);for(var v=0;v<h.parts.length;v++){var x=h.parts[v];x.position.x+=g.x,x.position.y+=g.y,r.translate(x.vertices,g),u.update(x.bounds,x.vertices,h.velocity)}},o.setAngle=function(h,p,m){var g=p-h.angle;m?(h.anglePrev=h.angle,h.angularVelocity=g,h.angularSpeed=Math.abs(g)):h.anglePrev+=g;for(var v=0;v<h.parts.length;v++){var x=h.parts[v];x.angle+=g,r.rotate(x.vertices,g,h.position),d.rotate(x.axes,g),u.update(x.bounds,x.vertices,h.velocity),v>0&&a.rotateAbout(x.position,g,h.position,x.position)}},o.setVelocity=function(h,p){var m=h.deltaTime/o._baseDelta;h.positionPrev.x=h.position.x-p.x*m,h.positionPrev.y=h.position.y-p.y*m,h.velocity.x=(h.position.x-h.positionPrev.x)/m,h.velocity.y=(h.position.y-h.positionPrev.y)/m,h.speed=a.magnitude(h.velocity)},o.getVelocity=function(h){var p=o._baseDelta/h.deltaTime;return{x:(h.position.x-h.positionPrev.x)*p,y:(h.position.y-h.positionPrev.y)*p}},o.getSpeed=function(h){return a.magnitude(o.getVelocity(h))},o.setSpeed=function(h,p){o.setVelocity(h,a.mult(a.normalise(o.getVelocity(h)),p))},o.setAngularVelocity=function(h,p){var m=h.deltaTime/o._baseDelta;h.anglePrev=h.angle-p*m,h.angularVelocity=(h.angle-h.anglePrev)/m,h.angularSpeed=Math.abs(h.angularVelocity)},o.getAngularVelocity=function(h){return(h.angle-h.anglePrev)*o._baseDelta/h.deltaTime},o.getAngularSpeed=function(h){return Math.abs(o.getAngularVelocity(h))},o.setAngularSpeed=function(h,p){o.setAngularVelocity(h,c.sign(o.getAngularVelocity(h))*p)},o.translate=function(h,p,m){o.setPosition(h,a.add(h.position,p),m)},o.rotate=function(h,p,m,g){if(!m)o.setAngle(h,h.angle+p,g);else{var v=Math.cos(p),x=Math.sin(p),b=h.position.x-m.x,w=h.position.y-m.y;o.setPosition(h,{x:m.x+(b*v-w*x),y:m.y+(b*x+w*v)},g),o.setAngle(h,h.angle+p,g)}},o.scale=function(h,p,m,g){var v=0,x=0;g=g||h.position;for(var b=0;b<h.parts.length;b++){var w=h.parts[b];r.scale(w.vertices,p,m,g),w.axes=d.fromVertices(w.vertices),w.area=r.area(w.vertices),o.setMass(w,h.density*w.area),r.translate(w.vertices,{x:-w.position.x,y:-w.position.y}),o.setInertia(w,o._inertiaScale*r.inertia(w.vertices,w.mass)),r.translate(w.vertices,{x:w.position.x,y:w.position.y}),b>0&&(v+=w.area,x+=w.inertia),w.position.x=g.x+(w.position.x-g.x)*p,w.position.y=g.y+(w.position.y-g.y)*m,u.update(w.bounds,w.vertices,h.velocity)}h.parts.length>1&&(h.area=v,h.isStatic||(o.setMass(h,h.density*v),o.setInertia(h,x))),h.circleRadius&&(p===m?h.circleRadius*=p:h.circleRadius=null)},o.update=function(h,p){p=(typeof p<"u"?p:1e3/60)*h.timeScale;var m=p*p,g=o._timeCorrection?p/(h.deltaTime||p):1,v=1-h.frictionAir*(p/c._baseDelta),x=(h.position.x-h.positionPrev.x)*g,b=(h.position.y-h.positionPrev.y)*g;h.velocity.x=x*v+h.force.x/h.mass*m,h.velocity.y=b*v+h.force.y/h.mass*m,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.position.x+=h.velocity.x,h.position.y+=h.velocity.y,h.deltaTime=p,h.angularVelocity=(h.angle-h.anglePrev)*v*g+h.torque/h.inertia*m,h.anglePrev=h.angle,h.angle+=h.angularVelocity;for(var w=0;w<h.parts.length;w++){var y=h.parts[w];r.translate(y.vertices,h.velocity),w>0&&(y.position.x+=h.velocity.x,y.position.y+=h.velocity.y),h.angularVelocity!==0&&(r.rotate(y.vertices,h.angularVelocity,h.position),d.rotate(y.axes,h.angularVelocity),w>0&&a.rotateAbout(y.position,h.angularVelocity,h.position,y.position)),u.update(y.bounds,y.vertices,h.velocity)}},o.updateVelocities=function(h){var p=o._baseDelta/h.deltaTime,m=h.velocity;m.x=(h.position.x-h.positionPrev.x)*p,m.y=(h.position.y-h.positionPrev.y)*p,h.speed=Math.sqrt(m.x*m.x+m.y*m.y),h.angularVelocity=(h.angle-h.anglePrev)*p,h.angularSpeed=Math.abs(h.angularVelocity)},o.applyForce=function(h,p,m){var g={x:p.x-h.position.x,y:p.y-h.position.y};h.force.x+=m.x,h.force.y+=m.y,h.torque+=g.x*m.y-g.y*m.x},o._totalProperties=function(h){for(var p={mass:0,area:0,inertia:0,centre:{x:0,y:0}},m=h.parts.length===1?0:1;m<h.parts.length;m++){var g=h.parts[m],v=g.mass!==1/0?g.mass:1;p.mass+=v,p.area+=g.area,p.inertia+=g.inertia,p.centre=a.add(p.centre,a.mult(g.position,v))}return p.centre=a.div(p.centre,p.mass),p}})()},function(n,i,s){var o={};n.exports=o;var r=s(0);(function(){o.on=function(a,l,c){for(var u=l.split(" "),d,f=0;f<u.length;f++)d=u[f],a.events=a.events||{},a.events[d]=a.events[d]||[],a.events[d].push(c);return c},o.off=function(a,l,c){if(!l){a.events={};return}typeof l=="function"&&(c=l,l=r.keys(a.events).join(" "));for(var u=l.split(" "),d=0;d<u.length;d++){var f=a.events[u[d]],h=[];if(c&&f)for(var p=0;p<f.length;p++)f[p]!==c&&h.push(f[p]);a.events[u[d]]=h}},o.trigger=function(a,l,c){var u,d,f,h,p=a.events;if(p&&r.keys(p).length>0){c||(c={}),u=l.split(" ");for(var m=0;m<u.length;m++)if(d=u[m],f=p[d],f){h=r.clone(c,!1),h.name=d,h.source=a;for(var g=0;g<f.length;g++)f[g].apply(a,[h])}}}})()},function(n,i,s){var o={};n.exports=o;var r=s(5),a=s(0),l=s(1),c=s(4);(function(){o.create=function(u){return a.extend({id:a.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},u)},o.setModified=function(u,d,f,h){if(u.isModified=d,d&&u.cache&&(u.cache.allBodies=null,u.cache.allConstraints=null,u.cache.allComposites=null),f&&u.parent&&o.setModified(u.parent,d,f,h),h)for(var p=0;p<u.composites.length;p++){var m=u.composites[p];o.setModified(m,d,f,h)}},o.add=function(u,d){var f=[].concat(d);r.trigger(u,"beforeAdd",{object:d});for(var h=0;h<f.length;h++){var p=f[h];switch(p.type){case"body":if(p.parent!==p){a.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}o.addBody(u,p);break;case"constraint":o.addConstraint(u,p);break;case"composite":o.addComposite(u,p);break;case"mouseConstraint":o.addConstraint(u,p.constraint);break}}return r.trigger(u,"afterAdd",{object:d}),u},o.remove=function(u,d,f){var h=[].concat(d);r.trigger(u,"beforeRemove",{object:d});for(var p=0;p<h.length;p++){var m=h[p];switch(m.type){case"body":o.removeBody(u,m,f);break;case"constraint":o.removeConstraint(u,m,f);break;case"composite":o.removeComposite(u,m,f);break;case"mouseConstraint":o.removeConstraint(u,m.constraint);break}}return r.trigger(u,"afterRemove",{object:d}),u},o.addComposite=function(u,d){return u.composites.push(d),d.parent=u,o.setModified(u,!0,!0,!1),u},o.removeComposite=function(u,d,f){var h=a.indexOf(u.composites,d);if(h!==-1){var p=o.allBodies(d);o.removeCompositeAt(u,h);for(var m=0;m<p.length;m++)p[m].sleepCounter=0}if(f)for(var m=0;m<u.composites.length;m++)o.removeComposite(u.composites[m],d,!0);return u},o.removeCompositeAt=function(u,d){return u.composites.splice(d,1),o.setModified(u,!0,!0,!1),u},o.addBody=function(u,d){return u.bodies.push(d),o.setModified(u,!0,!0,!1),u},o.removeBody=function(u,d,f){var h=a.indexOf(u.bodies,d);if(h!==-1&&(o.removeBodyAt(u,h),d.sleepCounter=0),f)for(var p=0;p<u.composites.length;p++)o.removeBody(u.composites[p],d,!0);return u},o.removeBodyAt=function(u,d){return u.bodies.splice(d,1),o.setModified(u,!0,!0,!1),u},o.addConstraint=function(u,d){return u.constraints.push(d),o.setModified(u,!0,!0,!1),u},o.removeConstraint=function(u,d,f){var h=a.indexOf(u.constraints,d);if(h!==-1&&o.removeConstraintAt(u,h),f)for(var p=0;p<u.composites.length;p++)o.removeConstraint(u.composites[p],d,!0);return u},o.removeConstraintAt=function(u,d){return u.constraints.splice(d,1),o.setModified(u,!0,!0,!1),u},o.clear=function(u,d,f){if(f)for(var h=0;h<u.composites.length;h++)o.clear(u.composites[h],d,!0);return d?u.bodies=u.bodies.filter(function(p){return p.isStatic}):u.bodies.length=0,u.constraints.length=0,u.composites.length=0,o.setModified(u,!0,!0,!1),u},o.allBodies=function(u){if(u.cache&&u.cache.allBodies)return u.cache.allBodies;for(var d=[].concat(u.bodies),f=0;f<u.composites.length;f++)d=d.concat(o.allBodies(u.composites[f]));return u.cache&&(u.cache.allBodies=d),d},o.allConstraints=function(u){if(u.cache&&u.cache.allConstraints)return u.cache.allConstraints;for(var d=[].concat(u.constraints),f=0;f<u.composites.length;f++)d=d.concat(o.allConstraints(u.composites[f]));return u.cache&&(u.cache.allConstraints=d),d},o.allComposites=function(u){if(u.cache&&u.cache.allComposites)return u.cache.allComposites;for(var d=[].concat(u.composites),f=0;f<u.composites.length;f++)d=d.concat(o.allComposites(u.composites[f]));return u.cache&&(u.cache.allComposites=d),d},o.get=function(u,d,f){var h,p;switch(f){case"body":h=o.allBodies(u);break;case"constraint":h=o.allConstraints(u);break;case"composite":h=o.allComposites(u).concat(u);break}return h?(p=h.filter(function(m){return m.id.toString()===d.toString()}),p.length===0?null:p[0]):null},o.move=function(u,d,f){return o.remove(u,d),o.add(f,d),u},o.rebase=function(u){for(var d=o.allBodies(u).concat(o.allConstraints(u)).concat(o.allComposites(u)),f=0;f<d.length;f++)d[f].id=a.nextId();return u},o.translate=function(u,d,f){for(var h=f?o.allBodies(u):u.bodies,p=0;p<h.length;p++)c.translate(h[p],d);return u},o.rotate=function(u,d,f,h){for(var p=Math.cos(d),m=Math.sin(d),g=h?o.allBodies(u):u.bodies,v=0;v<g.length;v++){var x=g[v],b=x.position.x-f.x,w=x.position.y-f.y;c.setPosition(x,{x:f.x+(b*p-w*m),y:f.y+(b*m+w*p)}),c.rotate(x,d)}return u},o.scale=function(u,d,f,h,p){for(var m=p?o.allBodies(u):u.bodies,g=0;g<m.length;g++){var v=m[g],x=v.position.x-h.x,b=v.position.y-h.y;c.setPosition(v,{x:h.x+x*d,y:h.y+b*f}),c.scale(v,d,f)}return u},o.bounds=function(u){for(var d=o.allBodies(u),f=[],h=0;h<d.length;h+=1){var p=d[h];f.push(p.bounds.min,p.bounds.max)}return l.create(f)}})()},function(n,i,s){var o={};n.exports=o;var r=s(4),a=s(5),l=s(0);(function(){o._motionWakeThreshold=.18,o._motionSleepThreshold=.08,o._minBias=.9,o.update=function(c,u){for(var d=u/l._baseDelta,f=o._motionSleepThreshold,h=0;h<c.length;h++){var p=c[h],m=r.getSpeed(p),g=r.getAngularSpeed(p),v=m*m+g*g;if(p.force.x!==0||p.force.y!==0){o.set(p,!1);continue}var x=Math.min(p.motion,v),b=Math.max(p.motion,v);p.motion=o._minBias*x+(1-o._minBias)*b,p.sleepThreshold>0&&p.motion<f?(p.sleepCounter+=1,p.sleepCounter>=p.sleepThreshold/d&&o.set(p,!0)):p.sleepCounter>0&&(p.sleepCounter-=1)}},o.afterCollisions=function(c){for(var u=o._motionSleepThreshold,d=0;d<c.length;d++){var f=c[d];if(f.isActive){var h=f.collision,p=h.bodyA.parent,m=h.bodyB.parent;if(!(p.isSleeping&&m.isSleeping||p.isStatic||m.isStatic)&&(p.isSleeping||m.isSleeping)){var g=p.isSleeping&&!p.isStatic?p:m,v=g===p?m:p;!g.isStatic&&v.motion>u&&o.set(g,!1)}}}},o.set=function(c,u){var d=c.isSleeping;u?(c.isSleeping=!0,c.sleepCounter=c.sleepThreshold,c.positionImpulse.x=0,c.positionImpulse.y=0,c.positionPrev.x=c.position.x,c.positionPrev.y=c.position.y,c.anglePrev=c.angle,c.speed=0,c.angularSpeed=0,c.motion=0,d||a.trigger(c,"sleepStart")):(c.isSleeping=!1,c.sleepCounter=0,d&&a.trigger(c,"sleepEnd"))}})()},function(n,i,s){var o={};n.exports=o;var r=s(3),a=s(9);(function(){var l=[],c={overlap:0,axis:null},u={overlap:0,axis:null};o.create=function(d,f){return{pair:null,collided:!1,bodyA:d,bodyB:f,parentA:d.parent,parentB:f.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},o.collides=function(d,f,h){if(o._overlapAxes(c,d.vertices,f.vertices,d.axes),c.overlap<=0||(o._overlapAxes(u,f.vertices,d.vertices,f.axes),u.overlap<=0))return null;var p=h&&h.table[a.id(d,f)],m;p?m=p.collision:(m=o.create(d,f),m.collided=!0,m.bodyA=d.id<f.id?d:f,m.bodyB=d.id<f.id?f:d,m.parentA=m.bodyA.parent,m.parentB=m.bodyB.parent),d=m.bodyA,f=m.bodyB;var g;c.overlap<u.overlap?g=c:g=u;var v=m.normal,x=m.tangent,b=m.penetration,w=m.supports,y=g.overlap,C=g.axis,I=C.x,$=C.y,E=f.position.x-d.position.x,N=f.position.y-d.position.y;I*E+$*N>=0&&(I=-I,$=-$),v.x=I,v.y=$,x.x=-$,x.y=I,b.x=I*y,b.y=$*y,m.depth=y;var k=o._findSupports(d,f,v,1),D=0;if(r.contains(d.vertices,k[0])&&(w[D++]=k[0]),r.contains(d.vertices,k[1])&&(w[D++]=k[1]),D<2){var _=o._findSupports(f,d,v,-1);r.contains(f.vertices,_[0])&&(w[D++]=_[0]),D<2&&r.contains(f.vertices,_[1])&&(w[D++]=_[1])}return D===0&&(w[D++]=k[0]),m.supportCount=D,m},o._overlapAxes=function(d,f,h,p){var m=f.length,g=h.length,v=f[0].x,x=f[0].y,b=h[0].x,w=h[0].y,y=p.length,C=Number.MAX_VALUE,I=0,$,E,N,k,D,_;for(D=0;D<y;D++){var R=p[D],T=R.x,A=R.y,O=v*T+x*A,P=b*T+w*A,M=O,z=P;for(_=1;_<m;_+=1)k=f[_].x*T+f[_].y*A,k>M?M=k:k<O&&(O=k);for(_=1;_<g;_+=1)k=h[_].x*T+h[_].y*A,k>z?z=k:k<P&&(P=k);if(E=M-P,N=z-O,$=E<N?E:N,$<C&&(C=$,I=D,$<=0))break}d.axis=p[I],d.overlap=C},o._findSupports=function(d,f,h,p){var m=f.vertices,g=m.length,v=d.position.x,x=d.position.y,b=h.x*p,w=h.y*p,y=m[0],C=y,I=b*(v-C.x)+w*(x-C.y),$,E,N;for(N=1;N<g;N+=1)C=m[N],E=b*(v-C.x)+w*(x-C.y),E<I&&(I=E,y=C);return $=m[(g+y.index-1)%g],I=b*(v-$.x)+w*(x-$.y),C=m[(y.index+1)%g],b*(v-C.x)+w*(x-C.y)<I?(l[0]=y,l[1]=C,l):(l[0]=y,l[1]=$,l)}})()},function(n,i,s){var o={};n.exports=o;var r=s(16);(function(){o.create=function(a,l){var c=a.bodyA,u=a.bodyB,d={id:o.id(c,u),bodyA:c,bodyB:u,collision:a,contacts:[r.create(),r.create()],contactCount:0,separation:0,isActive:!0,isSensor:c.isSensor||u.isSensor,timeCreated:l,timeUpdated:l,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return o.update(d,a,l),d},o.update=function(a,l,c){var u=l.supports,d=l.supportCount,f=a.contacts,h=l.parentA,p=l.parentB;a.isActive=!0,a.timeUpdated=c,a.collision=l,a.separation=l.depth,a.inverseMass=h.inverseMass+p.inverseMass,a.friction=h.friction<p.friction?h.friction:p.friction,a.frictionStatic=h.frictionStatic>p.frictionStatic?h.frictionStatic:p.frictionStatic,a.restitution=h.restitution>p.restitution?h.restitution:p.restitution,a.slop=h.slop>p.slop?h.slop:p.slop,a.contactCount=d,l.pair=a;var m=u[0],g=f[0],v=u[1],x=f[1];(x.vertex===m||g.vertex===v)&&(f[1]=g,f[0]=g=x,x=f[1]),g.vertex=m,x.vertex=v},o.setActive=function(a,l,c){l?(a.isActive=!0,a.timeUpdated=c):(a.isActive=!1,a.contactCount=0)},o.id=function(a,l){return a.id<l.id?a.id.toString(36)+":"+l.id.toString(36):l.id.toString(36)+":"+a.id.toString(36)}})()},function(n,i,s){var o={};n.exports=o;var r=s(3),a=s(2),l=s(7),c=s(1),u=s(11),d=s(0);(function(){o._warming=.4,o._torqueDampen=1,o._minLength=1e-6,o.create=function(f){var h=f;h.bodyA&&!h.pointA&&(h.pointA={x:0,y:0}),h.bodyB&&!h.pointB&&(h.pointB={x:0,y:0});var p=h.bodyA?a.add(h.bodyA.position,h.pointA):h.pointA,m=h.bodyB?a.add(h.bodyB.position,h.pointB):h.pointB,g=a.magnitude(a.sub(p,m));h.length=typeof h.length<"u"?h.length:g,h.id=h.id||d.nextId(),h.label=h.label||"Constraint",h.type="constraint",h.stiffness=h.stiffness||(h.length>0?1:.7),h.damping=h.damping||0,h.angularStiffness=h.angularStiffness||0,h.angleA=h.bodyA?h.bodyA.angle:h.angleA,h.angleB=h.bodyB?h.bodyB.angle:h.angleB,h.plugin={};var v={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return h.length===0&&h.stiffness>.1?(v.type="pin",v.anchors=!1):h.stiffness<.9&&(v.type="spring"),h.render=d.extend(v,h.render),h},o.preSolveAll=function(f){for(var h=0;h<f.length;h+=1){var p=f[h],m=p.constraintImpulse;p.isStatic||m.x===0&&m.y===0&&m.angle===0||(p.position.x+=m.x,p.position.y+=m.y,p.angle+=m.angle)}},o.solveAll=function(f,h){for(var p=d.clamp(h/d._baseDelta,0,1),m=0;m<f.length;m+=1){var g=f[m],v=!g.bodyA||g.bodyA&&g.bodyA.isStatic,x=!g.bodyB||g.bodyB&&g.bodyB.isStatic;(v||x)&&o.solve(f[m],p)}for(m=0;m<f.length;m+=1)g=f[m],v=!g.bodyA||g.bodyA&&g.bodyA.isStatic,x=!g.bodyB||g.bodyB&&g.bodyB.isStatic,!v&&!x&&o.solve(f[m],p)},o.solve=function(f,h){var p=f.bodyA,m=f.bodyB,g=f.pointA,v=f.pointB;if(!(!p&&!m)){p&&!p.isStatic&&(a.rotate(g,p.angle-f.angleA,g),f.angleA=p.angle),m&&!m.isStatic&&(a.rotate(v,m.angle-f.angleB,v),f.angleB=m.angle);var x=g,b=v;if(p&&(x=a.add(p.position,g)),m&&(b=a.add(m.position,v)),!(!x||!b)){var w=a.sub(x,b),y=a.magnitude(w);y<o._minLength&&(y=o._minLength);var C=(y-f.length)/y,I=f.stiffness>=1||f.length===0,$=I?f.stiffness*h:f.stiffness*h*h,E=f.damping*h,N=a.mult(w,C*$),k=(p?p.inverseMass:0)+(m?m.inverseMass:0),D=(p?p.inverseInertia:0)+(m?m.inverseInertia:0),_=k+D,R,T,A,O,P;if(E>0){var M=a.create();A=a.div(w,y),P=a.sub(m&&a.sub(m.position,m.positionPrev)||M,p&&a.sub(p.position,p.positionPrev)||M),O=a.dot(A,P)}p&&!p.isStatic&&(T=p.inverseMass/k,p.constraintImpulse.x-=N.x*T,p.constraintImpulse.y-=N.y*T,p.position.x-=N.x*T,p.position.y-=N.y*T,E>0&&(p.positionPrev.x-=E*A.x*O*T,p.positionPrev.y-=E*A.y*O*T),R=a.cross(g,N)/_*o._torqueDampen*p.inverseInertia*(1-f.angularStiffness),p.constraintImpulse.angle-=R,p.angle-=R),m&&!m.isStatic&&(T=m.inverseMass/k,m.constraintImpulse.x+=N.x*T,m.constraintImpulse.y+=N.y*T,m.position.x+=N.x*T,m.position.y+=N.y*T,E>0&&(m.positionPrev.x+=E*A.x*O*T,m.positionPrev.y+=E*A.y*O*T),R=a.cross(v,N)/_*o._torqueDampen*m.inverseInertia*(1-f.angularStiffness),m.constraintImpulse.angle+=R,m.angle+=R)}}},o.postSolveAll=function(f){for(var h=0;h<f.length;h++){var p=f[h],m=p.constraintImpulse;if(!(p.isStatic||m.x===0&&m.y===0&&m.angle===0)){l.set(p,!1);for(var g=0;g<p.parts.length;g++){var v=p.parts[g];r.translate(v.vertices,m),g>0&&(v.position.x+=m.x,v.position.y+=m.y),m.angle!==0&&(r.rotate(v.vertices,m.angle,p.position),u.rotate(v.axes,m.angle),g>0&&a.rotateAbout(v.position,m.angle,p.position,v.position)),c.update(v.bounds,v.vertices,p.velocity)}m.angle*=o._warming,m.x*=o._warming,m.y*=o._warming}}},o.pointAWorld=function(f){return{x:(f.bodyA?f.bodyA.position.x:0)+(f.pointA?f.pointA.x:0),y:(f.bodyA?f.bodyA.position.y:0)+(f.pointA?f.pointA.y:0)}},o.pointBWorld=function(f){return{x:(f.bodyB?f.bodyB.position.x:0)+(f.pointB?f.pointB.x:0),y:(f.bodyB?f.bodyB.position.y:0)+(f.pointB?f.pointB.y:0)}},o.currentLength=function(f){var h=(f.bodyA?f.bodyA.position.x:0)+(f.pointA?f.pointA.x:0),p=(f.bodyA?f.bodyA.position.y:0)+(f.pointA?f.pointA.y:0),m=(f.bodyB?f.bodyB.position.x:0)+(f.pointB?f.pointB.x:0),g=(f.bodyB?f.bodyB.position.y:0)+(f.pointB?f.pointB.y:0),v=h-m,x=p-g;return Math.sqrt(v*v+x*x)}})()},function(n,i,s){var o={};n.exports=o;var r=s(2),a=s(0);(function(){o.fromVertices=function(l){for(var c={},u=0;u<l.length;u++){var d=(u+1)%l.length,f=r.normalise({x:l[d].y-l[u].y,y:l[u].x-l[d].x}),h=f.y===0?1/0:f.x/f.y;h=h.toFixed(3).toString(),c[h]=f}return a.values(c)},o.rotate=function(l,c){if(c!==0)for(var u=Math.cos(c),d=Math.sin(c),f=0;f<l.length;f++){var h=l[f],p;p=h.x*u-h.y*d,h.y=h.x*d+h.y*u,h.x=p}}})()},function(n,i,s){var o={};n.exports=o;var r=s(3),a=s(0),l=s(4),c=s(1),u=s(2);(function(){o.rectangle=function(d,f,h,p,m){m=m||{};var g={label:"Rectangle Body",position:{x:d,y:f},vertices:r.fromPath("L 0 0 L "+h+" 0 L "+h+" "+p+" L 0 "+p)};if(m.chamfer){var v=m.chamfer;g.vertices=r.chamfer(g.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete m.chamfer}return l.create(a.extend({},g,m))},o.trapezoid=function(d,f,h,p,m,g){g=g||{},m>=1&&a.warn("Bodies.trapezoid: slope parameter must be < 1."),m*=.5;var v=(1-m*2)*h,x=h*m,b=x+v,w=b+x,y;m<.5?y="L 0 0 L "+x+" "+-p+" L "+b+" "+-p+" L "+w+" 0":y="L 0 0 L "+b+" "+-p+" L "+w+" 0";var C={label:"Trapezoid Body",position:{x:d,y:f},vertices:r.fromPath(y)};if(g.chamfer){var I=g.chamfer;C.vertices=r.chamfer(C.vertices,I.radius,I.quality,I.qualityMin,I.qualityMax),delete g.chamfer}return l.create(a.extend({},C,g))},o.circle=function(d,f,h,p,m){p=p||{};var g={label:"Circle Body",circleRadius:h};m=m||25;var v=Math.ceil(Math.max(10,Math.min(m,h)));return v%2===1&&(v+=1),o.polygon(d,f,v,h,a.extend({},g,p))},o.polygon=function(d,f,h,p,m){if(m=m||{},h<3)return o.circle(d,f,p,m);for(var g=2*Math.PI/h,v="",x=g*.5,b=0;b<h;b+=1){var w=x+b*g,y=Math.cos(w)*p,C=Math.sin(w)*p;v+="L "+y.toFixed(3)+" "+C.toFixed(3)+" "}var I={label:"Polygon Body",position:{x:d,y:f},vertices:r.fromPath(v)};if(m.chamfer){var $=m.chamfer;I.vertices=r.chamfer(I.vertices,$.radius,$.quality,$.qualityMin,$.qualityMax),delete m.chamfer}return l.create(a.extend({},I,m))},o.fromVertices=function(d,f,h,p,m,g,v,x){var b=a.getDecomp(),w,y,C,I,$,E,N,k,D,_,R;for(w=!!(b&&b.quickDecomp),p=p||{},C=[],m=typeof m<"u"?m:!1,g=typeof g<"u"?g:.01,v=typeof v<"u"?v:10,x=typeof x<"u"?x:.01,a.isArray(h[0])||(h=[h]),_=0;_<h.length;_+=1)if(E=h[_],I=r.isConvex(E),$=!I,$&&!w&&a.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),I||!w)I?E=r.clockwiseSort(E):E=r.hull(E),C.push({position:{x:d,y:f},vertices:E});else{var T=E.map(function(ne){return[ne.x,ne.y]});b.makeCCW(T),g!==!1&&b.removeCollinearPoints(T,g),x!==!1&&b.removeDuplicatePoints&&b.removeDuplicatePoints(T,x);var A=b.quickDecomp(T);for(N=0;N<A.length;N++){var O=A[N],P=O.map(function(ne){return{x:ne[0],y:ne[1]}});v>0&&r.area(P)<v||C.push({position:r.centre(P),vertices:P})}}for(N=0;N<C.length;N++)C[N]=l.create(a.extend(C[N],p));if(m){var M=5;for(N=0;N<C.length;N++){var z=C[N];for(k=N+1;k<C.length;k++){var L=C[k];if(c.overlaps(z.bounds,L.bounds)){var W=z.vertices,B=L.vertices;for(D=0;D<z.vertices.length;D++)for(R=0;R<L.vertices.length;R++){var q=u.magnitudeSquared(u.sub(W[(D+1)%W.length],B[R])),H=u.magnitudeSquared(u.sub(W[D],B[(R+1)%B.length]));q<M&&H<M&&(W[D].isInternal=!0,B[R].isInternal=!0)}}}}}return C.length>1?(y=l.create(a.extend({parts:C.slice(0)},p)),l.setPosition(y,{x:d,y:f}),y):C[0]}})()},function(n,i,s){var o={};n.exports=o;var r=s(0),a=s(8);(function(){o.create=function(l){var c={bodies:[],collisions:[],pairs:null};return r.extend(c,l)},o.setBodies=function(l,c){l.bodies=c.slice(0)},o.clear=function(l){l.bodies=[],l.collisions=[]},o.collisions=function(l){var c=l.pairs,u=l.bodies,d=u.length,f=o.canCollide,h=a.collides,p=l.collisions,m=0,g,v;for(u.sort(o._compareBoundsX),g=0;g<d;g++){var x=u[g],b=x.bounds,w=x.bounds.max.x,y=x.bounds.max.y,C=x.bounds.min.y,I=x.isStatic||x.isSleeping,$=x.parts.length,E=$===1;for(v=g+1;v<d;v++){var N=u[v],k=N.bounds;if(k.min.x>w)break;if(!(y<k.min.y||C>k.max.y)&&!(I&&(N.isStatic||N.isSleeping))&&f(x.collisionFilter,N.collisionFilter)){var D=N.parts.length;if(E&&D===1){var _=h(x,N,c);_&&(p[m++]=_)}else for(var R=$>1?1:0,T=D>1?1:0,A=R;A<$;A++)for(var O=x.parts[A],b=O.bounds,P=T;P<D;P++){var M=N.parts[P],k=M.bounds;if(!(b.min.x>k.max.x||b.max.x<k.min.x||b.max.y<k.min.y||b.min.y>k.max.y)){var _=h(O,M,c);_&&(p[m++]=_)}}}}}return p.length!==m&&(p.length=m),p},o.canCollide=function(l,c){return l.group===c.group&&l.group!==0?l.group>0:(l.mask&c.category)!==0&&(c.mask&l.category)!==0},o._compareBoundsX=function(l,c){return l.bounds.min.x-c.bounds.min.x}})()},function(n,i,s){var o={};n.exports=o;var r=s(0);(function(){o.create=function(a){var l={};return a||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),l.element=a||document.body,l.absolute={x:0,y:0},l.position={x:0,y:0},l.mousedownPosition={x:0,y:0},l.mouseupPosition={x:0,y:0},l.offset={x:0,y:0},l.scale={x:1,y:1},l.wheelDelta=0,l.button=-1,l.pixelRatio=parseInt(l.element.getAttribute("data-pixel-ratio"),10)||1,l.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},l.mousemove=function(c){var u=o._getRelativeMousePosition(c,l.element,l.pixelRatio),d=c.changedTouches;d&&(l.button=0,c.preventDefault()),l.absolute.x=u.x,l.absolute.y=u.y,l.position.x=l.absolute.x*l.scale.x+l.offset.x,l.position.y=l.absolute.y*l.scale.y+l.offset.y,l.sourceEvents.mousemove=c},l.mousedown=function(c){var u=o._getRelativeMousePosition(c,l.element,l.pixelRatio),d=c.changedTouches;d?(l.button=0,c.preventDefault()):l.button=c.button,l.absolute.x=u.x,l.absolute.y=u.y,l.position.x=l.absolute.x*l.scale.x+l.offset.x,l.position.y=l.absolute.y*l.scale.y+l.offset.y,l.mousedownPosition.x=l.position.x,l.mousedownPosition.y=l.position.y,l.sourceEvents.mousedown=c},l.mouseup=function(c){var u=o._getRelativeMousePosition(c,l.element,l.pixelRatio),d=c.changedTouches;d&&c.preventDefault(),l.button=-1,l.absolute.x=u.x,l.absolute.y=u.y,l.position.x=l.absolute.x*l.scale.x+l.offset.x,l.position.y=l.absolute.y*l.scale.y+l.offset.y,l.mouseupPosition.x=l.position.x,l.mouseupPosition.y=l.position.y,l.sourceEvents.mouseup=c},l.mousewheel=function(c){l.wheelDelta=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),c.preventDefault(),l.sourceEvents.mousewheel=c},o.setElement(l,l.element),l},o.setElement=function(a,l){a.element=l,l.addEventListener("mousemove",a.mousemove,{passive:!0}),l.addEventListener("mousedown",a.mousedown,{passive:!0}),l.addEventListener("mouseup",a.mouseup,{passive:!0}),l.addEventListener("wheel",a.mousewheel,{passive:!1}),l.addEventListener("touchmove",a.mousemove,{passive:!1}),l.addEventListener("touchstart",a.mousedown,{passive:!1}),l.addEventListener("touchend",a.mouseup,{passive:!1})},o.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},o.setOffset=function(a,l){a.offset.x=l.x,a.offset.y=l.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},o.setScale=function(a,l){a.scale.x=l.x,a.scale.y=l.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},o._getRelativeMousePosition=function(a,l,c){var u=l.getBoundingClientRect(),d=document.documentElement||document.body.parentNode||document.body,f=window.pageXOffset!==void 0?window.pageXOffset:d.scrollLeft,h=window.pageYOffset!==void 0?window.pageYOffset:d.scrollTop,p=a.changedTouches,m,g;return p?(m=p[0].pageX-u.left-f,g=p[0].pageY-u.top-h):(m=a.pageX-u.left-f,g=a.pageY-u.top-h),{x:m/(l.clientWidth/(l.width||l.clientWidth)*c),y:g/(l.clientHeight/(l.height||l.clientHeight)*c)}}})()},function(n,i,s){var o={};n.exports=o;var r=s(0);(function(){o._registry={},o.register=function(a){if(o.isPlugin(a)||r.warn("Plugin.register:",o.toString(a),"does not implement all required fields."),a.name in o._registry){var l=o._registry[a.name],c=o.versionParse(a.version).number,u=o.versionParse(l.version).number;c>u?(r.warn("Plugin.register:",o.toString(l),"was upgraded to",o.toString(a)),o._registry[a.name]=a):c<u?r.warn("Plugin.register:",o.toString(l),"can not be downgraded to",o.toString(a)):a!==l&&r.warn("Plugin.register:",o.toString(a),"is already registered to different plugin object")}else o._registry[a.name]=a;return a},o.resolve=function(a){return o._registry[o.dependencyParse(a).name]},o.toString=function(a){return typeof a=="string"?a:(a.name||"anonymous")+"@"+(a.version||a.range||"0.0.0")},o.isPlugin=function(a){return a&&a.name&&a.version&&a.install},o.isUsed=function(a,l){return a.used.indexOf(l)>-1},o.isFor=function(a,l){var c=a.for&&o.dependencyParse(a.for);return!a.for||l.name===c.name&&o.versionSatisfies(l.version,c.range)},o.use=function(a,l){if(a.uses=(a.uses||[]).concat(l||[]),a.uses.length===0){r.warn("Plugin.use:",o.toString(a),"does not specify any dependencies to install.");return}for(var c=o.dependencies(a),u=r.topologicalSort(c),d=[],f=0;f<u.length;f+=1)if(u[f]!==a.name){var h=o.resolve(u[f]);if(!h){d.push("❌ "+u[f]);continue}o.isUsed(a,h.name)||(o.isFor(h,a)||(r.warn("Plugin.use:",o.toString(h),"is for",h.for,"but installed on",o.toString(a)+"."),h._warned=!0),h.install?h.install(a):(r.warn("Plugin.use:",o.toString(h),"does not specify an install function."),h._warned=!0),h._warned?(d.push("🔶 "+o.toString(h)),delete h._warned):d.push("✅ "+o.toString(h)),a.used.push(h.name))}d.length>0&&r.info(d.join("  "))},o.dependencies=function(a,l){var c=o.dependencyParse(a),u=c.name;if(l=l||{},!(u in l)){a=o.resolve(a)||a,l[u]=r.map(a.uses||[],function(f){o.isPlugin(f)&&o.register(f);var h=o.dependencyParse(f),p=o.resolve(f);return p&&!o.versionSatisfies(p.version,h.range)?(r.warn("Plugin.dependencies:",o.toString(p),"does not satisfy",o.toString(h),"used by",o.toString(c)+"."),p._warned=!0,a._warned=!0):p||(r.warn("Plugin.dependencies:",o.toString(f),"used by",o.toString(c),"could not be resolved."),a._warned=!0),h.name});for(var d=0;d<l[u].length;d+=1)o.dependencies(l[u][d],l);return l}},o.dependencyParse=function(a){if(r.isString(a)){var l=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return l.test(a)||r.warn("Plugin.dependencyParse:",a,"is not a valid dependency string."),{name:a.split("@")[0],range:a.split("@")[1]||"*"}}return{name:a.name,range:a.range||a.version}},o.versionParse=function(a){var l=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;l.test(a)||r.warn("Plugin.versionParse:",a,"is not a valid version or range.");var c=l.exec(a),u=Number(c[4]),d=Number(c[5]),f=Number(c[6]);return{isRange:!!(c[1]||c[2]),version:c[3],range:a,operator:c[1]||c[2]||"",major:u,minor:d,patch:f,parts:[u,d,f],prerelease:c[7],number:u*1e8+d*1e4+f}},o.versionSatisfies=function(a,l){l=l||"*";var c=o.versionParse(l),u=o.versionParse(a);if(c.isRange){if(c.operator==="*"||a==="*")return!0;if(c.operator===">")return u.number>c.number;if(c.operator===">=")return u.number>=c.number;if(c.operator==="~")return u.major===c.major&&u.minor===c.minor&&u.patch>=c.patch;if(c.operator==="^")return c.major>0?u.major===c.major&&u.number>=c.number:c.minor>0?u.minor===c.minor&&u.patch>=c.patch:u.patch===c.patch}return a===l||a==="*"}})()},function(n,i){var s={};n.exports=s,function(){s.create=function(o){return{vertex:o,normalImpulse:0,tangentImpulse:0}}}()},function(n,i,s){var o={};n.exports=o;var r=s(7),a=s(18),l=s(13),c=s(19),u=s(5),d=s(6),f=s(10),h=s(0),p=s(4);(function(){o._deltaMax=1e3/60,o.create=function(m){m=m||{};var g={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},v=h.extend(g,m);return v.world=m.world||d.create({label:"World"}),v.pairs=m.pairs||c.create(),v.detector=m.detector||l.create(),v.detector.pairs=v.pairs,v.grid={buckets:[]},v.world.gravity=v.gravity,v.broadphase=v.grid,v.metrics={},v},o.update=function(m,g){var v=h.now(),x=m.world,b=m.detector,w=m.pairs,y=m.timing,C=y.timestamp,I;g>o._deltaMax&&h.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",o._deltaMax.toFixed(3),"ms."),g=typeof g<"u"?g:h._baseDelta,g*=y.timeScale,y.timestamp+=g,y.lastDelta=g;var $={timestamp:y.timestamp,delta:g};u.trigger(m,"beforeUpdate",$);var E=d.allBodies(x),N=d.allConstraints(x);for(x.isModified&&(l.setBodies(b,E),d.setModified(x,!1,!1,!0)),m.enableSleeping&&r.update(E,g),o._bodiesApplyGravity(E,m.gravity),g>0&&o._bodiesUpdate(E,g),u.trigger(m,"beforeSolve",$),f.preSolveAll(E),I=0;I<m.constraintIterations;I++)f.solveAll(N,g);f.postSolveAll(E);var k=l.collisions(b);c.update(w,k,C),m.enableSleeping&&r.afterCollisions(w.list),w.collisionStart.length>0&&u.trigger(m,"collisionStart",{pairs:w.collisionStart,timestamp:y.timestamp,delta:g});var D=h.clamp(20/m.positionIterations,0,1);for(a.preSolvePosition(w.list),I=0;I<m.positionIterations;I++)a.solvePosition(w.list,g,D);for(a.postSolvePosition(E),f.preSolveAll(E),I=0;I<m.constraintIterations;I++)f.solveAll(N,g);for(f.postSolveAll(E),a.preSolveVelocity(w.list),I=0;I<m.velocityIterations;I++)a.solveVelocity(w.list,g);return o._bodiesUpdateVelocities(E),w.collisionActive.length>0&&u.trigger(m,"collisionActive",{pairs:w.collisionActive,timestamp:y.timestamp,delta:g}),w.collisionEnd.length>0&&u.trigger(m,"collisionEnd",{pairs:w.collisionEnd,timestamp:y.timestamp,delta:g}),o._bodiesClearForces(E),u.trigger(m,"afterUpdate",$),m.timing.lastElapsed=h.now()-v,m},o.merge=function(m,g){if(h.extend(m,g),g.world){m.world=g.world,o.clear(m);for(var v=d.allBodies(m.world),x=0;x<v.length;x++){var b=v[x];r.set(b,!1),b.id=h.nextId()}}},o.clear=function(m){c.clear(m.pairs),l.clear(m.detector)},o._bodiesClearForces=function(m){for(var g=m.length,v=0;v<g;v++){var x=m[v];x.force.x=0,x.force.y=0,x.torque=0}},o._bodiesApplyGravity=function(m,g){var v=typeof g.scale<"u"?g.scale:.001,x=m.length;if(!(g.x===0&&g.y===0||v===0))for(var b=0;b<x;b++){var w=m[b];w.isStatic||w.isSleeping||(w.force.y+=w.mass*g.y*v,w.force.x+=w.mass*g.x*v)}},o._bodiesUpdate=function(m,g){for(var v=m.length,x=0;x<v;x++){var b=m[x];b.isStatic||b.isSleeping||p.update(b,g)}},o._bodiesUpdateVelocities=function(m){for(var g=m.length,v=0;v<g;v++)p.updateVelocities(m[v])}})()},function(n,i,s){var o={};n.exports=o;var r=s(3),a=s(0),l=s(1);(function(){o._restingThresh=2,o._restingThreshTangent=Math.sqrt(6),o._positionDampen=.9,o._positionWarming=.8,o._frictionNormalMultiplier=5,o._frictionMaxStatic=Number.MAX_VALUE,o.preSolvePosition=function(c){var u,d,f,h=c.length;for(u=0;u<h;u++)d=c[u],d.isActive&&(f=d.contactCount,d.collision.parentA.totalContacts+=f,d.collision.parentB.totalContacts+=f)},o.solvePosition=function(c,u,d){var f,h,p,m,g,v,x,b,w=o._positionDampen*(d||1),y=a.clamp(u/a._baseDelta,0,1),C=c.length;for(f=0;f<C;f++)h=c[f],!(!h.isActive||h.isSensor)&&(p=h.collision,m=p.parentA,g=p.parentB,v=p.normal,h.separation=p.depth+v.x*(g.positionImpulse.x-m.positionImpulse.x)+v.y*(g.positionImpulse.y-m.positionImpulse.y));for(f=0;f<C;f++)h=c[f],!(!h.isActive||h.isSensor)&&(p=h.collision,m=p.parentA,g=p.parentB,v=p.normal,b=h.separation-h.slop*y,(m.isStatic||g.isStatic)&&(b*=2),m.isStatic||m.isSleeping||(x=w/m.totalContacts,m.positionImpulse.x+=v.x*b*x,m.positionImpulse.y+=v.y*b*x),g.isStatic||g.isSleeping||(x=w/g.totalContacts,g.positionImpulse.x-=v.x*b*x,g.positionImpulse.y-=v.y*b*x))},o.postSolvePosition=function(c){for(var u=o._positionWarming,d=c.length,f=r.translate,h=l.update,p=0;p<d;p++){var m=c[p],g=m.positionImpulse,v=g.x,x=g.y,b=m.velocity;if(m.totalContacts=0,v!==0||x!==0){for(var w=0;w<m.parts.length;w++){var y=m.parts[w];f(y.vertices,g),h(y.bounds,y.vertices,b),y.position.x+=v,y.position.y+=x}m.positionPrev.x+=v,m.positionPrev.y+=x,v*b.x+x*b.y<0?(g.x=0,g.y=0):(g.x*=u,g.y*=u)}}},o.preSolveVelocity=function(c){var u=c.length,d,f;for(d=0;d<u;d++){var h=c[d];if(!(!h.isActive||h.isSensor)){var p=h.contacts,m=h.contactCount,g=h.collision,v=g.parentA,x=g.parentB,b=g.normal,w=g.tangent;for(f=0;f<m;f++){var y=p[f],C=y.vertex,I=y.normalImpulse,$=y.tangentImpulse;if(I!==0||$!==0){var E=b.x*I+w.x*$,N=b.y*I+w.y*$;v.isStatic||v.isSleeping||(v.positionPrev.x+=E*v.inverseMass,v.positionPrev.y+=N*v.inverseMass,v.anglePrev+=v.inverseInertia*((C.x-v.position.x)*N-(C.y-v.position.y)*E)),x.isStatic||x.isSleeping||(x.positionPrev.x-=E*x.inverseMass,x.positionPrev.y-=N*x.inverseMass,x.anglePrev-=x.inverseInertia*((C.x-x.position.x)*N-(C.y-x.position.y)*E))}}}}},o.solveVelocity=function(c,u){var d=u/a._baseDelta,f=d*d,h=f*d,p=-o._restingThresh*d,m=o._restingThreshTangent,g=o._frictionNormalMultiplier*d,v=o._frictionMaxStatic,x=c.length,b,w,y,C;for(y=0;y<x;y++){var I=c[y];if(!(!I.isActive||I.isSensor)){var $=I.collision,E=$.parentA,N=$.parentB,k=$.normal.x,D=$.normal.y,_=$.tangent.x,R=$.tangent.y,T=I.inverseMass,A=I.friction*I.frictionStatic*g,O=I.contacts,P=I.contactCount,M=1/P,z=E.position.x-E.positionPrev.x,L=E.position.y-E.positionPrev.y,W=E.angle-E.anglePrev,B=N.position.x-N.positionPrev.x,q=N.position.y-N.positionPrev.y,H=N.angle-N.anglePrev;for(C=0;C<P;C++){var ne=O[C],te=ne.vertex,ae=te.x-E.position.x,re=te.y-E.position.y,ee=te.x-N.position.x,j=te.y-N.position.y,Y=z-re*W,se=L+ae*W,J=B-j*H,ue=q+ee*H,oe=Y-J,be=se-ue,de=k*oe+D*be,Ie=_*oe+R*be,ge=I.separation+de,$e=Math.min(ge,1);$e=ge<0?0:$e;var De=$e*A;Ie<-De||Ie>De?(w=Ie>0?Ie:-Ie,b=I.friction*(Ie>0?1:-1)*h,b<-w?b=-w:b>w&&(b=w)):(b=Ie,w=v);var ve=ae*D-re*k,we=ee*D-j*k,Re=M/(T+E.inverseInertia*ve*ve+N.inverseInertia*we*we),Ne=(1+I.restitution)*de*Re;if(b*=Re,de<p)ne.normalImpulse=0;else{var Ke=ne.normalImpulse;ne.normalImpulse+=Ne,ne.normalImpulse>0&&(ne.normalImpulse=0),Ne=ne.normalImpulse-Ke}if(Ie<-m||Ie>m)ne.tangentImpulse=0;else{var We=ne.tangentImpulse;ne.tangentImpulse+=b,ne.tangentImpulse<-w&&(ne.tangentImpulse=-w),ne.tangentImpulse>w&&(ne.tangentImpulse=w),b=ne.tangentImpulse-We}var ct=k*Ne+_*b,Ee=D*Ne+R*b;E.isStatic||E.isSleeping||(E.positionPrev.x+=ct*E.inverseMass,E.positionPrev.y+=Ee*E.inverseMass,E.anglePrev+=(ae*Ee-re*ct)*E.inverseInertia),N.isStatic||N.isSleeping||(N.positionPrev.x-=ct*N.inverseMass,N.positionPrev.y-=Ee*N.inverseMass,N.anglePrev-=(ee*Ee-j*ct)*N.inverseInertia)}}}}})()},function(n,i,s){var o={};n.exports=o;var r=s(9),a=s(0);(function(){o.create=function(l){return a.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},l)},o.update=function(l,c,u){var d=r.update,f=r.create,h=r.setActive,p=l.table,m=l.list,g=m.length,v=g,x=l.collisionStart,b=l.collisionEnd,w=l.collisionActive,y=c.length,C=0,I=0,$=0,E,N,k;for(k=0;k<y;k++)E=c[k],N=E.pair,N?(N.isActive&&(w[$++]=N),d(N,E,u)):(N=f(E,u),p[N.id]=N,x[C++]=N,m[v++]=N);for(v=0,g=m.length,k=0;k<g;k++)N=m[k],N.timeUpdated>=u?m[v++]=N:(h(N,!1,u),N.collision.bodyA.sleepCounter>0&&N.collision.bodyB.sleepCounter>0?m[v++]=N:(b[I++]=N,delete p[N.id]));m.length!==v&&(m.length=v),x.length!==C&&(x.length=C),b.length!==I&&(b.length=I),w.length!==$&&(w.length=$)},o.clear=function(l){return l.table={},l.list.length=0,l.collisionStart.length=0,l.collisionActive.length=0,l.collisionEnd.length=0,l}})()},function(n,i,s){var o=n.exports=s(21);o.Axes=s(11),o.Bodies=s(12),o.Body=s(4),o.Bounds=s(1),o.Collision=s(8),o.Common=s(0),o.Composite=s(6),o.Composites=s(22),o.Constraint=s(10),o.Contact=s(16),o.Detector=s(13),o.Engine=s(17),o.Events=s(5),o.Grid=s(23),o.Mouse=s(14),o.MouseConstraint=s(24),o.Pair=s(9),o.Pairs=s(19),o.Plugin=s(15),o.Query=s(25),o.Render=s(26),o.Resolver=s(18),o.Runner=s(27),o.SAT=s(28),o.Sleeping=s(7),o.Svg=s(29),o.Vector=s(2),o.Vertices=s(3),o.World=s(30),o.Engine.run=o.Runner.run,o.Common.deprecated(o.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(n,i,s){var o={};n.exports=o;var r=s(15),a=s(0);(function(){o.name="matter-js",o.version="0.20.0",o.uses=[],o.used=[],o.use=function(){r.use(o,Array.prototype.slice.call(arguments))},o.before=function(l,c){return l=l.replace(/^Matter./,""),a.chainPathBefore(o,l,c)},o.after=function(l,c){return l=l.replace(/^Matter./,""),a.chainPathAfter(o,l,c)}})()},function(n,i,s){var o={};n.exports=o;var r=s(6),a=s(10),l=s(0),c=s(4),u=s(12),d=l.deprecated;(function(){o.stack=function(f,h,p,m,g,v,x){for(var b=r.create({label:"Stack"}),w=f,y=h,C,I=0,$=0;$<m;$++){for(var E=0,N=0;N<p;N++){var k=x(w,y,N,$,C,I);if(k){var D=k.bounds.max.y-k.bounds.min.y,_=k.bounds.max.x-k.bounds.min.x;D>E&&(E=D),c.translate(k,{x:_*.5,y:D*.5}),w=k.bounds.max.x+g,r.addBody(b,k),C=k,I+=1}else w+=g}y+=E+v,w=f}return b},o.chain=function(f,h,p,m,g,v){for(var x=f.bodies,b=1;b<x.length;b++){var w=x[b-1],y=x[b],C=w.bounds.max.y-w.bounds.min.y,I=w.bounds.max.x-w.bounds.min.x,$=y.bounds.max.y-y.bounds.min.y,E=y.bounds.max.x-y.bounds.min.x,N={bodyA:w,pointA:{x:I*h,y:C*p},bodyB:y,pointB:{x:E*m,y:$*g}},k=l.extend(N,v);r.addConstraint(f,a.create(k))}return f.label+=" Chain",f},o.mesh=function(f,h,p,m,g){var v=f.bodies,x,b,w,y,C;for(x=0;x<p;x++){for(b=1;b<h;b++)w=v[b-1+x*h],y=v[b+x*h],r.addConstraint(f,a.create(l.extend({bodyA:w,bodyB:y},g)));if(x>0)for(b=0;b<h;b++)w=v[b+(x-1)*h],y=v[b+x*h],r.addConstraint(f,a.create(l.extend({bodyA:w,bodyB:y},g))),m&&b>0&&(C=v[b-1+(x-1)*h],r.addConstraint(f,a.create(l.extend({bodyA:C,bodyB:y},g)))),m&&b<h-1&&(C=v[b+1+(x-1)*h],r.addConstraint(f,a.create(l.extend({bodyA:C,bodyB:y},g))))}return f.label+=" Mesh",f},o.pyramid=function(f,h,p,m,g,v,x){return o.stack(f,h,p,m,g,v,function(b,w,y,C,I,$){var E=Math.min(m,Math.ceil(p/2)),N=I?I.bounds.max.x-I.bounds.min.x:0;if(!(C>E)){C=E-C;var k=C,D=p-1-C;if(!(y<k||y>D)){$===1&&c.translate(I,{x:(y+(p%2===1?1:-1))*N,y:0});var _=I?y*N:0;return x(f+_+y*g,w,y,C,I,$)}}})},o.newtonsCradle=function(f,h,p,m,g){for(var v=r.create({label:"Newtons Cradle"}),x=0;x<p;x++){var b=1.9,w=u.circle(f+x*(m*b),h+g,m,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),y=a.create({pointA:{x:f+x*(m*b),y:h},bodyB:w});r.addBody(v,w),r.addConstraint(v,y)}return v},d(o,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),o.car=function(f,h,p,m,g){var v=c.nextGroup(!0),x=20,b=-p*.5+x,w=p*.5-x,y=0,C=r.create({label:"Car"}),I=u.rectangle(f,h,p,m,{collisionFilter:{group:v},chamfer:{radius:m*.5},density:2e-4}),$=u.circle(f+b,h+y,g,{collisionFilter:{group:v},friction:.8}),E=u.circle(f+w,h+y,g,{collisionFilter:{group:v},friction:.8}),N=a.create({bodyB:I,pointB:{x:b,y},bodyA:$,stiffness:1,length:0}),k=a.create({bodyB:I,pointB:{x:w,y},bodyA:E,stiffness:1,length:0});return r.addBody(C,I),r.addBody(C,$),r.addBody(C,E),r.addConstraint(C,N),r.addConstraint(C,k),C},d(o,"car","Composites.car ➤ moved to car example"),o.softBody=function(f,h,p,m,g,v,x,b,w,y){w=l.extend({inertia:1/0},w),y=l.extend({stiffness:.2,render:{type:"line",anchors:!1}},y);var C=o.stack(f,h,p,m,g,v,function(I,$){return u.circle(I,$,b,w)});return o.mesh(C,p,m,x,y),C.label="Soft Body",C},d(o,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(n,i,s){var o={};n.exports=o;var r=s(9),a=s(0),l=a.deprecated;(function(){o.create=function(c){var u={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(u,c)},o.update=function(c,u,d,f){var h,p,m,g=d.world,v=c.buckets,x,b,w=!1;for(h=0;h<u.length;h++){var y=u[h];if(!(y.isSleeping&&!f)&&!(g.bounds&&(y.bounds.max.x<g.bounds.min.x||y.bounds.min.x>g.bounds.max.x||y.bounds.max.y<g.bounds.min.y||y.bounds.min.y>g.bounds.max.y))){var C=o._getRegion(c,y);if(!y.region||C.id!==y.region.id||f){(!y.region||f)&&(y.region=C);var I=o._regionUnion(C,y.region);for(p=I.startCol;p<=I.endCol;p++)for(m=I.startRow;m<=I.endRow;m++){b=o._getBucketId(p,m),x=v[b];var $=p>=C.startCol&&p<=C.endCol&&m>=C.startRow&&m<=C.endRow,E=p>=y.region.startCol&&p<=y.region.endCol&&m>=y.region.startRow&&m<=y.region.endRow;!$&&E&&E&&x&&o._bucketRemoveBody(c,x,y),(y.region===C||$&&!E||f)&&(x||(x=o._createBucket(v,b)),o._bucketAddBody(c,x,y))}y.region=C,w=!0}}}w&&(c.pairsList=o._createActivePairsList(c))},l(o,"update","Grid.update ➤ replaced by Matter.Detector"),o.clear=function(c){c.buckets={},c.pairs={},c.pairsList=[]},l(o,"clear","Grid.clear ➤ replaced by Matter.Detector"),o._regionUnion=function(c,u){var d=Math.min(c.startCol,u.startCol),f=Math.max(c.endCol,u.endCol),h=Math.min(c.startRow,u.startRow),p=Math.max(c.endRow,u.endRow);return o._createRegion(d,f,h,p)},o._getRegion=function(c,u){var d=u.bounds,f=Math.floor(d.min.x/c.bucketWidth),h=Math.floor(d.max.x/c.bucketWidth),p=Math.floor(d.min.y/c.bucketHeight),m=Math.floor(d.max.y/c.bucketHeight);return o._createRegion(f,h,p,m)},o._createRegion=function(c,u,d,f){return{id:c+","+u+","+d+","+f,startCol:c,endCol:u,startRow:d,endRow:f}},o._getBucketId=function(c,u){return"C"+c+"R"+u},o._createBucket=function(c,u){var d=c[u]=[];return d},o._bucketAddBody=function(c,u,d){var f=c.pairs,h=r.id,p=u.length,m;for(m=0;m<p;m++){var g=u[m];if(!(d.id===g.id||d.isStatic&&g.isStatic)){var v=h(d,g),x=f[v];x?x[2]+=1:f[v]=[d,g,1]}}u.push(d)},o._bucketRemoveBody=function(c,u,d){var f=c.pairs,h=r.id,p;u.splice(a.indexOf(u,d),1);var m=u.length;for(p=0;p<m;p++){var g=f[h(d,u[p])];g&&(g[2]-=1)}},o._createActivePairsList=function(c){var u,d=c.pairs,f=a.keys(d),h=f.length,p=[],m;for(m=0;m<h;m++)u=d[f[m]],u[2]>0?p.push(u):delete d[f[m]];return p}})()},function(n,i,s){var o={};n.exports=o;var r=s(3),a=s(7),l=s(14),c=s(5),u=s(13),d=s(10),f=s(6),h=s(0),p=s(1);(function(){o.create=function(m,g){var v=(m?m.mouse:null)||(g?g.mouse:null);v||(m&&m.render&&m.render.canvas?v=l.create(m.render.canvas):g&&g.element?v=l.create(g.element):(v=l.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var x=d.create({label:"Mouse Constraint",pointA:v.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),b={type:"mouseConstraint",mouse:v,element:null,body:null,constraint:x,collisionFilter:{category:1,mask:4294967295,group:0}},w=h.extend(b,g);return c.on(m,"beforeUpdate",function(){var y=f.allBodies(m.world);o.update(w,y),o._triggerEvents(w)}),w},o.update=function(m,g){var v=m.mouse,x=m.constraint,b=m.body;if(v.button===0){if(x.bodyB)a.set(x.bodyB,!1),x.pointA=v.position;else for(var w=0;w<g.length;w++)if(b=g[w],p.contains(b.bounds,v.position)&&u.canCollide(b.collisionFilter,m.collisionFilter))for(var y=b.parts.length>1?1:0;y<b.parts.length;y++){var C=b.parts[y];if(r.contains(C.vertices,v.position)){x.pointA=v.position,x.bodyB=m.body=b,x.pointB={x:v.position.x-b.position.x,y:v.position.y-b.position.y},x.angleB=b.angle,a.set(b,!1),c.trigger(m,"startdrag",{mouse:v,body:b});break}}}else x.bodyB=m.body=null,x.pointB=null,b&&c.trigger(m,"enddrag",{mouse:v,body:b})},o._triggerEvents=function(m){var g=m.mouse,v=g.sourceEvents;v.mousemove&&c.trigger(m,"mousemove",{mouse:g}),v.mousedown&&c.trigger(m,"mousedown",{mouse:g}),v.mouseup&&c.trigger(m,"mouseup",{mouse:g}),l.clearSourceEvents(g)}})()},function(n,i,s){var o={};n.exports=o;var r=s(2),a=s(8),l=s(1),c=s(12),u=s(3);(function(){o.collides=function(d,f){for(var h=[],p=f.length,m=d.bounds,g=a.collides,v=l.overlaps,x=0;x<p;x++){var b=f[x],w=b.parts.length,y=w===1?0:1;if(v(b.bounds,m))for(var C=y;C<w;C++){var I=b.parts[C];if(v(I.bounds,m)){var $=g(I,d);if($){h.push($);break}}}}return h},o.ray=function(d,f,h,p){p=p||1e-100;for(var m=r.angle(f,h),g=r.magnitude(r.sub(f,h)),v=(h.x+f.x)*.5,x=(h.y+f.y)*.5,b=c.rectangle(v,x,g,p,{angle:m}),w=o.collides(b,d),y=0;y<w.length;y+=1){var C=w[y];C.body=C.bodyB=C.bodyA}return w},o.region=function(d,f,h){for(var p=[],m=0;m<d.length;m++){var g=d[m],v=l.overlaps(g.bounds,f);(v&&!h||!v&&h)&&p.push(g)}return p},o.point=function(d,f){for(var h=[],p=0;p<d.length;p++){var m=d[p];if(l.contains(m.bounds,f))for(var g=m.parts.length===1?0:1;g<m.parts.length;g++){var v=m.parts[g];if(l.contains(v.bounds,f)&&u.contains(v.vertices,f)){h.push(m);break}}}return h}})()},function(n,i,s){var o={};n.exports=o;var r=s(4),a=s(0),l=s(6),c=s(1),u=s(5),d=s(2),f=s(14);(function(){var h,p;typeof window<"u"&&(h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(y){window.setTimeout(function(){y(a.now())},1e3/60)},p=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o._goodFps=30,o._goodDelta=1e3/60,o.create=function(y){var C={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!y.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},I=a.extend(C,y);return I.canvas&&(I.canvas.width=I.options.width||I.canvas.width,I.canvas.height=I.options.height||I.canvas.height),I.mouse=y.mouse,I.engine=y.engine,I.canvas=I.canvas||v(I.options.width,I.options.height),I.context=I.canvas.getContext("2d"),I.textures={},I.bounds=I.bounds||{min:{x:0,y:0},max:{x:I.canvas.width,y:I.canvas.height}},I.controller=o,I.options.showBroadphase=!1,I.options.pixelRatio!==1&&o.setPixelRatio(I,I.options.pixelRatio),a.isElement(I.element)&&I.element.appendChild(I.canvas),I},o.run=function(y){(function C(I){y.frameRequestId=h(C),m(y,I),o.world(y,I),y.context.setTransform(y.options.pixelRatio,0,0,y.options.pixelRatio,0,0),(y.options.showStats||y.options.showDebug)&&o.stats(y,y.context,I),(y.options.showPerformance||y.options.showDebug)&&o.performance(y,y.context,I),y.context.setTransform(1,0,0,1,0,0)})()},o.stop=function(y){p(y.frameRequestId)},o.setPixelRatio=function(y,C){var I=y.options,$=y.canvas;C==="auto"&&(C=x($)),I.pixelRatio=C,$.setAttribute("data-pixel-ratio",C),$.width=I.width*C,$.height=I.height*C,$.style.width=I.width+"px",$.style.height=I.height+"px"},o.setSize=function(y,C,I){y.options.width=C,y.options.height=I,y.bounds.max.x=y.bounds.min.x+C,y.bounds.max.y=y.bounds.min.y+I,y.options.pixelRatio!==1?o.setPixelRatio(y,y.options.pixelRatio):(y.canvas.width=C,y.canvas.height=I)},o.lookAt=function(y,C,I,$){$=typeof $<"u"?$:!0,C=a.isArray(C)?C:[C],I=I||{x:0,y:0};for(var E={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},N=0;N<C.length;N+=1){var k=C[N],D=k.bounds?k.bounds.min:k.min||k.position||k,_=k.bounds?k.bounds.max:k.max||k.position||k;D&&_&&(D.x<E.min.x&&(E.min.x=D.x),_.x>E.max.x&&(E.max.x=_.x),D.y<E.min.y&&(E.min.y=D.y),_.y>E.max.y&&(E.max.y=_.y))}var R=E.max.x-E.min.x+2*I.x,T=E.max.y-E.min.y+2*I.y,A=y.canvas.height,O=y.canvas.width,P=O/A,M=R/T,z=1,L=1;M>P?L=M/P:z=P/M,y.options.hasBounds=!0,y.bounds.min.x=E.min.x,y.bounds.max.x=E.min.x+R*z,y.bounds.min.y=E.min.y,y.bounds.max.y=E.min.y+T*L,$&&(y.bounds.min.x+=R*.5-R*z*.5,y.bounds.max.x+=R*.5-R*z*.5,y.bounds.min.y+=T*.5-T*L*.5,y.bounds.max.y+=T*.5-T*L*.5),y.bounds.min.x-=I.x,y.bounds.max.x-=I.x,y.bounds.min.y-=I.y,y.bounds.max.y-=I.y,y.mouse&&(f.setScale(y.mouse,{x:(y.bounds.max.x-y.bounds.min.x)/y.canvas.width,y:(y.bounds.max.y-y.bounds.min.y)/y.canvas.height}),f.setOffset(y.mouse,y.bounds.min))},o.startViewTransform=function(y){var C=y.bounds.max.x-y.bounds.min.x,I=y.bounds.max.y-y.bounds.min.y,$=C/y.options.width,E=I/y.options.height;y.context.setTransform(y.options.pixelRatio/$,0,0,y.options.pixelRatio/E,0,0),y.context.translate(-y.bounds.min.x,-y.bounds.min.y)},o.endViewTransform=function(y){y.context.setTransform(y.options.pixelRatio,0,0,y.options.pixelRatio,0,0)},o.world=function(y,C){var I=a.now(),$=y.engine,E=$.world,N=y.canvas,k=y.context,D=y.options,_=y.timing,R=l.allBodies(E),T=l.allConstraints(E),A=D.wireframes?D.wireframeBackground:D.background,O=[],P=[],M,z={timestamp:$.timing.timestamp};if(u.trigger(y,"beforeRender",z),y.currentBackground!==A&&w(y,A),k.globalCompositeOperation="source-in",k.fillStyle="transparent",k.fillRect(0,0,N.width,N.height),k.globalCompositeOperation="source-over",D.hasBounds){for(M=0;M<R.length;M++){var L=R[M];c.overlaps(L.bounds,y.bounds)&&O.push(L)}for(M=0;M<T.length;M++){var W=T[M],B=W.bodyA,q=W.bodyB,H=W.pointA,ne=W.pointB;B&&(H=d.add(B.position,W.pointA)),q&&(ne=d.add(q.position,W.pointB)),!(!H||!ne)&&(c.contains(y.bounds,H)||c.contains(y.bounds,ne))&&P.push(W)}o.startViewTransform(y),y.mouse&&(f.setScale(y.mouse,{x:(y.bounds.max.x-y.bounds.min.x)/y.options.width,y:(y.bounds.max.y-y.bounds.min.y)/y.options.height}),f.setOffset(y.mouse,y.bounds.min))}else P=T,O=R,y.options.pixelRatio!==1&&y.context.setTransform(y.options.pixelRatio,0,0,y.options.pixelRatio,0,0);!D.wireframes||$.enableSleeping&&D.showSleeping?o.bodies(y,O,k):(D.showConvexHulls&&o.bodyConvexHulls(y,O,k),o.bodyWireframes(y,O,k)),D.showBounds&&o.bodyBounds(y,O,k),(D.showAxes||D.showAngleIndicator)&&o.bodyAxes(y,O,k),D.showPositions&&o.bodyPositions(y,O,k),D.showVelocity&&o.bodyVelocity(y,O,k),D.showIds&&o.bodyIds(y,O,k),D.showSeparations&&o.separations(y,$.pairs.list,k),D.showCollisions&&o.collisions(y,$.pairs.list,k),D.showVertexNumbers&&o.vertexNumbers(y,O,k),D.showMousePosition&&o.mousePosition(y,y.mouse,k),o.constraints(P,k),D.hasBounds&&o.endViewTransform(y),u.trigger(y,"afterRender",z),_.lastElapsed=a.now()-I},o.stats=function(y,C,I){for(var $=y.engine,E=$.world,N=l.allBodies(E),k=0,D=55,_=44,R=0,T=0,A=0;A<N.length;A+=1)k+=N[A].parts.length;var O={Part:k,Body:N.length,Cons:l.allConstraints(E).length,Comp:l.allComposites(E).length,Pair:$.pairs.list.length};C.fillStyle="#0e0f19",C.fillRect(R,T,D*5.5,_),C.font="12px Arial",C.textBaseline="top",C.textAlign="right";for(var P in O){var M=O[P];C.fillStyle="#aaa",C.fillText(P,R+D,T+8),C.fillStyle="#eee",C.fillText(M,R+D,T+26),R+=D}},o.performance=function(y,C){var I=y.engine,$=y.timing,E=$.deltaHistory,N=$.elapsedHistory,k=$.timestampElapsedHistory,D=$.engineDeltaHistory,_=$.engineUpdatesHistory,R=$.engineElapsedHistory,T=I.timing.lastUpdatesPerFrame,A=I.timing.lastDelta,O=g(E),P=g(N),M=g(D),z=g(_),L=g(R),W=g(k),B=W/O||0,q=Math.round(O/A),H=1e3/O||0,ne=4,te=12,ae=60,re=34,ee=10,j=69;C.fillStyle="#0e0f19",C.fillRect(0,50,te*5+ae*6+22,re),o.status(C,ee,j,ae,ne,E.length,Math.round(H)+" fps",H/o._goodFps,function(Y){return E[Y]/O-1}),o.status(C,ee+te+ae,j,ae,ne,D.length,A.toFixed(2)+" dt",o._goodDelta/A,function(Y){return D[Y]/M-1}),o.status(C,ee+(te+ae)*2,j,ae,ne,_.length,T+" upf",Math.pow(a.clamp(z/q||1,0,1),4),function(Y){return _[Y]/z-1}),o.status(C,ee+(te+ae)*3,j,ae,ne,R.length,L.toFixed(2)+" ut",1-T*L/o._goodFps,function(Y){return R[Y]/L-1}),o.status(C,ee+(te+ae)*4,j,ae,ne,N.length,P.toFixed(2)+" rt",1-P/o._goodFps,function(Y){return N[Y]/P-1}),o.status(C,ee+(te+ae)*5,j,ae,ne,k.length,B.toFixed(2)+" x",B*B*B,function(Y){return(k[Y]/E[Y]/B||0)-1})},o.status=function(y,C,I,$,E,N,k,D,_){y.strokeStyle="#888",y.fillStyle="#444",y.lineWidth=1,y.fillRect(C,I+7,$,1),y.beginPath(),y.moveTo(C,I+7-E*a.clamp(.4*_(0),-2,2));for(var R=0;R<$;R+=1)y.lineTo(C+R,I+7-(R<N?E*a.clamp(.4*_(R),-2,2):0));y.stroke(),y.fillStyle="hsl("+a.clamp(25+95*D,0,120)+",100%,60%)",y.fillRect(C,I-7,4,4),y.font="12px Arial",y.textBaseline="middle",y.textAlign="right",y.fillStyle="#eee",y.fillText(k,C+$,I-5)},o.constraints=function(y,C){for(var I=C,$=0;$<y.length;$++){var E=y[$];if(!(!E.render.visible||!E.pointA||!E.pointB)){var N=E.bodyA,k=E.bodyB,D,_;if(N?D=d.add(N.position,E.pointA):D=E.pointA,E.render.type==="pin")I.beginPath(),I.arc(D.x,D.y,3,0,2*Math.PI),I.closePath();else{if(k?_=d.add(k.position,E.pointB):_=E.pointB,I.beginPath(),I.moveTo(D.x,D.y),E.render.type==="spring")for(var R=d.sub(_,D),T=d.perp(d.normalise(R)),A=Math.ceil(a.clamp(E.length/5,12,20)),O,P=1;P<A;P+=1)O=P%2===0?1:-1,I.lineTo(D.x+R.x*(P/A)+T.x*O*4,D.y+R.y*(P/A)+T.y*O*4);I.lineTo(_.x,_.y)}E.render.lineWidth&&(I.lineWidth=E.render.lineWidth,I.strokeStyle=E.render.strokeStyle,I.stroke()),E.render.anchors&&(I.fillStyle=E.render.strokeStyle,I.beginPath(),I.arc(D.x,D.y,3,0,2*Math.PI),I.arc(_.x,_.y,3,0,2*Math.PI),I.closePath(),I.fill())}}},o.bodies=function(y,C,I){var $=I;y.engine;var E=y.options,N=E.showInternalEdges||!E.wireframes,k,D,_,R;for(_=0;_<C.length;_++)if(k=C[_],!!k.render.visible){for(R=k.parts.length>1?1:0;R<k.parts.length;R++)if(D=k.parts[R],!!D.render.visible){if(E.showSleeping&&k.isSleeping?$.globalAlpha=.5*D.render.opacity:D.render.opacity!==1&&($.globalAlpha=D.render.opacity),D.render.sprite&&D.render.sprite.texture&&!E.wireframes){var T=D.render.sprite,A=b(y,T.texture);$.translate(D.position.x,D.position.y),$.rotate(D.angle),$.drawImage(A,A.width*-T.xOffset*T.xScale,A.height*-T.yOffset*T.yScale,A.width*T.xScale,A.height*T.yScale),$.rotate(-D.angle),$.translate(-D.position.x,-D.position.y)}else{if(D.circleRadius)$.beginPath(),$.arc(D.position.x,D.position.y,D.circleRadius,0,2*Math.PI);else{$.beginPath(),$.moveTo(D.vertices[0].x,D.vertices[0].y);for(var O=1;O<D.vertices.length;O++)!D.vertices[O-1].isInternal||N?$.lineTo(D.vertices[O].x,D.vertices[O].y):$.moveTo(D.vertices[O].x,D.vertices[O].y),D.vertices[O].isInternal&&!N&&$.moveTo(D.vertices[(O+1)%D.vertices.length].x,D.vertices[(O+1)%D.vertices.length].y);$.lineTo(D.vertices[0].x,D.vertices[0].y),$.closePath()}E.wireframes?($.lineWidth=1,$.strokeStyle=y.options.wireframeStrokeStyle,$.stroke()):($.fillStyle=D.render.fillStyle,D.render.lineWidth&&($.lineWidth=D.render.lineWidth,$.strokeStyle=D.render.strokeStyle,$.stroke()),$.fill())}$.globalAlpha=1}}},o.bodyWireframes=function(y,C,I){var $=I,E=y.options.showInternalEdges,N,k,D,_,R;for($.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.render.visible)for(R=N.parts.length>1?1:0;R<N.parts.length;R++){for(k=N.parts[R],$.moveTo(k.vertices[0].x,k.vertices[0].y),_=1;_<k.vertices.length;_++)!k.vertices[_-1].isInternal||E?$.lineTo(k.vertices[_].x,k.vertices[_].y):$.moveTo(k.vertices[_].x,k.vertices[_].y),k.vertices[_].isInternal&&!E&&$.moveTo(k.vertices[(_+1)%k.vertices.length].x,k.vertices[(_+1)%k.vertices.length].y);$.lineTo(k.vertices[0].x,k.vertices[0].y)}$.lineWidth=1,$.strokeStyle=y.options.wireframeStrokeStyle,$.stroke()},o.bodyConvexHulls=function(y,C,I){var $=I,E,N,k;for($.beginPath(),N=0;N<C.length;N++)if(E=C[N],!(!E.render.visible||E.parts.length===1)){for($.moveTo(E.vertices[0].x,E.vertices[0].y),k=1;k<E.vertices.length;k++)$.lineTo(E.vertices[k].x,E.vertices[k].y);$.lineTo(E.vertices[0].x,E.vertices[0].y)}$.lineWidth=1,$.strokeStyle="rgba(255,255,255,0.2)",$.stroke()},o.vertexNumbers=function(y,C,I){var $=I,E,N,k;for(E=0;E<C.length;E++){var D=C[E].parts;for(k=D.length>1?1:0;k<D.length;k++){var _=D[k];for(N=0;N<_.vertices.length;N++)$.fillStyle="rgba(255,255,255,0.2)",$.fillText(E+"_"+N,_.position.x+(_.vertices[N].x-_.position.x)*.8,_.position.y+(_.vertices[N].y-_.position.y)*.8)}}},o.mousePosition=function(y,C,I){var $=I;$.fillStyle="rgba(255,255,255,0.8)",$.fillText(C.position.x+"  "+C.position.y,C.position.x+5,C.position.y-5)},o.bodyBounds=function(y,C,I){var $=I;y.engine;var E=y.options;$.beginPath();for(var N=0;N<C.length;N++){var k=C[N];if(k.render.visible)for(var D=C[N].parts,_=D.length>1?1:0;_<D.length;_++){var R=D[_];$.rect(R.bounds.min.x,R.bounds.min.y,R.bounds.max.x-R.bounds.min.x,R.bounds.max.y-R.bounds.min.y)}}E.wireframes?$.strokeStyle="rgba(255,255,255,0.08)":$.strokeStyle="rgba(0,0,0,0.1)",$.lineWidth=1,$.stroke()},o.bodyAxes=function(y,C,I){var $=I;y.engine;var E=y.options,N,k,D,_;for($.beginPath(),k=0;k<C.length;k++){var R=C[k],T=R.parts;if(R.render.visible)if(E.showAxes)for(D=T.length>1?1:0;D<T.length;D++)for(N=T[D],_=0;_<N.axes.length;_++){var A=N.axes[_];$.moveTo(N.position.x,N.position.y),$.lineTo(N.position.x+A.x*20,N.position.y+A.y*20)}else for(D=T.length>1?1:0;D<T.length;D++)for(N=T[D],_=0;_<N.axes.length;_++)$.moveTo(N.position.x,N.position.y),$.lineTo((N.vertices[0].x+N.vertices[N.vertices.length-1].x)/2,(N.vertices[0].y+N.vertices[N.vertices.length-1].y)/2)}E.wireframes?($.strokeStyle="indianred",$.lineWidth=1):($.strokeStyle="rgba(255, 255, 255, 0.4)",$.globalCompositeOperation="overlay",$.lineWidth=2),$.stroke(),$.globalCompositeOperation="source-over"},o.bodyPositions=function(y,C,I){var $=I;y.engine;var E=y.options,N,k,D,_;for($.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.render.visible)for(_=0;_<N.parts.length;_++)k=N.parts[_],$.arc(k.position.x,k.position.y,3,0,2*Math.PI,!1),$.closePath();for(E.wireframes?$.fillStyle="indianred":$.fillStyle="rgba(0,0,0,0.5)",$.fill(),$.beginPath(),D=0;D<C.length;D++)N=C[D],N.render.visible&&($.arc(N.positionPrev.x,N.positionPrev.y,2,0,2*Math.PI,!1),$.closePath());$.fillStyle="rgba(255,165,0,0.8)",$.fill()},o.bodyVelocity=function(y,C,I){var $=I;$.beginPath();for(var E=0;E<C.length;E++){var N=C[E];if(N.render.visible){var k=r.getVelocity(N);$.moveTo(N.position.x,N.position.y),$.lineTo(N.position.x+k.x,N.position.y+k.y)}}$.lineWidth=3,$.strokeStyle="cornflowerblue",$.stroke()},o.bodyIds=function(y,C,I){var $=I,E,N;for(E=0;E<C.length;E++)if(C[E].render.visible){var k=C[E].parts;for(N=k.length>1?1:0;N<k.length;N++){var D=k[N];$.font="12px Arial",$.fillStyle="rgba(255,255,255,0.5)",$.fillText(D.id,D.position.x+10,D.position.y-10)}}},o.collisions=function(y,C,I){var $=I,E=y.options,N,k,D,_;for($.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.isActive)for(k=N.collision,_=0;_<N.contactCount;_++){var R=N.contacts[_],T=R.vertex;$.rect(T.x-1.5,T.y-1.5,3.5,3.5)}for(E.wireframes?$.fillStyle="rgba(255,255,255,0.7)":$.fillStyle="orange",$.fill(),$.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.isActive&&(k=N.collision,N.contactCount>0)){var A=N.contacts[0].vertex.x,O=N.contacts[0].vertex.y;N.contactCount===2&&(A=(N.contacts[0].vertex.x+N.contacts[1].vertex.x)/2,O=(N.contacts[0].vertex.y+N.contacts[1].vertex.y)/2),k.bodyB===k.supports[0].body||k.bodyA.isStatic===!0?$.moveTo(A-k.normal.x*8,O-k.normal.y*8):$.moveTo(A+k.normal.x*8,O+k.normal.y*8),$.lineTo(A,O)}E.wireframes?$.strokeStyle="rgba(255,165,0,0.7)":$.strokeStyle="orange",$.lineWidth=1,$.stroke()},o.separations=function(y,C,I){var $=I,E=y.options,N,k,D,_,R;for($.beginPath(),R=0;R<C.length;R++)if(N=C[R],!!N.isActive){k=N.collision,D=k.bodyA,_=k.bodyB;var T=1;!_.isStatic&&!D.isStatic&&(T=.5),_.isStatic&&(T=0),$.moveTo(_.position.x,_.position.y),$.lineTo(_.position.x-k.penetration.x*T,_.position.y-k.penetration.y*T),T=1,!_.isStatic&&!D.isStatic&&(T=.5),D.isStatic&&(T=0),$.moveTo(D.position.x,D.position.y),$.lineTo(D.position.x+k.penetration.x*T,D.position.y+k.penetration.y*T)}E.wireframes?$.strokeStyle="rgba(255,165,0,0.5)":$.strokeStyle="orange",$.stroke()},o.inspector=function(y,C){y.engine;var I=y.selected,$=y.render,E=$.options,N;if(E.hasBounds){var k=$.bounds.max.x-$.bounds.min.x,D=$.bounds.max.y-$.bounds.min.y,_=k/$.options.width,R=D/$.options.height;C.scale(1/_,1/R),C.translate(-$.bounds.min.x,-$.bounds.min.y)}for(var T=0;T<I.length;T++){var A=I[T].data;switch(C.translate(.5,.5),C.lineWidth=1,C.strokeStyle="rgba(255,165,0,0.9)",C.setLineDash([1,2]),A.type){case"body":N=A.bounds,C.beginPath(),C.rect(Math.floor(N.min.x-3),Math.floor(N.min.y-3),Math.floor(N.max.x-N.min.x+6),Math.floor(N.max.y-N.min.y+6)),C.closePath(),C.stroke();break;case"constraint":var O=A.pointA;A.bodyA&&(O=A.pointB),C.beginPath(),C.arc(O.x,O.y,10,0,2*Math.PI),C.closePath(),C.stroke();break}C.setLineDash([]),C.translate(-.5,-.5)}y.selectStart!==null&&(C.translate(.5,.5),C.lineWidth=1,C.strokeStyle="rgba(255,165,0,0.6)",C.fillStyle="rgba(255,165,0,0.1)",N=y.selectBounds,C.beginPath(),C.rect(Math.floor(N.min.x),Math.floor(N.min.y),Math.floor(N.max.x-N.min.x),Math.floor(N.max.y-N.min.y)),C.closePath(),C.stroke(),C.fill(),C.translate(-.5,-.5)),E.hasBounds&&C.setTransform(1,0,0,1,0,0)};var m=function(y,C){var I=y.engine,$=y.timing,E=$.historySize,N=I.timing.timestamp;$.delta=C-$.lastTime||o._goodDelta,$.lastTime=C,$.timestampElapsed=N-$.lastTimestamp||0,$.lastTimestamp=N,$.deltaHistory.unshift($.delta),$.deltaHistory.length=Math.min($.deltaHistory.length,E),$.engineDeltaHistory.unshift(I.timing.lastDelta),$.engineDeltaHistory.length=Math.min($.engineDeltaHistory.length,E),$.timestampElapsedHistory.unshift($.timestampElapsed),$.timestampElapsedHistory.length=Math.min($.timestampElapsedHistory.length,E),$.engineUpdatesHistory.unshift(I.timing.lastUpdatesPerFrame),$.engineUpdatesHistory.length=Math.min($.engineUpdatesHistory.length,E),$.engineElapsedHistory.unshift(I.timing.lastElapsed),$.engineElapsedHistory.length=Math.min($.engineElapsedHistory.length,E),$.elapsedHistory.unshift($.lastElapsed),$.elapsedHistory.length=Math.min($.elapsedHistory.length,E)},g=function(y){for(var C=0,I=0;I<y.length;I+=1)C+=y[I];return C/y.length||0},v=function(y,C){var I=document.createElement("canvas");return I.width=y,I.height=C,I.oncontextmenu=function(){return!1},I.onselectstart=function(){return!1},I},x=function(y){var C=y.getContext("2d"),I=window.devicePixelRatio||1,$=C.webkitBackingStorePixelRatio||C.mozBackingStorePixelRatio||C.msBackingStorePixelRatio||C.oBackingStorePixelRatio||C.backingStorePixelRatio||1;return I/$},b=function(y,C){var I=y.textures[C];return I||(I=y.textures[C]=new Image,I.src=C,I)},w=function(y,C){var I=C;/(jpg|gif|png)$/.test(C)&&(I="url("+C+")"),y.canvas.style.background=I,y.canvas.style.backgroundSize="contain",y.currentBackground=C}})()},function(n,i,s){var o={};n.exports=o;var r=s(5),a=s(17),l=s(0);(function(){o._maxFrameDelta=1e3/15,o._frameDeltaFallback=1e3/60,o._timeBufferMargin=1.5,o._elapsedNextEstimate=1,o._smoothingLowerBound=.1,o._smoothingUpperBound=.9,o.create=function(u){var d={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},f=l.extend(d,u);return f.fps=0,f},o.run=function(u,d){return u.timeBuffer=o._frameDeltaFallback,function f(h){u.frameRequestId=o._onNextFrame(u,f),h&&u.enabled&&o.tick(u,d,h)}(),u},o.tick=function(u,d,f){var h=l.now(),p=u.delta,m=0,g=f-u.timeLastTick;if((!g||!u.timeLastTick||g>Math.max(o._maxFrameDelta,u.maxFrameTime))&&(g=u.frameDelta||o._frameDeltaFallback),u.frameDeltaSmoothing){u.frameDeltaHistory.push(g),u.frameDeltaHistory=u.frameDeltaHistory.slice(-u.frameDeltaHistorySize);var v=u.frameDeltaHistory.slice(0).sort(),x=u.frameDeltaHistory.slice(v.length*o._smoothingLowerBound,v.length*o._smoothingUpperBound),b=c(x);g=b||g}u.frameDeltaSnapping&&(g=1e3/Math.round(1e3/g)),u.frameDelta=g,u.timeLastTick=f,u.timeBuffer+=u.frameDelta,u.timeBuffer=l.clamp(u.timeBuffer,0,u.frameDelta+p*o._timeBufferMargin),u.lastUpdatesDeferred=0;var w=u.maxUpdates||Math.ceil(u.maxFrameTime/p),y={timestamp:d.timing.timestamp};r.trigger(u,"beforeTick",y),r.trigger(u,"tick",y);for(var C=l.now();p>0&&u.timeBuffer>=p*o._timeBufferMargin;){r.trigger(u,"beforeUpdate",y),a.update(d,p),r.trigger(u,"afterUpdate",y),u.timeBuffer-=p,m+=1;var I=l.now()-h,$=l.now()-C,E=I+o._elapsedNextEstimate*$/m;if(m>=w||E>u.maxFrameTime){u.lastUpdatesDeferred=Math.round(Math.max(0,u.timeBuffer/p-o._timeBufferMargin));break}}d.timing.lastUpdatesPerFrame=m,r.trigger(u,"afterTick",y),u.frameDeltaHistory.length>=100&&(u.lastUpdatesDeferred&&Math.round(u.frameDelta/p)>w?l.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):u.lastUpdatesDeferred&&l.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof u.isFixed<"u"&&l.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(u.deltaMin||u.deltaMax)&&l.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),u.fps!==0&&l.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},o.stop=function(u){o._cancelNextFrame(u)},o._onNextFrame=function(u,d){if(typeof window<"u"&&window.requestAnimationFrame)u.frameRequestId=window.requestAnimationFrame(d);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return u.frameRequestId},o._cancelNextFrame=function(u){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(u.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var c=function(u){for(var d=0,f=u.length,h=0;h<f;h+=1)d+=u[h];return d/f||0}})()},function(n,i,s){var o={};n.exports=o;var r=s(8),a=s(0),l=a.deprecated;(function(){o.collides=function(c,u){return r.collides(c,u)},l(o,"collides","SAT.collides ➤ replaced by Collision.collides")})()},function(n,i,s){var o={};n.exports=o,s(1);var r=s(0);(function(){o.pathToVertices=function(a,l){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var c,u,d,f,h,p,m,g,v,x,b=[],w,y,C=0,I=0,$=0;l=l||15;var E=function(k,D,_){var R=_%2===1&&_>1;if(!v||k!=v.x||D!=v.y){v&&R?(w=v.x,y=v.y):(w=0,y=0);var T={x:w+k,y:y+D};(R||!v)&&(v=T),b.push(T),I=w+k,$=y+D}},N=function(k){var D=k.pathSegTypeAsLetter.toUpperCase();if(D!=="Z"){switch(D){case"M":case"L":case"T":case"C":case"S":case"Q":I=k.x,$=k.y;break;case"H":I=k.x;break;case"V":$=k.y;break}E(I,$,k.pathSegType)}};for(o._svgPathToAbsolute(a),d=a.getTotalLength(),p=[],c=0;c<a.pathSegList.numberOfItems;c+=1)p.push(a.pathSegList.getItem(c));for(m=p.concat();C<d;){if(x=a.getPathSegAtLength(C),h=p[x],h!=g){for(;m.length&&m[0]!=h;)N(m.shift());g=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":f=a.getPointAtLength(C),E(f.x,f.y,0);break}C+=l}for(c=0,u=m.length;c<u;++c)N(m[c]);return b},o._svgPathToAbsolute=function(a){for(var l,c,u,d,f,h,p=a.pathSegList,m=0,g=0,v=p.numberOfItems,x=0;x<v;++x){var b=p.getItem(x),w=b.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(w))"x"in b&&(m=b.x),"y"in b&&(g=b.y);else switch("x1"in b&&(u=m+b.x1),"x2"in b&&(f=m+b.x2),"y1"in b&&(d=g+b.y1),"y2"in b&&(h=g+b.y2),"x"in b&&(m+=b.x),"y"in b&&(g+=b.y),w){case"m":p.replaceItem(a.createSVGPathSegMovetoAbs(m,g),x);break;case"l":p.replaceItem(a.createSVGPathSegLinetoAbs(m,g),x);break;case"h":p.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(m),x);break;case"v":p.replaceItem(a.createSVGPathSegLinetoVerticalAbs(g),x);break;case"c":p.replaceItem(a.createSVGPathSegCurvetoCubicAbs(m,g,u,d,f,h),x);break;case"s":p.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(m,g,f,h),x);break;case"q":p.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(m,g,u,d),x);break;case"t":p.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(m,g),x);break;case"a":p.replaceItem(a.createSVGPathSegArcAbs(m,g,b.r1,b.r2,b.angle,b.largeArcFlag,b.sweepFlag),x);break;case"z":case"Z":m=l,g=c;break}(w=="M"||w=="m")&&(l=m,c=g)}}})()},function(n,i,s){var o={};n.exports=o;var r=s(6);s(0),function(){o.create=r.create,o.add=r.add,o.remove=r.remove,o.clear=r.clear,o.addComposite=r.addComposite,o.addBody=r.addBody,o.addConstraint=r.addConstraint}()}])})})(XR);var yn=XR.exports;function zm(t){if(!ay(t))throw new Error("Parameter was not an error")}function ay(t){return!!t&&typeof t=="object"&&wpe(t)==="[object Error]"||t instanceof Error}function wpe(t){return Object.prototype.toString.call(t)}const Cpe="Layerr";let Spe=Cpe;function Ipe(){return Spe}function $pe(t){let e,n="";if(t.length===0)e={};else if(ay(t[0]))e={cause:t[0]},n=t.slice(1).join(" ")||"";else if(t[0]&&typeof t[0]=="object")e=Object.assign({},t[0]),n=t.slice(1).join(" ")||"";else if(typeof t[0]=="string")e={},n=n=t.join(" ")||"";else throw new Error("Invalid arguments passed to Layerr");return{options:e,shortMessage:n}}class ho extends Error{constructor(e,n){const i=[...arguments],{options:s,shortMessage:o}=$pe(i);let r=o;if(s.cause&&(r=`${r}: ${s.cause.message}`),super(r),this.message=r,s.name&&typeof s.name=="string"?this.name=s.name:this.name=Ipe(),s.cause&&Object.defineProperty(this,"_cause",{value:s.cause}),Object.defineProperty(this,"_info",{value:{}}),s.info&&typeof s.info=="object"&&Object.assign(this._info,s.info),Error.captureStackTrace){const a=s.constructorOpt||this.constructor;Error.captureStackTrace(this,a)}}static cause(e){return zm(e),e._cause&&ay(e._cause)?e._cause:null}static fullStack(e){zm(e);const n=ho.cause(e);return n?`${e.stack}
caused by: ${ho.fullStack(n)}`:e.stack??""}static info(e){zm(e);const n={},i=ho.cause(e);return i&&Object.assign(n,ho.info(i)),e._info&&Object.assign(n,e._info),n}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}const qR="0123456789ABCDEFGHJKMNPQRSTVWXYZ",Oc=32,US=0xffffffffffff,Epe=10,Npe=16,Ec=Object.freeze({source:"ulid"});function kpe(t){const e=Dpe(),n=e&&(e.crypto||e.msCrypto)||null;if(typeof(n==null?void 0:n.getRandomValues)=="function")return()=>{const i=new Uint8Array(1);return n.getRandomValues(i),i[0]/255};if(typeof(n==null?void 0:n.randomBytes)=="function")return()=>n.randomBytes(1).readUInt8()/255;throw new ho({info:{code:"PRNG_DETECT",...Ec}},"Failed to find a reliable PRNG")}function Dpe(){return _pe()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function Tpe(t,e){let n="";for(;t>0;t--)n=Ape(e)+n;return n}function Rpe(t,e){if(isNaN(t))throw new ho({info:{code:"ENC_TIME_NAN",...Ec}},`Time must be a number: ${t}`);if(t>US)throw new ho({info:{code:"ENC_TIME_SIZE_EXCEED",...Ec}},`Cannot encode a time larger than ${US}: ${t}`);if(t<0)throw new ho({info:{code:"ENC_TIME_NEG",...Ec}},`Time must be positive: ${t}`);if(Number.isInteger(t)===!1)throw new ho({info:{code:"ENC_TIME_TYPE",...Ec}},`Time must be an integer: ${t}`);let n,i="";for(let s=e;s>0;s--)n=t%Oc,i=qR.charAt(n)+i,t=(t-n)/Oc;return i}function _pe(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function Ape(t){let e=Math.floor(t()*Oc);return e===Oc&&(e=Oc-1),qR.charAt(e)}function Ope(t,e){const n=kpe(),i=isNaN(t)?Date.now():t;return Rpe(i,Epe)+Tpe(Npe,n)}var li=[];for(var Bm=0;Bm<256;++Bm)li.push((Bm+256).toString(16).slice(1));function Ppe(t,e=0){return(li[t[e+0]]+li[t[e+1]]+li[t[e+2]]+li[t[e+3]]+"-"+li[t[e+4]]+li[t[e+5]]+"-"+li[t[e+6]]+li[t[e+7]]+"-"+li[t[e+8]]+li[t[e+9]]+"-"+li[t[e+10]]+li[t[e+11]]+li[t[e+12]]+li[t[e+13]]+li[t[e+14]]+li[t[e+15]]).toLowerCase()}var Zd,Mpe=new Uint8Array(16);function Fpe(){if(!Zd&&(Zd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Zd))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zd(Mpe)}var Lpe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const jS={randomUUID:Lpe};function Vm(t,e,n){if(jS.randomUUID&&!e&&!t)return jS.randomUUID();t=t||{};var i=t.random||(t.rng||Fpe)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Ppe(i)}const YR=800,Yo=YR/2,JR=100,tf=JR/2,nv=13;var ka=(t=>(t.Human="human",t.Robot="robot",t))(ka||{});function Nc(t,e){return eu(t,-e,e)/e}YH("cpu");const zpe=1,KS=50,Bpe=.2,Vpe=4;class xr{constructor(e,n){this.type=ka.Robot,this.model=n??this.init(),this.name=e??Ope()}static async load(e,n){const i=await mk(n);return new xr(e,i)}init(){const e=L9();return e.add(_m({inputShape:[4],units:10,activation:"relu"})),e.add(_m({units:10,activation:"linear"})),e.add(_m({units:1,activation:"tanh"})),e.compile({optimizer:"adam",loss:"meanSquaredError"}),e}getModelDescription(){const e=[];return ie(()=>{let n;this.model.layers.forEach((i,s,{length:o})=>{i.getWeights().forEach(r=>{if(r.shape.length===2){const a=r.shape[0],l=r.shape[1],c=n??Array(a).fill(0).map(()=>Vm()),u=Array(l).fill(0).map(()=>Vm());e.length===0&&e.push({type:ci.Neuron,neuronLayerType:aa.Input,neurons:Array(a).fill(0).map((f,h)=>({id:c[h],bias:0}))});const d=r.arraySync();e.push({type:ci.Axon,axons:Array(a*l).fill(0).map((f,h)=>{const p=Math.trunc(h/l),m=h%l;return{id:Vm(),from:c[p],to:u[m],weight:d[p][m]}})}),e.push({type:ci.Neuron,neuronLayerType:s===o-1?aa.Output:aa.Hidden,neurons:Array(l).fill(0).map((f,h)=>({id:u[h],bias:0}))}),n=u}else{const a=e.at(-1);if(Et(a)||a.type!==ci.Neuron)throw new Error("Unknown model structure");r.arraySync().forEach((c,u)=>{a.neurons[u].bias=c})}})})}),e}async mutate(e){const n=await Gpe(this.model,PO(e??Math.random()*Bpe,Vpe));return new xr(void 0,n)}async crossoverModels(e){try{const n=await Wpe(this.model,e.model);return new xr(void 0,n)}catch{return await this.mutate()}}play(e){const{pivot:n,bobs:[i]}=e,s=yn.Vector.sub(i.position,n.position),o=Nc(yn.Vector.angle(s,{x:0,y:1}),Math.PI),r=Nc(i.velocity.x,KS),a=Nc(i.velocity.y,KS),l=Nc(n.position.x,Yo);return{pivotVelocity:ie(()=>{const u=lh([[r,a,o,l]]),d=this.model.predict(u),f=d.shape;if(f.length===1)return d.arraySync()[0];if(f.length===2)return d.arraySync()[0][0];throw new Error(`Unsupported shape: ${f}`)})*zpe}}async save(e){await this.model.save(e)}dispose(){this.model.dispose()}}async function ZR(t){const e=await new Promise(n=>t.save({async save(i){return n(i),{modelArtifactsInfo:{dateSaved:new Date,modelTopologyType:"JSON"}}}}));return await mk({load:async()=>e})}async function Wpe(t,e){const n=t.layers,i=e.layers;if(n.length!==i.length)throw new Error("Layers of parents are not equal");const s=await ZR(t);return ie(()=>n.forEach((o,r)=>{const a=o.getWeights(),l=i[r].getWeights();if(a.length!==l.length)throw s.dispose(),new Error("Layers of parents are not equal");const c=a.map((u,d)=>{const f=l[d],h=u.shape,p=Math.trunc(Math.random()*h[0]),m=u.arraySync().slice(0,p),g=f.arraySync().slice(p);return ul([...m,...g],h)});s.layers[r].setWeights(c)})),s}async function Gpe(t,e){const n=await ZR(t);return ie(()=>n.layers.forEach(i=>{if(i.getWeights().length>0){const o=i.getWeights().map(r=>{const a=r.shape,l=N2(a,0,e);return r.add(l)});i.setWeights(o)}})),n}function QR(){const t=bF(T4),{robotId:e}=H_(),n=S.useMemo(()=>Et(t)||Et(e)?lf(gy):t.getRobot$(e).pipe(Il(i=>Et(i)?l1(U_(j_.NOT_FOUND,{message:"Robot not found",description:`Robot "${e}" not found in database, try selecting another robot`})):Lc(i)),qP(({value:{name:i,modelUrl:s}})=>sa(xr.load(i,s)).pipe(Il(o=>Lc(o)))),YP(),KP(K_)),[t,e]);return yF(n,gy)}const Hpe="_alert-container_1i1we_1",Upe="_left-aligned_1i1we_11",jpe="_container_1i1we_15",Kpe="_container__child-fill_1i1we_21",Xpe="_description_1i1we_30",qpe="_description-with-removal_1i1we_30",Ype="_description__icon_1i1we_41",Jpe="_description__icon_1i1we_41",Zpe="_description-with-removal__close_1i1we_45",Qpe="_description__close_1i1we_53",eme="_description__close_1i1we_53",ws={"alert-container":"_alert-container_1i1we_1",alertContainer:Hpe,"left-aligned":"_left-aligned_1i1we_11",leftAligned:Upe,container:jpe,"container__child-fill":"_container__child-fill_1i1we_21",containerChildFill:Kpe,description:Xpe,"description-with-removal":"_description-with-removal_1i1we_30",descriptionWithRemoval:qpe,description__icon:Ype,descriptionIcon:Jpe,"description-with-removal__close":"_description-with-removal__close_1i1we_45",descriptionWithRemovalClose:Zpe,description__close:Qpe,descriptionClose:eme},nl=30,xs=nl/2,tme=xs**2,Vi=5,XS=150,qS=2,YS=4,no=4,JS="14px monospace",nme=S.memo(()=>{const t=S.useRef(null),{width:e=0,height:n=0}=gv({ref:t,box:"border-box"}),[i,s]=S.useState(),o=S.useRef(null);S.useEffect(()=>{const m=o.current;Et(m)||s(m.getContext("2d",{alpha:!1})??void 0)},[]);const r=QR(),a=S.useMemo(()=>gl(r,{synced:({value:m})=>m.getModelDescription(),unsynced:()=>{}}),[r]),{drawingObjects:l,neuralNetworkWidth:c,neuralNetworkHeight:u}=S.useMemo(()=>{if(Et(a))return{drawingObjects:[],neuralNetworkWidth:0,neuralNetworkHeight:0};const m=Math.max(...a.filter(y=>y.type===ci.Neuron).map(({neurons:{length:y}})=>y)),g=m*nl+(m-1)*Vi,v=a.reduce((y,C,I,{length:$})=>{const{type:E}=C;switch(I!==$-1&&(y+=Vi),E){case ci.Neuron:return y+nl;case ci.Axon:return y+XS;default:em(E)}},0),x=new Map,b=[];let w=0;for(const y of a){if(y.type===ci.Axon){w+=XS+Vi;continue}const C=y.neurons.length,I=C*nl+(C-1)*Vi,$=(g-I)/2;y.neurons.forEach((E,N)=>{const k=w+xs,D=$+xs+N*(nl+Vi);x.set(E.id,{x:k,y:D}),b.push({...E,type:ci.Neuron,layerType:y.neuronLayerType,x:k,y:D})}),w+=nl+Vi}for(const y of a)y.type===ci.Axon&&y.axons.forEach(C=>{const I=x.get(C.from),$=x.get(C.to);if(Et(I)||Et($))return;const E=$.x-I.x,N=$.y-I.y,k=xs+Vi,D=N*(xs+Vi)/E,_=I.x+k,R=I.y+D,T=$.x-k,A=$.y-D;b.push({...C,type:ci.Axon,fromX:_,fromY:R,toX:T,toY:A,neuronFromX:I.x,neuronFromY:I.y,neuronToX:$.x,neuronToY:$.y})});return{drawingObjects:b,neuralNetworkWidth:v,neuralNetworkHeight:g}},[a]),[d,f]=S.useState(void 0);S.useEffect(()=>{if(!Et(i)){i.clearRect(0,0,e,n),i.save(),i.translate(e-c>>1,n-u>>1);for(const m of l){const{type:g}=m;switch(g){case ci.Neuron:{const v=(d==null?void 0:d.id)===m.id;i.beginPath(),i.arc(m.x,m.y,xs,0,2*Math.PI),i.fillStyle=m.layerType===aa.Input?"#d4380d":m.layerType===aa.Output?"#faad14":"#1677ff",i.fill(),i.lineWidth=v?YS:qS,i.strokeStyle=v?"#ffffff":"#d9d9d9",i.stroke();break}case ci.Axon:{const v=(d==null?void 0:d.id)===m.from||(d==null?void 0:d.id)===m.to;i.beginPath(),i.moveTo(m.fromX,m.fromY),i.lineTo(m.toX,m.toY),i.lineWidth=v?YS:qS,i.strokeStyle=v?"#ffffff":"#d9d9d9",i.stroke();break}default:em(g)}}for(const m of l){const{type:g}=m;switch(g){case ci.Neuron:{if(!((d==null?void 0:d.id)===m.id)||m.layerType===aa.Input)break;i.font=JS;const x=m.bias.toString(),{width:b,actualBoundingBoxAscent:w,actualBoundingBoxDescent:y}=i.measureText(x),C=Math.ceil(w+y),I=b+2*no,$=C+2*no;i.fillStyle="#000000",i.fillRect(m.x-b/2,m.y+xs+Vi,I,$),i.fillStyle="#ffffff",i.fillText(x,m.x-b/2+no,m.y+xs+Vi+C+no);break}case ci.Axon:{if(!((d==null?void 0:d.id)===m.from||(d==null?void 0:d.id)===m.to))break;i.font=JS;const x=m.weight.toString(),{width:b,actualBoundingBoxAscent:w,actualBoundingBoxDescent:y}=i.measureText(x),C=Math.ceil(w+y),I=b+2*no,$=C+2*no,{rectX:E,rectY:N,textX:k,textY:D}=(d==null?void 0:d.id)===m.to?{rectX:m.neuronFromX-b-xs-Vi-no,rectY:m.neuronFromY-C/2-no,textX:m.neuronFromX-b-xs-Vi,textY:m.neuronFromY+C/2}:{rectX:m.neuronToX+xs+Vi-no,rectY:m.neuronToY-C/2-no,textX:m.neuronToX+xs+Vi,textY:m.neuronToY+C/2};i.fillStyle="#000000",i.fillRect(E,N,I,$),i.fillStyle="#ffffff",i.fillText(x,k,D);break}default:em(g)}}i.restore()}},[i,l,e,n,c,u,d]),II(ji(({x:m,y:g})=>{const v=e-c>>1,x=n-u>>1;for(const b of l)if(b.type===ci.Neuron&&tme>(m-v-b.x)**2+(g-x-b.y)**2){f(b);return}f(void 0)}),o);const h=mv(),p=ji(()=>h("/pendulum"));return tt.jsxs("div",{ref:t,className:ws.container,children:[tt.jsx("canvas",{ref:o,className:ws.containerChildFill,width:e,height:n}),gl(r,{synced:({value:m})=>tt.jsxs("div",{className:ws.descriptionWithRemoval,onClick:p,children:[tt.jsx(u$,{}),m.name,tt.jsx(dv,{className:ws.descriptionClose})]}),unsynced:m=>Zr(m)?tt.jsx("div",{className:ws.alertContainer,children:tt.jsx(x1,{})}):bl(m)?tt.jsx(rf,{fail:m.fail}):tt.jsx("div",{className:ws.alertContainer,children:tt.jsx(w1,{message:"Select a robot to display the structure of the neural network and its weights",type:"info",showIcon:!0})})})]})}),e_=-4,ime=-2,sme=10,ome=50;function rme(t){return Array(t).fill(0).map(()=>new xr)}async function ame(t){return Promise.all(t.map(({name:e,modelUrl:n})=>xr.load(e,n)))}function lme(t,e){return async function(n,i,s){if(s>=e)return!1;const o=Math.trunc(Math.min(n.length,t)/5),r=D1(n,({score:c})=>c,"desc").filter(c=>c.player.type===ka.Robot),a=[];for(const{player:c,score:u}of r.slice(0,o))u<=i*e_?a.push(await c.mutate(.02)):u<=i*ime?(a.push(await c.mutate(.005)),a.push(await c.mutate(.05)),a.push(await c.mutate(.1))):a.push(cme(c,i,u));for(let c=0;c<o;c++){const u=a[c];!("player"in u)&&!Et(u.mutate)&&(a.push(await u.mutate(.01)),a.push(await u.mutate(.05)))}const l=LO(r.slice(o));for(;a.length<t;)switch(dme({action:"mutate",probability:50},{action:"mutate-aggressive",probability:5},{action:"crossover",probability:10},{action:"pick",probability:5},{action:"new",probability:1})){case"mutate":{const u=Qd(r).player;a.push(await u.mutate(.1));break}case"mutate-aggressive":{const u=Qd(r).player;a.push(await u.mutate(.2));break}case"crossover":{const u=Qd(r).player,d=Qd(r).player;u!==d&&!Et(u.crossoverModels)&&a.push(await u.crossoverModels(d));break}case"pick":{if(l.length>0){const{player:u}=l.splice(0,1)[0];a.push(u)}break}case"new":{a.push(new xr);break}}return a}}function cme(t,e,n){if(n<=e*sme)return t;const i=eu(n/(e*ome),0,Yo);if(i===0)return t;const s={pivotPosition:ume(-i,i)};return{player:t,pendulumOptions:s}}function ume(t,e){return Math.floor(Math.random()*(e-t)+t)}function Qd(t){return t[Math.trunc(Math.random()*t.length)]}function dme(...t){ov(t.length>0,"Actions must not be empty");const e=BO(t.map(({probability:s})=>s)),n=Math.random()*e;let i=0;for(const{action:s,probability:o}of t)if(i+=o,n<i)return s;return t.at(-1).action}function hme(t){const e={positiveTime:0,negativeTime:0,jitterDetector:[]};return n=>{const{pivot:i,bobs:[s]}=t,o=yn.Vector.sub(s.position,i.position),a=yn.Vector.angle(o,{x:0,y:1})>0,l=eu(yn.Vector.magnitude(s.velocity),0,10),c=Math.abs(Nc(i.position.x,Yo));e.jitterDetector.push(c),e.jitterDetector.length>50&&e.jitterDetector.shift(),a?(e.positiveTime+=n,e.negativeTime=0):(e.negativeTime+=n,e.positiveTime=0);let u=0,d=0,f=0;for(let C=0,I=void 0;C<e.jitterDetector.length-1;C++){const $=e.jitterDetector[C],E=Math.sign(e.jitterDetector[C+1]-$);if(E===0){d++;continue}d=0,I!==void 0&&I!==E&&u++,I=E,$<.1&&(f+=.1-$)}const h=Math.max(e.positiveTime*(1+d)/800,e.positiveTime/50)+e.positiveTime/20*Math.max(0,5-u),p=a?f*10:0,m=a?(10-l)*10:0,g=a?0:l*10,v=h+p+m+g,x=c>.2?c*100:0,b=Math.max(e.negativeTime*(1+d)/800,e.negativeTime/50),w=u*10,y=x+b+w;return Math.round(v-y)}}const ZS=30,fme=1e4,QS=2e4;function pme(){const t=of(),e=yl(bv),[n,i]=S.useState(),s=ji(async()=>{var f;if(!vl(e))return;const{competitionStart:r,generations:a}=e.value,l=lme(ZS,fme),c=(f=a==null?void 0:a.at(-1))==null?void 0:f.players.map(({name:h,modelUrl:p})=>({name:h,modelUrl:p}));let u=(a==null?void 0:a.length)??0;const d={start:r,get generationsCount(){return u},init:Et(c)?rme.bind(void 0,ZS):ame.bind(void 0,c),scoreCalculatorBuilder:hme,competitionForPlayerCompleted(h,p){return p<e_*QS},competitionCompleted(h){return h>=QS},async restartCompetition(h,p){u++;const m=await Promise.all(h.filter(g=>g.player.type===ka.Robot).map(async({player:g,score:v})=>{const x=`indexeddb://${d.start}-player-${g.name}}`;return await g.save(x),{name:g.name,modelUrl:x,score:v}}));return t(sA({competitionStart:r,generation:{id:u,maxScore:EO(h.map(({score:g})=>g))??0,players:m.sort((g,v)=>v.score-g.score)}})),l(h,p,u)}};i(d)}),o=vl(e)?e.value.competitionStart:void 0;return S.useEffect(()=>{Et(o)?i(void 0):s()},[s,o]),n}const e1=30;function t_(t,e){const n=S.useRef(0);S.useEffect(()=>{if(t||Et(e))return;let r=performance.now(),a=requestAnimationFrame(function l(){const c=performance.now();n.current=Math.round(200/(c-r))*5,r=c,a=requestAnimationFrame(l)});return()=>cancelAnimationFrame(a)},[t,e]);const{frameTime:i,deltaTime:s}=HO(t),o=S.useMemo(()=>{const r=new Set;let a=!1,l=1;return{subscribe(c){return r.add(c),()=>r.delete(c)},async update(c){if(a)return;n.current<e1?l=Math.max(1,l-1):n.current>=e1&&l++;const u=(e==null?void 0:e(c,l))??c;a=!0,await Promise.all(Array.from(r.keys()).map(async d=>{const f=Array.isArray(u)?u:[u];for(const h of f)await d(h)})),a=!1},dispose(){r.clear()}}},[e]);return S.useEffect(()=>void o.update(s),[i,s,o]),o}function Wm(t){ov(t.bobsCount>=1,"Bobs count must be at least 1");const e=yn.Engine.create(),{world:n}=e,i=yn.Bodies.circle(0,0,nv,{inertia:1/0,inverseInertia:0,restitution:1,friction:0,frictionAir:0,frictionStatic:0});yn.Body.setStatic(i,!0),yn.World.add(n,[i]);const s=[];for(let o=i,r=0;r<t.bobsCount;r++){const a=yn.Bodies.circle(0,JR*(r+1),nv,{inertia:1/0,inverseInertia:0,restitution:1,friction:0,frictionAir:0,frictionStatic:0});yn.World.add(n,[a]),yn.World.add(n,yn.Constraint.create({bodyA:o,bodyB:a,stiffness:1,damping:0})),o=a,s.push(a)}return!Et(t.pivotPosition)&&t.pivotPosition!==0&&yn.Body.setPosition(i,{x:eu(t.pivotPosition,-Yo,Yo),y:0}),{engine:e,pivot:i,bobs:s}}const Gm=500,mme=5e-4;function gme(t,e,n,i){if(e===0)return;const{engine:s,pivot:o}=t,r=yn.Vector.add(o.position,{x:n.pivotVelocity*e,y:0});if(yn.Body.setPosition(o,{x:eu(r.x,-Yo,Yo),y:0}),!Et(i)){const a=i;t.bobs.forEach(l=>{const c=yn.Vector.sub(l.position,a),u=yn.Vector.magnitude(c);if(u>Gm)return;const d=yn.Vector.mult(yn.Vector.normalise(c),(Gm-u)/Gm*mme);yn.Body.applyForce(l,l.position,d)})}yn.Engine.update(s,e)}class vme{constructor(e,n={bobsCount:1}){this.ticker=e,this.defaultPendulumOptions=n,this._gravity=1,this.tickerStarted=!1,this.playersWithWorlds=[],this.competitions=[]}async tick(e){var i;await Promise.all(this.playersWithWorlds.map(async s=>{const{player:o,world:r,active:a,competition:l,getScore:c,score:u}=s;if(!a)return;const d=await o.play(r,e);gme(r,e,d,this.additionalForcePosition),Et(c)||(s.score=u+c(e)),!Et(l)&&!Et(l.competitionForPlayerCompleted)&&l.competitionForPlayerCompleted(o,s.score)&&(s.active=!1,s.score=-1/0)})),this.competitions.forEach(s=>{s.timeStamp+=e,s.competition.competitionCompleted(s.timeStamp,this.playersWithWorlds)&&this.playersWithWorlds.forEach(o=>o.active=!1)});const n=this.competitions.filter(({competition:s})=>this.playersWithWorlds.every(({competition:o,active:r})=>o!==s||!r));for(const s of n){const{competition:o}=s,r=this.playersWithWorlds.filter(({competition:l})=>l===o).map(({player:l,score:c})=>({player:l,score:c})),a=await o.restartCompetition(r,s.timeStamp);if(s.timeStamp=0,this.playersWithWorlds=this.playersWithWorlds.filter(({competition:l})=>l!==o),a!==!1){r.forEach(({player:l})=>{a.every(c=>"player"in c?c.player!==l:c!==l)&&l.dispose()});for(const l of a){const{player:c,pendulumOptions:u}="player"in l?{...l,pendulumOptions:{...this.defaultPendulumOptions,...l.pendulumOptions}}:{player:l,pendulumOptions:this.defaultPendulumOptions},d=Wm(u);d.engine.gravity.y=this._gravity,this.playersWithWorlds.push({player:c,world:d,pendulumOptions:u,active:!0,competition:o,getScore:o.scoreCalculatorBuilder(d),score:0})}}else r.forEach(({player:l})=>l.dispose()),this.competitions=this.competitions.filter(({competition:l})=>l!==o),(i=o.dispose)==null||i.call(o)}await this.render()}async render(){(!Et(this.renderer)||!Et(this.queueRenderFrameId))&&(this.queueRenderFrameId=requestAnimationFrame(async()=>{const e=this.renderer;Et(e)||(await e.renderStatic(),await e.render(this.playersWithWorlds.map(({world:n})=>n),this.additionalForcePosition)),this.queueRenderFrameId=void 0}))}startTicker(){this.tickerStarted||(this.ticker.subscribe(e=>this.tick(e)),this.tickerStarted=!0)}async addPlayer(e,n){const i={...this.defaultPendulumOptions,...n},s=Wm(i);s.engine.gravity.y=this._gravity,this.playersWithWorlds.push({player:e,world:s,active:!0,score:0,pendulumOptions:i}),await this.render(),this.startTicker()}async clear(){this.ticker.dispose(),this.tickerStarted=!1,this.competitions.forEach(({competition:e})=>{var n;return(n=e.dispose)==null?void 0:n.call(e)}),this.competitions=[],this.playersWithWorlds.forEach(({player:e})=>e.dispose()),this.playersWithWorlds=[],await this.render()}async addCompetition(e,n){const i={...this.defaultPendulumOptions,...n},s=await e.init();for(const o of s){const r=Wm(i);r.engine.gravity.y=this._gravity,this.playersWithWorlds.push({player:o,world:r,pendulumOptions:i,active:!0,competition:e,getScore:e.scoreCalculatorBuilder(r),score:0})}this.competitions.push({competition:e,timeStamp:0}),await this.render(),this.startTicker()}async setRenderer(e){this.renderer=e,await this.render()}setAdditionalForcePosition(e){this.additionalForcePosition=e}destroy(){this.ticker.dispose(),this.playersWithWorlds.forEach(({player:e})=>e.dispose()),this.competitions.forEach(({competition:e})=>{var n;return(n=e.dispose)==null?void 0:n.call(e)})}setGravity(e){this._gravity=e,this.playersWithWorlds.map(({world:n})=>n.engine.gravity.y=e)}}function n_(t,e,n){const[i,s]=S.useState();S.useEffect(()=>{const r=new vme(t);return s(r),()=>r.destroy()},[t]);const o=n==null?void 0:n.gravity;return S.useEffect(()=>{Et(o)||i==null||i.setGravity(o)},[i,o]),S.useEffect(()=>void(i==null?void 0:i.setRenderer(e)),[i,e]),i}function xme(t,{x:e,y:n}){t.save(),t.beginPath(),t.arc(e,n,20,0,2*Math.PI),t.lineWidth=2+Math.round(Math.random()*3),t.strokeStyle="#4096ff",t.stroke(),t.restore()}const fo=2,Kr=12,t1=Kr/2,n1=70,i_=8,bme=4,eh=10,i1=12,th=15,s1=-15,yme=Math.PI/8,o1=yme/2,s_=5,wme=2*Math.PI/s_;function o_(t,...e){t.save();for(const n of e)t.beginPath(),t.arc(n.x,n.y,nv,0,2*Math.PI),t.fillStyle="#FF5733",t.fill(),t.lineWidth=fo,t.strokeStyle="white",t.stroke();t.restore()}function Cme(t,e){Sme(t,e),Ime(t,e),o_(t,e)}function Sme(t,e){t.save(),t.beginPath(),t.moveTo(e.x-tf,e.y),t.lineTo(e.x+tf,e.y),t.lineWidth=i_,t.lineCap="round",t.strokeStyle="white",t.stroke(),t.restore()}function Ime(t,e){const n=e.x-tf,i=e.x+tf,s=n-i1,o=i+i1,r=e.y-t1-eh-fo,a=n-s1,l=i+s1,c=e.y+t1+th+fo,u=e.x/(eh+fo),d=-e.x/(th+fo);nh(t,s,r,eh,u),nh(t,o,r,eh,u),nh(t,a,c,th,d),nh(t,l,c,th,d),t.save(),t.lineWidth=i_,t.lineCap="round",t.strokeStyle="white",t.beginPath(),t.moveTo(s,r),t.lineTo(n,e.y),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(o,r),t.lineTo(i,e.y),t.lineTo(l,c),t.stroke(),t.restore()}function nh(t,e,n,i,s){t.save(),t.beginPath(),t.arc(e,n,i,0,2*Math.PI),t.lineWidth=fo,t.strokeStyle="white",t.stroke(),t.restore();for(let o=0,r=s;o<s_;o++,r+=wme)$me(t,e,n,i-fo*2,r)}function $me(t,e,n,i,s){t.save(),t.beginPath(),t.moveTo(e,n),t.arc(e,n,i+fo,s-o1,s+o1),t.fillStyle="white",t.fill(),t.restore()}function Eme(t,...e){if(!(e.length<2)){t.save(),t.lineWidth=bme,t.strokeStyle="white",t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.stroke(),t.restore()}}function Nme(t,{pivot:e,bobs:n}){const i=n.map(({position:s})=>s);t.save(),Eme(t,e.position,...i),Cme(t,e.position),o_(t,...i),t.restore()}function kme(t){t.save(),t.strokeStyle="#999999",t.lineWidth=fo,t.roundRect(-Yo-n1,-Kr/2,YR+2*n1,Kr,Kr),t.stroke();const e=Math.trunc(Yo/10);for(let n=-e;n<=e;n++){const i=n%10===0?3:n%5===0?2:1;if(t.beginPath(),t.moveTo(10*n,Kr),t.lineTo(10*n,(i+1)*Kr),t.stroke(),i===3){const s=Math.abs(n*10).toFixed(0);t.fillStyle="white",t.font="14px serif";const{width:o}=t.measureText(s);t.fillText(s,10*n-o/2,(i+2)*Kr+fo)}}t.restore()}function r_(){const[t,e]=S.useState();return[S.useMemo(()=>{if(!Et(t))return{renderStatic(){const{staticContext:i,staticContext:{canvas:{width:s,height:o}}}=t;i.clearRect(0,0,s,o),i.save(),i.translate(s>>1,o>>1),kme(i),i.restore()},render(i,s){const{context:o,context:{canvas:{width:r,height:a}}}=t;o.clearRect(0,0,r,a),o.save(),o.translate(r>>1,a>>1),i.forEach(l=>Nme(o,l)),Et(s)||xme(o,s),o.restore()}}},[t]),e]}const Dme=S.memo(({className:t,width:e,height:n,onCanvasContext:i})=>{const s=S.useRef(null),o=S.useRef(null);return S.useEffect(()=>{var l,c;const r=(l=s.current)==null?void 0:l.getContext("2d",{alpha:!1}),a=(c=o.current)==null?void 0:c.getContext("2d",{alpha:!0});!Et(a)&&!Et(r)&&i({staticContext:r,context:a})},[e,n,i]),tt.jsxs("div",{className:ye(t),children:[tt.jsx("canvas",{className:vy.canvasContainerCanvas,ref:s,width:e,height:n}),tt.jsx("canvas",{className:vy.canvasContainerCanvas,ref:o,width:e,height:n})]})}),Tme="_container_bzwmn_1",Rme="_container__parent-fill_bzwmn_7",_me="_container__paused_bzwmn_18",Ame="_container__paused_bzwmn_18",Ome="_world-pause-action_bzwmn_34",Pme="_world-gravity_bzwmn_41",Ja={container:Tme,"container__parent-fill":"_container__parent-fill_bzwmn_7",containerParentFill:Rme,container__paused:_me,containerPaused:Ame,"world-pause-action":"_world-pause-action_bzwmn_34",worldPauseAction:Ome,"world-gravity":"_world-gravity_bzwmn_41",worldGravity:Pme},a_=S.memo(({paused:t,gravity:e,pauseResumeKeyCode:n,onGravityChanged:i,onPausedChanged:s,onSetContexts:o,onAdditionalForce:r,children:a})=>{const l=S.useRef(null),{width:c=0,height:u=0}=gv({ref:l,box:"border-box"}),d=ji(()=>s(!t));UO(n,d,l),II(ji(({x:h,y:p,buttons:m})=>{m&2**0?r==null||r({x:h-c/2,y:p-u/2}):r==null||r()}),Et(r)?void 0:l),S.useEffect(()=>void s(t),[t,s]);const f=ji(({value:h})=>i(h));return tt.jsxs("div",{ref:l,className:Ja.container,tabIndex:-1,children:[tt.jsx(Dme,{className:Ja.containerParentFill,width:c,height:u,onCanvasContext:o}),t&&tt.jsx("div",{className:Ja.containerParentFill,children:tt.jsx(fw,{className:Ja.containerPaused,onClick:d})}),tt.jsx(xl,{className:Ja.worldPauseAction,icon:t?tt.jsx(fw,{}):tt.jsx(zB,{}),onClick:d}),tt.jsx(wA,{className:Ja.worldGravity,value:e,vertical:!0,onChange:f,min:.1,step:.1,max:2}),a]})}),Mme=S.memo(()=>{const t=of(),e=yl(bv),[n,i]=S.useState(!0),s=pme(),o=yl(oA),r=ji(d=>t(rA(d))),[a,l]=r_(),c=t_(n,ji((d,f)=>Array(f).fill(0).map(()=>8+Math.round(Math.random()*2400)/100))),u=n_(c,a,{gravity:o});return S.useEffect(()=>void(u==null?void 0:u.clear().then(()=>Et(s)?void 0:u.addCompetition(s))),[u,s]),gl(e,{synced:()=>tt.jsx(a_,{paused:n,gravity:o,pauseResumeKeyCode:"Space",onGravityChanged:r,onPausedChanged:i,onSetContexts:l}),unsynced:d=>tt.jsx("div",{className:ws.alertContainer,children:bl(d)?tt.jsx(rf,{fail:d.fail}):tt.jsx(w1,{message:"Competition not started",description:tt.jsxs("div",{className:ws.leftAligned,children:[tt.jsx("p",{children:"The goal of the application is to find the structure of the neural network and its weights using a genetic algorithm to balance the pendulum around the zero mark."}),tt.jsxs("ul",{children:[tt.jsx("li",{children:"Create a new competition or continue a saved one by making a selection from the list provided below."}),tt.jsx("li",{children:"After loading, the fitness function will be on pause; you need to start the execution."}),tt.jsx("li",{children:"The generations table will display neural networks sorted by ranking along with their scored points."}),tt.jsx("li",{children:"You can select a neural network and see how it performs in the testing tab (you can add influence by clicking and holding the mouse and dragging it to the weight of the pendulum)."})]}),tt.jsx("p",{children:"The simulation speed will depend on the available performance, automatically adjusting to the maximum possible while ensuring a responsive UI."})]}),type:"info",showIcon:!0})})})}),Fme="_container_3wv84_1",Lme="_list_3wv84_9",zme="_grid_3wv84_16",Hm={container:Fme,list:Lme,grid:zme},Bme=S.memo(()=>{const t=S.useRef(null),{width:e=0,height:n=0}=gv({ref:t,box:"border-box"}),i=of(),s=yl(aA),o=yl(bv),r=mv(),a=ji(h=>{Et(h)?i(lA(Lc({competitionStart:new Date().toISOString(),generations:[]}))):i(cA(h))}),l=S.useMemo(()=>gl(s,{synced:({value:h})=>["new",...h],unsynced:h=>h===Y_?["new"]:[]}),[s]),c=S.useMemo(()=>vl(o)?o.value.generations:[],[o]),u=S.useMemo(()=>c.reduce((h,{players:{length:p}})=>Math.max(h,p),0),[c]),d=S.useMemo(()=>[{title:"#",dataIndex:"id",key:"id",fixed:"left",width:80,sorter:(h,p)=>h.id-p.id,defaultSortOrder:"descend"},{title:"Best score",dataIndex:"maxScore",key:"maxScore",fixed:"left",width:110,render:h=>tt.jsx(X_,{color:h>0?"green":h<0?"red":"blue",children:h})},...new Array(u).fill(0).map((h,p)=>({title:`Player #${p+1}`,dataIndex:`player-${p}`,key:`player-${p}`,width:340,render:m=>tt.jsx(q_,{count:m.score,overflowCount:m.score,color:m.score>0?"green":m.score<0?"red":"blue",children:tt.jsx(xl,{type:"link",onClick:()=>r(`/pendulum/${m.name}`),children:m.name})})}))],[u,r]),f=S.useMemo(()=>c.map(({id:h,maxScore:p,players:m})=>m.reduce((g,v,x)=>({...g,[`player-${x}`]:v}),{key:h,id:h,maxScore:p})),[c]);return tt.jsxs("div",{ref:t,className:Hm.container,children:[(bl(s)||bl(o))&&tt.jsx(rf,{fail:s.fail??o.fail}),(Zr(o)||xy(o)||Zr(s)||xy(s))&&tt.jsx(ng,{className:Hm.list,loading:Zr(s)||Zr(o),itemLayout:"horizontal",dataSource:l,renderItem:h=>tt.jsx(ng.Item,{children:tt.jsx(xl,{type:"link",size:"small",onClick:()=>a(h==="new"?void 0:h),children:h==="new"?"Create New":`Continue with ${new Date(h).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}`},"start")})}),by(o)&&by(s)&&tt.jsx(Zo,{virtual:!0,className:Hm.grid,dataSource:f,columns:d,pagination:!1,bordered:!0,scroll:{x:Math.ceil(e),y:Math.ceil(n-56)}})]})}),Vme=.2;class Wme{constructor(){this.type=ka.Human,this.name="Human",this.pressedKeys=new Set,this.handleKeyDownEvent=({code:e})=>this.pressedKeys.add(e),this.handleKeyUpEvent=({code:e})=>this.pressedKeys.delete(e),window.addEventListener("keydown",this.handleKeyDownEvent),window.addEventListener("keyup",this.handleKeyUpEvent)}play(){let e=0;return this.pressedKeys.has("ArrowLeft")&&e--,this.pressedKeys.has("ArrowRight")&&e++,(this.pressedKeys.has("ShiftLeft")||this.pressedKeys.has("ShiftRight"))&&(e*=5),{pivotVelocity:e*Vme}}dispose(){window.removeEventListener("keydown",this.handleKeyDownEvent),window.removeEventListener("keyup",this.handleKeyUpEvent)}}const Gme=S.memo(()=>{const t=of(),e=QR(),n=S.useMemo(()=>gl(e,{synced:({value:m})=>Lc(m),unsynced:m=>Zr(m)||bl(m)?m:Lc(new Wme)}),[e]),[i,s]=S.useState(!0),o=yl(uA),r=ji(m=>t(dA(m))),[a,l]=S.useState(),[c,u]=r_(),d=t_(i),f=n_(d,c,{gravity:o});S.useEffect(()=>void(f==null?void 0:f.clear().then(()=>{vl(n)&&f.addPlayer(n.value)})),[f,n]),S.useEffect(()=>{Et(f)||f.setAdditionalForcePosition(a)},[f,a]);const h=mv(),p=ji(()=>h("/pendulum"));return Zr(n)?tt.jsx("div",{className:ws.alertContainer,children:tt.jsx(x1,{})}):bl(n)?tt.jsx(rf,{fail:n.fail}):tt.jsx(a_,{paused:i,gravity:o,pauseResumeKeyCode:"Space",onAdditionalForce:l,onGravityChanged:r,onPausedChanged:s,onSetContexts:u,children:vl(n)&&tt.jsxs(tt.Fragment,{children:[n.value.type===ka.Human&&tt.jsxs("div",{className:ws.description,children:[tt.jsx(qB,{}),n.value.name]}),n.value.type===ka.Robot&&tt.jsxs("div",{className:ws.descriptionWithRemoval,onClick:p,children:[tt.jsx(u$,{}),n.value.name,tt.jsx(dv,{className:ws.descriptionClose})]})]})})}),Hme=[{id:"Fitness Playground",component:"FitnessPlayground",tabComponent:"default"},{id:"Generations List",component:"GenerationsList",tabComponent:"default"},{id:"Test Playground",component:"TestPlayground"},{id:"Neural Network",component:"DrawNeuralNetwork"}],rge={grid:{root:{type:"branch",data:[{type:"leaf",data:{views:["Fitness Playground"],activeView:"Fitness Playground",id:"1"},size:100},{type:"leaf",data:{views:["Generations List"],activeView:"Generations List",id:"2"},size:100},{type:"branch",data:[{type:"leaf",data:{views:["Test Playground"],activeView:"Test Playground",id:"3"},size:100},{type:"leaf",data:{views:["Neural Network"],activeView:"Neural Network",id:"4"},size:100}],size:100}],size:100},width:204,height:308,orientation:ot.VERTICAL},panels:{"Fitness Playground":{id:"Fitness Playground",contentComponent:"FitnessPlayground",tabComponent:"default",params:{title:"Fitness Playground"},title:"Fitness Playground"},"Generations List":{id:"Generations List",contentComponent:"GenerationsList",tabComponent:"default",params:{title:"Generations"},title:"Generations List"},"Test Playground":{id:"Test Playground",contentComponent:"TestPlayground",title:"Test Playground"},"Neural Network":{id:"Neural Network",contentComponent:"DrawNeuralNetwork",title:"Neural Network"}},activeGroup:"2"},age={FitnessPlayground:Mme,GenerationsList:Bme,TestPlayground:Gme,DrawNeuralNetwork:nme},lge={default:t=>tt.jsx("div",{className:"dv-default-tab",children:tt.jsx("div",{className:"dv-default-tab-content",children:t.params.title})})};function cge(t){const e=Hme.find(n=>n.id===t);if(Et(e))throw new Error(`Unknown layout tab: ${t}`);return e}const uge=v1(()=>{const t=new sP(void 0);return{registerApi(e){t.next(e)},resetApi(){t.next(void 0)},async openTab(e){await nI(t.pipe(UP(n=>!Et(n)),iu(n=>n.addPanel(e))))}}});export{Hme as A,rge as D,age as L,T4 as M,uge as a,JG as b,lge as c,cge as g,vF as u};
