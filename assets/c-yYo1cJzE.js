var p_=Object.defineProperty;var m_=(n,e,t)=>e in n?p_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var jn=(n,e,t)=>m_(n,typeof e!="symbol"?e+"":e,t);import{ai as dh,aj as Mc,ak as iv,al as g_,am as v_,an as x_,ao as rv,ap as uy,aq as fl,ar as b_,as as f1,at as dy,au as y_,av as p1,aw as rh,ax as w_,r as S,ay as pl,u as qi,i as $t,Q as C_,a8 as ml,$ as S_,Z as m1,X as I_,a9 as gl,az as g1,aA as $_,aB as E_,aC as ov,aD as sv,f as ye,s as le,aE as vn,B as ke,K as Xe,aF as N_,D as me,c as tu,J as Co,aG as k_,x as J,E as ze,A as En,aH as D_,aI as Fo,aJ as T_,aK as nt,aL as R_,aM as __,aN as Yi,o as Vo,R as Vl,aO as Mi,y as av,z as lv,aP as A_,aQ as Nr,aR as Um,aS as cv,w as Da,t as uv,H as Wl,G as Oo,g as Xr,m as Ei,C as Nn,aT as O_,aU as P_,a as sr,aV as M_,aW as F_,aX as L_,aY as z_,aZ as hh,a_ as hy,a$ as fy,b as ue,b0 as v1,b1 as x1,I as kn,b2 as dv,b3 as b1,b4 as hv,e as Ta,b5 as xs,d as Ns,b6 as nu,b7 as B_,p as V_,b8 as W_,b9 as y1,ba as fh,bb as G_,bc as H_,bd as py,q as Fc,F as vl,be as jm,bf as U_,bg as j_,bh as K_,bi as my,S as w1,bj as Lc,bk as gy,bl as fv,bm as vy,bn as xy,bo as X_,bp as by,bq as q_,br as C1,bs as S1,bt as _e,bu as pv,bv as I1,bw as Y_,bx as J_,by as Z_,bz as Q_,bA as eA,bB as tA,T as yy,bC as nA,bD as iA,bE as rA,bF as $1,bG as mo,bH as oA,bI as sA,bJ as wy,bK as aA,bL as lA,Y as zc,W as cA,bM as mv,L as st,bN as Zs,ah as E1,aa as xl,ae as nf,af as bl,bO as Cy,O as uA,bP as dA,ag as Sy,bQ as Iy,a0 as hA}from"./e-CIfyzysY.js";import{a as fA,u as gv}from"./c-CznU7xa-.js";import{R as N1,C as pA,a as k1,V as rf,A as D1}from"./c-P1tSgkxT.js";import{a as mA,S as gA,k as vv}from"./c-D9ziwHmT.js";import{b as T1,a as of,c as vA,r as yl,u as xv,d as xA}from"./c-BwrI0-8C.js";import{d as $y,c as bA}from"./c-CKMNIwHO.js";import{selectCurrentCompetition as bv,addCompetitionRun as yA,selectPlaygroundGravity as wA,setPlaygroundGravity as CA,selectCompetitionsList as SA,setCurrentCompetition as IA,loadCompetition as $A,selectGravity as EA,setGravity as NA}from"./c-Cfw-KUwC.js";import{S as kA}from"./c-GT-nYI6s.js";function DA(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(i,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var TA=/\s/;function RA(n){for(var e=n.length;e--&&TA.test(n.charAt(e)););return e}var _A=/^\s+/;function AA(n){return n&&n.slice(0,RA(n)+1).replace(_A,"")}var Ey=NaN,OA=/^[-+]0x[0-9a-f]+$/i,PA=/^0b[01]+$/i,MA=/^0o[0-7]+$/i,FA=parseInt;function na(n){if(typeof n=="number")return n;if(dh(n))return Ey;if(Mc(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Mc(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=AA(n);var t=PA.test(n);return t||MA.test(n)?FA(n.slice(2),t?2:8):OA.test(n)?Ey:+n}var Ny=1/0,LA=17976931348623157e292;function zA(n){if(!n)return n===0?n:0;if(n=na(n),n===Ny||n===-Ny){var e=n<0?-1:1;return e*LA}return n===n?n:0}function R1(n){var e=zA(n),t=e%1;return e===e?t?e-t:e:0}function Gl(n){return n}function BA(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function ph(){}var VA=800,WA=16,GA=Date.now;function HA(n){var e=0,t=0;return function(){var i=GA(),r=WA-(i-t);if(t=i,r>0){if(++e>=VA)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function UA(n){return function(){return n}}var jA=$y?function(n,e){return $y(n,"toString",{configurable:!0,enumerable:!1,value:UA(e),writable:!0})}:Gl,KA=HA(jA),ky=Math.max;function XA(n,e,t){return e=ky(e===void 0?n.length-1:e,0),function(){for(var i=arguments,r=-1,o=ky(i.length-e,0),s=Array(o);++r<o;)s[r]=i[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=i[r];return a[e]=t(s),BA(n,this,a)}}function qA(n,e){return KA(XA(n,e,Gl),n+"")}function Dy(n,e,t){if(!Mc(t))return!1;var i=typeof e;return(i=="number"?iv(t)&&g_(e,t.length):i=="string"&&e in t)?v_(t[e],n):!1}function yv(n,e){e=x_(e,n);for(var t=0,i=e.length;n!=null&&t<i;)n=n[rv(e[t++])];return t&&t==i?n:void 0}function YA(n,e,t){var i=n==null?void 0:yv(n,e);return i===void 0?t:i}var Ty=uy?uy.isConcatSpreadable:void 0;function JA(n){return fl(n)||b_(n)||!!(Ty&&n&&n[Ty])}function ZA(n,e,t,i,r){var o=-1,s=n.length;for(t||(t=JA),r||(r=[]);++o<s;){var a=n[o];t(a)?mA(r,a):r[r.length]=a}return r}var QA="Expected a function";function eO(n,e){var t;if(typeof e!="function")throw new TypeError(QA);return n=R1(n),function(){return--n>0&&(t=e.apply(this,arguments)),n<=1&&(e=void 0),t}}var tO=f1.isFinite,nO=Math.min;function iO(n){var e=Math[n];return function(t,i){if(t=na(t),i=i==null?0:nO(R1(i),292),i&&tO(t)){var r=(dy(t)+"e").split("e"),o=e(r[0]+"e"+(+r[1]+i));return r=(dy(o)+"e").split("e"),+(r[0]+"e"+(+r[1]-i))}return e(t)}}function rO(n,e,t){return n===n&&(t!==void 0&&(n=n<=t?n:t),e!==void 0&&(n=n>=e?n:e)),n}function iu(n,e,t){return t===void 0&&(t=e,e=void 0),t!==void 0&&(t=na(t),t=t===t?t:0),e!==void 0&&(e=na(e),e=e===e?e:0),rO(na(n),e,t)}var oO=1,sO=2;function aO(n,e,t,i){var r=t.length,o=r;if(n==null)return!o;for(n=Object(n);r--;){var s=t[r];if(s[2]?s[1]!==n[s[0]]:!(s[0]in n))return!1}for(;++r<o;){s=t[r];var a=s[0],l=n[a],c=s[1];if(s[2]){if(l===void 0&&!(a in n))return!1}else{var u=new gA,d;if(!(d===void 0?T1(c,l,oO|sO,i,u):d))return!1}}return!0}function _1(n){return n===n&&!Mc(n)}function lO(n){for(var e=vv(n),t=e.length;t--;){var i=e[t],r=n[i];e[t]=[i,r,_1(r)]}return e}function A1(n,e){return function(t){return t==null?!1:t[n]===e&&(e!==void 0||n in Object(t))}}function cO(n){var e=lO(n);return e.length==1&&e[0][2]?A1(e[0][0],e[0][1]):function(t){return t===n||aO(t,n,e)}}function uO(n,e){return n!=null&&e in Object(n)}function dO(n,e){return n!=null&&y_(n,e,uO)}var hO=1,fO=2;function pO(n,e){return p1(n)&&_1(e)?A1(rv(n),e):function(t){var i=YA(t,n);return i===void 0&&i===e?dO(t,n):T1(e,i,hO|fO)}}function mO(n){return function(e){return e==null?void 0:e[n]}}function gO(n){return function(e){return yv(e,n)}}function vO(n){return p1(n)?mO(rv(n)):gO(n)}function xO(n){return typeof n=="function"?n:n==null?Gl:typeof n=="object"?fl(n)?pO(n[0],n[1]):cO(n):vO(n)}function bO(n){return function(e,t,i){for(var r=-1,o=Object(e),s=i(e),a=s.length;a--;){var l=s[++r];if(t(o[l],l,o)===!1)break}return e}}var yO=bO();function wO(n,e){return n&&yO(n,e,vv)}function CO(n,e){return function(t,i){if(t==null)return t;if(!iv(t))return n(t,i);for(var r=t.length,o=-1,s=Object(t);++o<r&&i(s[o],o,s)!==!1;);return t}}var SO=CO(wO),Qp=function(){return f1.Date.now()},IO="Expected a function",$O=Math.max,EO=Math.min;function NO(n,e,t){var i,r,o,s,a,l,c=0,u=!1,d=!1,f=!0;if(typeof n!="function")throw new TypeError(IO);e=na(e)||0,Mc(t)&&(u=!!t.leading,d="maxWait"in t,o=d?$O(na(t.maxWait)||0,e):o,f="trailing"in t?!!t.trailing:f);function h(C){var $=i,I=r;return i=r=void 0,c=C,s=n.apply(I,$),s}function p(C){return c=C,a=setTimeout(v,e),u?h(C):s}function m(C){var $=C-l,I=C-c,E=e-$;return d?EO(E,o-I):E}function g(C){var $=C-l,I=C-c;return l===void 0||$>=e||$<0||d&&I>=o}function v(){var C=Qp();if(g(C))return x(C);a=setTimeout(v,m(C))}function x(C){return a=void 0,f&&i?h(C):(i=r=void 0,s)}function b(){a!==void 0&&clearTimeout(a),c=0,i=l=r=a=void 0}function w(){return a===void 0?s:x(Qp())}function y(){var C=Qp(),$=g(C);if(i=arguments,r=this,l=C,$){if(a===void 0)return p(l);if(d)return clearTimeout(a),a=setTimeout(v,e),h(l)}return a===void 0&&(a=setTimeout(v,e)),s}return y.cancel=b,y.flush=w,y}function kO(n,e){var t=-1,i=iv(n)?Array(n.length):[];return SO(n,function(r,o,s){i[++t]=e(r,o,s)}),i}function DO(n,e){return n>e}function TO(n,e){return rh(e,function(t){return n[t]})}function RO(n){return n==null?[]:TO(n,vv(n))}function Km(n){return n===void 0}function _O(n,e,t){for(var i=-1,r=n.length;++i<r;){var o=n[i],s=e(o);if(s!=null&&(a===void 0?s===s&&!dh(s):t(s,a)))var a=s,l=o}return l}function AO(n){return n&&n.length?_O(n,Gl,DO):void 0}function OO(n,e){for(var t,i=-1,r=n.length;++i<r;){var o=e(n[i]);o!==void 0&&(t=t===void 0?o:t+o)}return t}function PO(n){return eO(2,n)}function MO(n,e){var t=n.length;for(n.sort(e);t--;)n[t]=n[t].value;return n}function FO(n,e){if(n!==e){var t=n!==void 0,i=n===null,r=n===n,o=dh(n),s=e!==void 0,a=e===null,l=e===e,c=dh(e);if(!a&&!c&&!o&&n>e||o&&s&&l&&!a&&!c||i&&s&&l||!t&&l||!r)return 1;if(!i&&!o&&!c&&n<e||c&&t&&r&&!i&&!o||a&&t&&r||!s&&r||!l)return-1}return 0}function LO(n,e,t){for(var i=-1,r=n.criteria,o=e.criteria,s=r.length,a=t.length;++i<s;){var l=FO(r[i],o[i]);if(l){if(i>=a)return l;var c=t[i];return l*(c=="desc"?-1:1)}}return n.index-e.index}function O1(n,e,t){e.length?e=rh(e,function(o){return fl(o)?function(s){return yv(s,o.length===1?o[0]:o)}:o}):e=[Gl];var i=-1;e=rh(e,w_(xO));var r=kO(n,function(o,s,a){var l=rh(e,function(c){return c(o)});return{criteria:l,index:++i,value:o}});return MO(r,function(o,s){return LO(o,s,t)})}function P1(n,e,t,i){return n==null?[]:(fl(e)||(e=e==null?[]:[e]),t=t,fl(t)||(t=t==null?[]:[t]),O1(n,e,t))}var zO=Math.floor,BO=Math.random;function VO(n,e){return n+zO(BO()*(e-n+1))}var WO=iO("round");function M1(n,e){var t=-1,i=n.length,r=i-1;for(e=e===void 0?i:e;++t<e;){var o=VO(t,r),s=n[o];n[o]=n[t],n[t]=s}return n.length=e,n}function GO(n){return M1(bA(n))}function HO(n){return M1(RO(n))}function UO(n){var e=fl(n)?GO:HO;return e(n)}var jO=qA(function(n,e){if(n==null)return[];var t=e.length;return t>1&&Dy(n,e[0],e[1])?e=[]:t>2&&Dy(e[0],e[1],e[2])&&(e=[e[0]]),O1(n,ZA(e),[])});function KO(n){return n&&n.length?OO(n,Gl):0}function XO(n,e){const t=S.useMemo(()=>qO(pl(n)?n():n),e);return[S.useSyncExternalStore(t.subscribe,t.getSnapshot),t.setValue]}function qO(n){let e=n,t=ph;return{subscribe(i){return t=i,()=>t=ph},getSnapshot(){return e},setValue(i){e=pl(i)?i(e):i,t()}}}const YO={frameTime:0,deltaTime:0};function JO(n=!1){const[e,t]=S.useState(YO);return S.useEffect(()=>{if(n)return;let i=0,r=requestAnimationFrame(s=>o(s,!0));async function o(s,a=!1){if(!a){const l=s-i;t(c=>({frameTime:c.frameTime+l,deltaTime:l}))}i=s,r=requestAnimationFrame(o)}return()=>cancelAnimationFrame(r)},[n,t]),e}function ZO(n,e,t){const i=S.useMemo(()=>new Set,[]),r=qi(s=>{if(i.add(s.code),$t(n))return;(Array.isArray(n)?n:[n]).every(l=>i.has(l))&&(e(),s.preventDefault())}),o=qi(({code:s})=>void i.delete(s));S.useEffect(()=>{if(C_(n))return;const s=(t==null?void 0:t.current)??window;return s.addEventListener("keydown",r),s.addEventListener("keyup",o),()=>{s.removeEventListener("keydown",r),s.removeEventListener("keyup",o)}},[r,o,n,t])}function em(n){throw new Error(`assertNever invocation for "${n}" type of ${typeof n}`)}var Xm=function(n,e){return Xm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},Xm(n,e)};function Tr(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Xm(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function QO(n,e,t,i){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(i.next(u))}catch(d){s(d)}}function l(u){try{c(i.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):r(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})}function F1(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(t=0)),t;)try{if(i=1,r&&(o=c[0]&2?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],r=0}finally{i=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function wl(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wo(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,o=[],s;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(s)throw s.error}}return o}function bs(n,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return n.concat(o||Array.prototype.slice.call(e))}function il(n){return this instanceof il?(this.v=n,this):new il(n)}function eP(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(h){return function(p){return Promise.resolve(p).then(h,d)}}function a(h,p){i[h]&&(r[h]=function(m){return new Promise(function(g,v){o.push([h,m,g,v])>1||l(h,m)})},p&&(r[h]=p(r[h])))}function l(h,p){try{c(i[h](p))}catch(m){f(o[0][3],m)}}function c(h){h.value instanceof il?Promise.resolve(h.value.v).then(u,d):f(o[0][2],h)}function u(h){l("next",h)}function d(h){l("throw",h)}function f(h,p){h(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function tP(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof wl=="function"?wl(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(s){return new Promise(function(a,l){s=n[o](s),r(a,l,s.done,s.value)})}}function r(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}function nn(n){return typeof n=="function"}function wv(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var tm=wv(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,r){return r+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function mh(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Hl=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,i,r,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=wl(s),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(nn(u))try{u()}catch(m){o=m instanceof tm?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=wl(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{Ry(p)}catch(m){o=o??[],m instanceof tm?o=bs(bs([],Wo(o)),Wo(m.errors)):o.push(m)}}}catch(m){i={error:m}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}}if(o)throw new tm(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Ry(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&mh(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&mh(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),L1=Hl.EMPTY;function z1(n){return n instanceof Hl||n&&"closed"in n&&nn(n.remove)&&nn(n.add)&&nn(n.unsubscribe)}function Ry(n){nn(n)?n():n.unsubscribe()}var B1={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},V1={setTimeout:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setTimeout.apply(void 0,bs([n,e],Wo(t)))},clearTimeout:function(n){var e=V1.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function W1(n){V1.setTimeout(function(){throw n})}function _y(){}function oh(n){n()}var Cv=function(n){Tr(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,z1(t)&&t.add(i)):i.destination=oP,i}return e.create=function(t,i,r){return new Cl(t,i,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Hl),nP=Function.prototype.bind;function nm(n,e){return nP.call(n,e)}var iP=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){Dd(i)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){Dd(i)}else Dd(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Dd(t)}},n}(),Cl=function(n){Tr(e,n);function e(t,i,r){var o=n.call(this)||this,s;if(nn(t)||!t)s={next:t??void 0,error:i??void 0,complete:r??void 0};else{var a;o&&B1.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&nm(t.next,a),error:t.error&&nm(t.error,a),complete:t.complete&&nm(t.complete,a)}):s=t}return o.destination=new iP(s),o}return e}(Cv);function Dd(n){W1(n)}function rP(n){throw n}var oP={closed:!0,next:_y,error:rP,complete:_y},Sv=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ru(n){return n}function sP(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return G1(n)}function G1(n){return n.length===0?ru:n.length===1?n[0]:function(t){return n.reduce(function(i,r){return r(i)},t)}}var hi=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var r=this,o=lP(e)?e:new Cl(e,t,i);return oh(function(){var s=r,a=s.operator,l=s.source;o.add(a?a.call(o,l):l?r._subscribe(o):r._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=Ay(t),new t(function(r,o){var s=new Cl({next:function(a){try{e(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:r});i.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Sv]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return G1(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=Ay(e),new e(function(i,r){var o;t.subscribe(function(s){return o=s},function(s){return r(s)},function(){return i(o)})})},n.create=function(e){return new n(e)},n}();function Ay(n){var e;return(e=n??B1.Promise)!==null&&e!==void 0?e:Promise}function aP(n){return n&&nn(n.next)&&nn(n.error)&&nn(n.complete)}function lP(n){return n&&n instanceof Cv||aP(n)&&z1(n)}function cP(n){return nn(n==null?void 0:n.lift)}function ki(n){return function(e){if(cP(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function lr(n,e,t,i,r){return new H1(n,e,t,i,r)}var H1=function(n){Tr(e,n);function e(t,i,r,o,s,a){var l=n.call(this,t)||this;return l.onFinalize=s,l.shouldUnsubscribe=a,l._next=i?function(c){try{i(c)}catch(u){t.error(u)}}:n.prototype._next,l._error=o?function(c){try{o(c)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,l._complete=r?function(){try{r()}catch(c){t.error(c)}finally{this.unsubscribe()}}:n.prototype._complete,l}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Cv),qm={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,i=qm.delegate;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);var r=e(function(o){t=void 0,n(o)});return new Hl(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return requestAnimationFrame.apply(void 0,bs([],Wo(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,bs([],Wo(n)))},delegate:void 0},uP=wv(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ou=function(n){Tr(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new Oy(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new uP},e.prototype.next=function(t){var i=this;oh(function(){var r,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var s=wl(i.currentObservers),a=s.next();!a.done;a=s.next()){var l=a.value;l.next(t)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var i=this;oh(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var r=i.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;oh(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,r=this,o=r.hasError,s=r.isStopped,a=r.observers;return o||s?L1:(this.currentObservers=null,a.push(t),new Hl(function(){i.currentObservers=null,mh(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,r=i.hasError,o=i.thrownError,s=i.isStopped;r?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new hi;return t.source=this,t},e.create=function(t,i){return new Oy(t,i)},e}(hi),Oy=function(n){Tr(e,n);function e(t,i){var r=n.call(this)||this;return r.destination=t,r.source=i,r}return e.prototype.next=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)},e.prototype.error=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:L1},e}(ou),dP=function(n){Tr(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,r=t.thrownError,o=t._value;if(i)throw r;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(ou),Iv={now:function(){return(Iv.delegate||Date).now()},delegate:void 0},U1=function(n){Tr(e,n);function e(t,i,r){t===void 0&&(t=1/0),i===void 0&&(i=1/0),r===void 0&&(r=Iv);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=i,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=i===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,i),o}return e.prototype.next=function(t){var i=this,r=i.isStopped,o=i._buffer,s=i._infiniteTimeWindow,a=i._timestampProvider,l=i._windowTime;r||(o.push(t),!s&&o.push(a.now()+l)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var i=this._innerSubscribe(t),r=this,o=r._infiniteTimeWindow,s=r._buffer,a=s.slice(),l=0;l<a.length&&!t.closed;l+=o?1:2)t.next(a[l]);return this._checkFinalizedStatuses(t),i},e.prototype._trimBuffer=function(){var t=this,i=t._bufferSize,r=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*i;if(i<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var l=r.now(),c=0,u=1;u<o.length&&o[u]<=l;u+=2)c=u;c&&o.splice(0,c+1)}},e}(ou),hP=function(n){Tr(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e}(Hl),Py={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setInterval.apply(void 0,bs([n,e],Wo(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},j1=function(n){Tr(e,n);function e(t,i){var r=n.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(t,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(s,this.id,i),this},e.prototype.requestAsyncId=function(t,i,r){return r===void 0&&(r=0),Py.setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&Py.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var r=!1,o;try{this.work(t)}catch(s){r=!0,o=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,r=t.scheduler,o=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,mh(o,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(hP),My=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=Iv.now,n}(),K1=function(n){Tr(e,n);function e(t,i){i===void 0&&(i=My.now);var r=n.call(this,t,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var r;this._active=!0;do if(r=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,r){for(;t=i.shift();)t.unsubscribe();throw r}},e}(My),X1=new K1(j1),fP=X1,pP=function(n){Tr(e,n);function e(t,i){var r=n.call(this,t,i)||this;return r.scheduler=t,r.work=i,r}return e.prototype.requestAsyncId=function(t,i,r){return r===void 0&&(r=0),r!==null&&r>0?n.prototype.requestAsyncId.call(this,t,i,r):(t.actions.push(this),t._scheduled||(t._scheduled=qm.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,i,r){var o;if(r===void 0&&(r=0),r!=null?r>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,i,r);var s=t.actions;i!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==i&&(qm.cancelAnimationFrame(i),t._scheduled=void 0)},e}(j1),mP=function(n){Tr(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var r=this.actions,o;t=t||r.shift();do if(o=t.execute(t.state,t.delay))break;while((t=r[0])&&t.id===i&&r.shift());if(this._active=!1,o){for(;(t=r[0])&&t.id===i&&r.shift();)t.unsubscribe();throw o}},e}(K1),gP=new mP(pP),$v=new hi(function(n){return n.complete()});function vP(n){return n&&nn(n.schedule)}function q1(n){return n[n.length-1]}function sf(n){return vP(q1(n))?n.pop():void 0}function xP(n,e){return typeof q1(n)=="number"?n.pop():e}var Ev=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Y1(n){return nn(n==null?void 0:n.then)}function J1(n){return nn(n[Sv])}function Z1(n){return Symbol.asyncIterator&&nn(n==null?void 0:n[Symbol.asyncIterator])}function Q1(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function bP(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var eI=bP();function tI(n){return nn(n==null?void 0:n[eI])}function nI(n){return eP(this,arguments,function(){var t,i,r,o;return F1(this,function(s){switch(s.label){case 0:t=n.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,il(t.read())];case 3:return i=s.sent(),r=i.value,o=i.done,o?[4,il(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,il(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function iI(n){return nn(n==null?void 0:n.getReader)}function Rr(n){if(n instanceof hi)return n;if(n!=null){if(J1(n))return yP(n);if(Ev(n))return wP(n);if(Y1(n))return CP(n);if(Z1(n))return rI(n);if(tI(n))return SP(n);if(iI(n))return IP(n)}throw Q1(n)}function yP(n){return new hi(function(e){var t=n[Sv]();if(nn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function wP(n){return new hi(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function CP(n){return new hi(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,W1)})}function SP(n){return new hi(function(e){var t,i;try{for(var r=wl(n),o=r.next();!o.done;o=r.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.complete()})}function rI(n){return new hi(function(e){$P(n,e).catch(function(t){return e.error(t)})})}function IP(n){return rI(nI(n))}function $P(n,e){var t,i,r,o;return QO(this,void 0,void 0,function(){var s,a;return F1(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=tP(n),l.label=1;case 1:return[4,t.next()];case 2:if(i=l.sent(),!!i.done)return[3,4];if(s=i.value,e.next(s),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),r={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ia(n,e,t,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var o=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function oI(n,e){return e===void 0&&(e=0),ki(function(t,i){t.subscribe(lr(i,function(r){return ia(i,n,function(){return i.next(r)},e)},function(){return ia(i,n,function(){return i.complete()},e)},function(r){return ia(i,n,function(){return i.error(r)},e)}))})}function sI(n,e){return e===void 0&&(e=0),ki(function(t,i){i.add(n.schedule(function(){return t.subscribe(i)},e))})}function EP(n,e){return Rr(n).pipe(sI(e),oI(e))}function NP(n,e){return Rr(n).pipe(sI(e),oI(e))}function kP(n,e){return new hi(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function DP(n,e){return new hi(function(t){var i;return ia(t,e,function(){i=n[eI](),ia(t,e,function(){var r,o,s;try{r=i.next(),o=r.value,s=r.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return nn(i==null?void 0:i.return)&&i.return()}})}function aI(n,e){if(!n)throw new Error("Iterable cannot be null");return new hi(function(t){ia(t,e,function(){var i=n[Symbol.asyncIterator]();ia(t,e,function(){i.next().then(function(r){r.done?t.complete():t.next(r.value)})},0,!0)})})}function TP(n,e){return aI(nI(n),e)}function RP(n,e){if(n!=null){if(J1(n))return EP(n,e);if(Ev(n))return kP(n,e);if(Y1(n))return NP(n,e);if(Z1(n))return aI(n,e);if(tI(n))return DP(n,e);if(iI(n))return TP(n,e)}throw Q1(n)}function ra(n,e){return e?RP(n,e):Rr(n)}function af(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=sf(n);return ra(n,t)}var Nv=wv(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function lI(n,e){return new Promise(function(t,i){var r=new Cl({next:function(o){t(o),r.unsubscribe()},error:i,complete:function(){i(new Nv)}});n.subscribe(r)})}function _P(n){return n instanceof Date&&!isNaN(n)}function Sl(n,e){return ki(function(t,i){var r=0;t.subscribe(lr(i,function(o){i.next(n.call(e,o,r++))}))})}var AP=Array.isArray;function OP(n,e){return AP(e)?n.apply(void 0,bs([],Wo(e))):n(e)}function PP(n){return Sl(function(e){return OP(n,e)})}function MP(n,e,t,i,r,o,s,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(m){return c<i?p(m):l.push(m)},p=function(m){c++;var g=!1;Rr(t(m,u++)).subscribe(lr(e,function(v){e.next(v)},function(){g=!0},void 0,function(){if(g)try{c--;for(var v=function(){var x=l.shift();s||p(x)};l.length&&c<i;)v();f()}catch(x){e.error(x)}}))};return n.subscribe(lr(e,h,function(){d=!0,f()})),function(){}}function kv(n,e,t){return t===void 0&&(t=1/0),nn(e)?kv(function(i,r){return Sl(function(o,s){return e(i,o,r,s)})(Rr(n(i,r)))},t):(typeof e=="number"&&(t=e),ki(function(i,r){return MP(i,r,n,t)}))}function cI(n){return n===void 0&&(n=1/0),kv(ru,n)}function FP(){return cI(1)}function Ym(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return FP()(ra(n,sf(n)))}function LP(n){return new hi(function(e){Rr(n()).subscribe(e)})}var zP=["addListener","removeListener"],BP=["addEventListener","removeEventListener"],VP=["on","off"];function Jm(n,e,t,i){if(nn(t)&&(i=t,t=void 0),i)return Jm(n,e,t).pipe(PP(i));var r=Wo(HP(n)?BP.map(function(a){return function(l){return n[a](e,l,t)}}):WP(n)?zP.map(Fy(n,e)):GP(n)?VP.map(Fy(n,e)):[],2),o=r[0],s=r[1];if(!o&&Ev(n))return kv(function(a){return Jm(a,e,t)})(Rr(n));if(!o)throw new TypeError("Invalid event target");return new hi(function(a){var l=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return a.next(1<c.length?c:c[0])};return o(l),function(){return s(l)}})}function Fy(n,e){return function(t){return function(i){return n[t](e,i)}}}function WP(n){return nn(n.addListener)&&nn(n.removeListener)}function GP(n){return nn(n.on)&&nn(n.off)}function HP(n){return nn(n.addEventListener)&&nn(n.removeEventListener)}function uI(n,e,t){return n===void 0&&(n=0),t===void 0&&(t=fP),new hi(function(i){var r=_P(n)?+n-t.now():n;r<0&&(r=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),i.complete())},r)})}function UP(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=sf(n),i=xP(n,1/0),r=n;return r.length?r.length===1?Rr(r[0]):cI(i)(ra(r,t)):$v}function jP(n,e){return ki(function(t,i){var r=0;t.subscribe(lr(i,function(o){return n.call(e,o,r++)&&i.next(o)}))})}function Dv(n){return ki(function(e,t){var i=null,r=!1,o;i=e.subscribe(lr(t,void 0,void 0,function(s){o=Rr(n(s,Dv(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function KP(n,e){return e===void 0&&(e=X1),ki(function(t,i){var r=null,o=null,s=null,a=function(){if(r){r.unsubscribe(),r=null;var c=o;o=null,i.next(c)}};function l(){var c=s+n,u=e.now();if(u<c){r=this.schedule(void 0,c-u),i.add(r);return}a()}t.subscribe(lr(i,function(c){o=c,s=e.now(),r||(r=e.schedule(l,n),i.add(r))},function(){a(),i.complete()},void 0,function(){o=r=null}))})}function XP(n){return ki(function(e,t){var i=!1;e.subscribe(lr(t,function(r){i=!0,t.next(r)},function(){i||t.next(n),t.complete()}))})}function dI(n){return n<=0?function(){return $v}:ki(function(e,t){var i=0;e.subscribe(lr(t,function(r){++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function qP(n){return n===void 0&&(n=YP),ki(function(e,t){var i=!1;e.subscribe(lr(t,function(r){i=!0,t.next(r)},function(){return i?t.complete():t.error(n())}))})}function YP(){return new Nv}function JP(n){return ki(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function ZP(n,e){var t=arguments.length>=2;return function(i){return i.pipe(n?jP(function(r,o){return n(r,o,i)}):ru,dI(1),t?XP(e):qP(function(){return new Nv}))}}function hI(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new ou}:e,i=n.resetOnError,r=i===void 0?!0:i,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,l=a===void 0?!0:a;return function(c){var u,d,f,h=0,p=!1,m=!1,g=function(){d==null||d.unsubscribe(),d=void 0},v=function(){g(),u=f=void 0,p=m=!1},x=function(){var b=u;v(),b==null||b.unsubscribe()};return ki(function(b,w){h++,!m&&!p&&g();var y=f=f??t();w.add(function(){h--,h===0&&!m&&!p&&(d=im(x,l))}),y.subscribe(w),!u&&h>0&&(u=new Cl({next:function(C){return y.next(C)},error:function(C){m=!0,g(),d=im(v,r,C),y.error(C)},complete:function(){p=!0,g(),d=im(v,s),y.complete()}}),Rr(b).subscribe(u))})(c)}}function im(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];if(e===!0){n();return}if(e!==!1){var r=new Cl({next:function(){r.unsubscribe(),n()}});return Rr(e.apply(void 0,bs([],Wo(t)))).subscribe(r)}}function QP(n,e,t){var i,r,o,s,a=!1;return n&&typeof n=="object"?(i=n.bufferSize,s=i===void 0?1/0:i,r=n.windowTime,e=r===void 0?1/0:r,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n??1/0,hI({connector:function(){return new U1(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function eM(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=sf(n);return ki(function(i,r){(t?Ym(n,i,t):Ym(n,i)).subscribe(r)})}function Xs(n,e){return ki(function(t,i){var r=null,o=0,s=!1,a=function(){return s&&!r&&i.complete()};t.subscribe(lr(i,function(l){r==null||r.unsubscribe();var c=0,u=o++;Rr(n(l,u)).subscribe(r=lr(i,function(d){return i.next(e?e(l,d,u,c++):d)},function(){r=null,a()}))},function(){s=!0,a()}))})}function su(n,e,t){var i=nn(n)||e||t?{next:n,error:e,complete:t}:n;return i?ki(function(r,o){var s;(s=i.subscribe)===null||s===void 0||s.call(i);var a=!0;r.subscribe(lr(o,function(l){var c;(c=i.next)===null||c===void 0||c.call(i,l),o.next(l)},function(){var l;a=!1,(l=i.complete)===null||l===void 0||l.call(i),o.complete()},function(l){var c;a=!1,(c=i.error)===null||c===void 0||c.call(i,l),o.error(l)},function(){var l,c;a&&((l=i.unsubscribe)===null||l===void 0||l.call(i)),(c=i.finalize)===null||c===void 0||c.call(i)}))}):ru}function tM(n){const e=pl(n)?n:n.synced,t=pl(n)?i=>af(i):n.unsynced;return{synced:e,unsynced:t}}function nM(n){const{synced:e,unsynced:t}=tM(n);return Xs(i=>ml(i,{synced:e,unsynced:t}))}function iM(n=S_){return Dv(e=>af(m1(n(e))))}const fI={EXPONENTIAL:(n,e)=>Math.pow(2,n)*e+Math.random()*e/2,LINEAR:(n,e)=>n*e+Math.random()*e/2,STATIC:(n,e)=>e+Math.random()*e/2},rM={initialInterval:3e3,backoffDelay:fI.LINEAR,maxInterval:6e4,jitter:500};function oM(n){const{maxRetries:e,maxInterval:t,initialInterval:i,backoffDelay:r,needRetry:o,beforeRetry:s,jitter:a}={...rM,...n};let l=0;return sP(su(c=>{(!I_(c)||gl(c))&&(l=0)}),Dv((c,u)=>{if(l++,pl(o)&&!o(c,l)||!Km(e)&&l>e)throw c;const f=(r??fI.LINEAR)(l,i),h=(Km(t)?f:Math.min(f,t))+Math.random()*a;return Ym(pl(s)?s(c,l):$v,uI(h).pipe(Xs(()=>u)))}))}var sh=(n=>(n.Blocked="Blocked",n.Blocking="Blocking",n.Terminated="Terminated",n))(sh||{});function sM(n){return new hi(e=>{n(t=>e.error(new Error(`Database is in '${t}' state, reconnecting`))).then(t=>e.next(t),t=>e.error(t))})}function aM(){return oM({initialInterval:5e3,jitter:1e3})}function lM(n,e){for(;n.length<e;)n="0"+n;return n}function Ro(n,e){var t,i,r;if(e.length===0)return n;for(t=0,r=e.length;t<r;t++)i=e.charCodeAt(t),n=(n<<5)-n+i,n|=0;return n<0?n*-2:n}function cM(n,e,t){return Object.keys(e).sort().reduce(i,n);function i(r,o){return pI(r,e[o],o,t)}}function pI(n,e,t,i){var r=Ro(Ro(Ro(n,t),uM(e)),typeof e);if(e===null)return Ro(r,"null");if(e===void 0)return Ro(r,"undefined");if(typeof e=="object"||typeof e=="function"){if(i.indexOf(e)!==-1)return Ro(r,"[Circular]"+t);i.push(e);var o=cM(r,e,i);if(!("valueOf"in e)||typeof e.valueOf!="function")return o;try{return Ro(o,String(e.valueOf()))}catch(s){return Ro(o,"[valueOf exception]"+(s.stack||s.message))}}return Ro(r,e.toString())}function uM(n){return Object.prototype.toString.call(n)}function dM(n){return lM(pI(0,n,"",[]).toString(16),8)}var hM=dM;const fM=g1(hM);function pM(n,e){const t=new Map;return function(...r){const{group:o,delay:s}=e(r);t.has(o)||t.set(o,NO((...l)=>{n(...l),t.delete(o)},s)),t.get(o)(...r)}}function mM(n,e=1){return hI({connector:()=>new U1(e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:()=>uI(n)})}function gM(n=1){return QP({bufferSize:n,refCount:!0})}const vM=(...n)=>fM(n),xM=5e3;function Td(n,e={}){const t=e.normalize??vM,i=bM(e.replayCount??1,e.resetDelay,e.removeDelay,e.removeUnsubscribedDelay??xM);return(...r)=>i(t(r),()=>n(...r))}function bM(n,e,t,i){const r=new Map,o=u=>{const d=r.get(u);d!==void 0&&d.refCount===0&&r.delete(u)},s=t===void 0||t===0||!isFinite(t)?o:pM(o,([u])=>({group:u,delay:t})),a=(u,d)=>{const f=r.get(u);f!==void 0&&(f.refCount++,d())},l=u=>{const d=r.get(u);d!==void 0&&(d.refCount--,d.refCount===0&&s(u))},c=(u,d)=>{const f=setTimeout(()=>o(u),i);return{refCount:0,obs:d.pipe(e===void 0?ru:e===0?gM(n):mM(e,n),su({subscribe:a.bind(null,u,()=>clearTimeout(f)),finalize:l.bind(null,u)}))}};return(u,d)=>(r.has(u)||r.set(u,c(u,d())),r.get(u).obs)}function yM(n){return n&&typeof n.then=="function"}Promise.resolve(!1);Promise.resolve(!0);var oa=Promise.resolve();function mI(n,e){return n||(n=0),new Promise(function(t){return setTimeout(function(){return t(e)},n)})}function wM(n,e){return Math.floor(Math.random()*(e-n+1)+n)}function Tv(){return Math.random().toString(36).substring(2)}var rm=0;function au(){var n=Date.now()*1e3;return n<=rm&&(n=rm+1),rm=n,n}var CM=au,SM="native";function IM(n){var e={time:au(),messagesCallback:null,bc:new BroadcastChannel(n),subFns:[]};return e.bc.onmessage=function(t){e.messagesCallback&&e.messagesCallback(t.data)},e}function $M(n){n.bc.close(),n.subFns=[]}function EM(n,e){try{return n.bc.postMessage(e,!1),oa}catch(t){return Promise.reject(t)}}function NM(n,e){n.messagesCallback=e}function kM(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function DM(){return 150}var TM={create:IM,close:$M,onMessage:NM,postMessage:EM,canBeUsed:kM,type:SM,averageResponseTime:DM,microSeconds:CM};class gI{constructor(e){jn(this,"ttl");jn(this,"map",new Map);jn(this,"_to",!1);this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,vI()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,RM(this)},0))}clear(){this.map.clear()}}function RM(n){const e=vI()-n.ttl,t=n.map[Symbol.iterator]();for(;;){const i=t.next().value;if(!i)return;const r=i[0];if(i[1]<e)n.map.delete(r);else return}}function vI(){return Date.now()}function Rv(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=JSON.parse(JSON.stringify(n));return typeof e.webWorkerSupport>"u"&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=1e3*45),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),n.idb&&typeof n.idb.onclose=="function"&&(e.idb.onclose=n.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=1e3*60),n.methods&&(e.methods=n.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=1e3*60*2),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),typeof e.node.useFastPath>"u"&&(e.node.useFastPath=!0),e}var _M=au,AM="pubkey.broadcast-channel-0-",Go="messages",lf={durability:"relaxed"},OM="idb";function xI(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function _v(n){n.commit&&n.commit()}function PM(n){var e=xI(),t=AM+n,i=e.open(t);return i.onupgradeneeded=function(r){var o=r.target.result;o.createObjectStore(Go,{keyPath:"id",autoIncrement:!0})},new Promise(function(r,o){i.onerror=function(s){return o(s)},i.onsuccess=function(){r(i.result)}})}function MM(n,e,t){var i=Date.now(),r={uuid:e,time:i,data:t},o=n.transaction([Go],"readwrite",lf);return new Promise(function(s,a){o.oncomplete=function(){return s()},o.onerror=function(c){return a(c)};var l=o.objectStore(Go);l.add(r),_v(o)})}function FM(n,e){var t=n.transaction(Go,"readonly",lf),i=t.objectStore(Go),r=[],o=IDBKeyRange.bound(e+1,1/0);if(i.getAll){var s=i.getAll(o);return new Promise(function(l,c){s.onerror=function(u){return c(u)},s.onsuccess=function(u){l(u.target.result)}})}function a(){try{return o=IDBKeyRange.bound(e+1,1/0),i.openCursor(o)}catch{return i.openCursor()}}return new Promise(function(l,c){var u=a();u.onerror=function(d){return c(d)},u.onsuccess=function(d){var f=d.target.result;f?f.value.id<e+1?f.continue(e+1):(r.push(f.value),f.continue()):(_v(t),l(r))}})}function LM(n,e){if(n.closed)return Promise.resolve([]);var t=n.db.transaction(Go,"readwrite",lf),i=t.objectStore(Go);return Promise.all(e.map(function(r){var o=i.delete(r);return new Promise(function(s){o.onsuccess=function(){return s()}})}))}function zM(n,e){var t=Date.now()-e,i=n.transaction(Go,"readonly",lf),r=i.objectStore(Go),o=[];return new Promise(function(s){r.openCursor().onsuccess=function(a){var l=a.target.result;if(l){var c=l.value;c.time<t?(o.push(c),l.continue()):(_v(i),s(o))}else s(o)}})}function BM(n){return zM(n.db,n.options.idb.ttl).then(function(e){return LM(n,e.map(function(t){return t.id}))})}function VM(n,e){return e=Rv(e),PM(n).then(function(t){var i={closed:!1,lastCursorId:0,channelName:n,options:e,uuid:Tv(),eMIs:new gI(e.idb.ttl*2),writeBlockPromise:oa,messagesCallback:null,readQueuePromises:[],db:t};return t.onclose=function(){i.closed=!0,e.idb.onclose&&e.idb.onclose()},bI(i),i})}function bI(n){n.closed||yI(n).then(function(){return mI(n.options.idb.fallbackInterval)}).then(function(){return bI(n)})}function WM(n,e){return!(n.uuid===e.uuid||e.eMIs.has(n.id)||n.data.time<e.messagesCallbackTime)}function yI(n){return n.closed||!n.messagesCallback?oa:FM(n.db,n.lastCursorId).then(function(e){var t=e.filter(function(i){return!!i}).map(function(i){return i.id>n.lastCursorId&&(n.lastCursorId=i.id),i}).filter(function(i){return WM(i,n)}).sort(function(i,r){return i.time-r.time});return t.forEach(function(i){n.messagesCallback&&(n.eMIs.add(i.id),n.messagesCallback(i.data))}),oa})}function GM(n){n.closed=!0,n.db.close()}function HM(n,e){return n.writeBlockPromise=n.writeBlockPromise.then(function(){return MM(n.db,n.uuid,e)}).then(function(){wM(0,10)===0&&BM(n)}),n.writeBlockPromise}function UM(n,e,t){n.messagesCallbackTime=t,n.messagesCallback=e,yI(n)}function jM(){return!!xI()}function KM(n){return n.idb.fallbackInterval*2}var XM={create:VM,close:GM,onMessage:UM,postMessage:HM,canBeUsed:jM,type:OM,averageResponseTime:KM,microSeconds:_M},qM=au,YM="pubkey.broadcastChannel-",JM="localstorage";function wI(){var n;if(typeof window>"u")return null;try{n=window.localStorage,n=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return n}function CI(n){return YM+n}function ZM(n,e){return new Promise(function(t){mI().then(function(){var i=CI(n.channelName),r={token:Tv(),time:Date.now(),data:e,uuid:n.uuid},o=JSON.stringify(r);wI().setItem(i,o);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=i,s.newValue=o,window.dispatchEvent(s),t()})})}function QM(n,e){var t=CI(n),i=function(o){o.key===t&&e(JSON.parse(o.newValue))};return window.addEventListener("storage",i),i}function eF(n){window.removeEventListener("storage",n)}function tF(n,e){if(e=Rv(e),!SI())throw new Error("BroadcastChannel: localstorage cannot be used");var t=Tv(),i=new gI(e.localstorage.removeTimeout),r={channelName:n,uuid:t,eMIs:i};return r.listener=QM(n,function(o){r.messagesCallback&&o.uuid!==t&&(!o.token||i.has(o.token)||o.data.time&&o.data.time<r.messagesCallbackTime||(i.add(o.token),r.messagesCallback(o.data)))}),r}function nF(n){eF(n.listener)}function iF(n,e,t){n.messagesCallbackTime=t,n.messagesCallback=e}function SI(){var n=wI();if(!n)return!1;try{var e="__broadcastchannel_check";n.setItem(e,"works"),n.removeItem(e)}catch{return!1}return!0}function rF(){var n=120,e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?n*2:n}var oF={create:tF,close:nF,onMessage:iF,postMessage:ZM,canBeUsed:SI,type:JM,averageResponseTime:rF,microSeconds:qM},II=au,sF="simulate",Av=new Set;function aF(n){var e={time:II(),name:n,messagesCallback:null};return Av.add(e),e}function lF(n){Av.delete(n)}var $I=5;function cF(n,e){return new Promise(function(t){return setTimeout(function(){var i=Array.from(Av);i.forEach(function(r){r.name===n.name&&r!==n&&r.messagesCallback&&r.time<e.time&&r.messagesCallback(e)}),t()},$I)})}function uF(n,e){n.messagesCallback=e}function dF(){return!0}function hF(){return $I}var fF={create:aF,close:lF,onMessage:uF,postMessage:cF,canBeUsed:dF,type:sF,averageResponseTime:hF,microSeconds:II},Ly=[TM,XM,oF];function pF(n){var e=[].concat(n.methods,Ly).filter(Boolean);if(n.type){if(n.type==="simulate")return fF;var t=e.find(function(r){return r.type===n.type});if(t)return t;throw new Error("method-type "+n.type+" not found")}n.webWorkerSupport||(e=e.filter(function(r){return r.type!=="idb"}));var i=e.find(function(r){return r.canBeUsed()});if(i)return i;throw new Error("No usable method found in "+JSON.stringify(Ly.map(function(r){return r.type})))}var EI=new Set,mF=0,Ov=function(e,t){this.id=mF++,EI.add(this),this.name=e,zy&&(t=zy),this.options=Rv(t),this.method=pF(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,gF(this)};Ov._pubkey=!0;var zy;Ov.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return By(this,"message",e)},postInternal:function(e){return By(this,"internal",e)},set onmessage(n){var e=this.method.microSeconds(),t={time:e,fn:n};Wy(this,"message",this._onML),n&&typeof n=="function"?(this._onML=t,Vy(this,"message",t)):this._onML=null},addEventListener:function(e,t){var i=this.method.microSeconds(),r={time:i,fn:t};Vy(this,e,r)},removeEventListener:function(e,t){var i=this._addEL[e].find(function(r){return r.fn===t});Wy(this,e,i)},close:function(){var e=this;if(!this.closed){EI.delete(this),this.closed=!0;var t=this._prepP?this._prepP:oa;return this._onML=null,this._addEL.message=[],t.then(function(){return Promise.all(Array.from(e._uMP))}).then(function(){return Promise.all(e._befC.map(function(i){return i()}))}).then(function(){return e.method.close(e._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function By(n,e,t){var i=n.method.microSeconds(),r={time:i,type:e,data:t},o=n._prepP?n._prepP:oa;return o.then(function(){var s=n.method.postMessage(n._state,r);return n._uMP.add(s),s.catch().then(function(){return n._uMP.delete(s)}),s})}function gF(n){var e=n.method.create(n.name,n.options);yM(e)?(n._prepP=e,e.then(function(t){n._state=t})):n._state=e}function NI(n){return n._addEL.message.length>0||n._addEL.internal.length>0}function Vy(n,e,t){n._addEL[e].push(t),vF(n)}function Wy(n,e,t){n._addEL[e]=n._addEL[e].filter(function(i){return i!==t}),xF(n)}function vF(n){if(!n._iL&&NI(n)){var e=function(r){n._addEL[r.type].forEach(function(o){r.time>=o.time&&o.fn(r.data)})},t=n.method.microSeconds();n._prepP?n._prepP.then(function(){n._iL=!0,n.method.onMessage(n._state,e,t)}):(n._iL=!0,n.method.onMessage(n._state,e,t))}}function xF(n){if(n._iL&&!NI(n)){n._iL=!1;var e=n.method.microSeconds();n.method.onMessage(n._state,null,e)}}const Dc=new Map,rl=new Map;function kI(n){return Dc.has(n)||(Dc.set(n,new Ov(n)),rl.set(n,0)),rl.set(n,rl.get(n)+1),Dc.get(n)}function DI(n){const e=Dc.get(n),t=rl.get(n);t===1&&(e.close(),Dc.delete(n),rl.delete(n)),rl.set(n,t-1)}function bF(n){return ki((e,t)=>{const i=kI(n);e.pipe(JP(()=>DI(n))).subscribe(new H1(t,r=>{t.next(r),i.postMessage(r)}))})}function yF(n){return new hi(e=>{const t=kI(n),i=Jm(t,"message").subscribe(e);return()=>{DI(n),i.unsubscribe()}})}function wF(n){return e=>LP(()=>{const t=PO(i=>n(i));return e.pipe(su(t))})}function CF(n,e,{upgrade:t,blocked:i,blocking:r,terminated:o}={}){return $_(n,e,{upgrade:t,blocking(s,a,l){r==null||r(s,a,l),console.error(new Error(`IndexedDB ${n}: blocking`))},blocked(s,a,l){i==null||i(s,a,l),console.error(new Error(`IndexedDB ${n}: blocked`))},terminated(){o==null||o(),console.error(new Error(`IndexedDB ${n}: abnormally terminated the connection`))}}).then(s=>(s.onversionchange=a=>{a.target.close()},s))}async function SF(n){try{const t=(await self.indexedDB.databases()).find(({name:i})=>i===n);return t==null?void 0:t.version}catch{return}}function IF(){const{contextId:n}=S.useContext(E_);return ov(!$t(n),"ContextRef is not defined"),n}function TI(n,e){const t=qi(i=>{n($F(i))&&i.preventDefault()});S.useEffect(()=>{const i=e==null?void 0:e.current;if(!$t(i))return i.addEventListener("mousemove",t),i.addEventListener("mousedown",t),i.addEventListener("mouseup",t),()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mousedown",t),i.removeEventListener("mouseup",t)}},[t,n,e])}function $F(n){const{target:e,button:t,buttons:i,clientX:r,clientY:o}=n,{left:s,top:a}=e.getBoundingClientRect(),l=r-s,c=o-a;return{x:l,y:c,button:t,buttons:i}}function EF(n){const e=IF(),t=S.useMemo(()=>n(e),[n,e]),[i,r]=XO(void 0,[t]);return S.useEffect(()=>void t.then(r),[t,r]),i}function NF(n,e){const t=S.useMemo(()=>kF(n,e),[n]);return fA(t.unsubscribe),S.useSyncExternalStore(t.subscribe,t.getSnapshot)}function kF(n,e){let t=e,i=ph;const r=c=>{t=c,i()},o=()=>n.pipe(wF(r),KP(0,gP)).subscribe({next:r,error:c=>{throw c}}),s=()=>{l==null||l.unsubscribe(),i=ph,t=e},a=()=>t;let l;return{subscribe(c){return i=c,l=Km(l)||l.closed?o():l,t!==e&&i(),s},unsubscribe:s,getSnapshot:a}}var RI=function(e){if(sv()&&window.document.documentElement){var t=Array.isArray(e)?e:[e],i=window.document.documentElement;return t.some(function(r){return r in i.style})}return!1},DF=function(e,t){if(!RI(e))return!1;var i=document.createElement("div"),r=i.style[e];return i.style[e]=t,i.style[e]!==r};function TF(n,e){return!Array.isArray(n)&&e!==void 0?DF(n,e):RI(n)}var cf=function(e){var t=e.className,i=e.customizeIcon,r=e.customizeIconProps,o=e.children,s=e.onMouseDown,a=e.onClick,l=typeof i=="function"?i(r):i;return S.createElement("span",{className:t,onMouseDown:function(u){u.preventDefault(),s==null||s(u)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:a,"aria-hidden":!0},l!==void 0?l:S.createElement("span",{className:ye(t.split(/\s+/).map(function(c){return"".concat(c,"-icon")}))},o))},RF=function(e,t,i,r,o){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,a=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,c=le.useMemo(function(){if(vn(r)==="object")return r.clearIcon;if(o)return o},[r,o]),u=le.useMemo(function(){return!!(!s&&r&&(i.length||a)&&!(l==="combobox"&&a===""))},[r,s,i.length,a,l]);return{allowClear:u,clearIcon:le.createElement(cf,{className:"".concat(e,"-clear"),onMouseDown:t,customizeIcon:c},"")}},_I=S.createContext(null);function _F(){return S.useContext(_I)}function AF(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,e=S.useState(!1),t=ke(e,2),i=t[0],r=t[1],o=S.useRef(null),s=function(){window.clearTimeout(o.current)};S.useEffect(function(){return s},[]);var a=function(c,u){s(),o.current=window.setTimeout(function(){r(c),u&&u()},n)};return[i,a,s]}function AI(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:250,e=S.useRef(null),t=S.useRef(null);S.useEffect(function(){return function(){window.clearTimeout(t.current)}},[]);function i(r){(r||e.current===null)&&(e.current=r),window.clearTimeout(t.current),t.current=window.setTimeout(function(){e.current=null},n)}return[function(){return e.current},i]}function OF(n,e,t,i){var r=S.useRef(null);r.current={open:e,triggerOpen:t,customizedTrigger:i},S.useEffect(function(){function o(s){var a;if(!((a=r.current)!==null&&a!==void 0&&a.customizedTrigger)){var l=s.target;l.shadowRoot&&s.composed&&(l=s.composedPath()[0]||l),r.current.open&&n().filter(function(c){return c}).every(function(c){return!c.contains(l)&&c!==l})&&r.current.triggerOpen(!1)}}return window.addEventListener("mousedown",o),function(){return window.removeEventListener("mousedown",o)}},[])}function PF(n){return![Xe.ESC,Xe.SHIFT,Xe.BACKSPACE,Xe.TAB,Xe.WIN_KEY,Xe.ALT,Xe.META,Xe.WIN_KEY_RIGHT,Xe.CTRL,Xe.SEMICOLON,Xe.EQUALS,Xe.CAPS_LOCK,Xe.CONTEXT_MENU,Xe.F1,Xe.F2,Xe.F3,Xe.F4,Xe.F5,Xe.F6,Xe.F7,Xe.F8,Xe.F9,Xe.F10,Xe.F11,Xe.F12].includes(n)}var MF=function(e,t){var i,r=e.prefixCls,o=e.id,s=e.inputElement,a=e.disabled,l=e.tabIndex,c=e.autoFocus,u=e.autoComplete,d=e.editable,f=e.activeDescendantId,h=e.value,p=e.maxLength,m=e.onKeyDown,g=e.onMouseDown,v=e.onChange,x=e.onPaste,b=e.onCompositionStart,w=e.onCompositionEnd,y=e.open,C=e.attrs,$=s||S.createElement("input",null),I=$,E=I.ref,N=I.props,k=N.onKeyDown,D=N.onChange,_=N.onMouseDown,R=N.onCompositionStart,T=N.onCompositionEnd,A=N.style;return N_(!("maxLength"in $.props)),$=S.cloneElement($,me(me(me({type:"search"},N),{},{id:o,ref:tu(t,E),disabled:a,tabIndex:l,autoComplete:u||"off",autoFocus:c,className:ye("".concat(r,"-selection-search-input"),(i=$)===null||i===void 0||(i=i.props)===null||i===void 0?void 0:i.className),role:"combobox","aria-expanded":y||!1,"aria-haspopup":"listbox","aria-owns":"".concat(o,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(o,"_list"),"aria-activedescendant":y?f:void 0},C),{},{value:d?h:"",maxLength:p,readOnly:!d,unselectable:d?null:"on",style:me(me({},A),{},{opacity:d?null:0}),onKeyDown:function(P){m(P),k&&k(P)},onMouseDown:function(P){g(P),_&&_(P)},onChange:function(P){v(P),D&&D(P)},onCompositionStart:function(P){b(P),R&&R(P)},onCompositionEnd:function(P){w(P),T&&T(P)},onPaste:x})),$},OI=S.forwardRef(MF);function PI(n){return Array.isArray(n)?n:n!==void 0?[n]:[]}var FF=typeof window<"u"&&window.document&&window.document.documentElement,LF=FF;function zF(n){return n!=null}function BF(n){return!n&&n!==0}function Gy(n){return["string","number"].includes(vn(n))}function MI(n){var e=void 0;return n&&(Gy(n.title)?e=n.title.toString():Gy(n.label)&&(e=n.label.toString())),e}function VF(n,e){LF?S.useLayoutEffect(n,e):S.useEffect(n,e)}function WF(n){var e;return(e=n.key)!==null&&e!==void 0?e:n.value}var Hy=function(e){e.preventDefault(),e.stopPropagation()},GF=function(e){var t=e.id,i=e.prefixCls,r=e.values,o=e.open,s=e.searchValue,a=e.autoClearSearchValue,l=e.inputRef,c=e.placeholder,u=e.disabled,d=e.mode,f=e.showSearch,h=e.autoFocus,p=e.autoComplete,m=e.activeDescendantId,g=e.tabIndex,v=e.removeIcon,x=e.maxTagCount,b=e.maxTagTextLength,w=e.maxTagPlaceholder,y=w===void 0?function(ne){return"+ ".concat(ne.length," ...")}:w,C=e.tagRender,$=e.onToggleOpen,I=e.onRemove,E=e.onInputChange,N=e.onInputPaste,k=e.onInputKeyDown,D=e.onInputMouseDown,_=e.onInputCompositionStart,R=e.onInputCompositionEnd,T=S.useRef(null),A=S.useState(0),O=ke(A,2),P=O[0],M=O[1],z=S.useState(!1),L=ke(z,2),W=L[0],U=L[1],V="".concat(i,"-selection"),H=o||d==="multiple"&&a===!1||d==="tags"?s:"",Y=d==="tags"||d==="multiple"&&a===!1||f&&(o||W);VF(function(){M(T.current.scrollWidth)},[H]);var Q=function(se,ce,re,be,Ie){return S.createElement("span",{title:MI(se),className:ye("".concat(V,"-item"),J({},"".concat(V,"-item-disabled"),re))},S.createElement("span",{className:"".concat(V,"-item-content")},ce),be&&S.createElement(cf,{className:"".concat(V,"-item-remove"),onMouseDown:Hy,onClick:Ie,customizeIcon:v},""))},Z=function(se,ce,re,be,Ie,Ee){var Se=function(ge){Hy(ge),$(!o)};return S.createElement("span",{onMouseDown:Se},C({label:ce,value:se,disabled:re,closable:be,onClose:Ie,isMaxTag:!!Ee}))},pe=function(se){var ce=se.disabled,re=se.label,be=se.value,Ie=!u&&!ce,Ee=re;if(typeof b=="number"&&(typeof re=="string"||typeof re=="number")){var Se=String(Ee);Se.length>b&&(Ee="".concat(Se.slice(0,b),"..."))}var fe=function(we){we&&we.stopPropagation(),I(se)};return typeof C=="function"?Z(be,Ee,ce,Ie,fe):Q(se,Ee,ce,Ie,fe)},oe=function(se){var ce=typeof y=="function"?y(se):y;return typeof C=="function"?Z(void 0,ce,!1,!1,void 0,!0):Q({title:ce},ce,!1)},X=S.createElement("div",{className:"".concat(V,"-search"),style:{width:P},onFocus:function(){U(!0)},onBlur:function(){U(!1)}},S.createElement(OI,{ref:l,open:o,prefixCls:i,id:t,inputElement:null,disabled:u,autoFocus:h,autoComplete:p,editable:Y,activeDescendantId:m,value:H,onKeyDown:k,onMouseDown:D,onChange:E,onPaste:N,onCompositionStart:_,onCompositionEnd:R,tabIndex:g,attrs:Co(e,!0)}),S.createElement("span",{ref:T,className:"".concat(V,"-search-mirror"),"aria-hidden":!0},H,"")),j=S.createElement(k_,{prefixCls:"".concat(V,"-overflow"),data:r,renderItem:pe,renderRest:oe,suffix:X,itemKey:WF,maxCount:x});return S.createElement("span",{className:"".concat(V,"-wrap")},j,!r.length&&!H&&S.createElement("span",{className:"".concat(V,"-placeholder")},c))},HF=function(e){var t=e.inputElement,i=e.prefixCls,r=e.id,o=e.inputRef,s=e.disabled,a=e.autoFocus,l=e.autoComplete,c=e.activeDescendantId,u=e.mode,d=e.open,f=e.values,h=e.placeholder,p=e.tabIndex,m=e.showSearch,g=e.searchValue,v=e.activeValue,x=e.maxLength,b=e.onInputKeyDown,w=e.onInputMouseDown,y=e.onInputChange,C=e.onInputPaste,$=e.onInputCompositionStart,I=e.onInputCompositionEnd,E=e.title,N=S.useState(!1),k=ke(N,2),D=k[0],_=k[1],R=u==="combobox",T=R||m,A=f[0],O=g||"";R&&v&&!D&&(O=v),S.useEffect(function(){R&&_(!1)},[R,v]);var P=u!=="combobox"&&!d&&!m?!1:!!O,M=E===void 0?MI(A):E,z=S.useMemo(function(){return A?null:S.createElement("span",{className:"".concat(i,"-selection-placeholder"),style:P?{visibility:"hidden"}:void 0},h)},[A,P,h,i]);return S.createElement("span",{className:"".concat(i,"-selection-wrap")},S.createElement("span",{className:"".concat(i,"-selection-search")},S.createElement(OI,{ref:o,prefixCls:i,id:r,open:d,inputElement:t,disabled:s,autoFocus:a,autoComplete:l,editable:T,activeDescendantId:c,value:O,onKeyDown:b,onMouseDown:w,onChange:function(W){_(!0),y(W)},onPaste:C,onCompositionStart:$,onCompositionEnd:I,tabIndex:p,attrs:Co(e,!0),maxLength:R?x:void 0})),!R&&A?S.createElement("span",{className:"".concat(i,"-selection-item"),title:M,style:P?{visibility:"hidden"}:void 0},A.label):null,z)},UF=function(e,t){var i=S.useRef(null),r=S.useRef(!1),o=e.prefixCls,s=e.open,a=e.mode,l=e.showSearch,c=e.tokenWithEnter,u=e.disabled,d=e.prefix,f=e.autoClearSearchValue,h=e.onSearch,p=e.onSearchSubmit,m=e.onToggleOpen,g=e.onInputKeyDown,v=e.domRef;S.useImperativeHandle(t,function(){return{focus:function(M){i.current.focus(M)},blur:function(){i.current.blur()}}});var x=AI(0),b=ke(x,2),w=b[0],y=b[1],C=function(M){var z=M.which,L=i.current instanceof HTMLTextAreaElement;!L&&s&&(z===Xe.UP||z===Xe.DOWN)&&M.preventDefault(),g&&g(M),z===Xe.ENTER&&a==="tags"&&!r.current&&!s&&(p==null||p(M.target.value)),!(L&&!s&&~[Xe.UP,Xe.DOWN,Xe.LEFT,Xe.RIGHT].indexOf(z))&&PF(z)&&m(!0)},$=function(){y(!0)},I=S.useRef(null),E=function(M){h(M,!0,r.current)!==!1&&m(!0)},N=function(){r.current=!0},k=function(M){r.current=!1,a!=="combobox"&&E(M.target.value)},D=function(M){var z=M.target.value;if(c&&I.current&&/[\r\n]/.test(I.current)){var L=I.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");z=z.replace(L,I.current)}I.current=null,E(z)},_=function(M){var z=M.clipboardData,L=z==null?void 0:z.getData("text");I.current=L||""},R=function(M){var z=M.target;if(z!==i.current){var L=document.body.style.msTouchAction!==void 0;L?setTimeout(function(){i.current.focus()}):i.current.focus()}},T=function(M){var z=w();M.target!==i.current&&!z&&!(a==="combobox"&&u)&&M.preventDefault(),(a!=="combobox"&&(!l||!z)||!s)&&(s&&f!==!1&&h("",!0,!1),m())},A={inputRef:i,onInputKeyDown:C,onInputMouseDown:$,onInputChange:D,onInputPaste:_,onInputCompositionStart:N,onInputCompositionEnd:k},O=a==="multiple"||a==="tags"?S.createElement(GF,ze({},e,A)):S.createElement(HF,ze({},e,A));return S.createElement("div",{ref:v,className:"".concat(o,"-selector"),onClick:R,onMouseDown:T},d&&S.createElement("div",{className:"".concat(o,"-prefix")},d),O)},jF=S.forwardRef(UF),KF=["prefixCls","disabled","visible","children","popupElement","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","builtinPlacements","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],XF=function(e){var t=e===!0?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"}}},qF=function(e,t){var i=e.prefixCls;e.disabled;var r=e.visible,o=e.children,s=e.popupElement,a=e.animation,l=e.transitionName,c=e.dropdownStyle,u=e.dropdownClassName,d=e.direction,f=d===void 0?"ltr":d,h=e.placement,p=e.builtinPlacements,m=e.dropdownMatchSelectWidth,g=e.dropdownRender,v=e.dropdownAlign,x=e.getPopupContainer,b=e.empty,w=e.getTriggerDOMNode,y=e.onPopupVisibleChange,C=e.onPopupMouseEnter,$=En(e,KF),I="".concat(i,"-dropdown"),E=s;g&&(E=g(s));var N=S.useMemo(function(){return p||XF(m)},[p,m]),k=a?"".concat(I,"-").concat(a):l,D=typeof m=="number",_=S.useMemo(function(){return D?null:m===!1?"minWidth":"width"},[m,D]),R=c;D&&(R=me(me({},R),{},{width:m}));var T=S.useRef(null);return S.useImperativeHandle(t,function(){return{getPopupElement:function(){var O;return(O=T.current)===null||O===void 0?void 0:O.popupElement}}}),S.createElement(D_,ze({},$,{showAction:y?["click"]:[],hideAction:y?["click"]:[],popupPlacement:h||(f==="rtl"?"bottomRight":"bottomLeft"),builtinPlacements:N,prefixCls:I,popupTransitionName:k,popup:S.createElement("div",{onMouseEnter:C},E),ref:T,stretch:_,popupAlign:v,popupVisible:r,getPopupContainer:x,popupClassName:ye(u,J({},"".concat(I,"-empty"),b)),popupStyle:R,getTriggerDOMNode:w,onPopupVisibleChange:y}),o)},YF=S.forwardRef(qF);function Uy(n,e){var t=n.key,i;return"value"in n&&(i=n.value),t??(i!==void 0?i:"rc-index-key-".concat(e))}function Zm(n){return typeof n<"u"&&!Number.isNaN(n)}function FI(n,e){var t=n||{},i=t.label,r=t.value,o=t.options,s=t.groupLabel,a=i||(e?"children":"label");return{label:a,value:r||"value",options:o||"options",groupLabel:s||a}}function JF(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.fieldNames,i=e.childrenAsData,r=[],o=FI(t,!1),s=o.label,a=o.value,l=o.options,c=o.groupLabel;function u(d,f){Array.isArray(d)&&d.forEach(function(h){if(f||!(l in h)){var p=h[a];r.push({key:Uy(h,r.length),groupOption:f,data:h,label:h[s],value:p})}else{var m=h[c];m===void 0&&i&&(m=h.label),r.push({key:Uy(h,r.length),group:!0,data:h,label:m}),u(h[l],!0)}})}return u(n,!1),r}function Qm(n){var e=me({},n);return"props"in e||Object.defineProperty(e,"props",{get:function(){return Fo(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),e}}),e}var ZF=function(e,t,i){if(!t||!t.length)return null;var r=!1,o=function a(l,c){var u=T_(c),d=u[0],f=u.slice(1);if(!d)return[l];var h=l.split(d);return r=r||h.length>1,h.reduce(function(p,m){return[].concat(nt(p),nt(a(m,f)))},[]).filter(Boolean)},s=o(e,t);return r?typeof i<"u"?s.slice(0,i):s:null},Pv=S.createContext(null);function QF(n){var e=n.visible,t=n.values;if(!e)return null;var i=50;return S.createElement("span",{"aria-live":"polite",style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},"".concat(t.slice(0,i).map(function(r){var o=r.label,s=r.value;return["number","string"].includes(vn(o))?o:s}).join(", ")),t.length>i?", ...":null)}var eL=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","prefix","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],tL=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"],eg=function(e){return e==="tags"||e==="multiple"},nL=S.forwardRef(function(n,e){var t,i=n.id,r=n.prefixCls,o=n.className,s=n.showSearch,a=n.tagRender,l=n.direction,c=n.omitDomProps,u=n.displayValues,d=n.onDisplayValuesChange,f=n.emptyOptions,h=n.notFoundContent,p=h===void 0?"Not Found":h,m=n.onClear,g=n.mode,v=n.disabled,x=n.loading,b=n.getInputElement,w=n.getRawInputElement,y=n.open,C=n.defaultOpen,$=n.onDropdownVisibleChange,I=n.activeValue,E=n.onActiveValueChange,N=n.activeDescendantId,k=n.searchValue,D=n.autoClearSearchValue,_=n.onSearch,R=n.onSearchSplit,T=n.tokenSeparators,A=n.allowClear,O=n.prefix,P=n.suffixIcon,M=n.clearIcon,z=n.OptionList,L=n.animation,W=n.transitionName,U=n.dropdownStyle,V=n.dropdownClassName,H=n.dropdownMatchSelectWidth,Y=n.dropdownRender,Q=n.dropdownAlign,Z=n.placement,pe=n.builtinPlacements,oe=n.getPopupContainer,X=n.showAction,j=X===void 0?[]:X,ne=n.onFocus,se=n.onBlur,ce=n.onKeyUp,re=n.onKeyDown,be=n.onMouseDown,Ie=En(n,eL),Ee=eg(g),Se=(s!==void 0?s:Ee)||g==="combobox",fe=me({},Ie);tL.forEach(function(Tt){delete fe[Tt]}),c==null||c.forEach(function(Tt){delete fe[Tt]});var ge=S.useState(!1),we=ke(ge,2),ve=we[0],Ne=we[1];S.useEffect(function(){Ne(R_())},[]);var Ae=S.useRef(null),Ve=S.useRef(null),Ue=S.useRef(null),We=S.useRef(null),Le=S.useRef(null),lt=S.useRef(!1),ot=AF(),Me=ke(ot,3),Fe=Me[0],Ke=Me[1],Lt=Me[2];S.useImperativeHandle(e,function(){var Tt,mt;return{focus:(Tt=We.current)===null||Tt===void 0?void 0:Tt.focus,blur:(mt=We.current)===null||mt===void 0?void 0:mt.blur,scrollTo:function(ai){var yn;return(yn=Le.current)===null||yn===void 0?void 0:yn.scrollTo(ai)},nativeElement:Ae.current||Ve.current}});var Nt=S.useMemo(function(){var Tt;if(g!=="combobox")return k;var mt=(Tt=u[0])===null||Tt===void 0?void 0:Tt.value;return typeof mt=="string"||typeof mt=="number"?String(mt):""},[k,g,u]),Dt=g==="combobox"&&typeof b=="function"&&b()||null,kt=typeof w=="function"&&w(),_n=__(Ve,kt==null||(t=kt.props)===null||t===void 0?void 0:t.ref),oi=S.useState(!1),zt=ke(oi,2),yi=zt[0],on=zt[1];Yi(function(){on(!0)},[]);var bn=Vo(!1,{defaultValue:C,value:y}),Zt=ke(bn,2),Un=Zt[0],Yt=Zt[1],xt=yi?Un:!1,pn=!p&&f;(v||pn&&xt&&g==="combobox")&&(xt=!1);var _t=pn?!1:xt,Te=S.useCallback(function(Tt){var mt=Tt!==void 0?Tt:!xt;v||(Yt(mt),xt!==mt&&($==null||$(mt)))},[v,xt,Yt,$]),Ge=S.useMemo(function(){return(T||[]).some(function(Tt){return[`
`,`\r
`].includes(Tt)})},[T]),Ze=S.useContext(Pv)||{},it=Ze.maxCount,ft=Ze.rawValues,Ot=function(mt,si,ai){if(!(Ee&&Zm(it)&&(ft==null?void 0:ft.size)>=it)){var yn=!0,Qn=mt;E==null||E(null);var hr=ZF(mt,T,Zm(it)?it-ft.size:void 0),Wi=ai?null:hr;return g!=="combobox"&&Wi&&(Qn="",R==null||R(Wi),Te(!1),yn=!1),_&&Nt!==Qn&&_(Qn,{source:si?"typing":"effect"}),yn}},qe=function(mt){!mt||!mt.trim()||_(mt,{source:"submit"})};S.useEffect(function(){!xt&&!Ee&&g!=="combobox"&&Ot("",!1,!1)},[xt]),S.useEffect(function(){Un&&v&&Yt(!1),v&&!lt.current&&Ke(!1)},[v]);var et=AI(),pt=ke(et,2),dt=pt[0],Xt=pt[1],un=S.useRef(!1),An=function(mt){var si=dt(),ai=mt.key,yn=ai==="Enter";if(yn&&(g!=="combobox"&&mt.preventDefault(),xt||Te(!0)),Xt(!!Nt),ai==="Backspace"&&!si&&Ee&&!Nt&&u.length){for(var Qn=nt(u),hr=null,Wi=Qn.length-1;Wi>=0;Wi-=1){var Qr=Qn[Wi];if(!Qr.disabled){Qn.splice(Wi,1),hr=Qr;break}}hr&&d(Qn,{type:"remove",values:[hr]})}for(var eo=arguments.length,to=new Array(eo>1?eo-1:0),Ha=1;Ha<eo;Ha++)to[Ha-1]=arguments[Ha];if(xt&&(!yn||!un.current)){var gt;(gt=Le.current)===null||gt===void 0||gt.onKeyDown.apply(gt,[mt].concat(to))}yn&&(un.current=!0),re==null||re.apply(void 0,[mt].concat(to))},dn=function(mt){for(var si=arguments.length,ai=new Array(si>1?si-1:0),yn=1;yn<si;yn++)ai[yn-1]=arguments[yn];if(xt){var Qn;(Qn=Le.current)===null||Qn===void 0||Qn.onKeyUp.apply(Qn,[mt].concat(ai))}mt.key==="Enter"&&(un.current=!1),ce==null||ce.apply(void 0,[mt].concat(ai))},Ye=function(mt){var si=u.filter(function(ai){return ai!==mt});d(si,{type:"remove",values:[mt]})},Be=S.useRef(!1),ht=function(){Ke(!0),v||(ne&&!Be.current&&ne.apply(void 0,arguments),j.includes("focus")&&Te(!0)),Be.current=!0},Ut=function(){lt.current=!0,Ke(!1,function(){Be.current=!1,lt.current=!1,Te(!1)}),!v&&(Nt&&(g==="tags"?_(Nt,{source:"submit"}):g==="multiple"&&_("",{source:"blur"})),se&&se.apply(void 0,arguments))},Bt=[];S.useEffect(function(){return function(){Bt.forEach(function(Tt){return clearTimeout(Tt)}),Bt.splice(0,Bt.length)}},[]);var Jr=function(mt){var si,ai=mt.target,yn=(si=Ue.current)===null||si===void 0?void 0:si.getPopupElement();if(yn&&yn.contains(ai)){var Qn=setTimeout(function(){var eo=Bt.indexOf(Qn);if(eo!==-1&&Bt.splice(eo,1),Lt(),!ve&&!yn.contains(document.activeElement)){var to;(to=We.current)===null||to===void 0||to.focus()}});Bt.push(Qn)}for(var hr=arguments.length,Wi=new Array(hr>1?hr-1:0),Qr=1;Qr<hr;Qr++)Wi[Qr-1]=arguments[Qr];be==null||be.apply(void 0,[mt].concat(Wi))},Ti=S.useState({}),Pr=ke(Ti,2),Zr=Pr[1];function ns(){Zr({})}var tt;kt&&(tt=function(mt){Te(mt)}),OF(function(){var Tt;return[Ae.current,(Tt=Ue.current)===null||Tt===void 0?void 0:Tt.getPopupElement()]},_t,Te,!!kt);var It=S.useMemo(function(){return me(me({},n),{},{notFoundContent:p,open:xt,triggerOpen:_t,id:i,showSearch:Se,multiple:Ee,toggleOpen:Te})},[n,p,_t,xt,i,Se,Ee,Te]),Qt=!!P||x,nr;Qt&&(nr=S.createElement(cf,{className:ye("".concat(r,"-arrow"),J({},"".concat(r,"-arrow-loading"),x)),customizeIcon:P,customizeIconProps:{loading:x,searchValue:Nt,open:xt,focused:Fe,showSearch:Se}}));var To=function(){var mt;m==null||m(),(mt=We.current)===null||mt===void 0||mt.focus(),d([],{type:"clear",values:u}),Ot("",!1,!1)},hc=RF(r,To,u,A,M,v,Nt,g),qp=hc.allowClear,Yp=hc.clearIcon,Jp=S.createElement(z,{ref:Le}),kd=ye(r,o,J(J(J(J(J(J(J(J(J(J({},"".concat(r,"-focused"),Fe),"".concat(r,"-multiple"),Ee),"".concat(r,"-single"),!Ee),"".concat(r,"-allow-clear"),A),"".concat(r,"-show-arrow"),Qt),"".concat(r,"-disabled"),v),"".concat(r,"-loading"),x),"".concat(r,"-open"),xt),"".concat(r,"-customize-input"),Dt),"".concat(r,"-show-search"),Se)),zs=S.createElement(YF,{ref:Ue,disabled:v,prefixCls:r,visible:_t,popupElement:Jp,animation:L,transitionName:W,dropdownStyle:U,dropdownClassName:V,direction:l,dropdownMatchSelectWidth:H,dropdownRender:Y,dropdownAlign:Q,placement:Z,builtinPlacements:pe,getPopupContainer:oe,empty:f,getTriggerDOMNode:function(mt){return Ve.current||mt},onPopupVisibleChange:tt,onPopupMouseEnter:ns},kt?S.cloneElement(kt,{ref:_n}):S.createElement(jF,ze({},n,{domRef:Ve,prefixCls:r,inputElement:Dt,ref:We,id:i,prefix:O,showSearch:Se,autoClearSearchValue:D,mode:g,activeDescendantId:N,tagRender:a,values:u,open:xt,onToggleOpen:Te,activeValue:I,searchValue:Nt,onSearch:Ot,onSearchSubmit:qe,onRemove:Ye,tokenWithEnter:Ge}))),Bs;return kt?Bs=zs:Bs=S.createElement("div",ze({className:kd},fe,{ref:Ae,onMouseDown:Jr,onKeyDown:An,onKeyUp:dn,onFocus:ht,onBlur:Ut}),S.createElement(QF,{visible:Fe&&!xt,values:u}),zs,nr,qp&&Yp),S.createElement(_I.Provider,{value:It},Bs)}),Mv=function(){return null};Mv.isSelectOptGroup=!0;var Fv=function(){return null};Fv.isSelectOption=!0;var LI=S.forwardRef(function(n,e){var t=n.height,i=n.offsetY,r=n.offsetX,o=n.children,s=n.prefixCls,a=n.onInnerResize,l=n.innerProps,c=n.rtl,u=n.extra,d={},f={display:"flex",flexDirection:"column"};return i!==void 0&&(d={height:t,position:"relative",overflow:"hidden"},f=me(me({},f),{},J(J(J(J(J({transform:"translateY(".concat(i,"px)")},c?"marginRight":"marginLeft",-r),"position","absolute"),"left",0),"right",0),"top",0))),S.createElement("div",{style:d},S.createElement(Vl,{onResize:function(p){var m=p.offsetHeight;m&&a&&a()}},S.createElement("div",ze({style:f,className:ye(J({},"".concat(s,"-holder-inner"),s)),ref:e},l),o,u)))});LI.displayName="Filler";function iL(n){var e=n.children,t=n.setRef,i=S.useCallback(function(r){t(r)},[]);return S.cloneElement(e,{ref:i})}function rL(n,e,t,i,r,o,s,a){var l=a.getKey;return n.slice(e,t+1).map(function(c,u){var d=e+u,f=s(c,d,{style:{width:i},offsetX:r}),h=l(c);return S.createElement(iL,{key:h,setRef:function(m){return o(c,m)}},f)})}function oL(n,e,t){var i=n.length,r=e.length,o,s;if(i===0&&r===0)return null;i<r?(o=n,s=e):(o=e,s=n);var a={__EMPTY_ITEM__:!0};function l(p){return p!==void 0?t(p):a}for(var c=null,u=Math.abs(i-r)!==1,d=0;d<s.length;d+=1){var f=l(o[d]),h=l(s[d]);if(f!==h){c=d,u=u||f!==l(s[d+1]);break}}return c===null?null:{index:c,multiple:u}}function sL(n,e,t){var i=S.useState(n),r=ke(i,2),o=r[0],s=r[1],a=S.useState(null),l=ke(a,2),c=l[0],u=l[1];return S.useEffect(function(){var d=oL(o||[],n||[],e);(d==null?void 0:d.index)!==void 0&&u(n[d.index]),s(n)},[n]),[c]}var jy=(typeof navigator>"u"?"undefined":vn(navigator))==="object"&&/Firefox/i.test(navigator.userAgent);const zI=function(n,e,t,i){var r=S.useRef(!1),o=S.useRef(null);function s(){clearTimeout(o.current),r.current=!0,o.current=setTimeout(function(){r.current=!1},50)}var a=S.useRef({top:n,bottom:e,left:t,right:i});return a.current.top=n,a.current.bottom=e,a.current.left=t,a.current.right=i,function(l,c){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=l?c<0&&a.current.left||c>0&&a.current.right:c<0&&a.current.top||c>0&&a.current.bottom;return u&&d?(clearTimeout(o.current),r.current=!1):(!d||r.current)&&s(),!r.current&&d}};function aL(n,e,t,i,r,o,s){var a=S.useRef(0),l=S.useRef(null),c=S.useRef(null),u=S.useRef(!1),d=zI(e,t,i,r);function f(x,b){if(Mi.cancel(l.current),!d(!1,b)){var w=x;if(!w._virtualHandled)w._virtualHandled=!0;else return;a.current+=b,c.current=b,jy||w.preventDefault(),l.current=Mi(function(){var y=u.current?10:1;s(a.current*y,!1),a.current=0})}}function h(x,b){s(b,!0),jy||x.preventDefault()}var p=S.useRef(null),m=S.useRef(null);function g(x){if(n){Mi.cancel(m.current),m.current=Mi(function(){p.current=null},2);var b=x.deltaX,w=x.deltaY,y=x.shiftKey,C=b,$=w;(p.current==="sx"||!p.current&&y&&w&&!b)&&(C=w,$=0,p.current="sx");var I=Math.abs(C),E=Math.abs($);p.current===null&&(p.current=o&&I>E?"x":"y"),p.current==="y"?f(x,$):h(x,C)}}function v(x){n&&(u.current=x.detail===c.current)}return[g,v]}function lL(n,e,t,i){var r=S.useMemo(function(){return[new Map,[]]},[n,t.id,i]),o=ke(r,2),s=o[0],a=o[1],l=function(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u,f=s.get(u),h=s.get(d);if(f===void 0||h===void 0)for(var p=n.length,m=a.length;m<p;m+=1){var g,v=n[m],x=e(v);s.set(x,m);var b=(g=t.get(x))!==null&&g!==void 0?g:i;if(a[m]=(a[m-1]||0)+b,x===u&&(f=m),x===d&&(h=m),f!==void 0&&h!==void 0)break}return{top:a[f-1]||0,bottom:a[h]}};return l}var cL=function(){function n(){lv(this,n),J(this,"maps",void 0),J(this,"id",0),this.maps=Object.create(null)}return av(n,[{key:"set",value:function(t,i){this.maps[t]=i,this.id+=1}},{key:"get",value:function(t){return this.maps[t]}}]),n}();function Ky(n){var e=parseFloat(n);return isNaN(e)?0:e}function uL(n,e,t){var i=S.useState(0),r=ke(i,2),o=r[0],s=r[1],a=S.useRef(new Map),l=S.useRef(new cL),c=S.useRef();function u(){Mi.cancel(c.current)}function d(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;u();var p=function(){a.current.forEach(function(g,v){if(g&&g.offsetParent){var x=A_(g),b=x.offsetHeight,w=getComputedStyle(x),y=w.marginTop,C=w.marginBottom,$=Ky(y),I=Ky(C),E=b+$+I;l.current.get(v)!==E&&l.current.set(v,E)}}),s(function(g){return g+1})};h?p():c.current=Mi(p)}function f(h,p){var m=n(h);a.current.get(m),p?(a.current.set(m,p),d()):a.current.delete(m)}return S.useEffect(function(){return u},[]),[f,d,l.current,o]}var Xy=14/15;function dL(n,e,t){var i=S.useRef(!1),r=S.useRef(0),o=S.useRef(0),s=S.useRef(null),a=S.useRef(null),l,c=function(h){if(i.current){var p=Math.ceil(h.touches[0].pageX),m=Math.ceil(h.touches[0].pageY),g=r.current-p,v=o.current-m,x=Math.abs(g)>Math.abs(v);x?r.current=p:o.current=m;var b=t(x,x?g:v,!1,h);b&&h.preventDefault(),clearInterval(a.current),b&&(a.current=setInterval(function(){x?g*=Xy:v*=Xy;var w=Math.floor(x?g:v);(!t(x,w,!0)||Math.abs(w)<=.1)&&clearInterval(a.current)},16))}},u=function(){i.current=!1,l()},d=function(h){l(),h.touches.length===1&&!i.current&&(i.current=!0,r.current=Math.ceil(h.touches[0].pageX),o.current=Math.ceil(h.touches[0].pageY),s.current=h.target,s.current.addEventListener("touchmove",c,{passive:!1}),s.current.addEventListener("touchend",u,{passive:!0}))};l=function(){s.current&&(s.current.removeEventListener("touchmove",c),s.current.removeEventListener("touchend",u))},Yi(function(){return n&&e.current.addEventListener("touchstart",d,{passive:!0}),function(){var f;(f=e.current)===null||f===void 0||f.removeEventListener("touchstart",d),l(),clearInterval(a.current)}},[n])}var hL=10;function fL(n,e,t,i,r,o,s,a){var l=S.useRef(),c=S.useState(null),u=ke(c,2),d=u[0],f=u[1];return Yi(function(){if(d&&d.times<hL){if(!n.current){f(function(M){return me({},M)});return}o();var h=d.targetAlign,p=d.originAlign,m=d.index,g=d.offset,v=n.current.clientHeight,x=!1,b=h,w=null;if(v){for(var y=h||p,C=0,$=0,I=0,E=Math.min(e.length-1,m),N=0;N<=E;N+=1){var k=r(e[N]);$=C;var D=t.get(k);I=$+(D===void 0?i:D),C=I}for(var _=y==="top"?g:v-g,R=E;R>=0;R-=1){var T=r(e[R]),A=t.get(T);if(A===void 0){x=!0;break}if(_-=A,_<=0)break}switch(y){case"top":w=$-g;break;case"bottom":w=I-v+g;break;default:{var O=n.current.scrollTop,P=O+v;$<O?b="top":I>P&&(b="bottom")}}w!==null&&s(w),w!==d.lastTop&&(x=!0)}x&&f(me(me({},d),{},{times:d.times+1,targetAlign:b,lastTop:w}))}},[d,n.current]),function(h){if(h==null){a();return}if(Mi.cancel(l.current),typeof h=="number")s(h);else if(h&&vn(h)==="object"){var p,m=h.align;"index"in h?p=h.index:p=e.findIndex(function(x){return r(x)===h.key});var g=h.offset,v=g===void 0?0:g;f({times:0,index:p,offset:v,originAlign:m})}}}function qy(n,e){var t="touches"in n?n.touches[0]:n;return t[e?"pageX":"pageY"]}var Yy=S.forwardRef(function(n,e){var t=n.prefixCls,i=n.rtl,r=n.scrollOffset,o=n.scrollRange,s=n.onStartMove,a=n.onStopMove,l=n.onScroll,c=n.horizontal,u=n.spinSize,d=n.containerSize,f=n.style,h=n.thumbStyle,p=S.useState(!1),m=ke(p,2),g=m[0],v=m[1],x=S.useState(null),b=ke(x,2),w=b[0],y=b[1],C=S.useState(null),$=ke(C,2),I=$[0],E=$[1],N=!i,k=S.useRef(),D=S.useRef(),_=S.useState(!1),R=ke(_,2),T=R[0],A=R[1],O=S.useRef(),P=function(){clearTimeout(O.current),A(!0),O.current=setTimeout(function(){A(!1)},3e3)},M=o-d||0,z=d-u||0,L=S.useMemo(function(){if(r===0||M===0)return 0;var oe=r/M;return oe*z},[r,M,z]),W=function(X){X.stopPropagation(),X.preventDefault()},U=S.useRef({top:L,dragging:g,pageY:w,startTop:I});U.current={top:L,dragging:g,pageY:w,startTop:I};var V=function(X){v(!0),y(qy(X,c)),E(U.current.top),s(),X.stopPropagation(),X.preventDefault()};S.useEffect(function(){var oe=function(se){se.preventDefault()},X=k.current,j=D.current;return X.addEventListener("touchstart",oe,{passive:!1}),j.addEventListener("touchstart",V,{passive:!1}),function(){X.removeEventListener("touchstart",oe),j.removeEventListener("touchstart",V)}},[]);var H=S.useRef();H.current=M;var Y=S.useRef();Y.current=z,S.useEffect(function(){if(g){var oe,X=function(se){var ce=U.current,re=ce.dragging,be=ce.pageY,Ie=ce.startTop;Mi.cancel(oe);var Ee=k.current.getBoundingClientRect(),Se=d/(c?Ee.width:Ee.height);if(re){var fe=(qy(se,c)-be)*Se,ge=Ie;!N&&c?ge-=fe:ge+=fe;var we=H.current,ve=Y.current,Ne=ve?ge/ve:0,Ae=Math.ceil(Ne*we);Ae=Math.max(Ae,0),Ae=Math.min(Ae,we),oe=Mi(function(){l(Ae,c)})}},j=function(){v(!1),a()};return window.addEventListener("mousemove",X,{passive:!0}),window.addEventListener("touchmove",X,{passive:!0}),window.addEventListener("mouseup",j,{passive:!0}),window.addEventListener("touchend",j,{passive:!0}),function(){window.removeEventListener("mousemove",X),window.removeEventListener("touchmove",X),window.removeEventListener("mouseup",j),window.removeEventListener("touchend",j),Mi.cancel(oe)}}},[g]),S.useEffect(function(){return P(),function(){clearTimeout(O.current)}},[r]),S.useImperativeHandle(e,function(){return{delayHidden:P}});var Q="".concat(t,"-scrollbar"),Z={position:"absolute",visibility:T?null:"hidden"},pe={position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"};return c?(Z.height=8,Z.left=0,Z.right=0,Z.bottom=0,pe.height="100%",pe.width=u,N?pe.left=L:pe.right=L):(Z.width=8,Z.top=0,Z.bottom=0,N?Z.right=0:Z.left=0,pe.width="100%",pe.height=u,pe.top=L),S.createElement("div",{ref:k,className:ye(Q,J(J(J({},"".concat(Q,"-horizontal"),c),"".concat(Q,"-vertical"),!c),"".concat(Q,"-visible"),T)),style:me(me({},Z),f),onMouseDown:W,onMouseMove:P},S.createElement("div",{ref:D,className:ye("".concat(Q,"-thumb"),J({},"".concat(Q,"-thumb-moving"),g)),style:me(me({},pe),h),onMouseDown:V}))}),pL=20;function Jy(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=n/e*n;return isNaN(t)&&(t=0),t=Math.max(t,pL),Math.floor(t)}var mL=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles"],gL=[],vL={overflowY:"auto",overflowAnchor:"none"};function xL(n,e){var t=n.prefixCls,i=t===void 0?"rc-virtual-list":t,r=n.className,o=n.height,s=n.itemHeight,a=n.fullHeight,l=a===void 0?!0:a,c=n.style,u=n.data,d=n.children,f=n.itemKey,h=n.virtual,p=n.direction,m=n.scrollWidth,g=n.component,v=g===void 0?"div":g,x=n.onScroll,b=n.onVirtualScroll,w=n.onVisibleChange,y=n.innerProps,C=n.extraRender,$=n.styles,I=En(n,mL),E=S.useCallback(function(Ye){return typeof f=="function"?f(Ye):Ye==null?void 0:Ye[f]},[f]),N=uL(E),k=ke(N,4),D=k[0],_=k[1],R=k[2],T=k[3],A=!!(h!==!1&&o&&s),O=S.useMemo(function(){return Object.values(R.maps).reduce(function(Ye,Be){return Ye+Be},0)},[R.id,R.maps]),P=A&&u&&(Math.max(s*u.length,O)>o||!!m),M=p==="rtl",z=ye(i,J({},"".concat(i,"-rtl"),M),r),L=u||gL,W=S.useRef(),U=S.useRef(),V=S.useRef(),H=S.useState(0),Y=ke(H,2),Q=Y[0],Z=Y[1],pe=S.useState(0),oe=ke(pe,2),X=oe[0],j=oe[1],ne=S.useState(!1),se=ke(ne,2),ce=se[0],re=se[1],be=function(){re(!0)},Ie=function(){re(!1)},Ee={getKey:E};function Se(Ye){Z(function(Be){var ht;typeof Ye=="function"?ht=Ye(Be):ht=Ye;var Ut=zt(ht);return W.current.scrollTop=Ut,Ut})}var fe=S.useRef({start:0,end:L.length}),ge=S.useRef(),we=sL(L,E),ve=ke(we,1),Ne=ve[0];ge.current=Ne;var Ae=S.useMemo(function(){if(!A)return{scrollHeight:void 0,start:0,end:L.length-1,offset:void 0};if(!P){var Ye;return{scrollHeight:((Ye=U.current)===null||Ye===void 0?void 0:Ye.offsetHeight)||0,start:0,end:L.length-1,offset:void 0}}for(var Be=0,ht,Ut,Bt,Jr=L.length,Ti=0;Ti<Jr;Ti+=1){var Pr=L[Ti],Zr=E(Pr),ns=R.get(Zr),tt=Be+(ns===void 0?s:ns);tt>=Q&&ht===void 0&&(ht=Ti,Ut=Be),tt>Q+o&&Bt===void 0&&(Bt=Ti),Be=tt}return ht===void 0&&(ht=0,Ut=0,Bt=Math.ceil(o/s)),Bt===void 0&&(Bt=L.length-1),Bt=Math.min(Bt+1,L.length-1),{scrollHeight:Be,start:ht,end:Bt,offset:Ut}},[P,A,Q,L,T,o]),Ve=Ae.scrollHeight,Ue=Ae.start,We=Ae.end,Le=Ae.offset;fe.current.start=Ue,fe.current.end=We;var lt=S.useState({width:0,height:o}),ot=ke(lt,2),Me=ot[0],Fe=ot[1],Ke=function(Be){Fe({width:Be.offsetWidth,height:Be.offsetHeight})},Lt=S.useRef(),Nt=S.useRef(),Dt=S.useMemo(function(){return Jy(Me.width,m)},[Me.width,m]),kt=S.useMemo(function(){return Jy(Me.height,Ve)},[Me.height,Ve]),_n=Ve-o,oi=S.useRef(_n);oi.current=_n;function zt(Ye){var Be=Ye;return Number.isNaN(oi.current)||(Be=Math.min(Be,oi.current)),Be=Math.max(Be,0),Be}var yi=Q<=0,on=Q>=_n,bn=X<=0,Zt=X>=m,Un=zI(yi,on,bn,Zt),Yt=function(){return{x:M?-X:X,y:Q}},xt=S.useRef(Yt()),pn=Nr(function(Ye){if(b){var Be=me(me({},Yt()),Ye);(xt.current.x!==Be.x||xt.current.y!==Be.y)&&(b(Be),xt.current=Be)}});function _t(Ye,Be){var ht=Ye;Be?(Um.flushSync(function(){j(ht)}),pn()):Se(ht)}function Te(Ye){var Be=Ye.currentTarget.scrollTop;Be!==Q&&Se(Be),x==null||x(Ye),pn()}var Ge=function(Be){var ht=Be,Ut=m?m-Me.width:0;return ht=Math.max(ht,0),ht=Math.min(ht,Ut),ht},Ze=Nr(function(Ye,Be){Be?(Um.flushSync(function(){j(function(ht){var Ut=ht+(M?-Ye:Ye);return Ge(Ut)})}),pn()):Se(function(ht){var Ut=ht+Ye;return Ut})}),it=aL(A,yi,on,bn,Zt,!!m,Ze),ft=ke(it,2),Ot=ft[0],qe=ft[1];dL(A,W,function(Ye,Be,ht,Ut){var Bt=Ut;return Un(Ye,Be,ht)?!1:!Bt||!Bt._virtualHandled?(Bt&&(Bt._virtualHandled=!0),Ot({preventDefault:function(){},deltaX:Ye?Be:0,deltaY:Ye?0:Be}),!0):!1}),Yi(function(){function Ye(ht){var Ut=yi&&ht.detail<0,Bt=on&&ht.detail>0;A&&!Ut&&!Bt&&ht.preventDefault()}var Be=W.current;return Be.addEventListener("wheel",Ot,{passive:!1}),Be.addEventListener("DOMMouseScroll",qe,{passive:!0}),Be.addEventListener("MozMousePixelScroll",Ye,{passive:!1}),function(){Be.removeEventListener("wheel",Ot),Be.removeEventListener("DOMMouseScroll",qe),Be.removeEventListener("MozMousePixelScroll",Ye)}},[A,yi,on]),Yi(function(){if(m){var Ye=Ge(X);j(Ye),pn({x:Ye})}},[Me.width,m]);var et=function(){var Be,ht;(Be=Lt.current)===null||Be===void 0||Be.delayHidden(),(ht=Nt.current)===null||ht===void 0||ht.delayHidden()},pt=fL(W,L,R,s,E,function(){return _(!0)},Se,et);S.useImperativeHandle(e,function(){return{nativeElement:V.current,getScrollInfo:Yt,scrollTo:function(Be){function ht(Ut){return Ut&&vn(Ut)==="object"&&("left"in Ut||"top"in Ut)}ht(Be)?(Be.left!==void 0&&j(Ge(Be.left)),pt(Be.top)):pt(Be)}}}),Yi(function(){if(w){var Ye=L.slice(Ue,We+1);w(Ye,L)}},[Ue,We,L]);var dt=lL(L,E,R,s),Xt=C==null?void 0:C({start:Ue,end:We,virtual:P,offsetX:X,offsetY:Le,rtl:M,getSize:dt}),un=rL(L,Ue,We,m,X,D,d,Ee),An=null;o&&(An=me(J({},l?"height":"maxHeight",o),vL),A&&(An.overflowY="hidden",m&&(An.overflowX="hidden"),ce&&(An.pointerEvents="none")));var dn={};return M&&(dn.dir="rtl"),S.createElement("div",ze({ref:V,style:me(me({},c),{},{position:"relative"}),className:z},dn,I),S.createElement(Vl,{onResize:Ke},S.createElement(v,{className:"".concat(i,"-holder"),style:An,ref:W,onScroll:Te,onMouseEnter:et},S.createElement(LI,{prefixCls:i,height:Ve,offsetX:X,offsetY:Le,scrollWidth:m,onInnerResize:_,ref:U,innerProps:y,rtl:M,extra:Xt},un))),P&&Ve>o&&S.createElement(Yy,{ref:Lt,prefixCls:i,scrollOffset:Q,scrollRange:Ve,rtl:M,onScroll:_t,onStartMove:be,onStopMove:Ie,spinSize:kt,containerSize:Me.height,style:$==null?void 0:$.verticalScrollBar,thumbStyle:$==null?void 0:$.verticalScrollBarThumb}),P&&m>Me.width&&S.createElement(Yy,{ref:Nt,prefixCls:i,scrollOffset:X,scrollRange:m,rtl:M,onScroll:_t,onStartMove:be,onStopMove:Ie,spinSize:Dt,containerSize:Me.width,horizontal:!0,style:$==null?void 0:$.horizontalScrollBar,thumbStyle:$==null?void 0:$.horizontalScrollBarThumb}))}var uf=S.forwardRef(xL);uf.displayName="List";function bL(){return/(mac\sos|macintosh)/i.test(navigator.appVersion)}var yL=["disabled","title","children","style","className"];function Zy(n){return typeof n=="string"||typeof n=="number"}var wL=function(e,t){var i=_F(),r=i.prefixCls,o=i.id,s=i.open,a=i.multiple,l=i.mode,c=i.searchValue,u=i.toggleOpen,d=i.notFoundContent,f=i.onPopupScroll,h=S.useContext(Pv),p=h.maxCount,m=h.flattenOptions,g=h.onActiveValue,v=h.defaultActiveFirstOption,x=h.onSelect,b=h.menuItemSelectedIcon,w=h.rawValues,y=h.fieldNames,C=h.virtual,$=h.direction,I=h.listHeight,E=h.listItemHeight,N=h.optionRender,k="".concat(r,"-item"),D=cv(function(){return m},[s,m],function(X,j){return j[0]&&X[1]!==j[1]}),_=S.useRef(null),R=S.useMemo(function(){return a&&Zm(p)&&(w==null?void 0:w.size)>=p},[a,p,w==null?void 0:w.size]),T=function(j){j.preventDefault()},A=function(j){var ne;(ne=_.current)===null||ne===void 0||ne.scrollTo(typeof j=="number"?{index:j}:j)},O=function(j){for(var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,se=D.length,ce=0;ce<se;ce+=1){var re=(j+ce*ne+se)%se,be=D[re]||{},Ie=be.group,Ee=be.data;if(!Ie&&!(Ee!=null&&Ee.disabled)&&!R)return re}return-1},P=S.useState(function(){return O(0)}),M=ke(P,2),z=M[0],L=M[1],W=function(j){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;L(j);var se={source:ne?"keyboard":"mouse"},ce=D[j];if(!ce){g(null,-1,se);return}g(ce.value,j,se)};S.useEffect(function(){W(v!==!1?O(0):-1)},[D.length,c]);var U=S.useCallback(function(X){return l==="combobox"?!1:w.has(X)},[l,nt(w).toString(),w.size]),V=S.useCallback(function(X){return l==="combobox"?String(X).toLowerCase()===c.toLowerCase():w.has(X)},[l,c,nt(w).toString(),w.size]);S.useEffect(function(){var X=setTimeout(function(){if(!a&&s&&w.size===1){var ne=Array.from(w)[0],se=D.findIndex(function(ce){var re=ce.data;return re.value===ne});se!==-1&&(W(se),A(se))}});if(s){var j;(j=_.current)===null||j===void 0||j.scrollTo(void 0)}return function(){return clearTimeout(X)}},[s,c]);var H=function(j){j!==void 0&&x(j,{selected:!w.has(j)}),a||u(!1)};if(S.useImperativeHandle(t,function(){return{onKeyDown:function(j){var ne=j.which,se=j.ctrlKey;switch(ne){case Xe.N:case Xe.P:case Xe.UP:case Xe.DOWN:{var ce=0;if(ne===Xe.UP?ce=-1:ne===Xe.DOWN?ce=1:bL()&&se&&(ne===Xe.N?ce=1:ne===Xe.P&&(ce=-1)),ce!==0){var re=O(z+ce,ce);A(re),W(re,!0)}break}case Xe.TAB:case Xe.ENTER:{var be,Ie=D[z];Ie&&!(Ie!=null&&(be=Ie.data)!==null&&be!==void 0&&be.disabled)&&!R?H(Ie.value):H(void 0),s&&j.preventDefault();break}case Xe.ESC:u(!1),s&&j.stopPropagation()}},onKeyUp:function(){},scrollTo:function(j){A(j)}}}),D.length===0)return S.createElement("div",{role:"listbox",id:"".concat(o,"_list"),className:"".concat(k,"-empty"),onMouseDown:T},d);var Y=Object.keys(y).map(function(X){return y[X]}),Q=function(j){return j.label};function Z(X,j){var ne=X.group;return{role:ne?"presentation":"option",id:"".concat(o,"_list_").concat(j)}}var pe=function(j){var ne=D[j];if(!ne)return null;var se=ne.data||{},ce=se.value,re=ne.group,be=Co(se,!0),Ie=Q(ne);return ne?S.createElement("div",ze({"aria-label":typeof Ie=="string"&&!re?Ie:null},be,{key:j},Z(ne,j),{"aria-selected":V(ce)}),ce):null},oe={role:"listbox",id:"".concat(o,"_list")};return S.createElement(S.Fragment,null,C&&S.createElement("div",ze({},oe,{style:{height:0,width:0,overflow:"hidden"}}),pe(z-1),pe(z),pe(z+1)),S.createElement(uf,{itemKey:"key",ref:_,data:D,height:I,itemHeight:E,fullHeight:!1,onMouseDown:T,onScroll:f,virtual:C,direction:$,innerProps:C?null:oe},function(X,j){var ne=X.group,se=X.groupOption,ce=X.data,re=X.label,be=X.value,Ie=ce.key;if(ne){var Ee,Se=(Ee=ce.title)!==null&&Ee!==void 0?Ee:Zy(re)?re.toString():void 0;return S.createElement("div",{className:ye(k,"".concat(k,"-group"),ce.className),title:Se},re!==void 0?re:Ie)}var fe=ce.disabled,ge=ce.title;ce.children;var we=ce.style,ve=ce.className,Ne=En(ce,yL),Ae=Da(Ne,Y),Ve=U(be),Ue=fe||!Ve&&R,We="".concat(k,"-option"),Le=ye(k,We,ve,J(J(J(J({},"".concat(We,"-grouped"),se),"".concat(We,"-active"),z===j&&!Ue),"".concat(We,"-disabled"),Ue),"".concat(We,"-selected"),Ve)),lt=Q(X),ot=!b||typeof b=="function"||Ve,Me=typeof lt=="number"?lt:lt||be,Fe=Zy(Me)?Me.toString():void 0;return ge!==void 0&&(Fe=ge),S.createElement("div",ze({},Co(Ae),C?{}:Z(X,j),{"aria-selected":V(be),className:Le,title:Fe,onMouseMove:function(){z===j||Ue||W(j)},onClick:function(){Ue||H(be)},style:we}),S.createElement("div",{className:"".concat(We,"-content")},typeof N=="function"?N(X,{index:j}):Me),S.isValidElement(b)||Ve,ot&&S.createElement(cf,{className:"".concat(k,"-option-state"),customizeIcon:b,customizeIconProps:{value:be,disabled:Ue,isSelected:Ve}},Ve?"":null))}))},CL=S.forwardRef(wL);const SL=function(n,e){var t=S.useRef({values:new Map,options:new Map}),i=S.useMemo(function(){var o=t.current,s=o.values,a=o.options,l=n.map(function(d){if(d.label===void 0){var f;return me(me({},d),{},{label:(f=s.get(d.value))===null||f===void 0?void 0:f.label})}return d}),c=new Map,u=new Map;return l.forEach(function(d){c.set(d.value,d),u.set(d.value,e.get(d.value)||a.get(d.value))}),t.current.values=c,t.current.options=u,l},[n,e]),r=S.useCallback(function(o){return e.get(o)||t.current.options.get(o)},[e]);return[i,r]};function om(n,e){return PI(n).join("").toUpperCase().includes(e)}const IL=function(n,e,t,i,r){return S.useMemo(function(){if(!t||i===!1)return n;var o=e.options,s=e.label,a=e.value,l=[],c=typeof i=="function",u=t.toUpperCase(),d=c?i:function(h,p){return r?om(p[r],u):p[o]?om(p[s!=="children"?s:"label"],u):om(p[a],u)},f=c?function(h){return Qm(h)}:function(h){return h};return n.forEach(function(h){if(h[o]){var p=d(t,f(h));if(p)l.push(h);else{var m=h[o].filter(function(g){return d(t,f(g))});m.length&&l.push(me(me({},h),{},J({},o,m)))}return}d(t,f(h))&&l.push(h)}),l},[n,i,r,t,e])};var Qy=0,$L=sv();function EL(){var n;return $L?(n=Qy,Qy+=1):n="TEST_OR_SSR",n}function NL(n){var e=S.useState(),t=ke(e,2),i=t[0],r=t[1];return S.useEffect(function(){r("rc_select_".concat(EL()))},[]),n||i}var kL=["children","value"],DL=["children"];function TL(n){var e=n,t=e.key,i=e.props,r=i.children,o=i.value,s=En(i,kL);return me({key:t,value:o!==void 0?o:t,children:r},s)}function BI(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return uv(n).map(function(t,i){if(!S.isValidElement(t)||!t.type)return null;var r=t,o=r.type.isSelectOptGroup,s=r.key,a=r.props,l=a.children,c=En(a,DL);return e||!o?TL(t):me(me({key:"__RC_SELECT_GRP__".concat(s===null?i:s,"__"),label:s},c),{},{options:BI(l)})}).filter(function(t){return t})}var RL=function(e,t,i,r,o){return S.useMemo(function(){var s=e,a=!e;a&&(s=BI(t));var l=new Map,c=new Map,u=function(h,p,m){m&&typeof m=="string"&&h.set(p[m],p)},d=function f(h){for(var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=0;m<h.length;m+=1){var g=h[m];!g[i.options]||p?(l.set(g[i.value],g),u(c,g,i.label),u(c,g,r),u(c,g,o)):f(g[i.options],!0)}};return d(s),{options:s,valueOptions:l,labelOptions:c}},[e,t,i,r,o])};function ew(n){var e=S.useRef();e.current=n;var t=S.useCallback(function(){return e.current.apply(e,arguments)},[]);return t}var _L=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","labelRender","value","defaultValue","labelInValue","onChange","maxCount"],AL=["inputValue"];function OL(n){return!n||vn(n)!=="object"}var PL=S.forwardRef(function(n,e){var t=n.id,i=n.mode,r=n.prefixCls,o=r===void 0?"rc-select":r,s=n.backfill,a=n.fieldNames,l=n.inputValue,c=n.searchValue,u=n.onSearch,d=n.autoClearSearchValue,f=d===void 0?!0:d,h=n.onSelect,p=n.onDeselect,m=n.dropdownMatchSelectWidth,g=m===void 0?!0:m,v=n.filterOption,x=n.filterSort,b=n.optionFilterProp,w=n.optionLabelProp,y=n.options,C=n.optionRender,$=n.children,I=n.defaultActiveFirstOption,E=n.menuItemSelectedIcon,N=n.virtual,k=n.direction,D=n.listHeight,_=D===void 0?200:D,R=n.listItemHeight,T=R===void 0?20:R,A=n.labelRender,O=n.value,P=n.defaultValue,M=n.labelInValue,z=n.onChange,L=n.maxCount,W=En(n,_L),U=NL(t),V=eg(i),H=!!(!y&&$),Y=S.useMemo(function(){return v===void 0&&i==="combobox"?!1:v},[v,i]),Q=S.useMemo(function(){return FI(a,H)},[JSON.stringify(a),H]),Z=Vo("",{value:c!==void 0?c:l,postState:function(Ge){return Ge||""}}),pe=ke(Z,2),oe=pe[0],X=pe[1],j=RL(y,$,Q,b,w),ne=j.valueOptions,se=j.labelOptions,ce=j.options,re=S.useCallback(function(Te){var Ge=PI(Te);return Ge.map(function(Ze){var it,ft,Ot,qe,et;if(OL(Ze))it=Ze;else{var pt;Ot=Ze.key,ft=Ze.label,it=(pt=Ze.value)!==null&&pt!==void 0?pt:Ot}var dt=ne.get(it);if(dt){var Xt;ft===void 0&&(ft=dt==null?void 0:dt[w||Q.label]),Ot===void 0&&(Ot=(Xt=dt==null?void 0:dt.key)!==null&&Xt!==void 0?Xt:it),qe=dt==null?void 0:dt.disabled,et=dt==null?void 0:dt.title}return{label:ft,value:it,key:Ot,disabled:qe,title:et}})},[Q,w,ne]),be=Vo(P,{value:O}),Ie=ke(be,2),Ee=Ie[0],Se=Ie[1],fe=S.useMemo(function(){var Te,Ge=V&&Ee===null?[]:Ee,Ze=re(Ge);return i==="combobox"&&BF((Te=Ze[0])===null||Te===void 0?void 0:Te.value)?[]:Ze},[Ee,re,i,V]),ge=SL(fe,ne),we=ke(ge,2),ve=we[0],Ne=we[1],Ae=S.useMemo(function(){if(!i&&ve.length===1){var Te=ve[0];if(Te.value===null&&(Te.label===null||Te.label===void 0))return[]}return ve.map(function(Ge){var Ze;return me(me({},Ge),{},{label:(Ze=typeof A=="function"?A(Ge):Ge.label)!==null&&Ze!==void 0?Ze:Ge.value})})},[i,ve,A]),Ve=S.useMemo(function(){return new Set(ve.map(function(Te){return Te.value}))},[ve]);S.useEffect(function(){if(i==="combobox"){var Te,Ge=(Te=ve[0])===null||Te===void 0?void 0:Te.value;X(zF(Ge)?String(Ge):"")}},[ve]);var Ue=ew(function(Te,Ge){var Ze=Ge??Te;return J(J({},Q.value,Te),Q.label,Ze)}),We=S.useMemo(function(){if(i!=="tags")return ce;var Te=nt(ce),Ge=function(it){return ne.has(it)};return nt(ve).sort(function(Ze,it){return Ze.value<it.value?-1:1}).forEach(function(Ze){var it=Ze.value;Ge(it)||Te.push(Ue(it,Ze.label))}),Te},[Ue,ce,ne,ve,i]),Le=IL(We,Q,oe,Y,b),lt=S.useMemo(function(){return i!=="tags"||!oe||Le.some(function(Te){return Te[b||"value"]===oe})||Le.some(function(Te){return Te[Q.value]===oe})?Le:[Ue(oe)].concat(nt(Le))},[Ue,b,i,Le,oe,Q]),ot=function Te(Ge){var Ze=nt(Ge).sort(function(it,ft){return x(it,ft,{searchValue:oe})});return Ze.map(function(it){return Array.isArray(it.options)?me(me({},it),{},{options:it.options.length>0?Te(it.options):it.options}):it})},Me=S.useMemo(function(){return x?ot(lt):lt},[lt,x,oe]),Fe=S.useMemo(function(){return JF(Me,{fieldNames:Q,childrenAsData:H})},[Me,Q,H]),Ke=function(Ge){var Ze=re(Ge);if(Se(Ze),z&&(Ze.length!==ve.length||Ze.some(function(Ot,qe){var et;return((et=ve[qe])===null||et===void 0?void 0:et.value)!==(Ot==null?void 0:Ot.value)}))){var it=M?Ze:Ze.map(function(Ot){return Ot.value}),ft=Ze.map(function(Ot){return Qm(Ne(Ot.value))});z(V?it:it[0],V?ft:ft[0])}},Lt=S.useState(null),Nt=ke(Lt,2),Dt=Nt[0],kt=Nt[1],_n=S.useState(0),oi=ke(_n,2),zt=oi[0],yi=oi[1],on=I!==void 0?I:i!=="combobox",bn=S.useCallback(function(Te,Ge){var Ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},it=Ze.source,ft=it===void 0?"keyboard":it;yi(Ge),s&&i==="combobox"&&Te!==null&&ft==="keyboard"&&kt(String(Te))},[s,i]),Zt=function(Ge,Ze,it){var ft=function(){var Ye,Be=Ne(Ge);return[M?{label:Be==null?void 0:Be[Q.label],value:Ge,key:(Ye=Be==null?void 0:Be.key)!==null&&Ye!==void 0?Ye:Ge}:Ge,Qm(Be)]};if(Ze&&h){var Ot=ft(),qe=ke(Ot,2),et=qe[0],pt=qe[1];h(et,pt)}else if(!Ze&&p&&it!=="clear"){var dt=ft(),Xt=ke(dt,2),un=Xt[0],An=Xt[1];p(un,An)}},Un=ew(function(Te,Ge){var Ze,it=V?Ge.selected:!0;it?Ze=V?[].concat(nt(ve),[Te]):[Te]:Ze=ve.filter(function(ft){return ft.value!==Te}),Ke(Ze),Zt(Te,it),i==="combobox"?kt(""):(!eg||f)&&(X(""),kt(""))}),Yt=function(Ge,Ze){Ke(Ge);var it=Ze.type,ft=Ze.values;(it==="remove"||it==="clear")&&ft.forEach(function(Ot){Zt(Ot.value,!1,it)})},xt=function(Ge,Ze){if(X(Ge),kt(null),Ze.source==="submit"){var it=(Ge||"").trim();if(it){var ft=Array.from(new Set([].concat(nt(Ve),[it])));Ke(ft),Zt(it,!0),X("")}return}Ze.source!=="blur"&&(i==="combobox"&&Ke(Ge),u==null||u(Ge))},pn=function(Ge){var Ze=Ge;i!=="tags"&&(Ze=Ge.map(function(ft){var Ot=se.get(ft);return Ot==null?void 0:Ot.value}).filter(function(ft){return ft!==void 0}));var it=Array.from(new Set([].concat(nt(Ve),nt(Ze))));Ke(it),it.forEach(function(ft){Zt(ft,!0)})},_t=S.useMemo(function(){var Te=N!==!1&&g!==!1;return me(me({},j),{},{flattenOptions:Fe,onActiveValue:bn,defaultActiveFirstOption:on,onSelect:Un,menuItemSelectedIcon:E,rawValues:Ve,fieldNames:Q,virtual:Te,direction:k,listHeight:_,listItemHeight:T,childrenAsData:H,maxCount:L,optionRender:C})},[L,j,Fe,bn,on,Un,E,Ve,Q,N,g,k,_,T,H,C]);return S.createElement(Pv.Provider,{value:_t},S.createElement(nL,ze({},W,{id:U,prefixCls:o,ref:e,omitDomProps:AL,mode:i,displayValues:Ae,onDisplayValuesChange:Yt,direction:k,searchValue:oe,onSearch:xt,autoClearSearchValue:f,onSearchSplit:pn,dropdownMatchSelectWidth:g,OptionList:CL,emptyOptions:!Fe.length,activeValue:Dt,activeDescendantId:"".concat(U,"_list_").concat(zt)})))}),Lv=PL;Lv.Option=Fv;Lv.OptGroup=Mv;function gh(n,e,t){return ye({[`${n}-status-success`]:e==="success",[`${n}-status-warning`]:e==="warning",[`${n}-status-error`]:e==="error",[`${n}-status-validating`]:e==="validating",[`${n}-has-feedback`]:t})}const df=(n,e)=>e||n,ML=()=>{const[,n]=Wl(),[e]=of("Empty"),i=new Oo(n.colorBgBase).toHsl().l<.5?{opacity:.65}:{};return S.createElement("svg",{style:i,width:"184",height:"152",viewBox:"0 0 184 152",xmlns:"http://www.w3.org/2000/svg"},S.createElement("title",null,(e==null?void 0:e.description)||"Empty"),S.createElement("g",{fill:"none",fillRule:"evenodd"},S.createElement("g",{transform:"translate(24 31.67)"},S.createElement("ellipse",{fillOpacity:".8",fill:"#F5F5F7",cx:"67.797",cy:"106.89",rx:"67.797",ry:"12.668"}),S.createElement("path",{d:"M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z",fill:"#AEB8C2"}),S.createElement("path",{d:"M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z",fill:"url(#linearGradient-1)",transform:"translate(13.56)"}),S.createElement("path",{d:"M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z",fill:"#F5F5F7"}),S.createElement("path",{d:"M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z",fill:"#DCE0E6"})),S.createElement("path",{d:"M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z",fill:"#DCE0E6"}),S.createElement("g",{transform:"translate(149.65 15.383)",fill:"#FFF"},S.createElement("ellipse",{cx:"20.654",cy:"3.167",rx:"2.849",ry:"2.815"}),S.createElement("path",{d:"M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"}))))},FL=()=>{const[,n]=Wl(),[e]=of("Empty"),{colorFill:t,colorFillTertiary:i,colorFillQuaternary:r,colorBgContainer:o}=n,{borderColor:s,shadowColor:a,contentColor:l}=S.useMemo(()=>({borderColor:new Oo(t).onBackground(o).toHexShortString(),shadowColor:new Oo(i).onBackground(o).toHexShortString(),contentColor:new Oo(r).onBackground(o).toHexShortString()}),[t,i,r,o]);return S.createElement("svg",{width:"64",height:"41",viewBox:"0 0 64 41",xmlns:"http://www.w3.org/2000/svg"},S.createElement("title",null,(e==null?void 0:e.description)||"Empty"),S.createElement("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},S.createElement("ellipse",{fill:a,cx:"32",cy:"33",rx:"32",ry:"7"}),S.createElement("g",{fillRule:"nonzero",stroke:s},S.createElement("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),S.createElement("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",fill:l}))))},LL=n=>{const{componentCls:e,margin:t,marginXS:i,marginXL:r,fontSize:o,lineHeight:s}=n;return{[e]:{marginInline:i,fontSize:o,lineHeight:s,textAlign:"center",[`${e}-image`]:{height:n.emptyImgHeight,marginBottom:i,opacity:n.opacityImage,img:{height:"100%"},svg:{maxWidth:"100%",height:"100%",margin:"auto"}},[`${e}-description`]:{color:n.colorTextDescription},[`${e}-footer`]:{marginTop:t},"&-normal":{marginBlock:r,color:n.colorTextDescription,[`${e}-description`]:{color:n.colorTextDescription},[`${e}-image`]:{height:n.emptyImgHeightMD}},"&-small":{marginBlock:i,color:n.colorTextDescription,[`${e}-image`]:{height:n.emptyImgHeightSM}}}}},zL=Xr("Empty",n=>{const{componentCls:e,controlHeightLG:t,calc:i}=n,r=Ei(n,{emptyImgCls:`${e}-img`,emptyImgHeight:i(t).mul(2.5).equal(),emptyImgHeightMD:t,emptyImgHeightSM:i(t).mul(.875).equal()});return[LL(r)]});var BL=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const VI=S.createElement(ML,null),WI=S.createElement(FL,null),Po=n=>{var{className:e,rootClassName:t,prefixCls:i,image:r=VI,description:o,children:s,imageStyle:a,style:l}=n,c=BL(n,["className","rootClassName","prefixCls","image","description","children","imageStyle","style"]);const{getPrefixCls:u,direction:d,empty:f}=S.useContext(Nn),h=u("empty",i),[p,m,g]=zL(h),[v]=of("Empty"),x=typeof o<"u"?o:v==null?void 0:v.description,b=typeof x=="string"?x:"empty";let w=null;return typeof r=="string"?w=S.createElement("img",{alt:b,src:r}):w=r,p(S.createElement("div",Object.assign({className:ye(m,g,h,f==null?void 0:f.className,{[`${h}-normal`]:r===WI,[`${h}-rtl`]:d==="rtl"},e,t),style:Object.assign(Object.assign({},f==null?void 0:f.style),l)},c),S.createElement("div",{className:`${h}-image`,style:a},w),x&&S.createElement("div",{className:`${h}-description`},x),s&&S.createElement("div",{className:`${h}-footer`},s)))};Po.PRESENTED_IMAGE_DEFAULT=VI;Po.PRESENTED_IMAGE_SIMPLE=WI;const zv=n=>{const{componentName:e}=n,{getPrefixCls:t}=S.useContext(Nn),i=t("empty");switch(e){case"Table":case"List":return le.createElement(Po,{image:Po.PRESENTED_IMAGE_SIMPLE});case"Select":case"TreeSelect":case"Cascader":case"Transfer":case"Mentions":return le.createElement(Po,{image:Po.PRESENTED_IMAGE_SIMPLE,className:`${i}-small`});case"Table.filter":return null;default:return le.createElement(Po,null)}},Bv=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;var i,r;const{variant:o,[n]:s}=S.useContext(Nn),a=S.useContext(O_),l=s==null?void 0:s.variant;let c;typeof e<"u"?c=e:t===!1?c="borderless":c=(r=(i=a??l)!==null&&i!==void 0?i:o)!==null&&r!==void 0?r:"outlined";const u=P_.includes(c);return[c,u]},VL=n=>{const t={overflow:{adjustX:!0,adjustY:!0,shiftY:!0},htmlRegion:n==="scroll"?"scroll":"visible",dynamicInset:!0};return{bottomLeft:Object.assign(Object.assign({},t),{points:["tl","bl"],offset:[0,4]}),bottomRight:Object.assign(Object.assign({},t),{points:["tr","br"],offset:[0,4]}),topLeft:Object.assign(Object.assign({},t),{points:["bl","tl"],offset:[0,-4]}),topRight:Object.assign(Object.assign({},t),{points:["br","tr"],offset:[0,-4]})}};function WL(n,e){return n||VL(e)}const tw=n=>{const{optionHeight:e,optionFontSize:t,optionLineHeight:i,optionPadding:r}=n;return{position:"relative",display:"block",minHeight:e,padding:r,color:n.colorText,fontWeight:"normal",fontSize:t,lineHeight:i,boxSizing:"border-box"}},GL=n=>{const{antCls:e,componentCls:t}=n,i=`${t}-item`,r=`&${e}-slide-up-enter${e}-slide-up-enter-active`,o=`&${e}-slide-up-appear${e}-slide-up-appear-active`,s=`&${e}-slide-up-leave${e}-slide-up-leave-active`,a=`${t}-dropdown-placement-`;return[{[`${t}-dropdown`]:Object.assign(Object.assign({},sr(n)),{position:"absolute",top:-9999,zIndex:n.zIndexPopup,boxSizing:"border-box",padding:n.paddingXXS,overflow:"hidden",fontSize:n.fontSize,fontVariant:"initial",backgroundColor:n.colorBgElevated,borderRadius:n.borderRadiusLG,outline:"none",boxShadow:n.boxShadowSecondary,[`
          ${r}${a}bottomLeft,
          ${o}${a}bottomLeft
        `]:{animationName:M_},[`
          ${r}${a}topLeft,
          ${o}${a}topLeft,
          ${r}${a}topRight,
          ${o}${a}topRight
        `]:{animationName:F_},[`${s}${a}bottomLeft`]:{animationName:L_},[`
          ${s}${a}topLeft,
          ${s}${a}topRight
        `]:{animationName:z_},"&-hidden":{display:"none"},[i]:Object.assign(Object.assign({},tw(n)),{cursor:"pointer",transition:`background ${n.motionDurationSlow} ease`,borderRadius:n.borderRadiusSM,"&-group":{color:n.colorTextDescription,fontSize:n.fontSizeSM,cursor:"default"},"&-option":{display:"flex","&-content":Object.assign({flex:"auto"},hh),"&-state":{flex:"none",display:"flex",alignItems:"center"},[`&-active:not(${i}-option-disabled)`]:{backgroundColor:n.optionActiveBg},[`&-selected:not(${i}-option-disabled)`]:{color:n.optionSelectedColor,fontWeight:n.optionSelectedFontWeight,backgroundColor:n.optionSelectedBg,[`${i}-option-state`]:{color:n.colorPrimary},[`&:has(+ ${i}-option-selected:not(${i}-option-disabled))`]:{borderEndStartRadius:0,borderEndEndRadius:0,[`& + ${i}-option-selected:not(${i}-option-disabled)`]:{borderStartStartRadius:0,borderStartEndRadius:0}}},"&-disabled":{[`&${i}-option-selected`]:{backgroundColor:n.colorBgContainerDisabled},color:n.colorTextDisabled,cursor:"not-allowed"},"&-grouped":{paddingInlineStart:n.calc(n.controlPaddingHorizontal).mul(2).equal()}},"&-empty":Object.assign(Object.assign({},tw(n)),{color:n.colorTextDisabled})}),"&-rtl":{direction:"rtl"}})},hy(n,"slide-up"),hy(n,"slide-down"),fy(n,"move-up"),fy(n,"move-down")]},HL=n=>{const{multipleSelectItemHeight:e,paddingXXS:t,lineWidth:i,INTERNAL_FIXED_ITEM_MARGIN:r}=n,o=n.max(n.calc(t).sub(i).equal(),0),s=n.max(n.calc(o).sub(r).equal(),0);return{basePadding:o,containerPadding:s,itemHeight:ue(e),itemLineHeight:ue(n.calc(e).sub(n.calc(n.lineWidth).mul(2)).equal())}},UL=n=>{const{multipleSelectItemHeight:e,selectHeight:t,lineWidth:i}=n;return n.calc(t).sub(e).div(2).sub(i).equal()},jL=n=>{const{componentCls:e,iconCls:t,borderRadiusSM:i,motionDurationSlow:r,paddingXS:o,multipleItemColorDisabled:s,multipleItemBorderColorDisabled:a,colorIcon:l,colorIconHover:c,INTERNAL_FIXED_ITEM_MARGIN:u}=n;return{[`${e}-selection-overflow`]:{position:"relative",display:"flex",flex:"auto",flexWrap:"wrap",maxWidth:"100%","&-item":{flex:"none",alignSelf:"center",maxWidth:"100%",display:"inline-flex"},[`${e}-selection-item`]:{display:"flex",alignSelf:"center",flex:"none",boxSizing:"border-box",maxWidth:"100%",marginBlock:u,borderRadius:i,cursor:"default",transition:`font-size ${r}, line-height ${r}, height ${r}`,marginInlineEnd:n.calc(u).mul(2).equal(),paddingInlineStart:o,paddingInlineEnd:n.calc(o).div(2).equal(),[`${e}-disabled&`]:{color:s,borderColor:a,cursor:"not-allowed"},"&-content":{display:"inline-block",marginInlineEnd:n.calc(o).div(2).equal(),overflow:"hidden",whiteSpace:"pre",textOverflow:"ellipsis"},"&-remove":Object.assign(Object.assign({},v1()),{display:"inline-flex",alignItems:"center",color:l,fontWeight:"bold",fontSize:10,lineHeight:"inherit",cursor:"pointer",[`> ${t}`]:{verticalAlign:"-0.2em"},"&:hover":{color:c}})}}}},KL=(n,e)=>{const{componentCls:t,INTERNAL_FIXED_ITEM_MARGIN:i}=n,r=`${t}-selection-overflow`,o=n.multipleSelectItemHeight,s=UL(n),a=e?`${t}-${e}`:"",l=HL(n);return{[`${t}-multiple${a}`]:Object.assign(Object.assign({},jL(n)),{[`${t}-selector`]:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingInline:l.basePadding,paddingBlock:l.containerPadding,borderRadius:n.borderRadius,[`${t}-disabled&`]:{background:n.multipleSelectorBgDisabled,cursor:"not-allowed"},"&:after":{display:"inline-block",width:0,margin:`${ue(i)} 0`,lineHeight:ue(o),visibility:"hidden",content:'"\\a0"'}},[`${t}-selection-wrap`]:{width:"100%",overflow:"hidden"},[`${t}-selection-item`]:{height:l.itemHeight,lineHeight:ue(l.itemLineHeight)},[`${r}-item + ${r}-item`]:{[`${t}-selection-search`]:{marginInlineStart:0}},[`${r}-item-suffix`]:{height:"100%"},[`${t}-selection-search`]:{display:"inline-flex",position:"relative",maxWidth:"100%",marginInlineStart:n.calc(n.inputPaddingHorizontalBase).sub(s).equal(),"\n          &-input,\n          &-mirror\n        ":{height:o,fontFamily:n.fontFamily,lineHeight:ue(o),transition:`all ${n.motionDurationSlow}`},"&-input":{width:"100%",minWidth:4.1},"&-mirror":{position:"absolute",top:0,insetInlineStart:0,insetInlineEnd:"auto",zIndex:999,whiteSpace:"pre",visibility:"hidden"}},[`${t}-selection-placeholder`]:{position:"absolute",top:"50%",insetInlineStart:n.inputPaddingHorizontalBase,insetInlineEnd:n.inputPaddingHorizontalBase,transform:"translateY(-50%)",transition:`all ${n.motionDurationSlow}`},[`${t}-prefix`]:{height:l.itemHeight,lineHeight:ue(l.itemLineHeight),marginInlineStart:`calc(${ue(n.inputPaddingHorizontalBase)} - ${ue(l.basePadding)})`,marginInlineEnd:n.selectAffixPadding}})}};function sm(n,e){const{componentCls:t}=n,i=e?`${t}-${e}`:"",r={[`${t}-multiple${i}`]:{fontSize:n.fontSize,[`${t}-selector`]:{[`${t}-show-search&`]:{cursor:"text"}},[`
        &${t}-show-arrow ${t}-selector,
        &${t}-allow-clear ${t}-selector
      `]:{paddingInlineEnd:n.calc(n.fontSizeIcon).add(n.controlPaddingHorizontal).equal()}}};return[KL(n,e),r]}const XL=n=>{const{componentCls:e}=n,t=Ei(n,{selectHeight:n.controlHeightSM,multipleSelectItemHeight:n.multipleItemHeightSM,borderRadius:n.borderRadiusSM,borderRadiusSM:n.borderRadiusXS}),i=Ei(n,{fontSize:n.fontSizeLG,selectHeight:n.controlHeightLG,multipleSelectItemHeight:n.multipleItemHeightLG,borderRadius:n.borderRadiusLG,borderRadiusSM:n.borderRadius});return[sm(n),sm(t,"sm"),{[`${e}-multiple${e}-sm`]:{[`${e}-selection-placeholder`]:{insetInline:n.calc(n.controlPaddingHorizontalSM).sub(n.lineWidth).equal()},[`${e}-selection-search`]:{marginInlineStart:2}}},sm(i,"lg")]};function am(n,e){const{componentCls:t,inputPaddingHorizontalBase:i,borderRadius:r,selectAffixPadding:o}=n,s=n.calc(n.controlHeight).sub(n.calc(n.lineWidth).mul(2)).equal(),a=e?`${t}-${e}`:"";return{[`${t}-single${a}`]:{fontSize:n.fontSize,height:n.controlHeight,[`${t}-selector`]:Object.assign(Object.assign({},sr(n,!0)),{display:"flex",borderRadius:r,flex:"1 1 auto",[`${t}-selection-wrap`]:{display:"flex",width:"100%",position:"relative"},[`${t}-selection-search`]:{position:"absolute",inset:0,width:"100%","&-input":{width:"100%",WebkitAppearance:"textfield"}},[`
          ${t}-selection-item,
          ${t}-selection-placeholder,
          ${t}-prefix
        `]:{display:"block",padding:0,lineHeight:ue(s),transition:`all ${n.motionDurationSlow}, visibility 0s`,alignSelf:"center"},[`${t}-selection-placeholder`]:{transition:"none",pointerEvents:"none"},[`${t}-prefix`]:{marginInlineEnd:o},[["&:after",`${t}-selection-item:empty:after`,`${t}-selection-placeholder:empty:after`].join(",")]:{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'}}),[`
        &${t}-show-arrow ${t}-selection-item,
        &${t}-show-arrow ${t}-selection-search,
        &${t}-show-arrow ${t}-selection-placeholder
      `]:{paddingInlineEnd:n.showArrowPaddingInlineEnd},[`&${t}-open ${t}-selection-item`]:{color:n.colorTextPlaceholder},[`&:not(${t}-customize-input)`]:{[`${t}-selector`]:{width:"100%",height:"100%",padding:`0 ${ue(i)}`,[`${t}-selection-search-input`]:{height:s},"&:after":{lineHeight:ue(s)}}},[`&${t}-customize-input`]:{[`${t}-selector`]:{"&:after":{display:"none"},[`${t}-selection-search`]:{position:"static",width:"100%"},[`${t}-selection-placeholder`]:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,padding:`0 ${ue(i)}`,"&:after":{display:"none"}}}}}}}function qL(n){const{componentCls:e}=n,t=n.calc(n.controlPaddingHorizontalSM).sub(n.lineWidth).equal();return[am(n),am(Ei(n,{controlHeight:n.controlHeightSM,borderRadius:n.borderRadiusSM}),"sm"),{[`${e}-single${e}-sm`]:{[`&:not(${e}-customize-input)`]:{[`${e}-selector`]:{padding:`0 ${ue(t)}`},[`&${e}-show-arrow ${e}-selection-search`]:{insetInlineEnd:n.calc(t).add(n.calc(n.fontSize).mul(1.5)).equal()},[`
            &${e}-show-arrow ${e}-selection-item,
            &${e}-show-arrow ${e}-selection-placeholder
          `]:{paddingInlineEnd:n.calc(n.fontSize).mul(1.5).equal()}}}},am(Ei(n,{controlHeight:n.singleItemHeightLG,fontSize:n.fontSizeLG,borderRadius:n.borderRadiusLG}),"lg")]}const YL=n=>{const{fontSize:e,lineHeight:t,lineWidth:i,controlHeight:r,controlHeightSM:o,controlHeightLG:s,paddingXXS:a,controlPaddingHorizontal:l,zIndexPopupBase:c,colorText:u,fontWeightStrong:d,controlItemBgActive:f,controlItemBgHover:h,colorBgContainer:p,colorFillSecondary:m,colorBgContainerDisabled:g,colorTextDisabled:v,colorPrimaryHover:x,colorPrimary:b,controlOutline:w}=n,y=a*2,C=i*2,$=Math.min(r-y,r-C),I=Math.min(o-y,o-C),E=Math.min(s-y,s-C);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(a/2),zIndexPopup:c+50,optionSelectedColor:u,optionSelectedFontWeight:d,optionSelectedBg:f,optionActiveBg:h,optionPadding:`${(r-e*t)/2}px ${l}px`,optionFontSize:e,optionLineHeight:t,optionHeight:r,selectorBg:p,clearBg:p,singleItemHeightLG:s,multipleItemBg:m,multipleItemBorderColor:"transparent",multipleItemHeight:$,multipleItemHeightSM:I,multipleItemHeightLG:E,multipleSelectorBgDisabled:g,multipleItemColorDisabled:v,multipleItemBorderColorDisabled:"transparent",showArrowPaddingInlineEnd:Math.ceil(n.fontSize*1.25),hoverBorderColor:x,activeBorderColor:b,activeOutlineColor:w,selectAffixPadding:a}},GI=(n,e)=>{const{componentCls:t,antCls:i,controlOutlineWidth:r}=n;return{[`&:not(${t}-customize-input) ${t}-selector`]:{border:`${ue(n.lineWidth)} ${n.lineType} ${e.borderColor}`,background:n.selectorBg},[`&:not(${t}-disabled):not(${t}-customize-input):not(${i}-pagination-size-changer)`]:{[`&:hover ${t}-selector`]:{borderColor:e.hoverBorderHover},[`${t}-focused& ${t}-selector`]:{borderColor:e.activeBorderColor,boxShadow:`0 0 0 ${ue(r)} ${e.activeOutlineColor}`,outline:0}}}},nw=(n,e)=>({[`&${n.componentCls}-status-${e.status}`]:Object.assign({},GI(n,e))}),JL=n=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign({},GI(n,{borderColor:n.colorBorder,hoverBorderHover:n.hoverBorderColor,activeBorderColor:n.activeBorderColor,activeOutlineColor:n.activeOutlineColor})),nw(n,{status:"error",borderColor:n.colorError,hoverBorderHover:n.colorErrorHover,activeBorderColor:n.colorError,activeOutlineColor:n.colorErrorOutline})),nw(n,{status:"warning",borderColor:n.colorWarning,hoverBorderHover:n.colorWarningHover,activeBorderColor:n.colorWarning,activeOutlineColor:n.colorWarningOutline})),{[`&${n.componentCls}-disabled`]:{[`&:not(${n.componentCls}-customize-input) ${n.componentCls}-selector`]:{background:n.colorBgContainerDisabled,color:n.colorTextDisabled}},[`&${n.componentCls}-multiple ${n.componentCls}-selection-item`]:{background:n.multipleItemBg,border:`${ue(n.lineWidth)} ${n.lineType} ${n.multipleItemBorderColor}`}})}),HI=(n,e)=>{const{componentCls:t,antCls:i}=n;return{[`&:not(${t}-customize-input) ${t}-selector`]:{background:e.bg,border:`${ue(n.lineWidth)} ${n.lineType} transparent`,color:e.color},[`&:not(${t}-disabled):not(${t}-customize-input):not(${i}-pagination-size-changer)`]:{[`&:hover ${t}-selector`]:{background:e.hoverBg},[`${t}-focused& ${t}-selector`]:{background:n.selectorBg,borderColor:e.activeBorderColor,outline:0}}}},iw=(n,e)=>({[`&${n.componentCls}-status-${e.status}`]:Object.assign({},HI(n,e))}),ZL=n=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign({},HI(n,{bg:n.colorFillTertiary,hoverBg:n.colorFillSecondary,activeBorderColor:n.activeBorderColor,color:n.colorText})),iw(n,{status:"error",bg:n.colorErrorBg,hoverBg:n.colorErrorBgHover,activeBorderColor:n.colorError,color:n.colorError})),iw(n,{status:"warning",bg:n.colorWarningBg,hoverBg:n.colorWarningBgHover,activeBorderColor:n.colorWarning,color:n.colorWarning})),{[`&${n.componentCls}-disabled`]:{[`&:not(${n.componentCls}-customize-input) ${n.componentCls}-selector`]:{borderColor:n.colorBorder,background:n.colorBgContainerDisabled,color:n.colorTextDisabled}},[`&${n.componentCls}-multiple ${n.componentCls}-selection-item`]:{background:n.colorBgContainer,border:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`}})}),QL=n=>({"&-borderless":{[`${n.componentCls}-selector`]:{background:"transparent",borderColor:"transparent"},[`&${n.componentCls}-disabled`]:{[`&:not(${n.componentCls}-customize-input) ${n.componentCls}-selector`]:{color:n.colorTextDisabled}},[`&${n.componentCls}-multiple ${n.componentCls}-selection-item`]:{background:n.multipleItemBg,border:`${ue(n.lineWidth)} ${n.lineType} ${n.multipleItemBorderColor}`},[`&${n.componentCls}-status-error`]:{[`${n.componentCls}-selection-item`]:{color:n.colorError}},[`&${n.componentCls}-status-warning`]:{[`${n.componentCls}-selection-item`]:{color:n.colorWarning}}}}),ez=n=>({[n.componentCls]:Object.assign(Object.assign(Object.assign({},JL(n)),ZL(n)),QL(n))}),tz=n=>{const{componentCls:e}=n;return{position:"relative",transition:`all ${n.motionDurationMid} ${n.motionEaseInOut}`,input:{cursor:"pointer"},[`${e}-show-search&`]:{cursor:"text",input:{cursor:"auto",color:"inherit",height:"100%"}},[`${e}-disabled&`]:{cursor:"not-allowed",input:{cursor:"not-allowed"}}}},nz=n=>{const{componentCls:e}=n;return{[`${e}-selection-search-input`]:{margin:0,padding:0,background:"transparent",border:"none",outline:"none",appearance:"none",fontFamily:"inherit","&::-webkit-search-cancel-button":{display:"none","-webkit-appearance":"none"}}}},iz=n=>{const{antCls:e,componentCls:t,inputPaddingHorizontalBase:i,iconCls:r}=n;return{[t]:Object.assign(Object.assign({},sr(n)),{position:"relative",display:"inline-flex",cursor:"pointer",[`&:not(${t}-customize-input) ${t}-selector`]:Object.assign(Object.assign({},tz(n)),nz(n)),[`${t}-selection-item`]:Object.assign(Object.assign({flex:1,fontWeight:"normal",position:"relative",userSelect:"none"},hh),{[`> ${e}-typography`]:{display:"inline"}}),[`${t}-selection-placeholder`]:Object.assign(Object.assign({},hh),{flex:1,color:n.colorTextPlaceholder,pointerEvents:"none"}),[`${t}-arrow`]:Object.assign(Object.assign({},v1()),{position:"absolute",top:"50%",insetInlineStart:"auto",insetInlineEnd:i,height:n.fontSizeIcon,marginTop:n.calc(n.fontSizeIcon).mul(-1).div(2).equal(),color:n.colorTextQuaternary,fontSize:n.fontSizeIcon,lineHeight:1,textAlign:"center",pointerEvents:"none",display:"flex",alignItems:"center",transition:`opacity ${n.motionDurationSlow} ease`,[r]:{verticalAlign:"top",transition:`transform ${n.motionDurationSlow}`,"> svg":{verticalAlign:"top"},[`&:not(${t}-suffix)`]:{pointerEvents:"auto"}},[`${t}-disabled &`]:{cursor:"not-allowed"},"> *:not(:last-child)":{marginInlineEnd:8}}),[`${t}-clear`]:{position:"absolute",top:"50%",insetInlineStart:"auto",insetInlineEnd:i,zIndex:1,display:"inline-block",width:n.fontSizeIcon,height:n.fontSizeIcon,marginTop:n.calc(n.fontSizeIcon).mul(-1).div(2).equal(),color:n.colorTextQuaternary,fontSize:n.fontSizeIcon,fontStyle:"normal",lineHeight:1,textAlign:"center",textTransform:"none",cursor:"pointer",opacity:0,transition:`color ${n.motionDurationMid} ease, opacity ${n.motionDurationSlow} ease`,textRendering:"auto","&:before":{display:"block"},"&:hover":{color:n.colorTextTertiary}},[`&:hover ${t}-clear`]:{opacity:1,background:n.colorBgBase,borderRadius:"50%"}}),[`${t}-has-feedback`]:{[`${t}-clear`]:{insetInlineEnd:n.calc(i).add(n.fontSize).add(n.paddingXS).equal()}}}},rz=n=>{const{componentCls:e}=n;return[{[e]:{[`&${e}-in-form-item`]:{width:"100%"}}},iz(n),qL(n),XL(n),GL(n),{[`${e}-rtl`]:{direction:"rtl"}},x1(n,{borderElCls:`${e}-selector`,focusElCls:`${e}-focused`})]},oz=Xr("Select",(n,e)=>{let{rootPrefixCls:t}=e;const i=Ei(n,{rootPrefixCls:t,inputPaddingHorizontalBase:n.calc(n.paddingSM).sub(1).equal(),multipleSelectItemHeight:n.multipleItemHeight,selectHeight:n.controlHeight});return[rz(i),ez(i)]},YL,{unitless:{optionLineHeight:!0,optionSelectedFontWeight:!0}});var sz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"},az=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:sz}))},lz=S.forwardRef(az),cz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"}}]},name:"down",theme:"outlined"},uz=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:cz}))},UI=S.forwardRef(uz),dz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},hz=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:dz}))},Vv=S.forwardRef(hz);function fz(n){let{suffixIcon:e,clearIcon:t,menuItemSelectedIcon:i,removeIcon:r,loading:o,multiple:s,hasFeedback:a,prefixCls:l,showSuffixIcon:c,feedbackIcon:u,showArrow:d,componentName:f}=n;const h=t??S.createElement(N1,null),p=x=>e===null&&!a&&!d?null:S.createElement(S.Fragment,null,c!==!1&&x,a&&u);let m=null;if(e!==void 0)m=p(e);else if(o)m=p(S.createElement(b1,{spin:!0}));else{const x=`${l}-suffix`;m=b=>{let{open:w,showSearch:y}=b;return p(w&&y?S.createElement(Vv,{className:x}):S.createElement(UI,{className:x}))}}let g=null;i!==void 0?g=i:s?g=S.createElement(lz,null):g=null;let v=null;return r!==void 0?v=r:v=S.createElement(dv,null),{clearIcon:h,suffixIcon:m,itemIcon:g,removeIcon:v}}function pz(n,e){return e!==void 0?e:n!==null}var mz=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const jI="SECRET_COMBOBOX_MODE_DO_NOT_USE",gz=(n,e)=>{var t;const{prefixCls:i,bordered:r,className:o,rootClassName:s,getPopupContainer:a,popupClassName:l,dropdownClassName:c,listHeight:u=256,placement:d,listItemHeight:f,size:h,disabled:p,notFoundContent:m,status:g,builtinPlacements:v,dropdownMatchSelectWidth:x,popupMatchSelectWidth:b,direction:w,style:y,allowClear:C,variant:$,dropdownStyle:I,transitionName:E,tagRender:N,maxCount:k,prefix:D}=n,_=mz(n,["prefixCls","bordered","className","rootClassName","getPopupContainer","popupClassName","dropdownClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","direction","style","allowClear","variant","dropdownStyle","transitionName","tagRender","maxCount","prefix"]),{getPopupContainer:R,getPrefixCls:T,renderEmpty:A,direction:O,virtual:P,popupMatchSelectWidth:M,popupOverflow:z,select:L}=S.useContext(Nn),[,W]=Wl(),U=f??(W==null?void 0:W.controlHeight),V=T("select",i),H=T(),Y=w??O,{compactSize:Q,compactItemClassnames:Z}=hv(V,Y),[pe,oe]=Bv("select",$,r),X=Ta(V),[j,ne,se]=oz(V,X),ce=S.useMemo(()=>{const{mode:Dt}=n;if(Dt!=="combobox")return Dt===jI?"combobox":Dt},[n.mode]),re=ce==="multiple"||ce==="tags",be=pz(n.suffixIcon,n.showArrow),Ie=(t=b??x)!==null&&t!==void 0?t:M,{status:Ee,hasFeedback:Se,isFormItemInput:fe,feedbackIcon:ge}=S.useContext(xs),we=df(Ee,g);let ve;m!==void 0?ve=m:ce==="combobox"?ve=null:ve=(A==null?void 0:A("Select"))||S.createElement(zv,{componentName:"Select"});const{suffixIcon:Ne,itemIcon:Ae,removeIcon:Ve,clearIcon:Ue}=fz(Object.assign(Object.assign({},_),{multiple:re,hasFeedback:Se,feedbackIcon:ge,showSuffixIcon:be,prefixCls:V,componentName:"Select"})),We=C===!0?{clearIcon:Ue}:C,Le=Da(_,["suffixIcon","itemIcon"]),lt=ye(l||c,{[`${V}-dropdown-${Y}`]:Y==="rtl"},s,se,X,ne),ot=Ns(Dt=>{var kt;return(kt=h??Q)!==null&&kt!==void 0?kt:Dt}),Me=S.useContext(nu),Fe=p??Me,Ke=ye({[`${V}-lg`]:ot==="large",[`${V}-sm`]:ot==="small",[`${V}-rtl`]:Y==="rtl",[`${V}-${pe}`]:oe,[`${V}-in-form-item`]:fe},gh(V,we,Se),Z,L==null?void 0:L.className,o,s,se,X,ne),Lt=S.useMemo(()=>d!==void 0?d:Y==="rtl"?"bottomRight":"bottomLeft",[d,Y]),[Nt]=B_("SelectLike",I==null?void 0:I.zIndex);return j(S.createElement(Lv,Object.assign({ref:e,virtual:P,showSearch:L==null?void 0:L.showSearch},Le,{style:Object.assign(Object.assign({},L==null?void 0:L.style),y),dropdownMatchSelectWidth:Ie,transitionName:V_(H,"slide-up",E),builtinPlacements:WL(v,z),listHeight:u,listItemHeight:U,mode:ce,prefixCls:V,placement:Lt,direction:Y,prefix:D,suffixIcon:Ne,menuItemSelectedIcon:Ae,removeIcon:Ve,allowClear:We,notFoundContent:ve,className:Ke,getPopupContainer:a||R,dropdownClassName:lt,disabled:Fe,dropdownStyle:Object.assign(Object.assign({},I),{zIndex:Nt}),maxCount:re?k:void 0,tagRender:re?N:void 0})))},Yo=S.forwardRef(gz),vz=W_(Yo);Yo.SECRET_COMBOBOX_MODE_DO_NOT_USE=jI;Yo.Option=Fv;Yo.OptGroup=Mv;Yo._InternalPanelDoNotUseOrYouWillBeFired=vz;var xz={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"},bz=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:xz}))},rw=S.forwardRef(bz);function Wv(n){return Ei(n,{inputAffixPadding:n.paddingXXS})}const Gv=n=>{const{controlHeight:e,fontSize:t,lineHeight:i,lineWidth:r,controlHeightSM:o,controlHeightLG:s,fontSizeLG:a,lineHeightLG:l,paddingSM:c,controlPaddingHorizontalSM:u,controlPaddingHorizontal:d,colorFillAlter:f,colorPrimaryHover:h,colorPrimary:p,controlOutlineWidth:m,controlOutline:g,colorErrorOutline:v,colorWarningOutline:x,colorBgContainer:b}=n;return{paddingBlock:Math.max(Math.round((e-t*i)/2*10)/10-r,0),paddingBlockSM:Math.max(Math.round((o-t*i)/2*10)/10-r,0),paddingBlockLG:Math.ceil((s-a*l)/2*10)/10-r,paddingInline:c-r,paddingInlineSM:u-r,paddingInlineLG:d-r,addonBg:f,activeBorderColor:p,hoverBorderColor:h,activeShadow:`0 0 0 ${m}px ${g}`,errorActiveShadow:`0 0 0 ${m}px ${v}`,warningActiveShadow:`0 0 0 ${m}px ${x}`,hoverBg:b,activeBg:b,inputFontSize:t,inputFontSizeLG:a,inputFontSizeSM:t}},yz=n=>({borderColor:n.hoverBorderColor,backgroundColor:n.hoverBg}),hf=n=>({color:n.colorTextDisabled,backgroundColor:n.colorBgContainerDisabled,borderColor:n.colorBorder,boxShadow:"none",cursor:"not-allowed",opacity:1,"input[disabled], textarea[disabled]":{cursor:"not-allowed"},"&:hover:not([disabled])":Object.assign({},yz(Ei(n,{hoverBorderColor:n.colorBorder,hoverBg:n.colorBgContainerDisabled})))}),Hv=(n,e)=>({background:n.colorBgContainer,borderWidth:n.lineWidth,borderStyle:n.lineType,borderColor:e.borderColor,"&:hover":{borderColor:e.hoverBorderColor,backgroundColor:n.hoverBg},"&:focus, &:focus-within":{borderColor:e.activeBorderColor,boxShadow:e.activeShadow,outline:0,backgroundColor:n.activeBg}}),ow=(n,e)=>({[`&${n.componentCls}-status-${e.status}:not(${n.componentCls}-disabled)`]:Object.assign(Object.assign({},Hv(n,e)),{[`${n.componentCls}-prefix, ${n.componentCls}-suffix`]:{color:e.affixColor}}),[`&${n.componentCls}-status-${e.status}${n.componentCls}-disabled`]:{borderColor:e.borderColor}}),wz=(n,e)=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Hv(n,{borderColor:n.colorBorder,hoverBorderColor:n.hoverBorderColor,activeBorderColor:n.activeBorderColor,activeShadow:n.activeShadow})),{[`&${n.componentCls}-disabled, &[disabled]`]:Object.assign({},hf(n))}),ow(n,{status:"error",borderColor:n.colorError,hoverBorderColor:n.colorErrorBorderHover,activeBorderColor:n.colorError,activeShadow:n.errorActiveShadow,affixColor:n.colorError})),ow(n,{status:"warning",borderColor:n.colorWarning,hoverBorderColor:n.colorWarningBorderHover,activeBorderColor:n.colorWarning,activeShadow:n.warningActiveShadow,affixColor:n.colorWarning})),e)}),sw=(n,e)=>({[`&${n.componentCls}-group-wrapper-status-${e.status}`]:{[`${n.componentCls}-group-addon`]:{borderColor:e.addonBorderColor,color:e.addonColor}}}),Cz=n=>({"&-outlined":Object.assign(Object.assign(Object.assign({[`${n.componentCls}-group`]:{"&-addon":{background:n.addonBg,border:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`},"&-addon:first-child":{borderInlineEnd:0},"&-addon:last-child":{borderInlineStart:0}}},sw(n,{status:"error",addonBorderColor:n.colorError,addonColor:n.colorErrorText})),sw(n,{status:"warning",addonBorderColor:n.colorWarning,addonColor:n.colorWarningText})),{[`&${n.componentCls}-group-wrapper-disabled`]:{[`${n.componentCls}-group-addon`]:Object.assign({},hf(n))}})}),Sz=(n,e)=>{const{componentCls:t}=n;return{"&-borderless":Object.assign({background:"transparent",border:"none","&:focus, &:focus-within":{outline:"none"},[`&${t}-disabled, &[disabled]`]:{color:n.colorTextDisabled,cursor:"not-allowed"},[`&${t}-status-error`]:{"&, & input, & textarea":{color:n.colorError}},[`&${t}-status-warning`]:{"&, & input, & textarea":{color:n.colorWarning}}},e)}},KI=(n,e)=>({background:e.bg,borderWidth:n.lineWidth,borderStyle:n.lineType,borderColor:"transparent","input&, & input, textarea&, & textarea":{color:e==null?void 0:e.inputColor},"&:hover":{background:e.hoverBg},"&:focus, &:focus-within":{outline:0,borderColor:e.activeBorderColor,backgroundColor:n.activeBg}}),aw=(n,e)=>({[`&${n.componentCls}-status-${e.status}:not(${n.componentCls}-disabled)`]:Object.assign(Object.assign({},KI(n,e)),{[`${n.componentCls}-prefix, ${n.componentCls}-suffix`]:{color:e.affixColor}})}),Iz=(n,e)=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},KI(n,{bg:n.colorFillTertiary,hoverBg:n.colorFillSecondary,activeBorderColor:n.activeBorderColor})),{[`&${n.componentCls}-disabled, &[disabled]`]:Object.assign({},hf(n))}),aw(n,{status:"error",bg:n.colorErrorBg,hoverBg:n.colorErrorBgHover,activeBorderColor:n.colorError,inputColor:n.colorErrorText,affixColor:n.colorError})),aw(n,{status:"warning",bg:n.colorWarningBg,hoverBg:n.colorWarningBgHover,activeBorderColor:n.colorWarning,inputColor:n.colorWarningText,affixColor:n.colorWarning})),e)}),lw=(n,e)=>({[`&${n.componentCls}-group-wrapper-status-${e.status}`]:{[`${n.componentCls}-group-addon`]:{background:e.addonBg,color:e.addonColor}}}),$z=n=>({"&-filled":Object.assign(Object.assign(Object.assign({[`${n.componentCls}-group`]:{"&-addon":{background:n.colorFillTertiary},[`${n.componentCls}-filled:not(:focus):not(:focus-within)`]:{"&:not(:first-child)":{borderInlineStart:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`},"&:not(:last-child)":{borderInlineEnd:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`}}}},lw(n,{status:"error",addonBg:n.colorErrorBg,addonColor:n.colorErrorText})),lw(n,{status:"warning",addonBg:n.colorWarningBg,addonColor:n.colorWarningText})),{[`&${n.componentCls}-group-wrapper-disabled`]:{[`${n.componentCls}-group`]:{"&-addon":{background:n.colorFillTertiary,color:n.colorTextDisabled},"&-addon:first-child":{borderInlineStart:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderTop:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderBottom:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`},"&-addon:last-child":{borderInlineEnd:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderTop:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderBottom:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`}}}})}),Ez=n=>({"&::-moz-placeholder":{opacity:1},"&::placeholder":{color:n,userSelect:"none"},"&:placeholder-shown":{textOverflow:"ellipsis"}}),XI=n=>{const{paddingBlockLG:e,lineHeightLG:t,borderRadiusLG:i,paddingInlineLG:r}=n;return{padding:`${ue(e)} ${ue(r)}`,fontSize:n.inputFontSizeLG,lineHeight:t,borderRadius:i}},Uv=n=>({padding:`${ue(n.paddingBlockSM)} ${ue(n.paddingInlineSM)}`,fontSize:n.inputFontSizeSM,borderRadius:n.borderRadiusSM}),jv=n=>Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",minWidth:0,padding:`${ue(n.paddingBlock)} ${ue(n.paddingInline)}`,color:n.colorText,fontSize:n.inputFontSize,lineHeight:n.lineHeight,borderRadius:n.borderRadius,transition:`all ${n.motionDurationMid}`},Ez(n.colorTextPlaceholder)),{"textarea&":{maxWidth:"100%",height:"auto",minHeight:n.controlHeight,lineHeight:n.lineHeight,verticalAlign:"bottom",transition:`all ${n.motionDurationSlow}, height 0s`,resize:"vertical"},"&-lg":Object.assign({},XI(n)),"&-sm":Object.assign({},Uv(n)),"&-rtl, &-textarea-rtl":{direction:"rtl"}}),Nz=n=>{const{componentCls:e,antCls:t}=n;return{position:"relative",display:"table",width:"100%",borderCollapse:"separate",borderSpacing:0,"&[class*='col-']":{paddingInlineEnd:n.paddingXS,"&:last-child":{paddingInlineEnd:0}},[`&-lg ${e}, &-lg > ${e}-group-addon`]:Object.assign({},XI(n)),[`&-sm ${e}, &-sm > ${e}-group-addon`]:Object.assign({},Uv(n)),[`&-lg ${t}-select-single ${t}-select-selector`]:{height:n.controlHeightLG},[`&-sm ${t}-select-single ${t}-select-selector`]:{height:n.controlHeightSM},[`> ${e}`]:{display:"table-cell","&:not(:first-child):not(:last-child)":{borderRadius:0}},[`${e}-group`]:{"&-addon, &-wrap":{display:"table-cell",width:1,whiteSpace:"nowrap",verticalAlign:"middle","&:not(:first-child):not(:last-child)":{borderRadius:0}},"&-wrap > *":{display:"block !important"},"&-addon":{position:"relative",padding:`0 ${ue(n.paddingInline)}`,color:n.colorText,fontWeight:"normal",fontSize:n.inputFontSize,textAlign:"center",borderRadius:n.borderRadius,transition:`all ${n.motionDurationSlow}`,lineHeight:1,[`${t}-select`]:{margin:`${ue(n.calc(n.paddingBlock).add(1).mul(-1).equal())} ${ue(n.calc(n.paddingInline).mul(-1).equal())}`,[`&${t}-select-single:not(${t}-select-customize-input):not(${t}-pagination-size-changer)`]:{[`${t}-select-selector`]:{backgroundColor:"inherit",border:`${ue(n.lineWidth)} ${n.lineType} transparent`,boxShadow:"none"}}},[`${t}-cascader-picker`]:{margin:`-9px ${ue(n.calc(n.paddingInline).mul(-1).equal())}`,backgroundColor:"transparent",[`${t}-cascader-input`]:{textAlign:"start",border:0,boxShadow:"none"}}}},[e]:{width:"100%",marginBottom:0,textAlign:"inherit","&:focus":{zIndex:1,borderInlineEndWidth:1},"&:hover":{zIndex:1,borderInlineEndWidth:1,[`${e}-search-with-button &`]:{zIndex:0}}},[`> ${e}:first-child, ${e}-group-addon:first-child`]:{borderStartEndRadius:0,borderEndEndRadius:0,[`${t}-select ${t}-select-selector`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${e}-affix-wrapper`]:{[`&:not(:first-child) ${e}`]:{borderStartStartRadius:0,borderEndStartRadius:0},[`&:not(:last-child) ${e}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${e}:last-child, ${e}-group-addon:last-child`]:{borderStartStartRadius:0,borderEndStartRadius:0,[`${t}-select ${t}-select-selector`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`${e}-affix-wrapper`]:{"&:not(:last-child)":{borderStartEndRadius:0,borderEndEndRadius:0,[`${e}-search &`]:{borderStartStartRadius:n.borderRadius,borderEndStartRadius:n.borderRadius}},[`&:not(:first-child), ${e}-search &:not(:first-child)`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&${e}-group-compact`]:Object.assign(Object.assign({display:"block"},y1()),{[`${e}-group-addon, ${e}-group-wrap, > ${e}`]:{"&:not(:first-child):not(:last-child)":{borderInlineEndWidth:n.lineWidth,"&:hover, &:focus":{zIndex:1}}},"& > *":{display:"inline-flex",float:"none",verticalAlign:"top",borderRadius:0},[`
        & > ${e}-affix-wrapper,
        & > ${e}-number-affix-wrapper,
        & > ${t}-picker-range
      `]:{display:"inline-flex"},"& > *:not(:last-child)":{marginInlineEnd:n.calc(n.lineWidth).mul(-1).equal(),borderInlineEndWidth:n.lineWidth},[e]:{float:"none"},[`& > ${t}-select > ${t}-select-selector,
      & > ${t}-select-auto-complete ${e},
      & > ${t}-cascader-picker ${e},
      & > ${e}-group-wrapper ${e}`]:{borderInlineEndWidth:n.lineWidth,borderRadius:0,"&:hover, &:focus":{zIndex:1}},[`& > ${t}-select-focused`]:{zIndex:1},[`& > ${t}-select > ${t}-select-arrow`]:{zIndex:1},[`& > *:first-child,
      & > ${t}-select:first-child > ${t}-select-selector,
      & > ${t}-select-auto-complete:first-child ${e},
      & > ${t}-cascader-picker:first-child ${e}`]:{borderStartStartRadius:n.borderRadius,borderEndStartRadius:n.borderRadius},[`& > *:last-child,
      & > ${t}-select:last-child > ${t}-select-selector,
      & > ${t}-cascader-picker:last-child ${e},
      & > ${t}-cascader-picker-focused:last-child ${e}`]:{borderInlineEndWidth:n.lineWidth,borderStartEndRadius:n.borderRadius,borderEndEndRadius:n.borderRadius},[`& > ${t}-select-auto-complete ${e}`]:{verticalAlign:"top"},[`${e}-group-wrapper + ${e}-group-wrapper`]:{marginInlineStart:n.calc(n.lineWidth).mul(-1).equal(),[`${e}-affix-wrapper`]:{borderRadius:0}},[`${e}-group-wrapper:not(:last-child)`]:{[`&${e}-search > ${e}-group`]:{[`& > ${e}-group-addon > ${e}-search-button`]:{borderRadius:0},[`& > ${e}`]:{borderStartStartRadius:n.borderRadius,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:n.borderRadius}}}})}},kz=n=>{const{componentCls:e,controlHeightSM:t,lineWidth:i,calc:r}=n,s=r(t).sub(r(i).mul(2)).sub(16).div(2).equal();return{[e]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},sr(n)),jv(n)),wz(n)),Iz(n)),Sz(n)),{'&[type="color"]':{height:n.controlHeight,[`&${e}-lg`]:{height:n.controlHeightLG},[`&${e}-sm`]:{height:t,paddingTop:s,paddingBottom:s}},'&[type="search"]::-webkit-search-cancel-button, &[type="search"]::-webkit-search-decoration':{"-webkit-appearance":"none"}})}},Dz=n=>{const{componentCls:e}=n;return{[`${e}-clear-icon`]:{margin:0,color:n.colorTextQuaternary,fontSize:n.fontSizeIcon,verticalAlign:-1,cursor:"pointer",transition:`color ${n.motionDurationSlow}`,"&:hover":{color:n.colorTextTertiary},"&:active":{color:n.colorText},"&-hidden":{visibility:"hidden"},"&-has-suffix":{margin:`0 ${ue(n.inputAffixPadding)}`}}}},Tz=n=>{const{componentCls:e,inputAffixPadding:t,colorTextDescription:i,motionDurationSlow:r,colorIcon:o,colorIconHover:s,iconCls:a}=n,l=`${e}-affix-wrapper`,c=`${e}-affix-wrapper-disabled`;return{[l]:Object.assign(Object.assign(Object.assign(Object.assign({},jv(n)),{display:"inline-flex",[`&:not(${e}-disabled):hover`]:{zIndex:1,[`${e}-search-with-button &`]:{zIndex:0}},"&-focused, &:focus":{zIndex:1},[`> input${e}`]:{padding:0},[`> input${e}, > textarea${e}`]:{fontSize:"inherit",border:"none",borderRadius:0,outline:"none",background:"transparent",color:"inherit","&::-ms-reveal":{display:"none"},"&:focus":{boxShadow:"none !important"}},"&::before":{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'},[e]:{"&-prefix, &-suffix":{display:"flex",flex:"none",alignItems:"center","> *:not(:last-child)":{marginInlineEnd:n.paddingXS}},"&-show-count-suffix":{color:i},"&-show-count-has-suffix":{marginInlineEnd:n.paddingXXS},"&-prefix":{marginInlineEnd:t},"&-suffix":{marginInlineStart:t}}}),Dz(n)),{[`${a}${e}-password-icon`]:{color:o,cursor:"pointer",transition:`all ${r}`,"&:hover":{color:s}}}),[c]:{[`${a}${e}-password-icon`]:{color:o,cursor:"not-allowed","&:hover":{color:o}}}}},Rz=n=>{const{componentCls:e,borderRadiusLG:t,borderRadiusSM:i}=n;return{[`${e}-group`]:Object.assign(Object.assign(Object.assign({},sr(n)),Nz(n)),{"&-rtl":{direction:"rtl"},"&-wrapper":Object.assign(Object.assign(Object.assign({display:"inline-block",width:"100%",textAlign:"start",verticalAlign:"top","&-rtl":{direction:"rtl"},"&-lg":{[`${e}-group-addon`]:{borderRadius:t,fontSize:n.inputFontSizeLG}},"&-sm":{[`${e}-group-addon`]:{borderRadius:i}}},Cz(n)),$z(n)),{[`&:not(${e}-compact-first-item):not(${e}-compact-last-item)${e}-compact-item`]:{[`${e}, ${e}-group-addon`]:{borderRadius:0}},[`&:not(${e}-compact-last-item)${e}-compact-first-item`]:{[`${e}, ${e}-group-addon`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${e}-compact-first-item)${e}-compact-last-item`]:{[`${e}, ${e}-group-addon`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&:not(${e}-compact-last-item)${e}-compact-item`]:{[`${e}-affix-wrapper`]:{borderStartEndRadius:0,borderEndEndRadius:0}}})})}},_z=n=>{const{componentCls:e,antCls:t}=n,i=`${e}-search`;return{[i]:{[e]:{"&:hover, &:focus":{[`+ ${e}-group-addon ${i}-button:not(${t}-btn-primary)`]:{borderInlineStartColor:n.colorPrimaryHover}}},[`${e}-affix-wrapper`]:{height:n.controlHeight,borderRadius:0},[`${e}-lg`]:{lineHeight:n.calc(n.lineHeightLG).sub(2e-4).equal()},[`> ${e}-group`]:{[`> ${e}-group-addon:last-child`]:{insetInlineStart:-1,padding:0,border:0,[`${i}-button`]:{marginInlineEnd:-1,paddingTop:0,paddingBottom:0,borderStartStartRadius:0,borderEndStartRadius:0,boxShadow:"none"},[`${i}-button:not(${t}-btn-primary)`]:{color:n.colorTextDescription,"&:hover":{color:n.colorPrimaryHover},"&:active":{color:n.colorPrimaryActive},[`&${t}-btn-loading::before`]:{insetInlineStart:0,insetInlineEnd:0,insetBlockStart:0,insetBlockEnd:0}}}},[`${i}-button`]:{height:n.controlHeight,"&:hover, &:focus":{zIndex:1}},"&-large":{[`${e}-affix-wrapper, ${i}-button`]:{height:n.controlHeightLG}},"&-small":{[`${e}-affix-wrapper, ${i}-button`]:{height:n.controlHeightSM}},"&-rtl":{direction:"rtl"},[`&${e}-compact-item`]:{[`&:not(${e}-compact-last-item)`]:{[`${e}-group-addon`]:{[`${e}-search-button`]:{marginInlineEnd:n.calc(n.lineWidth).mul(-1).equal(),borderRadius:0}}},[`&:not(${e}-compact-first-item)`]:{[`${e},${e}-affix-wrapper`]:{borderRadius:0}},[`> ${e}-group-addon ${e}-search-button,
        > ${e},
        ${e}-affix-wrapper`]:{"&:hover, &:focus, &:active":{zIndex:2}},[`> ${e}-affix-wrapper-focused`]:{zIndex:2}}}}},Az=n=>{const{componentCls:e,paddingLG:t}=n,i=`${e}-textarea`;return{[i]:{position:"relative","&-show-count":{[`> ${e}`]:{height:"100%"},[`${e}-data-count`]:{position:"absolute",bottom:n.calc(n.fontSize).mul(n.lineHeight).mul(-1).equal(),insetInlineEnd:0,color:n.colorTextDescription,whiteSpace:"nowrap",pointerEvents:"none"}},[`
        &-allow-clear > ${e},
        &-affix-wrapper${i}-has-feedback ${e}
      `]:{paddingInlineEnd:t},[`&-affix-wrapper${e}-affix-wrapper`]:{padding:0,[`> textarea${e}`]:{fontSize:"inherit",border:"none",outline:"none",background:"transparent","&:focus":{boxShadow:"none !important"}},[`${e}-suffix`]:{margin:0,"> *:not(:last-child)":{marginInline:0},[`${e}-clear-icon`]:{position:"absolute",insetInlineEnd:n.paddingInline,insetBlockStart:n.paddingXS},[`${i}-suffix`]:{position:"absolute",top:0,insetInlineEnd:n.paddingInline,bottom:0,zIndex:1,display:"inline-flex",alignItems:"center",margin:"auto",pointerEvents:"none"}}},[`&-affix-wrapper${e}-affix-wrapper-sm`]:{[`${e}-suffix`]:{[`${e}-clear-icon`]:{insetInlineEnd:n.paddingInlineSM}}}}}},Oz=n=>{const{componentCls:e}=n;return{[`${e}-out-of-range`]:{[`&, & input, & textarea, ${e}-show-count-suffix, ${e}-data-count`]:{color:n.colorError}}}},Kv=Xr("Input",n=>{const e=Ei(n,Wv(n));return[kz(e),Az(e),Tz(e),Rz(e),_z(e),Oz(e),x1(e)]},Gv,{resetFont:!1});function Ui(n,e){return n[e]}var Pz=["children"];function qI(n,e){return"".concat(n,"-").concat(e)}function Mz(n){return n&&n.type&&n.type.isTreeNode}function lu(n,e){return n??e}function Il(n){var e=n||{},t=e.title,i=e._title,r=e.key,o=e.children,s=t||"title";return{title:s,_title:i||[s],key:r||"key",children:o||"children"}}function YI(n){function e(t){var i=uv(t);return i.map(function(r){if(!Mz(r))return Fo(!r,"Tree/TreeNode can only accept TreeNode as children."),null;var o=r.key,s=r.props,a=s.children,l=En(s,Pz),c=me({key:o},l),u=e(a);return u.length&&(c.children=u),c}).filter(function(r){return r})}return e(n)}function lm(n,e,t){var i=Il(t),r=i._title,o=i.key,s=i.children,a=new Set(e===!0?[]:e),l=[];function c(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return u.map(function(f,h){for(var p=qI(d?d.pos:"0",h),m=lu(f[o],p),g,v=0;v<r.length;v+=1){var x=r[v];if(f[x]!==void 0){g=f[x];break}}var b=Object.assign(Da(f,[].concat(nt(r),[o,s])),{title:g,key:m,parent:d,pos:p,children:null,data:f,isStart:[].concat(nt(d?d.isStart:[]),[h===0]),isEnd:[].concat(nt(d?d.isEnd:[]),[h===u.length-1])});return l.push(b),e===!0||a.has(m)?b.children=c(f[s]||[],b):b.children=[],b})}return c(n),l}function Fz(n,e,t){var i={};vn(t)==="object"?i=t:i={externalGetKey:t},i=i||{};var r=i,o=r.childrenPropName,s=r.externalGetKey,a=r.fieldNames,l=Il(a),c=l.key,u=l.children,d=o||u,f;s?typeof s=="string"?f=function(m){return m[s]}:typeof s=="function"&&(f=function(m){return s(m)}):f=function(m,g){return lu(m[c],g)};function h(p,m,g,v){var x=p?p[d]:n,b=p?qI(g.pos,m):"0",w=p?[].concat(nt(v),[p]):[];if(p){var y=f(p,b),C={node:p,index:m,pos:b,key:y,parentPos:g.node?g.pos:null,level:g.level+1,nodes:w};e(C)}x&&x.forEach(function($,I){h($,I,{node:p,pos:b,level:g?g.level+1:-1},w)})}h(null)}function Xv(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.initWrapper,i=e.processEntity,r=e.onProcessFinished,o=e.externalGetKey,s=e.childrenPropName,a=e.fieldNames,l=arguments.length>2?arguments[2]:void 0,c=o||l,u={},d={},f={posEntities:u,keyEntities:d};return t&&(f=t(f)||f),Fz(n,function(h){var p=h.node,m=h.index,g=h.pos,v=h.key,x=h.parentPos,b=h.level,w=h.nodes,y={node:p,nodes:w,index:m,key:v,pos:g,level:b},C=lu(v,g);u[g]=y,d[C]=y,y.parent=u[x],y.parent&&(y.parent.children=y.parent.children||[],y.parent.children.push(y)),i&&i(y,f)},{externalGetKey:c,childrenPropName:s,fieldNames:a}),r&&r(f),f}function Tc(n,e){var t=e.expandedKeys,i=e.selectedKeys,r=e.loadedKeys,o=e.loadingKeys,s=e.checkedKeys,a=e.halfCheckedKeys,l=e.dragOverNodeKey,c=e.dropPosition,u=e.keyEntities,d=Ui(u,n),f={eventKey:n,expanded:t.indexOf(n)!==-1,selected:i.indexOf(n)!==-1,loaded:r.indexOf(n)!==-1,loading:o.indexOf(n)!==-1,checked:s.indexOf(n)!==-1,halfChecked:a.indexOf(n)!==-1,pos:String(d?d.pos:""),dragOver:l===n&&c===0,dragOverGapTop:l===n&&c===-1,dragOverGapBottom:l===n&&c===1};return f}function Fn(n){var e=n.data,t=n.expanded,i=n.selected,r=n.checked,o=n.loaded,s=n.loading,a=n.halfChecked,l=n.dragOver,c=n.dragOverGapTop,u=n.dragOverGapBottom,d=n.pos,f=n.active,h=n.eventKey,p=me(me({},e),{},{expanded:t,selected:i,checked:r,loaded:o,loading:s,halfChecked:a,dragOver:l,dragOverGapTop:c,dragOverGapBottom:u,pos:d,active:f,key:h});return"props"in p||Object.defineProperty(p,"props",{get:function(){return Fo(!1,"Second param return from event is node data instead of TreeNode instance. Please read value directly instead of reading from `props`."),n}}),p}function JI(n,e){var t=new Set;return n.forEach(function(i){e.has(i)||t.add(i)}),t}function Lz(n){var e=n||{},t=e.disabled,i=e.disableCheckbox,r=e.checkable;return!!(t||i)||r===!1}function zz(n,e,t,i){for(var r=new Set(n),o=new Set,s=0;s<=t;s+=1){var a=e.get(s)||new Set;a.forEach(function(d){var f=d.key,h=d.node,p=d.children,m=p===void 0?[]:p;r.has(f)&&!i(h)&&m.filter(function(g){return!i(g.node)}).forEach(function(g){r.add(g.key)})})}for(var l=new Set,c=t;c>=0;c-=1){var u=e.get(c)||new Set;u.forEach(function(d){var f=d.parent,h=d.node;if(!(i(h)||!d.parent||l.has(d.parent.key))){if(i(d.parent.node)){l.add(f.key);return}var p=!0,m=!1;(f.children||[]).filter(function(g){return!i(g.node)}).forEach(function(g){var v=g.key,x=r.has(v);p&&!x&&(p=!1),!m&&(x||o.has(v))&&(m=!0)}),p&&r.add(f.key),m&&o.add(f.key),l.add(f.key)}})}return{checkedKeys:Array.from(r),halfCheckedKeys:Array.from(JI(o,r))}}function Bz(n,e,t,i,r){for(var o=new Set(n),s=new Set(e),a=0;a<=i;a+=1){var l=t.get(a)||new Set;l.forEach(function(f){var h=f.key,p=f.node,m=f.children,g=m===void 0?[]:m;!o.has(h)&&!s.has(h)&&!r(p)&&g.filter(function(v){return!r(v.node)}).forEach(function(v){o.delete(v.key)})})}s=new Set;for(var c=new Set,u=i;u>=0;u-=1){var d=t.get(u)||new Set;d.forEach(function(f){var h=f.parent,p=f.node;if(!(r(p)||!f.parent||c.has(f.parent.key))){if(r(f.parent.node)){c.add(h.key);return}var m=!0,g=!1;(h.children||[]).filter(function(v){return!r(v.node)}).forEach(function(v){var x=v.key,b=o.has(x);m&&!b&&(m=!1),!g&&(b||s.has(x))&&(g=!0)}),m||o.delete(h.key),g&&s.add(h.key),c.add(h.key)}})}return{checkedKeys:Array.from(o),halfCheckedKeys:Array.from(JI(s,o))}}function ol(n,e,t,i){var r=[],o;i?o=i:o=Lz;var s=new Set(n.filter(function(u){var d=!!Ui(t,u);return d||r.push(u),d})),a=new Map,l=0;Object.keys(t).forEach(function(u){var d=t[u],f=d.level,h=a.get(f);h||(h=new Set,a.set(f,h)),h.add(d),l=Math.max(l,f)}),Fo(!r.length,"Tree missing follow keys: ".concat(r.slice(0,100).map(function(u){return"'".concat(u,"'")}).join(", ")));var c;return e===!0?c=zz(s,a,l,o):c=Bz(s,e.halfCheckedKeys,a,l,o),c}const Vz=n=>{const{checkboxCls:e}=n,t=`${e}-wrapper`;return[{[`${e}-group`]:Object.assign(Object.assign({},sr(n)),{display:"inline-flex",flexWrap:"wrap",columnGap:n.marginXS,[`> ${n.antCls}-row`]:{flex:1}}),[t]:Object.assign(Object.assign({},sr(n)),{display:"inline-flex",alignItems:"baseline",cursor:"pointer","&:after":{display:"inline-block",width:0,overflow:"hidden",content:"'\\a0'"},[`& + ${t}`]:{marginInlineStart:0},[`&${t}-in-form-item`]:{'input[type="checkbox"]':{width:14,height:14}}}),[e]:Object.assign(Object.assign({},sr(n)),{position:"relative",whiteSpace:"nowrap",lineHeight:1,cursor:"pointer",borderRadius:n.borderRadiusSM,alignSelf:"center",[`${e}-input`]:{position:"absolute",inset:0,zIndex:1,cursor:"pointer",opacity:0,margin:0,[`&:focus-visible + ${e}-inner`]:Object.assign({},fh(n))},[`${e}-inner`]:{boxSizing:"border-box",display:"block",width:n.checkboxSize,height:n.checkboxSize,direction:"ltr",backgroundColor:n.colorBgContainer,border:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderRadius:n.borderRadiusSM,borderCollapse:"separate",transition:`all ${n.motionDurationSlow}`,"&:after":{boxSizing:"border-box",position:"absolute",top:"50%",insetInlineStart:"25%",display:"table",width:n.calc(n.checkboxSize).div(14).mul(5).equal(),height:n.calc(n.checkboxSize).div(14).mul(8).equal(),border:`${ue(n.lineWidthBold)} solid ${n.colorWhite}`,borderTop:0,borderInlineStart:0,transform:"rotate(45deg) scale(0) translate(-50%,-50%)",opacity:0,content:'""',transition:`all ${n.motionDurationFast} ${n.motionEaseInBack}, opacity ${n.motionDurationFast}`}},"& + span":{paddingInlineStart:n.paddingXS,paddingInlineEnd:n.paddingXS}})},{[`
        ${t}:not(${t}-disabled),
        ${e}:not(${e}-disabled)
      `]:{[`&:hover ${e}-inner`]:{borderColor:n.colorPrimary}},[`${t}:not(${t}-disabled)`]:{[`&:hover ${e}-checked:not(${e}-disabled) ${e}-inner`]:{backgroundColor:n.colorPrimaryHover,borderColor:"transparent"},[`&:hover ${e}-checked:not(${e}-disabled):after`]:{borderColor:n.colorPrimaryHover}}},{[`${e}-checked`]:{[`${e}-inner`]:{backgroundColor:n.colorPrimary,borderColor:n.colorPrimary,"&:after":{opacity:1,transform:"rotate(45deg) scale(1) translate(-50%,-50%)",transition:`all ${n.motionDurationMid} ${n.motionEaseOutBack} ${n.motionDurationFast}`}}},[`
        ${t}-checked:not(${t}-disabled),
        ${e}-checked:not(${e}-disabled)
      `]:{[`&:hover ${e}-inner`]:{backgroundColor:n.colorPrimaryHover,borderColor:"transparent"}}},{[e]:{"&-indeterminate":{[`${e}-inner`]:{backgroundColor:`${n.colorBgContainer} !important`,borderColor:`${n.colorBorder} !important`,"&:after":{top:"50%",insetInlineStart:"50%",width:n.calc(n.fontSizeLG).div(2).equal(),height:n.calc(n.fontSizeLG).div(2).equal(),backgroundColor:n.colorPrimary,border:0,transform:"translate(-50%, -50%) scale(1)",opacity:1,content:'""'}},[`&:hover ${e}-inner`]:{backgroundColor:`${n.colorBgContainer} !important`,borderColor:`${n.colorPrimary} !important`}}}},{[`${t}-disabled`]:{cursor:"not-allowed"},[`${e}-disabled`]:{[`&, ${e}-input`]:{cursor:"not-allowed",pointerEvents:"none"},[`${e}-inner`]:{background:n.colorBgContainerDisabled,borderColor:n.colorBorder,"&:after":{borderColor:n.colorTextDisabled}},"&:after":{display:"none"},"& + span":{color:n.colorTextDisabled},[`&${e}-indeterminate ${e}-inner::after`]:{background:n.colorTextDisabled}}}]};function ZI(n,e){const t=Ei(e,{checkboxCls:`.${n}`,checkboxSize:e.controlInteractiveSize});return[Vz(t)]}const QI=Xr("Checkbox",(n,e)=>{let{prefixCls:t}=e;return[ZI(t,n)]}),e$=le.createContext(null);var Wz=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const Gz=(n,e)=>{var t;const{prefixCls:i,className:r,rootClassName:o,children:s,indeterminate:a=!1,style:l,onMouseEnter:c,onMouseLeave:u,skipGroup:d=!1,disabled:f}=n,h=Wz(n,["prefixCls","className","rootClassName","children","indeterminate","style","onMouseEnter","onMouseLeave","skipGroup","disabled"]),{getPrefixCls:p,direction:m,checkbox:g}=S.useContext(Nn),v=S.useContext(e$),{isFormItemInput:x}=S.useContext(xs),b=S.useContext(nu),w=(t=(v==null?void 0:v.disabled)||f)!==null&&t!==void 0?t:b,y=S.useRef(h.value),C=S.useRef(null),$=tu(e,C);S.useEffect(()=>{v==null||v.registerValue(h.value)},[]),S.useEffect(()=>{if(!d)return h.value!==y.current&&(v==null||v.cancelValue(y.current),v==null||v.registerValue(h.value),y.current=h.value),()=>v==null?void 0:v.cancelValue(h.value)},[h.value]),S.useEffect(()=>{var A;!((A=C.current)===null||A===void 0)&&A.input&&(C.current.input.indeterminate=a)},[a]);const I=p("checkbox",i),E=Ta(I),[N,k,D]=QI(I,E),_=Object.assign({},h);v&&!d&&(_.onChange=function(){h.onChange&&h.onChange.apply(h,arguments),v.toggleOption&&v.toggleOption({label:s,value:h.value})},_.name=v.name,_.checked=v.value.includes(h.value));const R=ye(`${I}-wrapper`,{[`${I}-rtl`]:m==="rtl",[`${I}-wrapper-checked`]:_.checked,[`${I}-wrapper-disabled`]:w,[`${I}-wrapper-in-form-item`]:x},g==null?void 0:g.className,r,o,D,E,k),T=ye({[`${I}-indeterminate`]:a},G_,k);return N(S.createElement(H_,{component:"Checkbox",disabled:w},S.createElement("label",{className:R,style:Object.assign(Object.assign({},g==null?void 0:g.style),l),onMouseEnter:c,onMouseLeave:u},S.createElement(pA,Object.assign({},_,{prefixCls:I,className:T,disabled:w,ref:$})),s!==void 0&&S.createElement("span",null,s))))},t$=S.forwardRef(Gz);var Hz=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const Uz=S.forwardRef((n,e)=>{const{defaultValue:t,children:i,options:r=[],prefixCls:o,className:s,rootClassName:a,style:l,onChange:c}=n,u=Hz(n,["defaultValue","children","options","prefixCls","className","rootClassName","style","onChange"]),{getPrefixCls:d,direction:f}=S.useContext(Nn),[h,p]=S.useState(u.value||t||[]),[m,g]=S.useState([]);S.useEffect(()=>{"value"in u&&p(u.value||[])},[u.value]);const v=S.useMemo(()=>r.map(T=>typeof T=="string"||typeof T=="number"?{label:T,value:T}:T),[r]),x=T=>{g(A=>A.filter(O=>O!==T))},b=T=>{g(A=>[].concat(nt(A),[T]))},w=T=>{const A=h.indexOf(T.value),O=nt(h);A===-1?O.push(T.value):O.splice(A,1),"value"in u||p(O),c==null||c(O.filter(P=>m.includes(P)).sort((P,M)=>{const z=v.findIndex(W=>W.value===P),L=v.findIndex(W=>W.value===M);return z-L}))},y=d("checkbox",o),C=`${y}-group`,$=Ta(y),[I,E,N]=QI(y,$),k=Da(u,["value","disabled"]),D=r.length?v.map(T=>S.createElement(t$,{prefixCls:y,key:T.value.toString(),disabled:"disabled"in T?T.disabled:u.disabled,value:T.value,checked:h.includes(T.value),onChange:T.onChange,className:`${C}-item`,style:T.style,title:T.title,id:T.id,required:T.required},T.label)):i,_={toggleOption:w,value:h,disabled:u.disabled,name:u.name,registerValue:b,cancelValue:x},R=ye(C,{[`${C}-rtl`]:f==="rtl"},s,a,N,$,E);return I(S.createElement("div",Object.assign({className:R,style:l},k,{ref:e}),S.createElement(e$.Provider,{value:_},D)))}),$l=t$;$l.Group=Uz;$l.__ANT_CHECKBOX=!0;const n$=S.createContext({}),jz=n=>{const{componentCls:e}=n;return{[e]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},Kz=n=>{const{componentCls:e}=n;return{[e]:{position:"relative",maxWidth:"100%",minHeight:1}}},Xz=(n,e)=>{const{prefixCls:t,componentCls:i,gridColumns:r}=n,o={};for(let s=r;s>=0;s--)s===0?(o[`${i}${e}-${s}`]={display:"none"},o[`${i}-push-${s}`]={insetInlineStart:"auto"},o[`${i}-pull-${s}`]={insetInlineEnd:"auto"},o[`${i}${e}-push-${s}`]={insetInlineStart:"auto"},o[`${i}${e}-pull-${s}`]={insetInlineEnd:"auto"},o[`${i}${e}-offset-${s}`]={marginInlineStart:0},o[`${i}${e}-order-${s}`]={order:0}):(o[`${i}${e}-${s}`]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${s/r*100}%`,maxWidth:`${s/r*100}%`}],o[`${i}${e}-push-${s}`]={insetInlineStart:`${s/r*100}%`},o[`${i}${e}-pull-${s}`]={insetInlineEnd:`${s/r*100}%`},o[`${i}${e}-offset-${s}`]={marginInlineStart:`${s/r*100}%`},o[`${i}${e}-order-${s}`]={order:s});return o[`${i}${e}-flex`]={flex:`var(--${t}${e}-flex)`},o},tg=(n,e)=>Xz(n,e),qz=(n,e,t)=>({[`@media (min-width: ${ue(e)})`]:Object.assign({},tg(n,t))}),Yz=()=>({}),Jz=()=>({}),Zz=Xr("Grid",jz,Yz),Qz=Xr("Grid",n=>{const e=Ei(n,{gridColumns:24}),t={"-sm":e.screenSMMin,"-md":e.screenMDMin,"-lg":e.screenLGMin,"-xl":e.screenXLMin,"-xxl":e.screenXXLMin};return[Kz(e),tg(e,""),tg(e,"-xs"),Object.keys(t).map(i=>qz(e,t[i],i)).reduce((i,r)=>Object.assign(Object.assign({},i),r),{})]},Jz);var e3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};function cw(n){return typeof n=="number"?`${n} ${n} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(n)?`0 0 ${n}`:n}const t3=["xs","sm","md","lg","xl","xxl"],n3=S.forwardRef((n,e)=>{const{getPrefixCls:t,direction:i}=S.useContext(Nn),{gutter:r,wrap:o}=S.useContext(n$),{prefixCls:s,span:a,order:l,offset:c,push:u,pull:d,className:f,children:h,flex:p,style:m}=n,g=e3(n,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),v=t("col",s),[x,b,w]=Qz(v),y={};let C={};t3.forEach(E=>{let N={};const k=n[E];typeof k=="number"?N.span=k:typeof k=="object"&&(N=k||{}),delete g[E],C=Object.assign(Object.assign({},C),{[`${v}-${E}-${N.span}`]:N.span!==void 0,[`${v}-${E}-order-${N.order}`]:N.order||N.order===0,[`${v}-${E}-offset-${N.offset}`]:N.offset||N.offset===0,[`${v}-${E}-push-${N.push}`]:N.push||N.push===0,[`${v}-${E}-pull-${N.pull}`]:N.pull||N.pull===0,[`${v}-rtl`]:i==="rtl"}),N.flex&&(C[`${v}-${E}-flex`]=!0,y[`--${v}-${E}-flex`]=cw(N.flex))});const $=ye(v,{[`${v}-${a}`]:a!==void 0,[`${v}-order-${l}`]:l,[`${v}-offset-${c}`]:c,[`${v}-push-${u}`]:u,[`${v}-pull-${d}`]:d},f,C,b,w),I={};if(r&&r[0]>0){const E=r[0]/2;I.paddingLeft=E,I.paddingRight=E}return p&&(I.flex=cw(p),o===!1&&!I.minWidth&&(I.minWidth=0)),x(S.createElement("div",Object.assign({},g,{style:Object.assign(Object.assign(Object.assign({},I),m),y),className:$,ref:e}),h))});var i3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};function uw(n,e){const[t,i]=S.useState(typeof n=="string"?n:""),r=()=>{if(typeof n=="string"&&i(n),typeof n=="object")for(let o=0;o<yl.length;o++){const s=yl[o];if(!e[s])continue;const a=n[s];if(a!==void 0){i(a);return}}};return S.useEffect(()=>{r()},[JSON.stringify(n),e]),t}const r3=S.forwardRef((n,e)=>{const{prefixCls:t,justify:i,align:r,className:o,style:s,children:a,gutter:l=0,wrap:c}=n,u=i3(n,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:d,direction:f}=S.useContext(Nn),[h,p]=S.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[m,g]=S.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),v=uw(r,m),x=uw(i,m),b=S.useRef(l),w=vA();S.useEffect(()=>{const O=w.subscribe(P=>{g(P);const M=b.current||0;(!Array.isArray(M)&&typeof M=="object"||Array.isArray(M)&&(typeof M[0]=="object"||typeof M[1]=="object"))&&p(P)});return()=>w.unsubscribe(O)},[]);const y=()=>{const O=[void 0,void 0];return(Array.isArray(l)?l:[l,void 0]).forEach((M,z)=>{if(typeof M=="object")for(let L=0;L<yl.length;L++){const W=yl[L];if(h[W]&&M[W]!==void 0){O[z]=M[W];break}}else O[z]=M}),O},C=d("row",t),[$,I,E]=Zz(C),N=y(),k=ye(C,{[`${C}-no-wrap`]:c===!1,[`${C}-${x}`]:x,[`${C}-${v}`]:v,[`${C}-rtl`]:f==="rtl"},o,I,E),D={},_=N[0]!=null&&N[0]>0?N[0]/-2:void 0;_&&(D.marginLeft=_,D.marginRight=_);const[R,T]=N;D.rowGap=T;const A=S.useMemo(()=>({gutter:[R,T],wrap:c}),[R,T,c]);return $(S.createElement(n$.Provider,{value:A},S.createElement("div",Object.assign({},u,{className:k,style:Object.assign(Object.assign({},D),s),ref:e}),a)))});function o3(n){return!!(n.addonBefore||n.addonAfter)}function s3(n){return!!(n.prefix||n.suffix||n.allowClear)}function dw(n,e,t){var i=e.cloneNode(!0),r=Object.create(n,{target:{value:i},currentTarget:{value:i}});return i.value=t,typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"&&(i.selectionStart=e.selectionStart,i.selectionEnd=e.selectionEnd),i.setSelectionRange=function(){e.setSelectionRange.apply(e,arguments)},r}function vh(n,e,t,i){if(t){var r=e;if(e.type==="click"){r=dw(e,n,""),t(r);return}if(n.type!=="file"&&i!==void 0){r=dw(e,n,i),t(r);return}t(r)}}function i$(n,e){if(n){n.focus(e);var t=e||{},i=t.cursor;if(i){var r=n.value.length;switch(i){case"start":n.setSelectionRange(0,0);break;case"end":n.setSelectionRange(r,r);break;default:n.setSelectionRange(0,r)}}}}var r$=le.forwardRef(function(n,e){var t,i,r=n.inputElement,o=n.children,s=n.prefixCls,a=n.prefix,l=n.suffix,c=n.addonBefore,u=n.addonAfter,d=n.className,f=n.style,h=n.disabled,p=n.readOnly,m=n.focused,g=n.triggerFocus,v=n.allowClear,x=n.value,b=n.handleReset,w=n.hidden,y=n.classes,C=n.classNames,$=n.dataAttrs,I=n.styles,E=n.components,N=n.onClear,k=o??r,D=(E==null?void 0:E.affixWrapper)||"span",_=(E==null?void 0:E.groupWrapper)||"span",R=(E==null?void 0:E.wrapper)||"span",T=(E==null?void 0:E.groupAddon)||"span",A=S.useRef(null),O=function(se){var ce;(ce=A.current)!==null&&ce!==void 0&&ce.contains(se.target)&&(g==null||g())},P=s3(n),M=S.cloneElement(k,{value:x,className:ye(k.props.className,!P&&(C==null?void 0:C.variant))||null}),z=S.useRef(null);if(le.useImperativeHandle(e,function(){return{nativeElement:z.current||A.current}}),P){var L=null;if(v){var W=!h&&!p&&x,U="".concat(s,"-clear-icon"),V=vn(v)==="object"&&v!==null&&v!==void 0&&v.clearIcon?v.clearIcon:"";L=le.createElement("span",{onClick:function(se){b==null||b(se),N==null||N()},onMouseDown:function(se){return se.preventDefault()},className:ye(U,J(J({},"".concat(U,"-hidden"),!W),"".concat(U,"-has-suffix"),!!l)),role:"button",tabIndex:-1},V)}var H="".concat(s,"-affix-wrapper"),Y=ye(H,J(J(J(J(J({},"".concat(s,"-disabled"),h),"".concat(H,"-disabled"),h),"".concat(H,"-focused"),m),"".concat(H,"-readonly"),p),"".concat(H,"-input-with-clear-btn"),l&&v&&x),y==null?void 0:y.affixWrapper,C==null?void 0:C.affixWrapper,C==null?void 0:C.variant),Q=(l||v)&&le.createElement("span",{className:ye("".concat(s,"-suffix"),C==null?void 0:C.suffix),style:I==null?void 0:I.suffix},L,l);M=le.createElement(D,ze({className:Y,style:I==null?void 0:I.affixWrapper,onClick:O},$==null?void 0:$.affixWrapper,{ref:A}),a&&le.createElement("span",{className:ye("".concat(s,"-prefix"),C==null?void 0:C.prefix),style:I==null?void 0:I.prefix},a),M,Q)}if(o3(n)){var Z="".concat(s,"-group"),pe="".concat(Z,"-addon"),oe="".concat(Z,"-wrapper"),X=ye("".concat(s,"-wrapper"),Z,y==null?void 0:y.wrapper,C==null?void 0:C.wrapper),j=ye(oe,J({},"".concat(oe,"-disabled"),h),y==null?void 0:y.group,C==null?void 0:C.groupWrapper);M=le.createElement(_,{className:j,ref:z},le.createElement(R,{className:X},c&&le.createElement(T,{className:pe},c),M,u&&le.createElement(T,{className:pe},u)))}return le.cloneElement(M,{className:ye((t=M.props)===null||t===void 0?void 0:t.className,d)||null,style:me(me({},(i=M.props)===null||i===void 0?void 0:i.style),f),hidden:w})}),a3=["show"];function o$(n,e){return S.useMemo(function(){var t={};e&&(t.show=vn(e)==="object"&&e.formatter?e.formatter:!!e),t=me(me({},t),n);var i=t,r=i.show,o=En(i,a3);return me(me({},o),{},{show:!!r,showFormatter:typeof r=="function"?r:void 0,strategy:o.strategy||function(s){return s.length}})},[n,e])}var l3=["autoComplete","onChange","onFocus","onBlur","onPressEnter","onKeyDown","onKeyUp","prefixCls","disabled","htmlSize","className","maxLength","suffix","showCount","count","type","classes","classNames","styles","onCompositionStart","onCompositionEnd"],c3=S.forwardRef(function(n,e){var t=n.autoComplete,i=n.onChange,r=n.onFocus,o=n.onBlur,s=n.onPressEnter,a=n.onKeyDown,l=n.onKeyUp,c=n.prefixCls,u=c===void 0?"rc-input":c,d=n.disabled,f=n.htmlSize,h=n.className,p=n.maxLength,m=n.suffix,g=n.showCount,v=n.count,x=n.type,b=x===void 0?"text":x,w=n.classes,y=n.classNames,C=n.styles,$=n.onCompositionStart,I=n.onCompositionEnd,E=En(n,l3),N=S.useState(!1),k=ke(N,2),D=k[0],_=k[1],R=S.useRef(!1),T=S.useRef(!1),A=S.useRef(null),O=S.useRef(null),P=function(ve){A.current&&i$(A.current,ve)},M=Vo(n.defaultValue,{value:n.value}),z=ke(M,2),L=z[0],W=z[1],U=L==null?"":String(L),V=S.useState(null),H=ke(V,2),Y=H[0],Q=H[1],Z=o$(v,g),pe=Z.max||p,oe=Z.strategy(U),X=!!pe&&oe>pe;S.useImperativeHandle(e,function(){var we;return{focus:P,blur:function(){var Ne;(Ne=A.current)===null||Ne===void 0||Ne.blur()},setSelectionRange:function(Ne,Ae,Ve){var Ue;(Ue=A.current)===null||Ue===void 0||Ue.setSelectionRange(Ne,Ae,Ve)},select:function(){var Ne;(Ne=A.current)===null||Ne===void 0||Ne.select()},input:A.current,nativeElement:((we=O.current)===null||we===void 0?void 0:we.nativeElement)||A.current}}),S.useEffect(function(){_(function(we){return we&&d?!1:we})},[d]);var j=function(ve,Ne,Ae){var Ve=Ne;if(!R.current&&Z.exceedFormatter&&Z.max&&Z.strategy(Ne)>Z.max){if(Ve=Z.exceedFormatter(Ne,{max:Z.max}),Ne!==Ve){var Ue,We;Q([((Ue=A.current)===null||Ue===void 0?void 0:Ue.selectionStart)||0,((We=A.current)===null||We===void 0?void 0:We.selectionEnd)||0])}}else if(Ae.source==="compositionEnd")return;W(Ve),A.current&&vh(A.current,ve,i,Ve)};S.useEffect(function(){if(Y){var we;(we=A.current)===null||we===void 0||we.setSelectionRange.apply(we,nt(Y))}},[Y]);var ne=function(ve){j(ve,ve.target.value,{source:"change"})},se=function(ve){R.current=!1,j(ve,ve.currentTarget.value,{source:"compositionEnd"}),I==null||I(ve)},ce=function(ve){s&&ve.key==="Enter"&&!T.current&&(T.current=!0,s(ve)),a==null||a(ve)},re=function(ve){ve.key==="Enter"&&(T.current=!1),l==null||l(ve)},be=function(ve){_(!0),r==null||r(ve)},Ie=function(ve){_(!1),o==null||o(ve)},Ee=function(ve){W(""),P(),A.current&&vh(A.current,ve,i)},Se=X&&"".concat(u,"-out-of-range"),fe=function(){var ve=Da(n,["prefixCls","onPressEnter","addonBefore","addonAfter","prefix","suffix","allowClear","defaultValue","showCount","count","classes","htmlSize","styles","classNames","onClear"]);return le.createElement("input",ze({autoComplete:t},ve,{onChange:ne,onFocus:be,onBlur:Ie,onKeyDown:ce,onKeyUp:re,className:ye(u,J({},"".concat(u,"-disabled"),d),y==null?void 0:y.input),style:C==null?void 0:C.input,ref:A,size:f,type:b,onCompositionStart:function(Ae){R.current=!0,$==null||$(Ae)},onCompositionEnd:se}))},ge=function(){var ve=Number(pe)>0;if(m||Z.show){var Ne=Z.showFormatter?Z.showFormatter({value:U,count:oe,maxLength:pe}):"".concat(oe).concat(ve?" / ".concat(pe):"");return le.createElement(le.Fragment,null,Z.show&&le.createElement("span",{className:ye("".concat(u,"-show-count-suffix"),J({},"".concat(u,"-show-count-has-suffix"),!!m),y==null?void 0:y.count),style:me({},C==null?void 0:C.count)},Ne),m)}return null};return le.createElement(r$,ze({},E,{prefixCls:u,className:ye(h,Se),handleReset:Ee,value:U,focused:D,triggerFocus:P,suffix:ge(),disabled:d,classes:w,classNames:y,styles:C}),fe())});const u3=n=>{const{getPrefixCls:e,direction:t}=S.useContext(Nn),{prefixCls:i,className:r}=n,o=e("input-group",i),s=e("input"),[a,l]=Kv(s),c=ye(o,{[`${o}-lg`]:n.size==="large",[`${o}-sm`]:n.size==="small",[`${o}-compact`]:n.compact,[`${o}-rtl`]:t==="rtl"},l,r),u=S.useContext(xs),d=S.useMemo(()=>Object.assign(Object.assign({},u),{isFormItemInput:!1}),[u]);return a(S.createElement("span",{className:c,style:n.style,onMouseEnter:n.onMouseEnter,onMouseLeave:n.onMouseLeave,onFocus:n.onFocus,onBlur:n.onBlur},S.createElement(xs.Provider,{value:d},n.children)))},s$=n=>{let e;return typeof n=="object"&&(n!=null&&n.clearIcon)?e=n:n&&(e={clearIcon:le.createElement(N1,null)}),e};function a$(n,e){const t=S.useRef([]),i=()=>{t.current.push(setTimeout(()=>{var r,o,s,a;!((r=n.current)===null||r===void 0)&&r.input&&((o=n.current)===null||o===void 0?void 0:o.input.getAttribute("type"))==="password"&&(!((s=n.current)===null||s===void 0)&&s.input.hasAttribute("value"))&&((a=n.current)===null||a===void 0||a.input.removeAttribute("value"))}))};return S.useEffect(()=>(e&&i(),()=>t.current.forEach(r=>{r&&clearTimeout(r)})),[]),i}function d3(n){return!!(n.prefix||n.suffix||n.allowClear||n.showCount)}var h3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const ff=S.forwardRef((n,e)=>{var t;const{prefixCls:i,bordered:r=!0,status:o,size:s,disabled:a,onBlur:l,onFocus:c,suffix:u,allowClear:d,addonAfter:f,addonBefore:h,className:p,style:m,styles:g,rootClassName:v,onChange:x,classNames:b,variant:w}=n,y=h3(n,["prefixCls","bordered","status","size","disabled","onBlur","onFocus","suffix","allowClear","addonAfter","addonBefore","className","style","styles","rootClassName","onChange","classNames","variant"]),{getPrefixCls:C,direction:$,input:I}=le.useContext(Nn),E=C("input",i),N=S.useRef(null),k=Ta(E),[D,_,R]=Kv(E,k),{compactSize:T,compactItemClassnames:A}=hv(E,$),O=Ns(ne=>{var se;return(se=s??T)!==null&&se!==void 0?se:ne}),P=le.useContext(nu),M=a??P,{status:z,hasFeedback:L,feedbackIcon:W}=S.useContext(xs),U=df(z,o),V=d3(n)||!!L;S.useRef(V);const H=a$(N,!0),Y=ne=>{H(),l==null||l(ne)},Q=ne=>{H(),c==null||c(ne)},Z=ne=>{H(),x==null||x(ne)},pe=(L||u)&&le.createElement(le.Fragment,null,u,L&&W),oe=s$(d??(I==null?void 0:I.allowClear)),[X,j]=Bv("input",w,r);return D(le.createElement(c3,Object.assign({ref:tu(e,N),prefixCls:E,autoComplete:I==null?void 0:I.autoComplete},y,{disabled:M,onBlur:Y,onFocus:Q,style:Object.assign(Object.assign({},I==null?void 0:I.style),m),styles:Object.assign(Object.assign({},I==null?void 0:I.styles),g),suffix:pe,allowClear:oe,className:ye(p,v,R,k,A,I==null?void 0:I.className),onChange:Z,addonBefore:h&&le.createElement(py,{form:!0,space:!0},h),addonAfter:f&&le.createElement(py,{form:!0,space:!0},f),classNames:Object.assign(Object.assign(Object.assign({},b),I==null?void 0:I.classNames),{input:ye({[`${E}-sm`]:O==="small",[`${E}-lg`]:O==="large",[`${E}-rtl`]:$==="rtl"},b==null?void 0:b.input,(t=I==null?void 0:I.classNames)===null||t===void 0?void 0:t.input,_),variant:ye({[`${E}-${X}`]:j},gh(E,U)),affixWrapper:ye({[`${E}-affix-wrapper-sm`]:O==="small",[`${E}-affix-wrapper-lg`]:O==="large",[`${E}-affix-wrapper-rtl`]:$==="rtl"},_),wrapper:ye({[`${E}-group-rtl`]:$==="rtl"},_),groupWrapper:ye({[`${E}-group-wrapper-sm`]:O==="small",[`${E}-group-wrapper-lg`]:O==="large",[`${E}-group-wrapper-rtl`]:$==="rtl",[`${E}-group-wrapper-${X}`]:j},gh(`${E}-group-wrapper`,U,L),_)})})))}),f3=n=>{const{componentCls:e,paddingXS:t}=n;return{[e]:{display:"inline-flex",alignItems:"center",flexWrap:"nowrap",columnGap:t,"&-rtl":{direction:"rtl"},[`${e}-input`]:{textAlign:"center",paddingInline:n.paddingXXS},[`&${e}-sm ${e}-input`]:{paddingInline:n.calc(n.paddingXXS).div(2).equal()},[`&${e}-lg ${e}-input`]:{paddingInline:n.paddingXS}}}},p3=Xr(["Input","OTP"],n=>{const e=Ei(n,Wv(n));return[f3(e)]},Gv);var m3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const g3=S.forwardRef((n,e)=>{const{value:t,onChange:i,onActiveChange:r,index:o,mask:s}=n,a=m3(n,["value","onChange","onActiveChange","index","mask"]),l=t&&typeof s=="string"?s:t,c=p=>{i(o,p.target.value)},u=S.useRef(null);S.useImperativeHandle(e,()=>u.current);const d=()=>{Mi(()=>{var p;const m=(p=u.current)===null||p===void 0?void 0:p.input;document.activeElement===m&&m&&m.select()})},f=p=>{const{key:m,ctrlKey:g,metaKey:v}=p;m==="ArrowLeft"?r(o-1):m==="ArrowRight"?r(o+1):m==="z"&&(g||v)&&p.preventDefault(),d()},h=p=>{p.key==="Backspace"&&!t&&r(o-1),d()};return S.createElement(ff,Object.assign({type:s===!0?"password":"text"},a,{ref:u,value:l,onInput:c,onFocus:d,onKeyDown:f,onKeyUp:h,onMouseDown:d,onMouseUp:d}))});var v3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};function Rd(n){return(n||"").split("")}const x3=S.forwardRef((n,e)=>{const{prefixCls:t,length:i=6,size:r,defaultValue:o,value:s,onChange:a,formatter:l,variant:c,disabled:u,status:d,autoFocus:f,mask:h,type:p,onInput:m,inputMode:g}=n,v=v3(n,["prefixCls","length","size","defaultValue","value","onChange","formatter","variant","disabled","status","autoFocus","mask","type","onInput","inputMode"]),{getPrefixCls:x,direction:b}=S.useContext(Nn),w=x("otp",t),y=Co(v,{aria:!0,data:!0,attr:!0}),C=Ta(w),[$,I,E]=p3(w,C),N=Ns(V=>r??V),k=S.useContext(xs),D=df(k.status,d),_=S.useMemo(()=>Object.assign(Object.assign({},k),{status:D,hasFeedback:!1,feedbackIcon:null}),[k,D]),R=S.useRef(null),T=S.useRef({});S.useImperativeHandle(e,()=>({focus:()=>{var V;(V=T.current[0])===null||V===void 0||V.focus()},blur:()=>{var V;for(let H=0;H<i;H+=1)(V=T.current[H])===null||V===void 0||V.blur()},nativeElement:R.current}));const A=V=>l?l(V):V,[O,P]=S.useState(Rd(A(o||"")));S.useEffect(()=>{s!==void 0&&P(Rd(s))},[s]);const M=Nr(V=>{P(V),m&&m(V),a&&V.length===i&&V.every(H=>H)&&V.some((H,Y)=>O[Y]!==H)&&a(V.join(""))}),z=Nr((V,H)=>{let Y=nt(O);for(let Z=0;Z<V;Z+=1)Y[Z]||(Y[Z]="");H.length<=1?Y[V]=H:Y=Y.slice(0,V).concat(Rd(H)),Y=Y.slice(0,i);for(let Z=Y.length-1;Z>=0&&!Y[Z];Z-=1)Y.pop();const Q=A(Y.map(Z=>Z||" ").join(""));return Y=Rd(Q).map((Z,pe)=>Z===" "&&!Y[pe]?Y[pe]:Z),Y}),L=(V,H)=>{var Y;const Q=z(V,H),Z=Math.min(V+H.length,i-1);Z!==V&&((Y=T.current[Z])===null||Y===void 0||Y.focus()),M(Q)},W=V=>{var H;(H=T.current[V])===null||H===void 0||H.focus()},U={variant:c,disabled:u,status:D,mask:h,type:p,inputMode:g};return $(S.createElement("div",Object.assign({},y,{ref:R,className:ye(w,{[`${w}-sm`]:N==="small",[`${w}-lg`]:N==="large",[`${w}-rtl`]:b==="rtl"},E,I)}),S.createElement(xs.Provider,{value:_},Array.from({length:i}).map((V,H)=>{const Y=`otp-${H}`,Q=O[H]||"";return S.createElement(g3,Object.assign({ref:Z=>{T.current[H]=Z},key:Y,index:H,size:N,htmlSize:1,className:`${w}-input`,onChange:L,value:Q,onActiveChange:W,autoFocus:H===0&&f},U))}))))});var b3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}},{tag:"path",attrs:{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"}}]},name:"eye-invisible",theme:"outlined"},y3=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:b3}))},w3=S.forwardRef(y3),C3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"},S3=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:C3}))},I3=S.forwardRef(S3),$3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const E3=n=>n?S.createElement(I3,null):S.createElement(w3,null),N3={click:"onClick",hover:"onMouseOver"},k3=S.forwardRef((n,e)=>{const{disabled:t,action:i="click",visibilityToggle:r=!0,iconRender:o=E3}=n,s=S.useContext(nu),a=t??s,l=typeof r=="object"&&r.visible!==void 0,[c,u]=S.useState(()=>l?r.visible:!1),d=S.useRef(null);S.useEffect(()=>{l&&u(r.visible)},[l,r]);const f=a$(d),h=()=>{a||(c&&f(),u(N=>{var k;const D=!N;return typeof r=="object"&&((k=r.onVisibleChange)===null||k===void 0||k.call(r,D)),D}))},p=N=>{const k=N3[i]||"",D=o(c),_={[k]:h,className:`${N}-icon`,key:"passwordIcon",onMouseDown:R=>{R.preventDefault()},onMouseUp:R=>{R.preventDefault()}};return S.cloneElement(S.isValidElement(D)?D:S.createElement("span",null,D),_)},{className:m,prefixCls:g,inputPrefixCls:v,size:x}=n,b=$3(n,["className","prefixCls","inputPrefixCls","size"]),{getPrefixCls:w}=S.useContext(Nn),y=w("input",v),C=w("input-password",g),$=r&&p(C),I=ye(C,m,{[`${C}-${x}`]:!!x}),E=Object.assign(Object.assign({},Da(b,["suffix","iconRender","visibilityToggle"])),{type:c?"text":"password",className:I,prefixCls:y,suffix:$});return x&&(E.size=x),S.createElement(ff,Object.assign({ref:tu(e,d)},E))});var D3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const T3=S.forwardRef((n,e)=>{const{prefixCls:t,inputPrefixCls:i,className:r,size:o,suffix:s,enterButton:a=!1,addonAfter:l,loading:c,disabled:u,onSearch:d,onChange:f,onCompositionStart:h,onCompositionEnd:p}=n,m=D3(n,["prefixCls","inputPrefixCls","className","size","suffix","enterButton","addonAfter","loading","disabled","onSearch","onChange","onCompositionStart","onCompositionEnd"]),{getPrefixCls:g,direction:v}=S.useContext(Nn),x=S.useRef(!1),b=g("input-search",t),w=g("input",i),{compactSize:y}=hv(b,v),C=Ns(z=>{var L;return(L=o??y)!==null&&L!==void 0?L:z}),$=S.useRef(null),I=z=>{z!=null&&z.target&&z.type==="click"&&d&&d(z.target.value,z,{source:"clear"}),f==null||f(z)},E=z=>{var L;document.activeElement===((L=$.current)===null||L===void 0?void 0:L.input)&&z.preventDefault()},N=z=>{var L,W;d&&d((W=(L=$.current)===null||L===void 0?void 0:L.input)===null||W===void 0?void 0:W.value,z,{source:"input"})},k=z=>{x.current||c||N(z)},D=typeof a=="boolean"?S.createElement(Vv,null):null,_=`${b}-button`;let R;const T=a||{},A=T.type&&T.type.__ANT_BUTTON===!0;A||T.type==="button"?R=Fc(T,Object.assign({onMouseDown:E,onClick:z=>{var L,W;(W=(L=T==null?void 0:T.props)===null||L===void 0?void 0:L.onClick)===null||W===void 0||W.call(L,z),N(z)},key:"enterButton"},A?{className:_,size:C}:{})):R=S.createElement(vl,{className:_,type:a?"primary":void 0,size:C,disabled:u,key:"enterButton",onMouseDown:E,onClick:N,loading:c,icon:D},a),l&&(R=[R,Fc(l,{key:"addonAfter"})]);const O=ye(b,{[`${b}-rtl`]:v==="rtl",[`${b}-${C}`]:!!C,[`${b}-with-button`]:!!a},r),P=z=>{x.current=!0,h==null||h(z)},M=z=>{x.current=!1,p==null||p(z)};return S.createElement(ff,Object.assign({ref:tu($,e),onPressEnter:k},m,{size:C,onCompositionStart:P,onCompositionEnd:M,prefixCls:w,addonAfter:R,suffix:s,onChange:I,className:O,disabled:u}))});var R3=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,_3=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],cm={},ir;function A3(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=n.getAttribute("id")||n.getAttribute("data-reactid")||n.getAttribute("name");if(e&&cm[t])return cm[t];var i=window.getComputedStyle(n),r=i.getPropertyValue("box-sizing")||i.getPropertyValue("-moz-box-sizing")||i.getPropertyValue("-webkit-box-sizing"),o=parseFloat(i.getPropertyValue("padding-bottom"))+parseFloat(i.getPropertyValue("padding-top")),s=parseFloat(i.getPropertyValue("border-bottom-width"))+parseFloat(i.getPropertyValue("border-top-width")),a=_3.map(function(c){return"".concat(c,":").concat(i.getPropertyValue(c))}).join(";"),l={sizingStyle:a,paddingSize:o,borderSize:s,boxSizing:r};return e&&t&&(cm[t]=l),l}function O3(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;ir||(ir=document.createElement("textarea"),ir.setAttribute("tab-index","-1"),ir.setAttribute("aria-hidden","true"),ir.setAttribute("name","hiddenTextarea"),document.body.appendChild(ir)),n.getAttribute("wrap")?ir.setAttribute("wrap",n.getAttribute("wrap")):ir.removeAttribute("wrap");var r=A3(n,e),o=r.paddingSize,s=r.borderSize,a=r.boxSizing,l=r.sizingStyle;ir.setAttribute("style","".concat(l,";").concat(R3)),ir.value=n.value||n.placeholder||"";var c=void 0,u=void 0,d,f=ir.scrollHeight;if(a==="border-box"?f+=s:a==="content-box"&&(f-=o),t!==null||i!==null){ir.value=" ";var h=ir.scrollHeight-o;t!==null&&(c=h*t,a==="border-box"&&(c=c+o+s),f=Math.max(c,f)),i!==null&&(u=h*i,a==="border-box"&&(u=u+o+s),d=f>u?"":"hidden",f=Math.min(u,f))}var p={height:f,overflowY:d,resize:"none"};return c&&(p.minHeight=c),u&&(p.maxHeight=u),p}var P3=["prefixCls","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],um=0,dm=1,hm=2,M3=S.forwardRef(function(n,e){var t=n,i=t.prefixCls,r=t.defaultValue,o=t.value,s=t.autoSize,a=t.onResize,l=t.className,c=t.style,u=t.disabled,d=t.onChange;t.onInternalAutoSize;var f=En(t,P3),h=Vo(r,{value:o,postState:function(V){return V??""}}),p=ke(h,2),m=p[0],g=p[1],v=function(V){g(V.target.value),d==null||d(V)},x=S.useRef();S.useImperativeHandle(e,function(){return{textArea:x.current}});var b=S.useMemo(function(){return s&&vn(s)==="object"?[s.minRows,s.maxRows]:[]},[s]),w=ke(b,2),y=w[0],C=w[1],$=!!s,I=function(){try{if(document.activeElement===x.current){var V=x.current,H=V.selectionStart,Y=V.selectionEnd,Q=V.scrollTop;x.current.setSelectionRange(H,Y),x.current.scrollTop=Q}}catch{}},E=S.useState(hm),N=ke(E,2),k=N[0],D=N[1],_=S.useState(),R=ke(_,2),T=R[0],A=R[1],O=function(){D(um)};Yi(function(){$&&O()},[o,y,C,$]),Yi(function(){if(k===um)D(dm);else if(k===dm){var U=O3(x.current,!1,y,C);D(hm),A(U)}else I()},[k]);var P=S.useRef(),M=function(){Mi.cancel(P.current)},z=function(V){k===hm&&(a==null||a(V),s&&(M(),P.current=Mi(function(){O()})))};S.useEffect(function(){return M},[]);var L=$?T:null,W=me(me({},c),L);return(k===um||k===dm)&&(W.overflowY="hidden",W.overflowX="hidden"),S.createElement(Vl,{onResize:z,disabled:!(s||a)},S.createElement("textarea",ze({},f,{ref:x,style:W,className:ye(i,l,J({},"".concat(i,"-disabled"),u)),disabled:u,value:m,onChange:v})))}),F3=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","showCount","count","className","style","disabled","hidden","classNames","styles","onResize","onClear","onPressEnter","readOnly","autoSize","onKeyDown"],L3=le.forwardRef(function(n,e){var t,i=n.defaultValue,r=n.value,o=n.onFocus,s=n.onBlur,a=n.onChange,l=n.allowClear,c=n.maxLength,u=n.onCompositionStart,d=n.onCompositionEnd,f=n.suffix,h=n.prefixCls,p=h===void 0?"rc-textarea":h,m=n.showCount,g=n.count,v=n.className,x=n.style,b=n.disabled,w=n.hidden,y=n.classNames,C=n.styles,$=n.onResize,I=n.onClear,E=n.onPressEnter,N=n.readOnly,k=n.autoSize,D=n.onKeyDown,_=En(n,F3),R=Vo(i,{value:r,defaultValue:i}),T=ke(R,2),A=T[0],O=T[1],P=A==null?"":String(A),M=le.useState(!1),z=ke(M,2),L=z[0],W=z[1],U=le.useRef(!1),V=le.useState(null),H=ke(V,2),Y=H[0],Q=H[1],Z=S.useRef(null),pe=S.useRef(null),oe=function(){var Fe;return(Fe=pe.current)===null||Fe===void 0?void 0:Fe.textArea},X=function(){oe().focus()};S.useImperativeHandle(e,function(){var Me;return{resizableTextArea:pe.current,focus:X,blur:function(){oe().blur()},nativeElement:((Me=Z.current)===null||Me===void 0?void 0:Me.nativeElement)||oe()}}),S.useEffect(function(){W(function(Me){return!b&&Me})},[b]);var j=le.useState(null),ne=ke(j,2),se=ne[0],ce=ne[1];le.useEffect(function(){if(se){var Me;(Me=oe()).setSelectionRange.apply(Me,nt(se))}},[se]);var re=o$(g,m),be=(t=re.max)!==null&&t!==void 0?t:c,Ie=Number(be)>0,Ee=re.strategy(P),Se=!!be&&Ee>be,fe=function(Fe,Ke){var Lt=Ke;!U.current&&re.exceedFormatter&&re.max&&re.strategy(Ke)>re.max&&(Lt=re.exceedFormatter(Ke,{max:re.max}),Ke!==Lt&&ce([oe().selectionStart||0,oe().selectionEnd||0])),O(Lt),vh(Fe.currentTarget,Fe,a,Lt)},ge=function(Fe){U.current=!0,u==null||u(Fe)},we=function(Fe){U.current=!1,fe(Fe,Fe.currentTarget.value),d==null||d(Fe)},ve=function(Fe){fe(Fe,Fe.target.value)},Ne=function(Fe){Fe.key==="Enter"&&E&&E(Fe),D==null||D(Fe)},Ae=function(Fe){W(!0),o==null||o(Fe)},Ve=function(Fe){W(!1),s==null||s(Fe)},Ue=function(Fe){O(""),X(),vh(oe(),Fe,a)},We=f,Le;re.show&&(re.showFormatter?Le=re.showFormatter({value:P,count:Ee,maxLength:be}):Le="".concat(Ee).concat(Ie?" / ".concat(be):""),We=le.createElement(le.Fragment,null,We,le.createElement("span",{className:ye("".concat(p,"-data-count"),y==null?void 0:y.count),style:C==null?void 0:C.count},Le)));var lt=function(Fe){var Ke;$==null||$(Fe),(Ke=oe())!==null&&Ke!==void 0&&Ke.style.height&&Q(!0)},ot=!k&&!m&&!l;return le.createElement(r$,{ref:Z,value:P,allowClear:l,handleReset:Ue,suffix:We,prefixCls:p,classNames:me(me({},y),{},{affixWrapper:ye(y==null?void 0:y.affixWrapper,J(J({},"".concat(p,"-show-count"),m),"".concat(p,"-textarea-allow-clear"),l))}),disabled:b,focused:L,className:ye(v,Se&&"".concat(p,"-out-of-range")),style:me(me({},x),Y&&!ot?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":typeof Le=="string"?Le:void 0}},hidden:w,readOnly:N,onClear:I},le.createElement(M3,ze({},_,{autoSize:k,maxLength:c,onKeyDown:Ne,onChange:ve,onFocus:Ae,onBlur:Ve,onCompositionStart:ge,onCompositionEnd:we,className:ye(y==null?void 0:y.textarea),style:me(me({},C==null?void 0:C.textarea),{},{resize:x==null?void 0:x.resize}),disabled:b,prefixCls:p,onResize:lt,ref:pe,readOnly:N})))}),z3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const B3=S.forwardRef((n,e)=>{var t,i;const{prefixCls:r,bordered:o=!0,size:s,disabled:a,status:l,allowClear:c,classNames:u,rootClassName:d,className:f,style:h,styles:p,variant:m}=n,g=z3(n,["prefixCls","bordered","size","disabled","status","allowClear","classNames","rootClassName","className","style","styles","variant"]),{getPrefixCls:v,direction:x,textArea:b}=S.useContext(Nn),w=Ns(s),y=S.useContext(nu),C=a??y,{status:$,hasFeedback:I,feedbackIcon:E}=S.useContext(xs),N=df($,l),k=S.useRef(null);S.useImperativeHandle(e,()=>{var z;return{resizableTextArea:(z=k.current)===null||z===void 0?void 0:z.resizableTextArea,focus:L=>{var W,U;i$((U=(W=k.current)===null||W===void 0?void 0:W.resizableTextArea)===null||U===void 0?void 0:U.textArea,L)},blur:()=>{var L;return(L=k.current)===null||L===void 0?void 0:L.blur()}}});const D=v("input",r),_=Ta(D),[R,T,A]=Kv(D,_),[O,P]=Bv("textArea",m,o),M=s$(c??(b==null?void 0:b.allowClear));return R(S.createElement(L3,Object.assign({autoComplete:b==null?void 0:b.autoComplete},g,{style:Object.assign(Object.assign({},b==null?void 0:b.style),h),styles:Object.assign(Object.assign({},b==null?void 0:b.styles),p),disabled:C,allowClear:M,className:ye(A,_,f,d,b==null?void 0:b.className),classNames:Object.assign(Object.assign(Object.assign({},u),b==null?void 0:b.classNames),{textarea:ye({[`${D}-sm`]:w==="small",[`${D}-lg`]:w==="large"},T,u==null?void 0:u.textarea,(t=b==null?void 0:b.classNames)===null||t===void 0?void 0:t.textarea),variant:ye({[`${D}-${O}`]:P},gh(D,N)),affixWrapper:ye(`${D}-textarea-affix-wrapper`,{[`${D}-affix-wrapper-rtl`]:x==="rtl",[`${D}-affix-wrapper-sm`]:w==="small",[`${D}-affix-wrapper-lg`]:w==="large",[`${D}-textarea-show-count`]:n.showCount||((i=n.count)===null||i===void 0?void 0:i.show)},T)}),prefixCls:D,suffix:I&&S.createElement("span",{className:`${D}-textarea-suffix`},E),ref:k})))}),Ul=ff;Ul.Group=u3;Ul.Search=T3;Ul.TextArea=B3;Ul.Password=k3;Ul.OTP=x3;function hw(n){var e=n.getBoundingClientRect(),t=document.documentElement;return{left:e.left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||document.body.clientLeft||0),top:e.top+(window.pageYOffset||t.scrollTop)-(t.clientTop||document.body.clientTop||0)}}function _d(n,e,t,i){var r=jm.unstable_batchedUpdates?function(s){jm.unstable_batchedUpdates(t,s)}:t;return n!=null&&n.addEventListener&&n.addEventListener(e,r,i),{remove:function(){n!=null&&n.removeEventListener&&n.removeEventListener(e,r,i)}}}const qv=function(){const n=Object.assign({},arguments.length<=0?void 0:arguments[0]);for(let e=1;e<arguments.length;e++){const t=e<0||arguments.length<=e?void 0:arguments[e];t&&Object.keys(t).forEach(i=>{const r=t[i];r!==void 0&&(n[i]=r)})}return n};var V3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M272.9 512l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L186.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H532c6.7 0 10.4-7.7 6.3-12.9L272.9 512zm304 0l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L490.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H836c6.7 0 10.4-7.7 6.3-12.9L576.9 512z"}}]},name:"double-left",theme:"outlined"},W3=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:V3}))},fw=S.forwardRef(W3),G3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M533.2 492.3L277.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H188c-6.7 0-10.4 7.7-6.3 12.9L447.1 512 181.7 851.1A7.98 7.98 0 00188 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5zm304 0L581.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H492c-6.7 0-10.4 7.7-6.3 12.9L751.1 512 485.7 851.1A7.98 7.98 0 00492 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5z"}}]},name:"double-right",theme:"outlined"},H3=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:G3}))},pw=S.forwardRef(H3),U3={items_per_page:"/",jump_to:"",jump_to_confirm:"",page:"",prev_page:"",next_page:"",prev_5:" 5 ",next_5:" 5 ",prev_3:" 3 ",next_3:" 3 ",page_size:""},j3=["10","20","50","100"],K3=function(e){var t=e.pageSizeOptions,i=t===void 0?j3:t,r=e.locale,o=e.changeSize,s=e.pageSize,a=e.goButton,l=e.quickGo,c=e.rootPrefixCls,u=e.selectComponentClass,d=e.selectPrefixCls,f=e.disabled,h=e.buildOptionText,p=e.showSizeChanger,m=le.useState(""),g=ke(m,2),v=g[0],x=g[1],b=function(){return!v||Number.isNaN(v)?void 0:Number(v)},w=typeof h=="function"?h:function(P){return"".concat(P," ").concat(r.items_per_page)},y=function(M,z){if(o==null||o(Number(M)),vn(p)==="object"){var L;(L=p.onChange)===null||L===void 0||L.call(p,M,z)}},C=function(M){x(M.target.value)},$=function(M){a||v===""||(x(""),!(M.relatedTarget&&(M.relatedTarget.className.indexOf("".concat(c,"-item-link"))>=0||M.relatedTarget.className.indexOf("".concat(c,"-item"))>=0))&&(l==null||l(b())))},I=function(M){v!==""&&(M.keyCode===Xe.ENTER||M.type==="click")&&(x(""),l==null||l(b()))},E=function(){return i.some(function(M){return M.toString()===s.toString()})?i:i.concat([s.toString()]).sort(function(M,z){var L=Number.isNaN(Number(M))?0:Number(M),W=Number.isNaN(Number(z))?0:Number(z);return L-W})},N="".concat(c,"-options");if(!p&&!l)return null;var k=null,D=null,_=null;if(p&&u){var R=vn(p)==="object"?p:{},T=R.options,A=R.className,O=T?void 0:E().map(function(P,M){return le.createElement(u.Option,{key:M,value:P.toString()},w(P))});k=le.createElement(u,ze({disabled:f,prefixCls:d,showSearch:!1,optionLabelProp:T?"label":"children",popupMatchSelectWidth:!1,value:(s||i[0]).toString(),getPopupContainer:function(M){return M.parentNode},"aria-label":r.page_size,defaultOpen:!1},vn(p)==="object"?p:null,{className:ye("".concat(N,"-size-changer"),A),options:T,onChange:y}),O)}return l&&(a&&(_=typeof a=="boolean"?le.createElement("button",{type:"button",onClick:I,onKeyUp:I,disabled:f,className:"".concat(N,"-quick-jumper-button")},r.jump_to_confirm):le.createElement("span",{onClick:I,onKeyUp:I},a)),D=le.createElement("div",{className:"".concat(N,"-quick-jumper")},r.jump_to,le.createElement("input",{disabled:f,type:"text",value:v,onChange:C,onKeyUp:I,onBlur:$,"aria-label":r.page}),r.page,_)),le.createElement("li",{className:N},k,D)},pc=function(e){var t=e.rootPrefixCls,i=e.page,r=e.active,o=e.className,s=e.showTitle,a=e.onClick,l=e.onKeyPress,c=e.itemRender,u="".concat(t,"-item"),d=ye(u,"".concat(u,"-").concat(i),J(J({},"".concat(u,"-active"),r),"".concat(u,"-disabled"),!i),o),f=function(){a(i)},h=function(g){l(g,a,i)},p=c(i,"page",le.createElement("a",{rel:"nofollow"},i));return p?le.createElement("li",{title:s?String(i):null,className:d,onClick:f,onKeyDown:h,tabIndex:0},p):null},X3=function(e,t,i){return i};function mw(){}function gw(n){var e=Number(n);return typeof e=="number"&&!Number.isNaN(e)&&isFinite(e)&&Math.floor(e)===e}function Gs(n,e,t){var i=typeof n>"u"?e:n;return Math.floor((t-1)/i)+1}var q3=function(e){var t=e.prefixCls,i=t===void 0?"rc-pagination":t,r=e.selectPrefixCls,o=r===void 0?"rc-select":r,s=e.className,a=e.selectComponentClass,l=e.current,c=e.defaultCurrent,u=c===void 0?1:c,d=e.total,f=d===void 0?0:d,h=e.pageSize,p=e.defaultPageSize,m=p===void 0?10:p,g=e.onChange,v=g===void 0?mw:g,x=e.hideOnSinglePage,b=e.align,w=e.showPrevNextJumpers,y=w===void 0?!0:w,C=e.showQuickJumper,$=e.showLessItems,I=e.showTitle,E=I===void 0?!0:I,N=e.onShowSizeChange,k=N===void 0?mw:N,D=e.locale,_=D===void 0?U3:D,R=e.style,T=e.totalBoundaryShowSizeChanger,A=T===void 0?50:T,O=e.disabled,P=e.simple,M=e.showTotal,z=e.showSizeChanger,L=z===void 0?f>A:z,W=e.pageSizeOptions,U=e.itemRender,V=U===void 0?X3:U,H=e.jumpPrevIcon,Y=e.jumpNextIcon,Q=e.prevIcon,Z=e.nextIcon,pe=le.useRef(null),oe=Vo(10,{value:h,defaultValue:m}),X=ke(oe,2),j=X[0],ne=X[1],se=Vo(1,{value:l,defaultValue:u,postState:function(It){return Math.max(1,Math.min(It,Gs(void 0,j,f)))}}),ce=ke(se,2),re=ce[0],be=ce[1],Ie=le.useState(re),Ee=ke(Ie,2),Se=Ee[0],fe=Ee[1];S.useEffect(function(){fe(re)},[re]);var ge=Math.max(1,re-($?3:5)),we=Math.min(Gs(void 0,j,f),re+($?3:5));function ve(tt,It){var Qt=tt||le.createElement("button",{type:"button","aria-label":It,className:"".concat(i,"-item-link")});return typeof tt=="function"&&(Qt=le.createElement(tt,me({},e))),Qt}function Ne(tt){var It=tt.target.value,Qt=Gs(void 0,j,f),nr;return It===""?nr=It:Number.isNaN(Number(It))?nr=Se:It>=Qt?nr=Qt:nr=Number(It),nr}function Ae(tt){return gw(tt)&&tt!==re&&gw(f)&&f>0}var Ve=f>j?C:!1;function Ue(tt){(tt.keyCode===Xe.UP||tt.keyCode===Xe.DOWN)&&tt.preventDefault()}function We(tt){var It=Ne(tt);switch(It!==Se&&fe(It),tt.keyCode){case Xe.ENTER:ot(It);break;case Xe.UP:ot(It-1);break;case Xe.DOWN:ot(It+1);break}}function Le(tt){ot(Ne(tt))}function lt(tt){var It=Gs(tt,j,f),Qt=re>It&&It!==0?It:re;ne(tt),fe(Qt),k==null||k(re,tt),be(Qt),v==null||v(Qt,tt)}function ot(tt){if(Ae(tt)&&!O){var It=Gs(void 0,j,f),Qt=tt;return tt>It?Qt=It:tt<1&&(Qt=1),Qt!==Se&&fe(Qt),be(Qt),v==null||v(Qt,j),Qt}return re}var Me=re>1,Fe=re<Gs(void 0,j,f);function Ke(){Me&&ot(re-1)}function Lt(){Fe&&ot(re+1)}function Nt(){ot(ge)}function Dt(){ot(we)}function kt(tt,It){if(tt.key==="Enter"||tt.charCode===Xe.ENTER||tt.keyCode===Xe.ENTER){for(var Qt=arguments.length,nr=new Array(Qt>2?Qt-2:0),To=2;To<Qt;To++)nr[To-2]=arguments[To];It.apply(void 0,nr)}}function _n(tt){kt(tt,Ke)}function oi(tt){kt(tt,Lt)}function zt(tt){kt(tt,Nt)}function yi(tt){kt(tt,Dt)}function on(tt){var It=V(tt,"prev",ve(Q,"prev page"));return le.isValidElement(It)?le.cloneElement(It,{disabled:!Me}):It}function bn(tt){var It=V(tt,"next",ve(Z,"next page"));return le.isValidElement(It)?le.cloneElement(It,{disabled:!Fe}):It}function Zt(tt){(tt.type==="click"||tt.keyCode===Xe.ENTER)&&ot(Se)}var Un=null,Yt=Co(e,{aria:!0,data:!0}),xt=M&&le.createElement("li",{className:"".concat(i,"-total-text")},M(f,[f===0?0:(re-1)*j+1,re*j>f?f:re*j])),pn=null,_t=Gs(void 0,j,f);if(x&&f<=j)return null;var Te=[],Ge={rootPrefixCls:i,onClick:ot,onKeyPress:kt,showTitle:E,itemRender:V,page:-1},Ze=re-1>0?re-1:0,it=re+1<_t?re+1:_t,ft=C&&C.goButton,Ot=vn(P)==="object"?P.readOnly:!P,qe=ft,et=null;P&&(ft&&(typeof ft=="boolean"?qe=le.createElement("button",{type:"button",onClick:Zt,onKeyUp:Zt},_.jump_to_confirm):qe=le.createElement("span",{onClick:Zt,onKeyUp:Zt},ft),qe=le.createElement("li",{title:E?"".concat(_.jump_to).concat(re,"/").concat(_t):null,className:"".concat(i,"-simple-pager")},qe)),et=le.createElement("li",{title:E?"".concat(re,"/").concat(_t):null,className:"".concat(i,"-simple-pager")},Ot?Se:le.createElement("input",{type:"text",value:Se,disabled:O,onKeyDown:Ue,onKeyUp:We,onChange:We,onBlur:Le,size:3}),le.createElement("span",{className:"".concat(i,"-slash")},"/"),_t));var pt=$?1:2;if(_t<=3+pt*2){_t||Te.push(le.createElement(pc,ze({},Ge,{key:"noPager",page:1,className:"".concat(i,"-item-disabled")})));for(var dt=1;dt<=_t;dt+=1)Te.push(le.createElement(pc,ze({},Ge,{key:dt,page:dt,active:re===dt})))}else{var Xt=$?_.prev_3:_.prev_5,un=$?_.next_3:_.next_5,An=V(ge,"jump-prev",ve(H,"prev page")),dn=V(we,"jump-next",ve(Y,"next page"));y&&(Un=An?le.createElement("li",{title:E?Xt:null,key:"prev",onClick:Nt,tabIndex:0,onKeyDown:zt,className:ye("".concat(i,"-jump-prev"),J({},"".concat(i,"-jump-prev-custom-icon"),!!H))},An):null,pn=dn?le.createElement("li",{title:E?un:null,key:"next",onClick:Dt,tabIndex:0,onKeyDown:yi,className:ye("".concat(i,"-jump-next"),J({},"".concat(i,"-jump-next-custom-icon"),!!Y))},dn):null);var Ye=Math.max(1,re-pt),Be=Math.min(re+pt,_t);re-1<=pt&&(Be=1+pt*2),_t-re<=pt&&(Ye=_t-pt*2);for(var ht=Ye;ht<=Be;ht+=1)Te.push(le.createElement(pc,ze({},Ge,{key:ht,page:ht,active:re===ht})));if(re-1>=pt*2&&re!==3&&(Te[0]=le.cloneElement(Te[0],{className:ye("".concat(i,"-item-after-jump-prev"),Te[0].props.className)}),Te.unshift(Un)),_t-re>=pt*2&&re!==_t-2){var Ut=Te[Te.length-1];Te[Te.length-1]=le.cloneElement(Ut,{className:ye("".concat(i,"-item-before-jump-next"),Ut.props.className)}),Te.push(pn)}Ye!==1&&Te.unshift(le.createElement(pc,ze({},Ge,{key:1,page:1}))),Be!==_t&&Te.push(le.createElement(pc,ze({},Ge,{key:_t,page:_t})))}var Bt=on(Ze);if(Bt){var Jr=!Me||!_t;Bt=le.createElement("li",{title:E?_.prev_page:null,onClick:Ke,tabIndex:Jr?null:0,onKeyDown:_n,className:ye("".concat(i,"-prev"),J({},"".concat(i,"-disabled"),Jr)),"aria-disabled":Jr},Bt)}var Ti=bn(it);if(Ti){var Pr,Zr;P?(Pr=!Fe,Zr=Me?0:null):(Pr=!Fe||!_t,Zr=Pr?null:0),Ti=le.createElement("li",{title:E?_.next_page:null,onClick:Lt,tabIndex:Zr,onKeyDown:oi,className:ye("".concat(i,"-next"),J({},"".concat(i,"-disabled"),Pr)),"aria-disabled":Pr},Ti)}var ns=ye(i,s,J(J(J(J(J({},"".concat(i,"-start"),b==="start"),"".concat(i,"-center"),b==="center"),"".concat(i,"-end"),b==="end"),"".concat(i,"-simple"),P),"".concat(i,"-disabled"),O));return le.createElement("ul",ze({className:ns,style:R,ref:pe},Yt),xt,Bt,P?et:Te,Ti,le.createElement(K3,{locale:_,rootPrefixCls:i,disabled:O,selectComponentClass:a,selectPrefixCls:o,changeSize:lt,pageSize:j,pageSizeOptions:W,quickGo:Ve?ot:null,goButton:qe,showSizeChanger:L}))};const l$=n=>S.createElement(Yo,Object.assign({},n,{showSearch:!0,size:"small"})),c$=n=>S.createElement(Yo,Object.assign({},n,{showSearch:!0,size:"middle"}));l$.Option=Yo.Option;c$.Option=Yo.Option;const Y3=n=>{const{componentCls:e}=n;return{[`${e}-disabled`]:{"&, &:hover":{cursor:"not-allowed",[`${e}-item-link`]:{color:n.colorTextDisabled,cursor:"not-allowed"}},"&:focus-visible":{cursor:"not-allowed",[`${e}-item-link`]:{color:n.colorTextDisabled,cursor:"not-allowed"}}},[`&${e}-disabled`]:{cursor:"not-allowed",[`${e}-item`]:{cursor:"not-allowed","&:hover, &:active":{backgroundColor:"transparent"},a:{color:n.colorTextDisabled,backgroundColor:"transparent",border:"none",cursor:"not-allowed"},"&-active":{borderColor:n.colorBorder,backgroundColor:n.itemActiveBgDisabled,"&:hover, &:active":{backgroundColor:n.itemActiveBgDisabled},a:{color:n.itemActiveColorDisabled}}},[`${e}-item-link`]:{color:n.colorTextDisabled,cursor:"not-allowed","&:hover, &:active":{backgroundColor:"transparent"},[`${e}-simple&`]:{backgroundColor:"transparent","&:hover, &:active":{backgroundColor:"transparent"}}},[`${e}-simple-pager`]:{color:n.colorTextDisabled},[`${e}-jump-prev, ${e}-jump-next`]:{[`${e}-item-link-icon`]:{opacity:0},[`${e}-item-ellipsis`]:{opacity:1}}},[`&${e}-simple`]:{[`${e}-prev, ${e}-next`]:{[`&${e}-disabled ${e}-item-link`]:{"&:hover, &:active":{backgroundColor:"transparent"}}}}}},J3=n=>{const{componentCls:e}=n;return{[`&${e}-mini ${e}-total-text, &${e}-mini ${e}-simple-pager`]:{height:n.itemSizeSM,lineHeight:ue(n.itemSizeSM)},[`&${e}-mini ${e}-item`]:{minWidth:n.itemSizeSM,height:n.itemSizeSM,margin:0,lineHeight:ue(n.calc(n.itemSizeSM).sub(2).equal())},[`&${e}-mini:not(${e}-disabled) ${e}-item:not(${e}-item-active)`]:{backgroundColor:"transparent",borderColor:"transparent","&:hover":{backgroundColor:n.colorBgTextHover},"&:active":{backgroundColor:n.colorBgTextActive}},[`&${e}-mini ${e}-prev, &${e}-mini ${e}-next`]:{minWidth:n.itemSizeSM,height:n.itemSizeSM,margin:0,lineHeight:ue(n.itemSizeSM)},[`&${e}-mini:not(${e}-disabled)`]:{[`${e}-prev, ${e}-next`]:{[`&:hover ${e}-item-link`]:{backgroundColor:n.colorBgTextHover},[`&:active ${e}-item-link`]:{backgroundColor:n.colorBgTextActive},[`&${e}-disabled:hover ${e}-item-link`]:{backgroundColor:"transparent"}}},[`
    &${e}-mini ${e}-prev ${e}-item-link,
    &${e}-mini ${e}-next ${e}-item-link
    `]:{backgroundColor:"transparent",borderColor:"transparent","&::after":{height:n.itemSizeSM,lineHeight:ue(n.itemSizeSM)}},[`&${e}-mini ${e}-jump-prev, &${e}-mini ${e}-jump-next`]:{height:n.itemSizeSM,marginInlineEnd:0,lineHeight:ue(n.itemSizeSM)},[`&${e}-mini ${e}-options`]:{marginInlineStart:n.paginationMiniOptionsMarginInlineStart,"&-size-changer":{top:n.miniOptionsSizeChangerTop},"&-quick-jumper":{height:n.itemSizeSM,lineHeight:ue(n.itemSizeSM),input:Object.assign(Object.assign({},Uv(n)),{width:n.paginationMiniQuickJumperInputWidth,height:n.controlHeightSM})}}}},Z3=n=>{const{componentCls:e}=n;return{[`
    &${e}-simple ${e}-prev,
    &${e}-simple ${e}-next
    `]:{height:n.itemSizeSM,lineHeight:ue(n.itemSizeSM),verticalAlign:"top",[`${e}-item-link`]:{height:n.itemSizeSM,backgroundColor:"transparent",border:0,"&:hover":{backgroundColor:n.colorBgTextHover},"&:active":{backgroundColor:n.colorBgTextActive},"&::after":{height:n.itemSizeSM,lineHeight:ue(n.itemSizeSM)}}},[`&${e}-simple ${e}-simple-pager`]:{display:"inline-block",height:n.itemSizeSM,marginInlineEnd:n.marginXS,input:{boxSizing:"border-box",height:"100%",padding:`0 ${ue(n.paginationItemPaddingInline)}`,textAlign:"center",backgroundColor:n.itemInputBg,border:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderRadius:n.borderRadius,outline:"none",transition:`border-color ${n.motionDurationMid}`,color:"inherit","&:hover":{borderColor:n.colorPrimary},"&:focus":{borderColor:n.colorPrimaryHover,boxShadow:`${ue(n.inputOutlineOffset)} 0 ${ue(n.controlOutlineWidth)} ${n.controlOutline}`},"&[disabled]":{color:n.colorTextDisabled,backgroundColor:n.colorBgContainerDisabled,borderColor:n.colorBorder,cursor:"not-allowed"}}}}},Q3=n=>{const{componentCls:e}=n;return{[`${e}-jump-prev, ${e}-jump-next`]:{outline:0,[`${e}-item-container`]:{position:"relative",[`${e}-item-link-icon`]:{color:n.colorPrimary,fontSize:n.fontSizeSM,opacity:0,transition:`all ${n.motionDurationMid}`,"&-svg":{top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,margin:"auto"}},[`${e}-item-ellipsis`]:{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,display:"block",margin:"auto",color:n.colorTextDisabled,letterSpacing:n.paginationEllipsisLetterSpacing,textAlign:"center",textIndent:n.paginationEllipsisTextIndent,opacity:1,transition:`all ${n.motionDurationMid}`}},"&:hover":{[`${e}-item-link-icon`]:{opacity:1},[`${e}-item-ellipsis`]:{opacity:0}}},[`
    ${e}-prev,
    ${e}-jump-prev,
    ${e}-jump-next
    `]:{marginInlineEnd:n.marginXS},[`
    ${e}-prev,
    ${e}-next,
    ${e}-jump-prev,
    ${e}-jump-next
    `]:{display:"inline-block",minWidth:n.itemSize,height:n.itemSize,color:n.colorText,fontFamily:n.fontFamily,lineHeight:ue(n.itemSize),textAlign:"center",verticalAlign:"middle",listStyle:"none",borderRadius:n.borderRadius,cursor:"pointer",transition:`all ${n.motionDurationMid}`},[`${e}-prev, ${e}-next`]:{outline:0,button:{color:n.colorText,cursor:"pointer",userSelect:"none"},[`${e}-item-link`]:{display:"block",width:"100%",height:"100%",padding:0,fontSize:n.fontSizeSM,textAlign:"center",backgroundColor:"transparent",border:`${ue(n.lineWidth)} ${n.lineType} transparent`,borderRadius:n.borderRadius,outline:"none",transition:`all ${n.motionDurationMid}`},[`&:hover ${e}-item-link`]:{backgroundColor:n.colorBgTextHover},[`&:active ${e}-item-link`]:{backgroundColor:n.colorBgTextActive},[`&${e}-disabled:hover`]:{[`${e}-item-link`]:{backgroundColor:"transparent"}}},[`${e}-slash`]:{marginInlineEnd:n.paginationSlashMarginInlineEnd,marginInlineStart:n.paginationSlashMarginInlineStart},[`${e}-options`]:{display:"inline-block",marginInlineStart:n.margin,verticalAlign:"middle","&-size-changer":{display:"inline-block",width:"auto"},"&-quick-jumper":{display:"inline-block",height:n.controlHeight,marginInlineStart:n.marginXS,lineHeight:ue(n.controlHeight),verticalAlign:"top",input:Object.assign(Object.assign(Object.assign({},jv(n)),Hv(n,{borderColor:n.colorBorder,hoverBorderColor:n.colorPrimaryHover,activeBorderColor:n.colorPrimary,activeShadow:n.activeShadow})),{"&[disabled]":Object.assign({},hf(n)),width:n.calc(n.controlHeightLG).mul(1.25).equal(),height:n.controlHeight,boxSizing:"border-box",margin:0,marginInlineStart:n.marginXS,marginInlineEnd:n.marginXS})}}}},eB=n=>{const{componentCls:e}=n;return{[`${e}-item`]:{display:"inline-block",minWidth:n.itemSize,height:n.itemSize,marginInlineEnd:n.marginXS,fontFamily:n.fontFamily,lineHeight:ue(n.calc(n.itemSize).sub(2).equal()),textAlign:"center",verticalAlign:"middle",listStyle:"none",backgroundColor:n.itemBg,border:`${ue(n.lineWidth)} ${n.lineType} transparent`,borderRadius:n.borderRadius,outline:0,cursor:"pointer",userSelect:"none",a:{display:"block",padding:`0 ${ue(n.paginationItemPaddingInline)}`,color:n.colorText,"&:hover":{textDecoration:"none"}},[`&:not(${e}-item-active)`]:{"&:hover":{transition:`all ${n.motionDurationMid}`,backgroundColor:n.colorBgTextHover},"&:active":{backgroundColor:n.colorBgTextActive}},"&-active":{fontWeight:n.fontWeightStrong,backgroundColor:n.itemActiveBg,borderColor:n.colorPrimary,a:{color:n.colorPrimary},"&:hover":{borderColor:n.colorPrimaryHover},"&:hover a":{color:n.colorPrimaryHover}}}}},tB=n=>{const{componentCls:e}=n;return{[e]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},sr(n)),{display:"flex","&-start":{justifyContent:"start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"end"},"ul, ol":{margin:0,padding:0,listStyle:"none"},"&::after":{display:"block",clear:"both",height:0,overflow:"hidden",visibility:"hidden",content:'""'},[`${e}-total-text`]:{display:"inline-block",height:n.itemSize,marginInlineEnd:n.marginXS,lineHeight:ue(n.calc(n.itemSize).sub(2).equal()),verticalAlign:"middle"}}),eB(n)),Q3(n)),Z3(n)),J3(n)),Y3(n)),{[`@media only screen and (max-width: ${n.screenLG}px)`]:{[`${e}-item`]:{"&-after-jump-prev, &-before-jump-next":{display:"none"}}},[`@media only screen and (max-width: ${n.screenSM}px)`]:{[`${e}-options`]:{display:"none"}}}),[`&${n.componentCls}-rtl`]:{direction:"rtl"}}},nB=n=>{const{componentCls:e}=n;return{[`${e}:not(${e}-disabled)`]:{[`${e}-item`]:Object.assign({},U_(n)),[`${e}-jump-prev, ${e}-jump-next`]:{"&:focus-visible":Object.assign({[`${e}-item-link-icon`]:{opacity:1},[`${e}-item-ellipsis`]:{opacity:0}},fh(n))},[`${e}-prev, ${e}-next`]:{[`&:focus-visible ${e}-item-link`]:Object.assign({},fh(n))}}}},u$=n=>Object.assign({itemBg:n.colorBgContainer,itemSize:n.controlHeight,itemSizeSM:n.controlHeightSM,itemActiveBg:n.colorBgContainer,itemLinkBg:n.colorBgContainer,itemActiveColorDisabled:n.colorTextDisabled,itemActiveBgDisabled:n.controlItemBgActiveDisabled,itemInputBg:n.colorBgContainer,miniOptionsSizeChangerTop:0},Gv(n)),d$=n=>Ei(n,{inputOutlineOffset:0,paginationMiniOptionsMarginInlineStart:n.calc(n.marginXXS).div(2).equal(),paginationMiniQuickJumperInputWidth:n.calc(n.controlHeightLG).mul(1.1).equal(),paginationItemPaddingInline:n.calc(n.marginXXS).mul(1.5).equal(),paginationEllipsisLetterSpacing:n.calc(n.marginXXS).div(2).equal(),paginationSlashMarginInlineStart:n.marginSM,paginationSlashMarginInlineEnd:n.marginSM,paginationEllipsisTextIndent:"0.13em"},Wv(n)),iB=Xr("Pagination",n=>{const e=d$(n);return[tB(e),nB(e)]},u$),rB=n=>{const{componentCls:e}=n;return{[`${e}${e}-bordered${e}-disabled:not(${e}-mini)`]:{"&, &:hover":{[`${e}-item-link`]:{borderColor:n.colorBorder}},"&:focus-visible":{[`${e}-item-link`]:{borderColor:n.colorBorder}},[`${e}-item, ${e}-item-link`]:{backgroundColor:n.colorBgContainerDisabled,borderColor:n.colorBorder,[`&:hover:not(${e}-item-active)`]:{backgroundColor:n.colorBgContainerDisabled,borderColor:n.colorBorder,a:{color:n.colorTextDisabled}},[`&${e}-item-active`]:{backgroundColor:n.itemActiveBgDisabled}},[`${e}-prev, ${e}-next`]:{"&:hover button":{backgroundColor:n.colorBgContainerDisabled,borderColor:n.colorBorder,color:n.colorTextDisabled},[`${e}-item-link`]:{backgroundColor:n.colorBgContainerDisabled,borderColor:n.colorBorder}}},[`${e}${e}-bordered:not(${e}-mini)`]:{[`${e}-prev, ${e}-next`]:{"&:hover button":{borderColor:n.colorPrimaryHover,backgroundColor:n.itemBg},[`${e}-item-link`]:{backgroundColor:n.itemLinkBg,borderColor:n.colorBorder},[`&:hover ${e}-item-link`]:{borderColor:n.colorPrimary,backgroundColor:n.itemBg,color:n.colorPrimary},[`&${e}-disabled`]:{[`${e}-item-link`]:{borderColor:n.colorBorder,color:n.colorTextDisabled}}},[`${e}-item`]:{backgroundColor:n.itemBg,border:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,[`&:hover:not(${e}-item-active)`]:{borderColor:n.colorPrimary,backgroundColor:n.itemBg,a:{color:n.colorPrimary}},"&-active":{borderColor:n.colorPrimary}}}}},oB=j_(["Pagination","bordered"],n=>{const e=d$(n);return[rB(e)]},u$);var sB=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const h$=n=>{const{align:e,prefixCls:t,selectPrefixCls:i,className:r,rootClassName:o,style:s,size:a,locale:l,selectComponentClass:c,responsive:u,showSizeChanger:d}=n,f=sB(n,["align","prefixCls","selectPrefixCls","className","rootClassName","style","size","locale","selectComponentClass","responsive","showSizeChanger"]),{xs:h}=xv(u),[,p]=Wl(),{getPrefixCls:m,direction:g,pagination:v={}}=S.useContext(Nn),x=m("pagination",t),[b,w,y]=iB(x),C=d??v.showSizeChanger,$=S.useMemo(()=>{const T=S.createElement("span",{className:`${x}-item-ellipsis`},""),A=S.createElement("button",{className:`${x}-item-link`,type:"button",tabIndex:-1},g==="rtl"?S.createElement(my,null):S.createElement(rw,null)),O=S.createElement("button",{className:`${x}-item-link`,type:"button",tabIndex:-1},g==="rtl"?S.createElement(rw,null):S.createElement(my,null)),P=S.createElement("a",{className:`${x}-item-link`},S.createElement("div",{className:`${x}-item-container`},g==="rtl"?S.createElement(pw,{className:`${x}-item-link-icon`}):S.createElement(fw,{className:`${x}-item-link-icon`}),T)),M=S.createElement("a",{className:`${x}-item-link`},S.createElement("div",{className:`${x}-item-container`},g==="rtl"?S.createElement(fw,{className:`${x}-item-link-icon`}):S.createElement(pw,{className:`${x}-item-link-icon`}),T));return{prevIcon:A,nextIcon:O,jumpPrevIcon:P,jumpNextIcon:M}},[g,x]),[I]=of("Pagination",K_),E=Object.assign(Object.assign({},I),l),N=Ns(a),k=N==="small"||!!(h&&!N&&u),D=m("select",i),_=ye({[`${x}-${e}`]:!!e,[`${x}-mini`]:k,[`${x}-rtl`]:g==="rtl",[`${x}-bordered`]:p.wireframe},v==null?void 0:v.className,r,o,w,y),R=Object.assign(Object.assign({},v==null?void 0:v.style),s);return b(S.createElement(S.Fragment,null,p.wireframe&&S.createElement(oB,{prefixCls:x}),S.createElement(q3,Object.assign({},$,f,{style:R,prefixCls:x,selectPrefixCls:D,className:_,selectComponentClass:c||(k?l$:c$),locale:E,showSizeChanger:C}))))},Yv=le.createContext({});Yv.Consumer;var f$=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const aB=n=>{var{prefixCls:e,className:t,avatar:i,title:r,description:o}=n,s=f$(n,["prefixCls","className","avatar","title","description"]);const{getPrefixCls:a}=S.useContext(Nn),l=a("list",e),c=ye(`${l}-item-meta`,t),u=le.createElement("div",{className:`${l}-item-meta-content`},r&&le.createElement("h4",{className:`${l}-item-meta-title`},r),o&&le.createElement("div",{className:`${l}-item-meta-description`},o));return le.createElement("div",Object.assign({},s,{className:c}),i&&le.createElement("div",{className:`${l}-item-meta-avatar`},i),(r||o)&&u)},lB=le.forwardRef((n,e)=>{const{prefixCls:t,children:i,actions:r,extra:o,styles:s,className:a,classNames:l,colStyle:c}=n,u=f$(n,["prefixCls","children","actions","extra","styles","className","classNames","colStyle"]),{grid:d,itemLayout:f}=S.useContext(Yv),{getPrefixCls:h,list:p}=S.useContext(Nn),m=$=>{var I,E;return ye((E=(I=p==null?void 0:p.item)===null||I===void 0?void 0:I.classNames)===null||E===void 0?void 0:E[$],l==null?void 0:l[$])},g=$=>{var I,E;return Object.assign(Object.assign({},(E=(I=p==null?void 0:p.item)===null||I===void 0?void 0:I.styles)===null||E===void 0?void 0:E[$]),s==null?void 0:s[$])},v=()=>{let $=!1;return S.Children.forEach(i,I=>{typeof I=="string"&&($=!0)}),$&&S.Children.count(i)>1},x=()=>f==="vertical"?!!o:!v(),b=h("list",t),w=r&&r.length>0&&le.createElement("ul",{className:ye(`${b}-item-action`,m("actions")),key:"actions",style:g("actions")},r.map(($,I)=>le.createElement("li",{key:`${b}-item-action-${I}`},$,I!==r.length-1&&le.createElement("em",{className:`${b}-item-action-split`})))),y=d?"div":"li",C=le.createElement(y,Object.assign({},u,d?{}:{ref:e},{className:ye(`${b}-item`,{[`${b}-item-no-flex`]:!x()},a)}),f==="vertical"&&o?[le.createElement("div",{className:`${b}-item-main`,key:"content"},i,w),le.createElement("div",{className:ye(`${b}-item-extra`,m("extra")),key:"extra",style:g("extra")},o)]:[i,w,Fc(o,{key:"extra"})]);return d?le.createElement(n3,{ref:e,flex:1,style:c},C):C}),p$=lB;p$.Meta=aB;const cB=n=>{const{listBorderedCls:e,componentCls:t,paddingLG:i,margin:r,itemPaddingSM:o,itemPaddingLG:s,marginLG:a,borderRadiusLG:l}=n;return{[e]:{border:`${ue(n.lineWidth)} ${n.lineType} ${n.colorBorder}`,borderRadius:l,[`${t}-header,${t}-footer,${t}-item`]:{paddingInline:i},[`${t}-pagination`]:{margin:`${ue(r)} ${ue(a)}`}},[`${e}${t}-sm`]:{[`${t}-item,${t}-header,${t}-footer`]:{padding:o}},[`${e}${t}-lg`]:{[`${t}-item,${t}-header,${t}-footer`]:{padding:s}}}},uB=n=>{const{componentCls:e,screenSM:t,screenMD:i,marginLG:r,marginSM:o,margin:s}=n;return{[`@media screen and (max-width:${i}px)`]:{[e]:{[`${e}-item`]:{[`${e}-item-action`]:{marginInlineStart:r}}},[`${e}-vertical`]:{[`${e}-item`]:{[`${e}-item-extra`]:{marginInlineStart:r}}}},[`@media screen and (max-width: ${t}px)`]:{[e]:{[`${e}-item`]:{flexWrap:"wrap",[`${e}-action`]:{marginInlineStart:o}}},[`${e}-vertical`]:{[`${e}-item`]:{flexWrap:"wrap-reverse",[`${e}-item-main`]:{minWidth:n.contentWidth},[`${e}-item-extra`]:{margin:`auto auto ${ue(s)}`}}}}}},dB=n=>{const{componentCls:e,antCls:t,controlHeight:i,minHeight:r,paddingSM:o,marginLG:s,padding:a,itemPadding:l,colorPrimary:c,itemPaddingSM:u,itemPaddingLG:d,paddingXS:f,margin:h,colorText:p,colorTextDescription:m,motionDurationSlow:g,lineWidth:v,headerBg:x,footerBg:b,emptyTextPadding:w,metaMarginBottom:y,avatarMarginRight:C,titleMarginBottom:$,descriptionFontSize:I}=n;return{[e]:Object.assign(Object.assign({},sr(n)),{position:"relative","*":{outline:"none"},[`${e}-header`]:{background:x},[`${e}-footer`]:{background:b},[`${e}-header, ${e}-footer`]:{paddingBlock:o},[`${e}-pagination`]:{marginBlockStart:s,[`${t}-pagination-options`]:{textAlign:"start"}},[`${e}-spin`]:{minHeight:r,textAlign:"center"},[`${e}-items`]:{margin:0,padding:0,listStyle:"none"},[`${e}-item`]:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:l,color:p,[`${e}-item-meta`]:{display:"flex",flex:1,alignItems:"flex-start",maxWidth:"100%",[`${e}-item-meta-avatar`]:{marginInlineEnd:C},[`${e}-item-meta-content`]:{flex:"1 0",width:0,color:p},[`${e}-item-meta-title`]:{margin:`0 0 ${ue(n.marginXXS)} 0`,color:p,fontSize:n.fontSize,lineHeight:n.lineHeight,"> a":{color:p,transition:`all ${g}`,"&:hover":{color:c}}},[`${e}-item-meta-description`]:{color:m,fontSize:I,lineHeight:n.lineHeight}},[`${e}-item-action`]:{flex:"0 0 auto",marginInlineStart:n.marginXXL,padding:0,fontSize:0,listStyle:"none","& > li":{position:"relative",display:"inline-block",padding:`0 ${ue(f)}`,color:m,fontSize:n.fontSize,lineHeight:n.lineHeight,textAlign:"center","&:first-child":{paddingInlineStart:0}},[`${e}-item-action-split`]:{position:"absolute",insetBlockStart:"50%",insetInlineEnd:0,width:v,height:n.calc(n.fontHeight).sub(n.calc(n.marginXXS).mul(2)).equal(),transform:"translateY(-50%)",backgroundColor:n.colorSplit}}},[`${e}-empty`]:{padding:`${ue(a)} 0`,color:m,fontSize:n.fontSizeSM,textAlign:"center"},[`${e}-empty-text`]:{padding:w,color:n.colorTextDisabled,fontSize:n.fontSize,textAlign:"center"},[`${e}-item-no-flex`]:{display:"block"}}),[`${e}-grid ${t}-col > ${e}-item`]:{display:"block",maxWidth:"100%",marginBlockEnd:h,paddingBlock:0,borderBlockEnd:"none"},[`${e}-vertical ${e}-item`]:{alignItems:"initial",[`${e}-item-main`]:{display:"block",flex:1},[`${e}-item-extra`]:{marginInlineStart:s},[`${e}-item-meta`]:{marginBlockEnd:y,[`${e}-item-meta-title`]:{marginBlockStart:0,marginBlockEnd:$,color:p,fontSize:n.fontSizeLG,lineHeight:n.lineHeightLG}},[`${e}-item-action`]:{marginBlockStart:a,marginInlineStart:"auto","> li":{padding:`0 ${ue(a)}`,"&:first-child":{paddingInlineStart:0}}}},[`${e}-split ${e}-item`]:{borderBlockEnd:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`,"&:last-child":{borderBlockEnd:"none"}},[`${e}-split ${e}-header`]:{borderBlockEnd:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`},[`${e}-split${e}-empty ${e}-footer`]:{borderTop:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`},[`${e}-loading ${e}-spin-nested-loading`]:{minHeight:i},[`${e}-split${e}-something-after-last-item ${t}-spin-container > ${e}-items > ${e}-item:last-child`]:{borderBlockEnd:`${ue(n.lineWidth)} ${n.lineType} ${n.colorSplit}`},[`${e}-lg ${e}-item`]:{padding:d},[`${e}-sm ${e}-item`]:{padding:u},[`${e}:not(${e}-vertical)`]:{[`${e}-item-no-flex`]:{[`${e}-item-action`]:{float:"right"}}}}},hB=n=>({contentWidth:220,itemPadding:`${ue(n.paddingContentVertical)} 0`,itemPaddingSM:`${ue(n.paddingContentVerticalSM)} ${ue(n.paddingContentHorizontal)}`,itemPaddingLG:`${ue(n.paddingContentVerticalLG)} ${ue(n.paddingContentHorizontalLG)}`,headerBg:"transparent",footerBg:"transparent",emptyTextPadding:n.padding,metaMarginBottom:n.padding,avatarMarginRight:n.padding,titleMarginBottom:n.paddingSM,descriptionFontSize:n.fontSize}),fB=Xr("List",n=>{const e=Ei(n,{listBorderedCls:`${n.componentCls}-bordered`,minHeight:n.controlHeightLG});return[dB(e),cB(e),uB(e)]},hB);var pB=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};function mB(n,e){var{pagination:t=!1,prefixCls:i,bordered:r=!1,split:o=!0,className:s,rootClassName:a,style:l,children:c,itemLayout:u,loadMore:d,grid:f,dataSource:h=[],size:p,header:m,footer:g,loading:v=!1,rowKey:x,renderItem:b,locale:w}=n,y=pB(n,["pagination","prefixCls","bordered","split","className","rootClassName","style","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]);const C=t&&typeof t=="object"?t:{},[$,I]=S.useState(C.defaultCurrent||1),[E,N]=S.useState(C.defaultPageSize||10),{getPrefixCls:k,renderEmpty:D,direction:_,list:R}=S.useContext(Nn),T={current:1,total:0},A=fe=>(ge,we)=>{var ve;I(ge),N(we),t&&((ve=t==null?void 0:t[fe])===null||ve===void 0||ve.call(t,ge,we))},O=A("onChange"),P=A("onShowSizeChange"),M=(fe,ge)=>{if(!b)return null;let we;return typeof x=="function"?we=x(fe):x?we=fe[x]:we=fe.key,we||(we=`list-item-${ge}`),S.createElement(S.Fragment,{key:we},b(fe,ge))},z=()=>!!(d||t||g),L=k("list",i),[W,U,V]=fB(L);let H=v;typeof H=="boolean"&&(H={spinning:H});const Y=!!(H!=null&&H.spinning),Q=Ns(p);let Z="";switch(Q){case"large":Z="lg";break;case"small":Z="sm";break}const pe=ye(L,{[`${L}-vertical`]:u==="vertical",[`${L}-${Z}`]:Z,[`${L}-split`]:o,[`${L}-bordered`]:r,[`${L}-loading`]:Y,[`${L}-grid`]:!!f,[`${L}-something-after-last-item`]:z(),[`${L}-rtl`]:_==="rtl"},R==null?void 0:R.className,s,a,U,V),oe=qv(T,{total:h.length,current:$,pageSize:E},t||{}),X=Math.ceil(oe.total/oe.pageSize);oe.current>X&&(oe.current=X);const j=t&&S.createElement("div",{className:ye(`${L}-pagination`)},S.createElement(h$,Object.assign({align:"end"},oe,{onChange:O,onShowSizeChange:P})));let ne=nt(h);t&&h.length>(oe.current-1)*oe.pageSize&&(ne=nt(h).splice((oe.current-1)*oe.pageSize,oe.pageSize));const se=Object.keys(f||{}).some(fe=>["xs","sm","md","lg","xl","xxl"].includes(fe)),ce=xv(se),re=S.useMemo(()=>{for(let fe=0;fe<yl.length;fe+=1){const ge=yl[fe];if(ce[ge])return ge}},[ce]),be=S.useMemo(()=>{if(!f)return;const fe=re&&f[re]?f[re]:f.column;if(fe)return{width:`${100/fe}%`,maxWidth:`${100/fe}%`}},[JSON.stringify(f),re]);let Ie=Y&&S.createElement("div",{style:{minHeight:53}});if(ne.length>0){const fe=ne.map((ge,we)=>M(ge,we));Ie=f?S.createElement(r3,{gutter:f.gutter},S.Children.map(fe,ge=>S.createElement("div",{key:ge==null?void 0:ge.key,style:be},ge))):S.createElement("ul",{className:`${L}-items`},fe)}else!c&&!Y&&(Ie=S.createElement("div",{className:`${L}-empty-text`},(w==null?void 0:w.emptyText)||(D==null?void 0:D("List"))||S.createElement(zv,{componentName:"List"})));const Ee=oe.position||"bottom",Se=S.useMemo(()=>({grid:f,itemLayout:u}),[JSON.stringify(f),u]);return W(S.createElement(Yv.Provider,{value:Se},S.createElement("div",Object.assign({ref:e,style:Object.assign(Object.assign({},R==null?void 0:R.style),l),className:pe},y),(Ee==="top"||Ee==="both")&&j,m&&S.createElement("div",{className:`${L}-header`},m),S.createElement(w1,Object.assign({},H),Ie,c),g&&S.createElement("div",{className:`${L}-footer`},g),d||(Ee==="bottom"||Ee==="both")&&j)))}const gB=S.forwardRef(mB),ng=gB;ng.Item=p$;var vB={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"filled"},xB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:vB}))},bB=S.forwardRef(xB),yB={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"outlined"},wB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:yB}))},CB=S.forwardRef(wB),SB={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z"}}]},name:"caret-up",theme:"outlined"},IB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:SB}))},$B=S.forwardRef(IB),EB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},NB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:EB}))},m$=S.forwardRef(NB),kB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M349 838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V642H349v196zm531.1-684H143.9c-24.5 0-39.8 26.7-27.5 48l221.3 376h348.8l221.3-376c12.1-21.3-3.2-48-27.7-48z"}}]},name:"filter",theme:"filled"},DB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:kB}))},TB=S.forwardRef(DB),RB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"}}]},name:"folder-open",theme:"outlined"},_B=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:RB}))},AB=S.forwardRef(_B),OB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder",theme:"outlined"},PB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:OB}))},MB=S.forwardRef(PB),FB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 276.5a56 56 0 1056-97 56 56 0 00-56 97zm0 284a56 56 0 1056-97 56 56 0 00-56 97zM640 228a56 56 0 10112 0 56 56 0 00-112 0zm0 284a56 56 0 10112 0 56 56 0 00-112 0zM300 844.5a56 56 0 1056-97 56 56 0 00-56 97zM640 796a56 56 0 10112 0 56 56 0 00-112 0z"}}]},name:"holder",theme:"outlined"},LB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:FB}))},zB=S.forwardRef(LB),BB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"minus-square",theme:"outlined"},VB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:BB}))},WB=S.forwardRef(VB),GB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},HB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:GB}))},UB=S.forwardRef(HB),jB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},KB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:jB}))},vw=S.forwardRef(KB),XB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"plus-square",theme:"outlined"},qB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:XB}))},YB=S.forwardRef(qB),JB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"robot",theme:"outlined"},ZB=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:JB}))},g$=S.forwardRef(ZB),QB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},eV=function(e,t){return S.createElement(kn,ze({},e,{ref:t,icon:QB}))},tV=S.forwardRef(eV),os={},cu="rc-table-internal-hook";function Jv(n){var e=S.createContext(void 0),t=function(r){var o=r.value,s=r.children,a=S.useRef(o);a.current=o;var l=S.useState(function(){return{getValue:function(){return a.current},listeners:new Set}}),c=ke(l,1),u=c[0];return Yi(function(){Um.unstable_batchedUpdates(function(){u.listeners.forEach(function(d){d(o)})})},[o]),S.createElement(e.Provider,{value:u},s)};return{Context:e,Provider:t,defaultValue:n}}function fi(n,e){var t=Nr(typeof e=="function"?e:function(d){if(e===void 0)return d;if(!Array.isArray(e))return d[e];var f={};return e.forEach(function(h){f[h]=d[h]}),f}),i=S.useContext(n==null?void 0:n.Context),r=i||{},o=r.listeners,s=r.getValue,a=S.useRef();a.current=t(i?s():n==null?void 0:n.defaultValue);var l=S.useState({}),c=ke(l,2),u=c[1];return Yi(function(){if(!i)return;function d(f){var h=t(f);Lc(a.current,h,!0)||u({})}return o.add(d),function(){o.delete(d)}},[i]),a.current}function nV(){var n=S.createContext(null);function e(){return S.useContext(n)}function t(r,o){var s=gy(r),a=function(c,u){var d=s?{ref:u}:{},f=S.useRef(0),h=S.useRef(c),p=e();return p!==null?S.createElement(r,ze({},c,d)):((!o||o(h.current,c))&&(f.current+=1),h.current=c,S.createElement(n.Provider,{value:f.current},S.createElement(r,ze({},c,d))))};return s?S.forwardRef(a):a}function i(r,o){var s=gy(r),a=function(c,u){var d=s?{ref:u}:{};return e(),S.createElement(r,ze({},c,d))};return s?S.memo(S.forwardRef(a),o):S.memo(a,o)}return{makeImmutable:t,responseImmutable:i,useImmutableMark:e}}var Zv=nV(),v$=Zv.makeImmutable,jl=Zv.responseImmutable,iV=Zv.useImmutableMark,Bi=Jv(),x$=S.createContext({renderWithProps:!1}),rV="RC_TABLE_KEY";function oV(n){return n==null?[]:Array.isArray(n)?n:[n]}function pf(n){var e=[],t={};return n.forEach(function(i){for(var r=i||{},o=r.key,s=r.dataIndex,a=o||oV(s).join("-")||rV;t[a];)a="".concat(a,"_next");t[a]=!0,e.push(a)}),e}function ig(n){return n!=null}function sV(n){return typeof n=="number"&&!Number.isNaN(n)}function aV(n){return n&&vn(n)==="object"&&!Array.isArray(n)&&!S.isValidElement(n)}function lV(n,e,t,i,r,o){var s=S.useContext(x$),a=iV(),l=cv(function(){if(ig(i))return[i];var c=e==null||e===""?[]:Array.isArray(e)?e:[e],u=fv(n,c),d=u,f=void 0;if(r){var h=r(u,n,t);aV(h)?(d=h.children,f=h.props,s.renderWithProps=!0):d=h}return[d,f]},[a,n,i,e,r,t],function(c,u){if(o){var d=ke(c,2),f=d[1],h=ke(u,2),p=h[1];return o(p,f)}return s.renderWithProps?!0:!Lc(c,u,!0)});return l}function cV(n,e,t,i){var r=n+e-1;return n<=i&&r>=t}function uV(n,e){return fi(Bi,function(t){var i=cV(n,e||1,t.hoverStartRow,t.hoverEndRow);return[i,t.onHover]})}var dV=function(e){var t=e.ellipsis,i=e.rowType,r=e.children,o,s=t===!0?{showTitle:!0}:t;return s&&(s.showTitle||i==="header")&&(typeof r=="string"||typeof r=="number"?o=r.toString():S.isValidElement(r)&&typeof r.props.children=="string"&&(o=r.props.children)),o};function hV(n){var e,t,i,r,o,s,a,l,c=n.component,u=n.children,d=n.ellipsis,f=n.scope,h=n.prefixCls,p=n.className,m=n.align,g=n.record,v=n.render,x=n.dataIndex,b=n.renderIndex,w=n.shouldCellUpdate,y=n.index,C=n.rowType,$=n.colSpan,I=n.rowSpan,E=n.fixLeft,N=n.fixRight,k=n.firstFixLeft,D=n.lastFixLeft,_=n.firstFixRight,R=n.lastFixRight,T=n.appendNode,A=n.additionalProps,O=A===void 0?{}:A,P=n.isSticky,M="".concat(h,"-cell"),z=fi(Bi,["supportSticky","allColumnsFixedLeft","rowHoverable"]),L=z.supportSticky,W=z.allColumnsFixedLeft,U=z.rowHoverable,V=lV(g,x,b,u,v,w),H=ke(V,2),Y=H[0],Q=H[1],Z={},pe=typeof E=="number"&&L,oe=typeof N=="number"&&L;pe&&(Z.position="sticky",Z.left=E),oe&&(Z.position="sticky",Z.right=N);var X=(e=(t=(i=Q==null?void 0:Q.colSpan)!==null&&i!==void 0?i:O.colSpan)!==null&&t!==void 0?t:$)!==null&&e!==void 0?e:1,j=(r=(o=(s=Q==null?void 0:Q.rowSpan)!==null&&s!==void 0?s:O.rowSpan)!==null&&o!==void 0?o:I)!==null&&r!==void 0?r:1,ne=uV(y,j),se=ke(ne,2),ce=se[0],re=se[1],be=Nr(function(ve){var Ne;g&&re(y,y+j-1),O==null||(Ne=O.onMouseEnter)===null||Ne===void 0||Ne.call(O,ve)}),Ie=Nr(function(ve){var Ne;g&&re(-1,-1),O==null||(Ne=O.onMouseLeave)===null||Ne===void 0||Ne.call(O,ve)});if(X===0||j===0)return null;var Ee=(a=O.title)!==null&&a!==void 0?a:dV({rowType:C,ellipsis:d,children:Y}),Se=ye(M,p,(l={},J(J(J(J(J(J(J(J(J(J(l,"".concat(M,"-fix-left"),pe&&L),"".concat(M,"-fix-left-first"),k&&L),"".concat(M,"-fix-left-last"),D&&L),"".concat(M,"-fix-left-all"),D&&W&&L),"".concat(M,"-fix-right"),oe&&L),"".concat(M,"-fix-right-first"),_&&L),"".concat(M,"-fix-right-last"),R&&L),"".concat(M,"-ellipsis"),d),"".concat(M,"-with-append"),T),"".concat(M,"-fix-sticky"),(pe||oe)&&P&&L),J(l,"".concat(M,"-row-hover"),!Q&&ce)),O.className,Q==null?void 0:Q.className),fe={};m&&(fe.textAlign=m);var ge=me(me(me(me({},Z),O.style),fe),Q==null?void 0:Q.style),we=Y;return vn(we)==="object"&&!Array.isArray(we)&&!S.isValidElement(we)&&(we=null),d&&(D||_)&&(we=S.createElement("span",{className:"".concat(M,"-content")},we)),S.createElement(c,ze({},Q,O,{className:Se,style:ge,title:Ee,scope:f,onMouseEnter:U?be:void 0,onMouseLeave:U?Ie:void 0,colSpan:X!==1?X:null,rowSpan:j!==1?j:null}),T,we)}const Kl=S.memo(hV);function Qv(n,e,t,i,r){var o=t[n]||{},s=t[e]||{},a,l;o.fixed==="left"?a=i.left[r==="rtl"?e:n]:s.fixed==="right"&&(l=i.right[r==="rtl"?n:e]);var c=!1,u=!1,d=!1,f=!1,h=t[e+1],p=t[n-1],m=h&&!h.fixed||p&&!p.fixed||t.every(function(w){return w.fixed==="left"});if(r==="rtl"){if(a!==void 0){var g=p&&p.fixed==="left";f=!g&&m}else if(l!==void 0){var v=h&&h.fixed==="right";d=!v&&m}}else if(a!==void 0){var x=h&&h.fixed==="left";c=!x&&m}else if(l!==void 0){var b=p&&p.fixed==="right";u=!b&&m}return{fixLeft:a,fixRight:l,lastFixLeft:c,firstFixRight:u,lastFixRight:d,firstFixLeft:f,isSticky:i.isSticky}}var b$=S.createContext({});function fV(n){var e=n.className,t=n.index,i=n.children,r=n.colSpan,o=r===void 0?1:r,s=n.rowSpan,a=n.align,l=fi(Bi,["prefixCls","direction"]),c=l.prefixCls,u=l.direction,d=S.useContext(b$),f=d.scrollColumnIndex,h=d.stickyOffsets,p=d.flattenColumns,m=t+o-1,g=m+1===f?o+1:o,v=Qv(t,t+g-1,p,h,u);return S.createElement(Kl,ze({className:e,index:t,component:"td",prefixCls:c,record:null,dataIndex:null,align:a,colSpan:g,rowSpan:s,render:function(){return i}},v))}var pV=["children"];function mV(n){var e=n.children,t=En(n,pV);return S.createElement("tr",t,e)}function mf(n){var e=n.children;return e}mf.Row=mV;mf.Cell=fV;function gV(n){var e=n.children,t=n.stickyOffsets,i=n.flattenColumns,r=fi(Bi,"prefixCls"),o=i.length-1,s=i[o],a=S.useMemo(function(){return{stickyOffsets:t,flattenColumns:i,scrollColumnIndex:s!=null&&s.scrollbar?o:null}},[s,i,o,t]);return S.createElement(b$.Provider,{value:a},S.createElement("tfoot",{className:"".concat(r,"-summary")},e))}const Ad=jl(gV);var y$=mf;function vV(n){return null}function xV(n){return null}function w$(n,e,t,i,r,o,s){n.push({record:e,indent:t,index:s});var a=o(e),l=r==null?void 0:r.has(a);if(e&&Array.isArray(e[i])&&l)for(var c=0;c<e[i].length;c+=1)w$(n,e[i][c],t+1,i,r,o,c)}function C$(n,e,t,i){var r=S.useMemo(function(){if(t!=null&&t.size){for(var o=[],s=0;s<(n==null?void 0:n.length);s+=1){var a=n[s];w$(o,a,0,e,t,i,s)}return o}return n==null?void 0:n.map(function(l,c){return{record:l,indent:0,index:c}})},[n,e,t,i]);return r}function S$(n,e,t,i){var r=fi(Bi,["prefixCls","fixedInfoList","flattenColumns","expandableType","expandRowByClick","onTriggerExpand","rowClassName","expandedRowClassName","indentSize","expandIcon","expandedRowRender","expandIconColumnIndex","expandedKeys","childrenColumnName","rowExpandable","onRow"]),o=r.flattenColumns,s=r.expandableType,a=r.expandedKeys,l=r.childrenColumnName,c=r.onTriggerExpand,u=r.rowExpandable,d=r.onRow,f=r.expandRowByClick,h=r.rowClassName,p=s==="nest",m=s==="row"&&(!u||u(n)),g=m||p,v=a&&a.has(e),x=l&&n&&n[l],b=Nr(c),w=d==null?void 0:d(n,t),y=w==null?void 0:w.onClick,C=function(N){f&&g&&c(n,N);for(var k=arguments.length,D=new Array(k>1?k-1:0),_=1;_<k;_++)D[_-1]=arguments[_];y==null||y.apply(void 0,[N].concat(D))},$;typeof h=="string"?$=h:typeof h=="function"&&($=h(n,t,i));var I=pf(o);return me(me({},r),{},{columnsKey:I,nestExpandable:p,expanded:v,hasNestChildren:x,record:n,onTriggerExpand:b,rowSupportExpand:m,expandable:g,rowProps:me(me({},w),{},{className:ye($,w==null?void 0:w.className),onClick:C})})}function I$(n){var e=n.prefixCls,t=n.children,i=n.component,r=n.cellComponent,o=n.className,s=n.expanded,a=n.colSpan,l=n.isEmpty,c=fi(Bi,["scrollbarSize","fixHeader","fixColumn","componentWidth","horizonScroll"]),u=c.scrollbarSize,d=c.fixHeader,f=c.fixColumn,h=c.componentWidth,p=c.horizonScroll,m=t;return(l?p&&h:f)&&(m=S.createElement("div",{style:{width:h-(d&&!l?u:0),position:"sticky",left:0,overflow:"hidden"},className:"".concat(e,"-expanded-row-fixed")},m)),S.createElement(i,{className:o,style:{display:s?null:"none"}},S.createElement(Kl,{component:r,prefixCls:e,colSpan:a},m))}function bV(n){var e=n.prefixCls,t=n.record,i=n.onExpand,r=n.expanded,o=n.expandable,s="".concat(e,"-row-expand-icon");if(!o)return S.createElement("span",{className:ye(s,"".concat(e,"-row-spaced"))});var a=function(c){i(t,c),c.stopPropagation()};return S.createElement("span",{className:ye(s,J(J({},"".concat(e,"-row-expanded"),r),"".concat(e,"-row-collapsed"),!r)),onClick:a})}function yV(n,e,t){var i=[];function r(o){(o||[]).forEach(function(s,a){i.push(e(s,a)),r(s[t])})}return r(n),i}function $$(n,e,t,i){return typeof n=="string"?n:typeof n=="function"?n(e,t,i):""}function E$(n,e,t,i,r){var o=n.record,s=n.prefixCls,a=n.columnsKey,l=n.fixedInfoList,c=n.expandIconColumnIndex,u=n.nestExpandable,d=n.indentSize,f=n.expandIcon,h=n.expanded,p=n.hasNestChildren,m=n.onTriggerExpand,g=a[t],v=l[t],x;t===(c||0)&&u&&(x=S.createElement(S.Fragment,null,S.createElement("span",{style:{paddingLeft:"".concat(d*i,"px")},className:"".concat(s,"-row-indent indent-level-").concat(i)}),f({prefixCls:s,expanded:h,expandable:p,record:o,onExpand:m})));var b;return e.onCell&&(b=e.onCell(o,r)),{key:g,fixedInfo:v,appendCellNode:x,additionalCellProps:b||{}}}function wV(n){var e=n.className,t=n.style,i=n.record,r=n.index,o=n.renderIndex,s=n.rowKey,a=n.indent,l=a===void 0?0:a,c=n.rowComponent,u=n.cellComponent,d=n.scopeCellComponent,f=S$(i,s,r,l),h=f.prefixCls,p=f.flattenColumns,m=f.expandedRowClassName,g=f.expandedRowRender,v=f.rowProps,x=f.expanded,b=f.rowSupportExpand,w=S.useRef(!1);w.current||(w.current=x);var y=$$(m,i,r,l),C=S.createElement(c,ze({},v,{"data-row-key":s,className:ye(e,"".concat(h,"-row"),"".concat(h,"-row-level-").concat(l),v==null?void 0:v.className,J({},y,l>=1)),style:me(me({},t),v==null?void 0:v.style)}),p.map(function(E,N){var k=E.render,D=E.dataIndex,_=E.className,R=E$(f,E,N,l,r),T=R.key,A=R.fixedInfo,O=R.appendCellNode,P=R.additionalCellProps;return S.createElement(Kl,ze({className:_,ellipsis:E.ellipsis,align:E.align,scope:E.rowScope,component:E.rowScope?d:u,prefixCls:h,key:T,record:i,index:r,renderIndex:o,dataIndex:D,render:k,shouldCellUpdate:E.shouldCellUpdate},A,{appendNode:O,additionalProps:P}))})),$;if(b&&(w.current||x)){var I=g(i,r,l+1,x);$=S.createElement(I$,{expanded:x,className:ye("".concat(h,"-expanded-row"),"".concat(h,"-expanded-row-level-").concat(l+1),y),prefixCls:h,component:c,cellComponent:u,colSpan:p.length,isEmpty:!1},I)}return S.createElement(S.Fragment,null,C,$)}const CV=jl(wV);function SV(n){var e=n.columnKey,t=n.onColumnResize,i=S.useRef();return S.useEffect(function(){i.current&&t(e,i.current.offsetWidth)},[]),S.createElement(Vl,{data:e},S.createElement("td",{ref:i,style:{padding:0,border:0,height:0}},S.createElement("div",{style:{height:0,overflow:"hidden"}},"")))}function IV(n){var e=n.prefixCls,t=n.columnsKey,i=n.onColumnResize;return S.createElement("tr",{"aria-hidden":"true",className:"".concat(e,"-measure-row"),style:{height:0,fontSize:0}},S.createElement(Vl.Collection,{onBatchResize:function(o){o.forEach(function(s){var a=s.data,l=s.size;i(a,l.offsetWidth)})}},t.map(function(r){return S.createElement(SV,{key:r,columnKey:r,onColumnResize:i})})))}function $V(n){var e=n.data,t=n.measureColumnWidth,i=fi(Bi,["prefixCls","getComponent","onColumnResize","flattenColumns","getRowKey","expandedKeys","childrenColumnName","emptyNode"]),r=i.prefixCls,o=i.getComponent,s=i.onColumnResize,a=i.flattenColumns,l=i.getRowKey,c=i.expandedKeys,u=i.childrenColumnName,d=i.emptyNode,f=C$(e,u,c,l),h=S.useRef({renderWithProps:!1}),p=o(["body","wrapper"],"tbody"),m=o(["body","row"],"tr"),g=o(["body","cell"],"td"),v=o(["body","cell"],"th"),x;e.length?x=f.map(function(w,y){var C=w.record,$=w.indent,I=w.index,E=l(C,y);return S.createElement(CV,{key:E,rowKey:E,record:C,index:y,renderIndex:I,rowComponent:m,cellComponent:g,scopeCellComponent:v,getRowKey:l,indent:$})}):x=S.createElement(I$,{expanded:!0,className:"".concat(r,"-placeholder"),prefixCls:r,component:m,cellComponent:g,colSpan:a.length,isEmpty:!0},d);var b=pf(a);return S.createElement(x$.Provider,{value:h.current},S.createElement(p,{className:"".concat(r,"-tbody")},t&&S.createElement(IV,{prefixCls:r,columnsKey:b,onColumnResize:s}),x))}const EV=jl($V);var NV=["expandable"],Rc="RC_TABLE_INTERNAL_COL_DEFINE";function kV(n){var e=n.expandable,t=En(n,NV),i;return"expandable"in n?i=me(me({},t),e):i=t,i.showExpandColumn===!1&&(i.expandIconColumnIndex=-1),i}var DV=["columnType"];function N$(n){for(var e=n.colWidths,t=n.columns,i=n.columCount,r=fi(Bi,["tableLayout"]),o=r.tableLayout,s=[],a=i||t.length,l=!1,c=a-1;c>=0;c-=1){var u=e[c],d=t&&t[c],f=void 0,h=void 0;if(d&&(f=d[Rc],o==="auto"&&(h=d.minWidth)),u||h||f||l){var p=f||{};p.columnType;var m=En(p,DV);s.unshift(S.createElement("col",ze({key:c,style:{width:u,minWidth:h}},m))),l=!0}}return S.createElement("colgroup",null,s)}var TV=["className","noData","columns","flattenColumns","colWidths","columCount","stickyOffsets","direction","fixHeader","stickyTopOffset","stickyBottomOffset","stickyClassName","onScroll","maxContentScroll","children"];function RV(n,e){return S.useMemo(function(){for(var t=[],i=0;i<e;i+=1){var r=n[i];if(r!==void 0)t[i]=r;else return null}return t},[n.join("_"),e])}var _V=S.forwardRef(function(n,e){var t=n.className,i=n.noData,r=n.columns,o=n.flattenColumns,s=n.colWidths,a=n.columCount,l=n.stickyOffsets,c=n.direction,u=n.fixHeader,d=n.stickyTopOffset,f=n.stickyBottomOffset,h=n.stickyClassName,p=n.onScroll,m=n.maxContentScroll,g=n.children,v=En(n,TV),x=fi(Bi,["prefixCls","scrollbarSize","isSticky","getComponent"]),b=x.prefixCls,w=x.scrollbarSize,y=x.isSticky,C=x.getComponent,$=C(["header","table"],"table"),I=y&&!u?0:w,E=S.useRef(null),N=S.useCallback(function(P){vy(e,P),vy(E,P)},[]);S.useEffect(function(){var P;function M(z){var L=z,W=L.currentTarget,U=L.deltaX;U&&(p({currentTarget:W,scrollLeft:W.scrollLeft+U}),z.preventDefault())}return(P=E.current)===null||P===void 0||P.addEventListener("wheel",M,{passive:!1}),function(){var z;(z=E.current)===null||z===void 0||z.removeEventListener("wheel",M)}},[]);var k=S.useMemo(function(){return o.every(function(P){return P.width})},[o]),D=o[o.length-1],_={fixed:D?D.fixed:null,scrollbar:!0,onHeaderCell:function(){return{className:"".concat(b,"-cell-scrollbar")}}},R=S.useMemo(function(){return I?[].concat(nt(r),[_]):r},[I,r]),T=S.useMemo(function(){return I?[].concat(nt(o),[_]):o},[I,o]),A=S.useMemo(function(){var P=l.right,M=l.left;return me(me({},l),{},{left:c==="rtl"?[].concat(nt(M.map(function(z){return z+I})),[0]):M,right:c==="rtl"?P:[].concat(nt(P.map(function(z){return z+I})),[0]),isSticky:y})},[I,l,y]),O=RV(s,a);return S.createElement("div",{style:me({overflow:"hidden"},y?{top:d,bottom:f}:{}),ref:N,className:ye(t,J({},h,!!h))},S.createElement($,{style:{tableLayout:"fixed",visibility:i||O?null:"hidden"}},(!i||!m||k)&&S.createElement(N$,{colWidths:O?[].concat(nt(O),[I]):[],columCount:a+1,columns:T}),g(me(me({},v),{},{stickyOffsets:A,columns:R,flattenColumns:T}))))});const xw=S.memo(_V);var AV=function(e){var t=e.cells,i=e.stickyOffsets,r=e.flattenColumns,o=e.rowComponent,s=e.cellComponent,a=e.onHeaderRow,l=e.index,c=fi(Bi,["prefixCls","direction"]),u=c.prefixCls,d=c.direction,f;a&&(f=a(t.map(function(p){return p.column}),l));var h=pf(t.map(function(p){return p.column}));return S.createElement(o,f,t.map(function(p,m){var g=p.column,v=Qv(p.colStart,p.colEnd,r,i,d),x;return g&&g.onHeaderCell&&(x=p.column.onHeaderCell(g)),S.createElement(Kl,ze({},p,{scope:g.title?p.colSpan>1?"colgroup":"col":null,ellipsis:g.ellipsis,align:g.align,component:s,prefixCls:u,key:h[m]},v,{additionalProps:x,rowType:"header"}))}))};function OV(n){var e=[];function t(s,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;e[l]=e[l]||[];var c=a,u=s.filter(Boolean).map(function(d){var f={key:d.key,className:d.className||"",children:d.title,column:d,colStart:c},h=1,p=d.children;return p&&p.length>0&&(h=t(p,c,l+1).reduce(function(m,g){return m+g},0),f.hasSubColumns=!0),"colSpan"in d&&(h=d.colSpan),"rowSpan"in d&&(f.rowSpan=d.rowSpan),f.colSpan=h,f.colEnd=f.colStart+h-1,e[l].push(f),c+=h,h});return u}t(n,0);for(var i=e.length,r=function(a){e[a].forEach(function(l){!("rowSpan"in l)&&!l.hasSubColumns&&(l.rowSpan=i-a)})},o=0;o<i;o+=1)r(o);return e}var PV=function(e){var t=e.stickyOffsets,i=e.columns,r=e.flattenColumns,o=e.onHeaderRow,s=fi(Bi,["prefixCls","getComponent"]),a=s.prefixCls,l=s.getComponent,c=S.useMemo(function(){return OV(i)},[i]),u=l(["header","wrapper"],"thead"),d=l(["header","row"],"tr"),f=l(["header","cell"],"th");return S.createElement(u,{className:"".concat(a,"-thead")},c.map(function(h,p){var m=S.createElement(AV,{key:p,flattenColumns:r,cells:h,stickyOffsets:t,rowComponent:d,cellComponent:f,onHeaderRow:o,index:p});return m}))};const bw=jl(PV);function yw(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return typeof e=="number"?e:e.endsWith("%")?n*parseFloat(e)/100:null}function MV(n,e,t){return S.useMemo(function(){if(e&&e>0){var i=0,r=0;n.forEach(function(f){var h=yw(e,f.width);h?i+=h:r+=1});var o=Math.max(e,t),s=Math.max(o-i,r),a=r,l=s/r,c=0,u=n.map(function(f){var h=me({},f),p=yw(e,h.width);if(p)h.width=p;else{var m=Math.floor(l);h.width=a===1?s:m,s-=m,a-=1}return c+=h.width,h});if(c<o){var d=o/c;s=o,u.forEach(function(f,h){var p=Math.floor(f.width*d);f.width=h===u.length-1?s:p,s-=p})}return[u,Math.max(c,o)]}return[n,e]},[n,e,t])}var FV=["children"],LV=["fixed"];function ex(n){return uv(n).filter(function(e){return S.isValidElement(e)}).map(function(e){var t=e.key,i=e.props,r=i.children,o=En(i,FV),s=me({key:t},o);return r&&(s.children=ex(r)),s})}function k$(n){return n.filter(function(e){return e&&vn(e)==="object"&&!e.hidden}).map(function(e){var t=e.children;return t&&t.length>0?me(me({},e),{},{children:k$(t)}):e})}function rg(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"key";return n.filter(function(t){return t&&vn(t)==="object"}).reduce(function(t,i,r){var o=i.fixed,s=o===!0?"left":o,a="".concat(e,"-").concat(r),l=i.children;return l&&l.length>0?[].concat(nt(t),nt(rg(l,a).map(function(c){return me({fixed:s},c)}))):[].concat(nt(t),[me(me({key:a},i),{},{fixed:s})])},[])}function zV(n){return n.map(function(e){var t=e.fixed,i=En(e,LV),r=t;return t==="left"?r="right":t==="right"&&(r="left"),me({fixed:r},i)})}function BV(n,e){var t=n.prefixCls,i=n.columns,r=n.children,o=n.expandable,s=n.expandedKeys,a=n.columnTitle,l=n.getRowKey,c=n.onTriggerExpand,u=n.expandIcon,d=n.rowExpandable,f=n.expandIconColumnIndex,h=n.direction,p=n.expandRowByClick,m=n.columnWidth,g=n.fixed,v=n.scrollWidth,x=n.clientWidth,b=S.useMemo(function(){var D=i||ex(r)||[];return k$(D.slice())},[i,r]),w=S.useMemo(function(){if(o){var D=b.slice();if(!D.includes(os)){var _=f||0;_>=0&&D.splice(_,0,os)}var R=D.indexOf(os);D=D.filter(function(P,M){return P!==os||M===R});var T=b[R],A;(g==="left"||g)&&!f?A="left":(g==="right"||g)&&f===b.length?A="right":A=T?T.fixed:null;var O=J(J(J(J(J(J({},Rc,{className:"".concat(t,"-expand-icon-col"),columnType:"EXPAND_COLUMN"}),"title",a),"fixed",A),"className","".concat(t,"-row-expand-icon-cell")),"width",m),"render",function(M,z,L){var W=l(z,L),U=s.has(W),V=d?d(z):!0,H=u({prefixCls:t,expanded:U,expandable:V,record:z,onExpand:c});return p?S.createElement("span",{onClick:function(Q){return Q.stopPropagation()}},H):H});return D.map(function(P){return P===os?O:P})}return b.filter(function(P){return P!==os})},[o,b,l,s,u,h]),y=S.useMemo(function(){var D=w;return e&&(D=e(D)),D.length||(D=[{render:function(){return null}}]),D},[e,w,h]),C=S.useMemo(function(){return h==="rtl"?zV(rg(y)):rg(y)},[y,h,v]),$=S.useMemo(function(){for(var D=-1,_=C.length-1;_>=0;_-=1){var R=C[_].fixed;if(R==="left"||R===!0){D=_;break}}if(D>=0)for(var T=0;T<=D;T+=1){var A=C[T].fixed;if(A!=="left"&&A!==!0)return!0}var O=C.findIndex(function(z){var L=z.fixed;return L==="right"});if(O>=0)for(var P=O;P<C.length;P+=1){var M=C[P].fixed;if(M!=="right")return!0}return!1},[C]),I=MV(C,v,x),E=ke(I,2),N=E[0],k=E[1];return[y,N,k,$]}function VV(n,e,t){var i=kV(n),r=i.expandIcon,o=i.expandedRowKeys,s=i.defaultExpandedRowKeys,a=i.defaultExpandAllRows,l=i.expandedRowRender,c=i.onExpand,u=i.onExpandedRowsChange,d=i.childrenColumnName,f=r||bV,h=d||"children",p=S.useMemo(function(){return l?"row":n.expandable&&n.internalHooks===cu&&n.expandable.__PARENT_RENDER_ICON__||e.some(function(y){return y&&vn(y)==="object"&&y[h]})?"nest":!1},[!!l,e]),m=S.useState(function(){return s||(a?yV(e,t,h):[])}),g=ke(m,2),v=g[0],x=g[1],b=S.useMemo(function(){return new Set(o||v||[])},[o,v]),w=S.useCallback(function(y){var C=t(y,e.indexOf(y)),$,I=b.has(C);I?(b.delete(C),$=nt(b)):$=[].concat(nt(b),[C]),x($),c&&c(!I,y),u&&u($)},[t,b,e,c,u]);return[i,p,b,f,h,w]}function WV(n,e,t){var i=n.map(function(r,o){return Qv(o,o,n,e,t)});return cv(function(){return i},[i],function(r,o){return!Lc(r,o)})}function D$(n){var e=S.useRef(n),t=S.useState({}),i=ke(t,2),r=i[1],o=S.useRef(null),s=S.useRef([]);function a(l){s.current.push(l);var c=Promise.resolve();o.current=c,c.then(function(){if(o.current===c){var u=s.current,d=e.current;s.current=[],u.forEach(function(f){e.current=f(e.current)}),o.current=null,d!==e.current&&r({})}})}return S.useEffect(function(){return function(){o.current=null}},[]),[e.current,a]}function GV(n){var e=S.useRef(null),t=S.useRef();function i(){window.clearTimeout(t.current)}function r(s){e.current=s,i(),t.current=window.setTimeout(function(){e.current=null,t.current=void 0},100)}function o(){return e.current}return S.useEffect(function(){return i},[]),[r,o]}function HV(){var n=S.useState(-1),e=ke(n,2),t=e[0],i=e[1],r=S.useState(-1),o=ke(r,2),s=o[0],a=o[1],l=S.useCallback(function(c,u){i(c),a(u)},[]);return[t,s,l]}var ww=sv()?window:null;function UV(n,e){var t=vn(n)==="object"?n:{},i=t.offsetHeader,r=i===void 0?0:i,o=t.offsetSummary,s=o===void 0?0:o,a=t.offsetScroll,l=a===void 0?0:a,c=t.getContainer,u=c===void 0?function(){return ww}:c,d=u()||ww,f=!!n;return S.useMemo(function(){return{isSticky:f,stickyClassName:f?"".concat(e,"-sticky-holder"):"",offsetHeader:r,offsetSummary:s,offsetScroll:l,container:d}},[f,l,r,s,e,d])}function jV(n,e,t){var i=S.useMemo(function(){var r=e.length,o=function(c,u,d){for(var f=[],h=0,p=c;p!==u;p+=d)f.push(h),e[p].fixed&&(h+=n[p]||0);return f},s=o(0,r,1),a=o(r-1,-1,-1).reverse();return t==="rtl"?{left:a,right:s}:{left:s,right:a}},[n,e,t]);return i}function Cw(n){var e=n.className,t=n.children;return S.createElement("div",{className:e},t)}var KV=function(e,t){var i,r,o=e.scrollBodyRef,s=e.onScroll,a=e.offsetScroll,l=e.container,c=fi(Bi,"prefixCls"),u=((i=o.current)===null||i===void 0?void 0:i.scrollWidth)||0,d=((r=o.current)===null||r===void 0?void 0:r.clientWidth)||0,f=u&&d*(d/u),h=S.useRef(),p=D$({scrollLeft:0,isHiddenScrollBar:!0}),m=ke(p,2),g=m[0],v=m[1],x=S.useRef({delta:0,x:0}),b=S.useState(!1),w=ke(b,2),y=w[0],C=w[1],$=S.useRef(null);S.useEffect(function(){return function(){Mi.cancel($.current)}},[]);var I=function(){C(!1)},E=function(R){R.persist(),x.current.delta=R.pageX-g.scrollLeft,x.current.x=0,C(!0),R.preventDefault()},N=function(R){var T,A=R||((T=window)===null||T===void 0?void 0:T.event),O=A.buttons;if(!y||O===0){y&&C(!1);return}var P=x.current.x+R.pageX-x.current.x-x.current.delta;P<=0&&(P=0),P+f>=d&&(P=d-f),s({scrollLeft:P/d*(u+2)}),x.current.x=R.pageX},k=function(){$.current=Mi(function(){if(o.current){var R=hw(o.current).top,T=R+o.current.offsetHeight,A=l===window?document.documentElement.scrollTop+window.innerHeight:hw(l).top+l.clientHeight;T-xy()<=A||R>=A-a?v(function(O){return me(me({},O),{},{isHiddenScrollBar:!0})}):v(function(O){return me(me({},O),{},{isHiddenScrollBar:!1})})}})},D=function(R){v(function(T){return me(me({},T),{},{scrollLeft:R/u*d||0})})};return S.useImperativeHandle(t,function(){return{setScrollLeft:D,checkScrollBarVisible:k}}),S.useEffect(function(){var _=_d(document.body,"mouseup",I,!1),R=_d(document.body,"mousemove",N,!1);return k(),function(){_.remove(),R.remove()}},[f,y]),S.useEffect(function(){var _=_d(l,"scroll",k,!1),R=_d(window,"resize",k,!1);return function(){_.remove(),R.remove()}},[l]),S.useEffect(function(){g.isHiddenScrollBar||v(function(_){var R=o.current;return R?me(me({},_),{},{scrollLeft:R.scrollLeft/R.scrollWidth*R.clientWidth}):_})},[g.isHiddenScrollBar]),u<=d||!f||g.isHiddenScrollBar?null:S.createElement("div",{style:{height:xy(),width:d,bottom:a},className:"".concat(c,"-sticky-scroll")},S.createElement("div",{onMouseDown:E,ref:h,className:ye("".concat(c,"-sticky-scroll-bar"),J({},"".concat(c,"-sticky-scroll-bar-active"),y)),style:{width:"".concat(f,"px"),transform:"translate3d(".concat(g.scrollLeft,"px, 0, 0)")}}))};const XV=S.forwardRef(KV);var T$="rc-table",qV=[],YV={};function JV(){return"No Data"}function ZV(n,e){var t=me({rowKey:"key",prefixCls:T$,emptyText:JV},n),i=t.prefixCls,r=t.className,o=t.rowClassName,s=t.style,a=t.data,l=t.rowKey,c=t.scroll,u=t.tableLayout,d=t.direction,f=t.title,h=t.footer,p=t.summary,m=t.caption,g=t.id,v=t.showHeader,x=t.components,b=t.emptyText,w=t.onRow,y=t.onHeaderRow,C=t.onScroll,$=t.internalHooks,I=t.transformColumns,E=t.internalRefs,N=t.tailor,k=t.getContainerWidth,D=t.sticky,_=t.rowHoverable,R=_===void 0?!0:_,T=a||qV,A=!!T.length,O=$===cu,P=S.useCallback(function(gt,Rt){return fv(x,gt)||Rt},[x]),M=S.useMemo(function(){return typeof l=="function"?l:function(gt){var Rt=gt&&gt[l];return Rt}},[l]),z=P(["body"]),L=HV(),W=ke(L,3),U=W[0],V=W[1],H=W[2],Y=VV(t,T,M),Q=ke(Y,6),Z=Q[0],pe=Q[1],oe=Q[2],X=Q[3],j=Q[4],ne=Q[5],se=c==null?void 0:c.x,ce=S.useState(0),re=ke(ce,2),be=re[0],Ie=re[1],Ee=BV(me(me(me({},t),Z),{},{expandable:!!Z.expandedRowRender,columnTitle:Z.columnTitle,expandedKeys:oe,getRowKey:M,onTriggerExpand:ne,expandIcon:X,expandIconColumnIndex:Z.expandIconColumnIndex,direction:d,scrollWidth:O&&N&&typeof se=="number"?se:null,clientWidth:be}),O?I:null),Se=ke(Ee,4),fe=Se[0],ge=Se[1],we=Se[2],ve=Se[3],Ne=we??se,Ae=S.useMemo(function(){return{columns:fe,flattenColumns:ge}},[fe,ge]),Ve=S.useRef(),Ue=S.useRef(),We=S.useRef(),Le=S.useRef();S.useImperativeHandle(e,function(){return{nativeElement:Ve.current,scrollTo:function(Rt){var li;if(We.current instanceof HTMLElement){var fr=Rt.index,ci=Rt.top,Ua=Rt.key;if(sV(ci)){var Vs;(Vs=We.current)===null||Vs===void 0||Vs.scrollTo({top:ci})}else{var Ws,fc=Ua??M(T[fr]);(Ws=We.current.querySelector('[data-row-key="'.concat(fc,'"]')))===null||Ws===void 0||Ws.scrollIntoView()}}else(li=We.current)!==null&&li!==void 0&&li.scrollTo&&We.current.scrollTo(Rt)}}});var lt=S.useRef(),ot=S.useState(!1),Me=ke(ot,2),Fe=Me[0],Ke=Me[1],Lt=S.useState(!1),Nt=ke(Lt,2),Dt=Nt[0],kt=Nt[1],_n=D$(new Map),oi=ke(_n,2),zt=oi[0],yi=oi[1],on=pf(ge),bn=on.map(function(gt){return zt.get(gt)}),Zt=S.useMemo(function(){return bn},[bn.join("_")]),Un=jV(Zt,ge,d),Yt=c&&ig(c.y),xt=c&&ig(Ne)||!!Z.fixed,pn=xt&&ge.some(function(gt){var Rt=gt.fixed;return Rt}),_t=S.useRef(),Te=UV(D,i),Ge=Te.isSticky,Ze=Te.offsetHeader,it=Te.offsetSummary,ft=Te.offsetScroll,Ot=Te.stickyClassName,qe=Te.container,et=S.useMemo(function(){return p==null?void 0:p(T)},[p,T]),pt=(Yt||Ge)&&S.isValidElement(et)&&et.type===mf&&et.props.fixed,dt,Xt,un;Yt&&(Xt={overflowY:A?"scroll":"auto",maxHeight:c.y}),xt&&(dt={overflowX:"auto"},Yt||(Xt={overflowY:"hidden"}),un={width:Ne===!0?"auto":Ne,minWidth:"100%"});var An=S.useCallback(function(gt,Rt){X_(Ve.current)&&yi(function(li){if(li.get(gt)!==Rt){var fr=new Map(li);return fr.set(gt,Rt),fr}return li})},[]),dn=GV(),Ye=ke(dn,2),Be=Ye[0],ht=Ye[1];function Ut(gt,Rt){Rt&&(typeof Rt=="function"?Rt(gt):Rt.scrollLeft!==gt&&(Rt.scrollLeft=gt,Rt.scrollLeft!==gt&&setTimeout(function(){Rt.scrollLeft=gt},0)))}var Bt=Nr(function(gt){var Rt=gt.currentTarget,li=gt.scrollLeft,fr=d==="rtl",ci=typeof li=="number"?li:Rt.scrollLeft,Ua=Rt||YV;if(!ht()||ht()===Ua){var Vs;Be(Ua),Ut(ci,Ue.current),Ut(ci,We.current),Ut(ci,lt.current),Ut(ci,(Vs=_t.current)===null||Vs===void 0?void 0:Vs.setScrollLeft)}var Ws=Rt||Ue.current;if(Ws){var fc=O&&N&&typeof Ne=="number"?Ne:Ws.scrollWidth,Zp=Ws.clientWidth;if(fc===Zp){Ke(!1),kt(!1);return}fr?(Ke(-ci<fc-Zp),kt(-ci>0)):(Ke(ci>0),kt(ci<fc-Zp))}}),Jr=Nr(function(gt){Bt(gt),C==null||C(gt)}),Ti=function(){if(xt&&We.current){var Rt;Bt({currentTarget:q_(We.current),scrollLeft:(Rt=We.current)===null||Rt===void 0?void 0:Rt.scrollLeft})}else Ke(!1),kt(!1)},Pr=function(Rt){var li,fr=Rt.width;(li=_t.current)===null||li===void 0||li.checkScrollBarVisible();var ci=Ve.current?Ve.current.offsetWidth:fr;O&&k&&Ve.current&&(ci=k(Ve.current,ci)||ci),ci!==be&&(Ti(),Ie(ci))},Zr=S.useRef(!1);S.useEffect(function(){Zr.current&&Ti()},[xt,a,fe.length]),S.useEffect(function(){Zr.current=!0},[]);var ns=S.useState(0),tt=ke(ns,2),It=tt[0],Qt=tt[1],nr=S.useState(!0),To=ke(nr,2),hc=To[0],qp=To[1];S.useEffect(function(){(!N||!O)&&(We.current instanceof Element?Qt(by(We.current).width):Qt(by(Le.current).width)),qp(TF("position","sticky"))},[]),S.useEffect(function(){O&&E&&(E.body.current=We.current)});var Yp=S.useCallback(function(gt){return S.createElement(S.Fragment,null,S.createElement(bw,gt),pt==="top"&&S.createElement(Ad,gt,et))},[pt,et]),Jp=S.useCallback(function(gt){return S.createElement(Ad,gt,et)},[et]),kd=P(["table"],"table"),zs=S.useMemo(function(){return u||(pn?Ne==="max-content"?"auto":"fixed":Yt||Ge||ge.some(function(gt){var Rt=gt.ellipsis;return Rt})?"fixed":"auto")},[Yt,pn,ge,u,Ge]),Bs,Tt={colWidths:Zt,columCount:ge.length,stickyOffsets:Un,onHeaderRow:y,fixHeader:Yt,scroll:c},mt=S.useMemo(function(){return A?null:typeof b=="function"?b():b},[A,b]),si=S.createElement(EV,{data:T,measureColumnWidth:Yt||xt||Ge}),ai=S.createElement(N$,{colWidths:ge.map(function(gt){var Rt=gt.width;return Rt}),columns:ge}),yn=m!=null?S.createElement("caption",{className:"".concat(i,"-caption")},m):void 0,Qn=Co(t,{data:!0}),hr=Co(t,{aria:!0});if(Yt||Ge){var Wi;typeof z=="function"?(Wi=z(T,{scrollbarSize:It,ref:We,onScroll:Bt}),Tt.colWidths=ge.map(function(gt,Rt){var li=gt.width,fr=Rt===ge.length-1?li-It:li;return typeof fr=="number"&&!Number.isNaN(fr)?fr:0})):Wi=S.createElement("div",{style:me(me({},dt),Xt),onScroll:Jr,ref:We,className:ye("".concat(i,"-body"))},S.createElement(kd,ze({style:me(me({},un),{},{tableLayout:zs})},hr),yn,ai,si,!pt&&et&&S.createElement(Ad,{stickyOffsets:Un,flattenColumns:ge},et)));var Qr=me(me(me({noData:!T.length,maxContentScroll:xt&&Ne==="max-content"},Tt),Ae),{},{direction:d,stickyClassName:Ot,onScroll:Bt});Bs=S.createElement(S.Fragment,null,v!==!1&&S.createElement(xw,ze({},Qr,{stickyTopOffset:Ze,className:"".concat(i,"-header"),ref:Ue}),Yp),Wi,pt&&pt!=="top"&&S.createElement(xw,ze({},Qr,{stickyBottomOffset:it,className:"".concat(i,"-summary"),ref:lt}),Jp),Ge&&We.current&&We.current instanceof Element&&S.createElement(XV,{ref:_t,offsetScroll:ft,scrollBodyRef:We,onScroll:Bt,container:qe}))}else Bs=S.createElement("div",{style:me(me({},dt),Xt),className:ye("".concat(i,"-content")),onScroll:Bt,ref:We},S.createElement(kd,ze({style:me(me({},un),{},{tableLayout:zs})},hr),yn,ai,v!==!1&&S.createElement(bw,ze({},Tt,Ae)),si,et&&S.createElement(Ad,{stickyOffsets:Un,flattenColumns:ge},et)));var eo=S.createElement("div",ze({className:ye(i,r,J(J(J(J(J(J(J(J(J(J({},"".concat(i,"-rtl"),d==="rtl"),"".concat(i,"-ping-left"),Fe),"".concat(i,"-ping-right"),Dt),"".concat(i,"-layout-fixed"),u==="fixed"),"".concat(i,"-fixed-header"),Yt),"".concat(i,"-fixed-column"),pn),"".concat(i,"-fixed-column-gapped"),pn&&ve),"".concat(i,"-scroll-horizontal"),xt),"".concat(i,"-has-fix-left"),ge[0]&&ge[0].fixed),"".concat(i,"-has-fix-right"),ge[ge.length-1]&&ge[ge.length-1].fixed==="right")),style:s,id:g,ref:Ve},Qn),f&&S.createElement(Cw,{className:"".concat(i,"-title")},f(T)),S.createElement("div",{ref:Le,className:"".concat(i,"-container")},Bs),h&&S.createElement(Cw,{className:"".concat(i,"-footer")},h(T)));xt&&(eo=S.createElement(Vl,{onResize:Pr},eo));var to=WV(ge,Un,d),Ha=S.useMemo(function(){return{scrollX:Ne,prefixCls:i,getComponent:P,scrollbarSize:It,direction:d,fixedInfoList:to,isSticky:Ge,supportSticky:hc,componentWidth:be,fixHeader:Yt,fixColumn:pn,horizonScroll:xt,tableLayout:zs,rowClassName:o,expandedRowClassName:Z.expandedRowClassName,expandIcon:X,expandableType:pe,expandRowByClick:Z.expandRowByClick,expandedRowRender:Z.expandedRowRender,onTriggerExpand:ne,expandIconColumnIndex:Z.expandIconColumnIndex,indentSize:Z.indentSize,allColumnsFixedLeft:ge.every(function(gt){return gt.fixed==="left"}),emptyNode:mt,columns:fe,flattenColumns:ge,onColumnResize:An,hoverStartRow:U,hoverEndRow:V,onHover:H,rowExpandable:Z.rowExpandable,onRow:w,getRowKey:M,expandedKeys:oe,childrenColumnName:j,rowHoverable:R}},[Ne,i,P,It,d,to,Ge,hc,be,Yt,pn,xt,zs,o,Z.expandedRowClassName,X,pe,Z.expandRowByClick,Z.expandedRowRender,ne,Z.expandIconColumnIndex,Z.indentSize,mt,fe,ge,An,U,V,H,Z.rowExpandable,w,M,oe,j,R]);return S.createElement(Bi.Provider,{value:Ha},eo)}var QV=S.forwardRef(ZV);function R$(n){return v$(QV,n)}var Xl=R$();Xl.EXPAND_COLUMN=os;Xl.INTERNAL_HOOKS=cu;Xl.Column=vV;Xl.ColumnGroup=xV;Xl.Summary=y$;var tx=Jv(null),_$=Jv(null);function eW(n,e,t){var i=e||1;return t[n+i]-(t[n]||0)}function tW(n){var e=n.rowInfo,t=n.column,i=n.colIndex,r=n.indent,o=n.index,s=n.component,a=n.renderIndex,l=n.record,c=n.style,u=n.className,d=n.inverse,f=n.getHeight,h=t.render,p=t.dataIndex,m=t.className,g=t.width,v=fi(_$,["columnsOffset"]),x=v.columnsOffset,b=E$(e,t,i,r,o),w=b.key,y=b.fixedInfo,C=b.appendCellNode,$=b.additionalCellProps,I=$.style,E=$.colSpan,N=E===void 0?1:E,k=$.rowSpan,D=k===void 0?1:k,_=i-1,R=eW(_,N,x),T=N>1?g-R:0,A=me(me(me({},I),c),{},{flex:"0 0 ".concat(R,"px"),width:"".concat(R,"px"),marginRight:T,pointerEvents:"auto"}),O=S.useMemo(function(){return d?D<=1:N===0||D===0||D>1},[D,N,d]);O?A.visibility="hidden":d&&(A.height=f==null?void 0:f(D));var P=O?function(){return null}:h,M={};return(D===0||N===0)&&(M.rowSpan=1,M.colSpan=1),S.createElement(Kl,ze({className:ye(m,u),ellipsis:t.ellipsis,align:t.align,scope:t.rowScope,component:s,prefixCls:e.prefixCls,key:w,record:l,index:o,renderIndex:a,dataIndex:p,render:P,shouldCellUpdate:t.shouldCellUpdate},y,{appendNode:C,additionalProps:me(me({},$),{},{style:A},M)}))}var nW=["data","index","className","rowKey","style","extra","getHeight"],iW=S.forwardRef(function(n,e){var t=n.data,i=n.index,r=n.className,o=n.rowKey,s=n.style,a=n.extra,l=n.getHeight,c=En(n,nW),u=t.record,d=t.indent,f=t.index,h=fi(Bi,["prefixCls","flattenColumns","fixColumn","componentWidth","scrollX"]),p=h.scrollX,m=h.flattenColumns,g=h.prefixCls,v=h.fixColumn,x=h.componentWidth,b=fi(tx,["getComponent"]),w=b.getComponent,y=S$(u,o,i,d),C=w(["body","row"],"div"),$=w(["body","cell"],"div"),I=y.rowSupportExpand,E=y.expanded,N=y.rowProps,k=y.expandedRowRender,D=y.expandedRowClassName,_;if(I&&E){var R=k(u,i,d+1,E),T=$$(D,u,i,d),A={};v&&(A={style:J({},"--virtual-width","".concat(x,"px"))});var O="".concat(g,"-expanded-row-cell");_=S.createElement(C,{className:ye("".concat(g,"-expanded-row"),"".concat(g,"-expanded-row-level-").concat(d+1),T)},S.createElement(Kl,{component:$,prefixCls:g,className:ye(O,J({},"".concat(O,"-fixed"),v)),additionalProps:A},R))}var P=me(me({},s),{},{width:p});a&&(P.position="absolute",P.pointerEvents="none");var M=S.createElement(C,ze({},N,c,{"data-row-key":o,ref:I?null:e,className:ye(r,"".concat(g,"-row"),N==null?void 0:N.className,J({},"".concat(g,"-row-extra"),a)),style:me(me({},P),N==null?void 0:N.style)}),m.map(function(z,L){return S.createElement(tW,{key:L,component:$,rowInfo:y,column:z,colIndex:L,indent:d,index:i,renderIndex:f,record:u,inverse:a,getHeight:l})}));return I?S.createElement("div",{ref:e},M,_):M}),Sw=jl(iW),rW=S.forwardRef(function(n,e){var t=n.data,i=n.onScroll,r=fi(Bi,["flattenColumns","onColumnResize","getRowKey","prefixCls","expandedKeys","childrenColumnName","scrollX","direction"]),o=r.flattenColumns,s=r.onColumnResize,a=r.getRowKey,l=r.expandedKeys,c=r.prefixCls,u=r.childrenColumnName,d=r.scrollX,f=r.direction,h=fi(tx),p=h.sticky,m=h.scrollY,g=h.listItemHeight,v=h.getComponent,x=h.onScroll,b=S.useRef(),w=C$(t,u,l,a),y=S.useMemo(function(){var _=0;return o.map(function(R){var T=R.width,A=R.key;return _+=T,[A,T,_]})},[o]),C=S.useMemo(function(){return y.map(function(_){return _[2]})},[y]);S.useEffect(function(){y.forEach(function(_){var R=ke(_,2),T=R[0],A=R[1];s(T,A)})},[y]),S.useImperativeHandle(e,function(){var _,R={scrollTo:function(A){var O;(O=b.current)===null||O===void 0||O.scrollTo(A)},nativeElement:(_=b.current)===null||_===void 0?void 0:_.nativeElement};return Object.defineProperty(R,"scrollLeft",{get:function(){var A;return((A=b.current)===null||A===void 0?void 0:A.getScrollInfo().x)||0},set:function(A){var O;(O=b.current)===null||O===void 0||O.scrollTo({left:A})}}),R});var $=function(R,T){var A,O=(A=w[T])===null||A===void 0?void 0:A.record,P=R.onCell;if(P){var M,z=P(O,T);return(M=z==null?void 0:z.rowSpan)!==null&&M!==void 0?M:1}return 1},I=function(R){var T=R.start,A=R.end,O=R.getSize,P=R.offsetY;if(A<0)return null;for(var M=o.filter(function(X){return $(X,T)===0}),z=T,L=function(j){if(M=M.filter(function(ne){return $(ne,j)===0}),!M.length)return z=j,1},W=T;W>=0&&!L(W);W-=1);for(var U=o.filter(function(X){return $(X,A)!==1}),V=A,H=function(j){if(U=U.filter(function(ne){return $(ne,j)!==1}),!U.length)return V=Math.max(j-1,A),1},Y=A;Y<w.length&&!H(Y);Y+=1);for(var Q=[],Z=function(j){var ne=w[j];if(!ne)return 1;o.some(function(se){return $(se,j)>1})&&Q.push(j)},pe=z;pe<=V;pe+=1)Z(pe);var oe=Q.map(function(X){var j=w[X],ne=a(j.record,X),se=function(be){var Ie=X+be-1,Ee=a(w[Ie].record,Ie),Se=O(ne,Ee);return Se.bottom-Se.top},ce=O(ne);return S.createElement(Sw,{key:X,data:j,rowKey:ne,index:X,style:{top:-P+ce.top},extra:!0,getHeight:se})});return oe},E=S.useMemo(function(){return{columnsOffset:C}},[C]),N="".concat(c,"-tbody"),k=v(["body","wrapper"]),D={};return p&&(D.position="sticky",D.bottom=0,vn(p)==="object"&&p.offsetScroll&&(D.bottom=p.offsetScroll)),S.createElement(_$.Provider,{value:E},S.createElement(uf,{fullHeight:!1,ref:b,prefixCls:"".concat(N,"-virtual"),styles:{horizontalScrollBar:D},className:N,height:m,itemHeight:g||24,data:w,itemKey:function(R){return a(R.record)},component:k,scrollWidth:d,direction:f,onVirtualScroll:function(R){var T,A=R.x;i({currentTarget:(T=b.current)===null||T===void 0?void 0:T.nativeElement,scrollLeft:A})},onScroll:x,extraRender:I},function(_,R,T){var A=a(_.record,R);return S.createElement(Sw,{data:_,rowKey:A,index:R,style:T.style})}))}),oW=jl(rW),sW=function(e,t){var i=t.ref,r=t.onScroll;return S.createElement(oW,{ref:i,data:e,onScroll:r})};function aW(n,e){var t=n.data,i=n.columns,r=n.scroll,o=n.sticky,s=n.prefixCls,a=s===void 0?T$:s,l=n.className,c=n.listItemHeight,u=n.components,d=n.onScroll,f=r||{},h=f.x,p=f.y;typeof h!="number"&&(h=1),typeof p!="number"&&(p=500);var m=Nr(function(x,b){return fv(u,x)||b}),g=Nr(d),v=S.useMemo(function(){return{sticky:o,scrollY:p,listItemHeight:c,getComponent:m,onScroll:g}},[o,p,c,m,g]);return S.createElement(tx.Provider,{value:v},S.createElement(Xl,ze({},n,{className:ye(l,"".concat(a,"-virtual")),scroll:me(me({},r),{},{x:h}),components:me(me({},u),{},{body:t!=null&&t.length?sW:void 0}),columns:i,internalHooks:cu,tailor:!0,ref:e})))}var lW=S.forwardRef(aW);function A$(n){return v$(lW,n)}A$();const cW=n=>null,uW=n=>null;var nx=S.createContext(null),dW=function(e){for(var t=e.prefixCls,i=e.level,r=e.isStart,o=e.isEnd,s="".concat(t,"-indent-unit"),a=[],l=0;l<i;l+=1)a.push(S.createElement("span",{key:l,className:ye(s,J(J({},"".concat(s,"-start"),r[l]),"".concat(s,"-end"),o[l]))}));return S.createElement("span",{"aria-hidden":"true",className:"".concat(t,"-indent")},a)};const hW=S.memo(dW);var fW=["eventKey","className","style","dragOver","dragOverGapTop","dragOverGapBottom","isLeaf","isStart","isEnd","expanded","selected","checked","halfChecked","loading","domRef","active","data","onMouseMove","selectable"],Iw="open",$w="close",pW="---",mW=function(n){C1(t,n);var e=S1(t);function t(){var i;lv(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return i=e.call.apply(e,[this].concat(o)),J(_e(i),"state",{dragNodeHighlight:!1}),J(_e(i),"selectHandle",void 0),J(_e(i),"cacheIndent",void 0),J(_e(i),"onSelectorClick",function(a){var l=i.props.context.onNodeClick;l(a,Fn(i.props)),i.isSelectable()?i.onSelect(a):i.onCheck(a)}),J(_e(i),"onSelectorDoubleClick",function(a){var l=i.props.context.onNodeDoubleClick;l(a,Fn(i.props))}),J(_e(i),"onSelect",function(a){if(!i.isDisabled()){var l=i.props.context.onNodeSelect;l(a,Fn(i.props))}}),J(_e(i),"onCheck",function(a){if(!i.isDisabled()){var l=i.props,c=l.disableCheckbox,u=l.checked,d=i.props.context.onNodeCheck;if(!(!i.isCheckable()||c)){var f=!u;d(a,Fn(i.props),f)}}}),J(_e(i),"onMouseEnter",function(a){var l=i.props.context.onNodeMouseEnter;l(a,Fn(i.props))}),J(_e(i),"onMouseLeave",function(a){var l=i.props.context.onNodeMouseLeave;l(a,Fn(i.props))}),J(_e(i),"onContextMenu",function(a){var l=i.props.context.onNodeContextMenu;l(a,Fn(i.props))}),J(_e(i),"onDragStart",function(a){var l=i.props.context.onNodeDragStart;a.stopPropagation(),i.setState({dragNodeHighlight:!0}),l(a,_e(i));try{a.dataTransfer.setData("text/plain","")}catch{}}),J(_e(i),"onDragEnter",function(a){var l=i.props.context.onNodeDragEnter;a.preventDefault(),a.stopPropagation(),l(a,_e(i))}),J(_e(i),"onDragOver",function(a){var l=i.props.context.onNodeDragOver;a.preventDefault(),a.stopPropagation(),l(a,_e(i))}),J(_e(i),"onDragLeave",function(a){var l=i.props.context.onNodeDragLeave;a.stopPropagation(),l(a,_e(i))}),J(_e(i),"onDragEnd",function(a){var l=i.props.context.onNodeDragEnd;a.stopPropagation(),i.setState({dragNodeHighlight:!1}),l(a,_e(i))}),J(_e(i),"onDrop",function(a){var l=i.props.context.onNodeDrop;a.preventDefault(),a.stopPropagation(),i.setState({dragNodeHighlight:!1}),l(a,_e(i))}),J(_e(i),"onExpand",function(a){var l=i.props,c=l.loading,u=l.context.onNodeExpand;c||u(a,Fn(i.props))}),J(_e(i),"setSelectHandle",function(a){i.selectHandle=a}),J(_e(i),"getNodeState",function(){var a=i.props.expanded;return i.isLeaf()?null:a?Iw:$w}),J(_e(i),"hasChildren",function(){var a=i.props.eventKey,l=i.props.context.keyEntities,c=Ui(l,a)||{},u=c.children;return!!(u||[]).length}),J(_e(i),"isLeaf",function(){var a=i.props,l=a.isLeaf,c=a.loaded,u=i.props.context.loadData,d=i.hasChildren();return l===!1?!1:l||!u&&!d||u&&c&&!d}),J(_e(i),"isDisabled",function(){var a=i.props.disabled,l=i.props.context.disabled;return!!(l||a)}),J(_e(i),"isCheckable",function(){var a=i.props.checkable,l=i.props.context.checkable;return!l||a===!1?!1:l}),J(_e(i),"syncLoadData",function(a){var l=a.expanded,c=a.loading,u=a.loaded,d=i.props.context,f=d.loadData,h=d.onNodeLoad;c||f&&l&&!i.isLeaf()&&!u&&h(Fn(i.props))}),J(_e(i),"isDraggable",function(){var a=i.props,l=a.data,c=a.context.draggable;return!!(c&&(!c.nodeDraggable||c.nodeDraggable(l)))}),J(_e(i),"renderDragHandler",function(){var a=i.props.context,l=a.draggable,c=a.prefixCls;return l!=null&&l.icon?S.createElement("span",{className:"".concat(c,"-draggable-icon")},l.icon):null}),J(_e(i),"renderSwitcherIconDom",function(a){var l=i.props.switcherIcon,c=i.props.context.switcherIcon,u=l||c;return typeof u=="function"?u(me(me({},i.props),{},{isLeaf:a})):u}),J(_e(i),"renderSwitcher",function(){var a=i.props.expanded,l=i.props.context.prefixCls;if(i.isLeaf()){var c=i.renderSwitcherIconDom(!0);return c!==!1?S.createElement("span",{className:ye("".concat(l,"-switcher"),"".concat(l,"-switcher-noop"))},c):null}var u=ye("".concat(l,"-switcher"),"".concat(l,"-switcher_").concat(a?Iw:$w)),d=i.renderSwitcherIconDom(!1);return d!==!1?S.createElement("span",{onClick:i.onExpand,className:u},d):null}),J(_e(i),"renderCheckbox",function(){var a=i.props,l=a.checked,c=a.halfChecked,u=a.disableCheckbox,d=i.props.context.prefixCls,f=i.isDisabled(),h=i.isCheckable();if(!h)return null;var p=typeof h!="boolean"?h:null;return S.createElement("span",{className:ye("".concat(d,"-checkbox"),l&&"".concat(d,"-checkbox-checked"),!l&&c&&"".concat(d,"-checkbox-indeterminate"),(f||u)&&"".concat(d,"-checkbox-disabled")),onClick:i.onCheck},p)}),J(_e(i),"renderIcon",function(){var a=i.props.loading,l=i.props.context.prefixCls;return S.createElement("span",{className:ye("".concat(l,"-iconEle"),"".concat(l,"-icon__").concat(i.getNodeState()||"docu"),a&&"".concat(l,"-icon_loading"))})}),J(_e(i),"renderSelector",function(){var a=i.state.dragNodeHighlight,l=i.props,c=l.title,u=c===void 0?pW:c,d=l.selected,f=l.icon,h=l.loading,p=l.data,m=i.props.context,g=m.prefixCls,v=m.showIcon,x=m.icon,b=m.loadData,w=m.titleRender,y=i.isDisabled(),C="".concat(g,"-node-content-wrapper"),$;if(v){var I=f||x;$=I?S.createElement("span",{className:ye("".concat(g,"-iconEle"),"".concat(g,"-icon__customize"))},typeof I=="function"?I(i.props):I):i.renderIcon()}else b&&h&&($=i.renderIcon());var E;typeof u=="function"?E=u(p):w?E=w(p):E=u;var N=S.createElement("span",{className:"".concat(g,"-title")},E);return S.createElement("span",{ref:i.setSelectHandle,title:typeof u=="string"?u:"",className:ye("".concat(C),"".concat(C,"-").concat(i.getNodeState()||"normal"),!y&&(d||a)&&"".concat(g,"-node-selected")),onMouseEnter:i.onMouseEnter,onMouseLeave:i.onMouseLeave,onContextMenu:i.onContextMenu,onClick:i.onSelectorClick,onDoubleClick:i.onSelectorDoubleClick},$,N,i.renderDropIndicator())}),J(_e(i),"renderDropIndicator",function(){var a=i.props,l=a.disabled,c=a.eventKey,u=i.props.context,d=u.draggable,f=u.dropLevelOffset,h=u.dropPosition,p=u.prefixCls,m=u.indent,g=u.dropIndicatorRender,v=u.dragOverNodeKey,x=u.direction,b=!!d,w=!l&&b&&v===c,y=m??i.cacheIndent;return i.cacheIndent=m,w?g({dropPosition:h,dropLevelOffset:f,indent:y,prefixCls:p,direction:x}):null}),i}return av(t,[{key:"componentDidMount",value:function(){this.syncLoadData(this.props)}},{key:"componentDidUpdate",value:function(){this.syncLoadData(this.props)}},{key:"isSelectable",value:function(){var r=this.props.selectable,o=this.props.context.selectable;return typeof r=="boolean"?r:o}},{key:"render",value:function(){var r,o=this.props,s=o.eventKey,a=o.className,l=o.style,c=o.dragOver,u=o.dragOverGapTop,d=o.dragOverGapBottom,f=o.isLeaf,h=o.isStart,p=o.isEnd,m=o.expanded,g=o.selected,v=o.checked,x=o.halfChecked,b=o.loading,w=o.domRef,y=o.active;o.data;var C=o.onMouseMove,$=o.selectable,I=En(o,fW),E=this.props.context,N=E.prefixCls,k=E.filterTreeNode,D=E.keyEntities,_=E.dropContainerKey,R=E.dropTargetKey,T=E.draggingNodeKey,A=this.isDisabled(),O=Co(I,{aria:!0,data:!0}),P=Ui(D,s)||{},M=P.level,z=p[p.length-1],L=this.isDraggable(),W=!A&&L,U=T===s,V=$!==void 0?{"aria-selected":!!$}:void 0;return S.createElement("div",ze({ref:w,className:ye(a,"".concat(N,"-treenode"),(r={},J(J(J(J(J(J(J(J(J(J(r,"".concat(N,"-treenode-disabled"),A),"".concat(N,"-treenode-switcher-").concat(m?"open":"close"),!f),"".concat(N,"-treenode-checkbox-checked"),v),"".concat(N,"-treenode-checkbox-indeterminate"),x),"".concat(N,"-treenode-selected"),g),"".concat(N,"-treenode-loading"),b),"".concat(N,"-treenode-active"),y),"".concat(N,"-treenode-leaf-last"),z),"".concat(N,"-treenode-draggable"),L),"dragging",U),J(J(J(J(J(J(r,"drop-target",R===s),"drop-container",_===s),"drag-over",!A&&c),"drag-over-gap-top",!A&&u),"drag-over-gap-bottom",!A&&d),"filter-node",k&&k(Fn(this.props))))),style:l,draggable:W,"aria-grabbed":U,onDragStart:W?this.onDragStart:void 0,onDragEnter:L?this.onDragEnter:void 0,onDragOver:L?this.onDragOver:void 0,onDragLeave:L?this.onDragLeave:void 0,onDrop:L?this.onDrop:void 0,onDragEnd:L?this.onDragEnd:void 0,onMouseMove:C},V,O),S.createElement(hW,{prefixCls:N,level:M,isStart:h,isEnd:p}),this.renderDragHandler(),this.renderSwitcher(),this.renderCheckbox(),this.renderSelector())}}]),t}(S.Component),El=function(e){return S.createElement(nx.Consumer,null,function(t){return S.createElement(mW,ze({},e,{context:t}))})};El.displayName="TreeNode";El.isTreeNode=1;function io(n,e){if(!n)return[];var t=n.slice(),i=t.indexOf(e);return i>=0&&t.splice(i,1),t}function _o(n,e){var t=(n||[]).slice();return t.indexOf(e)===-1&&t.push(e),t}function ix(n){return n.split("-")}function gW(n,e){var t=[],i=Ui(e,n);function r(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];o.forEach(function(s){var a=s.key,l=s.children;t.push(a),r(l)})}return r(i.children),t}function vW(n){if(n.parent){var e=ix(n.pos);return Number(e[e.length-1])===n.parent.children.length-1}return!1}function xW(n){var e=ix(n.pos);return Number(e[e.length-1])===0}function Ew(n,e,t,i,r,o,s,a,l,c){var u,d=n.clientX,f=n.clientY,h=n.target.getBoundingClientRect(),p=h.top,m=h.height,g=(c==="rtl"?-1:1)*(((r==null?void 0:r.x)||0)-d),v=(g-12)/i,x=l.filter(function(A){var O;return(O=a[A])===null||O===void 0||(O=O.children)===null||O===void 0?void 0:O.length}),b=Ui(a,t.props.eventKey);if(f<p+m/2){var w=s.findIndex(function(A){return A.key===b.key}),y=w<=0?0:w-1,C=s[y].key;b=Ui(a,C)}var $=b.key,I=b,E=b.key,N=0,k=0;if(!x.includes($))for(var D=0;D<v&&vW(b);D+=1)b=b.parent,k+=1;var _=e.props.data,R=b.node,T=!0;return xW(b)&&b.level===0&&f<p+m/2&&o({dragNode:_,dropNode:R,dropPosition:-1})&&b.key===t.props.eventKey?N=-1:(I.children||[]).length&&x.includes(E)?o({dragNode:_,dropNode:R,dropPosition:0})?N=0:T=!1:k===0?v>-1.5?o({dragNode:_,dropNode:R,dropPosition:1})?N=1:T=!1:o({dragNode:_,dropNode:R,dropPosition:0})?N=0:o({dragNode:_,dropNode:R,dropPosition:1})?N=1:T=!1:o({dragNode:_,dropNode:R,dropPosition:1})?N=1:T=!1,{dropPosition:N,dropLevelOffset:k,dropTargetKey:b.key,dropTargetPos:b.pos,dragOverNodeKey:E,dropContainerKey:N===0?null:((u=b.parent)===null||u===void 0?void 0:u.key)||null,dropAllowed:T}}function Nw(n,e){if(n){var t=e.multiple;return t?n.slice():n.length?[n[0]]:n}}function fm(n){if(!n)return null;var e;if(Array.isArray(n))e={checkedKeys:n,halfCheckedKeys:void 0};else if(vn(n)==="object")e={checkedKeys:n.checked||void 0,halfCheckedKeys:n.halfChecked||void 0};else return Fo(!1,"`checkedKeys` is not an array or an object"),null;return e}function og(n,e){var t=new Set;function i(r){if(!t.has(r)){var o=Ui(e,r);if(o){t.add(r);var s=o.parent,a=o.node;a.disabled||s&&i(s.key)}}}return(n||[]).forEach(function(r){i(r)}),nt(t)}function bW(n){const[e,t]=S.useState(null);return[S.useCallback((o,s,a)=>{const l=e??o,c=Math.min(l||0,o),u=Math.max(l||0,o),d=s.slice(c,u+1).map(p=>n(p)),f=d.some(p=>!a.has(p)),h=[];return d.forEach(p=>{f?(a.has(p)||h.push(p),a.add(p)):(a.delete(p),h.push(p))}),t(f?u:null),h},[e]),o=>{t(o)}]}const rs={},sg="SELECT_ALL",ag="SELECT_INVERT",lg="SELECT_NONE",kw=[],O$=(n,e)=>{let t=[];return(e||[]).forEach(i=>{t.push(i),i&&typeof i=="object"&&n in i&&(t=[].concat(nt(t),nt(O$(n,i[n]))))}),t},yW=(n,e)=>{const{preserveSelectedRowKeys:t,selectedRowKeys:i,defaultSelectedRowKeys:r,getCheckboxProps:o,onChange:s,onSelect:a,onSelectAll:l,onSelectInvert:c,onSelectNone:u,onSelectMultiple:d,columnWidth:f,type:h,selections:p,fixed:m,renderCell:g,hideSelectAll:v,checkStrictly:x=!0}=e||{},{prefixCls:b,data:w,pageData:y,getRecordByKey:C,getRowKey:$,expandType:I,childrenColumnName:E,locale:N,getPopupContainer:k}=n,D=pv(),[_,R]=bW(X=>X),[T,A]=Vo(i||r||kw,{value:i}),O=S.useRef(new Map),P=S.useCallback(X=>{if(t){const j=new Map;X.forEach(ne=>{let se=C(ne);!se&&O.current.has(ne)&&(se=O.current.get(ne)),j.set(ne,se)}),O.current=j}},[C,t]);S.useEffect(()=>{P(T)},[T]);const M=S.useMemo(()=>O$(E,y),[E,y]),{keyEntities:z}=S.useMemo(()=>{if(x)return{keyEntities:null};let X=w;if(t){const j=new Set(M.map((se,ce)=>$(se,ce))),ne=Array.from(O.current).reduce((se,ce)=>{let[re,be]=ce;return j.has(re)?se:se.concat(be)},[]);X=[].concat(nt(X),nt(ne))}return Xv(X,{externalGetKey:$,childrenPropName:E})},[w,$,x,E,t,M]),L=S.useMemo(()=>{const X=new Map;return M.forEach((j,ne)=>{const se=$(j,ne),ce=(o?o(j):null)||{};X.set(se,ce)}),X},[M,$,o]),W=S.useCallback(X=>{var j;return!!(!((j=L.get($(X)))===null||j===void 0)&&j.disabled)},[L,$]),[U,V]=S.useMemo(()=>{if(x)return[T||[],[]];const{checkedKeys:X,halfCheckedKeys:j}=ol(T,!0,z,W);return[X||[],j]},[T,x,z,W]),H=S.useMemo(()=>{const X=h==="radio"?U.slice(0,1):U;return new Set(X)},[U,h]),Y=S.useMemo(()=>h==="radio"?new Set:new Set(V),[V,h]);S.useEffect(()=>{e||A(kw)},[!!e]);const Q=S.useCallback((X,j)=>{let ne,se;P(X),t?(ne=X,se=X.map(ce=>O.current.get(ce))):(ne=[],se=[],X.forEach(ce=>{const re=C(ce);re!==void 0&&(ne.push(ce),se.push(re))})),A(ne),s==null||s(ne,se,{type:j})},[A,C,s,t]),Z=S.useCallback((X,j,ne,se)=>{if(a){const ce=ne.map(re=>C(re));a(C(X),j,ce,se)}Q(ne,"single")},[a,C,Q]),pe=S.useMemo(()=>!p||v?null:(p===!0?[sg,ag,lg]:p).map(j=>j===sg?{key:"all",text:N.selectionAll,onSelect(){Q(w.map((ne,se)=>$(ne,se)).filter(ne=>{const se=L.get(ne);return!(se!=null&&se.disabled)||H.has(ne)}),"all")}}:j===ag?{key:"invert",text:N.selectInvert,onSelect(){const ne=new Set(H);y.forEach((ce,re)=>{const be=$(ce,re),Ie=L.get(be);Ie!=null&&Ie.disabled||(ne.has(be)?ne.delete(be):ne.add(be))});const se=Array.from(ne);c&&(D.deprecated(!1,"onSelectInvert","onChange"),c(se)),Q(se,"invert")}}:j===lg?{key:"none",text:N.selectNone,onSelect(){u==null||u(),Q(Array.from(H).filter(ne=>{const se=L.get(ne);return se==null?void 0:se.disabled}),"none")}}:j).map(j=>Object.assign(Object.assign({},j),{onSelect:function(){for(var ne,se,ce=arguments.length,re=new Array(ce),be=0;be<ce;be++)re[be]=arguments[be];(se=j.onSelect)===null||se===void 0||(ne=se).call.apply(ne,[j].concat(re)),R(null)}})),[p,H,y,$,c,Q]);return[S.useCallback(X=>{var j;if(!e)return X.filter(Le=>Le!==rs);let ne=nt(X);const se=new Set(H),ce=M.map($).filter(Le=>!L.get(Le).disabled),re=ce.every(Le=>se.has(Le)),be=ce.some(Le=>se.has(Le)),Ie=()=>{const Le=[];re?ce.forEach(ot=>{se.delete(ot),Le.push(ot)}):ce.forEach(ot=>{se.has(ot)||(se.add(ot),Le.push(ot))});const lt=Array.from(se);l==null||l(!re,lt.map(ot=>C(ot)),Le.map(ot=>C(ot))),Q(lt,"all"),R(null)};let Ee,Se;if(h!=="radio"){let Le;if(pe){const Ke={getPopupContainer:k,items:pe.map((Lt,Nt)=>{const{key:Dt,text:kt,onSelect:_n}=Lt;return{key:Dt??Nt,onClick:()=>{_n==null||_n(ce)},label:kt}})};Le=S.createElement("div",{className:`${b}-selection-extra`},S.createElement(I1,{menu:Ke,getPopupContainer:k},S.createElement("span",null,S.createElement(UI,null))))}const lt=M.map((Ke,Lt)=>{const Nt=$(Ke,Lt),Dt=L.get(Nt)||{};return Object.assign({checked:se.has(Nt)},Dt)}).filter(Ke=>{let{disabled:Lt}=Ke;return Lt}),ot=!!lt.length&&lt.length===M.length,Me=ot&&lt.every(Ke=>{let{checked:Lt}=Ke;return Lt}),Fe=ot&&lt.some(Ke=>{let{checked:Lt}=Ke;return Lt});Se=S.createElement($l,{checked:ot?Me:!!M.length&&re,indeterminate:ot?!Me&&Fe:!re&&be,onChange:Ie,disabled:M.length===0||ot,"aria-label":Le?"Custom selection":"Select all",skipGroup:!0}),Ee=!v&&S.createElement("div",{className:`${b}-selection`},Se,Le)}let fe;h==="radio"?fe=(Le,lt,ot)=>{const Me=$(lt,ot),Fe=se.has(Me);return{node:S.createElement(k1,Object.assign({},L.get(Me),{checked:Fe,onClick:Ke=>Ke.stopPropagation(),onChange:Ke=>{se.has(Me)||Z(Me,!0,[Me],Ke.nativeEvent)}})),checked:Fe}}:fe=(Le,lt,ot)=>{var Me;const Fe=$(lt,ot),Ke=se.has(Fe),Lt=Y.has(Fe),Nt=L.get(Fe);let Dt;return I==="nest"?Dt=Lt:Dt=(Me=Nt==null?void 0:Nt.indeterminate)!==null&&Me!==void 0?Me:Lt,{node:S.createElement($l,Object.assign({},Nt,{indeterminate:Dt,checked:Ke,skipGroup:!0,onClick:kt=>kt.stopPropagation(),onChange:kt=>{let{nativeEvent:_n}=kt;const{shiftKey:oi}=_n,zt=ce.findIndex(on=>on===Fe),yi=U.some(on=>ce.includes(on));if(oi&&x&&yi){const on=_(zt,ce,se),bn=Array.from(se);d==null||d(!Ke,bn.map(Zt=>C(Zt)),on.map(Zt=>C(Zt))),Q(bn,"multiple")}else{const on=U;if(x){const bn=Ke?io(on,Fe):_o(on,Fe);Z(Fe,!Ke,bn,_n)}else{const bn=ol([].concat(nt(on),[Fe]),!0,z,W),{checkedKeys:Zt,halfCheckedKeys:Un}=bn;let Yt=Zt;if(Ke){const xt=new Set(Zt);xt.delete(Fe),Yt=ol(Array.from(xt),{checked:!1,halfCheckedKeys:Un},z,W).checkedKeys}Z(Fe,!Ke,Yt,_n)}}R(Ke?null:zt)}})),checked:Ke}};const ge=(Le,lt,ot)=>{const{node:Me,checked:Fe}=fe(Le,lt,ot);return g?g(Fe,lt,ot,Me):Me};if(!ne.includes(rs))if(ne.findIndex(Le=>{var lt;return((lt=Le[Rc])===null||lt===void 0?void 0:lt.columnType)==="EXPAND_COLUMN"})===0){const[Le,...lt]=ne;ne=[Le,rs].concat(nt(lt))}else ne=[rs].concat(nt(ne));const we=ne.indexOf(rs);ne=ne.filter((Le,lt)=>Le!==rs||lt===we);const ve=ne[we-1],Ne=ne[we+1];let Ae=m;Ae===void 0&&((Ne==null?void 0:Ne.fixed)!==void 0?Ae=Ne.fixed:(ve==null?void 0:ve.fixed)!==void 0&&(Ae=ve.fixed)),Ae&&ve&&((j=ve[Rc])===null||j===void 0?void 0:j.columnType)==="EXPAND_COLUMN"&&ve.fixed===void 0&&(ve.fixed=Ae);const Ve=ye(`${b}-selection-col`,{[`${b}-selection-col-with-dropdown`]:p&&h==="checkbox"}),Ue=()=>e!=null&&e.columnTitle?typeof e.columnTitle=="function"?e.columnTitle(Se):e.columnTitle:Ee,We={fixed:Ae,width:f,className:`${b}-selection-column`,title:Ue(),render:ge,onCell:e.onCell,[Rc]:{className:Ve}};return ne.map(Le=>Le===rs?We:Le)},[$,M,e,U,H,Y,f,pe,I,L,d,Z,W]),H]};function wW(n,e){return n._antProxy=n._antProxy||{},Object.keys(e).forEach(t=>{if(!(t in n._antProxy)){const i=n[t];n._antProxy[t]=i,n[t]=e[t]}}),n}function CW(n,e){return S.useImperativeHandle(n,()=>{const t=e(),{nativeElement:i}=t;return typeof Proxy<"u"?new Proxy(i,{get(r,o){return t[o]?t[o]:Reflect.get(r,o)}}):wW(i,t)})}function SW(n){return e=>{const{prefixCls:t,onExpand:i,record:r,expanded:o,expandable:s}=e,a=`${t}-row-expand-icon`;return S.createElement("button",{type:"button",onClick:l=>{i(r,l),l.stopPropagation()},className:ye(a,{[`${a}-spaced`]:!s,[`${a}-expanded`]:s&&o,[`${a}-collapsed`]:s&&!o}),"aria-label":o?n.collapse:n.expand,"aria-expanded":o})}}function IW(n){return(t,i)=>{const r=t.querySelector(`.${n}-container`);let o=i;if(r){const s=getComputedStyle(r),a=parseInt(s.borderLeftWidth,10),l=parseInt(s.borderRightWidth,10);o=i-a-l}return o}}const ys=(n,e)=>"key"in n&&n.key!==void 0&&n.key!==null?n.key:n.dataIndex?Array.isArray(n.dataIndex)?n.dataIndex.join("."):n.dataIndex:e;function ql(n,e){return e?`${e}-${n}`:`${n}`}const gf=(n,e)=>typeof n=="function"?n(e):n,$W=(n,e)=>{const t=gf(n,e);return Object.prototype.toString.call(t)==="[object Object]"?"":t};function EW(n){const e=S.useRef(n),t=xA();return[()=>e.current,i=>{e.current=i,t()}]}function NW(n){var e=n.dropPosition,t=n.dropLevelOffset,i=n.indent,r={pointerEvents:"none",position:"absolute",right:0,backgroundColor:"red",height:2};switch(e){case-1:r.top=0,r.left=-t*i;break;case 1:r.bottom=0,r.left=-t*i;break;case 0:r.bottom=0,r.left=i;break}return S.createElement("div",{style:r})}function P$(n){if(n==null)throw new TypeError("Cannot destructure "+n)}function kW(n,e){var t=S.useState(!1),i=ke(t,2),r=i[0],o=i[1];Yi(function(){if(r)return n(),function(){e()}},[r]),Yi(function(){return o(!0),function(){o(!1)}},[])}var DW=["className","style","motion","motionNodes","motionType","onMotionStart","onMotionEnd","active","treeNodeRequiredProps"],M$=function(e,t){var i=e.className,r=e.style,o=e.motion,s=e.motionNodes,a=e.motionType,l=e.onMotionStart,c=e.onMotionEnd,u=e.active,d=e.treeNodeRequiredProps,f=En(e,DW),h=S.useState(!0),p=ke(h,2),m=p[0],g=p[1],v=S.useContext(nx),x=v.prefixCls,b=s&&a!=="hide";Yi(function(){s&&b!==m&&g(b)},[s]);var w=function(){s&&l()},y=S.useRef(!1),C=function(){s&&!y.current&&(y.current=!0,c())};kW(w,C);var $=function(E){b===E&&C()};return s?S.createElement(Y_,ze({ref:t,visible:m},o,{motionAppear:a==="show",onVisibleChanged:$}),function(I,E){var N=I.className,k=I.style;return S.createElement("div",{ref:E,className:ye("".concat(x,"-treenode-motion"),N),style:k},s.map(function(D){var _=Object.assign({},(P$(D.data),D.data)),R=D.title,T=D.key,A=D.isStart,O=D.isEnd;delete _.children;var P=Tc(T,d);return S.createElement(El,ze({},_,P,{title:R,active:u,data:D.data,key:T,isStart:A,isEnd:O}))}))}):S.createElement(El,ze({domRef:t,className:i,style:r},f,{active:u}))};M$.displayName="MotionTreeNode";var TW=S.forwardRef(M$);function RW(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=n.length,i=e.length;if(Math.abs(t-i)!==1)return{add:!1,key:null};function r(o,s){var a=new Map;o.forEach(function(c){a.set(c,!0)});var l=s.filter(function(c){return!a.has(c)});return l.length===1?l[0]:null}return t<i?{add:!0,key:r(n,e)}:{add:!1,key:r(e,n)}}function Dw(n,e,t){var i=n.findIndex(function(a){return a.key===t}),r=n[i+1],o=e.findIndex(function(a){return a.key===t});if(r){var s=e.findIndex(function(a){return a.key===r.key});return e.slice(o+1,s)}return e.slice(o+1)}var _W=["prefixCls","data","selectable","checkable","expandedKeys","selectedKeys","checkedKeys","loadedKeys","loadingKeys","halfCheckedKeys","keyEntities","disabled","dragging","dragOverNodeKey","dropPosition","motion","height","itemHeight","virtual","focusable","activeItem","focused","tabIndex","onKeyDown","onFocus","onBlur","onActiveChange","onListChangeStart","onListChangeEnd"],Tw={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},AW=function(){},da="RC_TREE_MOTION_".concat(Math.random()),cg={key:da},F$={key:da,level:0,index:0,pos:"0",node:cg,nodes:[cg]},Rw={parent:null,children:[],pos:F$.pos,data:cg,title:null,key:da,isStart:[],isEnd:[]};function _w(n,e,t,i){return e===!1||!t?n:n.slice(0,Math.ceil(t/i)+1)}function Aw(n){var e=n.key,t=n.pos;return lu(e,t)}function OW(n){for(var e=String(n.data.key),t=n;t.parent;)t=t.parent,e="".concat(t.data.key," > ").concat(e);return e}var L$=S.forwardRef(function(n,e){var t=n.prefixCls,i=n.data;n.selectable,n.checkable;var r=n.expandedKeys,o=n.selectedKeys,s=n.checkedKeys,a=n.loadedKeys,l=n.loadingKeys,c=n.halfCheckedKeys,u=n.keyEntities,d=n.disabled,f=n.dragging,h=n.dragOverNodeKey,p=n.dropPosition,m=n.motion,g=n.height,v=n.itemHeight,x=n.virtual,b=n.focusable,w=n.activeItem,y=n.focused,C=n.tabIndex,$=n.onKeyDown,I=n.onFocus,E=n.onBlur,N=n.onActiveChange,k=n.onListChangeStart,D=n.onListChangeEnd,_=En(n,_W),R=S.useRef(null),T=S.useRef(null);S.useImperativeHandle(e,function(){return{scrollTo:function(fe){R.current.scrollTo(fe)},getIndentWidth:function(){return T.current.offsetWidth}}});var A=S.useState(r),O=ke(A,2),P=O[0],M=O[1],z=S.useState(i),L=ke(z,2),W=L[0],U=L[1],V=S.useState(i),H=ke(V,2),Y=H[0],Q=H[1],Z=S.useState([]),pe=ke(Z,2),oe=pe[0],X=pe[1],j=S.useState(null),ne=ke(j,2),se=ne[0],ce=ne[1],re=S.useRef(i);re.current=i;function be(){var Se=re.current;U(Se),Q(Se),X([]),ce(null),D()}Yi(function(){M(r);var Se=RW(P,r);if(Se.key!==null)if(Se.add){var fe=W.findIndex(function(Ve){var Ue=Ve.key;return Ue===Se.key}),ge=_w(Dw(W,i,Se.key),x,g,v),we=W.slice();we.splice(fe+1,0,Rw),Q(we),X(ge),ce("show")}else{var ve=i.findIndex(function(Ve){var Ue=Ve.key;return Ue===Se.key}),Ne=_w(Dw(i,W,Se.key),x,g,v),Ae=i.slice();Ae.splice(ve+1,0,Rw),Q(Ae),X(Ne),ce("hide")}else W!==i&&(U(i),Q(i))},[r,i]),S.useEffect(function(){f||be()},[f]);var Ie=m?Y:i,Ee={expandedKeys:r,selectedKeys:o,loadedKeys:a,loadingKeys:l,checkedKeys:s,halfCheckedKeys:c,dragOverNodeKey:h,dropPosition:p,keyEntities:u};return S.createElement(S.Fragment,null,y&&w&&S.createElement("span",{style:Tw,"aria-live":"assertive"},OW(w)),S.createElement("div",null,S.createElement("input",{style:Tw,disabled:b===!1||d,tabIndex:b!==!1?C:null,onKeyDown:$,onFocus:I,onBlur:E,value:"",onChange:AW,"aria-label":"for screen reader"})),S.createElement("div",{className:"".concat(t,"-treenode"),"aria-hidden":!0,style:{position:"absolute",pointerEvents:"none",visibility:"hidden",height:0,overflow:"hidden",border:0,padding:0}},S.createElement("div",{className:"".concat(t,"-indent")},S.createElement("div",{ref:T,className:"".concat(t,"-indent-unit")}))),S.createElement(uf,ze({},_,{data:Ie,itemKey:Aw,height:g,fullHeight:!1,virtual:x,itemHeight:v,prefixCls:"".concat(t,"-list"),ref:R,onVisibleChange:function(fe){fe.every(function(ge){return Aw(ge)!==da})&&be()}}),function(Se){var fe=Se.pos,ge=Object.assign({},(P$(Se.data),Se.data)),we=Se.title,ve=Se.key,Ne=Se.isStart,Ae=Se.isEnd,Ve=lu(ve,fe);delete ge.key,delete ge.children;var Ue=Tc(Ve,Ee);return S.createElement(TW,ze({},ge,Ue,{title:we,active:!!w&&ve===w.key,pos:fe,data:Se.data,isStart:Ne,isEnd:Ae,motion:m,motionNodes:ve===da?oe:null,motionType:se,onMotionStart:k,onMotionEnd:be,treeNodeRequiredProps:Ee,onMouseMove:function(){N(null)}}))}))});L$.displayName="NodeList";var PW=10,rx=function(n){C1(t,n);var e=S1(t);function t(){var i;lv(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return i=e.call.apply(e,[this].concat(o)),J(_e(i),"destroyed",!1),J(_e(i),"delayedDragEnterLogic",void 0),J(_e(i),"loadingRetryTimes",{}),J(_e(i),"state",{keyEntities:{},indent:null,selectedKeys:[],checkedKeys:[],halfCheckedKeys:[],loadedKeys:[],loadingKeys:[],expandedKeys:[],draggingNodeKey:null,dragChildrenKeys:[],dropTargetKey:null,dropPosition:null,dropContainerKey:null,dropLevelOffset:null,dropTargetPos:null,dropAllowed:!0,dragOverNodeKey:null,treeData:[],flattenNodes:[],focused:!1,activeKey:null,listChanging:!1,prevProps:null,fieldNames:Il()}),J(_e(i),"dragStartMousePosition",null),J(_e(i),"dragNode",void 0),J(_e(i),"currentMouseOverDroppableNodeKey",null),J(_e(i),"listRef",S.createRef()),J(_e(i),"onNodeDragStart",function(a,l){var c=i.state,u=c.expandedKeys,d=c.keyEntities,f=i.props.onDragStart,h=l.props.eventKey;i.dragNode=l,i.dragStartMousePosition={x:a.clientX,y:a.clientY};var p=io(u,h);i.setState({draggingNodeKey:h,dragChildrenKeys:gW(h,d),indent:i.listRef.current.getIndentWidth()}),i.setExpandedKeys(p),window.addEventListener("dragend",i.onWindowDragEnd),f==null||f({event:a,node:Fn(l.props)})}),J(_e(i),"onNodeDragEnter",function(a,l){var c=i.state,u=c.expandedKeys,d=c.keyEntities,f=c.dragChildrenKeys,h=c.flattenNodes,p=c.indent,m=i.props,g=m.onDragEnter,v=m.onExpand,x=m.allowDrop,b=m.direction,w=l.props,y=w.pos,C=w.eventKey,$=_e(i),I=$.dragNode;if(i.currentMouseOverDroppableNodeKey!==C&&(i.currentMouseOverDroppableNodeKey=C),!I){i.resetDragState();return}var E=Ew(a,I,l,p,i.dragStartMousePosition,x,h,d,u,b),N=E.dropPosition,k=E.dropLevelOffset,D=E.dropTargetKey,_=E.dropContainerKey,R=E.dropTargetPos,T=E.dropAllowed,A=E.dragOverNodeKey;if(f.indexOf(D)!==-1||!T){i.resetDragState();return}if(i.delayedDragEnterLogic||(i.delayedDragEnterLogic={}),Object.keys(i.delayedDragEnterLogic).forEach(function(O){clearTimeout(i.delayedDragEnterLogic[O])}),I.props.eventKey!==l.props.eventKey&&(a.persist(),i.delayedDragEnterLogic[y]=window.setTimeout(function(){if(i.state.draggingNodeKey!==null){var O=nt(u),P=Ui(d,l.props.eventKey);P&&(P.children||[]).length&&(O=_o(u,l.props.eventKey)),i.props.hasOwnProperty("expandedKeys")||i.setExpandedKeys(O),v==null||v(O,{node:Fn(l.props),expanded:!0,nativeEvent:a.nativeEvent})}},800)),I.props.eventKey===D&&k===0){i.resetDragState();return}i.setState({dragOverNodeKey:A,dropPosition:N,dropLevelOffset:k,dropTargetKey:D,dropContainerKey:_,dropTargetPos:R,dropAllowed:T}),g==null||g({event:a,node:Fn(l.props),expandedKeys:u})}),J(_e(i),"onNodeDragOver",function(a,l){var c=i.state,u=c.dragChildrenKeys,d=c.flattenNodes,f=c.keyEntities,h=c.expandedKeys,p=c.indent,m=i.props,g=m.onDragOver,v=m.allowDrop,x=m.direction,b=_e(i),w=b.dragNode;if(w){var y=Ew(a,w,l,p,i.dragStartMousePosition,v,d,f,h,x),C=y.dropPosition,$=y.dropLevelOffset,I=y.dropTargetKey,E=y.dropContainerKey,N=y.dropAllowed,k=y.dropTargetPos,D=y.dragOverNodeKey;u.indexOf(I)!==-1||!N||(w.props.eventKey===I&&$===0?i.state.dropPosition===null&&i.state.dropLevelOffset===null&&i.state.dropTargetKey===null&&i.state.dropContainerKey===null&&i.state.dropTargetPos===null&&i.state.dropAllowed===!1&&i.state.dragOverNodeKey===null||i.resetDragState():C===i.state.dropPosition&&$===i.state.dropLevelOffset&&I===i.state.dropTargetKey&&E===i.state.dropContainerKey&&k===i.state.dropTargetPos&&N===i.state.dropAllowed&&D===i.state.dragOverNodeKey||i.setState({dropPosition:C,dropLevelOffset:$,dropTargetKey:I,dropContainerKey:E,dropTargetPos:k,dropAllowed:N,dragOverNodeKey:D}),g==null||g({event:a,node:Fn(l.props)}))}}),J(_e(i),"onNodeDragLeave",function(a,l){i.currentMouseOverDroppableNodeKey===l.props.eventKey&&!a.currentTarget.contains(a.relatedTarget)&&(i.resetDragState(),i.currentMouseOverDroppableNodeKey=null);var c=i.props.onDragLeave;c==null||c({event:a,node:Fn(l.props)})}),J(_e(i),"onWindowDragEnd",function(a){i.onNodeDragEnd(a,null,!0),window.removeEventListener("dragend",i.onWindowDragEnd)}),J(_e(i),"onNodeDragEnd",function(a,l){var c=i.props.onDragEnd;i.setState({dragOverNodeKey:null}),i.cleanDragState(),c==null||c({event:a,node:Fn(l.props)}),i.dragNode=null,window.removeEventListener("dragend",i.onWindowDragEnd)}),J(_e(i),"onNodeDrop",function(a,l){var c,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=i.state,f=d.dragChildrenKeys,h=d.dropPosition,p=d.dropTargetKey,m=d.dropTargetPos,g=d.dropAllowed;if(g){var v=i.props.onDrop;if(i.setState({dragOverNodeKey:null}),i.cleanDragState(),p!==null){var x=me(me({},Tc(p,i.getTreeNodeRequiredProps())),{},{active:((c=i.getActiveItem())===null||c===void 0?void 0:c.key)===p,data:Ui(i.state.keyEntities,p).node}),b=f.indexOf(p)!==-1;Fo(!b,"Can not drop to dragNode's children node. This is a bug of rc-tree. Please report an issue.");var w=ix(m),y={event:a,node:Fn(x),dragNode:i.dragNode?Fn(i.dragNode.props):null,dragNodesKeys:[i.dragNode.props.eventKey].concat(f),dropToGap:h!==0,dropPosition:h+Number(w[w.length-1])};u||v==null||v(y),i.dragNode=null}}}),J(_e(i),"cleanDragState",function(){var a=i.state.draggingNodeKey;a!==null&&i.setState({draggingNodeKey:null,dropPosition:null,dropContainerKey:null,dropTargetKey:null,dropLevelOffset:null,dropAllowed:!0,dragOverNodeKey:null}),i.dragStartMousePosition=null,i.currentMouseOverDroppableNodeKey=null}),J(_e(i),"triggerExpandActionExpand",function(a,l){var c=i.state,u=c.expandedKeys,d=c.flattenNodes,f=l.expanded,h=l.key,p=l.isLeaf;if(!(p||a.shiftKey||a.metaKey||a.ctrlKey)){var m=d.filter(function(v){return v.key===h})[0],g=Fn(me(me({},Tc(h,i.getTreeNodeRequiredProps())),{},{data:m.data}));i.setExpandedKeys(f?io(u,h):_o(u,h)),i.onNodeExpand(a,g)}}),J(_e(i),"onNodeClick",function(a,l){var c=i.props,u=c.onClick,d=c.expandAction;d==="click"&&i.triggerExpandActionExpand(a,l),u==null||u(a,l)}),J(_e(i),"onNodeDoubleClick",function(a,l){var c=i.props,u=c.onDoubleClick,d=c.expandAction;d==="doubleClick"&&i.triggerExpandActionExpand(a,l),u==null||u(a,l)}),J(_e(i),"onNodeSelect",function(a,l){var c=i.state.selectedKeys,u=i.state,d=u.keyEntities,f=u.fieldNames,h=i.props,p=h.onSelect,m=h.multiple,g=l.selected,v=l[f.key],x=!g;x?m?c=_o(c,v):c=[v]:c=io(c,v);var b=c.map(function(w){var y=Ui(d,w);return y?y.node:null}).filter(function(w){return w});i.setUncontrolledState({selectedKeys:c}),p==null||p(c,{event:"select",selected:x,node:l,selectedNodes:b,nativeEvent:a.nativeEvent})}),J(_e(i),"onNodeCheck",function(a,l,c){var u=i.state,d=u.keyEntities,f=u.checkedKeys,h=u.halfCheckedKeys,p=i.props,m=p.checkStrictly,g=p.onCheck,v=l.key,x,b={event:"check",node:l,checked:c,nativeEvent:a.nativeEvent};if(m){var w=c?_o(f,v):io(f,v),y=io(h,v);x={checked:w,halfChecked:y},b.checkedNodes=w.map(function(k){return Ui(d,k)}).filter(function(k){return k}).map(function(k){return k.node}),i.setUncontrolledState({checkedKeys:w})}else{var C=ol([].concat(nt(f),[v]),!0,d),$=C.checkedKeys,I=C.halfCheckedKeys;if(!c){var E=new Set($);E.delete(v);var N=ol(Array.from(E),{checked:!1,halfCheckedKeys:I},d);$=N.checkedKeys,I=N.halfCheckedKeys}x=$,b.checkedNodes=[],b.checkedNodesPositions=[],b.halfCheckedKeys=I,$.forEach(function(k){var D=Ui(d,k);if(D){var _=D.node,R=D.pos;b.checkedNodes.push(_),b.checkedNodesPositions.push({node:_,pos:R})}}),i.setUncontrolledState({checkedKeys:$},!1,{halfCheckedKeys:I})}g==null||g(x,b)}),J(_e(i),"onNodeLoad",function(a){var l,c=a.key,u=i.state.keyEntities,d=Ui(u,c);if(!(d!=null&&(l=d.children)!==null&&l!==void 0&&l.length)){var f=new Promise(function(h,p){i.setState(function(m){var g=m.loadedKeys,v=g===void 0?[]:g,x=m.loadingKeys,b=x===void 0?[]:x,w=i.props,y=w.loadData,C=w.onLoad;if(!y||v.indexOf(c)!==-1||b.indexOf(c)!==-1)return null;var $=y(a);return $.then(function(){var I=i.state.loadedKeys,E=_o(I,c);C==null||C(E,{event:"load",node:a}),i.setUncontrolledState({loadedKeys:E}),i.setState(function(N){return{loadingKeys:io(N.loadingKeys,c)}}),h()}).catch(function(I){if(i.setState(function(N){return{loadingKeys:io(N.loadingKeys,c)}}),i.loadingRetryTimes[c]=(i.loadingRetryTimes[c]||0)+1,i.loadingRetryTimes[c]>=PW){var E=i.state.loadedKeys;Fo(!1,"Retry for `loadData` many times but still failed. No more retry."),i.setUncontrolledState({loadedKeys:_o(E,c)}),h()}p(I)}),{loadingKeys:_o(b,c)}})});return f.catch(function(){}),f}}),J(_e(i),"onNodeMouseEnter",function(a,l){var c=i.props.onMouseEnter;c==null||c({event:a,node:l})}),J(_e(i),"onNodeMouseLeave",function(a,l){var c=i.props.onMouseLeave;c==null||c({event:a,node:l})}),J(_e(i),"onNodeContextMenu",function(a,l){var c=i.props.onRightClick;c&&(a.preventDefault(),c({event:a,node:l}))}),J(_e(i),"onFocus",function(){var a=i.props.onFocus;i.setState({focused:!0});for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];a==null||a.apply(void 0,c)}),J(_e(i),"onBlur",function(){var a=i.props.onBlur;i.setState({focused:!1}),i.onActiveChange(null);for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];a==null||a.apply(void 0,c)}),J(_e(i),"getTreeNodeRequiredProps",function(){var a=i.state,l=a.expandedKeys,c=a.selectedKeys,u=a.loadedKeys,d=a.loadingKeys,f=a.checkedKeys,h=a.halfCheckedKeys,p=a.dragOverNodeKey,m=a.dropPosition,g=a.keyEntities;return{expandedKeys:l||[],selectedKeys:c||[],loadedKeys:u||[],loadingKeys:d||[],checkedKeys:f||[],halfCheckedKeys:h||[],dragOverNodeKey:p,dropPosition:m,keyEntities:g}}),J(_e(i),"setExpandedKeys",function(a){var l=i.state,c=l.treeData,u=l.fieldNames,d=lm(c,a,u);i.setUncontrolledState({expandedKeys:a,flattenNodes:d},!0)}),J(_e(i),"onNodeExpand",function(a,l){var c=i.state.expandedKeys,u=i.state,d=u.listChanging,f=u.fieldNames,h=i.props,p=h.onExpand,m=h.loadData,g=l.expanded,v=l[f.key];if(!d){var x=c.indexOf(v),b=!g;if(Fo(g&&x!==-1||!g&&x===-1,"Expand state not sync with index check"),b?c=_o(c,v):c=io(c,v),i.setExpandedKeys(c),p==null||p(c,{node:l,expanded:b,nativeEvent:a.nativeEvent}),b&&m){var w=i.onNodeLoad(l);w&&w.then(function(){var y=lm(i.state.treeData,c,f);i.setUncontrolledState({flattenNodes:y})}).catch(function(){var y=i.state.expandedKeys,C=io(y,v);i.setExpandedKeys(C)})}}}),J(_e(i),"onListChangeStart",function(){i.setUncontrolledState({listChanging:!0})}),J(_e(i),"onListChangeEnd",function(){setTimeout(function(){i.setUncontrolledState({listChanging:!1})})}),J(_e(i),"onActiveChange",function(a){var l=i.state.activeKey,c=i.props,u=c.onActiveChange,d=c.itemScrollOffset,f=d===void 0?0:d;l!==a&&(i.setState({activeKey:a}),a!==null&&i.scrollTo({key:a,offset:f}),u==null||u(a))}),J(_e(i),"getActiveItem",function(){var a=i.state,l=a.activeKey,c=a.flattenNodes;return l===null?null:c.find(function(u){var d=u.key;return d===l})||null}),J(_e(i),"offsetActiveKey",function(a){var l=i.state,c=l.flattenNodes,u=l.activeKey,d=c.findIndex(function(p){var m=p.key;return m===u});d===-1&&a<0&&(d=c.length),d=(d+a+c.length)%c.length;var f=c[d];if(f){var h=f.key;i.onActiveChange(h)}else i.onActiveChange(null)}),J(_e(i),"onKeyDown",function(a){var l=i.state,c=l.activeKey,u=l.expandedKeys,d=l.checkedKeys,f=l.fieldNames,h=i.props,p=h.onKeyDown,m=h.checkable,g=h.selectable;switch(a.which){case Xe.UP:{i.offsetActiveKey(-1),a.preventDefault();break}case Xe.DOWN:{i.offsetActiveKey(1),a.preventDefault();break}}var v=i.getActiveItem();if(v&&v.data){var x=i.getTreeNodeRequiredProps(),b=v.data.isLeaf===!1||!!(v.data[f.children]||[]).length,w=Fn(me(me({},Tc(c,x)),{},{data:v.data,active:!0}));switch(a.which){case Xe.LEFT:{b&&u.includes(c)?i.onNodeExpand({},w):v.parent&&i.onActiveChange(v.parent.key),a.preventDefault();break}case Xe.RIGHT:{b&&!u.includes(c)?i.onNodeExpand({},w):v.children&&v.children.length&&i.onActiveChange(v.children[0].key),a.preventDefault();break}case Xe.ENTER:case Xe.SPACE:{m&&!w.disabled&&w.checkable!==!1&&!w.disableCheckbox?i.onNodeCheck({},w,!d.includes(c)):!m&&g&&!w.disabled&&w.selectable!==!1&&i.onNodeSelect({},w);break}}}p==null||p(a)}),J(_e(i),"setUncontrolledState",function(a){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!i.destroyed){var u=!1,d=!0,f={};Object.keys(a).forEach(function(h){if(i.props.hasOwnProperty(h)){d=!1;return}u=!0,f[h]=a[h]}),u&&(!l||d)&&i.setState(me(me({},f),c))}}),J(_e(i),"scrollTo",function(a){i.listRef.current.scrollTo(a)}),i}return av(t,[{key:"componentDidMount",value:function(){this.destroyed=!1,this.onUpdated()}},{key:"componentDidUpdate",value:function(){this.onUpdated()}},{key:"onUpdated",value:function(){var r=this.props,o=r.activeKey,s=r.itemScrollOffset,a=s===void 0?0:s;o!==void 0&&o!==this.state.activeKey&&(this.setState({activeKey:o}),o!==null&&this.scrollTo({key:o,offset:a}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("dragend",this.onWindowDragEnd),this.destroyed=!0}},{key:"resetDragState",value:function(){this.setState({dragOverNodeKey:null,dropPosition:null,dropLevelOffset:null,dropTargetKey:null,dropContainerKey:null,dropTargetPos:null,dropAllowed:!1})}},{key:"render",value:function(){var r=this.state,o=r.focused,s=r.flattenNodes,a=r.keyEntities,l=r.draggingNodeKey,c=r.activeKey,u=r.dropLevelOffset,d=r.dropContainerKey,f=r.dropTargetKey,h=r.dropPosition,p=r.dragOverNodeKey,m=r.indent,g=this.props,v=g.prefixCls,x=g.className,b=g.style,w=g.showLine,y=g.focusable,C=g.tabIndex,$=C===void 0?0:C,I=g.selectable,E=g.showIcon,N=g.icon,k=g.switcherIcon,D=g.draggable,_=g.checkable,R=g.checkStrictly,T=g.disabled,A=g.motion,O=g.loadData,P=g.filterTreeNode,M=g.height,z=g.itemHeight,L=g.virtual,W=g.titleRender,U=g.dropIndicatorRender,V=g.onContextMenu,H=g.onScroll,Y=g.direction,Q=g.rootClassName,Z=g.rootStyle,pe=Co(this.props,{aria:!0,data:!0}),oe;return D&&(vn(D)==="object"?oe=D:typeof D=="function"?oe={nodeDraggable:D}:oe={}),S.createElement(nx.Provider,{value:{prefixCls:v,selectable:I,showIcon:E,icon:N,switcherIcon:k,draggable:oe,draggingNodeKey:l,checkable:_,checkStrictly:R,disabled:T,keyEntities:a,dropLevelOffset:u,dropContainerKey:d,dropTargetKey:f,dropPosition:h,dragOverNodeKey:p,indent:m,direction:Y,dropIndicatorRender:U,loadData:O,filterTreeNode:P,titleRender:W,onNodeClick:this.onNodeClick,onNodeDoubleClick:this.onNodeDoubleClick,onNodeExpand:this.onNodeExpand,onNodeSelect:this.onNodeSelect,onNodeCheck:this.onNodeCheck,onNodeLoad:this.onNodeLoad,onNodeMouseEnter:this.onNodeMouseEnter,onNodeMouseLeave:this.onNodeMouseLeave,onNodeContextMenu:this.onNodeContextMenu,onNodeDragStart:this.onNodeDragStart,onNodeDragEnter:this.onNodeDragEnter,onNodeDragOver:this.onNodeDragOver,onNodeDragLeave:this.onNodeDragLeave,onNodeDragEnd:this.onNodeDragEnd,onNodeDrop:this.onNodeDrop}},S.createElement("div",{role:"tree",className:ye(v,x,Q,J(J(J({},"".concat(v,"-show-line"),w),"".concat(v,"-focused"),o),"".concat(v,"-active-focused"),c!==null)),style:Z},S.createElement(L$,ze({ref:this.listRef,prefixCls:v,style:b,data:s,disabled:T,selectable:I,checkable:!!_,motion:A,dragging:l!==null,height:M,itemHeight:z,virtual:L,focusable:y,focused:o,tabIndex:$,activeItem:this.getActiveItem(),onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onActiveChange:this.onActiveChange,onListChangeStart:this.onListChangeStart,onListChangeEnd:this.onListChangeEnd,onContextMenu:V,onScroll:H},this.getTreeNodeRequiredProps(),pe))))}}],[{key:"getDerivedStateFromProps",value:function(r,o){var s=o.prevProps,a={prevProps:r};function l($){return!s&&r.hasOwnProperty($)||s&&s[$]!==r[$]}var c,u=o.fieldNames;if(l("fieldNames")&&(u=Il(r.fieldNames),a.fieldNames=u),l("treeData")?c=r.treeData:l("children")&&(Fo(!1,"`children` of Tree is deprecated. Please use `treeData` instead."),c=YI(r.children)),c){a.treeData=c;var d=Xv(c,{fieldNames:u});a.keyEntities=me(J({},da,F$),d.keyEntities)}var f=a.keyEntities||o.keyEntities;if(l("expandedKeys")||s&&l("autoExpandParent"))a.expandedKeys=r.autoExpandParent||!s&&r.defaultExpandParent?og(r.expandedKeys,f):r.expandedKeys;else if(!s&&r.defaultExpandAll){var h=me({},f);delete h[da];var p=[];Object.keys(h).forEach(function($){var I=h[$];I.children&&I.children.length&&p.push(I.key)}),a.expandedKeys=p}else!s&&r.defaultExpandedKeys&&(a.expandedKeys=r.autoExpandParent||r.defaultExpandParent?og(r.defaultExpandedKeys,f):r.defaultExpandedKeys);if(a.expandedKeys||delete a.expandedKeys,c||a.expandedKeys){var m=lm(c||o.treeData,a.expandedKeys||o.expandedKeys,u);a.flattenNodes=m}if(r.selectable&&(l("selectedKeys")?a.selectedKeys=Nw(r.selectedKeys,r):!s&&r.defaultSelectedKeys&&(a.selectedKeys=Nw(r.defaultSelectedKeys,r))),r.checkable){var g;if(l("checkedKeys")?g=fm(r.checkedKeys)||{}:!s&&r.defaultCheckedKeys?g=fm(r.defaultCheckedKeys)||{}:c&&(g=fm(r.checkedKeys)||{checkedKeys:o.checkedKeys,halfCheckedKeys:o.halfCheckedKeys}),g){var v=g,x=v.checkedKeys,b=x===void 0?[]:x,w=v.halfCheckedKeys,y=w===void 0?[]:w;if(!r.checkStrictly){var C=ol(b,!0,f);b=C.checkedKeys,y=C.halfCheckedKeys}a.checkedKeys=b,a.halfCheckedKeys=y}}return l("loadedKeys")&&(a.loadedKeys=r.loadedKeys),a}}]),t}(S.Component);J(rx,"defaultProps",{prefixCls:"rc-tree",showLine:!1,showIcon:!0,selectable:!0,multiple:!1,checkable:!1,disabled:!1,checkStrictly:!1,draggable:!1,defaultExpandParent:!0,autoExpandParent:!1,defaultExpandAll:!1,defaultExpandedKeys:[],defaultCheckedKeys:[],defaultSelectedKeys:[],dropIndicatorRender:NW,allowDrop:function(){return!0},expandAction:!1});J(rx,"TreeNode",El);const MW=n=>{let{treeCls:e,treeNodeCls:t,directoryNodeSelectedBg:i,directoryNodeSelectedColor:r,motionDurationMid:o,borderRadius:s,controlItemBgHover:a}=n;return{[`${e}${e}-directory ${t}`]:{[`${e}-node-content-wrapper`]:{position:"static",[`> *:not(${e}-drop-indicator)`]:{position:"relative"},"&:hover":{background:"transparent"},"&:before":{position:"absolute",inset:0,transition:`background-color ${o}`,content:'""',borderRadius:s},"&:hover:before":{background:a}},[`${e}-switcher`]:{marginInlineEnd:0},"&-selected":{[`${e}-switcher, ${e}-draggable-icon`]:{color:r,zIndex:1},[`${e}-node-content-wrapper`]:{color:r,background:"transparent","&:before, &:hover:before":{background:i}}}}}},FW=new Z_("ant-tree-node-fx-do-not-use",{"0%":{opacity:0},"100%":{opacity:1}}),LW=(n,e)=>({[`.${n}-switcher-icon`]:{display:"inline-block",fontSize:10,verticalAlign:"baseline",svg:{transition:`transform ${e.motionDurationSlow}`}}}),zW=(n,e)=>({[`.${n}-drop-indicator`]:{position:"absolute",zIndex:1,height:2,backgroundColor:e.colorPrimary,borderRadius:1,pointerEvents:"none","&:after":{position:"absolute",top:-3,insetInlineStart:-6,width:8,height:8,backgroundColor:"transparent",border:`${ue(e.lineWidthBold)} solid ${e.colorPrimary}`,borderRadius:"50%",content:'""'}}}),BW=(n,e)=>{const{treeCls:t,treeNodeCls:i,treeNodePadding:r,titleHeight:o,indentSize:s,nodeSelectedBg:a,nodeHoverBg:l,colorTextQuaternary:c}=e,u=e.marginXXS;return{[t]:Object.assign(Object.assign({},sr(e)),{background:e.colorBgContainer,borderRadius:e.borderRadius,transition:`background-color ${e.motionDurationSlow}`,"&-rtl":{direction:"rtl"},[`&${t}-rtl ${t}-switcher_close ${t}-switcher-icon svg`]:{transform:"rotate(90deg)"},[`&-focused:not(:hover):not(${t}-active-focused)`]:Object.assign({},fh(e)),[`${t}-list-holder-inner`]:{alignItems:"flex-start"},[`&${t}-block-node`]:{[`${t}-list-holder-inner`]:{alignItems:"stretch",[`${t}-node-content-wrapper`]:{flex:"auto"},[`${i}.dragging:after`]:{position:"absolute",inset:0,border:`1px solid ${e.colorPrimary}`,opacity:0,animationName:FW,animationDuration:e.motionDurationSlow,animationPlayState:"running",animationFillMode:"forwards",content:'""',pointerEvents:"none",borderRadius:e.borderRadius}}},[i]:{display:"flex",alignItems:"flex-start",marginBottom:r,lineHeight:ue(o),position:"relative","&:before":{content:'""',position:"absolute",zIndex:1,insetInlineStart:0,width:"100%",top:"100%",height:r},[`&-disabled ${t}-node-content-wrapper`]:{color:e.colorTextDisabled,cursor:"not-allowed","&:hover":{background:"transparent"}},[`&:not(${i}-disabled)`]:{[`${t}-node-content-wrapper`]:{"&:hover":{color:e.nodeHoverColor}}},[`&-active ${t}-node-content-wrapper`]:{background:e.controlItemBgHover},[`&:not(${i}-disabled).filter-node ${t}-title`]:{color:e.colorPrimary,fontWeight:500},"&-draggable":{cursor:"grab",[`${t}-draggable-icon`]:{flexShrink:0,width:o,textAlign:"center",visibility:"visible",color:c},[`&${i}-disabled ${t}-draggable-icon`]:{visibility:"hidden"}}},[`${t}-indent`]:{alignSelf:"stretch",whiteSpace:"nowrap",userSelect:"none","&-unit":{display:"inline-block",width:s}},[`${t}-draggable-icon`]:{visibility:"hidden"},[`${t}-switcher`]:Object.assign(Object.assign({},LW(n,e)),{position:"relative",flex:"none",alignSelf:"stretch",width:o,margin:0,textAlign:"center",cursor:"pointer",userSelect:"none",transition:`all ${e.motionDurationSlow}`,marginInlineEnd:e.calc(e.calc(o).sub(e.controlInteractiveSize)).div(2).equal(),"&-noop":{cursor:"unset"},"&:before":{pointerEvents:"none",content:'""',width:o,height:o,position:"absolute",left:{_skip_check_:!0,value:0},top:0,borderRadius:e.borderRadius,transition:`all ${e.motionDurationSlow}`},[`&:not(${t}-switcher-noop):hover:before`]:{backgroundColor:e.colorBgTextHover},[`&_close ${t}-switcher-icon svg`]:{transform:"rotate(-90deg)"},"&-loading-icon":{color:e.colorPrimary},"&-leaf-line":{position:"relative",zIndex:1,display:"inline-block",width:"100%",height:"100%","&:before":{position:"absolute",top:0,insetInlineEnd:e.calc(o).div(2).equal(),bottom:e.calc(r).mul(-1).equal(),marginInlineStart:-1,borderInlineEnd:`1px solid ${e.colorBorder}`,content:'""'},"&:after":{position:"absolute",width:e.calc(e.calc(o).div(2).equal()).mul(.8).equal(),height:e.calc(o).div(2).equal(),borderBottom:`1px solid ${e.colorBorder}`,content:'""'}}}),[`${t}-checkbox`]:{top:"initial",marginInlineEnd:u,alignSelf:"flex-start",marginTop:e.marginXXS},[`${t}-node-content-wrapper`]:Object.assign(Object.assign({position:"relative",minHeight:o,paddingBlock:0,paddingInline:e.paddingXS,background:"transparent",borderRadius:e.borderRadius,cursor:"pointer",transition:`all ${e.motionDurationMid}, border 0s, line-height 0s, box-shadow 0s`},zW(n,e)),{"&:hover":{backgroundColor:l},[`&${t}-node-selected`]:{color:e.nodeSelectedColor,backgroundColor:a},[`${t}-iconEle`]:{display:"inline-block",width:o,height:o,textAlign:"center",verticalAlign:"top","&:empty":{display:"none"}}}),[`${t}-unselectable ${t}-node-content-wrapper:hover`]:{backgroundColor:"transparent"},[`${i}.drop-container > [draggable]`]:{boxShadow:`0 0 0 2px ${e.colorPrimary}`},"&-show-line":{[`${t}-indent-unit`]:{position:"relative",height:"100%","&:before":{position:"absolute",top:0,insetInlineEnd:e.calc(o).div(2).equal(),bottom:e.calc(r).mul(-1).equal(),borderInlineEnd:`1px solid ${e.colorBorder}`,content:'""'},"&-end:before":{display:"none"}},[`${t}-switcher`]:{background:"transparent","&-line-icon":{verticalAlign:"-0.15em"}}},[`${i}-leaf-last ${t}-switcher-leaf-line:before`]:{top:"auto !important",bottom:"auto !important",height:`${ue(e.calc(o).div(2).equal())} !important`}})}},VW=(n,e)=>{const t=`.${n}`,i=`${t}-treenode`,r=e.calc(e.paddingXS).div(2).equal(),o=Ei(e,{treeCls:t,treeNodeCls:i,treeNodePadding:r});return[BW(n,o),MW(o)]},WW=n=>{const{controlHeightSM:e,controlItemBgHover:t,controlItemBgActive:i}=n,r=e;return{titleHeight:r,indentSize:r,nodeHoverBg:t,nodeHoverColor:n.colorText,nodeSelectedBg:i,nodeSelectedColor:n.colorText}},GW=n=>{const{colorTextLightSolid:e,colorPrimary:t}=n;return Object.assign(Object.assign({},WW(n)),{directoryNodeSelectedColor:e,directoryNodeSelectedBg:t})},HW=Xr("Tree",(n,e)=>{let{prefixCls:t}=e;return[{[n.componentCls]:ZI(`${t}-checkbox`,n)},VW(t,n),J_(n)]},GW),Ow=4;function UW(n){const{dropPosition:e,dropLevelOffset:t,prefixCls:i,indent:r,direction:o="ltr"}=n,s=o==="ltr"?"left":"right",a=o==="ltr"?"right":"left",l={[s]:-t*r+Ow,[a]:0};switch(e){case-1:l.top=-3;break;case 1:l.bottom=-3;break;default:l.bottom=-3,l[s]=r+Ow;break}return le.createElement("div",{style:l,className:`${i}-drop-indicator`})}const jW=n=>{const{prefixCls:e,switcherIcon:t,treeNodeProps:i,showLine:r,switcherLoadingIcon:o}=n,{isLeaf:s,expanded:a,loading:l}=i;if(l)return S.isValidElement(o)?o:S.createElement(b1,{className:`${e}-switcher-loading-icon`});let c;if(r&&typeof r=="object"&&(c=r.showLeafIcon),s){if(!r)return null;if(typeof c!="boolean"&&c){const f=typeof c=="function"?c(i):c,h=`${e}-switcher-line-custom-icon`;return S.isValidElement(f)?Fc(f,{className:ye(f.props.className||"",h)}):f}return c?S.createElement(m$,{className:`${e}-switcher-line-icon`}):S.createElement("span",{className:`${e}-switcher-leaf-line`})}const u=`${e}-switcher-icon`,d=typeof t=="function"?t(i):t;return S.isValidElement(d)?Fc(d,{className:ye(d.props.className||"",u)}):d!==void 0?d:r?a?S.createElement(WB,{className:`${e}-switcher-line-icon`}):S.createElement(YB,{className:`${e}-switcher-line-icon`}):S.createElement(bB,{className:u})},z$=le.forwardRef((n,e)=>{var t;const{getPrefixCls:i,direction:r,virtual:o,tree:s}=le.useContext(Nn),{prefixCls:a,className:l,showIcon:c=!1,showLine:u,switcherIcon:d,switcherLoadingIcon:f,blockNode:h=!1,children:p,checkable:m=!1,selectable:g=!0,draggable:v,motion:x,style:b}=n,w=i("tree",a),y=i(),C=x??Object.assign(Object.assign({},Q_(y)),{motionAppear:!1}),$=Object.assign(Object.assign({},n),{checkable:m,selectable:g,showIcon:c,motion:C,blockNode:h,showLine:!!u,dropIndicatorRender:UW}),[I,E,N]=HW(w),[,k]=Wl(),D=k.paddingXS/2+(((t=k.Tree)===null||t===void 0?void 0:t.titleHeight)||k.controlHeightSM),_=le.useMemo(()=>{if(!v)return!1;let T={};switch(typeof v){case"function":T.nodeDraggable=v;break;case"object":T=Object.assign({},v);break}return T.icon!==!1&&(T.icon=T.icon||le.createElement(zB,null)),T},[v]),R=T=>le.createElement(jW,{prefixCls:w,switcherIcon:d,switcherLoadingIcon:f,treeNodeProps:T,showLine:u});return I(le.createElement(rx,Object.assign({itemHeight:D,ref:e,virtual:o},$,{style:Object.assign(Object.assign({},s==null?void 0:s.style),b),prefixCls:w,className:ye({[`${w}-icon-hide`]:!c,[`${w}-block-node`]:h,[`${w}-unselectable`]:!g,[`${w}-rtl`]:r==="rtl"},s==null?void 0:s.className,l,E,N),direction:r,checkable:m&&le.createElement("span",{className:`${w}-checkbox-inner`}),selectable:g,switcherIcon:R,draggable:_}),p))}),Pw=0,pm=1,Mw=2;function ox(n,e,t){const{key:i,children:r}=t;function o(s){const a=s[i],l=s[r];e(a,s)!==!1&&ox(l||[],e,t)}n.forEach(o)}function KW(n){let{treeData:e,expandedKeys:t,startKey:i,endKey:r,fieldNames:o}=n;const s=[];let a=Pw;if(i&&i===r)return[i];if(!i||!r)return[];function l(c){return c===i||c===r}return ox(e,c=>{if(a===Mw)return!1;if(l(c)){if(s.push(c),a===Pw)a=pm;else if(a===pm)return a=Mw,!1}else a===pm&&s.push(c);return t.includes(c)},Il(o)),s}function mm(n,e,t){const i=nt(e),r=[];return ox(n,(o,s)=>{const a=i.indexOf(o);return a!==-1&&(r.push(s),i.splice(a,1)),!!i.length},Il(t)),r}var Fw=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};function XW(n){const{isLeaf:e,expanded:t}=n;return e?S.createElement(m$,null):t?S.createElement(AB,null):S.createElement(MB,null)}function Lw(n){let{treeData:e,children:t}=n;return e||YI(t)}const qW=(n,e)=>{var{defaultExpandAll:t,defaultExpandParent:i,defaultExpandedKeys:r}=n,o=Fw(n,["defaultExpandAll","defaultExpandParent","defaultExpandedKeys"]);const s=S.useRef(),a=S.useRef(),l=()=>{const{keyEntities:I}=Xv(Lw(o));let E;return t?E=Object.keys(I):i?E=og(o.expandedKeys||r||[],I):E=o.expandedKeys||r||[],E},[c,u]=S.useState(o.selectedKeys||o.defaultSelectedKeys||[]),[d,f]=S.useState(()=>l());S.useEffect(()=>{"selectedKeys"in o&&u(o.selectedKeys)},[o.selectedKeys]),S.useEffect(()=>{"expandedKeys"in o&&f(o.expandedKeys)},[o.expandedKeys]);const h=(I,E)=>{var N;return"expandedKeys"in o||f(I),(N=o.onExpand)===null||N===void 0?void 0:N.call(o,I,E)},p=(I,E)=>{var N;const{multiple:k,fieldNames:D}=o,{node:_,nativeEvent:R}=E,{key:T=""}=_,A=Lw(o),O=Object.assign(Object.assign({},E),{selected:!0}),P=(R==null?void 0:R.ctrlKey)||(R==null?void 0:R.metaKey),M=R==null?void 0:R.shiftKey;let z;k&&P?(z=I,s.current=T,a.current=z,O.selectedNodes=mm(A,z,D)):k&&M?(z=Array.from(new Set([].concat(nt(a.current||[]),nt(KW({treeData:A,expandedKeys:d,startKey:T,endKey:s.current,fieldNames:D}))))),O.selectedNodes=mm(A,z,D)):(z=[T],s.current=T,a.current=z,O.selectedNodes=mm(A,z,D)),(N=o.onSelect)===null||N===void 0||N.call(o,z,O),"selectedKeys"in o||u(z)},{getPrefixCls:m,direction:g}=S.useContext(Nn),{prefixCls:v,className:x,showIcon:b=!0,expandAction:w="click"}=o,y=Fw(o,["prefixCls","className","showIcon","expandAction"]),C=m("tree",v),$=ye(`${C}-directory`,{[`${C}-directory-rtl`]:g==="rtl"},x);return S.createElement(z$,Object.assign({icon:XW,ref:e,blockNode:!0},y,{showIcon:b,expandAction:w,prefixCls:C,className:$,expandedKeys:d,selectedKeys:c,onSelect:p,onExpand:h}))},YW=S.forwardRef(qW),sx=z$;sx.DirectoryTree=YW;sx.TreeNode=El;const zw=n=>{const{value:e,filterSearch:t,tablePrefixCls:i,locale:r,onChange:o}=n;return t?S.createElement("div",{className:`${i}-filter-dropdown-search`},S.createElement(Ul,{prefix:S.createElement(Vv,null),placeholder:r.filterSearchPlaceholder,onChange:o,value:e,htmlSize:1,className:`${i}-filter-dropdown-search-input`})):null},JW=n=>{const{keyCode:e}=n;e===Xe.ENTER&&n.stopPropagation()},ZW=S.forwardRef((n,e)=>S.createElement("div",{className:n.className,onClick:t=>t.stopPropagation(),onKeyDown:JW,ref:e},n.children));function sl(n){let e=[];return(n||[]).forEach(t=>{let{value:i,children:r}=t;e.push(i),r&&(e=[].concat(nt(e),nt(sl(r))))}),e}function QW(n){return n.some(e=>{let{children:t}=e;return t})}function B$(n,e){return typeof e=="string"||typeof e=="number"?e==null?void 0:e.toString().toLowerCase().includes(n.trim().toLowerCase()):!1}function V$(n){let{filters:e,prefixCls:t,filteredKeys:i,filterMultiple:r,searchValue:o,filterSearch:s}=n;return e.map((a,l)=>{const c=String(a.value);if(a.children)return{key:c||l,label:a.text,popupClassName:`${t}-dropdown-submenu`,children:V$({filters:a.children,prefixCls:t,filteredKeys:i,filterMultiple:r,searchValue:o,filterSearch:s})};const u=r?$l:k1,d={key:a.value!==void 0?c:l,label:S.createElement(S.Fragment,null,S.createElement(u,{checked:i.includes(c)}),S.createElement("span",null,a.text))};return o.trim()?typeof s=="function"?s(o,a)?d:null:B$(o,a.text)?d:null:d})}function gm(n){return n||[]}const e4=n=>{var e,t,i,r;const{tablePrefixCls:o,prefixCls:s,column:a,dropdownPrefixCls:l,columnKey:c,filterOnClose:u,filterMultiple:d,filterMode:f="menu",filterSearch:h=!1,filterState:p,triggerFilter:m,locale:g,children:v,getPopupContainer:x,rootClassName:b}=n,{filterResetToDefaultFilteredValue:w,defaultFilteredValue:y,filterDropdownProps:C={},filterDropdownOpen:$,filterDropdownVisible:I,onFilterDropdownVisibleChange:E,onFilterDropdownOpenChange:N}=a,[k,D]=S.useState(!1),_=!!(p&&(!((e=p.filteredKeys)===null||e===void 0)&&e.length||p.forceFiltered)),R=fe=>{var ge;D(fe),(ge=C.onOpenChange)===null||ge===void 0||ge.call(C,fe),N==null||N(fe),E==null||E(fe)},T=(r=(i=(t=C.open)!==null&&t!==void 0?t:$)!==null&&i!==void 0?i:I)!==null&&r!==void 0?r:k,A=p==null?void 0:p.filteredKeys,[O,P]=EW(gm(A)),M=fe=>{let{selectedKeys:ge}=fe;P(ge)},z=(fe,ge)=>{let{node:we,checked:ve}=ge;M(d?{selectedKeys:fe}:{selectedKeys:ve&&we.key?[we.key]:[]})};S.useEffect(()=>{k&&M({selectedKeys:gm(A)})},[A]);const[L,W]=S.useState([]),U=fe=>{W(fe)},[V,H]=S.useState(""),Y=fe=>{const{value:ge}=fe.target;H(ge)};S.useEffect(()=>{k||H("")},[k]);const Q=fe=>{const ge=fe!=null&&fe.length?fe:null;if(ge===null&&(!p||!p.filteredKeys)||Lc(ge,p==null?void 0:p.filteredKeys,!0))return null;m({column:a,key:c,filteredKeys:ge})},Z=()=>{R(!1),Q(O())},pe=function(){let{confirm:fe,closeDropdown:ge}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{confirm:!1,closeDropdown:!1};fe&&Q([]),ge&&R(!1),H(""),P(w?(y||[]).map(we=>String(we)):[])},oe=function(){let{closeDropdown:fe}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{closeDropdown:!0};fe&&R(!1),Q(O())},X=(fe,ge)=>{ge.source==="trigger"&&(fe&&A!==void 0&&P(gm(A)),R(fe),!fe&&!a.filterDropdown&&u&&Z())},j=ye({[`${l}-menu-without-submenu`]:!QW(a.filters||[])}),ne=fe=>{if(fe.target.checked){const ge=sl(a==null?void 0:a.filters).map(we=>String(we));P(ge)}else P([])},se=fe=>{let{filters:ge}=fe;return(ge||[]).map((we,ve)=>{const Ne=String(we.value),Ae={title:we.text,key:we.value!==void 0?Ne:String(ve)};return we.children&&(Ae.children=se({filters:we.children})),Ae})},ce=fe=>{var ge;return Object.assign(Object.assign({},fe),{text:fe.title,value:fe.key,children:((ge=fe.children)===null||ge===void 0?void 0:ge.map(we=>ce(we)))||[]})};let re;const{direction:be,renderEmpty:Ie}=S.useContext(Nn);if(typeof a.filterDropdown=="function")re=a.filterDropdown({prefixCls:`${l}-custom`,setSelectedKeys:fe=>M({selectedKeys:fe}),selectedKeys:O(),confirm:oe,clearFilters:pe,filters:a.filters,visible:T,close:()=>{R(!1)}});else if(a.filterDropdown)re=a.filterDropdown;else{const fe=O()||[],ge=()=>{var ve;const Ne=(ve=Ie==null?void 0:Ie("Table.filter"))!==null&&ve!==void 0?ve:S.createElement(Po,{image:Po.PRESENTED_IMAGE_SIMPLE,description:g.filterEmptyText,imageStyle:{height:24},style:{margin:0,padding:"16px 0"}});if((a.filters||[]).length===0)return Ne;if(f==="tree")return S.createElement(S.Fragment,null,S.createElement(zw,{filterSearch:h,value:V,onChange:Y,tablePrefixCls:o,locale:g}),S.createElement("div",{className:`${o}-filter-dropdown-tree`},d?S.createElement($l,{checked:fe.length===sl(a.filters).length,indeterminate:fe.length>0&&fe.length<sl(a.filters).length,className:`${o}-filter-dropdown-checkall`,onChange:ne},g.filterCheckall):null,S.createElement(sx,{checkable:!0,selectable:!1,blockNode:!0,multiple:d,checkStrictly:!d,className:`${l}-menu`,onCheck:z,checkedKeys:fe,selectedKeys:fe,showIcon:!1,treeData:se({filters:a.filters}),autoExpandParent:!0,defaultExpandAll:!0,filterTreeNode:V.trim()?Ue=>typeof h=="function"?h(V,ce(Ue)):B$(V,Ue.title):void 0})));const Ae=V$({filters:a.filters||[],filterSearch:h,prefixCls:s,filteredKeys:O(),filterMultiple:d,searchValue:V}),Ve=Ae.every(Ue=>Ue===null);return S.createElement(S.Fragment,null,S.createElement(zw,{filterSearch:h,value:V,onChange:Y,tablePrefixCls:o,locale:g}),Ve?Ne:S.createElement(eA,{selectable:!0,multiple:d,prefixCls:`${l}-menu`,className:j,onSelect:M,onDeselect:M,selectedKeys:fe,getPopupContainer:x,openKeys:L,onOpenChange:U,items:Ae}))},we=()=>w?Lc((y||[]).map(ve=>String(ve)),fe,!0):fe.length===0;re=S.createElement(S.Fragment,null,ge(),S.createElement("div",{className:`${s}-dropdown-btns`},S.createElement(vl,{type:"link",size:"small",disabled:we(),onClick:()=>pe()},g.filterReset),S.createElement(vl,{type:"primary",size:"small",onClick:Z},g.filterConfirm)))}a.filterDropdown&&(re=S.createElement(tA,{selectable:void 0},re)),re=S.createElement(ZW,{className:`${s}-dropdown`},re);const Se=qv({trigger:["click"],placement:be==="rtl"?"bottomLeft":"bottomRight",children:(()=>{let fe;return typeof a.filterIcon=="function"?fe=a.filterIcon(_):a.filterIcon?fe=a.filterIcon:fe=S.createElement(TB,null),S.createElement("span",{role:"button",tabIndex:-1,className:ye(`${s}-trigger`,{active:_}),onClick:ge=>{ge.stopPropagation()}},fe)})(),getPopupContainer:x},Object.assign(Object.assign({},C),{rootClassName:ye(b,C.rootClassName),open:T,onOpenChange:X,dropdownRender:()=>typeof(C==null?void 0:C.dropdownRender)=="function"?C.dropdownRender(re):re}));return S.createElement("div",{className:`${s}-column`},S.createElement("span",{className:`${o}-column-title`},v),S.createElement(I1,Object.assign({},Se)))},ug=(n,e,t)=>{let i=[];return(n||[]).forEach((r,o)=>{var s;const a=ql(o,t);if(r.filters||"filterDropdown"in r||"onFilter"in r)if("filteredValue"in r){let l=r.filteredValue;"filterDropdown"in r||(l=(s=l==null?void 0:l.map(String))!==null&&s!==void 0?s:l),i.push({column:r,key:ys(r,a),filteredKeys:l,forceFiltered:r.filtered})}else i.push({column:r,key:ys(r,a),filteredKeys:e&&r.defaultFilteredValue?r.defaultFilteredValue:void 0,forceFiltered:r.filtered});"children"in r&&(i=[].concat(nt(i),nt(ug(r.children,e,a))))}),i};function W$(n,e,t,i,r,o,s,a,l){return t.map((c,u)=>{const d=ql(u,a),{filterOnClose:f=!0,filterMultiple:h=!0,filterMode:p,filterSearch:m}=c;let g=c;if(g.filters||g.filterDropdown){const v=ys(g,d),x=i.find(b=>{let{key:w}=b;return v===w});g=Object.assign(Object.assign({},g),{title:b=>S.createElement(e4,{tablePrefixCls:n,prefixCls:`${n}-filter`,dropdownPrefixCls:e,column:g,columnKey:v,filterState:x,filterOnClose:f,filterMultiple:h,filterMode:p,filterSearch:m,triggerFilter:o,locale:r,getPopupContainer:s,rootClassName:l},gf(c.title,b))})}return"children"in g&&(g=Object.assign(Object.assign({},g),{children:W$(n,e,g.children,i,r,o,s,d,l)})),g})}const Bw=n=>{const e={};return n.forEach(t=>{let{key:i,filteredKeys:r,column:o}=t;const s=i,{filters:a,filterDropdown:l}=o;if(l)e[s]=r||null;else if(Array.isArray(r)){const c=sl(a);e[s]=c.filter(u=>r.includes(String(u)))}else e[s]=null}),e},dg=(n,e,t)=>e.reduce((r,o)=>{const{column:{onFilter:s,filters:a},filteredKeys:l}=o;return s&&l&&l.length?r.map(c=>Object.assign({},c)).filter(c=>l.some(u=>{const d=sl(a),f=d.findIndex(p=>String(p)===String(u)),h=f!==-1?d[f]:u;return c[t]&&(c[t]=dg(c[t],e,t)),s(h,c)})):r},n),G$=n=>n.flatMap(e=>"children"in e?[e].concat(nt(G$(e.children||[]))):[e]),t4=n=>{const{prefixCls:e,dropdownPrefixCls:t,mergedColumns:i,onFilterChange:r,getPopupContainer:o,locale:s,rootClassName:a}=n;pv();const l=S.useMemo(()=>G$(i||[]),[i]),[c,u]=S.useState(()=>ug(l,!0)),d=S.useMemo(()=>{const m=ug(l,!1);if(m.length===0)return m;let g=!0;if(m.forEach(v=>{let{filteredKeys:x}=v;x!==void 0&&(g=!1)}),g){const v=(l||[]).map((x,b)=>ys(x,ql(b)));return c.filter(x=>{let{key:b}=x;return v.includes(b)}).map(x=>{const b=l[v.findIndex(w=>w===x.key)];return Object.assign(Object.assign({},x),{column:Object.assign(Object.assign({},x.column),b),forceFiltered:b.filtered})})}return m},[l,c]),f=S.useMemo(()=>Bw(d),[d]),h=m=>{const g=d.filter(v=>{let{key:x}=v;return x!==m.key});g.push(m),u(g),r(Bw(g),g)};return[m=>W$(e,t,m,d,s,h,o,void 0,a),d,f]},n4=(n,e,t)=>{const i=S.useRef({});function r(o){var s;if(!i.current||i.current.data!==n||i.current.childrenColumnName!==e||i.current.getRowKey!==t){let l=function(c){c.forEach((u,d)=>{const f=t(u,d);a.set(f,u),u&&typeof u=="object"&&e in u&&l(u[e]||[])})};const a=new Map;l(n),i.current={data:n,childrenColumnName:e,kvMap:a,getRowKey:t}}return(s=i.current.kvMap)===null||s===void 0?void 0:s.get(o)}return[r]};var i4=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};const H$=10;function r4(n,e){const t={current:n.current,pageSize:n.pageSize};return Object.keys(e&&typeof e=="object"?e:{}).forEach(r=>{const o=n[r];typeof o!="function"&&(t[r]=o)}),t}function o4(n,e,t){const i=t&&typeof t=="object"?t:{},{total:r=0}=i,o=i4(i,["total"]),[s,a]=S.useState(()=>({current:"defaultCurrent"in o?o.defaultCurrent:1,pageSize:"defaultPageSize"in o?o.defaultPageSize:H$})),l=qv(s,o,{total:r>0?r:n}),c=Math.ceil((r||n)/l.pageSize);l.current>c&&(l.current=c||1);const u=(f,h)=>{a({current:f??1,pageSize:h||l.pageSize})},d=(f,h)=>{var p;t&&((p=t.onChange)===null||p===void 0||p.call(t,f,h)),u(f,h),e(f,h||(l==null?void 0:l.pageSize))};return t===!1?[{},()=>{}]:[Object.assign(Object.assign({},l),{onChange:d}),u]}const ah="ascend",vm="descend",xh=n=>typeof n.sorter=="object"&&typeof n.sorter.multiple=="number"?n.sorter.multiple:!1,Vw=n=>typeof n=="function"?n:n&&typeof n=="object"&&n.compare?n.compare:!1,s4=(n,e)=>e?n[n.indexOf(e)+1]:n[0],hg=(n,e,t)=>{let i=[];const r=(o,s)=>{i.push({column:o,key:ys(o,s),multiplePriority:xh(o),sortOrder:o.sortOrder})};return(n||[]).forEach((o,s)=>{const a=ql(s,t);o.children?("sortOrder"in o&&r(o,a),i=[].concat(nt(i),nt(hg(o.children,e,a)))):o.sorter&&("sortOrder"in o?r(o,a):e&&o.defaultSortOrder&&i.push({column:o,key:ys(o,a),multiplePriority:xh(o),sortOrder:o.defaultSortOrder}))}),i},U$=(n,e,t,i,r,o,s,a)=>(e||[]).map((c,u)=>{const d=ql(u,a);let f=c;if(f.sorter){const h=f.sortDirections||r,p=f.showSorterTooltip===void 0?s:f.showSorterTooltip,m=ys(f,d),g=t.find(E=>{let{key:N}=E;return N===m}),v=g?g.sortOrder:null,x=s4(h,v);let b;if(c.sortIcon)b=c.sortIcon({sortOrder:v});else{const E=h.includes(ah)&&S.createElement($B,{className:ye(`${n}-column-sorter-up`,{active:v===ah})}),N=h.includes(vm)&&S.createElement(CB,{className:ye(`${n}-column-sorter-down`,{active:v===vm})});b=S.createElement("span",{className:ye(`${n}-column-sorter`,{[`${n}-column-sorter-full`]:!!(E&&N)})},S.createElement("span",{className:`${n}-column-sorter-inner`,"aria-hidden":"true"},E,N))}const{cancelSort:w,triggerAsc:y,triggerDesc:C}=o||{};let $=w;x===vm?$=C:x===ah&&($=y);const I=typeof p=="object"?Object.assign({title:$},p):{title:$};f=Object.assign(Object.assign({},f),{className:ye(f.className,{[`${n}-column-sort`]:v}),title:E=>{const N=`${n}-column-sorters`,k=S.createElement("span",{className:`${n}-column-title`},gf(c.title,E)),D=S.createElement("div",{className:N},k,b);return p?typeof p!="boolean"&&(p==null?void 0:p.target)==="sorter-icon"?S.createElement("div",{className:`${N} ${n}-column-sorters-tooltip-target-sorter`},k,S.createElement(yy,Object.assign({},I),b)):S.createElement(yy,Object.assign({},I),D):D},onHeaderCell:E=>{var N;const k=((N=c.onHeaderCell)===null||N===void 0?void 0:N.call(c,E))||{},D=k.onClick,_=k.onKeyDown;k.onClick=A=>{i({column:c,key:m,sortOrder:x,multiplePriority:xh(c)}),D==null||D(A)},k.onKeyDown=A=>{A.keyCode===Xe.ENTER&&(i({column:c,key:m,sortOrder:x,multiplePriority:xh(c)}),_==null||_(A))};const R=$W(c.title,{}),T=R==null?void 0:R.toString();return v?k["aria-sort"]=v==="ascend"?"ascending":"descending":k["aria-label"]=T||"",k.className=ye(k.className,`${n}-column-has-sorters`),k.tabIndex=0,c.ellipsis&&(k.title=(R??"").toString()),k}})}return"children"in f&&(f=Object.assign(Object.assign({},f),{children:U$(n,f.children,t,i,r,o,s,d)})),f}),Ww=n=>{const{column:e,sortOrder:t}=n;return{column:e,order:t,field:e.dataIndex,columnKey:e.key}},Gw=n=>{const e=n.filter(t=>{let{sortOrder:i}=t;return i}).map(Ww);if(e.length===0&&n.length){const t=n.length-1;return Object.assign(Object.assign({},Ww(n[t])),{column:void 0,order:void 0,field:void 0,columnKey:void 0})}return e.length<=1?e[0]||{}:e},fg=(n,e,t)=>{const i=e.slice().sort((s,a)=>a.multiplePriority-s.multiplePriority),r=n.slice(),o=i.filter(s=>{let{column:{sorter:a},sortOrder:l}=s;return Vw(a)&&l});return o.length?r.sort((s,a)=>{for(let l=0;l<o.length;l+=1){const c=o[l],{column:{sorter:u},sortOrder:d}=c,f=Vw(u);if(f&&d){const h=f(s,a,d);if(h!==0)return d===ah?h:-h}}return 0}).map(s=>{const a=s[t];return a?Object.assign(Object.assign({},s),{[t]:fg(a,e,t)}):s}):r},a4=n=>{const{prefixCls:e,mergedColumns:t,sortDirections:i,tableLocale:r,showSorterTooltip:o,onSorterChange:s}=n,[a,l]=S.useState(hg(t,!0)),c=(m,g)=>{const v=[];return m.forEach((x,b)=>{const w=ql(b,g);if(v.push(ys(x,w)),Array.isArray(x.children)){const y=c(x.children,w);v.push.apply(v,nt(y))}}),v},u=S.useMemo(()=>{let m=!0;const g=hg(t,!1);if(!g.length){const w=c(t);return a.filter(y=>{let{key:C}=y;return w.includes(C)})}const v=[];function x(w){m?v.push(w):v.push(Object.assign(Object.assign({},w),{sortOrder:null}))}let b=null;return g.forEach(w=>{b===null?(x(w),w.sortOrder&&(w.multiplePriority===!1?m=!1:b=!0)):(b&&w.multiplePriority!==!1||(m=!1),x(w))}),v},[t,a]),d=S.useMemo(()=>{var m,g;const v=u.map(x=>{let{column:b,sortOrder:w}=x;return{column:b,order:w}});return{sortColumns:v,sortColumn:(m=v[0])===null||m===void 0?void 0:m.column,sortOrder:(g=v[0])===null||g===void 0?void 0:g.order}},[u]),f=m=>{let g;m.multiplePriority===!1||!u.length||u[0].multiplePriority===!1?g=[m]:g=[].concat(nt(u.filter(v=>{let{key:x}=v;return x!==m.key})),[m]),l(g),s(Gw(g),g)};return[m=>U$(e,m,u,f,i,r,o),u,d,()=>Gw(u)]},j$=(n,e)=>n.map(i=>{const r=Object.assign({},i);return r.title=gf(i.title,e),"children"in r&&(r.children=j$(r.children,e)),r}),l4=n=>[S.useCallback(t=>j$(t,n),[n])],c4=R$((n,e)=>{const{_renderTimes:t}=n,{_renderTimes:i}=e;return t!==i}),u4=A$((n,e)=>{const{_renderTimes:t}=n,{_renderTimes:i}=e;return t!==i}),d4=n=>{const{componentCls:e,lineWidth:t,lineType:i,tableBorderColor:r,tableHeaderBg:o,tablePaddingVertical:s,tablePaddingHorizontal:a,calc:l}=n,c=`${ue(t)} ${i} ${r}`,u=(d,f,h)=>({[`&${e}-${d}`]:{[`> ${e}-container`]:{[`> ${e}-content, > ${e}-body`]:{"\n            > table > tbody > tr > th,\n            > table > tbody > tr > td\n          ":{[`> ${e}-expanded-row-fixed`]:{margin:`${ue(l(f).mul(-1).equal())}
              ${ue(l(l(h).add(t)).mul(-1).equal())}`}}}}}});return{[`${e}-wrapper`]:{[`${e}${e}-bordered`]:Object.assign(Object.assign(Object.assign({[`> ${e}-title`]:{border:c,borderBottom:0},[`> ${e}-container`]:{borderInlineStart:c,borderTop:c,[`
            > ${e}-content,
            > ${e}-header,
            > ${e}-body,
            > ${e}-summary
          `]:{"> table":{"\n                > thead > tr > th,\n                > thead > tr > td,\n                > tbody > tr > th,\n                > tbody > tr > td,\n                > tfoot > tr > th,\n                > tfoot > tr > td\n              ":{borderInlineEnd:c},"> thead":{"> tr:not(:last-child) > th":{borderBottom:c},"> tr > th::before":{backgroundColor:"transparent !important"}},"\n                > thead > tr,\n                > tbody > tr,\n                > tfoot > tr\n              ":{[`> ${e}-cell-fix-right-first::after`]:{borderInlineEnd:c}},"\n                > tbody > tr > th,\n                > tbody > tr > td\n              ":{[`> ${e}-expanded-row-fixed`]:{margin:`${ue(l(s).mul(-1).equal())} ${ue(l(l(a).add(t)).mul(-1).equal())}`,"&::after":{position:"absolute",top:0,insetInlineEnd:t,bottom:0,borderInlineEnd:c,content:'""'}}}}}},[`&${e}-scroll-horizontal`]:{[`> ${e}-container > ${e}-body`]:{"> table > tbody":{[`
                > tr${e}-expanded-row,
                > tr${e}-placeholder
              `]:{"> th, > td":{borderInlineEnd:0}}}}}},u("middle",n.tablePaddingVerticalMiddle,n.tablePaddingHorizontalMiddle)),u("small",n.tablePaddingVerticalSmall,n.tablePaddingHorizontalSmall)),{[`> ${e}-footer`]:{border:c,borderTop:0}}),[`${e}-cell`]:{[`${e}-container:first-child`]:{borderTop:0},"&-scrollbar:not([rowspan])":{boxShadow:`0 ${ue(t)} 0 ${ue(t)} ${o}`}},[`${e}-bordered ${e}-cell-scrollbar`]:{borderInlineEnd:c}}}},h4=n=>{const{componentCls:e}=n;return{[`${e}-wrapper`]:{[`${e}-cell-ellipsis`]:Object.assign(Object.assign({},hh),{wordBreak:"keep-all",[`
          &${e}-cell-fix-left-last,
          &${e}-cell-fix-right-first
        `]:{overflow:"visible",[`${e}-cell-content`]:{display:"block",overflow:"hidden",textOverflow:"ellipsis"}},[`${e}-column-title`]:{overflow:"hidden",textOverflow:"ellipsis",wordBreak:"keep-all"}})}}},f4=n=>{const{componentCls:e}=n;return{[`${e}-wrapper`]:{[`${e}-tbody > tr${e}-placeholder`]:{textAlign:"center",color:n.colorTextDisabled,"\n          &:hover > th,\n          &:hover > td,\n        ":{background:n.colorBgContainer}}}}},p4=n=>{const{componentCls:e,antCls:t,motionDurationSlow:i,lineWidth:r,paddingXS:o,lineType:s,tableBorderColor:a,tableExpandIconBg:l,tableExpandColumnWidth:c,borderRadius:u,tablePaddingVertical:d,tablePaddingHorizontal:f,tableExpandedRowBg:h,paddingXXS:p,expandIconMarginTop:m,expandIconSize:g,expandIconHalfInner:v,expandIconScale:x,calc:b}=n,w=`${ue(r)} ${s} ${a}`,y=b(p).sub(r).equal();return{[`${e}-wrapper`]:{[`${e}-expand-icon-col`]:{width:c},[`${e}-row-expand-icon-cell`]:{textAlign:"center",[`${e}-row-expand-icon`]:{display:"inline-flex",float:"none",verticalAlign:"sub"}},[`${e}-row-indent`]:{height:1,float:"left"},[`${e}-row-expand-icon`]:Object.assign(Object.assign({},nA(n)),{position:"relative",float:"left",width:g,height:g,color:"inherit",lineHeight:ue(g),background:l,border:w,borderRadius:u,transform:`scale(${x})`,"&:focus, &:hover, &:active":{borderColor:"currentcolor"},"&::before, &::after":{position:"absolute",background:"currentcolor",transition:`transform ${i} ease-out`,content:'""'},"&::before":{top:v,insetInlineEnd:y,insetInlineStart:y,height:r},"&::after":{top:y,bottom:y,insetInlineStart:v,width:r,transform:"rotate(90deg)"},"&-collapsed::before":{transform:"rotate(-180deg)"},"&-collapsed::after":{transform:"rotate(0deg)"},"&-spaced":{"&::before, &::after":{display:"none",content:"none"},background:"transparent",border:0,visibility:"hidden"}}),[`${e}-row-indent + ${e}-row-expand-icon`]:{marginTop:m,marginInlineEnd:o},[`tr${e}-expanded-row`]:{"&, &:hover":{"> th, > td":{background:h}},[`${t}-descriptions-view`]:{display:"flex",table:{flex:"auto",width:"100%"}}},[`${e}-expanded-row-fixed`]:{position:"relative",margin:`${ue(b(d).mul(-1).equal())} ${ue(b(f).mul(-1).equal())}`,padding:`${ue(d)} ${ue(f)}`}}}},m4=n=>{const{componentCls:e,antCls:t,iconCls:i,tableFilterDropdownWidth:r,tableFilterDropdownSearchWidth:o,paddingXXS:s,paddingXS:a,colorText:l,lineWidth:c,lineType:u,tableBorderColor:d,headerIconColor:f,fontSizeSM:h,tablePaddingHorizontal:p,borderRadius:m,motionDurationSlow:g,colorTextDescription:v,colorPrimary:x,tableHeaderFilterActiveBg:b,colorTextDisabled:w,tableFilterDropdownBg:y,tableFilterDropdownHeight:C,controlItemBgHover:$,controlItemBgActive:I,boxShadowSecondary:E,filterDropdownMenuBg:N,calc:k}=n,D=`${t}-dropdown`,_=`${e}-filter-dropdown`,R=`${t}-tree`,T=`${ue(c)} ${u} ${d}`;return[{[`${e}-wrapper`]:{[`${e}-filter-column`]:{display:"flex",justifyContent:"space-between"},[`${e}-filter-trigger`]:{position:"relative",display:"flex",alignItems:"center",marginBlock:k(s).mul(-1).equal(),marginInline:`${ue(s)} ${ue(k(p).div(2).mul(-1).equal())}`,padding:`0 ${ue(s)}`,color:f,fontSize:h,borderRadius:m,cursor:"pointer",transition:`all ${g}`,"&:hover":{color:v,background:b},"&.active":{color:x}}}},{[`${t}-dropdown`]:{[_]:Object.assign(Object.assign({},sr(n)),{minWidth:r,backgroundColor:y,borderRadius:m,boxShadow:E,overflow:"hidden",[`${D}-menu`]:{maxHeight:C,overflowX:"hidden",border:0,boxShadow:"none",borderRadius:"unset",backgroundColor:N,"&:empty::after":{display:"block",padding:`${ue(a)} 0`,color:w,fontSize:h,textAlign:"center",content:'"Not Found"'}},[`${_}-tree`]:{paddingBlock:`${ue(a)} 0`,paddingInline:a,[R]:{padding:0},[`${R}-treenode ${R}-node-content-wrapper:hover`]:{backgroundColor:$},[`${R}-treenode-checkbox-checked ${R}-node-content-wrapper`]:{"&, &:hover":{backgroundColor:I}}},[`${_}-search`]:{padding:a,borderBottom:T,"&-input":{input:{minWidth:o},[i]:{color:w}}},[`${_}-checkall`]:{width:"100%",marginBottom:s,marginInlineStart:s},[`${_}-btns`]:{display:"flex",justifyContent:"space-between",padding:`${ue(k(a).sub(c).equal())} ${ue(a)}`,overflow:"hidden",borderTop:T}})}},{[`${t}-dropdown ${_}, ${_}-submenu`]:{[`${t}-checkbox-wrapper + span`]:{paddingInlineStart:a,color:l},"> ul":{maxHeight:"calc(100vh - 130px)",overflowX:"hidden",overflowY:"auto"}}}]},g4=n=>{const{componentCls:e,lineWidth:t,colorSplit:i,motionDurationSlow:r,zIndexTableFixed:o,tableBg:s,zIndexTableSticky:a,calc:l}=n,c=i;return{[`${e}-wrapper`]:{[`
        ${e}-cell-fix-left,
        ${e}-cell-fix-right
      `]:{position:"sticky !important",zIndex:o,background:s},[`
        ${e}-cell-fix-left-first::after,
        ${e}-cell-fix-left-last::after
      `]:{position:"absolute",top:0,right:{_skip_check_:!0,value:0},bottom:l(t).mul(-1).equal(),width:30,transform:"translateX(100%)",transition:`box-shadow ${r}`,content:'""',pointerEvents:"none"},[`${e}-cell-fix-left-all::after`]:{display:"none"},[`
        ${e}-cell-fix-right-first::after,
        ${e}-cell-fix-right-last::after
      `]:{position:"absolute",top:0,bottom:l(t).mul(-1).equal(),left:{_skip_check_:!0,value:0},width:30,transform:"translateX(-100%)",transition:`box-shadow ${r}`,content:'""',pointerEvents:"none"},[`${e}-container`]:{position:"relative","&::before, &::after":{position:"absolute",top:0,bottom:0,zIndex:l(a).add(1).equal({unit:!1}),width:30,transition:`box-shadow ${r}`,content:'""',pointerEvents:"none"},"&::before":{insetInlineStart:0},"&::after":{insetInlineEnd:0}},[`${e}-ping-left`]:{[`&:not(${e}-has-fix-left) ${e}-container::before`]:{boxShadow:`inset 10px 0 8px -8px ${c}`},[`
          ${e}-cell-fix-left-first::after,
          ${e}-cell-fix-left-last::after
        `]:{boxShadow:`inset 10px 0 8px -8px ${c}`},[`${e}-cell-fix-left-last::before`]:{backgroundColor:"transparent !important"}},[`${e}-ping-right`]:{[`&:not(${e}-has-fix-right) ${e}-container::after`]:{boxShadow:`inset -10px 0 8px -8px ${c}`},[`
          ${e}-cell-fix-right-first::after,
          ${e}-cell-fix-right-last::after
        `]:{boxShadow:`inset -10px 0 8px -8px ${c}`}},[`${e}-fixed-column-gapped`]:{[`
        ${e}-cell-fix-left-first::after,
        ${e}-cell-fix-left-last::after,
        ${e}-cell-fix-right-first::after,
        ${e}-cell-fix-right-last::after
      `]:{boxShadow:"none"}}}}},v4=n=>{const{componentCls:e,antCls:t,margin:i}=n;return{[`${e}-wrapper`]:{[`${e}-pagination${t}-pagination`]:{margin:`${ue(i)} 0`},[`${e}-pagination`]:{display:"flex",flexWrap:"wrap",rowGap:n.paddingXS,"> *":{flex:"none"},"&-left":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-right":{justifyContent:"flex-end"}}}}},x4=n=>{const{componentCls:e,tableRadius:t}=n;return{[`${e}-wrapper`]:{[e]:{[`${e}-title, ${e}-header`]:{borderRadius:`${ue(t)} ${ue(t)} 0 0`},[`${e}-title + ${e}-container`]:{borderStartStartRadius:0,borderStartEndRadius:0,[`${e}-header, table`]:{borderRadius:0},"table > thead > tr:first-child":{"th:first-child, th:last-child, td:first-child, td:last-child":{borderRadius:0}}},"&-container":{borderStartStartRadius:t,borderStartEndRadius:t,"table > thead > tr:first-child":{"> *:first-child":{borderStartStartRadius:t},"> *:last-child":{borderStartEndRadius:t}}},"&-footer":{borderRadius:`0 0 ${ue(t)} ${ue(t)}`}}}}},b4=n=>{const{componentCls:e}=n;return{[`${e}-wrapper-rtl`]:{direction:"rtl",table:{direction:"rtl"},[`${e}-pagination-left`]:{justifyContent:"flex-end"},[`${e}-pagination-right`]:{justifyContent:"flex-start"},[`${e}-row-expand-icon`]:{float:"right","&::after":{transform:"rotate(-90deg)"},"&-collapsed::before":{transform:"rotate(180deg)"},"&-collapsed::after":{transform:"rotate(0deg)"}},[`${e}-container`]:{"&::before":{insetInlineStart:"unset",insetInlineEnd:0},"&::after":{insetInlineStart:0,insetInlineEnd:"unset"},[`${e}-row-indent`]:{float:"right"}}}}},y4=n=>{const{componentCls:e,antCls:t,iconCls:i,fontSizeIcon:r,padding:o,paddingXS:s,headerIconColor:a,headerIconHoverColor:l,tableSelectionColumnWidth:c,tableSelectedRowBg:u,tableSelectedRowHoverBg:d,tableRowHoverBg:f,tablePaddingHorizontal:h,calc:p}=n;return{[`${e}-wrapper`]:{[`${e}-selection-col`]:{width:c,[`&${e}-selection-col-with-dropdown`]:{width:p(c).add(r).add(p(o).div(4)).equal()}},[`${e}-bordered ${e}-selection-col`]:{width:p(c).add(p(s).mul(2)).equal(),[`&${e}-selection-col-with-dropdown`]:{width:p(c).add(r).add(p(o).div(4)).add(p(s).mul(2)).equal()}},[`
        table tr th${e}-selection-column,
        table tr td${e}-selection-column,
        ${e}-selection-column
      `]:{paddingInlineEnd:n.paddingXS,paddingInlineStart:n.paddingXS,textAlign:"center",[`${t}-radio-wrapper`]:{marginInlineEnd:0}},[`table tr th${e}-selection-column${e}-cell-fix-left`]:{zIndex:p(n.zIndexTableFixed).add(1).equal({unit:!1})},[`table tr th${e}-selection-column::after`]:{backgroundColor:"transparent !important"},[`${e}-selection`]:{position:"relative",display:"inline-flex",flexDirection:"column"},[`${e}-selection-extra`]:{position:"absolute",top:0,zIndex:1,cursor:"pointer",transition:`all ${n.motionDurationSlow}`,marginInlineStart:"100%",paddingInlineStart:ue(p(h).div(4).equal()),[i]:{color:a,fontSize:r,verticalAlign:"baseline","&:hover":{color:l}}},[`${e}-tbody`]:{[`${e}-row`]:{[`&${e}-row-selected`]:{[`> ${e}-cell`]:{background:u,"&-row-hover":{background:d}}},[`> ${e}-cell-row-hover`]:{background:f}}}}}},w4=n=>{const{componentCls:e,tableExpandColumnWidth:t,calc:i}=n,r=(o,s,a,l)=>({[`${e}${e}-${o}`]:{fontSize:l,[`
        ${e}-title,
        ${e}-footer,
        ${e}-cell,
        ${e}-thead > tr > th,
        ${e}-tbody > tr > th,
        ${e}-tbody > tr > td,
        tfoot > tr > th,
        tfoot > tr > td
      `]:{padding:`${ue(s)} ${ue(a)}`},[`${e}-filter-trigger`]:{marginInlineEnd:ue(i(a).div(2).mul(-1).equal())},[`${e}-expanded-row-fixed`]:{margin:`${ue(i(s).mul(-1).equal())} ${ue(i(a).mul(-1).equal())}`},[`${e}-tbody`]:{[`${e}-wrapper:only-child ${e}`]:{marginBlock:ue(i(s).mul(-1).equal()),marginInline:`${ue(i(t).sub(a).equal())} ${ue(i(a).mul(-1).equal())}`}},[`${e}-selection-extra`]:{paddingInlineStart:ue(i(a).div(4).equal())}}});return{[`${e}-wrapper`]:Object.assign(Object.assign({},r("middle",n.tablePaddingVerticalMiddle,n.tablePaddingHorizontalMiddle,n.tableFontSizeMiddle)),r("small",n.tablePaddingVerticalSmall,n.tablePaddingHorizontalSmall,n.tableFontSizeSmall))}},C4=n=>{const{componentCls:e,marginXXS:t,fontSizeIcon:i,headerIconColor:r,headerIconHoverColor:o}=n;return{[`${e}-wrapper`]:{[`${e}-thead th${e}-column-has-sorters`]:{outline:"none",cursor:"pointer",transition:`all ${n.motionDurationSlow}, left 0s`,"&:hover":{background:n.tableHeaderSortHoverBg,"&::before":{backgroundColor:"transparent !important"}},"&:focus-visible":{color:n.colorPrimary},[`
          &${e}-cell-fix-left:hover,
          &${e}-cell-fix-right:hover
        `]:{background:n.tableFixedHeaderSortActiveBg}},[`${e}-thead th${e}-column-sort`]:{background:n.tableHeaderSortBg,"&::before":{backgroundColor:"transparent !important"}},[`td${e}-column-sort`]:{background:n.tableBodySortBg},[`${e}-column-title`]:{position:"relative",zIndex:1,flex:1},[`${e}-column-sorters`]:{display:"flex",flex:"auto",alignItems:"center",justifyContent:"space-between","&::after":{position:"absolute",inset:0,width:"100%",height:"100%",content:'""'}},[`${e}-column-sorters-tooltip-target-sorter`]:{"&::after":{content:"none"}},[`${e}-column-sorter`]:{marginInlineStart:t,color:r,fontSize:0,transition:`color ${n.motionDurationSlow}`,"&-inner":{display:"inline-flex",flexDirection:"column",alignItems:"center"},"&-up, &-down":{fontSize:i,"&.active":{color:n.colorPrimary}},[`${e}-column-sorter-up + ${e}-column-sorter-down`]:{marginTop:"-0.3em"}},[`${e}-column-sorters:hover ${e}-column-sorter`]:{color:o}}}},S4=n=>{const{componentCls:e,opacityLoading:t,tableScrollThumbBg:i,tableScrollThumbBgHover:r,tableScrollThumbSize:o,tableScrollBg:s,zIndexTableSticky:a,stickyScrollBarBorderRadius:l,lineWidth:c,lineType:u,tableBorderColor:d}=n,f=`${ue(c)} ${u} ${d}`;return{[`${e}-wrapper`]:{[`${e}-sticky`]:{"&-holder":{position:"sticky",zIndex:a,background:n.colorBgContainer},"&-scroll":{position:"sticky",bottom:0,height:`${ue(o)} !important`,zIndex:a,display:"flex",alignItems:"center",background:s,borderTop:f,opacity:t,"&:hover":{transformOrigin:"center bottom"},"&-bar":{height:o,backgroundColor:i,borderRadius:l,transition:`all ${n.motionDurationSlow}, transform none`,position:"absolute",bottom:0,"&:hover, &-active":{backgroundColor:r}}}}}}},Hw=n=>{const{componentCls:e,lineWidth:t,tableBorderColor:i,calc:r}=n,o=`${ue(t)} ${n.lineType} ${i}`;return{[`${e}-wrapper`]:{[`${e}-summary`]:{position:"relative",zIndex:n.zIndexTableFixed,background:n.tableBg,"> tr":{"> th, > td":{borderBottom:o}}},[`div${e}-summary`]:{boxShadow:`0 ${ue(r(t).mul(-1).equal())} 0 ${i}`}}}},I4=n=>{const{componentCls:e,motionDurationMid:t,lineWidth:i,lineType:r,tableBorderColor:o,calc:s}=n,a=`${ue(i)} ${r} ${o}`,l=`${e}-expanded-row-cell`;return{[`${e}-wrapper`]:{[`${e}-tbody-virtual`]:{[`${e}-tbody-virtual-holder-inner`]:{[`
            & > ${e}-row, 
            & > div:not(${e}-row) > ${e}-row
          `]:{display:"flex",boxSizing:"border-box",width:"100%"}},[`${e}-cell`]:{borderBottom:a,transition:`background ${t}`},[`${e}-expanded-row`]:{[`${l}${l}-fixed`]:{position:"sticky",insetInlineStart:0,overflow:"hidden",width:`calc(var(--virtual-width) - ${ue(i)})`,borderInlineEnd:"none"}}},[`${e}-bordered`]:{[`${e}-tbody-virtual`]:{"&:after":{content:'""',insetInline:0,bottom:0,borderBottom:a,position:"absolute"},[`${e}-cell`]:{borderInlineEnd:a,[`&${e}-cell-fix-right-first:before`]:{content:'""',position:"absolute",insetBlock:0,insetInlineStart:s(i).mul(-1).equal(),borderInlineStart:a}}},[`&${e}-virtual`]:{[`${e}-placeholder ${e}-cell`]:{borderInlineEnd:a,borderBottom:a}}}}}},$4=n=>{const{componentCls:e,fontWeightStrong:t,tablePaddingVertical:i,tablePaddingHorizontal:r,tableExpandColumnWidth:o,lineWidth:s,lineType:a,tableBorderColor:l,tableFontSize:c,tableBg:u,tableRadius:d,tableHeaderTextColor:f,motionDurationMid:h,tableHeaderBg:p,tableHeaderCellSplitColor:m,tableFooterTextColor:g,tableFooterBg:v,calc:x}=n,b=`${ue(s)} ${a} ${l}`;return{[`${e}-wrapper`]:Object.assign(Object.assign({clear:"both",maxWidth:"100%"},y1()),{[e]:Object.assign(Object.assign({},sr(n)),{fontSize:c,background:u,borderRadius:`${ue(d)} ${ue(d)} 0 0`,scrollbarColor:`${n.tableScrollThumbBg} ${n.tableScrollBg}`}),table:{width:"100%",textAlign:"start",borderRadius:`${ue(d)} ${ue(d)} 0 0`,borderCollapse:"separate",borderSpacing:0},[`
          ${e}-cell,
          ${e}-thead > tr > th,
          ${e}-tbody > tr > th,
          ${e}-tbody > tr > td,
          tfoot > tr > th,
          tfoot > tr > td
        `]:{position:"relative",padding:`${ue(i)} ${ue(r)}`,overflowWrap:"break-word"},[`${e}-title`]:{padding:`${ue(i)} ${ue(r)}`},[`${e}-thead`]:{"\n          > tr > th,\n          > tr > td\n        ":{position:"relative",color:f,fontWeight:t,textAlign:"start",background:p,borderBottom:b,transition:`background ${h} ease`,"&[colspan]:not([colspan='1'])":{textAlign:"center"},[`&:not(:last-child):not(${e}-selection-column):not(${e}-row-expand-icon-cell):not([colspan])::before`]:{position:"absolute",top:"50%",insetInlineEnd:0,width:1,height:"1.6em",backgroundColor:m,transform:"translateY(-50%)",transition:`background-color ${h}`,content:'""'}},"> tr:not(:last-child) > th[colspan]":{borderBottom:0}},[`${e}-tbody`]:{"> tr":{"> th, > td":{transition:`background ${h}, border-color ${h}`,borderBottom:b,[`
              > ${e}-wrapper:only-child,
              > ${e}-expanded-row-fixed > ${e}-wrapper:only-child
            `]:{[e]:{marginBlock:ue(x(i).mul(-1).equal()),marginInline:`${ue(x(o).sub(r).equal())}
                ${ue(x(r).mul(-1).equal())}`,[`${e}-tbody > tr:last-child > td`]:{borderBottom:0,"&:first-child, &:last-child":{borderRadius:0}}}}},"> th":{position:"relative",color:f,fontWeight:t,textAlign:"start",background:p,borderBottom:b,transition:`background ${h} ease`}}},[`${e}-footer`]:{padding:`${ue(i)} ${ue(r)}`,color:g,background:v}})}},E4=n=>{const{colorFillAlter:e,colorBgContainer:t,colorTextHeading:i,colorFillSecondary:r,colorFillContent:o,controlItemBgActive:s,controlItemBgActiveHover:a,padding:l,paddingSM:c,paddingXS:u,colorBorderSecondary:d,borderRadiusLG:f,controlHeight:h,colorTextPlaceholder:p,fontSize:m,fontSizeSM:g,lineHeight:v,lineWidth:x,colorIcon:b,colorIconHover:w,opacityLoading:y,controlInteractiveSize:C}=n,$=new Oo(r).onBackground(t).toHexShortString(),I=new Oo(o).onBackground(t).toHexShortString(),E=new Oo(e).onBackground(t).toHexShortString(),N=new Oo(b),k=new Oo(w),D=C/2-x,_=D*2+x*3;return{headerBg:E,headerColor:i,headerSortActiveBg:$,headerSortHoverBg:I,bodySortBg:E,rowHoverBg:E,rowSelectedBg:s,rowSelectedHoverBg:a,rowExpandedBg:e,cellPaddingBlock:l,cellPaddingInline:l,cellPaddingBlockMD:c,cellPaddingInlineMD:u,cellPaddingBlockSM:u,cellPaddingInlineSM:u,borderColor:d,headerBorderRadius:f,footerBg:E,footerColor:i,cellFontSize:m,cellFontSizeMD:m,cellFontSizeSM:m,headerSplitColor:d,fixedHeaderSortActiveBg:$,headerFilterHoverBg:o,filterDropdownMenuBg:t,filterDropdownBg:t,expandIconBg:t,selectionColumnWidth:h,stickyScrollBarBg:p,stickyScrollBarBorderRadius:100,expandIconMarginTop:(m*v-x*3)/2-Math.ceil((g*1.4-x*3)/2),headerIconColor:N.clone().setAlpha(N.getAlpha()*y).toRgbString(),headerIconHoverColor:k.clone().setAlpha(k.getAlpha()*y).toRgbString(),expandIconHalfInner:D,expandIconSize:_,expandIconScale:C/_}},Uw=2,N4=Xr("Table",n=>{const{colorTextHeading:e,colorSplit:t,colorBgContainer:i,controlInteractiveSize:r,headerBg:o,headerColor:s,headerSortActiveBg:a,headerSortHoverBg:l,bodySortBg:c,rowHoverBg:u,rowSelectedBg:d,rowSelectedHoverBg:f,rowExpandedBg:h,cellPaddingBlock:p,cellPaddingInline:m,cellPaddingBlockMD:g,cellPaddingInlineMD:v,cellPaddingBlockSM:x,cellPaddingInlineSM:b,borderColor:w,footerBg:y,footerColor:C,headerBorderRadius:$,cellFontSize:I,cellFontSizeMD:E,cellFontSizeSM:N,headerSplitColor:k,fixedHeaderSortActiveBg:D,headerFilterHoverBg:_,filterDropdownBg:R,expandIconBg:T,selectionColumnWidth:A,stickyScrollBarBg:O,calc:P}=n,M=Ei(n,{tableFontSize:I,tableBg:i,tableRadius:$,tablePaddingVertical:p,tablePaddingHorizontal:m,tablePaddingVerticalMiddle:g,tablePaddingHorizontalMiddle:v,tablePaddingVerticalSmall:x,tablePaddingHorizontalSmall:b,tableBorderColor:w,tableHeaderTextColor:s,tableHeaderBg:o,tableFooterTextColor:C,tableFooterBg:y,tableHeaderCellSplitColor:k,tableHeaderSortBg:a,tableHeaderSortHoverBg:l,tableBodySortBg:c,tableFixedHeaderSortActiveBg:D,tableHeaderFilterActiveBg:_,tableFilterDropdownBg:R,tableRowHoverBg:u,tableSelectedRowBg:d,tableSelectedRowHoverBg:f,zIndexTableFixed:Uw,zIndexTableSticky:P(Uw).add(1).equal({unit:!1}),tableFontSizeMiddle:E,tableFontSizeSmall:N,tableSelectionColumnWidth:A,tableExpandIconBg:T,tableExpandColumnWidth:P(r).add(P(n.padding).mul(2)).equal(),tableExpandedRowBg:h,tableFilterDropdownWidth:120,tableFilterDropdownHeight:264,tableFilterDropdownSearchWidth:140,tableScrollThumbSize:8,tableScrollThumbBg:O,tableScrollThumbBgHover:e,tableScrollBg:t});return[$4(M),v4(M),Hw(M),C4(M),m4(M),d4(M),x4(M),p4(M),Hw(M),f4(M),y4(M),g4(M),S4(M),h4(M),w4(M),b4(M),I4(M)]},E4,{unitless:{expandIconScale:!0}}),k4=[],D4=(n,e)=>{var t,i;const{prefixCls:r,className:o,rootClassName:s,style:a,size:l,bordered:c,dropdownPrefixCls:u,dataSource:d,pagination:f,rowSelection:h,rowKey:p="key",rowClassName:m,columns:g,children:v,childrenColumnName:x,onChange:b,getPopupContainer:w,loading:y,expandIcon:C,expandable:$,expandedRowRender:I,expandIconColumnIndex:E,indentSize:N,scroll:k,sortDirections:D,locale:_,showSorterTooltip:R={target:"full-header"},virtual:T}=n;pv();const A=S.useMemo(()=>g||ex(v),[g,v]),O=S.useMemo(()=>A.some(qe=>qe.responsive),[A]),P=xv(O),M=S.useMemo(()=>{const qe=new Set(Object.keys(P).filter(et=>P[et]));return A.filter(et=>!et.responsive||et.responsive.some(pt=>qe.has(pt)))},[A,P]),z=Da(n,["className","style","columns"]),{locale:L=iA,direction:W,table:U,renderEmpty:V,getPrefixCls:H,getPopupContainer:Y}=S.useContext(Nn),Q=Ns(l),Z=Object.assign(Object.assign({},L.Table),_),pe=d||k4,oe=H("table",r),X=H("dropdown",u),[,j]=Wl(),ne=Ta(oe),[se,ce,re]=N4(oe,ne),be=Object.assign(Object.assign({childrenColumnName:x,expandIconColumnIndex:E},$),{expandIcon:(t=$==null?void 0:$.expandIcon)!==null&&t!==void 0?t:(i=U==null?void 0:U.expandable)===null||i===void 0?void 0:i.expandIcon}),{childrenColumnName:Ie="children"}=be,Ee=S.useMemo(()=>pe.some(qe=>qe==null?void 0:qe[Ie])?"nest":I||$!=null&&$.expandedRowRender?"row":null,[pe]),Se={body:S.useRef()},fe=IW(oe),ge=S.useRef(null),we=S.useRef(null);CW(e,()=>Object.assign(Object.assign({},we.current),{nativeElement:ge.current}));const ve=S.useMemo(()=>typeof p=="function"?p:qe=>qe==null?void 0:qe[p],[p]),[Ne]=n4(pe,Ie,ve),Ae={},Ve=function(qe,et){let pt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var dt,Xt,un,An;const dn=Object.assign(Object.assign({},Ae),qe);pt&&((dt=Ae.resetPagination)===null||dt===void 0||dt.call(Ae),!((Xt=dn.pagination)===null||Xt===void 0)&&Xt.current&&(dn.pagination.current=1),f&&((un=f.onChange)===null||un===void 0||un.call(f,1,(An=dn.pagination)===null||An===void 0?void 0:An.pageSize))),k&&k.scrollToFirstRowOnChange!==!1&&Se.body.current&&rA(0,{getContainer:()=>Se.body.current}),b==null||b(dn.pagination,dn.filters,dn.sorter,{currentDataSource:dg(fg(pe,dn.sorterStates,Ie),dn.filterStates,Ie),action:et})},Ue=(qe,et)=>{Ve({sorter:qe,sorterStates:et},"sort",!1)},[We,Le,lt,ot]=a4({prefixCls:oe,mergedColumns:M,onSorterChange:Ue,sortDirections:D||["ascend","descend"],tableLocale:Z,showSorterTooltip:R}),Me=S.useMemo(()=>fg(pe,Le,Ie),[pe,Le]);Ae.sorter=ot(),Ae.sorterStates=Le;const Fe=(qe,et)=>{Ve({filters:qe,filterStates:et},"filter",!0)},[Ke,Lt,Nt]=t4({prefixCls:oe,locale:Z,dropdownPrefixCls:X,mergedColumns:M,onFilterChange:Fe,getPopupContainer:w||Y,rootClassName:ye(s,ne)}),Dt=dg(Me,Lt,Ie);Ae.filters=Nt,Ae.filterStates=Lt;const kt=S.useMemo(()=>{const qe={};return Object.keys(Nt).forEach(et=>{Nt[et]!==null&&(qe[et]=Nt[et])}),Object.assign(Object.assign({},lt),{filters:qe})},[lt,Nt]),[_n]=l4(kt),oi=(qe,et)=>{Ve({pagination:Object.assign(Object.assign({},Ae.pagination),{current:qe,pageSize:et})},"paginate")},[zt,yi]=o4(Dt.length,oi,f);Ae.pagination=f===!1?{}:r4(zt,f),Ae.resetPagination=yi;const on=S.useMemo(()=>{if(f===!1||!zt.pageSize)return Dt;const{current:qe=1,total:et,pageSize:pt=H$}=zt;return Dt.length<et?Dt.length>pt?Dt.slice((qe-1)*pt,qe*pt):Dt:Dt.slice((qe-1)*pt,qe*pt)},[!!f,Dt,zt==null?void 0:zt.current,zt==null?void 0:zt.pageSize,zt==null?void 0:zt.total]),[bn,Zt]=yW({prefixCls:oe,data:Dt,pageData:on,getRowKey:ve,getRecordByKey:Ne,expandType:Ee,childrenColumnName:Ie,locale:Z,getPopupContainer:w||Y},h),Un=(qe,et,pt)=>{let dt;return typeof m=="function"?dt=ye(m(qe,et,pt)):dt=ye(m),ye({[`${oe}-row-selected`]:Zt.has(ve(qe,et))},dt)};be.__PARENT_RENDER_ICON__=be.expandIcon,be.expandIcon=be.expandIcon||C||SW(Z),Ee==="nest"&&be.expandIconColumnIndex===void 0?be.expandIconColumnIndex=h?1:0:be.expandIconColumnIndex>0&&h&&(be.expandIconColumnIndex-=1),typeof be.indentSize!="number"&&(be.indentSize=typeof N=="number"?N:15);const Yt=S.useCallback(qe=>_n(bn(Ke(We(qe)))),[We,Ke,bn]);let xt,pn;if(f!==!1&&(zt!=null&&zt.total)){let qe;zt.size?qe=zt.size:qe=Q==="small"||Q==="middle"?"small":void 0;const et=Xt=>S.createElement(h$,Object.assign({},zt,{className:ye(`${oe}-pagination ${oe}-pagination-${Xt}`,zt.className),size:qe})),pt=W==="rtl"?"left":"right",{position:dt}=zt;if(dt!==null&&Array.isArray(dt)){const Xt=dt.find(dn=>dn.includes("top")),un=dt.find(dn=>dn.includes("bottom")),An=dt.every(dn=>`${dn}`=="none");!Xt&&!un&&!An&&(pn=et(pt)),Xt&&(xt=et(Xt.toLowerCase().replace("top",""))),un&&(pn=et(un.toLowerCase().replace("bottom","")))}else pn=et(pt)}let _t;typeof y=="boolean"?_t={spinning:y}:typeof y=="object"&&(_t=Object.assign({spinning:!0},y));const Te=ye(re,ne,`${oe}-wrapper`,U==null?void 0:U.className,{[`${oe}-wrapper-rtl`]:W==="rtl"},o,s,ce),Ge=Object.assign(Object.assign({},U==null?void 0:U.style),a),Ze=typeof(_==null?void 0:_.emptyText)<"u"?_.emptyText:(V==null?void 0:V("Table"))||S.createElement(zv,{componentName:"Table"}),it=T?u4:c4,ft={},Ot=S.useMemo(()=>{const{fontSize:qe,lineHeight:et,padding:pt,paddingXS:dt,paddingSM:Xt}=j,un=Math.floor(qe*et);switch(Q){case"large":return pt*2+un;case"small":return dt*2+un;default:return Xt*2+un}},[j,Q]);return T&&(ft.listItemHeight=Ot),se(S.createElement("div",{ref:ge,className:Te,style:Ge},S.createElement(w1,Object.assign({spinning:!1},_t),xt,S.createElement(it,Object.assign({},ft,z,{ref:we,columns:M,direction:W,expandable:be,prefixCls:oe,className:ye({[`${oe}-middle`]:Q==="middle",[`${oe}-small`]:Q==="small",[`${oe}-bordered`]:c,[`${oe}-empty`]:pe.length===0},re,ne,ce),data:on,rowKey:ve,rowClassName:Un,emptyText:Ze,internalHooks:cu,internalRefs:Se,transformColumns:Yt,getContainerWidth:fe})),pn)))},T4=S.forwardRef(D4),R4=(n,e)=>{const t=S.useRef(0);return t.current+=1,S.createElement(T4,Object.assign({},n,{ref:e,_renderTimes:t.current}))},Jo=S.forwardRef(R4);Jo.SELECTION_COLUMN=rs;Jo.EXPAND_COLUMN=os;Jo.SELECTION_ALL=sg;Jo.SELECTION_INVERT=ag;Jo.SELECTION_NONE=lg;Jo.Column=cW;Jo.ColumnGroup=uW;Jo.Summary=y$;const Od=6e4,Pd=3e4,_4=1,jw="competitions",ha="robots",Nl="generations",ax="by-competition-start",A4="by-id",Kw="competitionStart",pg="id",O4="by-name",P4="by-score",Xw="name",M4="score",qw="__DB-COMPETITIONS-SYNC",F4=$1(async()=>{const n=new ou,e=Td(()=>sM(L4).pipe(aM(),Xs(t=>UP(af(t),yF(qw).pipe(Sl(()=>t)),n.pipe(Sl(()=>t))))),{resetDelay:Pd,removeDelay:Od});return{getCompetitionsStarts$:Td(()=>e().pipe(Xs(t=>ra(z4(t)))),{resetDelay:Pd,removeDelay:Od}),getGenerations$:Td(t=>e().pipe(Xs(i=>ra(B4(i,t)))),{normalize:([t])=>t,resetDelay:Pd,removeDelay:Od}),addGeneration$:(t,i)=>lI(e().pipe(Xs(r=>W4(r,t,i)),bF(qw),su(()=>n.next()))),getRobot$:Td(t=>e().pipe(Xs(i=>ra(V4(i,t))),dI(1)),{normalize:([t])=>t,resetDelay:Pd,removeDelay:Od})}});async function L4(n){const e=Math.max(await SF(jw)??0,_4);return CF(jw,e,{async blocked(){await n(sh.Blocked)},async blocking(){await n(sh.Blocking)},async terminated(){await n(sh.Terminated)},upgrade(t,i){if(i<1){const r=t.createObjectStore(Nl,{keyPath:[Kw,pg]});r.createIndex(ax,Kw),r.createIndex(A4,pg);const o=t.createObjectStore(ha,{keyPath:Xw});o.createIndex(O4,Xw),o.createIndex(P4,M4)}}})}async function z4(n){const t=n.transaction(Nl,"readonly").objectStore(Nl).index(ax);if(await t.count()===0)return[];let i=await t.openCursor(null,"prevunique");const r=[];for(;!$t(i);)r.push(i.key),i=await i.continue();return r}async function B4(n,e){const r=await n.transaction(Nl,"readonly").objectStore(Nl).index(ax).getAll(e),o=P1(r,pg),s=n.transaction(ha,"readonly"),a=new Set;for(const{robotNames:c}of o)for(const u of c)a.add(u);const l=new Map;for(const c of a){const u=await s.objectStore(ha).get(c);if($t(u))throw new Error(`Robot "${c}" is not found`);l.set(c,u)}return o.map(({robotNames:c,id:u,maxScore:d})=>({id:u,maxScore:d,players:jO(c.map(f=>{const h=l.get(f);return{name:h.name,modelUrl:h.modelUrl,score:h.score}}),({score:f})=>-f)}))}function V4(n,e){return n.transaction(ha,"readonly").objectStore(ha).get(e)}async function W4(n,e,t){for(const i of t.players){const r=await n.get(ha,i.name);await n.put(ha,{type:"TensorFlow",name:i.name,modelUrl:i.modelUrl,score:$t(r)?i.score:Math.max(r.score,i.score)})}await n.put(Nl,{competitionStart:e,id:t.id,maxScore:t.maxScore,robotNames:t.players.map(({name:i})=>i)})}class K${}class hs extends K${constructor(e,t,i){super(),this.viewId=e,this.groupId=t,this.panelId=i}}class _c extends K${constructor(e,t){super(),this.viewId=e,this.paneId=t}}class So{constructor(){}static getInstance(){return So.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,t){t&&(this.data=e,this.proto=t)}}So.INSTANCE=new So;function Ci(){const n=So.getInstance();if(n.hasData(hs.prototype))return n.getData(hs.prototype)[0]}function mc(){const n=So.getInstance();if(n.hasData(_c.prototype))return n.getData(_c.prototype)[0]}var sa;(function(n){n.any=(...e)=>t=>{const i=e.map(r=>r(t));return{dispose:()=>{i.forEach(r=>{r.dispose()})}}}})(sa||(sa={}));class lx{constructor(){this._defaultPrevented=!1}get defaultPrevented(){return this._defaultPrevented}preventDefault(){this._defaultPrevented=!0}}class G4{constructor(){this.events=new Map}get size(){return this.events.size}add(e,t){this.events.set(e,t)}delete(e){this.events.delete(e)}clear(){this.events.clear()}}class bh{static create(){var e;return new bh((e=new Error().stack)!==null&&e!==void 0?e:"")}constructor(e){this.value=e}print(){console.warn("dockview: stacktrace",this.value)}}class H4{constructor(e,t){this.callback=e,this.stacktrace=t}}class xe{static setLeakageMonitorEnabled(e){e!==xe.ENABLE_TRACKING&&xe.MEMORY_LEAK_WATCHER.clear(),xe.ENABLE_TRACKING=e}get value(){return this._last}constructor(e){this.options=e,this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>{var t;!((t=this.options)===null||t===void 0)&&t.replay&&this._last!==void 0&&e(this._last);const i=new H4(e,xe.ENABLE_TRACKING?bh.create():void 0);return this._listeners.push(i),{dispose:()=>{const r=this._listeners.indexOf(i);r>-1&&this._listeners.splice(r,1)}}},xe.ENABLE_TRACKING&&xe.MEMORY_LEAK_WATCHER.add(this._event,bh.create())),this._event}fire(e){this._last=e;for(const t of this._listeners)t.callback(e)}dispose(){this._disposed||(this._disposed=!0,this._listeners.length>0&&(xe.ENABLE_TRACKING&&queueMicrotask(()=>{var e;for(const t of this._listeners)console.warn("dockview: stacktrace",(e=t.stacktrace)===null||e===void 0?void 0:e.print())}),this._listeners=[]),xe.ENABLE_TRACKING&&this._event&&xe.MEMORY_LEAK_WATCHER.delete(this._event))}}xe.ENABLE_TRACKING=!1;xe.MEMORY_LEAK_WATCHER=new G4;function Lo(n,e,t,i){return n.addEventListener(e,t,i),{dispose:()=>{n.removeEventListener(e,t,i)}}}function sn(n,e,t,i){return n.addEventListener(e,t,i),{dispose:()=>{n.removeEventListener(e,t,i)}}}class Yw{constructor(){this._onFired=new xe,this._currentFireCount=0,this._queued=!1,this.onEvent=e=>{const t=this._currentFireCount;return this._onFired.event(()=>{this._currentFireCount>t&&e()})}}fire(){this._currentFireCount++,!this._queued&&(this._queued=!0,queueMicrotask(()=>{this._queued=!1,this._onFired.fire()}))}dispose(){this._onFired.dispose()}}var Pi;(function(n){n.NONE={dispose:()=>{}};function e(t){return{dispose:()=>{t()}}}n.from=e})(Pi||(Pi={}));class Et{get isDisposed(){return this._isDisposed}constructor(...e){this._isDisposed=!1,this._disposables=e}addDisposables(...e){e.forEach(t=>this._disposables.push(t))}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach(e=>e.dispose()),this._disposables=[])}}class Ji{constructor(){this._disposable=Pi.NONE}set value(e){this._disposable&&this._disposable.dispose(),this._disposable=e}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=Pi.NONE)}}function as(n,e,t={},i={},r,o){const s=typeof e=="string"?t[e]:void 0,a=typeof e=="string"?i[e]:void 0;if(s&&a)throw new Error(`Cannot create '${n}'. component '${e}' registered as both a component and frameworkComponent`);if(a){if(!r)throw new Error(`Cannot create '${n}' for framework component '${e}'. you must register a frameworkPanelWrapper to use framework components`);return r.createComponent(n,e,a)}if(!s)throw new Error(`Cannot create '${n}', no component '${e}' provided`);return new s(n,e)}function X$(n,e){const t=new ResizeObserver(i=>{requestAnimationFrame(()=>{const r=i[0];e(r)})});return t.observe(n),{dispose:()=>{t.unobserve(n),t.disconnect()}}}const Bc=(n,...e)=>{for(const t of e)n.classList.contains(t)&&n.classList.remove(t)},vf=(n,...e)=>{for(const t of e)n.classList.contains(t)||n.classList.add(t)},At=(n,e,t)=>{const i=n.classList.contains(e);t&&!i&&n.classList.add(e),!t&&i&&n.classList.remove(e)};function mg(n,e){for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function Jw(n){return Array.prototype.slice.call(document.getElementsByTagName(n),0)}function q$(n){return new U4(n)}class U4 extends Et{constructor(e){super(),this._onDidFocus=new xe,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new xe,this.onDidBlur=this._onDidBlur.event,this.addDisposables(this._onDidFocus,this._onDidBlur);let t=mg(document.activeElement,e),i=!1;const r=()=>{i=!1,t||(t=!0,this._onDidFocus.fire())},o=()=>{t&&(i=!0,window.setTimeout(()=>{i&&(i=!1,t=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{mg(document.activeElement,e)!==t&&(t?o():r())},e instanceof HTMLElement?(this.addDisposables(sn(e,"focus",r,!0)),this.addDisposables(sn(e,"blur",o,!0))):(this.addDisposables(Lo(e,"focus",r,!0)),this.addDisposables(Lo(e,"blur",o,!0)))}refreshState(){this._refreshStateHandler()}}const Y$="dv-quasiPreventDefault";function j4(n){n[Y$]=!0}function Zw(n){return n[Y$]}function K4(n,e){const t=Array.from(e);for(const i of t){if(i.href){const o=n.createElement("link");o.href=i.href,o.type=i.type,o.rel="stylesheet",n.head.appendChild(o)}let r=[];try{i.cssRules&&(r=Array.from(i.cssRules).map(o=>o.cssText))}catch{}for(const o of r){const s=n.createElement("style");s.appendChild(n.createTextNode(o)),n.head.appendChild(s)}}}function Qw(n){const{left:e,top:t,width:i,height:r}=n.getBoundingClientRect();return{left:e+window.scrollX,top:t+window.scrollY,width:i,height:r}}function X4(n){let e=n;for(;e!=null&&e.parentNode;){if(e.parentNode===document)return!0;e.parentNode instanceof DocumentFragment?e=e.parentNode.host:e=e.parentNode}return!1}function q4(n,e){n.setAttribute("data-testid",e)}function yh(){const n=[...Jw("iframe"),...Jw("webview")],e=new WeakMap;for(const t of n)e.set(t,t.style.pointerEvents),t.style.pointerEvents="none";return{release:()=>{var t;for(const i of n)i.style.pointerEvents=(t=e.get(i))!==null&&t!==void 0?t:"auto";n.splice(0,n.length)}}}function Y4(n){function e(r){const o=[];for(let s=0;s<r.classList.length;s++)o.push(r.classList.item(s));return o}let t,i=n;for(;i!==null&&(t=e(i).find(r=>r.startsWith("dockview-theme-")),typeof t!="string");)i=i.parentElement;return t}class cx{constructor(e){this.element=e,this._classNames=[]}setClassNames(e){for(const t of this._classNames)At(this.element,t,!1);this._classNames=e.split(" ").filter(t=>t.trim().length>0);for(const t of this._classNames)At(this.element,t,!0)}}function zo(n){if(n.length===0)throw new Error("Invalid tail call");return[n.slice(0,n.length-1),n[n.length-1]]}function J4(n){return n.length>0?n[n.length-1]:void 0}function J$(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function xm(n,e){const t=n.indexOf(e);t>-1&&(n.splice(t,1),n.unshift(e))}function Md(n,e){const t=n.indexOf(e);t>-1&&(n.splice(t,1),n.push(e))}function Z4(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(e(i))return t}return-1}function bm(n,e){const t=n.findIndex(i=>i===e);return t>-1?(n.splice(t,1),!0):!1}const mn=(n,e,t)=>e>t?e:Math.min(t,Math.max(n,e)),ux=()=>{let n=1;return{next:()=>(n++).toString()}},Mr=(n,e)=>{const t=[];if(typeof e!="number"&&(e=n,n=0),n<=e)for(let i=n;i<e;i++)t.push(i);else for(let i=n;i>e;i--)t.push(i);return t};class Q4{set size(e){this._size=e}get size(){return this._size}get cachedVisibleSize(){return this._cachedVisibleSize}get visible(){return typeof this._cachedVisibleSize>"u"}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,t,i,r){this.container=e,this.view=t,this.disposable=r,this._cachedVisibleSize=void 0,typeof i=="number"?(this._size=i,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=i.cachedVisibleSize)}setVisible(e,t){var i;e!==this.visible&&(e?(this.size=mn((i=this._cachedVisibleSize)!==null&&i!==void 0?i:0,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof t=="number"?t:this.size,this.size=0),this.container.classList.toggle("visible",e),this.view.setVisible&&this.view.setVisible(e))}dispose(){return this.disposable.dispose(),this.view}}var Je;(function(n){n.HORIZONTAL="HORIZONTAL",n.VERTICAL="VERTICAL"})(Je||(Je={}));var vr;(function(n){n[n.MAXIMUM=0]="MAXIMUM",n[n.MINIMUM=1]="MINIMUM",n[n.DISABLED=2]="DISABLED",n[n.ENABLED=3]="ENABLED"})(vr||(vr={}));var Kn;(function(n){n.Low="low",n.High="high",n.Normal="normal"})(Kn||(Kn={}));var wr;(function(n){n.Distribute={type:"distribute"};function e(i){return{type:"split",index:i}}n.Split=e;function t(i){return{type:"invisible",cachedVisibleSize:i}}n.Invisible=t})(wr||(wr={}));class Vc{get contentSize(){return this._contentSize}get size(){return this._size}set size(e){this._size=e}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get length(){return this.viewItems.length}get proportions(){return this._proportions?[...this._proportions]:void 0}get orientation(){return this._orientation}set orientation(e){this._orientation=e;const t=this.size;this.size=this.orthogonalSize,this.orthogonalSize=t,Bc(this.element,"horizontal","vertical"),this.element.classList.add(this.orientation==Je.HORIZONTAL?"horizontal":"vertical")}get minimumSize(){return this.viewItems.reduce((e,t)=>e+t.minimumSize,0)}get maximumSize(){return this.length===0?Number.POSITIVE_INFINITY:this.viewItems.reduce((e,t)=>e+t.maximumSize,0)}get startSnappingEnabled(){return this._startSnappingEnabled}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}get endSnappingEnabled(){return this._endSnappingEnabled}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}get disabled(){return this._disabled}set disabled(e){this._disabled=e,At(this.element,"dv-splitview-disabled",e)}get margin(){return this._margin}set margin(e){this._margin=e}constructor(e,t){var i;this.container=e,this.viewItems=[],this.sashes=[],this._size=0,this._orthogonalSize=0,this._contentSize=0,this._proportions=void 0,this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this._disabled=!1,this._margin=0,this._onDidSashEnd=new xe,this.onDidSashEnd=this._onDidSashEnd.event,this._onDidAddView=new xe,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new xe,this.onDidRemoveView=this._onDidRemoveView.event,this.resize=(r,o,s=this.viewItems.map(h=>h.size),a,l,c=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,d,f)=>{if(r<0||r>this.viewItems.length)return 0;const h=Mr(r,-1),p=Mr(r+1,this.viewItems.length);if(l)for(const R of l)xm(h,R),xm(p,R);if(a)for(const R of a)Md(h,R),Md(p,R);const m=h.map(R=>this.viewItems[R]),g=h.map(R=>s[R]),v=p.map(R=>this.viewItems[R]),x=p.map(R=>s[R]),b=h.reduce((R,T)=>R+this.viewItems[T].minimumSize-s[T],0),w=h.reduce((R,T)=>R+this.viewItems[T].maximumSize-s[T],0),y=p.length===0?Number.POSITIVE_INFINITY:p.reduce((R,T)=>R+s[T]-this.viewItems[T].minimumSize,0),C=p.length===0?Number.NEGATIVE_INFINITY:p.reduce((R,T)=>R+s[T]-this.viewItems[T].maximumSize,0),$=Math.max(b,C),I=Math.min(y,w);let E=!1;if(d){const R=this.viewItems[d.index],T=o>=d.limitDelta;E=T!==R.visible,R.setVisible(T,d.size)}if(!E&&f){const R=this.viewItems[f.index],T=o<f.limitDelta;E=T!==R.visible,R.setVisible(T,f.size)}if(E)return this.resize(r,o,s,a,l,c,u);const N=mn(o,$,I);let k=0,D=N;for(let R=0;R<m.length;R++){const T=m[R],A=mn(g[R]+D,T.minimumSize,T.maximumSize),O=A-g[R];k+=O,D-=O,T.size=A}let _=k;for(let R=0;R<v.length;R++){const T=v[R],A=mn(x[R]-_,T.minimumSize,T.maximumSize),O=A-x[R];_+=O,T.size=A}return o},this._orientation=t.orientation,this.element=this.createContainer(),this.margin=(i=t.margin)!==null&&i!==void 0?i:0,this.proportionalLayout=t.proportionalLayout===void 0?!0:!!t.proportionalLayout,this.viewContainer=this.createViewContainer(),this.sashContainer=this.createSashContainer(),this.element.appendChild(this.sashContainer),this.element.appendChild(this.viewContainer),this.container.appendChild(this.element),this.style(t.styles),t.descriptor&&(this._size=t.descriptor.size,t.descriptor.views.forEach((r,o)=>{const s=r.visible===void 0||r.visible?r.size:{type:"invisible",cachedVisibleSize:r.size},a=r.view;this.addView(a,s,o,!0)}),this._contentSize=this.viewItems.reduce((r,o)=>r+o.size,0),this.saveProportions())}style(e){(e==null?void 0:e.separatorBorder)==="transparent"?(Bc(this.element,"separator-border"),this.element.style.removeProperty("--dv-separator-border")):(vf(this.element,"separator-border"),e!=null&&e.separatorBorder&&this.element.style.setProperty("--dv-separator-border",e.separatorBorder))}isViewVisible(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].visible}setViewVisible(e,t){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");const i=this.viewItems[e];i.setVisible(t,i.size),this.distributeEmptySpace(e),this.layoutViews(),this.saveProportions()}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}resizeView(e,t){if(e<0||e>=this.viewItems.length)return;const i=Mr(this.viewItems.length).filter(a=>a!==e),r=[...i.filter(a=>this.viewItems[a].priority===Kn.Low),e],o=i.filter(a=>this.viewItems[a].priority===Kn.High),s=this.viewItems[e];t=Math.round(t),t=mn(t,s.minimumSize,Math.min(s.maximumSize,this._size)),s.size=t,this.relayout(r,o)}getViews(){return this.viewItems.map(e=>e.view)}onDidChange(e,t){const i=this.viewItems.indexOf(e);if(i<0||i>=this.viewItems.length)return;t=typeof t=="number"?t:e.size,t=mn(t,e.minimumSize,e.maximumSize),e.size=t;const r=Mr(this.viewItems.length).filter(a=>a!==i),o=[...r.filter(a=>this.viewItems[a].priority===Kn.Low),i],s=r.filter(a=>this.viewItems[a].priority===Kn.High);this.relayout([...o,i],s)}addView(e,t={type:"distribute"},i=this.viewItems.length,r){const o=document.createElement("div");o.className="view",o.appendChild(e.element);let s;typeof t=="number"?s=t:t.type==="split"?s=this.getViewSize(t.index)/2:t.type==="invisible"?s={cachedVisibleSize:t.cachedVisibleSize}:s=e.minimumSize;const a=e.onDidChange(c=>this.onDidChange(l,c.size)),l=new Q4(o,e,s,{dispose:()=>{a.dispose(),this.viewContainer.removeChild(o)}});if(i===this.viewItems.length?this.viewContainer.appendChild(o):this.viewContainer.insertBefore(o,this.viewContainer.children.item(i)),this.viewItems.splice(i,0,l),this.viewItems.length>1){const c=document.createElement("div");c.className="sash";const u=f=>{for(const T of this.viewItems)T.enabled=!1;const h=yh(),p=this._orientation===Je.HORIZONTAL?f.clientX:f.clientY,m=Z4(this.sashes,T=>T.container===c),g=this.viewItems.map(T=>T.size);let v,x;const b=Mr(m,-1),w=Mr(m+1,this.viewItems.length),y=b.reduce((T,A)=>T+(this.viewItems[A].minimumSize-g[A]),0),C=b.reduce((T,A)=>T+(this.viewItems[A].viewMaximumSize-g[A]),0),$=w.length===0?Number.POSITIVE_INFINITY:w.reduce((T,A)=>T+(g[A]-this.viewItems[A].minimumSize),0),I=w.length===0?Number.NEGATIVE_INFINITY:w.reduce((T,A)=>T+(g[A]-this.viewItems[A].viewMaximumSize),0),E=Math.max(y,I),N=Math.min($,C),k=this.findFirstSnapIndex(b),D=this.findFirstSnapIndex(w);if(typeof k=="number"){const T=this.viewItems[k],A=Math.floor(T.viewMinimumSize/2);v={index:k,limitDelta:T.visible?E-A:E+A,size:T.size}}if(typeof D=="number"){const T=this.viewItems[D],A=Math.floor(T.viewMinimumSize/2);x={index:D,limitDelta:T.visible?N+A:N-A,size:T.size}}const _=T=>{const O=(this._orientation===Je.HORIZONTAL?T.clientX:T.clientY)-p;this.resize(m,O,g,void 0,void 0,E,N,v,x),this.distributeEmptySpace(),this.layoutViews()},R=()=>{for(const T of this.viewItems)T.enabled=!0;h.release(),this.saveProportions(),document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",R),document.removeEventListener("pointercancel",R),this._onDidSashEnd.fire(void 0)};document.addEventListener("pointermove",_),document.addEventListener("pointerup",R),document.addEventListener("pointercancel",R)};c.addEventListener("pointerdown",u);const d={container:c,disposable:()=>{c.removeEventListener("pointerdown",u),this.sashContainer.removeChild(c)}};this.sashContainer.appendChild(c),this.sashes.push(d)}r||this.relayout([i]),!r&&typeof t!="number"&&t.type==="distribute"&&this.distributeViewSizes(),this._onDidAddView.fire(e)}distributeViewSizes(){const e=[];let t=0;for(const a of this.viewItems)a.maximumSize-a.minimumSize>0&&(e.push(a),t+=a.size);const i=Math.floor(t/e.length);for(const a of e)a.size=mn(i,a.minimumSize,a.maximumSize);const r=Mr(this.viewItems.length),o=r.filter(a=>this.viewItems[a].priority===Kn.Low),s=r.filter(a=>this.viewItems[a].priority===Kn.High);this.relayout(o,s)}removeView(e,t,i=!1){const r=this.viewItems.splice(e,1)[0];if(r.dispose(),this.viewItems.length>=1){const o=Math.max(e-1,0);this.sashes.splice(o,1)[0].disposable()}return i||this.relayout(),t&&t.type==="distribute"&&this.distributeViewSizes(),this._onDidRemoveView.fire(r.view),r.view}getViewCachedVisibleSize(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].cachedVisibleSize}moveView(e,t){const i=this.getViewCachedVisibleSize(e),r=typeof i>"u"?this.getViewSize(e):wr.Invisible(i),o=this.removeView(e,void 0,!0);this.addView(o,r,t)}layout(e,t){const i=Math.max(this.size,this._contentSize);if(this.size=e,this.orthogonalSize=t,this.proportions){let r=0;for(let o=0;o<this.viewItems.length;o++){const s=this.viewItems[o],a=this.proportions[o];typeof a=="number"?r+=a:e-=s.size}for(let o=0;o<this.viewItems.length;o++){const s=this.viewItems[o],a=this.proportions[o];typeof a=="number"&&r>0&&(s.size=mn(Math.round(a*e/r),s.minimumSize,s.maximumSize))}}else{const r=Mr(this.viewItems.length),o=r.filter(a=>this.viewItems[a].priority===Kn.Low),s=r.filter(a=>this.viewItems[a].priority===Kn.High);this.resize(this.viewItems.length-1,e-i,void 0,o,s)}this.distributeEmptySpace(),this.layoutViews()}relayout(e,t){const i=this.viewItems.reduce((r,o)=>r+o.size,0);this.resize(this.viewItems.length-1,this._size-i,void 0,e,t),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}distributeEmptySpace(e){const t=this.viewItems.reduce((a,l)=>a+l.size,0);let i=this.size-t;const r=Mr(this.viewItems.length-1,-1),o=r.filter(a=>this.viewItems[a].priority===Kn.Low),s=r.filter(a=>this.viewItems[a].priority===Kn.High);for(const a of s)xm(r,a);for(const a of o)Md(r,a);typeof e=="number"&&Md(r,e);for(let a=0;i!==0&&a<r.length;a++){const l=this.viewItems[r[a]],c=mn(l.size+i,l.minimumSize,l.maximumSize),u=c-l.size;i-=u,l.size=c}}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this._proportions=this.viewItems.map(e=>e.visible?e.size/this._contentSize:void 0))}layoutViews(){if(this._contentSize=this.viewItems.reduce((l,c)=>l+c.size,0),this.updateSashEnablement(),this.viewItems.length===0)return;const e=this.viewItems.filter(l=>l.visible),t=Math.max(0,e.length-1),i=this.margin*t/Math.max(1,e.length);let r=0;const o=[],s=4,a=this.viewItems.reduce((l,c,u)=>{const d=c.visible?1:0;return u===0?l.push(d):l.push(l[u-1]+d),l},[]);this.viewItems.forEach((l,c)=>{r+=this.viewItems[c].size,o.push(r);const u=l.visible?l.size-i:0,d=Math.max(0,a[c]-1),f=c===0||d===0?0:o[c-1]+d/t*i;if(c<this.viewItems.length-1){const h=l.visible?f+u-s/2+this.margin/2:f;this._orientation===Je.HORIZONTAL&&(this.sashes[c].container.style.left=`${h}px`,this.sashes[c].container.style.top="0px"),this._orientation===Je.VERTICAL&&(this.sashes[c].container.style.left="0px",this.sashes[c].container.style.top=`${h}px`)}this._orientation===Je.HORIZONTAL&&(l.container.style.width=`${u}px`,l.container.style.left=`${f}px`,l.container.style.top="",l.container.style.height=""),this._orientation===Je.VERTICAL&&(l.container.style.height=`${u}px`,l.container.style.top=`${f}px`,l.container.style.width="",l.container.style.left=""),l.view.layout(l.size-i,this._orthogonalSize)})}findFirstSnapIndex(e){for(const t of e){const i=this.viewItems[t];if(i.visible&&i.snap)return t}for(const t of e){const i=this.viewItems[t];if(i.visible&&i.maximumSize-i.minimumSize>0)return;if(!i.visible&&i.snap)return t}}updateSashEnablement(){let e=!1;const t=this.viewItems.map(l=>e=l.size-l.minimumSize>0||e);e=!1;const i=this.viewItems.map(l=>e=l.maximumSize-l.size>0||e),r=[...this.viewItems].reverse();e=!1;const o=r.map(l=>e=l.size-l.minimumSize>0||e).reverse();e=!1;const s=r.map(l=>e=l.maximumSize-l.size>0||e).reverse();let a=0;for(let l=0;l<this.sashes.length;l++){const c=this.sashes[l],u=this.viewItems[l];a+=u.size;const d=!(t[l]&&s[l+1]),f=!(i[l]&&o[l+1]);if(d&&f){const h=Mr(l,-1),p=Mr(l+1,this.viewItems.length),m=this.findFirstSnapIndex(h),g=this.findFirstSnapIndex(p),v=typeof m=="number"&&!this.viewItems[m].visible,x=typeof g=="number"&&!this.viewItems[g].visible;v&&o[l]&&(a>0||this.startSnappingEnabled)?this.updateSash(c,vr.MINIMUM):x&&t[l]&&(a<this._contentSize||this.endSnappingEnabled)?this.updateSash(c,vr.MAXIMUM):this.updateSash(c,vr.DISABLED)}else d&&!f?this.updateSash(c,vr.MINIMUM):!d&&f?this.updateSash(c,vr.MAXIMUM):this.updateSash(c,vr.ENABLED)}}updateSash(e,t){At(e.container,"disabled",t===vr.DISABLED),At(e.container,"enabled",t===vr.ENABLED),At(e.container,"maximum",t===vr.MAXIMUM),At(e.container,"minimum",t===vr.MINIMUM)}createViewContainer(){const e=document.createElement("div");return e.className="view-container",e}createSashContainer(){const e=document.createElement("div");return e.className="sash-container",e}createContainer(){const e=document.createElement("div"),t=this._orientation===Je.HORIZONTAL?"horizontal":"vertical";return e.className=`split-view-container ${t}`,e}dispose(){this._onDidSashEnd.dispose(),this._onDidAddView.dispose(),this._onDidRemoveView.dispose();for(let e=0;e<this.element.children.length;e++)if(this.element.children.item(e)===this.element){this.element.removeChild(this.element);break}for(const e of this.viewItems)e.dispose();this.element.remove()}}class eC extends Et{get onDidAddView(){return this.splitview.onDidAddView}get onDidRemoveView(){return this.splitview.onDidRemoveView}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get orientation(){return this.splitview.orientation}get size(){return this.splitview.size}get orthogonalSize(){return this.splitview.orthogonalSize}constructor(e,t){var i;super(),this.paneItems=[],this.skipAnimation=!1,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._orientation=(i=t.orientation)!==null&&i!==void 0?i:Je.VERTICAL,this.element=document.createElement("div"),this.element.className="pane-container",e.appendChild(this.element),this.splitview=new Vc(this.element,{orientation:this._orientation,proportionalLayout:!1,descriptor:t.descriptor}),this.getPanes().forEach(r=>{const o=new Et(r.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)})),s={pane:r,disposable:{dispose:()=>{o.dispose()}}};this.paneItems.push(s),r.orthogonalSize=this.splitview.orthogonalSize}),this.addDisposables(this._onDidChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire(void 0)}),this.splitview.onDidAddView(()=>{this._onDidChange.fire()}),this.splitview.onDidRemoveView(()=>{this._onDidChange.fire()}))}setViewVisible(e,t){this.splitview.setViewVisible(e,t)}addPane(e,t,i=this.splitview.length,r=!1){const o=e.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)}),s={pane:e,disposable:{dispose:()=>{o.dispose()}}};this.paneItems.splice(i,0,s),e.orthogonalSize=this.splitview.orthogonalSize,this.splitview.addView(e,t,i,r)}getViewSize(e){return this.splitview.getViewSize(e)}getPanes(){return this.splitview.getViews()}removePane(e,t={skipDispose:!1}){const i=this.paneItems.splice(e,1)[0];return this.splitview.removeView(e),t.skipDispose||(i.disposable.dispose(),i.pane.dispose()),i}moveView(e,t){if(e===t)return;const i=this.removePane(e,{skipDispose:!0});this.skipAnimation=!0;try{this.addPane(i.pane,i.pane.size,t,!1)}finally{this.skipAnimation=!1}}layout(e,t){this.splitview.layout(e,t)}setupAnimation(){this.skipAnimation||(this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),vf(this.element,"animated"),this.animationTimer=setTimeout(()=>{this.animationTimer=void 0,Bc(this.element,"animated")},200))}dispose(){super.dispose(),this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),this.paneItems.forEach(e=>{e.disposable.dispose(),e.pane.dispose()}),this.paneItems=[],this.splitview.dispose(),this.element.remove()}}class Ri{get minimumWidth(){return this.view.minimumWidth}get maximumWidth(){return this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get priority(){return this.view.priority}get snap(){return this.view.snap}get minimumSize(){return this.orientation===Je.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===Je.HORIZONTAL?this.maximumHeight:this.maximumWidth}get minimumOrthogonalSize(){return this.orientation===Je.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===Je.HORIZONTAL?this.maximumWidth:this.maximumHeight}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get element(){return this.view.element}get width(){return this.orientation===Je.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===Je.HORIZONTAL?this.size:this.orthogonalSize}constructor(e,t,i,r=0){this.view=e,this.orientation=t,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._orthogonalSize=i,this._size=r,this._disposable=this.view.onDidChange(o=>{o?this._onDidChange.fire({size:this.orientation===Je.VERTICAL?o.width:o.height,orthogonalSize:this.orientation===Je.VERTICAL?o.height:o.width}):this._onDidChange.fire({})})}setVisible(e){this.view.setVisible&&this.view.setVisible(e)}layout(e,t){this._size=e,this._orthogonalSize=t,this.view.layout(this.width,this.height)}dispose(){this._onDidChange.dispose(),this._disposable.dispose()}}class Mn extends Et{get width(){return this.orientation===Je.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===Je.HORIZONTAL?this.orthogonalSize:this.size}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get minimumWidth(){return this.orientation===Je.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===Je.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===Je.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===Je.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get priority(){if(this.children.length===0)return Kn.Normal;const e=this.children.map(t=>typeof t.priority>"u"?Kn.Normal:t.priority);return e.some(t=>t===Kn.High)?Kn.High:e.some(t=>t===Kn.Low)?Kn.Low:Kn.Normal}get disabled(){return this.splitview.disabled}set disabled(e){this.splitview.disabled=e}get margin(){return this.splitview.margin}set margin(e){this.splitview.margin=e,this.children.forEach(t=>{t instanceof Mn&&(t.margin=e)})}constructor(e,t,i,r,o,s,a,l){if(super(),this.orientation=e,this.proportionalLayout=t,this.styles=i,this._childrenDisposable=Pi.NONE,this.children=[],this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new xe,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._orthogonalSize=o,this._size=r,this.element=document.createElement("div"),this.element.className="branch-node",!l)this.splitview=new Vc(this.element,{orientation:this.orientation,proportionalLayout:t,styles:i,margin:a}),this.splitview.layout(this.size,this.orthogonalSize);else{const c={views:l.map(u=>({view:u.node,size:u.node.size,visible:u.node instanceof Ri&&u.visible!==void 0?u.visible:!0})),size:this.orthogonalSize};this.children=l.map(u=>u.node),this.splitview=new Vc(this.element,{orientation:this.orientation,descriptor:c,proportionalLayout:t,styles:i,margin:a})}this.disabled=s,this.addDisposables(this._onDidChange,this._onDidVisibilityChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire({})})),this.setupChildrenEvents()}setVisible(e){}isChildVisible(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.isViewVisible(e)}setChildVisible(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");if(this.splitview.isViewVisible(e)===t)return;const i=this.splitview.contentSize===0;this.splitview.setViewVisible(e,t);const r=this.splitview.contentSize===0;(t&&i||!t&&r)&&this._onDidVisibilityChange.fire({visible:t})}moveChild(e,t){if(e===t)return;if(e<0||e>=this.children.length)throw new Error("Invalid from index");e<t&&t--,this.splitview.moveView(e,t);const i=this._removeChild(e);this._addChild(i,t)}getChildSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewSize(e)}resizeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");this.splitview.resizeView(e,t)}layout(e,t){this._size=t,this._orthogonalSize=e,this.splitview.layout(t,e)}addChild(e,t,i,r){if(i<0||i>this.children.length)throw new Error("Invalid index");this.splitview.addView(e,t,i,r),this._addChild(e,i)}getChildCachedVisibleSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewCachedVisibleSize(e)}removeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.removeView(e,t),this._removeChild(e)}_addChild(e,t){this.children.splice(t,0,e),this.setupChildrenEvents()}_removeChild(e){const[t]=this.children.splice(e,1);return this.setupChildrenEvents(),t}setupChildrenEvents(){this._childrenDisposable.dispose(),this._childrenDisposable=new Et(sa.any(...this.children.map(e=>e.onDidChange))(e=>{this._onDidChange.fire({size:e.orthogonalSize})}),...this.children.map((e,t)=>e instanceof Mn?e.onDidVisibilityChange(({visible:i})=>{this.setChildVisible(t,i)}):Pi.NONE))}dispose(){this._childrenDisposable.dispose(),this.splitview.dispose(),this.children.forEach(e=>e.dispose()),super.dispose()}}function gg(n,e){if(n instanceof Ri)return n;if(n instanceof Mn)return gg(n.children[e?n.children.length-1:0],e);throw new Error("invalid node")}function vg(n,e,t){if(n instanceof Mn){const i=new Mn(uo(n.orientation),n.proportionalLayout,n.styles,e,t,n.disabled,n.margin);let r=0;for(let o=n.children.length-1;o>=0;o--){const s=n.children[o],a=s instanceof Mn?s.orthogonalSize:s.size;let l=n.size===0?0:Math.round(e*a/n.size);r+=l,o===0&&(l+=e-r),i.addChild(vg(s,t,l),l,0,!0)}return i}else return new Ri(n.view,uo(n.orientation),t)}function eG(n){const e=n.parentElement;if(!e)throw new Error("Invalid grid element");let t=e.firstElementChild,i=0;for(;t!==n&&t!==e.lastElementChild&&t;)t=t.nextElementSibling,i++;return i}function wn(n){const e=n.parentElement;if(!e)throw new Error("Invalid grid element");if(/\bgrid-view\b/.test(e.className))return[];const t=eG(e),i=e.parentElement.parentElement.parentElement;return[...wn(i),t]}function so(n,e,t){const i=nG(n,e),r=tG(t);if(i===r){const[o,s]=zo(e);let a=s;return(t==="right"||t==="bottom")&&(a+=1),[...o,a]}else{const o=t==="right"||t==="bottom"?1:0;return[...e,o]}}function tG(n){return n==="top"||n==="bottom"?Je.VERTICAL:Je.HORIZONTAL}function nG(n,e){return e.length%2===0?uo(n):n}const uo=n=>n===Je.HORIZONTAL?Je.VERTICAL:Je.HORIZONTAL;function iG(n){return!!n.children}const Z$=(n,e)=>{const t=e===Je.VERTICAL?n.box.width:n.box.height;return iG(n)?{type:"branch",data:n.children.map(i=>Z$(i,uo(e))),size:t}:typeof n.cachedVisibleSize=="number"?{type:"leaf",data:n.view.toJSON(),size:n.cachedVisibleSize,visible:!1}:{type:"leaf",data:n.view.toJSON(),size:t}};class rG{get length(){return this._root?this._root.children.length:0}get orientation(){return this.root.orientation}set orientation(e){if(this.root.orientation===e)return;const{size:t,orthogonalSize:i}=this.root;this.root=vg(this.root,i,t),this.root.layout(t,i)}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get locked(){return this._locked}set locked(e){this._locked=e;const t=[this.root];for(;t.length>0;){const i=t.pop();i instanceof Mn&&(i.disabled=e,t.push(...i.children))}}get margin(){return this._margin}set margin(e){this._margin=e,this.root.margin=e}maximizedView(){var e;return(e=this._maximizedNode)===null||e===void 0?void 0:e.leaf.view}hasMaximizedView(){return this._maximizedNode!==void 0}maximizeView(e){var t;const i=wn(e.element),[r,o]=this.getNode(i);if(!(o instanceof Ri)||((t=this._maximizedNode)===null||t===void 0?void 0:t.leaf)===o)return;this.hasMaximizedView()&&this.exitMaximizedView();const s=[];function a(l,c){for(let u=0;u<l.children.length;u++){const d=l.children[u];d instanceof Ri?d!==c&&(l.isChildVisible(u)?l.setChildVisible(u,!1):s.push(d)):a(d,c)}}a(this.root,o),this._maximizedNode={leaf:o,hiddenOnMaximize:s},this._onDidMaximizedNodeChange.fire()}exitMaximizedView(){if(!this._maximizedNode)return;const e=this._maximizedNode.hiddenOnMaximize;function t(i){for(let r=i.children.length-1;r>=0;r--){const o=i.children[r];o instanceof Ri?e.includes(o)||i.setChildVisible(r,!0):t(o)}}t(this.root),this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire()}serialize(){return this.hasMaximizedView()&&this.exitMaximizedView(),{root:Z$(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation}}dispose(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()}clear(){const e=this.root.orientation;this.root=new Mn(e,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)}deserialize(e,t){const i=e.orientation,r=i===Je.VERTICAL?e.height:e.width;this._deserialize(e.root,i,t,r)}_deserialize(e,t,i,r){this.root=this._deserializeNode(e,t,i,r)}_deserializeNode(e,t,i,r){var o;let s;if(e.type==="branch"){const l=e.data.map(c=>({node:this._deserializeNode(c,uo(t),i,e.size),visible:c.visible}));s=new Mn(t,this.proportionalLayout,this.styles,e.size,r,this.locked,this.margin,l)}else{const a=i.fromJSON(e);typeof e.visible=="boolean"&&((o=a.setVisible)===null||o===void 0||o.call(a,e.visible)),s=new Ri(a,t,r,e.size)}return s}get root(){return this._root}set root(e){const t=this._root;t&&(t.dispose(),this._maximizedNode=void 0,this.element.removeChild(t.element)),this._root=e,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(i=>{this._onDidChange.fire(i)})}insertOrthogonalSplitviewAtRoot(){if(!this._root)return;const e=this.root;if(e.element.remove(),this._root=new Mn(uo(e.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),e.children.length!==0)if(e.children.length===1){const t=e.children[0];e.removeChild(0).dispose(),e.dispose(),this._root.addChild(vg(t,t.orthogonalSize,t.size),wr.Distribute,0)}else this._root.addChild(e,wr.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(t=>{this._onDidChange.fire(t)})}next(e){return this.progmaticSelect(e)}previous(e){return this.progmaticSelect(e,!0)}getView(e){const t=e?this.getNode(e)[1]:this.root;return this._getViews(t,this.orientation)}_getViews(e,t,i){const r={height:e.height,width:e.width};if(e instanceof Ri)return{box:r,view:e.view,cachedVisibleSize:i};const o=[];for(let s=0;s<e.children.length;s++){const a=e.children[s],l=e.getChildCachedVisibleSize(s);o.push(this._getViews(a,uo(t),l))}return{box:r,children:o}}progmaticSelect(e,t=!1){const[i,r]=this.getNode(e);if(!(r instanceof Ri))throw new Error("invalid location");for(let o=i.length-1;o>-1;o--){const s=i[o],a=e[o]||0;if(t?a-1>-1:a+1<s.children.length)return gg(s.children[t?a-1:a+1],t)}return gg(this.root,t)}constructor(e,t,i,r,o){this.proportionalLayout=e,this.styles=t,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new Ji,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new xe,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new xe,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="grid-view",this._locked=r??!1,this._margin=o??0,this.root=new Mn(i,e,t,0,0,this.locked,this.margin)}isViewVisible(e){const[t,i]=zo(e),[,r]=this.getNode(t);if(!(r instanceof Mn))throw new Error("Invalid from location");return r.isChildVisible(i)}setViewVisible(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,r]=zo(e),[,o]=this.getNode(i);if(!(o instanceof Mn))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),o.setChildVisible(r,t)}moveView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[,r]=this.getNode(e);if(!(r instanceof Mn))throw new Error("Invalid location");r.moveChild(t,i)}addView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[r,o]=zo(i),[s,a]=this.getNode(r);if(a instanceof Mn){const l=new Ri(e,uo(a.orientation),a.orthogonalSize);a.addChild(l,t,o)}else{const[l,...c]=[...s].reverse(),[u,...d]=[...r].reverse();let f=0;const h=l.getChildCachedVisibleSize(u);typeof h=="number"&&(f=wr.Invisible(h)),l.removeChild(u).dispose();const m=new Mn(a.orientation,this.proportionalLayout,this.styles,a.size,a.orthogonalSize,this.locked,this.margin);l.addChild(m,a.size,u);const g=new Ri(a.view,l.orientation,a.size);m.addChild(g,f,0),typeof t!="number"&&t.type==="split"&&(t={type:"split",index:0});const v=new Ri(e,l.orientation,a.size);m.addChild(v,t,o)}}remove(e,t){const i=wn(e.element);return this.removeView(i,t)}removeView(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,r]=zo(e),[o,s]=this.getNode(i);if(!(s instanceof Mn))throw new Error("Invalid location");const a=s.children[r];if(!(a instanceof Ri))throw new Error("Invalid location");if(s.removeChild(r,t),a.dispose(),s.children.length!==1)return a.view;const l=s.children[0];if(o.length===0)return l instanceof Ri||(s.removeChild(0,t),this.root=l),a.view;const[c,...u]=[...o].reverse(),[d,...f]=[...i].reverse(),h=s.isChildVisible(0);s.removeChild(0,t);const p=c.children.map((m,g)=>c.getChildSize(g));if(c.removeChild(d,t).dispose(),l instanceof Mn){p.splice(d,1,...l.children.map(m=>m.size));for(let m=0;m<l.children.length;m++){const g=l.children[m];c.addChild(g,g.size,d+m)}for(;l.children.length>0;)l.removeChild(0)}else{const m=new Ri(l.view,uo(l.orientation),l.size),g=h?l.orthogonalSize:wr.Invisible(l.orthogonalSize);c.addChild(m,g,d)}l.dispose();for(let m=0;m<p.length;m++)c.resizeChild(m,p[m]);return a.view}layout(e,t){const[i,r]=this.root.orientation===Je.HORIZONTAL?[t,e]:[e,t];this.root.layout(i,r)}getNode(e,t=this.root,i=[]){if(e.length===0)return[i,t];if(!(t instanceof Mn))throw new Error("Invalid location");const[r,...o]=e;if(r<0||r>=t.children.length)throw new Error("Invalid location");const s=t.children[r];return i.push(t),this.getNode(o,s,i)}}class dx extends Et{get element(){return this._element}get disableResizing(){return this._disableResizing}set disableResizing(e){this._disableResizing=e}constructor(e,t=!1){super(),this._disableResizing=t,this._element=e,this.addDisposables(X$(this._element,i=>{if(this.isDisposed||this.disableResizing||!this._element.offsetParent||!X4(this._element))return;const{width:r,height:o}=i.contentRect;this.layout(r,o)}))}}const oG=ux();function wh(n){switch(n){case"left":return"left";case"right":return"right";case"above":return"top";case"below":return"bottom";case"within":default:return"center"}}class Q$ extends dx{get id(){return this._id}get size(){return this._groups.size}get groups(){return Array.from(this._groups.values()).map(e=>e.value)}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumHeight(){return this.gridview.minimumHeight}get maximumHeight(){return this.gridview.maximumHeight}get minimumWidth(){return this.gridview.minimumWidth}get maximumWidth(){return this.gridview.maximumWidth}get activeGroup(){return this._activeGroup}get locked(){return this.gridview.locked}set locked(e){this.gridview.locked=e}constructor(e,t){var i;super(document.createElement("div"),t.disableAutoResizing),this._id=oG.next(),this._groups=new Map,this._onDidRemove=new xe,this.onDidRemove=this._onDidRemove.event,this._onDidAdd=new xe,this.onDidAdd=this._onDidAdd.event,this._onDidActiveChange=new xe,this.onDidActiveChange=this._onDidActiveChange.event,this._bufferOnDidLayoutChange=new Yw,this.onDidLayoutChange=this._bufferOnDidLayoutChange.onEvent,this._onDidViewVisibilityChangeMicroTaskQueue=new Yw,this.onDidViewVisibilityChangeMicroTaskQueue=this._onDidViewVisibilityChangeMicroTaskQueue.onEvent,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new cx(this.element),this._classNames.setClassNames((i=t.className)!==null&&i!==void 0?i:""),e.appendChild(this.element),this.gridview=new rG(!!t.proportionalLayout,t.styles,t.orientation,t.locked,t.margin),this.gridview.locked=!!t.locked,this.element.appendChild(this.gridview.element),this.layout(0,0,!0),this.addDisposables(this.gridview.onDidViewVisibilityChange(()=>this._onDidViewVisibilityChangeMicroTaskQueue.fire()),this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.layout(this.width,this.height,!0)}),Pi.from(()=>{var r;(r=this.element.parentElement)===null||r===void 0||r.removeChild(this.element)}),this.gridview.onDidChange(()=>{this._bufferOnDidLayoutChange.fire()}),sa.any(this.onDidAdd,this.onDidRemove,this.onDidActiveChange)(()=>{this._bufferOnDidLayoutChange.fire()}),this._bufferOnDidLayoutChange)}setVisible(e,t){this.gridview.setViewVisible(wn(e.element),t),this._bufferOnDidLayoutChange.fire()}isVisible(e){return this.gridview.isViewVisible(wn(e.element))}updateOptions(e){var t,i,r,o;e.proportionalLayout,e.orientation&&(this.gridview.orientation=e.orientation),"disableResizing"in e&&(this.disableResizing=(t=e.disableAutoResizing)!==null&&t!==void 0?t:!1),"locked"in e&&(this.locked=(i=e.locked)!==null&&i!==void 0?i:!1),"margin"in e&&(this.gridview.margin=(r=e.margin)!==null&&r!==void 0?r:0),"className"in e&&this._classNames.setClassNames((o=e.className)!==null&&o!==void 0?o:"")}maximizeGroup(e){this.gridview.maximizeView(e),this.doSetGroupActive(e)}isMaximizedGroup(e){return this.gridview.maximizedView()===e}exitMaximizedGroup(){this.gridview.exitMaximizedView()}hasMaximizedGroup(){return this.gridview.hasMaximizedView()}get onDidMaximizedGroupChange(){return this.gridview.onDidMaximizedNodeChange}doAddGroup(e,t=[0],i){this.gridview.addView(e,i??wr.Distribute,t),this._onDidAdd.fire(e)}doRemoveGroup(e,t){if(!this._groups.has(e.id))throw new Error("invalid operation");const i=this._groups.get(e.id),r=this.gridview.remove(e,wr.Distribute);if(i&&!(t!=null&&t.skipDispose)&&(i.disposable.dispose(),i.value.dispose(),this._groups.delete(e.id),this._onDidRemove.fire(e)),!(t!=null&&t.skipActive)&&this._activeGroup===e){const o=Array.from(this._groups.values());this.doSetGroupActive(o.length>0?o[0].value:void 0)}return r}getPanel(e){var t;return(t=this._groups.get(e))===null||t===void 0?void 0:t.value}doSetGroupActive(e){this._activeGroup!==e&&(this._activeGroup&&this._activeGroup.setActive(!1),e&&e.setActive(!0),this._activeGroup=e,this._onDidActiveChange.fire(e))}removeGroup(e){this.doRemoveGroup(e)}moveToNext(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=wn(e.group.element),r=(t=this.gridview.next(i))===null||t===void 0?void 0:t.view;this.doSetGroupActive(r)}moveToPrevious(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=wn(e.group.element),r=(t=this.gridview.previous(i))===null||t===void 0?void 0:t.view;this.doSetGroupActive(r)}layout(e,t,i){(i||e!==this.width||t!==this.height)&&(this.gridview.element.style.height=`${t}px`,this.gridview.element.style.width=`${e}px`,this.gridview.layout(e,t))}dispose(){this._onDidActiveChange.dispose(),this._onDidAdd.dispose(),this._onDidRemove.dispose();for(const e of this.groups)e.dispose();this.gridview.dispose(),super.dispose()}}class eE{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get length(){return this.component.length}get orientation(){return this.component.orientation}get panels(){return this.component.panels}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}constructor(e){this.component=e}removePanel(e,t){this.component.removePanel(e,t)}focus(){this.component.focus()}getPanel(e){return this.component.getPanel(e)}layout(e,t){return this.component.layout(e,t)}addPanel(e){return this.component.addPanel(e)}movePanel(e,t){this.component.movePanel(e,t)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class Wc{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get panels(){return this.component.panels}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}get onDidDrop(){const e=new xe,t=this.component.onDidDrop(i=>{e.fire(Object.assign(Object.assign({},i),{api:this}))});return e.dispose=()=>{t.dispose(),e.dispose()},e.event}constructor(e){this.component=e}removePanel(e){this.component.removePanel(e)}getPanel(e){return this.component.getPanel(e)}movePanel(e,t){this.component.movePanel(e,t)}focus(){this.component.focus()}layout(e,t){this.component.layout(e,t)}addPanel(e){return this.component.addPanel(e)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class tE{get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddPanel(){return this.component.onDidAddGroup}get onDidRemovePanel(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActiveGroupChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get panels(){return this.component.groups}get orientation(){return this.component.orientation}set orientation(e){this.component.updateOptions({orientation:e})}constructor(e){this.component=e}focus(){this.component.focus()}layout(e,t,i=!1){this.component.layout(e,t,i)}addPanel(e){return this.component.addPanel(e)}removePanel(e,t){this.component.removePanel(e,t)}movePanel(e,t){this.component.movePanel(e,t)}getPanel(e){return this.component.getPanel(e)}fromJSON(e){return this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class Ch{get id(){return this.component.id}get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get size(){return this.component.size}get totalPanels(){return this.component.totalPanels}get gap(){return this.component.gap}get onDidActiveGroupChange(){return this.component.onDidActiveGroupChange}get onDidAddGroup(){return this.component.onDidAddGroup}get onDidRemoveGroup(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActivePanelChange}get onDidAddPanel(){return this.component.onDidAddPanel}get onDidRemovePanel(){return this.component.onDidRemovePanel}get onDidMovePanel(){return this.component.onDidMovePanel}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidDrop(){return this.component.onDidDrop}get onWillDrop(){return this.component.onWillDrop}get onWillShowOverlay(){return this.component.onWillShowOverlay}get onWillDragGroup(){return this.component.onWillDragGroup}get onWillDragPanel(){return this.component.onWillDragPanel}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}get panels(){return this.component.panels}get groups(){return this.component.groups}get activePanel(){return this.component.activePanel}get activeGroup(){return this.component.activeGroup}constructor(e){this.component=e}focus(){this.component.focus()}getPanel(e){return this.component.getGroupPanel(e)}layout(e,t,i=!1){this.component.layout(e,t,i)}addPanel(e){return this.component.addPanel(e)}removePanel(e){this.component.removePanel(e)}addGroup(e){return this.component.addGroup(e)}closeAllGroups(){return this.component.closeAllGroups()}removeGroup(e){this.component.removeGroup(e)}getGroup(e){return this.component.getPanel(e)}addFloatingGroup(e,t){return this.component.addFloatingGroup(e,t)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}moveToNext(e){this.component.moveToNext(e)}moveToPrevious(e){this.component.moveToPrevious(e)}maximizeGroup(e){this.component.maximizeGroup(e.group)}hasMaximizedGroup(){return this.component.hasMaximizedGroup()}exitMaximizedGroup(){this.component.exitMaximizedGroup()}get onDidMaximizedGroupChange(){return this.component.onDidMaximizedGroupChange}addPopoutGroup(e,t){return this.component.addPopoutGroup(e,t)}setGap(e){this.component.updateOptions({gap:e})}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class hx extends Et{constructor(e){super(),this.el=e,this.dataDisposable=new Ji,this.pointerEventsDisposable=new Ji,this._onDragStart=new xe,this.onDragStart=this._onDragStart.event,this.addDisposables(this._onDragStart,this.dataDisposable,this.pointerEventsDisposable),this.configure()}isCancelled(e){return!1}configure(){this.addDisposables(this._onDragStart,sn(this.el,"dragstart",e=>{if(e.defaultPrevented||this.isCancelled(e)){e.preventDefault();return}const t=yh();this.pointerEventsDisposable.value={dispose:()=>{t.release()}},this.el.classList.add("dv-dragged"),setTimeout(()=>this.el.classList.remove("dv-dragged"),0),this.dataDisposable.value=this.getData(e),this._onDragStart.fire(e),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.items.length>0||e.dataTransfer.setData("text/plain","__dockview_internal_drag_event__"))}),sn(this.el,"dragend",()=>{this.pointerEventsDisposable.dispose(),this.dataDisposable.dispose()}))}}class nE extends Et{constructor(e,t){super(),this.element=e,this.callbacks=t,this.target=null,this.registerListeners()}onDragEnter(e){this.target=e.target,this.callbacks.onDragEnter(e)}onDragOver(e){e.preventDefault(),this.callbacks.onDragOver&&this.callbacks.onDragOver(e)}onDragLeave(e){this.target===e.target&&(this.target=null,this.callbacks.onDragLeave(e))}onDragEnd(e){this.target=null,this.callbacks.onDragEnd(e)}onDrop(e){this.callbacks.onDrop(e)}registerListeners(){this.addDisposables(sn(this.element,"dragenter",e=>{this.onDragEnter(e)},!0)),this.addDisposables(sn(this.element,"dragover",e=>{this.onDragOver(e)},!0)),this.addDisposables(sn(this.element,"dragleave",e=>{this.onDragLeave(e)})),this.addDisposables(sn(this.element,"dragend",e=>{this.onDragEnd(e)})),this.addDisposables(sn(this.element,"drop",e=>{this.onDrop(e)}))}}class sG extends lx{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}constructor(e){super(),this.options=e}}function tC(n){switch(n){case"above":return"top";case"below":return"bottom";case"left":return"left";case"right":return"right";case"within":return"center";default:throw new Error(`invalid direction '${n}'`)}}function aG(n){switch(n){case"top":return"above";case"bottom":return"below";case"left":return"left";case"right":return"right";case"center":return"within";default:throw new Error(`invalid position '${n}'`)}}const lG={value:20,type:"percentage"},cG={value:50,type:"percentage"},uG=100,dG=100;class Ho extends Et{get state(){return this._state}constructor(e,t){super(),this.element=e,this.options=t,this._onDrop=new xe,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._acceptedTargetZonesSet=new Set(this.options.acceptedTargetZones),this.dnd=new nE(this.element,{onDragEnter:()=>{},onDragOver:i=>{if(this._acceptedTargetZonesSet.size===0){this.removeDropTarget();return}const r=this.element.clientWidth,o=this.element.clientHeight;if(r===0||o===0)return;const s=i.currentTarget.getBoundingClientRect(),a=i.clientX-s.left,l=i.clientY-s.top,c=this.calculateQuadrant(this._acceptedTargetZonesSet,a,l,r,o);if(this.isAlreadyUsed(i)||c===null){this.removeDropTarget();return}if(!this.options.canDisplayOverlay(i,c)){this.removeDropTarget();return}const u=new sG({nativeEvent:i,position:c});if(this._onWillShowOverlay.fire(u),u.defaultPrevented){this.removeDropTarget();return}this.markAsUsed(i),this.targetElement||(this.targetElement=document.createElement("div"),this.targetElement.className="drop-target-dropzone",this.overlayElement=document.createElement("div"),this.overlayElement.className="drop-target-selection",this._state="center",this.targetElement.appendChild(this.overlayElement),this.element.classList.add("drop-target"),this.element.append(this.targetElement)),this.toggleClasses(c,r,o),this._state=c},onDragLeave:()=>{this.removeDropTarget()},onDragEnd:()=>{this.removeDropTarget()},onDrop:i=>{i.preventDefault();const r=this._state;this.removeDropTarget(),r&&(i.stopPropagation(),this._onDrop.fire({position:r,nativeEvent:i}))}}),this.addDisposables(this._onDrop,this._onWillShowOverlay,this.dnd)}setTargetZones(e){this._acceptedTargetZonesSet=new Set(e)}setOverlayModel(e){this.options.overlayModel=e}dispose(){this.removeDropTarget(),super.dispose()}markAsUsed(e){e[Ho.USED_EVENT_ID]=!0}isAlreadyUsed(e){const t=e[Ho.USED_EVENT_ID];return typeof t=="boolean"&&t}toggleClasses(e,t,i){var r,o;if(!this.overlayElement)return;const s=t<uG,a=i<dG,l=e==="left",c=e==="right",u=e==="top",d=e==="bottom",f=!s&&c,h=!s&&l,p=!a&&u,m=!a&&d;let g=1;const v=(o=(r=this.options.overlayModel)===null||r===void 0?void 0:r.size)!==null&&o!==void 0?o:cG;v.type==="percentage"?g=mn(v.value,0,100)/100:((f||h)&&(g=mn(0,v.value,t)/t),(p||m)&&(g=mn(0,v.value,i)/i));const x={top:"0px",left:"0px",width:"100%",height:"100%"};f?(x.left=`${100*(1-g)}%`,x.width=`${100*g}%`):h?x.width=`${100*g}%`:p?x.height=`${100*g}%`:m&&(x.top=`${100*(1-g)}%`,x.height=`${100*g}%`),this.overlayElement.style.top=x.top,this.overlayElement.style.left=x.left,this.overlayElement.style.width=x.width,this.overlayElement.style.height=x.height,At(this.overlayElement,"dv-drop-target-small-vertical",a),At(this.overlayElement,"dv-drop-target-small-horizontal",s),At(this.overlayElement,"dv-drop-target-left",l),At(this.overlayElement,"dv-drop-target-right",c),At(this.overlayElement,"dv-drop-target-top",u),At(this.overlayElement,"dv-drop-target-bottom",d),At(this.overlayElement,"dv-drop-target-center",e==="center")}calculateQuadrant(e,t,i,r,o){var s,a;const l=(a=(s=this.options.overlayModel)===null||s===void 0?void 0:s.activationSize)!==null&&a!==void 0?a:lG;return l.type==="percentage"?hG(e,t,i,r,o,l.value):fG(e,t,i,r,o,l.value)}removeDropTarget(){this.targetElement&&(this._state=void 0,this.element.removeChild(this.targetElement),this.targetElement=void 0,this.overlayElement=void 0,this.element.classList.remove("drop-target"))}}Ho.USED_EVENT_ID="__dockview_droptarget_event_is_used__";function hG(n,e,t,i,r,o){const s=100*e/i,a=100*t/r;return n.has("left")&&s<o?"left":n.has("right")&&s>100-o?"right":n.has("top")&&a<o?"top":n.has("bottom")&&a>100-o?"bottom":n.has("center")?"center":null}function fG(n,e,t,i,r,o){return n.has("left")&&e<o?"left":n.has("right")&&e>i-o?"right":n.has("top")&&t<o?"top":n.has("bottom")&&t>r-o?"bottom":n.has("center")?"center":null}class iE extends lx{constructor(){super()}}class rE extends Et{get isFocused(){return this._isFocused}get isActive(){return this._isActive}get isVisible(){return this._isVisible}get width(){return this._width}get height(){return this._height}constructor(e,t){super(),this.id=e,this.component=t,this._isFocused=!1,this._isActive=!1,this._isVisible=!0,this._width=0,this._height=0,this._parameters={},this.panelUpdatesDisposable=new Ji,this._onDidDimensionChange=new xe,this.onDidDimensionsChange=this._onDidDimensionChange.event,this._onDidChangeFocus=new xe,this.onDidFocusChange=this._onDidChangeFocus.event,this._onWillFocus=new xe,this.onWillFocus=this._onWillFocus.event,this._onDidVisibilityChange=new xe,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onWillVisibilityChange=new xe,this.onWillVisibilityChange=this._onWillVisibilityChange.event,this._onDidActiveChange=new xe,this.onDidActiveChange=this._onDidActiveChange.event,this._onActiveChange=new xe,this.onActiveChange=this._onActiveChange.event,this._onDidParametersChange=new xe,this.onDidParametersChange=this._onDidParametersChange.event,this.addDisposables(this.onDidFocusChange(i=>{this._isFocused=i.isFocused}),this.onDidActiveChange(i=>{this._isActive=i.isActive}),this.onDidVisibilityChange(i=>{this._isVisible=i.isVisible}),this.onDidDimensionsChange(i=>{this._width=i.width,this._height=i.height}),this.panelUpdatesDisposable,this._onDidDimensionChange,this._onDidChangeFocus,this._onDidVisibilityChange,this._onDidActiveChange,this._onWillFocus,this._onActiveChange,this._onWillFocus,this._onWillVisibilityChange,this._onDidParametersChange)}getParameters(){return this._parameters}initialize(e){this.panelUpdatesDisposable.value=this._onDidParametersChange.event(t=>{this._parameters=t,e.update({params:t})})}setVisible(e){this._onWillVisibilityChange.fire({isVisible:e})}setActive(){this._onActiveChange.fire()}updateParameters(e){this._onDidParametersChange.fire(e)}}class oE extends rE{constructor(e,t){super(e,t),this._onDidConstraintsChangeInternal=new xe,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new xe({replay:!0}),this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new xe,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class pG extends oE{set pane(e){this._pane=e}constructor(e,t){super(e,t),this._onDidExpansionChange=new xe({replay:!0}),this.onDidExpansionChange=this._onDidExpansionChange.event,this._onMouseEnter=new xe({}),this.onMouseEnter=this._onMouseEnter.event,this._onMouseLeave=new xe({}),this.onMouseLeave=this._onMouseLeave.event,this.addDisposables(this._onDidExpansionChange,this._onMouseEnter,this._onMouseLeave)}setExpanded(e){var t;(t=this._pane)===null||t===void 0||t.setExpanded(e)}get isExpanded(){var e;return!!(!((e=this._pane)===null||e===void 0)&&e.isExpanded())}}class fx extends Et{get element(){return this._element}get width(){return this._width}get height(){return this._height}get params(){var e;return(e=this._params)===null||e===void 0?void 0:e.params}constructor(e,t,i){super(),this.id=e,this.component=t,this.api=i,this._height=0,this._width=0,this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.style.outline="none",this._element.style.height="100%",this._element.style.width="100%",this._element.style.overflow="hidden";const r=q$(this._element);this.addDisposables(this.api,r.onDidFocus(()=>{this.api._onDidChangeFocus.fire({isFocused:!0})}),r.onDidBlur(()=>{this.api._onDidChangeFocus.fire({isFocused:!1})}),r)}focus(){const e=new iE;this.api._onWillFocus.fire(e),!e.defaultPrevented&&this._element.focus()}layout(e,t){this._width=e,this._height=t,this.api._onDidDimensionChange.fire({width:e,height:t}),this.part&&this._params&&this.part.update(this._params.params)}init(e){this._params=e,this.part=this.getComponent()}update(e){var t,i;this._params=Object.assign(Object.assign({},this._params),{params:Object.assign(Object.assign({},(t=this._params)===null||t===void 0?void 0:t.params),e.params)});for(const r of Object.keys(e.params))e.params[r]===void 0&&delete this._params.params[r];(i=this.part)===null||i===void 0||i.update({params:this._params.params})}toJSON(){var e,t;const i=(t=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&t!==void 0?t:{};return{id:this.id,component:this.component,params:Object.keys(i).length>0?i:void 0}}dispose(){var e;this.api.dispose(),(e=this.part)===null||e===void 0||e.dispose(),super.dispose()}}class mG extends fx{set orientation(e){this._orientation=e}get orientation(){return this._orientation}get minimumSize(){const e=this.headerSize,i=this.isExpanded()?this._minimumBodySize:0;return e+i}get maximumSize(){const e=this.headerSize,i=this.isExpanded()?this._maximumBodySize:0;return e+i}get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(e){this._minimumBodySize=typeof e=="number"?e:0}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(e){this._maximumBodySize=typeof e=="number"?e:Number.POSITIVE_INFINITY}get headerVisible(){return this._headerVisible}set headerVisible(e){this._headerVisible=e,this.header.style.display=e?"":"none"}constructor(e,t,i,r,o,s){super(e,t,new pG(e,t)),this.headerComponent=i,this._onDidChangeExpansionState=new xe({replay:!0}),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this.headerSize=22,this._orthogonalSize=0,this._size=0,this._minimumBodySize=100,this._maximumBodySize=Number.POSITIVE_INFINITY,this._isExpanded=!1,this.expandedSize=0,this.api.pane=this,this.api.initialize(this),this._isExpanded=o,this._headerVisible=s,this._onDidChangeExpansionState.fire(this.isExpanded()),this._orientation=r,this.element.classList.add("pane"),this.addDisposables(this.api.onWillVisibilityChange(a=>{const{isVisible:l}=a,{accessor:c}=this._params;c.setVisible(this,l)}),this.api.onDidSizeChange(a=>{this._onDidChange.fire({size:a.size})}),sn(this.element,"mouseenter",a=>{this.api._onMouseEnter.fire(a)}),sn(this.element,"mouseleave",a=>{this.api._onMouseLeave.fire(a)})),this.addDisposables(this._onDidChangeExpansionState,this.onDidChangeExpansionState(a=>{this.api._onDidExpansionChange.fire({isExpanded:a})}),this.api.onDidFocusChange(a=>{this.header&&(a.isFocused?vf(this.header,"focused"):Bc(this.header,"focused"))})),this.renderOnce()}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}isExpanded(){return this._isExpanded}setExpanded(e){this._isExpanded!==e&&(this._isExpanded=e,e?(this.animationTimer&&clearTimeout(this.animationTimer),this.body&&this.element.appendChild(this.body)):this.animationTimer=setTimeout(()=>{var t;(t=this.body)===null||t===void 0||t.remove()},200),this._onDidChange.fire(e?{size:this.width}:{}),this._onDidChangeExpansionState.fire(e))}layout(e,t){this._size=e,this._orthogonalSize=t;const[i,r]=this.orientation===Je.HORIZONTAL?[e,t]:[t,e];this.isExpanded()&&(this.expandedSize=i),super.layout(i,r)}init(e){var t,i;super.init(e),typeof e.minimumBodySize=="number"&&(this.minimumBodySize=e.minimumBodySize),typeof e.maximumBodySize=="number"&&(this.maximumBodySize=e.maximumBodySize),this.bodyPart=this.getBodyComponent(),this.headerPart=this.getHeaderComponent(),this.bodyPart.init(Object.assign(Object.assign({},e),{api:this.api})),this.headerPart.init(Object.assign(Object.assign({},e),{api:this.api})),(t=this.body)===null||t===void 0||t.append(this.bodyPart.element),(i=this.header)===null||i===void 0||i.append(this.headerPart.element),typeof e.isExpanded=="boolean"&&this.setExpanded(e.isExpanded)}toJSON(){const e=this._params;return Object.assign(Object.assign({},super.toJSON()),{headerComponent:this.headerComponent,title:e.title})}renderOnce(){this.header=document.createElement("div"),this.header.tabIndex=0,this.header.className="pane-header",this.header.style.height=`${this.headerSize}px`,this.header.style.lineHeight=`${this.headerSize}px`,this.header.style.minHeight=`${this.headerSize}px`,this.header.style.maxHeight=`${this.headerSize}px`,this.element.appendChild(this.header),this.body=document.createElement("div"),this.body.className="pane-body",this.element.appendChild(this.body)}getComponent(){return{update:e=>{var t,i;(t=this.bodyPart)===null||t===void 0||t.update({params:e}),(i=this.headerPart)===null||i===void 0||i.update({params:e})},dispose:()=>{var e,t;(e=this.bodyPart)===null||e===void 0||e.dispose(),(t=this.headerPart)===null||t===void 0||t.dispose()}}}}class gG extends mG{constructor(e,t,i,r,o,s,a){super(t,i,r,o,s,!0),this.accessor=e,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,a||this.initDragFeatures()}initDragFeatures(){if(!this.header)return;const e=this.id,t=this.accessor.id;this.header.draggable=!0,this.handler=new class extends hx{getData(){return So.getInstance().setData([new _c(t,e)],_c.prototype),{dispose:()=>{So.getInstance().clearData(_c.prototype)}}}}(this.header),this.target=new Ho(this.element,{acceptedTargetZones:["top","bottom"],overlayModel:{activationSize:{type:"percentage",value:50}},canDisplayOverlay:i=>{const r=mc();return r&&r.paneId!==this.id&&r.viewId===this.accessor.id?!0:this.accessor.options.showDndOverlay?this.accessor.options.showDndOverlay({nativeEvent:i,getData:mc,panel:this}):!1}}),this.addDisposables(this._onDidDrop,this.handler,this.target,this.target.onDrop(i=>{this.onDrop(i)}))}onDrop(e){const t=mc();if(!t||t.viewId!==this.accessor.id){this._onDidDrop.fire(Object.assign(Object.assign({},e),{panel:this,api:new Wc(this.accessor),getData:mc}));return}const i=this._params.containerApi,r=t.paneId,o=i.getPanel(r);if(!o){this._onDidDrop.fire(Object.assign(Object.assign({},e),{panel:this,getData:mc,api:new Wc(this.accessor)}));return}const s=i.panels,a=s.indexOf(o);let l=i.panels.indexOf(this);(e.position==="left"||e.position==="top")&&(l=Math.max(0,l-1)),(e.position==="right"||e.position==="bottom")&&(a>l&&l++,l=Math.min(s.length-1,l)),i.movePanel(a,l)}}class vG extends Et{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this.disposable=new Ji,this._onDidFocus=new xe,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new xe,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="content-container",this._element.tabIndex=-1,this.addDisposables(this._onDidFocus,this._onDidBlur),this.dropTarget=new Ho(this.element,{acceptedTargetZones:["top","bottom","left","right","center"],canDisplayOverlay:(i,r)=>{if(this.group.locked==="no-drop-target"||this.group.locked&&r==="center")return!1;const o=Ci();return!o&&i.shiftKey&&this.group.location.type!=="floating"?!1:o&&o.viewId===this.accessor.id?o.groupId===this.group.id&&(r==="center"||o.panelId===null)?!1:!(this.group.panels.length===1&&o.groupId===this.group.id):this.group.canDisplayOverlay(i,r,"content")}}),this.addDisposables(this.dropTarget)}show(){this.element.style.display=""}hide(){this.element.style.display="none"}renderPanel(e,t={asActive:!0}){const i=t.asActive||this.panel&&this.group.isPanelActive(this.panel);this.panel&&this.panel.view.content.element.parentElement===this._element&&this._element.removeChild(this.panel.view.content.element),this.panel=e;let r;switch(e.api.renderer){case"onlyWhenVisible":this.group.renderContainer.detatch(e),this.panel&&i&&this._element.appendChild(this.panel.view.content.element),r=this._element;break;case"always":e.view.content.element.parentElement===this._element&&this._element.removeChild(e.view.content.element),r=this.group.renderContainer.attach({panel:e,referenceContainer:this});break}if(i){const o=q$(r),s=new Et;s.addDisposables(o,o.onDidFocus(()=>this._onDidFocus.fire()),o.onDidBlur(()=>this._onDidBlur.fire())),this.disposable.value=s}}openPanel(e){this.panel!==e&&this.renderPanel(e)}layout(e,t){}closePanel(){var e;this.panel&&this.panel.api.renderer==="onlyWhenVisible"&&((e=this.panel.view.content.element.parentElement)===null||e===void 0||e.removeChild(this.panel.view.content.element)),this.panel=void 0}dispose(){this.disposable.dispose(),super.dispose()}}class xG extends hx{constructor(e,t,i,r){super(e),this.accessor=t,this.group=i,this.panel=r,this.panelTransfer=So.getInstance()}getData(e){return this.panelTransfer.setData([new hs(this.accessor.id,this.group.id,this.panel.id)],hs.prototype),{dispose:()=>{this.panelTransfer.clearData(hs.prototype)}}}}class bG extends Et{get element(){return this._element}constructor(e,t,i){super(),this.panel=e,this.accessor=t,this.group=i,this.content=void 0,this._onChanged=new xe,this.onChanged=this._onChanged.event,this._onDropped=new xe,this.onDrop=this._onDropped.event,this._onDragStart=new xe,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="tab",this._element.tabIndex=0,this._element.draggable=!0,At(this.element,"inactive-tab",!0);const r=new xG(this._element,this.accessor,this.group,this.panel);this.dropTarget=new Ho(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(o,s)=>{if(this.group.locked)return!1;const a=Ci();return a&&this.accessor.id===a.viewId?a.panelId===null&&a.groupId===this.group.id?!1:this.panel.id!==a.panelId:this.group.model.canDisplayOverlay(o,s,"tab")}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this._onChanged,this._onDropped,this._onDragStart,r.onDragStart(o=>{this._onDragStart.fire(o)}),r,sn(this._element,"pointerdown",o=>{o.defaultPrevented||this._onChanged.fire(o)}),this.dropTarget.onDrop(o=>{this._onDropped.fire(o)}),this.dropTarget)}setActive(e){At(this.element,"active-tab",e),At(this.element,"inactive-tab",!e)}setContent(e){this.content&&this._element.removeChild(this.content.element),this.content=e,this._element.appendChild(this.content.element)}dispose(){super.dispose()}}function yG(n,e){vf(e,"dv-dragged"),document.body.appendChild(e),n.setDragImage(e,0,0),setTimeout(()=>{Bc(e,"dv-dragged"),e.remove()},0)}class wG extends hx{constructor(e,t,i){super(e),this.accessor=t,this.group=i,this.panelTransfer=So.getInstance(),this.addDisposables(sn(e,"pointerdown",r=>{r.shiftKey&&j4(r)},!0))}isCancelled(e){return this.group.api.location.type==="floating"&&!e.shiftKey}getData(e){const t=e.dataTransfer;this.panelTransfer.setData([new hs(this.accessor.id,this.group.id,null)],hs.prototype);const i=window.getComputedStyle(this.el),r=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-background-color"),o=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-color");if(t){const s=document.createElement("div");s.style.backgroundColor=r,s.style.color=o,s.style.padding="2px 8px",s.style.height="24px",s.style.fontSize="11px",s.style.lineHeight="20px",s.style.borderRadius="12px",s.style.position="absolute",s.textContent=`Multiple Panels (${this.group.size})`,yG(t,s)}return{dispose:()=>{this.panelTransfer.clearData(hs.prototype)}}}}class CG extends Et{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._onDrop=new xe,this.onDrop=this._onDrop.event,this._onDragStart=new xe,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="void-container",this._element.tabIndex=0,this._element.draggable=!0,this.addDisposables(this._onDrop,this._onDragStart,sn(this._element,"pointerdown",()=>{this.accessor.doSetGroupActive(this.group)}));const i=new wG(this._element,e,t);this.dropTraget=new Ho(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(r,o)=>{var s;const a=Ci();return a&&this.accessor.id===a.viewId?a.panelId===null&&a.groupId===this.group.id?!1:((s=J4(this.group.panels))===null||s===void 0?void 0:s.id)!==a.panelId:t.model.canDisplayOverlay(r,o,"header_space")}}),this.onWillShowOverlay=this.dropTraget.onWillShowOverlay,this.addDisposables(i,i.onDragStart(r=>{this._onDragStart.fire(r)}),this.dropTraget.onDrop(r=>{this._onDrop.fire(r)}),this.dropTraget)}}class SG extends Et{get panels(){return this.tabs.map(e=>e.value.panel.id)}get size(){return this.tabs.length}get hidden(){return this._hidden}set hidden(e){this._hidden=e,this.element.style.display=e?"none":""}show(){this.hidden||(this.element.style.display="")}hide(){this._element.style.display="none"}setRightActionsElement(e){this.rightActions!==e&&(this.rightActions&&(this.rightActions.remove(),this.rightActions=void 0),e&&(this.rightActionsContainer.appendChild(e),this.rightActions=e))}setLeftActionsElement(e){this.leftActions!==e&&(this.leftActions&&(this.leftActions.remove(),this.leftActions=void 0),e&&(this.leftActionsContainer.appendChild(e),this.leftActions=e))}setPrefixActionsElement(e){this.preActions!==e&&(this.preActions&&(this.preActions.remove(),this.preActions=void 0),e&&(this.preActionsContainer.appendChild(e),this.preActions=e))}get element(){return this._element}isActive(e){return this.selectedIndex>-1&&this.tabs[this.selectedIndex].value===e}indexOf(e){return this.tabs.findIndex(t=>t.value.panel.id===e)}constructor(e,t){super(),this.accessor=e,this.group=t,this.tabs=[],this.selectedIndex=-1,this._hidden=!1,this._onDrop=new xe,this.onDrop=this._onDrop.event,this._onTabDragStart=new xe,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new xe,this.onGroupDragStart=this._onGroupDragStart.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._element=document.createElement("div"),this._element.className="tabs-and-actions-container",At(this._element,"dv-full-width-single-tab",this.accessor.options.singleTabMode==="fullwidth"),this.rightActionsContainer=document.createElement("div"),this.rightActionsContainer.className="right-actions-container",this.leftActionsContainer=document.createElement("div"),this.leftActionsContainer.className="left-actions-container",this.preActionsContainer=document.createElement("div"),this.preActionsContainer.className="pre-actions-container",this.tabContainer=document.createElement("div"),this.tabContainer.className="tabs-container",this.voidContainer=new CG(this.accessor,this.group),this._element.appendChild(this.preActionsContainer),this._element.appendChild(this.tabContainer),this._element.appendChild(this.leftActionsContainer),this._element.appendChild(this.voidContainer.element),this._element.appendChild(this.rightActionsContainer),this.addDisposables(this.accessor.onDidAddPanel(i=>{i.api.group===this.group&&At(this._element,"dv-single-tab",this.size===1)}),this.accessor.onDidRemovePanel(i=>{i.api.group===this.group&&At(this._element,"dv-single-tab",this.size===1)}),this._onWillShowOverlay,this._onDrop,this._onTabDragStart,this._onGroupDragStart,this.voidContainer,this.voidContainer.onDragStart(i=>{this._onGroupDragStart.fire({nativeEvent:i,group:this.group})}),this.voidContainer.onDrop(i=>{this._onDrop.fire({event:i.nativeEvent,index:this.tabs.length})}),this.voidContainer.onWillShowOverlay(i=>{this._onWillShowOverlay.fire(new Sh(i,{kind:"header_space",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:Ci}))}),sn(this.voidContainer.element,"pointerdown",i=>{if(!this.accessor.options.disableFloatingGroups&&i.shiftKey&&this.group.api.location.type!=="floating"){i.preventDefault();const{top:o,left:s}=this.element.getBoundingClientRect(),{top:a,left:l}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(this.group,{x:s-l+20,y:o-a+20,inDragMode:!0})}}),sn(this.tabContainer,"pointerdown",i=>{if(i.defaultPrevented)return;i.button===0&&this.accessor.doSetGroupActive(this.group)}))}setActive(e){}addTab(e,t=this.tabs.length){if(t<0||t>this.tabs.length)throw new Error("invalid location");this.tabContainer.insertBefore(e.value.element,this.tabContainer.children[t]),this.tabs=[...this.tabs.slice(0,t),e,...this.tabs.slice(t)],this.selectedIndex<0&&(this.selectedIndex=t)}delete(e){const t=this.tabs.findIndex(s=>s.value.panel.id===e),i=this.tabs.splice(t,1)[0],{value:r,disposable:o}=i;o.dispose(),r.dispose(),r.element.remove()}setActivePanel(e){this.tabs.forEach(t=>{const i=e.id===t.value.panel.id;t.value.setActive(i)})}openPanel(e,t=this.tabs.length){var i;if(this.tabs.find(a=>a.value.panel.id===e.id))return;const r=new bG(e,this.accessor,this.group);if(!(!((i=e.view)===null||i===void 0)&&i.tab))throw new Error("invalid header component");r.setContent(e.view.tab);const o=new Et(r.onDragStart(a=>{this._onTabDragStart.fire({nativeEvent:a,panel:e})}),r.onChanged(a=>{const l=!this.accessor.options.disableFloatingGroups,c=this.group.api.location.type==="floating"&&this.size===1;if(l&&!c&&a.shiftKey){a.preventDefault();const d=this.accessor.getGroupPanel(r.panel.id),{top:f,left:h}=r.element.getBoundingClientRect(),{top:p,left:m}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(d,{x:h-m,y:f-p,inDragMode:!0});return}!(a.button===0)||a.defaultPrevented||this.group.activePanel!==e&&this.group.model.openPanel(e)}),r.onDrop(a=>{this._onDrop.fire({event:a.nativeEvent,index:this.tabs.findIndex(l=>l.value===r)})}),r.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(new Sh(a,{kind:"tab",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:Ci}))})),s={value:r,disposable:o};this.addTab(s,t)}closePanel(e){this.delete(e.id)}dispose(){super.dispose();for(const{value:e,disposable:t}of this.tabs)t.dispose(),e.dispose();this.tabs=[]}}class sE{get isAccepted(){return this._isAccepted}constructor(e,t,i,r,o){this.nativeEvent=e,this.target=t,this.position=i,this.getData=r,this.group=o,this._isAccepted=!1}accept(){this._isAccepted=!0}}const xg=Object.keys({disableAutoResizing:void 0,hideBorders:void 0,singleTabMode:void 0,disableFloatingGroups:void 0,floatingGroupBounds:void 0,popoutUrl:void 0,defaultRenderer:void 0,debug:void 0,rootOverlayModel:void 0,locked:void 0,disableDnd:void 0,gap:void 0,className:void 0});function IG(n){return!!n.referencePanel}function $G(n){return!!n.referenceGroup}function EG(n){return!!n.referencePanel}function NG(n){return!!n.referenceGroup}class px extends lx{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}get panel(){return this.options.panel}get group(){return this.options.group}get api(){return this.options.api}constructor(e){super(),this.options=e}getData(){return this.options.getData()}}class aE extends px{get kind(){return this._kind}constructor(e){super(e),this._kind=e.kind}}class Sh{get kind(){return this.options.kind}get nativeEvent(){return this.event.nativeEvent}get position(){return this.event.position}get defaultPrevented(){return this.event.defaultPrevented}get panel(){return this.options.panel}get api(){return this.options.api}get group(){return this.options.group}preventDefault(){this.event.preventDefault()}getData(){return this.options.getData()}constructor(e,t){this.event=e,this.options=t}}class kG extends Et{get element(){throw new Error("not supported")}get activePanel(){return this._activePanel}get locked(){return this._locked}set locked(e){this._locked=e,At(this.container,"locked-groupview",e==="no-drop-target"||e)}get isActive(){return this._isGroupActive}get panels(){return this._panels}get size(){return this._panels.length}get isEmpty(){return this._panels.length===0}get hasWatermark(){return!!(this.watermark&&this.container.contains(this.watermark.element))}get header(){return this.tabsContainer}get isContentFocused(){return document.activeElement?mg(document.activeElement,this.contentContainer.element):!1}get location(){return this._location}set location(e){switch(this._location=e,At(this.container,"dv-groupview-floating",!1),At(this.container,"dv-groupview-popout",!1),e.type){case"grid":this.contentContainer.dropTarget.setTargetZones(["top","bottom","left","right","center"]);break;case"floating":this.contentContainer.dropTarget.setTargetZones(["center"]),this.contentContainer.dropTarget.setTargetZones(e?["center"]:["top","bottom","left","right","center"]),At(this.container,"dv-groupview-floating",!0);break;case"popout":this.contentContainer.dropTarget.setTargetZones(["center"]),At(this.container,"dv-groupview-popout",!0);break}this.groupPanel.api._onDidLocationChange.fire({location:this.location})}constructor(e,t,i,r,o){var s;super(),this.container=e,this.accessor=t,this.id=i,this.options=r,this.groupPanel=o,this._isGroupActive=!1,this._locked=!1,this._location={type:"grid"},this.mostRecentlyUsed=[],this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._width=0,this._height=0,this._panels=[],this._panelDisposables=new Map,this._onMove=new xe,this.onMove=this._onMove.event,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new xe,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onTabDragStart=new xe,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new xe,this.onGroupDragStart=this._onGroupDragStart.event,this._onDidAddPanel=new xe,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPanelTitleChange=new xe,this.onDidPanelTitleChange=this._onDidPanelTitleChange.event,this._onDidPanelParametersChange=new xe,this.onDidPanelParametersChange=this._onDidPanelParametersChange.event,this._onDidRemovePanel=new xe,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidActivePanelChange=new xe,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onUnhandledDragOverEvent=new xe,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._overwriteRenderContainer=null,At(this.container,"groupview",!0),this._api=new Ch(this.accessor),this.tabsContainer=new SG(this.accessor,this.groupPanel),this.contentContainer=new vG(this.accessor,this),e.append(this.tabsContainer.element,this.contentContainer.element),this.header.hidden=!!r.hideHeader,this.locked=(s=r.locked)!==null&&s!==void 0?s:!1,this.addDisposables(this._onTabDragStart,this._onGroupDragStart,this._onWillShowOverlay,this.tabsContainer.onTabDragStart(a=>{this._onTabDragStart.fire(a)}),this.tabsContainer.onGroupDragStart(a=>{this._onGroupDragStart.fire(a)}),this.tabsContainer.onDrop(a=>{this.handleDropEvent("header",a.event,"center",a.index)}),this.contentContainer.onDidFocus(()=>{this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.onDidBlur(()=>{}),this.contentContainer.dropTarget.onDrop(a=>{this.handleDropEvent("content",a.nativeEvent,a.position)}),this.tabsContainer.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(a)}),this.contentContainer.dropTarget.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(new Sh(a,{kind:"content",panel:this.activePanel,api:this._api,group:this.groupPanel,getData:Ci}))}),this._onMove,this._onDidChange,this._onDidDrop,this._onWillDrop,this._onDidAddPanel,this._onDidRemovePanel,this._onDidActivePanelChange,this._onUnhandledDragOverEvent)}focusContent(){this.contentContainer.element.focus()}set renderContainer(e){this.panels.forEach(t=>{this.renderContainer.detatch(t)}),this._overwriteRenderContainer=e,this.panels.forEach(t=>{this.rerender(t)})}get renderContainer(){var e;return(e=this._overwriteRenderContainer)!==null&&e!==void 0?e:this.accessor.overlayRenderContainer}initialize(){this.options.panels&&this.options.panels.forEach(e=>{this.doAddPanel(e)}),this.options.activePanel&&this.openPanel(this.options.activePanel),this.setActive(this.isActive,!0),this.updateContainer(),this.accessor.options.createRightHeaderActionComponent&&(this._rightHeaderActions=this.accessor.options.createRightHeaderActionComponent(this.groupPanel),this.addDisposables(this._rightHeaderActions),this._rightHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setRightActionsElement(this._rightHeaderActions.element)),this.accessor.options.createLeftHeaderActionComponent&&(this._leftHeaderActions=this.accessor.options.createLeftHeaderActionComponent(this.groupPanel),this.addDisposables(this._leftHeaderActions),this._leftHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setLeftActionsElement(this._leftHeaderActions.element)),this.accessor.options.createPrefixHeaderActionComponent&&(this._prefixHeaderActions=this.accessor.options.createPrefixHeaderActionComponent(this.groupPanel),this.addDisposables(this._prefixHeaderActions),this._prefixHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setPrefixActionsElement(this._prefixHeaderActions.element))}rerender(e){this.contentContainer.renderPanel(e,{asActive:!1})}indexOf(e){return this.tabsContainer.indexOf(e.id)}toJSON(){var e;const t={views:this.tabsContainer.panels,activeView:(e=this._activePanel)===null||e===void 0?void 0:e.id,id:this.id};return this.locked!==!1&&(t.locked=this.locked),this.header.hidden&&(t.hideHeader=!0),t}moveToNext(e){e||(e={}),e.panel||(e.panel=this.activePanel);const t=e.panel?this.panels.indexOf(e.panel):-1;let i;if(t<this.panels.length-1)i=t+1;else if(!e.suppressRoll)i=0;else return;this.openPanel(this.panels[i])}moveToPrevious(e){if(e||(e={}),e.panel||(e.panel=this.activePanel),!e.panel)return;const t=this.panels.indexOf(e.panel);let i;if(t>0)i=t-1;else if(!e.suppressRoll)i=this.panels.length-1;else return;this.openPanel(this.panels[i])}containsPanel(e){return this.panels.includes(e)}init(e){}update(e){}focus(){var e;(e=this._activePanel)===null||e===void 0||e.focus()}openPanel(e,t={}){(typeof t.index!="number"||t.index>this.panels.length)&&(t.index=this.panels.length);const i=!!t.skipSetActive;if(e.updateParentGroup(this.groupPanel,{skipSetActive:t.skipSetActive}),this.doAddPanel(e,t.index,{skipSetActive:i}),this._activePanel===e){this.contentContainer.renderPanel(e,{asActive:!0});return}i||this.doSetActivePanel(e),t.skipSetGroupActive||this.accessor.doSetGroupActive(this.groupPanel),t.skipSetActive||this.updateContainer()}removePanel(e,t={skipSetActive:!1}){const i=typeof e=="string"?e:e.id,r=this._panels.find(o=>o.id===i);if(!r)throw new Error("invalid operation");return this._removePanel(r,t)}closeAllPanels(){if(this.panels.length>0){const e=[...this.panels];for(const t of e)this.doClose(t)}else this.accessor.removeGroup(this.groupPanel)}closePanel(e){this.doClose(e)}doClose(e){this.accessor.removePanel(e)}isPanelActive(e){return this._activePanel===e}updateActions(e){this.tabsContainer.setRightActionsElement(e)}setActive(e,t=!1){!t&&this.isActive===e||(this._isGroupActive=e,At(this.container,"active-group",e),At(this.container,"inactive-group",!e),this.tabsContainer.setActive(this.isActive),!this._activePanel&&this.panels.length>0&&this.doSetActivePanel(this.panels[0]),this.updateContainer())}layout(e,t){var i;this._width=e,this._height=t,this.contentContainer.layout(this._width,this._height),!((i=this._activePanel)===null||i===void 0)&&i.layout&&this._activePanel.layout(this._width,this._height)}_removePanel(e,t){const i=this._activePanel===e;if(this.doRemovePanel(e),i&&this.panels.length>0){const r=this.mostRecentlyUsed[0];this.openPanel(r,{skipSetActive:t.skipSetActive,skipSetGroupActive:t.skipSetActiveGroup})}return this._activePanel&&this.panels.length===0&&this.doSetActivePanel(void 0),t.skipSetActive||this.updateContainer(),e}doRemovePanel(e){const t=this.panels.indexOf(e);if(this._activePanel===e&&this.contentContainer.closePanel(),this.tabsContainer.delete(e.id),this._panels.splice(t,1),this.mostRecentlyUsed.includes(e)){const r=this.mostRecentlyUsed.indexOf(e);this.mostRecentlyUsed.splice(r,1)}const i=this._panelDisposables.get(e.id);i&&(i.dispose(),this._panelDisposables.delete(e.id)),this._onDidRemovePanel.fire({panel:e})}doAddPanel(e,t=this.panels.length,i={skipSetActive:!1}){const o=this._panels.indexOf(e)>-1;this.tabsContainer.show(),this.contentContainer.show(),this.tabsContainer.openPanel(e,t),i.skipSetActive||this.contentContainer.openPanel(e),!o&&(this.updateMru(e),this.panels.splice(t,0,e),this._panelDisposables.set(e.id,new Et(e.api.onDidTitleChange(s=>this._onDidPanelTitleChange.fire(s)),e.api.onDidParametersChange(s=>this._onDidPanelParametersChange.fire(s)))),this._onDidAddPanel.fire({panel:e}))}doSetActivePanel(e){this._activePanel!==e&&(this._activePanel=e,e&&(this.tabsContainer.setActivePanel(e),e.layout(this._width,this._height),this.updateMru(e),this._onDidActivePanelChange.fire({panel:e})))}updateMru(e){this.mostRecentlyUsed.includes(e)&&this.mostRecentlyUsed.splice(this.mostRecentlyUsed.indexOf(e),1),this.mostRecentlyUsed=[e,...this.mostRecentlyUsed]}updateContainer(){var e,t;if(At(this.container,"empty",this.isEmpty),this.panels.forEach(i=>i.runEvents()),this.isEmpty&&!this.watermark){const i=this.accessor.createWatermarkComponent();i.init({containerApi:this._api,group:this.groupPanel}),this.watermark=i,sn(this.watermark.element,"pointerdown",()=>{this.isActive||this.accessor.doSetGroupActive(this.groupPanel)}),this.tabsContainer.hide(),this.contentContainer.element.appendChild(this.watermark.element)}!this.isEmpty&&this.watermark&&(this.watermark.element.remove(),(t=(e=this.watermark).dispose)===null||t===void 0||t.call(e),this.watermark=void 0,this.tabsContainer.show())}canDisplayOverlay(e,t,i){const r=new sE(e,i,t,Ci,this.accessor.getPanel(this.id));return this._onUnhandledDragOverEvent.fire(r),r.isAccepted}handleDropEvent(e,t,i,r){if(this.locked==="no-drop-target")return;function o(){switch(e){case"header":return typeof r=="number"?"tab":"header_space";case"content":return"content"}}const s=typeof r=="number"?this.panels[r]:void 0,a=new aE({nativeEvent:t,position:i,panel:s,getData:()=>Ci(),kind:o(),group:this.groupPanel,api:this._api});if(this._onWillDrop.fire(a),a.defaultPrevented)return;const l=Ci();if(l&&l.viewId===this.accessor.id){if(l.panelId===null){const{groupId:h}=l;this._onMove.fire({target:i,groupId:h,index:r});return}if(this.tabsContainer.indexOf(l.panelId)!==-1&&this.tabsContainer.size===1)return;const{groupId:u,panelId:d}=l;if(this.id===u&&!i&&this.tabsContainer.indexOf(d)===r)return;this._onMove.fire({target:i,groupId:l.groupId,itemId:l.panelId,index:r})}else this._onDidDrop.fire(new px({nativeEvent:t,position:i,panel:s,getData:()=>Ci(),group:this.groupPanel,api:this._api}))}dispose(){var e,t,i;super.dispose(),(e=this.watermark)===null||e===void 0||e.element.remove(),(i=(t=this.watermark)===null||t===void 0?void 0:t.dispose)===null||i===void 0||i.call(t),this.watermark=void 0;for(const r of this.panels)r.dispose();this.tabsContainer.dispose(),this.contentContainer.dispose()}}class mx extends rE{constructor(e,t,i){super(e,t),this._onDidConstraintsChangeInternal=new xe,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new xe,this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new xe,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange),i&&this.initialize(i)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class lE extends fx{get priority(){return this._priority}get snap(){return this._snap}get minimumWidth(){const e=typeof this._minimumWidth=="function"?this._minimumWidth():this._minimumWidth;return e!==this._evaluatedMinimumWidth&&(this._evaluatedMinimumWidth=e,this.updateConstraints()),e}get minimumHeight(){const e=typeof this._minimumHeight=="function"?this._minimumHeight():this._minimumHeight;return e!==this._evaluatedMinimumHeight&&(this._evaluatedMinimumHeight=e,this.updateConstraints()),e}get maximumHeight(){const e=typeof this._maximumHeight=="function"?this._maximumHeight():this._maximumHeight;return e!==this._evaluatedMaximumHeight&&(this._evaluatedMaximumHeight=e,this.updateConstraints()),e}get maximumWidth(){const e=typeof this._maximumWidth=="function"?this._maximumWidth():this._maximumWidth;return e!==this._evaluatedMaximumWidth&&(this._evaluatedMaximumWidth=e,this.updateConstraints()),e}get isActive(){return this.api.isActive}get isVisible(){return this.api.isVisible}constructor(e,t,i,r){super(e,t,r??new mx(e,t)),this._evaluatedMinimumWidth=0,this._evaluatedMaximumWidth=Number.MAX_SAFE_INTEGER,this._evaluatedMinimumHeight=0,this._evaluatedMaximumHeight=Number.MAX_SAFE_INTEGER,this._minimumWidth=0,this._minimumHeight=0,this._maximumWidth=Number.MAX_SAFE_INTEGER,this._maximumHeight=Number.MAX_SAFE_INTEGER,this._snap=!1,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,typeof(i==null?void 0:i.minimumWidth)=="number"&&(this._minimumWidth=i.minimumWidth),typeof(i==null?void 0:i.maximumWidth)=="number"&&(this._maximumWidth=i.maximumWidth),typeof(i==null?void 0:i.minimumHeight)=="number"&&(this._minimumHeight=i.minimumHeight),typeof(i==null?void 0:i.maximumHeight)=="number"&&(this._maximumHeight=i.maximumHeight),this.api.initialize(this),this.addDisposables(this.api.onWillVisibilityChange(o=>{const{isVisible:s}=o,{accessor:a}=this._params;a.setVisible(this,s)}),this.api.onActiveChange(()=>{const{accessor:o}=this._params;o.doSetGroupActive(this)}),this.api.onDidConstraintsChangeInternal(o=>{(typeof o.minimumWidth=="number"||typeof o.minimumWidth=="function")&&(this._minimumWidth=o.minimumWidth),(typeof o.minimumHeight=="number"||typeof o.minimumHeight=="function")&&(this._minimumHeight=o.minimumHeight),(typeof o.maximumWidth=="number"||typeof o.maximumWidth=="function")&&(this._maximumWidth=o.maximumWidth),(typeof o.maximumHeight=="number"||typeof o.maximumHeight=="function")&&(this._maximumHeight=o.maximumHeight)}),this.api.onDidSizeChange(o=>{this._onDidChange.fire({height:o.height,width:o.width})}),this._onDidChange)}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}init(e){e.maximumHeight&&(this._maximumHeight=e.maximumHeight),e.minimumHeight&&(this._minimumHeight=e.minimumHeight),e.maximumWidth&&(this._maximumWidth=e.maximumWidth),e.minimumWidth&&(this._minimumWidth=e.minimumWidth),this._priority=e.priority,this._snap=!!e.snap,super.init(e),typeof e.isVisible=="boolean"&&this.setVisible(e.isVisible)}updateConstraints(){this.api._onDidConstraintsChange.fire({minimumWidth:this._evaluatedMinimumWidth,maximumWidth:this._evaluatedMaximumWidth,minimumHeight:this._evaluatedMinimumHeight,maximumHeight:this._evaluatedMaximumHeight})}toJSON(){const e=super.toJSON(),t=r=>r===Number.MAX_SAFE_INTEGER?void 0:r,i=r=>r<=0?void 0:r;return Object.assign(Object.assign({},e),{minimumHeight:i(this.minimumHeight),maximumHeight:t(this.maximumHeight),minimumWidth:i(this.minimumWidth),maximumWidth:t(this.maximumWidth),snap:this.snap,priority:this.priority})}}const gc="dockview: DockviewGroupPanelApiImpl not initialized";class DG extends mx{get location(){if(!this._group)throw new Error(gc);return this._group.model.location}constructor(e,t){super(e,"__dockviewgroup__"),this.accessor=t,this._mutableDisposable=new Ji,this._onDidLocationChange=new xe,this.onDidLocationChange=this._onDidLocationChange.event,this._onDidActivePanelChange=new xe,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this.addDisposables(this._onDidLocationChange,this._onDidActivePanelChange,this._mutableDisposable)}close(){if(this._group)return this.accessor.removeGroup(this._group)}getWindow(){return this.location.type==="popout"?this.location.getWindow():window}moveTo(e){var t,i,r;if(!this._group)throw new Error(gc);const o=(t=e.group)!==null&&t!==void 0?t:this.accessor.addGroup({direction:aG((i=e.position)!==null&&i!==void 0?i:"right"),skipSetActive:!0});this.accessor.moveGroupOrPanel({from:{groupId:this._group.id},to:{group:o,position:e.group&&(r=e.position)!==null&&r!==void 0?r:"center"}})}maximize(){if(!this._group)throw new Error(gc);this.location.type==="grid"&&this.accessor.maximizeGroup(this._group)}isMaximized(){if(!this._group)throw new Error(gc);return this.accessor.isMaximizedGroup(this._group)}exitMaximized(){if(!this._group)throw new Error(gc);this.isMaximized()&&this.accessor.exitMaximizedGroup()}initialize(e){this._group=e,queueMicrotask(()=>{this._mutableDisposable.value=this._group.model.onDidActivePanelChange(t=>{this._onDidActivePanelChange.fire(t)})})}}const nC=100,iC=100;class rC extends lE{get minimumWidth(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.minimumWidth;return typeof t=="number"?t:nC}get minimumHeight(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.minimumHeight;return typeof t=="number"?t:iC}get maximumWidth(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.maximumWidth;return typeof t=="number"?t:Number.MAX_SAFE_INTEGER}get maximumHeight(){var e;const t=(e=this.activePanel)===null||e===void 0?void 0:e.maximumHeight;return typeof t=="number"?t:Number.MAX_SAFE_INTEGER}get panels(){return this._model.panels}get activePanel(){return this._model.activePanel}get size(){return this._model.size}get model(){return this._model}get locked(){return this._model.locked}set locked(e){this._model.locked=e}get header(){return this._model.header}constructor(e,t,i){var r,o,s,a,l,c;super(t,"groupview_default",{minimumHeight:(o=(r=i.constraints)===null||r===void 0?void 0:r.minimumHeight)!==null&&o!==void 0?o:iC,minimumWidth:(a=(s=i.constraints)===null||s===void 0?void 0:s.maximumHeight)!==null&&a!==void 0?a:nC,maximumHeight:(l=i.constraints)===null||l===void 0?void 0:l.maximumHeight,maximumWidth:(c=i.constraints)===null||c===void 0?void 0:c.maximumWidth},new DG(t,e)),this.api.initialize(this),this._model=new kG(this.element,e,t,i,this)}focus(){this.api.isActive||this.api.setActive(),super.focus()}initialize(){this._model.initialize()}setActive(e){super.setActive(e),this.model.setActive(e)}layout(e,t){super.layout(e,t),this.model.layout(e,t)}getComponent(){return this._model}toJSON(){return this.model.toJSON()}}class TG extends mx{get location(){return this.group.api.location}get title(){return this.panel.title}get isGroupActive(){return this.group.isActive}get renderer(){return this.panel.renderer}set group(e){const t=this._group;this._group!==e&&(this._group=e,this._onDidGroupChange.fire({}),this.setupGroupEventListeners(t),this._onDidLocationChange.fire({location:this.group.api.location}))}get group(){return this._group}get tabComponent(){return this._tabComponent}constructor(e,t,i,r,o){super(e.id,r),this.panel=e,this.accessor=i,this._onDidTitleChange=new xe,this.onDidTitleChange=this._onDidTitleChange.event,this._onDidActiveGroupChange=new xe,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._onDidGroupChange=new xe,this.onDidGroupChange=this._onDidGroupChange.event,this._onDidRendererChange=new xe,this.onDidRendererChange=this._onDidRendererChange.event,this._onDidLocationChange=new xe,this.onDidLocationChange=this._onDidLocationChange.event,this.groupEventsDisposable=new Ji,this._tabComponent=o,this.initialize(e),this._group=t,this.setupGroupEventListeners(),this.addDisposables(this.groupEventsDisposable,this._onDidRendererChange,this._onDidTitleChange,this._onDidGroupChange,this._onDidActiveGroupChange,this._onDidLocationChange)}getWindow(){return this.group.api.getWindow()}moveTo(e){var t;this.accessor.moveGroupOrPanel({from:{groupId:this._group.id,panelId:this.panel.id},to:{group:e.group,position:(t=e.position)!==null&&t!==void 0?t:"center",index:e.index}})}setTitle(e){this.panel.setTitle(e)}setRenderer(e){this.panel.setRenderer(e)}close(){this.group.model.closePanel(this.panel)}maximize(){this.group.api.maximize()}isMaximized(){return this.group.api.isMaximized()}exitMaximized(){this.group.api.exitMaximized()}setupGroupEventListeners(e){var t;let i=(t=e==null?void 0:e.isActive)!==null&&t!==void 0?t:!1;this.groupEventsDisposable.value=new Et(this.group.api.onDidVisibilityChange(r=>{const o=!r.isVisible&&this.isVisible,s=r.isVisible&&!this.isVisible,a=this.group.model.isPanelActive(this.panel);(o||s&&a)&&this._onDidVisibilityChange.fire(r)}),this.group.api.onDidLocationChange(r=>{this.group===this.panel.group&&this._onDidLocationChange.fire(r)}),this.group.api.onDidActiveChange(()=>{this.group===this.panel.group&&i!==this.isGroupActive&&(i=this.isGroupActive,this._onDidActiveGroupChange.fire({isActive:this.isGroupActive}))}))}}class Ja extends Et{get params(){return this._params}get title(){return this._title}get group(){return this._group}get renderer(){var e;return(e=this._renderer)!==null&&e!==void 0?e:this.accessor.renderer}get minimumWidth(){return this._minimumWidth}get minimumHeight(){return this._minimumHeight}get maximumWidth(){return this._maximumWidth}get maximumHeight(){return this._maximumHeight}constructor(e,t,i,r,o,s,a,l){super(),this.id=e,this.accessor=r,this.containerApi=o,this.view=a,this._renderer=l.renderer,this._group=s,this._minimumWidth=l.minimumWidth,this._minimumHeight=l.minimumHeight,this._maximumWidth=l.maximumWidth,this._maximumHeight=l.maximumHeight,this.api=new TG(this,this._group,r,t,i),this.addDisposables(this.api.onActiveChange(()=>{r.setActivePanel(this)}),this.api.onDidSizeChange(c=>{this.group.api.setSize(c)}),this.api.onDidRendererChange(()=>{this.group.model.rerender(this)}))}init(e){this._params=e.params,this.view.init(Object.assign(Object.assign({},e),{api:this.api,containerApi:this.containerApi})),this.setTitle(e.title)}focus(){const e=new iE;this.api._onWillFocus.fire(e),!e.defaultPrevented&&(this.api.isActive||this.api.setActive())}toJSON(){return{id:this.id,contentComponent:this.view.contentComponent,tabComponent:this.view.tabComponent,params:Object.keys(this._params||{}).length>0?this._params:void 0,title:this.title,renderer:this._renderer,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,minimumWidth:this._minimumWidth,maximumWidth:this._maximumWidth}}setTitle(e){e!==this.title&&(this._title=e,this.api._onDidTitleChange.fire({title:e}))}setRenderer(e){e!==this.renderer&&(this._renderer=e,this.api._onDidRendererChange.fire({renderer:e}))}update(e){var t;this._params=Object.assign(Object.assign({},(t=this._params)!==null&&t!==void 0?t:{}),e.params);for(const i of Object.keys(e.params))e.params[i]===void 0&&delete this._params[i];this.view.update({params:this._params})}updateParentGroup(e,t){this._group=e,this.api.group=this._group;const i=this._group.model.isPanelActive(this),r=this.group.api.isActive&&i;t!=null&&t.skipSetActive||this.api.isActive!==r&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&i}),this.api.isVisible!==i&&this.api._onDidVisibilityChange.fire({isVisible:i})}runEvents(){const e=this._group.model.isPanelActive(this),t=this.group.api.isActive&&e;this.api.isActive!==t&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&e}),this.api.isVisible!==e&&this.api._onDidVisibilityChange.fire({isVisible:e})}layout(e,t){this.api._onDidDimensionChange.fire({width:e,height:t}),this.view.layout(e,t)}dispose(){this.api.dispose(),this.view.dispose()}}const gx=n=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"height",n.height),e.setAttributeNS(null,"width",n.width),e.setAttributeNS(null,"viewBox",n.viewbox),e.setAttributeNS(null,"aria-hidden","false"),e.setAttributeNS(null,"focusable","false"),e.classList.add("dockview-svg");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttributeNS(null,"d",n.path),e.appendChild(t),e},cE=()=>gx({width:"11",height:"11",viewbox:"0 0 28 28",path:"M2.1 27.3L0 25.2L11.55 13.65L0 2.1L2.1 0L13.65 11.55L25.2 0L27.3 2.1L15.75 13.65L27.3 25.2L25.2 27.3L13.65 15.75L2.1 27.3Z"}),RG=()=>gx({width:"11",height:"11",viewbox:"0 0 24 15",path:"M12 14.15L0 2.15L2.15 0L12 9.9L21.85 0.0499992L24 2.2L12 14.15Z"}),_G=()=>gx({width:"11",height:"11",viewbox:"0 0 15 25",path:"M2.15 24.1L0 21.95L9.9 12.05L0 2.15L2.15 0L14.2 12.05L2.15 24.1Z"});class oC extends Et{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-default-tab",this._content=document.createElement("div"),this._content.className="dv-default-tab-content",this.action=document.createElement("div"),this.action.className="dv-default-tab-action",this.action.appendChild(cE()),this._element.appendChild(this._content),this._element.appendChild(this.action),this.addDisposables(sn(this.action,"pointerdown",e=>{e.preventDefault()})),this.render()}init(e){this._title=e.title,this.addDisposables(e.api.onDidTitleChange(t=>{this._title=t.title,this.render()}),sn(this.action,"pointerdown",t=>{t.preventDefault()}),sn(this.action,"click",t=>{t.defaultPrevented||(t.preventDefault(),e.api.close())})),this.render()}render(){var e;this._content.textContent!==this._title&&(this._content.textContent=(e=this._title)!==null&&e!==void 0?e:"")}}class uE{get content(){return this._content}get tab(){return this._tab}constructor(e,t,i,r){this.accessor=e,this.id=t,this.contentComponent=i,this.tabComponent=r,this._content=this.createContentComponent(this.id,i),this._tab=this.createTabComponent(this.id,r)}init(e){this.content.init(e),this.tab.init(e)}updateParentGroup(e,t){}layout(e,t){var i,r;(r=(i=this.content).layout)===null||r===void 0||r.call(i,e,t)}update(e){var t,i,r,o;(i=(t=this.content).update)===null||i===void 0||i.call(t,e),(o=(r=this.tab).update)===null||o===void 0||o.call(r,e)}dispose(){var e,t,i,r;(t=(e=this.content).dispose)===null||t===void 0||t.call(e),(r=(i=this.tab).dispose)===null||r===void 0||r.call(i)}createContentComponent(e,t){return this.accessor.options.createComponent({id:e,name:t})}createTabComponent(e,t){const i=t??this.accessor.options.defaultTabComponent;if(i){if(this.accessor.options.createTabComponent){const r=this.accessor.options.createTabComponent({id:e,name:i});return r||new oC}console.warn(`dockview: tabComponent '${t}' was not found. falling back to the default tab.`)}return new oC}}class AG{constructor(e){this.accessor=e}fromJSON(e,t){var i,r;const o=e.id,s=e.params,a=e.title,l=e.view,c=l?l.content.id:(i=e.contentComponent)!==null&&i!==void 0?i:"unknown",u=l?(r=l.tab)===null||r===void 0?void 0:r.id:e.tabComponent,d=new uE(this.accessor,o,c,u),f=new Ja(o,c,u,this.accessor,new Ch(this.accessor),t,d,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return f.init({title:a??o,params:s??{}}),f}}class OG extends Et{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="watermark";const e=document.createElement("div");e.className="watermark-title";const t=document.createElement("span");t.style.flexGrow="1";const i=document.createElement("div");i.className="watermark-content",this._element.appendChild(e),this._element.appendChild(i);const r=document.createElement("div");r.className="actions-container";const o=document.createElement("div");o.className="close-action",o.appendChild(cE()),r.appendChild(o),e.appendChild(t),e.appendChild(r),this.addDisposables(sn(o,"click",s=>{var a;s.preventDefault(),this._group&&((a=this._api)===null||a===void 0||a.removeGroup(this._group))}))}init(e){this._api=e.containerApi,this._group=e.group,this.render()}render(){const e=!!(this._api&&this._api.size<=1);At(this.element,"has-actions",e)}}class PG{constructor(){this._orderedList=[]}push(e){this._orderedList=[...this._orderedList.filter(t=>t!==e),e],this.update()}destroy(e){this._orderedList=this._orderedList.filter(t=>t!==e),this.update()}update(){for(let e=0;e<this._orderedList.length;e++)this._orderedList[e].setAttribute("aria-level",`${e}`),this._orderedList[e].style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${e*2})`}}const Fd=new PG;class ls extends Et{set minimumInViewportWidth(e){this.options.minimumInViewportWidth=e}set minimumInViewportHeight(e){this.options.minimumInViewportHeight=e}get element(){return this._element}constructor(e){super(),this.options=e,this._element=document.createElement("div"),this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this._onDidChangeEnd=new xe,this.onDidChangeEnd=this._onDidChangeEnd.event,this.addDisposables(this._onDidChange,this._onDidChangeEnd),this._element.className="dv-resize-container",this.setupResize("top"),this.setupResize("bottom"),this.setupResize("left"),this.setupResize("right"),this.setupResize("topleft"),this.setupResize("topright"),this.setupResize("bottomleft"),this.setupResize("bottomright"),this._element.appendChild(this.options.content),this.options.container.appendChild(this._element),this.setBounds(Object.assign(Object.assign(Object.assign(Object.assign({height:this.options.height,width:this.options.width},"top"in this.options&&{top:this.options.top}),"bottom"in this.options&&{bottom:this.options.bottom}),"left"in this.options&&{left:this.options.left}),"right"in this.options&&{right:this.options.right})),Fd.push(this._element)}bringToFront(){Fd.push(this._element)}setBounds(e={}){typeof e.height=="number"&&(this._element.style.height=`${e.height}px`),typeof e.width=="number"&&(this._element.style.width=`${e.width}px`),"top"in e&&typeof e.top=="number"&&(this._element.style.top=`${e.top}px`,this._element.style.bottom="auto",this.verticalAlignment="top"),"bottom"in e&&typeof e.bottom=="number"&&(this._element.style.bottom=`${e.bottom}px`,this._element.style.top="auto",this.verticalAlignment="bottom"),"left"in e&&typeof e.left=="number"&&(this._element.style.left=`${e.left}px`,this._element.style.right="auto",this.horiziontalAlignment="left"),"right"in e&&typeof e.right=="number"&&(this._element.style.right=`${e.right}px`,this._element.style.left="auto",this.horiziontalAlignment="right");const t=this.options.container.getBoundingClientRect(),i=this._element.getBoundingClientRect(),r=Math.max(0,this.getMinimumWidth(i.width)),o=Math.max(0,this.getMinimumHeight(i.height));if(this.verticalAlignment==="top"){const s=mn(i.top-t.top,-o,Math.max(0,t.height-i.height+o));this._element.style.top=`${s}px`,this._element.style.bottom="auto"}if(this.verticalAlignment==="bottom"){const s=mn(t.bottom-i.bottom,-o,Math.max(0,t.height-i.height+o));this._element.style.bottom=`${s}px`,this._element.style.top="auto"}if(this.horiziontalAlignment==="left"){const s=mn(i.left-t.left,-r,Math.max(0,t.width-i.width+r));this._element.style.left=`${s}px`,this._element.style.right="auto"}if(this.horiziontalAlignment==="right"){const s=mn(t.right-i.right,-r,Math.max(0,t.width-i.width+r));this._element.style.right=`${s}px`,this._element.style.left="auto"}this._onDidChange.fire()}toJSON(){const e=this.options.container.getBoundingClientRect(),t=this._element.getBoundingClientRect(),i={};return this.verticalAlignment==="top"?i.top=parseFloat(this._element.style.top):this.verticalAlignment==="bottom"?i.bottom=parseFloat(this._element.style.bottom):i.top=t.top-e.top,this.horiziontalAlignment==="left"?i.left=parseFloat(this._element.style.left):this.horiziontalAlignment==="right"?i.right=parseFloat(this._element.style.right):i.left=t.left-e.left,i.width=t.width,i.height=t.height,i}setupDrag(e,t={inDragMode:!1}){const i=new Ji,r=()=>{let o=null;const s=yh();i.value=new Et({dispose:()=>{s.release()}},Lo(window,"pointermove",a=>{const l=this.options.container.getBoundingClientRect(),c=a.clientX-l.left,u=a.clientY-l.top;At(this._element,"dv-resize-container-dragging",!0);const d=this._element.getBoundingClientRect();o===null&&(o={x:a.clientX-d.left,y:a.clientY-d.top});const f=Math.max(0,this.getMinimumWidth(d.width)),h=Math.max(0,this.getMinimumHeight(d.height)),p=mn(u-o.y,-h,Math.max(0,l.height-d.height+h)),m=mn(o.y-u+l.height-d.height,-h,Math.max(0,l.height-d.height+h)),g=mn(c-o.x,-f,Math.max(0,l.width-d.width+f)),v=mn(o.x-c+l.width-d.width,-f,Math.max(0,l.width-d.width+f)),x={};p<=m?x.top=p:x.bottom=m,g<=v?x.left=g:x.right=v,this.setBounds(x)}),Lo(window,"pointerup",()=>{At(this._element,"dv-resize-container-dragging",!1),i.dispose(),this._onDidChangeEnd.fire()}))};this.addDisposables(i,sn(e,"pointerdown",o=>{if(o.defaultPrevented){o.preventDefault();return}Zw(o)||r()}),sn(this.options.content,"pointerdown",o=>{o.defaultPrevented||Zw(o)||o.shiftKey&&r()}),sn(this.options.content,"pointerdown",()=>{Fd.push(this._element)},!0)),t.inDragMode&&r()}setupResize(e){const t=document.createElement("div");t.className=`dv-resize-handle-${e}`,this._element.appendChild(t);const i=new Ji;this.addDisposables(i,sn(t,"pointerdown",r=>{r.preventDefault();let o=null;const s=yh();i.value=new Et(Lo(window,"pointermove",a=>{const l=this.options.container.getBoundingClientRect(),c=this._element.getBoundingClientRect(),u=a.clientY-l.top,d=a.clientX-l.left;o===null&&(o={originalY:u,originalHeight:c.height,originalX:d,originalWidth:c.width});let f,h,p,m,g,v;const x=()=>{f=mn(u,-Number.MAX_VALUE,o.originalY+o.originalHeight>l.height?this.getMinimumHeight(l.height):Math.max(0,o.originalY+o.originalHeight-ls.MINIMUM_HEIGHT)),p=o.originalY+o.originalHeight-f,h=l.height-f-p},b=()=>{f=o.originalY-o.originalHeight,p=mn(u-f,f<0&&typeof this.options.minimumInViewportHeight=="number"?-f+this.options.minimumInViewportHeight:ls.MINIMUM_HEIGHT,Number.MAX_VALUE),h=l.height-f-p},w=()=>{m=mn(d,-Number.MAX_VALUE,o.originalX+o.originalWidth>l.width?this.getMinimumWidth(l.width):Math.max(0,o.originalX+o.originalWidth-ls.MINIMUM_WIDTH)),v=o.originalX+o.originalWidth-m,g=l.width-m-v},y=()=>{m=o.originalX-o.originalWidth,v=mn(d-m,m<0&&typeof this.options.minimumInViewportWidth=="number"?-m+this.options.minimumInViewportWidth:ls.MINIMUM_WIDTH,Number.MAX_VALUE),g=l.width-m-v};switch(e){case"top":x();break;case"bottom":b();break;case"left":w();break;case"right":y();break;case"topleft":x(),w();break;case"topright":x(),y();break;case"bottomleft":b(),w();break;case"bottomright":b(),y();break}const C={};f<=h?C.top=f:C.bottom=h,m<=g?C.left=m:C.right=g,C.height=p,C.width=v,this.setBounds(C)}),{dispose:()=>{s.release()}},Lo(window,"pointerup",()=>{i.dispose(),this._onDidChangeEnd.fire()}))}))}getMinimumWidth(e){return typeof this.options.minimumInViewportWidth=="number"?e-this.options.minimumInViewportWidth:0}getMinimumHeight(e){return typeof this.options.minimumInViewportHeight=="number"?e-this.options.minimumInViewportHeight:0}dispose(){Fd.destroy(this._element),this._element.remove(),super.dispose()}}ls.MINIMUM_HEIGHT=20;ls.MINIMUM_WIDTH=20;class MG extends Et{constructor(e,t){super(),this.group=e,this.overlay=t,this.addDisposables(t)}position(e){this.overlay.setBounds(e)}}const Ld=100,is={left:100,top:100,width:300,height:300};function FG(){const n=document.createElement("div");return n.tabIndex=-1,n}class sC extends Et{constructor(e,t){super(),this.element=e,this.accessor=t,this.map={},this._disposed=!1,this.addDisposables(Pi.from(()=>{for(const i of Object.values(this.map))i.disposable.dispose(),i.destroy.dispose();this._disposed=!0}))}detatch(e){if(this.map[e.api.id]){const{disposable:t,destroy:i}=this.map[e.api.id];return t.dispose(),i.dispose(),delete this.map[e.api.id],!0}return!1}attach(e){const{panel:t,referenceContainer:i}=e;if(!this.map[t.api.id]){const u=FG();u.className="dv-render-overlay",this.map[t.api.id]={panel:t,disposable:Pi.NONE,destroy:Pi.NONE,element:u}}const r=this.map[t.api.id].element;t.view.content.element.parentElement!==r&&r.appendChild(t.view.content.element),r.parentElement!==this.element&&this.element.appendChild(r);const o=()=>{const u=Qw(i.element),d=Qw(this.element);r.style.left=`${u.left-d.left}px`,r.style.top=`${u.top-d.top}px`,r.style.width=`${u.width}px`,r.style.height=`${u.height}px`,At(r,"dv-render-overlay-float",t.group.api.location.type==="floating")},s=()=>{t.api.isVisible&&o(),r.style.display=t.api.isVisible?"":"none"},a=new Ji,l=()=>{t.api.location.type==="floating"?queueMicrotask(()=>{const u=this.accessor.floatingGroups.find(p=>p.group===t.api.group);if(!u)return;const d=u.overlay.element,f=()=>{const p=Number(d.getAttribute("aria-level"));r.style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${p*2+1})`},h=new MutationObserver(()=>{f()});a.value=Pi.from(()=>h.disconnect()),h.observe(d,{attributeFilter:["aria-level"],attributes:!0}),f()}):r.style.zIndex=""},c=new Et(a,new nE(r,{onDragEnd:u=>{i.dropTarget.dnd.onDragEnd(u)},onDragEnter:u=>{i.dropTarget.dnd.onDragEnter(u)},onDragLeave:u=>{i.dropTarget.dnd.onDragLeave(u)},onDrop:u=>{i.dropTarget.dnd.onDrop(u)},onDragOver:u=>{i.dropTarget.dnd.onDragOver(u)}}),t.api.onDidVisibilityChange(()=>{s()}),t.api.onDidDimensionsChange(()=>{t.api.isVisible&&o()}),t.api.onDidLocationChange(()=>{l()}));return this.map[t.api.id].destroy=Pi.from(()=>{var u;t.view.content.element.parentElement===r&&r.removeChild(t.view.content.element),(u=r.parentElement)===null||u===void 0||u.removeChild(r)}),l(),queueMicrotask(()=>{this.isDisposed||s()}),this.map[t.api.id].disposable.dispose(),this.map[t.api.id].disposable=c,r}}var LG=function(n,e,t,i){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(i.next(u))}catch(d){s(d)}}function l(u){try{c(i.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):r(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})};class zG extends Et{get window(){var e,t;return(t=(e=this._window)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:null}constructor(e,t,i){super(),this.target=e,this.className=t,this.options=i,this._onWillClose=new xe,this.onWillClose=this._onWillClose.event,this._onDidClose=new xe,this.onDidClose=this._onDidClose.event,this._window=null,this.addDisposables(this._onWillClose,this._onDidClose,{dispose:()=>{this.close()}})}dimensions(){if(!this._window)return null;const e=this._window.value.screenX,t=this._window.value.screenY,i=this._window.value.innerWidth,r=this._window.value.innerHeight;return{top:t,left:e,width:i,height:r}}close(){var e,t;this._window&&(this._onWillClose.fire(),(t=(e=this.options).onWillClose)===null||t===void 0||t.call(e,{id:this.target,window:this._window.value}),this._window.disposable.dispose(),this._window.value.close(),this._window=null,this._onDidClose.fire())}open(){var e,t;return LG(this,void 0,void 0,function*(){if(this._window)throw new Error("instance of popout window is already open");const i=`${this.options.url}`,r=Object.entries({top:this.options.top,left:this.options.left,width:this.options.width,height:this.options.height}).map(([l,c])=>`${l}=${c}`).join(","),o=window.open(i,this.target,r);if(!o)return null;const s=new Et;this._window={value:o,disposable:s},s.addDisposables(Lo(window,"beforeunload",()=>{this.close()}));const a=this.createPopoutWindowContainer();return this.className&&a.classList.add(this.className),(t=(e=this.options).onDidOpen)===null||t===void 0||t.call(e,{id:this.target,window:o}),new Promise(l=>{o.addEventListener("unload",c=>{}),o.addEventListener("load",()=>{const c=o.document;c.title=document.title,c.body.appendChild(a),K4(c,window.document.styleSheets),Lo(o,"beforeunload",()=>{this.close()}),l(a)})})})}createPopoutWindowContainer(){const e=document.createElement("div");return e.classList.add("dv-popout-window"),e.id="dv-popout-window",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0px",e.style.left="0px",e}}const aC={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function ym(n){const e=n.from.activePanel;[...n.from.panels].map(i=>{const r=n.from.model.removePanel(i);return n.from.model.renderContainer.detatch(i),r}).forEach(i=>{n.to.model.openPanel(i,{skipSetActive:e!==i,skipSetGroupActive:!0})})}class BG extends Q${get orientation(){return this.gridview.orientation}get totalPanels(){return this.panels.length}get panels(){return this.groups.flatMap(e=>e.panels)}get options(){return this._options}get activePanel(){const e=this.activeGroup;if(e)return e.activePanel}get renderer(){var e;return(e=this.options.defaultRenderer)!==null&&e!==void 0?e:"onlyWhenVisible"}get api(){return this._api}get gap(){return this.gridview.margin}get floatingGroups(){return this._floatingGroups}constructor(e,t){var i;super(e,{proportionalLayout:!0,orientation:Je.HORIZONTAL,styles:t.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:t.disableAutoResizing,locked:t.locked,margin:t.gap,className:t.className}),this.nextGroupId=ux(),this._deserializer=new AG(this),this.watermark=null,this._onWillDragPanel=new xe,this.onWillDragPanel=this._onWillDragPanel.event,this._onWillDragGroup=new xe,this.onWillDragGroup=this._onWillDragGroup.event,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new xe,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new xe,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onUnhandledDragOverEvent=new xe,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._onDidRemovePanel=new xe,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidAddPanel=new xe,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidLayoutFromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutFromJSON.event,this._onDidActivePanelChange=new xe,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onDidMovePanel=new xe,this.onDidMovePanel=this._onDidMovePanel.event,this._floatingGroups=[],this._popoutGroups=[],this._onDidRemoveGroup=new xe,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new xe,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidActiveGroupChange=new xe,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._moving=!1,this.overlayRenderContainer=new sC(this.gridview.element,this),At(this.gridview.element,"dv-dockview",!0),At(this.element,"dv-debug",!!t.debug),this.addDisposables(this.overlayRenderContainer,this._onWillDragPanel,this._onWillDragGroup,this._onWillShowOverlay,this._onDidActivePanelChange,this._onDidAddPanel,this._onDidRemovePanel,this._onDidLayoutFromJSON,this._onDidDrop,this._onWillDrop,this._onDidMovePanel,this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this._onUnhandledDragOverEvent,this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.updateWatermark()}),this.onDidAdd(r=>{this._moving||this._onDidAddGroup.fire(r)}),this.onDidRemove(r=>{this._moving||this._onDidRemoveGroup.fire(r)}),this.onDidActiveChange(r=>{this._moving||this._onDidActiveGroupChange.fire(r)}),sa.any(this.onDidAdd,this.onDidRemove)(()=>{this.updateWatermark()}),sa.any(this.onDidAddPanel,this.onDidRemovePanel,this.onDidAddGroup,this.onDidRemove,this.onDidMovePanel,this.onDidActivePanelChange)(()=>{this._bufferOnDidLayoutChange.fire()}),Pi.from(()=>{for(const r of[...this._floatingGroups])r.dispose();for(const r of[...this._popoutGroups])r.disposable.dispose()})),this._options=t,this._rootDropTarget=new Ho(this.element,{canDisplayOverlay:(r,o)=>{const s=Ci();if(s)return s.viewId!==this.id?!1:o==="center"?this.gridview.length===0:!0;if(o==="center"&&this.gridview.length!==0)return!1;const a=new sE(r,"edge",o,Ci);return this._onUnhandledDragOverEvent.fire(a),a.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:(i=this.options.rootOverlayModel)!==null&&i!==void 0?i:aC}),this.addDisposables(this._rootDropTarget,this._rootDropTarget.onWillShowOverlay(r=>{this.gridview.length>0&&r.position==="center"||this._onWillShowOverlay.fire(new Sh(r,{kind:"edge",panel:void 0,api:this._api,group:void 0,getData:Ci}))}),this._rootDropTarget.onDrop(r=>{var o;const s=new aE({nativeEvent:r.nativeEvent,position:r.position,panel:void 0,api:this._api,group:void 0,getData:Ci,kind:"edge"});if(this._onWillDrop.fire(s),s.defaultPrevented)return;const a=Ci();a?this.moveGroupOrPanel({from:{groupId:a.groupId,panelId:(o=a.panelId)!==null&&o!==void 0?o:void 0},to:{group:this.orthogonalize(r.position),position:"center"}}):this._onDidDrop.fire(new px({nativeEvent:r.nativeEvent,position:r.position,panel:void 0,api:this._api,group:void 0,getData:Ci}))}),this._rootDropTarget),this._api=new Ch(this),this.updateWatermark()}addPopoutGroup(e,t){var i,r,o;if(e instanceof Ja&&e.group.size===1)return this.addPopoutGroup(e.group,t);const s=Y4(this.gridview.element),a=this.element;function l(){return t!=null&&t.position?t.position:e instanceof rC?e.element.getBoundingClientRect():e.group?e.group.element.getBoundingClientRect():a.getBoundingClientRect()}const c=l(),u=(r=(i=t==null?void 0:t.overridePopoutGroup)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:this.getNextGroupId();e.api.location.type==="grid"&&e.api.setVisible(!1);const d=new zG(`${this.id}-${u}`,s??"",{url:(o=t==null?void 0:t.popoutUrl)!==null&&o!==void 0?o:"/popout.html",left:window.screenX+c.left,top:window.screenY+c.top,width:c.width,height:c.height,onDidOpen:t==null?void 0:t.onDidOpen,onWillClose:t==null?void 0:t.onWillClose}),f=new Et(d,d.onDidClose(()=>{f.dispose()}));return d.open().then(h=>{var p;if(d.isDisposed)return;if(h===null){f.dispose();return}const m=document.createElement("div");m.className="dv-overlay-render-container";const g=new sC(m,this),v=e instanceof Ja?e.group:e,x=e.api.location.type,b=(p=t==null?void 0:t.overridePopoutGroup)!==null&&p!==void 0?p:this.createGroup({id:u});if(b.model.renderContainer=g,t!=null&&t.overridePopoutGroup||this._onDidAddGroup.fire(b),e instanceof Ja)this.movingLock(()=>{const C=v.model.removePanel(e);b.model.openPanel(C)});else switch(this.movingLock(()=>ym({from:v,to:b})),x){case"grid":v.api.setVisible(!1);break;case"floating":case"popout":this.removeGroup(v);break}h.classList.add("dv-dockview"),h.style.overflow="hidden",h.appendChild(m),h.appendChild(b.element),b.model.location={type:"popout",getWindow:()=>d.window},this.doSetGroupAndPanelActive(b),f.addDisposables(b.api.onDidActiveChange(C=>{var $;C.isActive&&(($=d.window)===null||$===void 0||$.focus())}),b.api.onWillFocus(()=>{var C;(C=d.window)===null||C===void 0||C.focus()}));let w;const y={window:d,popoutGroup:b,referenceGroup:this.getPanel(v.id)?v.id:void 0,disposable:{dispose:()=>(f.dispose(),w)}};f.addDisposables(Lo(d.window,"resize",()=>{b.layout(window.innerWidth,window.innerHeight)}),g,Pi.from(()=>{if(this.getPanel(v.id))this.movingLock(()=>ym({from:b,to:v})),v.api.isVisible||v.api.setVisible(!0),this.getPanel(b.id)&&this.doRemoveGroup(b,{skipPopoutAssociated:!0});else if(this.getPanel(b.id)){const C=this.doRemoveGroup(b,{skipDispose:!0,skipActive:!0});C.model.renderContainer=this.overlayRenderContainer,C.model.location={type:"grid"},w=C}})),this._popoutGroups.push(y),this.updateWatermark()}).catch(h=>{console.error("dockview: failed to create popout window",h)})}addFloatingGroup(e,t){var i,r,o,s,a;let l;if(e instanceof Ja)l=this.createGroup(),this._onDidAddGroup.fire(l),this.movingLock(()=>this.removePanel(e,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})),this.movingLock(()=>l.model.openPanel(e,{skipSetGroupActive:!0}));else{l=e;const m=(i=this._popoutGroups.find(x=>x.popoutGroup===l))===null||i===void 0?void 0:i.referenceGroup,g=m?this.getPanel(m):void 0;typeof(t==null?void 0:t.skipRemoveGroup)=="boolean"&&t.skipRemoveGroup||(g?(this.movingLock(()=>ym({from:e,to:g})),this.doRemoveGroup(e,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(g,{skipDispose:!0}),l=g):this.doRemoveGroup(e,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}function c(){if(t!=null&&t.position){const m={};return"left"in t.position?m.left=Math.max(t.position.left,0):"right"in t.position?m.right=Math.max(t.position.right,0):m.left=is.left,"top"in t.position?m.top=Math.max(t.position.top,0):"bottom"in t.position?m.bottom=Math.max(t.position.bottom,0):m.top=is.top,typeof t.width=="number"?m.width=Math.max(t.width,0):m.width=is.width,typeof t.height=="number"?m.height=Math.max(t.height,0):m.height=is.height,m}return{left:typeof(t==null?void 0:t.x)=="number"?Math.max(t.x,0):is.left,top:typeof(t==null?void 0:t.y)=="number"?Math.max(t.y,0):is.top,width:typeof(t==null?void 0:t.width)=="number"?Math.max(t.width,0):is.width,height:typeof(t==null?void 0:t.height)=="number"?Math.max(t.height,0):is.height}}const u=c(),d=new ls(Object.assign(Object.assign({container:this.gridview.element,content:l.element},u),{minimumInViewportWidth:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(o=(r=this.options.floatingGroupBounds)===null||r===void 0?void 0:r.minimumWidthWithinViewport)!==null&&o!==void 0?o:Ld,minimumInViewportHeight:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(a=(s=this.options.floatingGroupBounds)===null||s===void 0?void 0:s.minimumHeightWithinViewport)!==null&&a!==void 0?a:Ld})),f=l.element.querySelector(".void-container");if(!f)throw new Error("failed to find drag handle");d.setupDrag(f,{inDragMode:typeof(t==null?void 0:t.inDragMode)=="boolean"?t.inDragMode:!1});const h=new MG(l,d),p=new Et(l.api.onDidActiveChange(m=>{m.isActive&&d.bringToFront()}),X$(l.element,m=>{const{width:g,height:v}=m.contentRect;l.layout(g,v)}));h.addDisposables(d.onDidChange(()=>{l.layout(l.width,l.height)}),d.onDidChangeEnd(()=>{this._bufferOnDidLayoutChange.fire()}),l.onDidChange(m=>{d.setBounds({height:m==null?void 0:m.height,width:m==null?void 0:m.width})}),{dispose:()=>{p.dispose(),bm(this._floatingGroups,h),l.model.location={type:"grid"},this.updateWatermark()}}),this._floatingGroups.push(h),l.model.location={type:"floating"},t!=null&&t.skipActiveGroup||this.doSetGroupAndPanelActive(l),this.updateWatermark()}orthogonalize(e){switch(e){case"top":case"bottom":this.gridview.orientation===Je.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===Je.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break}switch(e){case"top":case"left":case"center":return this.createGroupAtLocation([0]);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length]);default:throw new Error(`unsupported position ${e}`)}}updateOptions(e){var t,i,r,o;if(super.updateOptions(e),"floatingGroupBounds"in e)for(const s of this._floatingGroups){switch(e.floatingGroupBounds){case"boundedWithinViewport":s.overlay.minimumInViewportHeight=void 0,s.overlay.minimumInViewportWidth=void 0;break;case void 0:s.overlay.minimumInViewportHeight=Ld,s.overlay.minimumInViewportWidth=Ld;break;default:s.overlay.minimumInViewportHeight=(t=e.floatingGroupBounds)===null||t===void 0?void 0:t.minimumHeightWithinViewport,s.overlay.minimumInViewportWidth=(i=e.floatingGroupBounds)===null||i===void 0?void 0:i.minimumWidthWithinViewport}s.overlay.setBounds()}"rootOverlayModel"in e&&this._rootDropTarget.setOverlayModel((r=e.rootOverlayModel)!==null&&r!==void 0?r:aC),"gap"in e&&(this.gridview.margin=(o=e.gap)!==null&&o!==void 0?o:0),this._options=Object.assign(Object.assign({},this.options),e),this.layout(this.gridview.width,this.gridview.height,!0)}layout(e,t,i){if(super.layout(e,t,i),this._floatingGroups)for(const r of this._floatingGroups)r.overlay.setBounds()}focus(){var e;(e=this.activeGroup)===null||e===void 0||e.focus()}getGroupPanel(e){return this.panels.find(t=>t.id===e)}setActivePanel(e){e.group.model.openPanel(e),this.doSetGroupAndPanelActive(e.group)}moveToNext(e={}){var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[e.group.panels.length-1]){e.group.model.moveToNext({suppressRoll:!0});return}const i=wn(e.group.element),r=(t=this.gridview.next(i))===null||t===void 0?void 0:t.view;this.doSetGroupAndPanelActive(r)}moveToPrevious(e={}){var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[0]){e.group.model.moveToPrevious({suppressRoll:!0});return}const i=wn(e.group.element),r=(t=this.gridview.previous(i))===null||t===void 0?void 0:t.view;r&&this.doSetGroupAndPanelActive(r)}toJSON(){var e;const t=this.gridview.serialize(),i=this.panels.reduce((a,l)=>(a[l.id]=l.toJSON(),a),{}),r=this._floatingGroups.map(a=>({data:a.group.toJSON(),position:a.overlay.toJSON()})),o=this._popoutGroups.map(a=>({data:a.popoutGroup.toJSON(),gridReferenceGroup:a.referenceGroup,position:a.window.dimensions()})),s={grid:t,panels:i,activeGroup:(e=this.activeGroup)===null||e===void 0?void 0:e.id};return r.length>0&&(s.floatingGroups=r),o.length>0&&(s.popoutGroups=o),s}fromJSON(e){var t,i,r;if(this.clear(),typeof e!="object"||e===null)throw new Error("serialized layout must be a non-null object");const{grid:o,panels:s,activeGroup:a}=e;if(o.root.type!=="branch"||!Array.isArray(o.root.data))throw new Error("root must be of type branch");try{const l=this.width,c=this.height,u=h=>{const{id:p,locked:m,hideHeader:g,views:v,activeView:x}=h;if(typeof p!="string")throw new Error("group id must be of type string");const b=this.createGroup({id:p,locked:!!m,hideHeader:!!g}),w=[];for(const y of v){const C=this._deserializer.fromJSON(s[y],b);w.push(C)}this._onDidAddGroup.fire(b);for(let y=0;y<v.length;y++){const C=w[y],$=typeof x=="string"&&x===C.id;b.model.openPanel(C,{skipSetActive:!$,skipSetGroupActive:!0})}return!b.activePanel&&b.panels.length>0&&b.model.openPanel(b.panels[b.panels.length-1],{skipSetGroupActive:!0}),b};this.gridview.deserialize(o,{fromJSON:h=>u(h.data)}),this.layout(l,c,!0);const d=(t=e.floatingGroups)!==null&&t!==void 0?t:[];for(const h of d){const{data:p,position:m}=h,g=u(p);this.addFloatingGroup(g,{position:m,width:m.width,height:m.height,skipRemoveGroup:!0,inDragMode:!1})}const f=(i=e.popoutGroups)!==null&&i!==void 0?i:[];for(const h of f){const{data:p,position:m,gridReferenceGroup:g}=h,v=u(p);this.addPopoutGroup((r=g?this.getPanel(g):void 0)!==null&&r!==void 0?r:v,{skipRemoveGroup:!0,position:m??void 0,overridePopoutGroup:g?v:void 0})}for(const h of this._floatingGroups)h.overlay.setBounds();if(typeof a=="string"){const h=this.getPanel(a);h&&this.doSetGroupAndPanelActive(h)}}catch(l){for(const c of this.groups)for(const u of c.panels)this.removePanel(u,{removeEmptyGroup:!1,skipDispose:!1});for(const c of this.groups)c.dispose(),this._groups.delete(c.id),this._onDidRemoveGroup.fire(c);for(const c of[...this._floatingGroups])c.dispose();throw this.clear(),l}this.updateWatermark(),this._onDidLayoutFromJSON.fire()}clear(){const e=Array.from(this._groups.values()).map(i=>i.value),t=!!this.activeGroup;for(const i of e)this.removeGroup(i,{skipActive:!0});t&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()}closeAllGroups(){for(const e of this._groups.entries()){const[t,i]=e;i.value.model.closeAllPanels()}}addPanel(e){var t,i;if(this.panels.find(a=>a.id===e.id))throw new Error(`panel with id ${e.id} already exists`);let r;if(e.position&&e.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");const o={width:e.initialWidth,height:e.initialHeight};if(e.position)if(IG(e.position)){const a=typeof e.position.referencePanel=="string"?this.getGroupPanel(e.position.referencePanel):e.position.referencePanel;if(!a)throw new Error(`referencePanel '${e.position.referencePanel}' does not exist`);r=this.findGroup(a)}else if($G(e.position)){if(r=typeof e.position.referenceGroup=="string"?(t=this._groups.get(e.position.referenceGroup))===null||t===void 0?void 0:t.value:e.position.referenceGroup,!r)throw new Error(`referenceGroup '${e.position.referenceGroup}' does not exist`)}else{const a=this.orthogonalize(tC(e.position.direction)),l=this.createPanel(e,a);return a.model.openPanel(l,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(a),a.api.setSize({height:o==null?void 0:o.height,width:o==null?void 0:o.width}),l}else r=this.activeGroup;let s;if(r){const a=wh(((i=e.position)===null||i===void 0?void 0:i.direction)||"within");if(e.floating){const l=this.createGroup();this._onDidAddGroup.fire(l);const c=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(l,Object.assign(Object.assign({},c),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),s=this.createPanel(e,l),l.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive})}else if(r.api.location.type==="floating"||a==="center")s=this.createPanel(e,r),r.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),r.api.setSize({width:o==null?void 0:o.width,height:o==null?void 0:o.height}),e.inactive||this.doSetGroupAndPanelActive(r);else{const l=wn(r.element),c=so(this.gridview.orientation,l,a),u=this.createGroupAtLocation(c,this.orientationAtLocation(c)===Je.VERTICAL?o==null?void 0:o.height:o==null?void 0:o.width);s=this.createPanel(e,u),u.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(u)}}else if(e.floating){const a=this.createGroup();this._onDidAddGroup.fire(a);const l=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(a,Object.assign(Object.assign({},l),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),s=this.createPanel(e,a),a.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive})}else{const a=this.createGroupAtLocation([0],this.gridview.orientation===Je.VERTICAL?o==null?void 0:o.height:o==null?void 0:o.width);s=this.createPanel(e,a),a.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive}),e.inactive||this.doSetGroupAndPanelActive(a)}return s}removePanel(e,t={removeEmptyGroup:!0,skipDispose:!1}){const i=e.group;if(!i)throw new Error(`cannot remove panel ${e.id}. it's missing a group.`);i.model.removePanel(e,{skipSetActiveGroup:t.skipSetActiveGroup}),t.skipDispose||(e.group.model.renderContainer.detatch(e),e.dispose()),i.size===0&&t.removeEmptyGroup&&this.removeGroup(i,{skipActive:t.skipSetActiveGroup})}createWatermarkComponent(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new OG}updateWatermark(){var e,t;if(this.groups.filter(i=>i.api.location.type==="grid"&&i.api.isVisible).length===0){if(!this.watermark){this.watermark=this.createWatermarkComponent(),this.watermark.init({containerApi:new Ch(this)});const i=document.createElement("div");i.className="dv-watermark-container",q4(i,"watermark-component"),i.appendChild(this.watermark.element),this.gridview.element.appendChild(i)}}else this.watermark&&(this.watermark.element.parentElement.remove(),(t=(e=this.watermark).dispose)===null||t===void 0||t.call(e),this.watermark=null)}addGroup(e){var t;if(e){let i;if(EG(e)){const c=typeof e.referencePanel=="string"?this.panels.find(u=>u.id===e.referencePanel):e.referencePanel;if(!c)throw new Error(`reference panel ${e.referencePanel} does not exist`);if(i=this.findGroup(c),!i)throw new Error(`reference group for reference panel ${e.referencePanel} does not exist`)}else if(NG(e)){if(i=typeof e.referenceGroup=="string"?(t=this._groups.get(e.referenceGroup))===null||t===void 0?void 0:t.value:e.referenceGroup,!i)throw new Error(`reference group ${e.referenceGroup} does not exist`)}else{const c=this.orthogonalize(tC(e.direction));return e.skipSetActive||this.doSetGroupAndPanelActive(c),c}const r=wh(e.direction||"within"),o=wn(i.element),s=so(this.gridview.orientation,o,r),a=this.createGroup(e),l=this.getLocationOrientation(s)===Je.VERTICAL?e.initialHeight:e.initialWidth;return this.doAddGroup(a,s,l),e.skipSetActive||this.doSetGroupAndPanelActive(a),a}else{const i=this.createGroup(e);return this.doAddGroup(i),this.doSetGroupAndPanelActive(i),i}}getLocationOrientation(e){return e.length%2==0&&this.gridview.orientation===Je.HORIZONTAL?Je.HORIZONTAL:Je.VERTICAL}removeGroup(e,t){this.doRemoveGroup(e,t)}doRemoveGroup(e,t){var i;const r=[...e.panels];if(!(t!=null&&t.skipDispose))for(const a of r)this.removePanel(a,{removeEmptyGroup:!1,skipDispose:(i=t==null?void 0:t.skipDispose)!==null&&i!==void 0?i:!1});const o=this.activePanel;if(e.api.location.type==="floating"){const a=this._floatingGroups.find(l=>l.group===e);if(a){if(t!=null&&t.skipDispose||(a.group.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)),bm(this._floatingGroups,a),a.dispose(),!(t!=null&&t.skipActive)&&this._activeGroup===e){const l=Array.from(this._groups.values());this.doSetGroupAndPanelActive(l.length>0?l[0].value:void 0)}return a.group}throw new Error("failed to find floating group")}if(e.api.location.type==="popout"){const a=this._popoutGroups.find(l=>l.popoutGroup===e);if(a){if(!(t!=null&&t.skipDispose)){if(!(t!=null&&t.skipPopoutAssociated)){const c=a.referenceGroup?this.getPanel(a.referenceGroup):void 0;c&&this.removeGroup(c)}a.popoutGroup.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)}bm(this._popoutGroups,a);const l=a.disposable.dispose();if(!(t!=null&&t.skipPopoutReturn)&&l&&(this.doAddGroup(l,[0]),this.doSetGroupAndPanelActive(l)),!(t!=null&&t.skipActive)&&this._activeGroup===e){const c=Array.from(this._groups.values());this.doSetGroupAndPanelActive(c.length>0?c[0].value:void 0)}return this.updateWatermark(),a.popoutGroup}throw new Error("failed to find popout group")}const s=super.doRemoveGroup(e,t);return t!=null&&t.skipActive||this.activePanel!==o&&this._onDidActivePanelChange.fire(this.activePanel),s}movingLock(e){const t=this._moving;try{return this._moving=!0,e()}finally{this._moving=t}}moveGroupOrPanel(e){var t;const i=e.to.group,r=e.from.groupId,o=e.from.panelId,s=e.to.position,a=e.to.index,l=r?(t=this._groups.get(r))===null||t===void 0?void 0:t.value:void 0;if(!l)throw new Error(`Failed to find group id ${r}`);if(o===void 0){this.moveGroup({from:{group:l},to:{group:i,position:s}});return}if(!s||s==="center"){const c=this.movingLock(()=>l.model.removePanel(o,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!c)throw new Error(`No panel with id ${o}`);l.model.size===0&&this.doRemoveGroup(l,{skipActive:!0}),this.movingLock(()=>i.model.openPanel(c,{index:a,skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(i),this._onDidMovePanel.fire({panel:c,from:l})}else{const c=wn(i.element),u=so(this.gridview.orientation,c,s);if(l.size<2){const[d,f]=zo(u);if(l.api.location.type==="grid"){const g=wn(l.element),[v,x]=zo(g);if(J$(v,d)){this.gridview.moveView(v,x,f),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:l});return}}if(l.api.location.type==="popout"){const g=this._popoutGroups.find(b=>b.popoutGroup===l),v=this.movingLock(()=>g.popoutGroup.model.removePanel(g.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0}));this.doRemoveGroup(l,{skipActive:!0});const x=this.createGroupAtLocation(u);this.movingLock(()=>x.model.openPanel(v,{skipSetActive:!0})),this.doSetGroupAndPanelActive(x),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:l});return}const h=this.movingLock(()=>this.doRemoveGroup(l,{skipActive:!0,skipDispose:!0})),p=wn(i.element),m=so(this.gridview.orientation,p,s);this.movingLock(()=>this.doAddGroup(h,m)),this.doSetGroupAndPanelActive(h),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:l})}else{const d=this.movingLock(()=>l.model.removePanel(o,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!d)throw new Error(`No panel with id ${o}`);const f=so(this.gridview.orientation,c,s),h=this.createGroupAtLocation(f);this.movingLock(()=>h.model.openPanel(d,{skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(h),this._onDidMovePanel.fire({panel:d,from:l})}}}moveGroup(e){const t=e.from.group,i=e.to.group,r=e.to.position;if(r==="center"){const o=t.activePanel,s=this.movingLock(()=>[...t.panels].map(a=>t.model.removePanel(a.id,{skipSetActive:!0})));(t==null?void 0:t.model.size)===0&&this.doRemoveGroup(t,{skipActive:!0}),this.movingLock(()=>{for(const a of s)i.model.openPanel(a,{skipSetActive:a!==o,skipSetGroupActive:!0})}),this.doSetGroupAndPanelActive(i)}else{switch(t.api.location.type){case"grid":this.gridview.removeView(wn(t.element));break;case"floating":{const l=this._floatingGroups.find(c=>c.group===t);if(!l)throw new Error("failed to find floating group");l.dispose();break}case"popout":{const l=this._popoutGroups.find(c=>c.popoutGroup===t);if(!l)throw new Error("failed to find popout group");l.disposable.dispose()}}const o=wn(i.element),s=so(this.gridview.orientation,o,r);let a;switch(this.gridview.orientation){case Je.VERTICAL:a=o.length%2==0?t.api.width:t.api.height;break;case Je.HORIZONTAL:a=o.length%2==0?t.api.height:t.api.width;break}this.gridview.addView(t,a,s)}t.panels.forEach(o=>{this._onDidMovePanel.fire({panel:o,from:t})})}doSetGroupActive(e){super.doSetGroupActive(e);const t=this.activePanel;!this._moving&&t!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(t)}doSetGroupAndPanelActive(e){super.doSetGroupActive(e);const t=this.activePanel;e&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(e)&&this.exitMaximizedGroup(),!this._moving&&t!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(t)}getNextGroupId(){let e=this.nextGroupId.next();for(;this._groups.has(e);)e=this.nextGroupId.next();return e}createGroup(e){e||(e={});let t=e==null?void 0:e.id;if(t&&this._groups.has(e.id)&&(console.warn(`dockview: Duplicate group id ${e==null?void 0:e.id}. reassigning group id to avoid errors`),t=void 0),!t)for(t=this.nextGroupId.next();this._groups.has(t);)t=this.nextGroupId.next();const i=new rC(this,t,e);if(i.init({params:{},accessor:this}),!this._groups.has(i.id)){const r=new Et(i.model.onTabDragStart(o=>{this._onWillDragPanel.fire(o)}),i.model.onGroupDragStart(o=>{this._onWillDragGroup.fire(o)}),i.model.onMove(o=>{const{groupId:s,itemId:a,target:l,index:c}=o;this.moveGroupOrPanel({from:{groupId:s,panelId:a},to:{group:i,position:l,index:c}})}),i.model.onDidDrop(o=>{this._onDidDrop.fire(o)}),i.model.onWillDrop(o=>{this._onWillDrop.fire(o)}),i.model.onWillShowOverlay(o=>{if(this.options.disableDnd){o.preventDefault();return}this._onWillShowOverlay.fire(o)}),i.model.onUnhandledDragOverEvent(o=>{this._onUnhandledDragOverEvent.fire(o)}),i.model.onDidAddPanel(o=>{this._moving||this._onDidAddPanel.fire(o.panel)}),i.model.onDidRemovePanel(o=>{this._moving||this._onDidRemovePanel.fire(o.panel)}),i.model.onDidActivePanelChange(o=>{this._moving||o.panel===this.activePanel&&this._onDidActivePanelChange.value!==o.panel&&this._onDidActivePanelChange.fire(o.panel)}),sa.any(i.model.onDidPanelTitleChange,i.model.onDidPanelParametersChange)(()=>{this._bufferOnDidLayoutChange.fire()}));this._groups.set(i.id,{value:i,disposable:r})}return i.initialize(),i}createPanel(e,t){var i,r,o;const s=e.component,a=(i=e.tabComponent)!==null&&i!==void 0?i:this.options.defaultTabComponent,l=new uE(this,e.id,s,a),c=new Ja(e.id,s,a,this,this._api,t,l,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return c.init({title:(r=e.title)!==null&&r!==void 0?r:e.id,params:(o=e==null?void 0:e.params)!==null&&o!==void 0?o:{}}),c}createGroupAtLocation(e,t){const i=this.createGroup();return this.doAddGroup(i,e,t),i}findGroup(e){var t;return(t=Array.from(this._groups.values()).find(i=>i.value.model.containsPanel(e)))===null||t===void 0?void 0:t.value}orientationAtLocation(e){const t=this.gridview.orientation;return e.length%2==1?t:uo(t)}}class VG extends Q${get orientation(){return this.gridview.orientation}set orientation(e){this.gridview.orientation=e}get options(){return this._options}get deserializer(){return this._deserializer}set deserializer(e){this._deserializer=e}constructor(e,t){super(e,{proportionalLayout:t.proportionalLayout,orientation:t.orientation,styles:t.styles,disableAutoResizing:t.disableAutoResizing,className:t.className}),this._onDidLayoutfromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidRemoveGroup=new xe,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new xe,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidActiveGroupChange=new xe,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._options=t,this.addDisposables(this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this.onDidAdd(i=>{this._onDidAddGroup.fire(i)}),this.onDidRemove(i=>{this._onDidRemoveGroup.fire(i)}),this.onDidActiveChange(i=>{this._onDidActiveGroupChange.fire(i)})),this.options.components||(this.options.components={}),this.options.frameworkComponents||(this.options.frameworkComponents={})}updateOptions(e){super.updateOptions(e);const t=typeof e.orientation=="string"&&this.gridview.orientation!==e.orientation;this._options=Object.assign(Object.assign({},this.options),e),t&&(this.gridview.orientation=e.orientation),this.layout(this.gridview.width,this.gridview.height,!0)}removePanel(e){this.removeGroup(e)}toJSON(){var e;return{grid:this.gridview.serialize(),activePanel:(e=this.activeGroup)===null||e===void 0?void 0:e.id}}setVisible(e,t){this.gridview.setViewVisible(wn(e.element),t)}setActive(e){this._groups.forEach((t,i)=>{t.value.setActive(e===t.value)})}focus(){var e;(e=this.activeGroup)===null||e===void 0||e.focus()}fromJSON(e){this.clear();const{grid:t,activePanel:i}=e;try{const r=[],o=this.width,s=this.height;if(this.gridview.deserialize(t,{fromJSON:a=>{var l,c;const{data:u}=a,d=as(u.id,u.component,(l=this.options.components)!==null&&l!==void 0?l:{},(c=this.options.frameworkComponents)!==null&&c!==void 0?c:{},this.options.frameworkComponentFactory?{createComponent:this.options.frameworkComponentFactory.createComponent}:void 0);return r.push(()=>d.init({params:u.params,minimumWidth:u.minimumWidth,maximumWidth:u.maximumWidth,minimumHeight:u.minimumHeight,maximumHeight:u.maximumHeight,priority:u.priority,snap:!!u.snap,accessor:this,isVisible:a.visible})),this._onDidAddGroup.fire(d),this.registerPanel(d),d}}),this.layout(o,s,!0),r.forEach(a=>a()),typeof i=="string"){const a=this.getPanel(i);a&&this.doSetGroupActive(a)}}catch(r){for(const o of this.groups)o.dispose(),this._groups.delete(o.id),this._onDidRemoveGroup.fire(o);throw this.clear(),r}this._onDidLayoutfromJSON.fire()}clear(){const e=this.activeGroup,t=Array.from(this._groups.values());for(const i of t)i.disposable.dispose(),this.doRemoveGroup(i.value,{skipActive:!0});e&&this.doSetGroupActive(void 0),this.gridview.clear()}movePanel(e,t){var i;let r;const o=this.gridview.remove(e),s=(i=this._groups.get(t.reference))===null||i===void 0?void 0:i.value;if(!s)throw new Error(`reference group ${t.reference} does not exist`);const a=wh(t.direction);if(a==="center")throw new Error(`${a} not supported as an option`);{const l=wn(s.element);r=so(this.gridview.orientation,l,a)}this.doAddGroup(o,r,t.size)}addPanel(e){var t,i,r,o,s,a;let l=(t=e.location)!==null&&t!==void 0?t:[0];if(!((i=e.position)===null||i===void 0)&&i.referencePanel){const u=(r=this._groups.get(e.position.referencePanel))===null||r===void 0?void 0:r.value;if(!u)throw new Error(`reference group ${e.position.referencePanel} does not exist`);const d=wh(e.position.direction);if(d==="center")throw new Error(`${d} not supported as an option`);{const f=wn(u.element);l=so(this.gridview.orientation,f,d)}}const c=as(e.id,e.component,(o=this.options.components)!==null&&o!==void 0?o:{},(s=this.options.frameworkComponents)!==null&&s!==void 0?s:{},this.options.frameworkComponentFactory?{createComponent:this.options.frameworkComponentFactory.createComponent}:void 0);return c.init({params:(a=e.params)!==null&&a!==void 0?a:{},minimumWidth:e.minimumWidth,maximumWidth:e.maximumWidth,minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight,priority:e.priority,snap:!!e.snap,accessor:this,isVisible:!0}),this.registerPanel(c),this.doAddGroup(c,l,e.size),this.doSetGroupActive(c),c}registerPanel(e){const t=new Et(e.api.onDidFocusChange(i=>{i.isFocused&&this._groups.forEach(r=>{const o=r.value;o!==e?o.setActive(!1):o.setActive(!0)})}));this._groups.set(e.id,{value:e,disposable:t})}moveGroup(e,t,i){const r=this.getPanel(t);if(!r)throw new Error("invalid operation");const o=wn(e.element),s=so(this.gridview.orientation,o,i),[a,l]=zo(s),c=wn(r.element),[u,d]=zo(c);if(J$(u,a)){this.gridview.moveView(u,d,l);return}const f=this.doRemoveGroup(r,{skipActive:!0,skipDispose:!0}),h=wn(e.element),p=so(this.gridview.orientation,h,i);this.doAddGroup(f,p)}removeGroup(e){super.removeGroup(e)}dispose(){super.dispose(),this._onDidLayoutfromJSON.dispose()}}class WG extends dx{get panels(){return this.splitview.getViews()}get options(){return this._options}get length(){return this._panels.size}get orientation(){return this.splitview.orientation}get splitview(){return this._splitview}set splitview(e){this._splitview=e,this._splitviewChangeDisposable.value=new Et(this._splitview.onDidSashEnd(()=>{this._onDidLayoutChange.fire(void 0)}),this._splitview.onDidAddView(t=>this._onDidAddView.fire(t)),this._splitview.onDidRemoveView(t=>this._onDidRemoveView.fire(t)))}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get height(){return this.splitview.orientation===Je.HORIZONTAL?this.splitview.orthogonalSize:this.splitview.size}get width(){return this.splitview.orientation===Je.HORIZONTAL?this.splitview.size:this.splitview.orthogonalSize}constructor(e,t){var i;super(e,t.disableAutoResizing),this._splitviewChangeDisposable=new Ji,this._panels=new Map,this._onDidLayoutfromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidAddView=new xe,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new xe,this.onDidRemoveView=this._onDidRemoveView.event,this._onDidLayoutChange=new xe,this.onDidLayoutChange=this._onDidLayoutChange.event,this._classNames=new cx(this.element),this._classNames.setClassNames((i=t.className)!==null&&i!==void 0?i:""),this._options=t,t.components||(t.components={}),t.frameworkComponents||(t.frameworkComponents={}),this.splitview=new Vc(this.element,t),this.addDisposables(this._onDidAddView,this._onDidLayoutfromJSON,this._onDidRemoveView,this._onDidLayoutChange)}updateOptions(e){var t,i;"className"in e&&this._classNames.setClassNames((t=e.className)!==null&&t!==void 0?t:""),"disableResizing"in e&&(this.disableResizing=(i=e.disableAutoResizing)!==null&&i!==void 0?i:!1),typeof e.orientation=="string"&&(this.splitview.orientation=e.orientation),this._options=Object.assign(Object.assign({},this.options),e),this.splitview.layout(this.splitview.size,this.splitview.orthogonalSize)}focus(){var e;(e=this._activePanel)===null||e===void 0||e.focus()}movePanel(e,t){this.splitview.moveView(e,t)}setVisible(e,t){const i=this.panels.indexOf(e);this.splitview.setViewVisible(i,t)}setActive(e,t){this._activePanel=e,this.panels.filter(i=>i!==e).forEach(i=>{i.api._onDidActiveChange.fire({isActive:!1}),t||i.focus()}),e.api._onDidActiveChange.fire({isActive:!0}),t||e.focus()}removePanel(e,t){const i=this._panels.get(e.id);if(!i)throw new Error(`unknown splitview panel ${e.id}`);i.dispose(),this._panels.delete(e.id);const r=this.panels.findIndex(a=>a===e);this.splitview.removeView(r,t).dispose();const s=this.panels;s.length>0&&this.setActive(s[s.length-1])}getPanel(e){return this.panels.find(t=>t.id===e)}addPanel(e){var t,i,r;if(this._panels.has(e.id))throw new Error(`panel ${e.id} already exists`);const o=as(e.id,e.component,(t=this.options.components)!==null&&t!==void 0?t:{},(i=this.options.frameworkComponents)!==null&&i!==void 0?i:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.createComponent}:void 0);o.orientation=this.splitview.orientation,o.init({params:(r=e.params)!==null&&r!==void 0?r:{},minimumSize:e.minimumSize,maximumSize:e.maximumSize,snap:e.snap,priority:e.priority,accessor:this});const s=typeof e.size=="number"?e.size:wr.Distribute,a=typeof e.index=="number"?e.index:void 0;return this.splitview.addView(o,s,a),this.doAddView(o),this.setActive(o),o}layout(e,t){const[i,r]=this.splitview.orientation===Je.HORIZONTAL?[e,t]:[t,e];this.splitview.layout(i,r)}doAddView(e){const t=e.api.onDidFocusChange(i=>{i.isFocused&&this.setActive(e,!0)});this._panels.set(e.id,t)}toJSON(){var e;return{views:this.splitview.getViews().map((i,r)=>({size:this.splitview.getViewSize(r),data:i.toJSON(),snap:!!i.snap,priority:i.priority})),activeView:(e=this._activePanel)===null||e===void 0?void 0:e.id,size:this.splitview.size,orientation:this.splitview.orientation}}fromJSON(e){this.clear();const{views:t,orientation:i,size:r,activeView:o}=e,s=[],a=this.width,l=this.height;if(this.splitview=new Vc(this.element,{orientation:i,proportionalLayout:this.options.proportionalLayout,descriptor:{size:r,views:t.map(c=>{var u,d;const f=c.data;if(this._panels.has(f.id))throw new Error(`panel ${f.id} already exists`);const h=as(f.id,f.component,(u=this.options.components)!==null&&u!==void 0?u:{},(d=this.options.frameworkComponents)!==null&&d!==void 0?d:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.createComponent}:void 0);return s.push(()=>{var p;h.init({params:(p=f.params)!==null&&p!==void 0?p:{},minimumSize:f.minimumSize,maximumSize:f.maximumSize,snap:c.snap,priority:c.priority,accessor:this})}),h.orientation=i,this.doAddView(h),setTimeout(()=>{this._onDidAddView.fire(h)},0),{size:c.size,view:h}})}}),this.layout(a,l),s.forEach(c=>c()),typeof o=="string"){const c=this.getPanel(o);c&&this.setActive(c)}this._onDidLayoutfromJSON.fire()}clear(){for(const e of this._panels.values())e.dispose();for(this._panels.clear();this.splitview.length>0;)this.splitview.removeView(0,wr.Distribute,!0).dispose()}dispose(){for(const t of this._panels.values())t.dispose();this._panels.clear();const e=this.splitview.getViews();this._splitviewChangeDisposable.dispose(),this.splitview.dispose();for(const t of e)t.dispose();super.dispose()}}class lC extends Et{get element(){return this._element}constructor(){super(),this._expandedIcon=RG(),this._collapsedIcon=_G(),this.disposable=new Ji,this.apiRef={api:null},this._element=document.createElement("div"),this.element.className="default-header",this._content=document.createElement("span"),this._expander=document.createElement("div"),this._expander.className="dockview-pane-header-icon",this.element.appendChild(this._expander),this.element.appendChild(this._content),this.addDisposables(sn(this._element,"click",()=>{var e;(e=this.apiRef.api)===null||e===void 0||e.setExpanded(!this.apiRef.api.isExpanded)}))}init(e){this.apiRef.api=e.api,this._content.textContent=e.title,this.updateIcon(),this.disposable.value=e.api.onDidExpansionChange(()=>{this.updateIcon()})}updateIcon(){var e;const t=!!(!((e=this.apiRef.api)===null||e===void 0)&&e.isExpanded);At(this._expander,"collapsed",!t),t?(this._expander.contains(this._collapsedIcon)&&this._collapsedIcon.remove(),this._expander.contains(this._expandedIcon)||this._expander.appendChild(this._expandedIcon)):(this._expander.contains(this._expandedIcon)&&this._expandedIcon.remove(),this._expander.contains(this._collapsedIcon)||this._expander.appendChild(this._collapsedIcon))}update(e){}dispose(){this.disposable.dispose(),super.dispose()}}const GG=ux();class cC extends gG{constructor(e){super(e.accessor,e.id,e.component,e.headerComponent,e.orientation,e.isExpanded,e.disableDnd),this.options=e}getBodyComponent(){return this.options.body}getHeaderComponent(){return this.options.header}}class HG extends dx{get id(){return this._id}get panels(){return this.paneview.getPanes()}set paneview(e){this._paneview=e,this._disposable.value=new Et(this._paneview.onDidChange(()=>{this._onDidLayoutChange.fire(void 0)}),this._paneview.onDidAddView(t=>this._onDidAddView.fire(t)),this._paneview.onDidRemoveView(t=>this._onDidRemoveView.fire(t)))}get paneview(){return this._paneview}get minimumSize(){return this.paneview.minimumSize}get maximumSize(){return this.paneview.maximumSize}get height(){return this.paneview.orientation===Je.HORIZONTAL?this.paneview.orthogonalSize:this.paneview.size}get width(){return this.paneview.orientation===Je.HORIZONTAL?this.paneview.size:this.paneview.orthogonalSize}get options(){return this._options}constructor(e,t){var i;super(e,t.disableAutoResizing),this._id=GG.next(),this._disposable=new Ji,this._viewDisposables=new Map,this._onDidLayoutfromJSON=new xe,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidLayoutChange=new xe,this.onDidLayoutChange=this._onDidLayoutChange.event,this._onDidDrop=new xe,this.onDidDrop=this._onDidDrop.event,this._onDidAddView=new xe,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new xe,this.onDidRemoveView=this._onDidRemoveView.event,this.addDisposables(this._onDidLayoutChange,this._onDidLayoutfromJSON,this._onDidDrop,this._onDidAddView,this._onDidRemoveView),this._classNames=new cx(this.element),this._classNames.setClassNames((i=t.className)!==null&&i!==void 0?i:""),this._options=t,t.components||(t.components={}),t.frameworkComponents||(t.frameworkComponents={}),this.paneview=new eC(this.element,{orientation:Je.VERTICAL}),this.addDisposables(this._disposable)}setVisible(e,t){const i=this.panels.indexOf(e);this.paneview.setViewVisible(i,t)}focus(){}updateOptions(e){var t,i;"className"in e&&this._classNames.setClassNames((t=e.className)!==null&&t!==void 0?t:""),"disableResizing"in e&&(this.disableResizing=(i=e.disableAutoResizing)!==null&&i!==void 0?i:!1),this._options=Object.assign(Object.assign({},this.options),e)}addPanel(e){var t,i,r,o;const s=as(e.id,e.component,(t=this.options.components)!==null&&t!==void 0?t:{},(i=this.options.frameworkComponents)!==null&&i!==void 0?i:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.body.createComponent}:void 0);let a;e.headerComponent?a=as(e.id,e.headerComponent,(r=this.options.headerComponents)!==null&&r!==void 0?r:{},this.options.headerframeworkComponents,this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.header.createComponent}:void 0):a=new lC;const l=new cC({id:e.id,component:e.component,headerComponent:e.headerComponent,header:a,body:s,orientation:Je.VERTICAL,isExpanded:!!e.isExpanded,disableDnd:!!this.options.disableDnd,accessor:this});this.doAddPanel(l);const c=typeof e.size=="number"?e.size:wr.Distribute,u=typeof e.index=="number"?e.index:void 0;return l.init({params:(o=e.params)!==null&&o!==void 0?o:{},minimumBodySize:e.minimumBodySize,maximumBodySize:e.maximumBodySize,isExpanded:e.isExpanded,title:e.title,containerApi:new Wc(this),accessor:this}),this.paneview.addPane(l,c,u),l.orientation=this.paneview.orientation,l}removePanel(e){const i=this.panels.findIndex(r=>r===e);this.paneview.removePane(i),this.doRemovePanel(e)}movePanel(e,t){this.paneview.moveView(e,t)}getPanel(e){return this.panels.find(t=>t.id===e)}layout(e,t){const[i,r]=this.paneview.orientation===Je.HORIZONTAL?[e,t]:[t,e];this.paneview.layout(i,r)}toJSON(){const e=r=>r===Number.MAX_SAFE_INTEGER||r===Number.POSITIVE_INFINITY?void 0:r,t=r=>r<=0?void 0:r;return{views:this.paneview.getPanes().map((r,o)=>({size:this.paneview.getViewSize(o),data:r.toJSON(),minimumSize:t(r.minimumBodySize),maximumSize:e(r.maximumBodySize),expanded:r.isExpanded()})),size:this.paneview.size}}fromJSON(e){this.clear();const{views:t,size:i}=e,r=[],o=this.width,s=this.height;this.paneview=new eC(this.element,{orientation:Je.VERTICAL,descriptor:{size:i,views:t.map(a=>{var l,c,u,d;const f=a.data,h=as(f.id,f.component,(l=this.options.components)!==null&&l!==void 0?l:{},(c=this.options.frameworkComponents)!==null&&c!==void 0?c:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.body.createComponent}:void 0);let p;f.headerComponent?p=as(f.id,f.headerComponent,(u=this.options.headerComponents)!==null&&u!==void 0?u:{},(d=this.options.headerframeworkComponents)!==null&&d!==void 0?d:{},this.options.frameworkWrapper?{createComponent:this.options.frameworkWrapper.header.createComponent}:void 0):p=new lC;const m=new cC({id:f.id,component:f.component,headerComponent:f.headerComponent,header:p,body:h,orientation:Je.VERTICAL,isExpanded:!!a.expanded,disableDnd:!!this.options.disableDnd,accessor:this});return this.doAddPanel(m),r.push(()=>{var g;m.init({params:(g=f.params)!==null&&g!==void 0?g:{},minimumBodySize:a.minimumSize,maximumBodySize:a.maximumSize,title:f.title,isExpanded:!!a.expanded,containerApi:new Wc(this),accessor:this}),m.orientation=this.paneview.orientation}),setTimeout(()=>{this._onDidAddView.fire(m)},0),{size:a.size,view:m}})}}),this.layout(o,s),r.forEach(a=>a()),this._onDidLayoutfromJSON.fire()}clear(){for(const[e,t]of this._viewDisposables.entries())t.dispose();this._viewDisposables.clear(),this.paneview.dispose()}doAddPanel(e){const t=e.onDidDrop(i=>{this._onDidDrop.fire(i)});this._viewDisposables.set(e.id,t)}doRemovePanel(e){const t=this._viewDisposables.get(e.id);t&&(t.dispose(),this._viewDisposables.delete(e.id))}dispose(){super.dispose();for(const[e,t]of this._viewDisposables.entries())t.dispose();this._viewDisposables.clear(),this.paneview.dispose()}}class UG extends fx{get priority(){return this._priority}set orientation(e){this._orientation=e}get orientation(){return this._orientation}get minimumSize(){const e=typeof this._minimumSize=="function"?this._minimumSize():this._minimumSize;return e!==this._evaluatedMinimumSize&&(this._evaluatedMinimumSize=e,this.updateConstraints()),e}get maximumSize(){const e=typeof this._maximumSize=="function"?this._maximumSize():this._maximumSize;return e!==this._evaluatedMaximumSize&&(this._evaluatedMaximumSize=e,this.updateConstraints()),e}get snap(){return this._snap}constructor(e,t){super(e,t,new oE(e,t)),this._evaluatedMinimumSize=0,this._evaluatedMaximumSize=Number.POSITIVE_INFINITY,this._minimumSize=0,this._maximumSize=Number.POSITIVE_INFINITY,this._snap=!1,this._onDidChange=new xe,this.onDidChange=this._onDidChange.event,this.api.initialize(this),this.addDisposables(this._onDidChange,this.api.onWillVisibilityChange(i=>{const{isVisible:r}=i,{accessor:o}=this._params;o.setVisible(this,r)}),this.api.onActiveChange(()=>{const{accessor:i}=this._params;i.setActive(this)}),this.api.onDidConstraintsChangeInternal(i=>{(typeof i.minimumSize=="number"||typeof i.minimumSize=="function")&&(this._minimumSize=i.minimumSize),(typeof i.maximumSize=="number"||typeof i.maximumSize=="function")&&(this._maximumSize=i.maximumSize),this.updateConstraints()}),this.api.onDidSizeChange(i=>{this._onDidChange.fire({size:i.size})}))}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}layout(e,t){const[i,r]=this.orientation===Je.HORIZONTAL?[e,t]:[t,e];super.layout(i,r)}init(e){super.init(e),this._priority=e.priority,e.minimumSize&&(this._minimumSize=e.minimumSize),e.maximumSize&&(this._maximumSize=e.maximumSize),e.snap&&(this._snap=e.snap)}toJSON(){const e=i=>i===Number.MAX_SAFE_INTEGER||i===Number.POSITIVE_INFINITY?void 0:i,t=i=>i<=0?void 0:i;return Object.assign(Object.assign({},super.toJSON()),{minimumSize:t(this.minimumSize),maximumSize:e(this.maximumSize)})}updateConstraints(){this.api._onDidConstraintsChange.fire({maximumSize:this._evaluatedMaximumSize,minimumSize:this._evaluatedMinimumSize})}}function jG(n,e){return new BG(n,e).api}function KG(n,e){const t=new WG(n,e);return new eE(t)}function XG(n,e){const t=new VG(n,e);return new tE(t)}function qG(n,e){const t=new HG(n,e);return new Wc(t)}const dE=(n,e)=>{const[t,i]=le.useState(),r=le.useRef(n.componentProps);return le.useImperativeHandle(e,()=>({update:o=>{r.current=Object.assign(Object.assign({},r.current),o),i(Date.now())}}),[]),le.createElement(n.component,r.current)};dE.displayName="DockviewReactJsBridge";const YG=(()=>{let n=1;return{next:()=>`dockview_react_portal_key_${(n++).toString()}`}})(),JG=le.createContext({});class Ra{constructor(e,t,i,r,o){this.parent=e,this.portalStore=t,this.component=i,this.parameters=r,this.context=o,this._initialProps={},this.disposed=!1,this.createPortal()}update(e){if(this.disposed)throw new Error("invalid operation: resource is already disposed");this.componentInstance?this.componentInstance.update(e):this._initialProps=Object.assign(Object.assign({},this._initialProps),e)}createPortal(){if(this.disposed)throw new Error("invalid operation: resource is already disposed");if(!ZG(this.component))throw new Error("Dockview: Only React.memo(...), React.ForwardRef(...) and functional components are accepted as components");const e=le.createElement(le.forwardRef(dE),{component:this.component,componentProps:this.parameters,ref:r=>{this.componentInstance=r,Object.keys(this._initialProps).length>0&&(this.componentInstance.update(this._initialProps),this._initialProps={})}}),t=this.context?le.createElement(JG.Provider,{value:this.context},e):e,i=jm.createPortal(t,this.parent,YG.next());this.ref={portal:i,disposable:this.portalStore.addPortal(i)}}dispose(){var e;(e=this.ref)===null||e===void 0||e.disposable.dispose(),this.disposed=!0}}const xf=()=>{const[n,e]=le.useState([]);le.useDebugValue(`Portal count: ${n.length}`);const t=le.useCallback(i=>{e(o=>[...o,i]);let r=!1;return Pi.from(()=>{if(r)throw new Error("invalid operation: resource already disposed");r=!0,e(o=>o.filter(s=>s!==i))})},[]);return[n,t]};function ZG(n){return typeof n=="function"||!!(n!=null&&n.$$typeof)}class uC{get element(){return this._element}constructor(e,t,i){this.id=e,this.component=t,this.reactPortalStore=i,this._onDidFocus=new xe,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new xe,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(e){this.part=new Ra(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,containerApi:e.containerApi})}update(e){var t;(t=this.part)===null||t===void 0||t.update({params:e.params})}layout(e,t){}dispose(){var e;this._onDidFocus.dispose(),this._onDidBlur.dispose(),(e=this.part)===null||e===void 0||e.dispose()}}class dC{get element(){return this._element}constructor(e,t,i){this.id=e,this.component=t,this.reactPortalStore=i,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(e){this.part=new Ra(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,containerApi:e.containerApi})}update(e){var t;(t=this.part)===null||t===void 0||t.update({params:e.params})}layout(e,t){}dispose(){var e;(e=this.part)===null||e===void 0||e.dispose()}}class hC{get element(){return this._element}constructor(e,t,i){this.id=e,this.component=t,this.reactPortalStore=i,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(e){this.part=new Ra(this.element,this.reactPortalStore,this.component,{group:e.group,containerApi:e.containerApi})}focus(){}update(e){var t,i,r;this.parameters&&(this.parameters.params=e.params),(t=this.part)===null||t===void 0||t.update({params:(r=(i=this.parameters)===null||i===void 0?void 0:i.params)!==null&&r!==void 0?r:{}})}layout(e,t){}dispose(){var e;(e=this.part)===null||e===void 0||e.dispose()}}class QG{get element(){return this._element}get part(){return this._part}constructor(e,t,i){this.component=e,this.reactPortalStore=t,this._group=i,this.mutableDisposable=new Ji,this._element=document.createElement("div"),this._element.className="dockview-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(e){this.mutableDisposable.value=new Et(this._group.model.onDidAddPanel(()=>{this.updatePanels()}),this._group.model.onDidRemovePanel(()=>{this.updatePanels()}),this._group.model.onDidActivePanelChange(()=>{this.updateActivePanel()}),e.api.onDidActiveChange(()=>{this.updateGroupActive()})),this._part=new Ra(this.element,this.reactPortalStore,this.component,{api:e.api,containerApi:e.containerApi,panels:this._group.model.panels,activePanel:this._group.model.activePanel,isGroupActive:this._group.api.isActive,group:this._group})}dispose(){var e;this.mutableDisposable.dispose(),(e=this._part)===null||e===void 0||e.dispose()}update(e){var t;(t=this._part)===null||t===void 0||t.update(e.params)}updatePanels(){this.update({params:{panels:this._group.model.panels}})}updateActivePanel(){this.update({params:{activePanel:this._group.model.activePanel}})}updateGroupActive(){this.update({params:{isGroupActive:this._group.api.isActive}})}}function ja(n,e){return n?t=>new QG(n,e,t):void 0}const zd="props.defaultTabComponent";function eH(n){return xg.reduce((t,i)=>(i in n&&(t[i]=n[i]),t),{})}const tH=le.forwardRef((n,e)=>{const t=le.useRef(null),i=le.useRef(),[r,o]=xf();le.useImperativeHandle(e,()=>t.current,[]);const s=le.useRef({});return le.useEffect(()=>{const a={};xg.forEach(l=>{const c=l,u=n[c];c in n&&u!==s.current[c]&&(a[c]=u)}),i.current&&i.current.updateOptions(a),s.current=n},xg.map(a=>n[a])),le.useEffect(()=>{var a;if(!t.current)return;const l=(a=n.tabComponents)!==null&&a!==void 0?a:{};n.defaultTabComponent&&(l[zd]=n.defaultTabComponent);const c={createLeftHeaderActionComponent:ja(n.leftHeaderActionsComponent,{addPortal:o}),createRightHeaderActionComponent:ja(n.rightHeaderActionsComponent,{addPortal:o}),createPrefixHeaderActionComponent:ja(n.prefixHeaderActionsComponent,{addPortal:o}),createComponent:h=>new uC(h.id,n.components[h.name],{addPortal:o}),createTabComponent(h){return new dC(h.id,l[h.name],{addPortal:o})},createWatermarkComponent:n.watermarkComponent?()=>new hC("watermark",n.watermarkComponent,{addPortal:o}):void 0,defaultTabComponent:n.defaultTabComponent?zd:void 0},u=jG(t.current,Object.assign(Object.assign({},eH(n)),c)),{clientWidth:d,clientHeight:f}=t.current;return u.layout(d,f),n.onReady&&n.onReady({api:u}),i.current=u,()=>{u.dispose()}},[]),le.useEffect(()=>{if(!i.current)return()=>{};const a=i.current.onDidDrop(l=>{n.onDidDrop&&n.onDidDrop(l)});return()=>{a.dispose()}},[n.onDidDrop]),le.useEffect(()=>{if(!i.current)return()=>{};const a=i.current.onUnhandledDragOverEvent(l=>{var c;!((c=n.showDndOverlay)===null||c===void 0)&&c.call(n,l)&&l.accept()});return()=>{a.dispose()}},[n.showDndOverlay]),le.useEffect(()=>{if(!i.current)return()=>{};const a=i.current.onWillDrop(l=>{n.onWillDrop&&n.onWillDrop(l)});return()=>{a.dispose()}},[n.onWillDrop]),le.useEffect(()=>{i.current&&i.current.updateOptions({createComponent:a=>new uC(a.id,n.components[a.name],{addPortal:o})})},[n.components]),le.useEffect(()=>{var a;if(!i.current)return;const l=(a=n.tabComponents)!==null&&a!==void 0?a:{};n.defaultTabComponent&&(l[zd]=n.defaultTabComponent),i.current.updateOptions({defaultTabComponent:n.defaultTabComponent?zd:void 0,createTabComponent(c){return new dC(c.id,l[c.name],{addPortal:o})}})},[n.tabComponents,n.defaultTabComponent]),le.useEffect(()=>{i.current&&i.current.updateOptions({createWatermarkComponent:n.watermarkComponent?()=>new hC("watermark",n.watermarkComponent,{addPortal:o}):void 0})},[n.watermarkComponent]),le.useEffect(()=>{i.current&&i.current.updateOptions({createRightHeaderActionComponent:ja(n.rightHeaderActionsComponent,{addPortal:o})})},[n.rightHeaderActionsComponent]),le.useEffect(()=>{i.current&&i.current.updateOptions({createLeftHeaderActionComponent:ja(n.leftHeaderActionsComponent,{addPortal:o})})},[n.leftHeaderActionsComponent]),le.useEffect(()=>{i.current&&i.current.updateOptions({createPrefixHeaderActionComponent:ja(n.prefixHeaderActionsComponent,{addPortal:o})})},[n.prefixHeaderActionsComponent]),le.createElement("div",{className:n.className,style:{height:"100%",width:"100%"},ref:t},r)});tH.displayName="DockviewComponent";class nH extends UG{constructor(e,t,i,r){super(e,t),this.reactComponent=i,this.reactPortalStore=r}getComponent(){var e,t;return new Ra(this.element,this.reactPortalStore,this.reactComponent,{params:(t=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&t!==void 0?t:{},api:this.api,containerApi:new eE(this._params.accessor)})}}const iH=le.forwardRef((n,e)=>{const t=le.useRef(null),i=le.useRef(),[r,o]=xf();return le.useImperativeHandle(e,()=>t.current,[]),le.useEffect(()=>{var s;const a=KG(t.current,{disableAutoResizing:n.disableAutoResizing,orientation:(s=n.orientation)!==null&&s!==void 0?s:Je.HORIZONTAL,frameworkComponents:n.components,frameworkWrapper:{createComponent:(u,d,f)=>new nH(u,d,f,{addPortal:o})},proportionalLayout:typeof n.proportionalLayout=="boolean"?n.proportionalLayout:!0,styles:n.hideBorders?{separatorBorder:"transparent"}:void 0}),{clientWidth:l,clientHeight:c}=t.current;return a.layout(l,c),n.onReady&&n.onReady({api:a}),i.current=a,()=>{a.dispose()}},[]),le.useEffect(()=>{i.current&&i.current.updateOptions({frameworkComponents:n.components})},[n.components]),le.createElement("div",{className:n.className,style:{height:"100%",width:"100%"},ref:t},r)});iH.displayName="SplitviewComponent";class rH extends lE{constructor(e,t,i,r){super(e,t),this.reactComponent=i,this.reactPortalStore=r}getComponent(){var e,t;return new Ra(this.element,this.reactPortalStore,this.reactComponent,{params:(t=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&t!==void 0?t:{},api:this.api,containerApi:new tE(this._params.accessor)})}}const oH=le.forwardRef((n,e)=>{const t=le.useRef(null),i=le.useRef(),[r,o]=xf();return le.useImperativeHandle(e,()=>t.current,[]),le.useEffect(()=>{var s;if(!t.current)return()=>{};const a=XG(t.current,{disableAutoResizing:n.disableAutoResizing,proportionalLayout:typeof n.proportionalLayout=="boolean"?n.proportionalLayout:!0,orientation:(s=n.orientation)!==null&&s!==void 0?s:Je.HORIZONTAL,frameworkComponents:n.components,frameworkComponentFactory:{createComponent:(u,d,f)=>new rH(u,d,f,{addPortal:o})},styles:n.hideBorders?{separatorBorder:"transparent"}:void 0}),{clientWidth:l,clientHeight:c}=t.current;return a.layout(l,c),n.onReady&&n.onReady({api:a}),i.current=a,()=>{a.dispose()}},[]),le.useEffect(()=>{i.current&&i.current.updateOptions({frameworkComponents:n.components})},[n.components]),le.createElement("div",{className:n.className,style:{height:"100%",width:"100%"},ref:t},r)});oH.displayName="GridviewComponent";class sH{get element(){return this._element}constructor(e,t,i){this.id=e,this.component=t,this.reactPortalStore=i,this._element=document.createElement("div"),this._element.style.height="100%",this._element.style.width="100%"}init(e){this.part=new Ra(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,title:e.title,containerApi:e.containerApi})}toJSON(){return{id:this.id}}update(e){var t;(t=this.part)===null||t===void 0||t.update(e.params)}dispose(){var e;(e=this.part)===null||e===void 0||e.dispose()}}const aH=le.forwardRef((n,e)=>{const t=le.useRef(null),i=le.useRef(),[r,o]=xf();return le.useImperativeHandle(e,()=>t.current,[]),le.useEffect(()=>{const s=(u,d,f)=>new sH(u,f,{addPortal:o}),a=qG(t.current,{disableAutoResizing:n.disableAutoResizing,frameworkComponents:n.components,components:{},headerComponents:{},disableDnd:n.disableDnd,headerframeworkComponents:n.headerComponents,frameworkWrapper:{header:{createComponent:s},body:{createComponent:s}},showDndOverlay:n.showDndOverlay}),{clientWidth:l,clientHeight:c}=t.current;return a.layout(l,c),n.onReady&&n.onReady({api:a}),i.current=a,()=>{a.dispose()}},[]),le.useEffect(()=>{i.current&&i.current.updateOptions({frameworkComponents:n.components})},[n.components]),le.useEffect(()=>{i.current&&i.current.updateOptions({headerframeworkComponents:n.headerComponents})},[n.headerComponents]),le.useEffect(()=>{if(!i.current)return()=>{};const s=i.current,a=s.onDidDrop(l=>{n.onDidDrop&&n.onDidDrop(Object.assign(Object.assign({},l),{api:s}))});return()=>{a.dispose()}},[n.onDidDrop]),le.useEffect(()=>{i.current&&i.current.updateOptions({showDndOverlay:n.showDndOverlay})},[n.showDndOverlay]),le.createElement("div",{className:n.className,style:{height:"100%",width:"100%"},ref:t},r)});aH.displayName="PaneviewComponent";var di=(n=>(n.Neuron="neuron",n.Axon="axon",n))(di||{}),aa=(n=>(n.Input="input",n.Hidden="hidden",n.Output="output",n))(aa||{});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH=1e-7,cH=1e-4;class hE{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class vx{refCount(e){return Gi("refCount")}incRef(e){return Gi("incRef")}timerAvailable(){return!0}time(e){return Gi("time")}read(e){return Gi("read")}readSync(e){return Gi("readSync")}readToGPU(e,t){return Gi("readToGPU")}numDataIds(){return Gi("numDataIds")}disposeData(e,t){return Gi("disposeData")}write(e,t,i){return Gi("write")}move(e,t,i,r,o){return Gi("move")}createTensorFromGPUData(e,t,i){return Gi("createTensorFromGPUData")}memory(){return Gi("memory")}floatPrecision(){return Gi("floatPrecision")}epsilon(){return this.floatPrecision()===32?lH:cH}dispose(){return Gi("dispose")}}function Gi(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uH(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Za(n,e,t)}function fa(n,e,t){return Math.max(n,Math.min(e,t))}function xx(n){return n%2===0?n:n+1}function Za(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}function dH(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function F(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function bx(n,e,t=""){F(Ht(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function fE(n){F(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function he(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Ht(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function kl(n){return n%1===0}function bg(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function al(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function fC(n,e=r=>0,t,i){return new Promise((r,o)=>{let s=0;const a=()=>{if(n()){r();return}s++;const l=e(s);if(t!=null&&s>=t){o();return}i!=null?i(a,l):setTimeout(a,l)};a()})}function pE(n,e){let t=1,i=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(i!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${o}`);i=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(i===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[i]=e/t,r}function Ct(n,e){const t=e.length;return n=n==null?e.map((i,r)=>r):[].concat(n),F(n.every(i=>i>=-t&&i<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),F(n.every(i=>kl(i)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(i=>i<0?t+i:i)}function ks(n,e){const t=[],i=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Ct(e,n).sort();let s=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[s]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[s]==null||o[s]>a)&&n[a]===1&&(t.push(n[a]),i.push(a)),o[s]<=a&&s++}n[a]!==1&&(t.push(n[a]),i.push(a))}return{newShape:t,keptDims:i}}function pi(n,e){return Sn(n,e)}function Sn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function hH(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${e} being uploaded contains ${i}.`)}}function fH(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function mE(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Ih(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function pH(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function uu(n){return typeof n=="string"||n instanceof String}function mH(n){return typeof n=="boolean"}function yg(n){return typeof n=="number"}function Yl(n){return Array.isArray(n)?Yl(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":yg(n)?"float32":uu(n)?"string":mH(n)?"bool":"float32"}function wg(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Cg(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Qe(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let i=e-3;i>=0;--i)t[i]=t[i+1]*n[i+1];return t}function gE(n,e,t,i=!1){const r=new Array;if(e.length===1){const o=e[0]*(i?2:1);for(let s=0;s<o;s++)r[s]=t[n+s]}else{const o=e[0],s=e.slice(1),a=s.reduce((l,c)=>l*c)*(i?2:1);for(let l=0;l<o;l++)r[l]=gE(n+l*a,s,t,i)}return r}function Wr(n,e,t=!1){if(n.length===0)return e[0];const i=n.reduce((r,o)=>r*o)*(t?2:1);if(i===0)return[];if(i!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return gE(0,n,e,t)}function gH(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function yx(n,e){const t=mi(n,e);for(let i=0;i<t.length;i++)t[i]=1;return t}function mi(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function vE(n,e){const t=n.reduce((i,r)=>i*r,1);if(e==null||e==="float32")return Wr(n,new Float32Array(t));if(e==="int32")return Wr(n,new Int32Array(t));if(e==="bool")return Wr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Zo(n){n.forEach(e=>{F(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function go(n,e,t){if(e===0)return 0;if(e===1)return n[0];let i=n[n.length-1];for(let r=0;r<n.length-1;++r)i+=t[r]*n[r];return i}function Jl(n,e,t){if(e===0)return[];if(e===1)return[n];const i=new Array(e);for(let r=0;r<i.length-1;++r)i[r]=Math.floor(n/t[r]),n-=i[r]*t[r];return i[i.length-1]=n,i}function wx(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pC="tfjsflags";class vH{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=xH,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,i){if(this.flagRegistry[e]={evaluationFn:t,setHook:i},this.urlFlags[e]!=null){const r=this.urlFlags[e];ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(wx(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);pC in e&&e[pC].split(",").forEach(i=>{const[r,o]=i.split(":");this.urlFlags[r]=yH(r,o)})}}function xH(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...i)=>(bH(e,i[0],i[1]),i.join("="))),e}function bH(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function yH(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ae(){return xE}let xE=null;function wH(n){xE=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wm;function bE(){if(wm==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");wm=n}return wm}function CH(){const n=bE();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Cx(n,e){const t=CH();if(t.has(n))return t.get(n);{const i=e();return t.set(n,i),t.get(n)}}const bf="Abs",du="Acos",hu="Acosh",Zl="Add",Sx="AddN",Ix="All",$x="Any",yf="ArgMax",wf="ArgMin",fu="Asin",pu="Asinh",mu="Atan",gu="Atanh",vu="Atan2",Cf="AvgPool",Ex="AvgPoolGrad",Sf="AvgPool3D",Nx="AvgPool3DGrad",If="BatchMatMul",$f="BatchToSpaceND",kx="Bincount",Dx="BitwiseAnd",SH="BroadcastTo",yE="BroadcastArgs",xu="Cast",bu="Ceil",yu="ClipByValue",Tx="Complex",Ef="ComplexAbs",Nf="Concat",kf="Conv2D",Rx="Conv2DBackpropFilter",Df="Conv2DBackpropInput",Tf="Conv3D",_x="Conv3DBackpropFilterV2",Ax="Conv3DBackpropInputV2",wu="Cos",Cu="Cosh",Ox="Cumprod",Rf="Cumsum",Px="CropAndResize",Mx="DenseBincount",Fx="DepthToSpace",_f="DepthwiseConv2dNative",Lx="DepthwiseConv2dNativeBackpropFilter",zx="DepthwiseConv2dNativeBackpropInput",wE="Diag",Af="Dilation2D",Sg="Dilation2DBackpropInput",Ig="Dilation2DBackpropFilter",IH="Draw",Su="RealDiv",Bx="Einsum",Iu="Elu",Vx="EluGrad",$u="Erf",Of="Equal",Eu="Exp",Pf="ExpandDims",Nu="Expm1",Wx="FFT",Gx="Fill",Hx="FlipLeftRight",ku="Floor",Du="FloorDiv",Mf="FusedBatchNorm",Ff="GatherV2",CE="GatherNd",Lf="Greater",Tu="GreaterEqual",Ru="Identity",Ux="IFFT",jx="Imag",_u="IsFinite",Au="IsInf",Ou="IsNan",zf="LeakyRelu",Bf="Less",Vf="LessEqual",SE="LinSpace",Pu="Log",Mu="Log1p",Wf="LogicalAnd",Gf="LogicalNot",Hf="LogicalOr",$H="LogSoftmax",Uf="LRN",Kx="LRNGrad",jf="Max",Fu="Maximum",Kf="MaxPool",Xx="MaxPoolGrad",Xf="MaxPool3D",qx="MaxPool3DGrad",IE="MaxPoolWithArgmax",qf="Mean",Yf="Min",Lu="Minimum",Jf="MirrorPad",zu="Mod",$E="Multinomial",Bu="Multiply",Zf="Neg",Qf="NotEqual",Yx="NonMaxSuppressionV3",Jx="NonMaxSuppressionV4",Zx="NonMaxSuppressionV5",ep="OnesLike",tp="OneHot",np="Pack",ip="PadV2",Vu="Pow",rp="Prelu",op="Prod",EE="RaggedGather",NE="RaggedRange",kE="RaggedTensorToTensor",Qx="Range",e0="Real",Wu="Reciprocal",Gu="Relu",sp="Reshape",ap="ResizeNearestNeighbor",t0="ResizeNearestNeighborGrad",lp="ResizeBilinear",n0="ResizeBilinearGrad",Hu="Relu6",cp="Reverse",Uu="Round",ju="Rsqrt",DE="ScatterNd",TE="TensorScatterUpdate",RE="SearchSorted",up="Select",Ku="Selu",dp="Slice",Xu="Sin",qu="Sinh",Yu="Sign",Ju="Sigmoid",Zu="Softplus",Qu="Sqrt",hp="Sum",fp="SpaceToBatchND",pp="SplitV",mp="Softmax",_E="SparseFillEmptyRows",AE="SparseReshape",OE="SparseSegmentMean",PE="SparseSegmentSum",ME="SparseToDense",ed="SquaredDifference",i0="Square",r0="StaticRegexReplace",o0="StridedSlice",FE="StringNGrams",LE="StringSplit",zE="StringToHashBucketFast",td="Sub",nd="Tan",id="Tanh",rd="Tile",s0="TopK",a0="Transform",ll="Transpose",l0="Unique",gp="Unpack",vp="UnsortedSegmentSum",xp="ZerosLike",od="Step",EH="FromPixels",c0="RotateWithOffset",$h="_FusedMatMul",Eh="FusedConv2D",BE="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(...n){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(...n)}function NH(...n){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nh=Cx("kernelRegistry",()=>new Map),$g=Cx("gradRegistry",()=>new Map);function mC(n,e){const t=WE(n,e);return Nh.get(t)}function gC(n){return $g.get(n)}function vC(n){const e=Nh.entries(),t=[];for(;;){const{done:i,value:r}=e.next();if(i)break;const[o,s]=r,[a]=o.split("_");a===n&&t.push(s)}return t}function VE(n){const{kernelName:e,backendName:t}=n,i=WE(e,t);Nh.has(i)&&rr(`The kernel '${e}' for backend '${t}' is already registered`),Nh.set(i,n)}function kH(n){const{kernelName:e}=n;$g.has(e)&&ae().getBool("DEBUG")&&rr(`Overriding the gradient for '${e}'`),$g.set(e,n)}function WE(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GE(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var HE=ln,Cr=null;try{Cr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ln(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}ln.prototype.__isLong__;Object.defineProperty(ln.prototype,"__isLong__",{value:!0});function tr(n){return(n&&n.__isLong__)===!0}ln.isLong=tr;var xC={},bC={};function _a(n,e){var t,i,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(i=bC[n],i)?i:(t=cn(n,(n|0)<0?-1:0,!0),r&&(bC[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(i=xC[n],i)?i:(t=cn(n,n<0?-1:0,!1),r&&(xC[n]=t),t))}ln.fromInt=_a;function Sr(n,e){if(isNaN(n))return e?Qs:Ir;if(e){if(n<0)return Qs;if(n>=UE)return XE}else{if(n<=-wC)return Ki;if(n+1>=wC)return KE}return n<0?Sr(-n,e).neg():cn(n%Dl|0,n/Dl|0,e)}ln.fromNumber=Sr;function cn(n,e,t){return new ln(n,e,t)}ln.fromBits=cn;var kh=Math.pow;function u0(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ir;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var i;if((i=n.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return u0(n.substring(1),e,t).neg();for(var r=Sr(kh(t,8)),o=Ir,s=0;s<n.length;s+=8){var a=Math.min(8,n.length-s),l=parseInt(n.substring(s,s+a),t);if(a<8){var c=Sr(kh(t,a));o=o.mul(c).add(Sr(l))}else o=o.mul(r),o=o.add(Sr(l))}return o.unsigned=e,o}ln.fromString=u0;function qr(n,e){return typeof n=="number"?Sr(n,e):typeof n=="string"?u0(n,e):cn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}ln.fromValue=qr;var yC=65536,DH=1<<24,Dl=yC*yC,UE=Dl*Dl,wC=UE/2,CC=_a(DH),Ir=_a(0);ln.ZERO=Ir;var Qs=_a(0,!0);ln.UZERO=Qs;var nl=_a(1);ln.ONE=nl;var jE=_a(1,!0);ln.UONE=jE;var Eg=_a(-1);ln.NEG_ONE=Eg;var KE=cn(-1,2147483647,!1);ln.MAX_VALUE=KE;var XE=cn(-1,-1,!0);ln.MAX_UNSIGNED_VALUE=XE;var Ki=cn(0,-2147483648,!1);ln.MIN_VALUE=Ki;var Re=ln.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Dl+(this.low>>>0):this.high*Dl+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ki)){var t=Sr(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Sr(kh(e,6),this.unsigned),s=this,a="";;){var l=s.div(o),c=s.sub(l.mul(o)).toInt()>>>0,u=c.toString(e);if(s=l,s.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ki)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return tr(e)||(e=qr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(tr(e)||(e=qr(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Ki)?Ki:this.not().add(nl)};Re.neg=Re.negate;Re.add=function(e){tr(e)||(e=qr(e));var t=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,s=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,d=0,f=0,h=0;return h+=o+c,f+=h>>>16,h&=65535,f+=r+l,d+=f>>>16,f&=65535,d+=i+a,u+=d>>>16,d&=65535,u+=t+s,u&=65535,cn(f<<16|h,u<<16|d,this.unsigned)};Re.subtract=function(e){return tr(e)||(e=qr(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return Ir;if(tr(e)||(e=qr(e)),Cr){var t=Cr.mul(this.low,this.high,e.low,e.high);return cn(t,Cr.get_high(),this.unsigned)}if(e.isZero())return Ir;if(this.eq(Ki))return e.isOdd()?Ki:Ir;if(e.eq(Ki))return this.isOdd()?Ki:Ir;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(CC)&&e.lt(CC))return Sr(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,o=this.low>>>16,s=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,d=0,f=0,h=0,p=0;return p+=s*u,h+=p>>>16,p&=65535,h+=o*u,f+=h>>>16,h&=65535,h+=s*c,f+=h>>>16,h&=65535,f+=r*u,d+=f>>>16,f&=65535,f+=o*c,d+=f>>>16,f&=65535,f+=s*l,d+=f>>>16,f&=65535,d+=i*u+r*c+o*l+s*a,d&=65535,cn(h<<16|p,d<<16|f,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(tr(e)||(e=qr(e)),e.isZero())throw Error("division by zero");if(Cr){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Cr.div_u:Cr.div_s)(this.low,this.high,e.low,e.high);return cn(t,Cr.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qs:Ir;var i,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qs;if(e.gt(this.shru(1)))return jE;o=Qs}else{if(this.eq(Ki)){if(e.eq(nl)||e.eq(Eg))return Ki;if(e.eq(Ki))return nl;var s=this.shr(1);return i=s.div(e).shl(1),i.eq(Ir)?e.isNegative()?nl:Eg:(r=this.sub(e.mul(i)),o=i.add(r.div(e)),o)}else if(e.eq(Ki))return this.unsigned?Qs:Ir;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Ir}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),l=a<=48?1:kh(2,a-48),c=Sr(i),u=c.mul(e);u.isNegative()||u.gt(r);)i-=l,c=Sr(i,this.unsigned),u=c.mul(e);c.isZero()&&(c=nl),o=o.add(c),r=r.sub(u)}return o};Re.div=Re.divide;Re.modulo=function(e){if(tr(e)||(e=qr(e)),Cr){var t=(this.unsigned?Cr.rem_u:Cr.rem_s)(this.low,this.high,e.low,e.high);return cn(t,Cr.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return cn(~this.low,~this.high,this.unsigned)};Re.and=function(e){return tr(e)||(e=qr(e)),cn(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return tr(e)||(e=qr(e)),cn(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return tr(e)||(e=qr(e)),cn(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return tr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?cn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):cn(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return tr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?cn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):cn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(tr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var i=this.low;return cn(i>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?cn(t,0,this.unsigned):cn(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?cn(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:cn(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ln.fromBytes=function(e,t,i){return i?ln.fromBytesLE(e,t):ln.fromBytesBE(e,t)};ln.fromBytesLE=function(e,t){return new ln(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};ln.fromBytesBE=function(e,t){return new ln(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const qE=g1(HE),TH=DA({__proto__:null,default:qE},[HE]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qs=qE||TH;function bp(n){return qs.fromString(n,!0,16)}const YE=bp("c3a5c85c97cb3127"),js=bp("b492b66fbe98f273"),Si=bp("9ae16a3b2f90404f");function Ng(n){return n.xor(n.shru(47))}function JE(n,e,t){const i=n.slice(e,e+t);return qs.fromBytes(Array.from(i),!0,!0)}function en(n,e){return JE(n,e,8)}function SC(n,e){return JE(n,e,4)}function qn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function fs(n,e,t=bp("9ddfea08eb382d69")){let i=n.xor(e).mul(t);i=i.xor(i.shru(47));let r=e.xor(i).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function RH(n,e,t,i,r,o){r=r.add(n),o=qn(o.add(r).add(i),21);const s=r;return r=r.add(e),r=r.add(t),o=o.add(qn(r,44)),[r.add(i),o.add(s)]}function Bd(n,e,t,i){return RH(en(n,e),en(n,e+8),en(n,e+16),en(n,e+24),t,i)}function _H(n,e=n.length){if(e>=8){const t=Si.add(e*2),i=en(n,0).add(Si),r=en(n,e-8),o=qn(r,37).mul(t).add(i),s=qn(i,25).add(r).mul(t);return fs(o,s,t)}if(e>=4){const t=Si.add(e*2),i=SC(n,0);return fs(i.shl(3).add(e),SC(n,e-4),t)}if(e>0){const t=n[0],i=n[e>>1],r=n[e-1],o=t+(i<<8),s=e+(r<<2);return Ng(Si.mul(o).xor(YE.mul(s))).mul(Si)}return Si}function AH(n,e=n.length){const t=Si.add(e*2),i=en(n,0).mul(js),r=en(n,8),o=en(n,e-8).mul(t),s=en(n,e-16).mul(Si);return fs(qn(i.add(r),43).add(qn(o,30)).add(s),i.add(qn(r.add(Si),18)).add(o),t)}function OH(n,e=n.length){const t=Si.add(e*2),i=en(n,0).mul(Si),r=en(n,8),o=en(n,e-8).mul(t),s=en(n,e-16).mul(Si),a=qn(i.add(r),43).add(qn(o,30)).add(s),l=fs(a,i.add(qn(r.add(Si),18)).add(o),t),c=en(n,16).mul(t),u=en(n,24),d=a.add(en(n,e-32)).mul(t),f=l.add(en(n,e-24)).mul(t);return fs(qn(c.add(u),43).add(qn(d,30)).add(f),c.add(qn(u.add(i),18)).add(d),t)}function PH(n,e=n.length){const t=qs.fromNumber(81,!0);if(e<=32)return e<=16?_H(n,e):AH(n,e);if(e<=64)return OH(n,e);let i=t,r=t.mul(js).add(113),o=Ng(r.mul(Si).add(113)).mul(Si),s=[qs.UZERO,qs.UZERO],a=[qs.UZERO,qs.UZERO];i=i.mul(Si).add(en(n,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do i=qn(i.add(r).add(s[0]).add(en(n,l+8)),37).mul(js),r=qn(r.add(s[1]).add(en(n,l+48)),42).mul(js),i=i.xor(a[1]),r=r.add(s[0]).add(en(n,l+40)),o=qn(o.add(a[0]),33).mul(js),s=Bd(n,l,s[1].mul(js),i.add(a[0])),a=Bd(n,l+32,o.add(a[1]),r.add(en(n,l+16))),[o,i]=[i,o],l+=64;while(l!==c);const d=js.add(o.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),s[0]=s[0].add(a[0]),a[0]=a[0].add(s[0]),i=qn(i.add(r).add(s[0]).add(en(n,l+8)),37).mul(d),r=qn(r.add(s[1]).add(en(n,l+48)),42).mul(d),i=i.xor(a[1].mul(9)),r=r.add(s[0].mul(9).add(en(n,l+40))),o=qn(o.add(a[0]),33).mul(d),s=Bd(n,l,s[1].mul(d),i.add(a[0])),a=Bd(n,l+32,o.add(a[1]),r.add(en(n,l+16))),[o,i]=[i,o],fs(fs(s[0],a[0],d).add(Ng(r).mul(YE)).add(o),fs(s[1],a[1],d).add(i),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ds(n,e){return e==="string"?ps(n):Aa([n],e)}function MH(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Aa(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=pa(n)),ae().getBool("DEBUG")&&hH(n,e),MH(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let i=0;i<t.length;++i)Math.round(n[i])!==0&&(t[i]=1);return t}else throw new Error(`Unknown data type ${e}`)}function _i(){return ae().platform.now()}function ps(n,e="utf-8"){return e=e||"utf-8",ae().platform.encode(n,e)}function ws(n,e="utf-8"){return e=e||"utf-8",ae().platform.decode(n,e)}function kr(n){return ae().platform.isTypedArray!=null?ae().platform.isTypedArray(n):GE(n)}function pa(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||wx(n)||n==null||kr(n)&&t)e.push(n);else if(Array.isArray(n)||kr(n))for(let i=0;i<n.length;++i)pa(n[i],e,t);else{let i=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(i=Math.max(i,Number(r)));for(let r=0;r<=i;r++)pa(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FH{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new zH)}profileKernel(e,t,i){let r;const o=()=>{r=i()};let s;const a=_i();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(o);else{o();for(const c of r)c.dataSync();s=Promise.resolve({kernelMs:_i()-a})}if(ae().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const u=r[c];u.data().then(d=>{LH(d,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:i,timeMs:r,inputs:o,extraInfo:s}=e;i.forEach(a=>{Promise.all([a.data(),r,s]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],o,l[2])})})}}function LH(n,e,t){if(e!=="float32")return!1;for(let i=0;i<n.length;i++){const r=n[i];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class zH{logKernelProfile(e,t,i,r,o,s){const a=typeof r=="number"?al(`${r}ms`,9):r.error,l=al(e,25),c=t.rank,u=t.size,d=al(t.shape.toString(),14);let f="";for(const h in o){const p=o[h];if(p!=null){const m=p.shape||t.shape,g=m.length;f+=`${h}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${f}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BH(n,e,t){const i={},r={};for(let l=0;l<e.length;l++)i[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],u=c.inputs;for(const d in u){const f=u[d];let h=!1;for(let p=0;p<e.length;p++)if(i[f.id]){c.outputs.forEach(m=>i[m.id]=!0),h=!0,r[c.id]=!0;break}if(h)break}}const o={};o[t.id]=!0;const s={};for(let l=n.length-1;l>=0;l--){const c=n[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(o[c.outputs[d].id]){for(const f in u)o[u[f].id]=!0,s[c.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const c=n[l];if(r[c.id]&&s[c.id]){const u={};for(const f in c.inputs){const h=c.inputs[f];i[h.id]&&(u[f]=h)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function VH(n,e,t,i){for(let r=e.length-1;r>=0;r--){const o=e[r],s=[];if(o.outputs.forEach(l=>{const c=n[l.id];c!=null?s.push(c):s.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(s);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=t(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=o.inputs[l];if(!Ht(c.shape,u.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(n[u.id]==null)n[u.id]=c;else{const d=n[u.id];n[u.id]=i(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC=20,vc=3,Cm=7;function WH(n,e,t,i){const r=Qe(e),o=GH(n,e,t,r),s=e.length,a=lh(n,e,t,r,o),l=["Tensor"];return i&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${s}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function GH(n,e,t,i){const r=he(e),o=i[i.length-1],s=new Array(o).fill(0),a=e.length,l=t==="complex64"?Cc(n):n;if(a>1)for(let c=0;c<r/o;c++){const u=c*o;for(let d=0;d<o;d++)s[d]=Math.max(s[d],wc(l[u+d],0,t).length)}return s}function wc(n,e,t){let i;return Array.isArray(n)?i=`${parseFloat(n[0].toFixed(Cm))} + ${parseFloat(n[1].toFixed(Cm))}j`:uu(n)?i=`'${n}'`:t==="bool"?i=ZE(n):i=parseFloat(n.toFixed(Cm)).toString(),al(i,e)}function ZE(n){return n===0?"false":"true"}function lh(n,e,t,i,r,o=!0){const s=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const m=Cc(n);return[wc(m[0],0,t)]}return t==="bool"?[ZE(n[0])]:[n[0].toString()]}if(l===1){if(a>IC){const g=vc*s;let v=Array.from(n.slice(0,g)),x=Array.from(n.slice((a-vc)*s,a*s));return t==="complex64"&&(v=Cc(v),x=Cc(x)),["["+v.map((b,w)=>wc(b,r[w],t)).join(", ")+", ..., "+x.map((b,w)=>wc(b,r[a-vc+w],t)).join(", ")+"]"]}return["["+(t==="complex64"?Cc(n):Array.from(n)).map((g,v)=>wc(g,r[v],t)).join(", ")+"]"]}const c=e.slice(1),u=i.slice(1),d=i[0]*s,f=[];if(a>IC){for(let m=0;m<vc;m++){const g=m*d,v=g+d;f.push(...lh(n.slice(g,v),c,t,u,r,!1))}f.push("...");for(let m=a-vc;m<a;m++){const g=m*d,v=g+d;f.push(...lh(n.slice(g,v),c,t,u,r,m===a-1))}}else for(let m=0;m<a;m++){const g=m*d,v=g+d;f.push(...lh(n.slice(g,v),c,t,u,r,m===a-1))}const h=l===2?",":"";f[0]="["+(a>0?f[0]+h:"");for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+h;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":p),f}function Cc(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ti{constructor(e,t,i){if(this.dtype=t,this.shape=e.slice(),this.size=he(e),i!=null){const r=i.length;F(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=i||Sn(t,this.size),this.strides=Qe(e)}set(e,...t){t.length===0&&(t=[0]),F(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const i=this.locToIndex(t);this.values[i]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let i=e[e.length-1];for(let r=0;r<e.length-1;++r)i+=this.strides[r]*e[r];return this.values[i]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let i=0;i<e.length-1;++i)t+=this.strides[i]*e[i];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let i=0;i<t.length-1;++i)t[i]=Math.floor(e/this.strides[i]),e-=t[i]*this.strides[i];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return zr().makeTensor(this.values,this.shape,this.dtype)}}let zr=null,Qa=null;function HH(n){zr=n}function UH(n){Qa=n}class Ln{constructor(e,t,i,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=he(e),this.strides=Qe(e),this.dataId=i,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Qa.buffer(this.shape,this.dtype,e)}bufferSync(){return Qa.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Wr(this.shape,e,this.dtype==="complex64")}arraySync(){return Wr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=zr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(i=>ws(i))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),zr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=zr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ws(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await zr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),zr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Qa.print(this,e)}clone(){return this.throwIfDisposed(),Qa.clone(this)}toString(e=!1){const t=this.dataSync();return WH(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Qa.cast(this,e)}variable(e=!0,t,i){return this.throwIfDisposed(),zr().makeVariable(this,e,t,i)}}Object.defineProperty(Ln,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function de(){return Cx("Tensor",()=>Ln)}de();class Dh extends Ln{constructor(e,t,i,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=i}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ht(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);zr().disposeTensor(this),this.dataId=e.dataId,zr().incRef(this,null)}dispose(){zr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Dh,Symbol.hasInstance,{value:n=>n instanceof Ln&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $C;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})($C||($C={}));var kg;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(kg||(kg={}));var Dg;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Dg||(Dg={}));var Tg;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Tg||(Tg={}));var Rg;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Rg||(Rg={}));const jH={float32:Tg,int32:kg,bool:Dg,complex64:Rg};function Zi(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return jH[n][e]}function d0(n){return Zi(n,"int32")}function QE(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function e2(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(n,e){if(n.dtype===e.dtype)return[n,e];const t=Zi(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function t2(n){const e=[];return n2(n,e,new Set),e}function n2(n,e,t){if(n==null)return;if(n instanceof Ln){e.push(n);return}if(!KH(n))return;const i=n;for(const r in i){const o=i[r];t.has(o)||(t.add(o),n2(o,e,t))}}function KH(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sm(n){return n.kernelName!=null}class EC{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Tl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EC}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const i=e[t];if(await this.initializeBackend(i).success){await this.setBackend(i);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,i=1){return e in this.registryFactory?(rr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:i},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:i}=this.initializeBackend(e);if(!(i?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new FH(this.backendInstance),!0}setupRegisteredKernels(){vC(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){vC(e).forEach(i=>{i.disposeFunc!=null&&i.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const i=t.factory();if(i&&!(i instanceof vx)&&typeof i.then=="function"){const r=++this.pendingBackendInitId,o=i.then(s=>r<this.pendingBackendInitId?!1:(this.registry[e]=s,this.pendingBackendInit=null,!0)).catch(s=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,rr(`Initialization of backend ${e} failed`),rr(s.stack||s.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(i){return rr(`Initialization of backend ${e} failed`),rr(i.stack||i.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const i=e[t],{success:r,asyncInit:o}=this.initializeBackend(i);if(o||r)return{name:i,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const i=this.state.tensorInfo.get(t),r=i.backend,o=this.readSync(t),s=r.refCount(t);r.disposeData(t,!0),i.backend=e,e.move(t,o,i.shape,i.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let i=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}let r;return this.scopedRun(()=>this.startScope(i),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,i){e();try{const r=i();return t(),r}catch(r){throw t(),r}}nextTensorId(){return Tl.nextTensorId++}nextVariableId(){return Tl.nextVariableId++}clone(e){const t=q.runKernel(Ru,{x:e}),i={x:e},r=s=>({x:()=>{const a="float32",l={x:s},c={dtype:a};return q.runKernel(xu,l,c)}}),o=[];return this.addTapeNode(this.state.activeScope.name,i,[t],r,o,{}),t}runKernel(e,t,i){if(this.backendName==null&&this.backend,!(mC(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:i})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,i){const r=this.backend.numDataIds();let o=0;i.forEach(l=>{o+=l.dtype==="complex64"?3:1});const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-s;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,i=[];const r=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Sm(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Sm(e)){const{kernelName:p,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const v=mC(p,this.backendName);F(v!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const x=this.backend.numDataIds();l=v.kernelFunc({inputs:m,attrs:g,backend:this.backend});const b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,x,b);const w=b.map(y=>y.rank!=null?y:this.makeTensorFromTensorInfo(y));if(r){const y=this.getTensorsForGradient(p,m,w);i=this.saveTensorsForBackwardMode(y)}return w}}else{const{forwardFunc:p}=e,m=g=>{r&&(i=g.map(v=>this.keep(this.clone(v))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const v=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,g,v),v}}const{inputs:u,attrs:d}=e,f=Sm(e)?null:e.backwardsFunc;let h;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(h=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),t=h.outputs)}),r&&this.addTapeNode(c,u,t,f,i,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:t.map(p=>p.shape),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(i=>this.keep(this.clone(i)))}getTensorsForGradient(e,t,i){const r=gC(e);if(r!=null){const o=r.inputsToSave||[],s=r.outputsToSave||[];let a;r.saveAllInputs?(F(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(c=>t[c])):a=o.map(c=>t[c]);const l=i.filter((c,u)=>s[u]);return a.concat(l)}return[]}makeTensor(e,t,i,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");i=i||"float32",r=r||this.backend;let o=e;i==="string"&&uu(e[0])&&(o=e.map(l=>ps(l)));const s=r.write(o,t,i),a=new Ln(t,i,s,this.nextTensorId());if(this.trackTensor(a,r),i==="string"){const l=this.state.tensorInfo.get(s),c=pH(o);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,t,i,r){i=i||"float32";const o={dataId:e,shape:t,dtype:i};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:i,shape:r,dtype:o}=e,s=new Ln(r,o,i,this.nextTensorId());return this.trackTensor(s,t),s}makeVariable(e,t=!0,i,r){i=i||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new Dh(e,t,i,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*Ih(e.dtype)),this.state.numBytes+=i,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i})),e instanceof Dh||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const i=e.size*Ih(e.dtype);this.state.numBytes-=i}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,i=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-i;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,i,r,o,s){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:i,saved:o},l=gC(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const f=i[d],h=mi(f.size,f.dtype);return this.makeTensor(h,f.shape,f.dtype)}return u}),r(c.length>1?c:c[0],o,s))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=t2(e),i=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const s=this.state.activeScope.track[o];!s.kept&&!i.has(s.id)&&s.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,i,r=!1){if(F(t.length>0,()=>"gradients() received an empty list of xs."),i!=null&&i.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${i.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));F(o instanceof Ln,()=>"The result y returned by f() must be a tensor.");const s=BH(this.state.activeTape,t,o);if(!r&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=i??XH(o.shape),VH(a,s,c=>this.tidy(c),qH);const l=t.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return F(wg(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{F(t.every(a=>a instanceof Ln),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let i;const r={};t.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(i=e(...t,l),F(i.value instanceof Ln,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),F(wg(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),s=(a,l)=>{const c=i.gradFunc(a,l),u=Array.isArray(c)?c:[c];F(u.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),F(u.every(f=>f instanceof Ln),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((f,h)=>{d[h]=()=>f}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:s,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=_i(),i=await this.backend.time(e);return i.wallMs=_i()-t,i}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EC;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Tl.nextTensorId=0;Tl.nextVariableId=0;function XH(n){const e=yx(he(n),"float32");return q.makeTensor(e,n,"float32")}function i2(){const n=bE();if(n._tfengine==null){const e=new vH(n);n._tfengine=new Tl(e)}return wH(n._tfengine.ENV),HH(()=>n._tfengine),n._tfengine}const q=i2();function qH(n,e){const t={a:n,b:e};return q.runKernel(Zl,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YH(){return typeof navigator<"u"&&navigator!=null}function r2(n){if(n||YH()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function o2(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Li=ae();Li.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Li.registerFlag("IS_BROWSER",()=>o2());Li.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Li.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Li.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Li.registerFlag("PROD",()=>!1);Li.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Li.getBool("DEBUG"));Li.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Li.registerFlag("IS_TEST",()=>!1);Li.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Li.getBool("DEBUG"));Li.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Li.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Li.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yp(n,e){let t=n;if(kr(n))return e==="string"?[]:[n.length];if(QE(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(e2(n))return[n.buffer.size/(e==null?4:Ih(e))];if(!Array.isArray(n))return[];const i=[];for(;Array.isArray(t)||kr(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&s2(n,i,[]),i}function s2(n,e,t){if(t=t||[],!Array.isArray(n)&&!kr(n)){F(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}F(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),F(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const i=e.slice(1);for(let r=0;r<n.length;++r)s2(n[r],i,t.concat(r))}function NC(n,e,t,i){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${i}' must be ${n} tensor, but got ${e} tensor`)}}function B(n,e,t,i="numeric"){if(n instanceof de())return NC(i,n.dtype,e,t),n;let r=Yl(n);if(r!=="string"&&["bool","int32","float32"].indexOf(i)>=0&&(r=i),NC(i,r,e,t),n==null||!kr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const o=yp(n,r);!kr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Aa(n,r):pa(n,[],!0);return q.makeTensor(a,o,r)}function a2(n,e,t,i="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,s)=>B(o,`${e}[${s}]`,t,i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JH="__op";function te(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const i=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+JH;const r=(...o)=>{q.startScope(t);try{const s=i(...o);return wx(s)&&console.error("Cannot return a Promise inside of tidy."),q.endScope(s),s}catch(s){throw q.endScope(null),s}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZH(n,e){const t=B(n,"real","complex"),i=B(e,"imag","complex");bx(t.shape,i.shape,`real and imag shapes, ${t.shape} and ${i.shape}, must match in call to tf.complex().`);const r={real:t,imag:i};return q.runKernel(Tx,r)}const ma=te({complex_:ZH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(n,e,t,i){if(i==null)i=Yl(n);else if(i==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(e2(n)||QE(n)){if(i!=="float32"&&i!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${i}.`);return q.backend.createTensorFromGPUData(n,e||t,i)}if(!kr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Zo(e);const r=he(e),o=he(t);F(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let s=0;s<t.length;++s){const a=t[s],l=s===t.length-1?a!==he(e.slice(s)):!0;F(t[s]===e[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!kr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=i!=="string"?Aa(n,i):pa(n,[],!0),q.makeTensor(n,e,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cl(n,e,t){const i=yp(n,t);return wp(n,e,i,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Th={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Ts{static join(e){return new Ts(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(i=>kr(i)?i.buffer:i),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let i=0;i<e.length;i++){const r=e[i];i!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const i=this.findShardForByte(e);if(i===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),s=new Uint8Array(o);let a=0;for(let l=i;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,f=a,p=Math.min(t,c.end)-c.start,m=new Uint8Array(c.buffer,d,p-d);if(s.set(m,f),a+=m.length,t<c.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const i=QH(this.shards,t);return i===-1?-1:(this.previousShardIndex=i,this.previousShardIndex)}}function QH(n,e){let t=0,i=n.length;for(;t<=i;){const r=Math.floor((i-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?i=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(){return q}function kC(){return q.memory()}function ie(n,e){return q.tidy(n,e)}function yt(n){t2(n).forEach(t=>t.dispose())}function vo(n){return q.keep(n)}function eU(n){return q.setBackend(n)}function l2(n,e,t=1){return q.registerBackend(n,e,t)}function tU(){return q.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rl=4;async function DC(n,e){const t=[],i=[],r=Array.isArray(n)?n.map(s=>s.name):Object.keys(n);for(let s=0;s<r.length;++s){const a=r[s],l=Array.isArray(n)?n[s].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const f=await l.bytes(),h=f.reduce((g,v)=>g+v.length,0)+Rl*f.length,p=new Uint8Array(h);let m=0;for(let g=0;g<f.length;g++){const v=f[g],x=new Uint8Array(new Uint32Array([v.length]).buffer);p.set(x,m),m+=Rl,p.set(v,m),m+=v.length}d(p)});i.push(u)}else i.push(l.data());e!=null&&(c.group=e),t.push(c)}const o=await Promise.all(i);return{data:oU(o),specs:t}}function nU(n,e){const t=new Ts(n),i={};let r=0;for(const o of e){const s=iU(o,(a,l)=>t.slice(r+a,r+l));i[o.name]=rU(o,t.slice(r,r+s)),r+=s}return i}function iU(n,e){const t=he(n.shape);let i;if("quantization"in n){const r=n.quantization;i=Th[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=Rl+new Uint32Array(e(r,r+Rl))[0];return r}else i=Th[n.dtype];return t*i}function rU(n,e){const t=n.name,i=n.dtype,r=n.shape,o=he(r);let s,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(i!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${i}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=Th[l.dtype],u=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(i==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){s=new Float32Array(u.length);for(let d=0;d<u.length;d++){const f=u[d];s[d]=f*l.scale+l.min}}else if(l.dtype==="float16")s=mU()(u);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(i==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);s=new Int32Array(u.length);for(let d=0;d<u.length;d++){const f=u[d];s[d]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${i}`);a+=o*c}else if(i==="string"){const l=he(n.shape);s=[];for(let c=0;c<l;c++){const u=new Uint32Array(e.slice(a,a+Rl))[0];a+=Rl;const d=new Uint8Array(e.slice(a,a+u));s.push(d),a+=u}}else{const l=Th[i];if(i==="float32")s=new Float32Array(e);else if(i==="int32")s=new Int32Array(e);else if(i==="bool")s=new Uint8Array(e);else if(i==="complex64"){s=new Float32Array(e);const c=new Float32Array(s.length/2),u=new Float32Array(s.length/2);for(let p=0;p<c.length;p++)c[p]=s[p*2],u[p]=s[p*2+1];const d=cl(c,r,"float32"),f=cl(u,r,"float32"),h=ma(d,f);return d.dispose(),f.dispose(),h}else throw new Error(`Unsupported dtype in weight '${t}': ${i}`);a+=o*l}return cl(s,r,i)}function oU(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const i=new Uint8Array(e);let r=0;return t.forEach(o=>{i.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),i.buffer}const h0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function TC(n){return h0?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function sU(n){if(h0)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function aU(n){if(h0){const i=Buffer.from(n,"base64");return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;++i)t.set([e.charCodeAt(i)],i);return t.buffer}function lU(n){return Ts.join(n)}function cU(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function uU(n,e,t){const i={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(i.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=e,i.weightData=t}return n.signature!=null&&(i.signature=n.signature),n.userDefinedMetadata!=null&&(i.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(i.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(i.initializerSignature=n.initializerSignature),i}async function dU(n,e){let t,i;return n.weightsManifest!=null&&([t,i]=await e(n.weightsManifest)),uU(n,t,i)}function f0(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:TC(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:TC(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Ts(n.weightData).byteLength}}function RC(n){const e=[];for(const t of n)e.push(...t.weights);return e}function hU(){const n=t=>{let i=t<<13,r=0;for(;!(i&8388608);)r-=8388608,i<<=1;return i&=-8388609,r+=947912704,i|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function fU(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function pU(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function mU(){const n=hU(),e=fU(),t=pU();return i=>{const r=new ArrayBuffer(4*i.length),o=new Uint32Array(r);for(let s=0;s<i.length;s++){const a=i[s],l=n[t[a>>10]+(a&1023)]+e[a>>10];o[s]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Xn.instance==null&&(Xn.instance=new Xn),Xn.instance}static registerSaveRouter(e){Xn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Xn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Xn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Xn.getHandlers(e,"load",t)}static getHandlers(e,t,i){const r=[];return(t==="load"?Xn.getInstance().loadRouters:Xn.getInstance().saveRouters).forEach(s=>{const a=s(e,i);a!==null&&r.push(a)}),r}}const gU=n=>Xn.getSaveHandlers(n),vU=(n,e)=>Xn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _g="tensorflowjs",Ag=1,ea="models_store",cs="model_info_store";function c2(){if(!ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Og(n){const e=n.result;e.createObjectStore(ea,{keyPath:"modelPath"}),e.createObjectStore(cs,{keyPath:"modelPath"})}class ga{constructor(e){if(this.indexedDB=c2(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((i,r)=>{const o=this.indexedDB.open(_g,Ag);o.onupgradeneeded=()=>Og(o),o.onsuccess=()=>{const s=o.result;if(t==null){const a=s.transaction(ea,"readonly"),c=a.objectStore(ea).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return s.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));i(c.result.modelArtifacts)},c.onerror=u=>(s.close(),r(c.error)),a.oncomplete=()=>s.close()}else{t.weightData=Ts.join(t.weightData);const a=f0(t),l=s.transaction(cs,"readwrite");let c=l.objectStore(cs),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return r(f)}let d;u.onsuccess=()=>{d=s.transaction(ea,"readwrite");const f=d.objectStore(ea);let h;try{h=f.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(p){return r(p)}h.onsuccess=()=>i({modelArtifactsInfo:a}),h.onerror=p=>{c=l.objectStore(cs);const m=c.delete(this.modelPath);m.onsuccess=()=>(s.close(),r(h.error)),m.onerror=g=>(s.close(),r(h.error))}},u.onerror=f=>(s.close(),r(u.error)),l.oncomplete=()=>{d==null?s.close():d.oncomplete=()=>s.close()}}},o.onerror=s=>r(o.error)})}}ga.URL_SCHEME="indexeddb://";const u2=n=>ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ga.URL_SCHEME)?xU(n.slice(ga.URL_SCHEME.length)):null;Xn.registerSaveRouter(u2);Xn.registerLoadRouter(u2);function xU(n){return new ga(n)}function bU(n){return n.startsWith(ga.URL_SCHEME)?n.slice(ga.URL_SCHEME.length):n}class yU{constructor(){this.indexedDB=c2()}async listModels(){return new Promise((e,t)=>{const i=this.indexedDB.open(_g,Ag);i.onupgradeneeded=()=>Og(i),i.onsuccess=()=>{const r=i.result,o=r.transaction(cs,"readonly"),a=o.objectStore(cs).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},i.onerror=r=>t(i.error)})}async removeModel(e){return e=bU(e),new Promise((t,i)=>{const r=this.indexedDB.open(_g,Ag);r.onupgradeneeded=()=>Og(r),r.onsuccess=()=>{const o=r.result,s=o.transaction(cs,"readwrite"),a=s.objectStore(cs),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return o.close(),i(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=o.transaction(ea,"readwrite");const h=c.objectStore(ea).delete(e);h.onsuccess=()=>t(l.result.modelArtifactsInfo),h.onerror=p=>i(l.error)};u.onsuccess=d,u.onerror=f=>(d(),o.close(),i(l.error))}},l.onerror=u=>(o.close(),i(l.error)),s.oncomplete=()=>{c==null?o.close():c.oncomplete=()=>o.close()}},r.onerror=o=>i(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mo="/",el="tensorflowjs_models",d2="info",wU="model_topology",CU="weight_specs",SU="weight_data",IU="model_metadata";function h2(n){return{info:[el,n,d2].join(Mo),topology:[el,n,wU].join(Mo),weightSpecs:[el,n,CU].join(Mo),weightData:[el,n,SU].join(Mo),modelMetadata:[el,n,IU].join(Mo)}}function f2(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function $U(n){const e=n.split(Mo);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Mo)}function EU(n){return n.startsWith(va.URL_SCHEME)?n.slice(va.URL_SCHEME.length):n}class va{constructor(e){if(!ae().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=h2(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),i=JSON.stringify(e.weightSpecs),r=f0(e),o=Ts.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,sU(o));const s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch{throw f2(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},i=JSON.parse(this.LS.getItem(this.keys.topology));if(i==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=i;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(s==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=aU(s),t}}va.URL_SCHEME="localstorage://";const p2=n=>ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(va.URL_SCHEME)?NU(n.slice(va.URL_SCHEME.length)):null;Xn.registerSaveRouter(p2);Xn.registerLoadRouter(p2);function NU(n){return new va(n)}class kU{constructor(){F(ae().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),F(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=el+Mo,i=Mo+d2;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(i)){const s=$U(o);e[s]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=EU(e);const t=h2(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const i=JSON.parse(this.LS.getItem(t.info));return f2(t),i}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _C="://";class oo{constructor(){this.managers={}}static getInstance(){return oo.instance==null&&(oo.instance=new oo),oo.instance}static registerManager(e,t){F(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(_C)&&(e=e.slice(0,e.indexOf(_C))),F(e.length>0,()=>"scheme must not be an empty string.");const i=oo.getInstance();F(i.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),i.managers[e]=t}static getManager(e){const t=oo.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(oo.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DU{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ae().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",i=>{if(i.source===window&&i.data.name===this.messageName){i.stopPropagation();const r=this.functionRefs[i.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return GE(e)}}if(ae().get("IS_BROWSER")){ae().setPlatform("browser",new DU);try{oo.registerManager(va.URL_SCHEME,new kU)}catch{}try{oo.registerManager(ga.URL_SCHEME,new yU)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={importFetch:()=>require("node-fetch")};let Im;class RU{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ae().global.fetch!=null?ae().global.fetch(e,t):(Im==null&&(Im=TU.importFetch()),Im(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ae().get("IS_NODE")&&!ae().get("IS_BROWSER")&&ae().setPlatform("node",new RU);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wt(n,e="float32",t){return e=e||"float32",Zo(n),new ti(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _U(n,e){const t=B(n,"x","cast");if(!fH(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const i={x:t},r={dtype:e};return q.runKernel(xu,i,r)}const Pe=te({cast_:_U});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AU(n){const t={x:B(n,"x","clone","string_or_numeric")};return q.runKernel(Ru,t)}const la=te({clone_:AU});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OU(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */i2();const PU={buffer:wt,cast:Pe,clone:la,print:OU};UH(PU);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(n,e){let t=B(n,"a","add"),i=B(e,"b","add");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(Zl,r)}const $e=te({add_:MU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FU(n,e){let t=B(n,"a","floorDiv"),i=B(e,"b","floorDiv");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(Du,r)}const m2=te({floorDiv_:FU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LU(n,e){let t=B(n,"a","div"),i=B(e,"b","div");if([t,i]=$n(t,i),t.dtype==="int32"&&i.dtype==="int32")return m2(t,i);const r={a:t,b:i},o={};return q.runKernel(Su,r,o)}const at=te({div_:LU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zU(n,e){let t=B(n,"a","mul"),i=B(e,"b","mul");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(Bu,r)}const K=te({mul_:zU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BU(n){const e=B(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return q.runKernel(Ef,t)}else{const t={x:e};return q.runKernel(bf,t)}}const wi=te({abs_:BU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VU(n){const t={x:B(n,"x","acos")};return q.runKernel(du,t)}const WU=te({acos_:VU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GU(n){const t={x:B(n,"x","acosh")};return q.runKernel(hu,t)}const HU=te({acosh_:GU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UU(n,e=null,t=!1){const r={x:B(n,"x","all","bool")},o={axis:e,keepDims:t};return q.runKernel(Ix,r,o)}const g2=te({all_:UU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(n,e=null,t=!1){const r={x:B(n,"x","any","bool")},o={axis:e,keepDims:t};return q.runKernel($x,r,o)}const Pg=te({any_:jU});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KU(n,e=0){const i={x:B(n,"x","argMax")},r={axis:e};return q.runKernel(yf,i,r)}const Gc=te({argMax_:KU});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XU(n,e=0){const i={x:B(n,"x","argMin")},r={axis:e};return q.runKernel(wf,i,r)}const qU=te({argMin_:XU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YU(n){const t={x:B(n,"x","asin")};return q.runKernel(fu,t)}const JU=te({asin_:YU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZU(n){const t={x:B(n,"x","asinh")};return q.runKernel(pu,t)}const QU=te({asinh_:ZU});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(n){const t={x:B(n,"x","atan")};return q.runKernel(mu,t)}const t6=te({atan_:e6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(n,e){let t=B(n,"a","atan2"),i=B(e,"b","atan2");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(vu,r)}const i6=te({atan2_:n6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(n){const t={x:B(n,"x","atanh")};return q.runKernel(gu,t)}const o6=te({atanh_:r6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sd(n,e,t,i,r="NHWC",o){const s=n[3],a=[...e,s],l=es(r);return ni(n,a,t,o,i,null,null,l)}function _r(n,e,t,i,r,o,s="channelsLast"){const[a,l]=Hc(e);let c;if(s==="channelsLast")c=[a,l,n[3],n[3]];else if(s==="channelsFirst")c=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${s}`);return ni(n,c,t,i,r,o,!1,s)}function Qo(n,e,t,i,r,o,s="NDHWC"){const[a,l,c]=Mg(e);let u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,n[4],n[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${s}`);return Rs(n,u,t,i,r,!1,d,o)}function ni(n,e,t,i,r,o,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=n;else if(a==="channelsFirst")[l,d,c,u]=n;else throw new Error(`Unknown dataFormat ${a}`);const[f,h,,p]=e,[m,g]=Hc(t),[v,x]=Hc(i),b=ul(f,v),w=ul(h,x),{padInfo:y,outHeight:C,outWidth:$}=l6(r,c,u,m,g,b,w,o,a),I=s?p*d:p;let E;return a==="channelsFirst"?E=[l,I,C,$]:a==="channelsLast"&&(E=[l,C,$,I]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:C,outWidth:$,outChannels:I,padInfo:y,strideHeight:m,strideWidth:g,filterHeight:f,filterWidth:h,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:v,dilationWidth:x,inShape:n,outShape:E,filterShape:e}}function Rs(n,e,t,i,r,o=!1,s="channelsLast",a){let[l,c,u,d,f]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,f]=n;else if(s==="channelsFirst")[l,f,c,u,d]=n;else throw new Error(`Unknown dataFormat ${s}`);const[h,p,m,,g]=e,[v,x,b]=Mg(t),[w,y,C]=Mg(i),$=ul(h,w),I=ul(p,y),E=ul(m,C),{padInfo:N,outDepth:k,outHeight:D,outWidth:_}=c6(r,c,u,d,v,x,b,$,I,E,a),R=o?g*f:g;let T;return s==="channelsFirst"?T=[l,R,k,D,_]:s==="channelsLast"&&(T=[l,k,D,_,R]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:f,outDepth:k,outHeight:D,outWidth:_,outChannels:R,padInfo:N,strideDepth:v,strideHeight:x,strideWidth:b,filterDepth:h,filterHeight:p,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:I,effectiveFilterWidth:E,dilationDepth:w,dilationHeight:y,dilationWidth:C,inShape:n,outShape:T,filterShape:e}}function s6(n,e,t,i,r){i==null&&(i=p0(n,e,t));const o=n[0],s=n[1],a=Uc((o-e+2*i)/t+1,r),l=Uc((s-e+2*i)/t+1,r);return[a,l]}function a6(n,e,t,i,r,o){r==null&&(r=p0(n,e[0],i[0]));const s=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(s[a]=Uc((n[a]-e[a]+2*r)/i[a]+1,o));return s}function p0(n,e,t,i=1){const r=ul(e,i);return Math.floor((n[0]*(t-1)-t+r)/2)}function Hc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Mg(n){return typeof n=="number"?[n,n,n]:n}function ul(n,e){return e<=1?n:n+(n-1)*(e-1)}function l6(n,e,t,i,r,o,s,a,l){let c,u,d;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const h=s6([e,t],o,i,n,a);u=h[0],d=h[1]}else if(n==="same"){u=Math.ceil(e/i),d=Math.ceil(t/r);const f=Math.max(0,(u-1)*i+o-e),h=Math.max(0,(d-1)*r+s-t),p=Math.floor(f/2),m=f-p,g=Math.floor(h/2),v=h-g;c={top:p,bottom:m,left:g,right:v,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-o+1)/i),d=Math.ceil((t-s+1)/r);else if(typeof n=="object"){const f=l==="channelsLast"?n[1][0]:n[2][0],h=l==="channelsLast"?n[1][1]:n[2][1],p=l==="channelsLast"?n[2][0]:n[3][0],m=l==="channelsLast"?n[2][1]:n[3][1];c={top:f,bottom:h,left:p,right:m,type:f===0&&h===0&&p===0&&m===0?"VALID":"EXPLICIT"},u=Uc((e-o+f+h)/i+1,a),d=Uc((t-s+p+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:u,outWidth:d}}function c6(n,e,t,i,r,o,s,a,l,c,u){let d,f,h,p;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const g=a6([e,t,i,1],[a,l,c],1,[r,o,s],n,u);f=g[0],h=g[1],p=g[2]}else if(n==="same"){f=Math.ceil(e/r),h=Math.ceil(t/o),p=Math.ceil(i/s);const m=(f-1)*r+a-e,g=(h-1)*o+l-t,v=(p-1)*s+c-i,x=Math.floor(m/2),b=m-x,w=Math.floor(g/2),y=g-w,C=Math.floor(v/2),$=v-C;d={top:w,bottom:y,left:C,right:$,front:x,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:f,outHeight:h,outWidth:p}}function Uc(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function xa(n){const[e,t,i]=Hc(n);return e===1&&t===1&&i===1}function vi(n,e){return xa(n)||xa(e)}function ba(n){return Hc(n).every(e=>e>0)}function es(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Vi(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")F(kl(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(i=>{i.forEach(r=>{F(kl(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(n,e){const i={x:B(n,"x","reshape","string_or_numeric")},r={shape:e};return q.runKernel(sp,i,r)}const ee=te({reshape_:u6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(n,e,t,i,r){const o=B(n,"x","avgPool","float32"),s=1;F(vi(t,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Vi("avgPool",i,r);const c={x:a},u={filterSize:e,strides:t,pad:i,dimRoundingMode:r};let d=q.runKernel(Cf,c,u);return d=Pe(d,o.dtype),l?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const m0=te({avgPool_:d6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(n,e,t,i,r,o="NDHWC"){const s=B(n,"x","avgPool3d","float32");let a=s,l=!1;s.rank===4&&(l=!0,a=ee(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),F(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),F(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Vi("avgPool3d",i,r);const c={x:a},u={filterSize:e,strides:t,pad:i,dimRoundingMode:r,dataFormat:o};let d=q.runKernel(Sf,c,u);return d=Pe(d,a.dtype),l?ee(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const f6=te({avgPool3d_:h6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(n,e=0){F(n.length>=1,()=>"Pass at least one tensor to concat");const t=a2(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return la(t[0]);const i=t,r={axis:e};return q.runKernel(Nf,i,r)}const Fi=te({concat_:p6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(n,e,t=!1,i=!1){let r=B(n,"a","matMul"),o=B(e,"b","matMul");[r,o]=$n(r,o);const s={a:r,b:o},a={transposeA:t,transposeB:i};return q.runKernel(If,s,a)}const Wt=te({matMul_:m6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n){const t={x:B(n,"x","sigmoid","float32")};return q.runKernel(Ju,t)}const Ql=te({sigmoid_:g6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n,e,t){const i=B(n,"x","slice","string_or_numeric");if(i.rank===0)throw new Error("Slicing scalar is not possible");const r={x:i},o={begin:e,size:t};return q.runKernel(dp,r,o)}const tn=te({slice_:v6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(n){const t={x:B(n,"x","tanh","float32")};return q.runKernel(id,t)}const Cp=te({tanh_:x6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(n,e,t){const i=B(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);F(i.rank>=1+e.length,()=>`input rank is ${i.rank} but should be > than blockShape.length ${e.length}`),F(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),F(i.shape[0]%r===0,()=>`input tensor batch is ${i.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:i},s={blockShape:e,crops:t};return q.runKernel($f,o,s)}const g0=te({batchToSpaceND_:b6});function y6(n){let e;return n.rank===0||n.rank===1?e=ee(n,[1,1,1,n.size]):n.rank===2?e=ee(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n,e,t,i,r,o){o==null&&(o=.001);const s=B(n,"x","batchNorm"),a=B(e,"mean","batchNorm"),l=B(t,"variance","batchNorm");let c;r!=null&&(c=B(r,"scale","batchNorm"));let u;i!=null&&(u=B(i,"offset","batchNorm")),F(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:y6(s),scale:c,offset:u,mean:a,variance:l},h={varianceEpsilon:o},p=q.runKernel(Mf,f,h);return ee(p,s.shape)}const Sp=te({batchNorm_:w6});function C6(n,e,t,i,r,o){const s=B(n,"x","batchNorm"),a=B(e,"mean","batchNorm"),l=B(t,"variance","batchNorm");let c;r!=null&&(c=B(r,"scale","batchNorm"));let u;return i!=null&&(u=B(i,"offset","batchNorm")),F(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),F(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),F(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Sp(s,a,l,u,c,o)}const S6=te({batchNorm2d_:C6});function I6(n,e,t,i,r,o){const s=B(n,"x","batchNorm"),a=B(e,"mean","batchNorm"),l=B(t,"variance","batchNorm");let c;r!=null&&(c=B(r,"scale","batchNorm"));let u;return i!=null&&(u=B(i,"offset","batchNorm")),F(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),F(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),F(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Sp(s,a,l,u,c,o)}const $6=te({batchNorm3d_:I6});function E6(n,e,t,i,r,o){const s=B(n,"x","batchNorm"),a=B(e,"mean","batchNorm"),l=B(t,"variance","batchNorm");let c;r!=null&&(c=B(r,"scale","batchNorm"));let u;return i!=null&&(u=B(i,"offset","batchNorm")),F(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),F(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),F(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Sp(s,a,l,u,c,o)}const N6=te({batchNorm4d_:E6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(n,e,t){const i=B(n,"x","bincount"),r=B(e,"weights","bincount");F(i.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${i.dtype}`),F(t>=0,()=>`size must be non-negative, but got ${t}.`),F(r.size===i.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${i.shape}, weights shape: ${r.shape}.`);const o={x:i,weights:r},s={size:t};return q.runKernel(kx,o,s)}const D6=te({bincount_:k6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(n,e){let t=B(n,"broadcastTo","x");const i=t.shape;if(Zo(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=ee(t,c)}const r=t.shape,o=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])o[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${e}].`);if(o.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return la(t);const a={x:t},l={reps:o};return q.runKernel(rd,a,l)}const Ac=te({broadcastTo_:T6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R6(n){const t={x:B(n,"x","ceil","float32")};return q.runKernel(bu,t)}const _6=te({ceil_:R6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ip(n,e,t){Zo(n),t=t||Yl(e);const i={shape:n,value:e,dtype:t};return q.runKernel(Gx,{},i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(n,e,t){const i=B(n,"x","clipByValue");if(F(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Ip(i.shape,e,i.dtype);const r={x:i},o={clipValueMin:e,clipValueMax:t};return q.runKernel(yu,r,o)}const cr=te({clipByValue_:A6});function O6(n){return Fi(n,0)}const P6=te({concat1d_:O6});function M6(n,e){return Fi(n,e)}const F6=te({concat2d_:M6});function L6(n,e){return Fi(n,e)}const z6=te({concat3d_:L6});function B6(n,e){return Fi(n,e)}const V6=te({concat4d_:B6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(n,e,t,i,r="NHWC",o=[1,1],s){const a=B(n,"x","conv2d","float32"),l=B(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Vi("conv2d",i,s);const d=r==="NHWC"?c.shape[3]:c.shape[1];F(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),F(vi(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),F(ba(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),F(ba(t),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},h={strides:t,pad:i,dataFormat:r,dilations:o,dimRoundingMode:s},p=q.runKernel(kf,f,h);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const ya=te({conv2d_:W6});function G6(n,e,t,i,r="NWC",o=1,s){const a=B(n,"x","conv1d"),l=B(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=ee(a,[1,a.shape[0],a.shape[1]])),F(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),F(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Vi("conv1d",i,s),F(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),F(vi(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),F(ba(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),F(ba(t),()=>"Error in conv1D: Stride should be larger than 0."),F(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=ee(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=ee(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=ya(f,d,[1,t],i,"NHWC",[1,o],s);return u?ee(g,[g.shape[2],g.shape[3]]):ee(g,[g.shape[0],g.shape[2],g.shape[3]])}const v2=te({conv1d_:G6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(n,e,t,i,r,o="NHWC",s){F(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,c=!1;e.rank===3&&(c=!0,l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),F(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),F(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),F(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const u=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];F(u===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[2]}.`),F(d===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${t.shape[3]}.`),Vi("conv2dDerInput",r,s);const f={dy:l,filter:t},h={strides:i,pad:r,dataFormat:o,dimRoundingMode:s,inputShape:a},p=q.runKernel(Df,f,h);return c?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const v0=te({conv2DBackpropInput_:H6});function U6(n,e,t,i,r,o){const s=B(n,"x","conv2dTranspose"),a=B(e,"filter","conv2dTranspose");return v0(t,s,a,i,r,"NHWC",o)}const x2=te({conv2dTranspose_:U6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6(n,e,t,i,r="NDHWC",o=[1,1,1]){const s=B(n,"x","conv3d"),a=B(e,"filter","conv3d");let l=s,c=!1;s.rank===4&&(c=!0,l=ee(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),F(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),F(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),F(vi(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),F(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),F(ba(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),F(ba(t),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:t,pad:i,dataFormat:r,dilations:o},f=q.runKernel(Tf,u,d);return c?ee(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const K6=te({conv3d_:j6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(n,e,t,i,r){F(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,s=e,a=!1;e.rank===4&&(a=!0,s=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const l=o[4],c=s.shape[4];F(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),F(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),F(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),F(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),F(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const u={dy:s,filter:t},d={pad:r,strides:i,inputShape:o},f=q.runKernel(Ax,u,d);return a?ee(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const b2=te({conv3DBackpropInput_:X6});function q6(n,e,t,i,r){const o=B(n,"x","conv3dTranspose"),s=B(e,"filter","conv3dTranspose");return b2(t,o,s,i,r)}const Y6=te({conv3dTranspose_:q6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(n){const t={x:B(n,"x","cos","float32")};return q.runKernel(wu,t)}const x0=te({cos_:J6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(n){const t={x:B(n,"x","cosh","float32")};return q.runKernel(Cu,t)}const y2=te({cosh_:Z6});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(n,e=0,t=!1,i=!1){const o={x:B(n,"x","cumprod")},s={axis:e,exclusive:t,reverse:i};return q.runKernel(Ox,o,s)}const Fg=te({cumprod_:Q6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(n,e=0,t=!1,i=!1){const o={x:B(n,"x","cumsum")},s={axis:e,exclusive:t,reverse:i};return q.runKernel(Rf,o,s)}const w2=te({cumsum_:ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(n,e,t,i=!1){const r=B(n,"x","denseBincount"),o=B(e,"weights","denseBincount");F(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),F(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),F(t>=0,()=>`size must be non-negative, but got ${t}.`),F(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const s={x:r,weights:o},a={size:t,binaryOutput:i};return q.runKernel(Mx,s,a)}const AC=te({denseBincount_:tj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nj(n,e,t="NHWC"){const i=B(n,"x","depthToSpace","float32"),r=t==="NHWC"?i.shape[1]:i.shape[2],o=t==="NHWC"?i.shape[2]:i.shape[3],s=t==="NHWC"?i.shape[3]:i.shape[1];F(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),F(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${i.shape}`),F(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${i.shape}`),F(s%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${s} for depthToSpace with input shape ${i.shape}`);const a={x:i},l={blockSize:e,dataFormat:t};return q.runKernel(Fx,a,l)}const ij=te({depthToSpace_:nj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(n,e,t,i,r="NHWC",o=[1,1],s){const a=B(n,"x","depthwiseConv2d","float32"),l=B(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?c.shape[3]:c.shape[1];F(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),Vi("depthwiseConv2d",i,s);const f={x:c,filter:l},h={strides:t,pad:i,dataFormat:r,dilations:o,dimRoundingMode:s},p=q.runKernel(_f,f,h);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const b0=te({depthwiseConv2d_:rj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oj(n,e,t,i,r=[1,1],o="NHWC"){const s=B(n,"x","dilation2d"),a=B(e,"filter","dilation2d");F(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),F(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),F(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=s,c=!1;s.rank===3&&(l=ee(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0),F(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:t,pad:i,dilations:r},f=q.runKernel(Af,u,d);return c?ee(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const sj=te({dilation2d_:oj});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(n,e){const t=n.length,i=[];for(let r=0;r<t;r++){const o=t-1-r,s=n[o]||1;(e[e.length-1-r]||1)>1&&s===1&&i.unshift(o)}return i}function Gn(n,e){const t=[];for(let i=0;i<e.length;i++){const r=n[n.length-i-1],o=e.length-i-1,s=e[o];(r==null||r===1&&s>1)&&t.unshift(o)}return t}function vt(n,e){const t=Math.max(n.length,e.length),i=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let s=e[e.length-r-1];if(s==null&&(s=1),o===1)i[t-r-1]=s;else if(s===1)i[t-r-1]=o;else if(o!==s){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else i[t-r-1]=o}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aj(n,e){let t=B(n,"a","equal","string_or_numeric"),i=B(e,"b","equal","string_or_numeric");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Of,r)}const Io=te({equal_:aj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lj(n,e,t){const i=B(e,"a","where"),r=B(t,"b","where"),o=B(n,"condition","where","bool"),s=vt(vt(o.shape,i.shape),r.shape),a=Ac(o,s),l=Ac(i,s),c=Ac(r,s),u={condition:a,t:l,e:c};return q.runKernel(up,u)}const $i=te({where_:lj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cj(n){const t={x:B(n,"x","zerosLike")};return q.runKernel(xp,t)}const Mt=te({zerosLike_:cj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uj(n,e){let t=B(n,"a","div"),i=B(e,"b","div");[t,i]=$n(t,i);const r=at(t,i),o=Mt(r),s=Io(i,o);return $i(s,o,r)}const dj=te({divNoNan_:uj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hj(n,e){const t=B(n,"t1","dot"),i=B(e,"t2","dot");F((t.rank===1||t.rank===2)&&(i.rank===1||i.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${i.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=i.rank===1?i.size:i.shape[0];if(F(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&i.rank===1){const s=ee(t,[1,-1]),a=ee(i,[-1,1]),l=Wt(s,a);return ee(l,[])}else if(t.rank===1&&i.rank===2){const s=ee(t,[1,-1]),a=ee(i,[i.shape[0],i.shape[1]]),l=Wt(s,a);return ee(l,[l.size])}else if(t.rank===2&&i.rank===1){const s=ee(i,[-1,1]),a=Wt(t,s);return ee(a,[a.size])}else{const s=ee(i,[i.shape[0],i.shape[1]]);return Wt(t,s)}}const fj=te({dot_:hj});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pj(n,...e){const t=e.map((r,o)=>B(r,`tensors${o}`,"einsum")),i={equation:n};return q.runKernel(Bx,t,i)}const xc=te({einsum_:pj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(n){const t={x:B(n,"x","elu","float32")};return q.runKernel(Iu,t)}const $p=te({elu_:mj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gj(n){let e=B(n,"x","erf");F(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Pe(e,"float32"));const t={x:e};return q.runKernel($u,t)}const C2=te({erf_:gj});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y0(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function S2(n,e,t){const i=n.length+e.length,r=[];let o=0,s=0;for(let a=0;a<i;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[s++]);return r}function Zn(n,e){const t=[],i=n.length;for(let o=0;o<i;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function Pn(n,e){const t=e.map(i=>1);return S2(n,t,e)}function ii(n,e,t){F(y0(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function xn(n,e){if(y0(n,e))return null;const t=[];for(let i=0;i<e;++i)n.indexOf(i)===-1&&t.push(i);return n.forEach(i=>t.push(i)),t}function _s(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Dn(n,e){const t=[];for(let i=e-n;i<e;++i)t.push(i);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vj(n,e=null,t=!1){const r={x:B(n,"x","max")},o={reductionIndices:e,keepDims:t};return q.runKernel(jf,r,o)}const Gr=te({max_:vj});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(n,e=null,t=!1){const r={x:B(n,"x","min")},o={axis:e,keepDims:t};return q.runKernel(Yf,r,o)}const Rh=te({min_:xj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bj(n,e){let t=B(n,"base","pow"),i=B(e,"exp","pow");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(Vu,r)}const wa=te({pow_:bj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gt(n,e){if((kr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&kr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return wp(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yj(n){const t={x:B(n,"x","sqrt","float32")};return q.runKernel(Qu,t)}const gi=te({sqrt_:yj});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wj(n){const e=B(n,"x","square"),t={};return q.runKernel("Square",{x:e},t)}const an=te({square_:wj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cj(n,e=null,t=!1){let i=B(n,"x","sum");i.dtype==="bool"&&(i=Pe(i,"int32"));const r={x:i},o={axis:e,keepDims:t};return q.runKernel(hp,r,o)}const rt=te({sum_:Cj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(n,e="euclidean",t=null,i=!1){n=B(n,"x","norm");const r=I2(n,e,t);let o=r.shape;if(i){const s=Ct(t,n.shape);o=Pn(r.shape,s)}return ee(r,o)}function I2(n,e,t=null){if(n.rank===0)return wi(n);if(n.rank!==1&&t===null)return I2(ee(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return rt(wi(n),t);if(e===1/0)return Gr(wi(n),t);if(e===-1/0)return Rh(wi(n),t);if(e==="euclidean"||e===2)return gi(rt(wa(wi(n),Gt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Gr(rt(wi(n),t[0]),t[1]-1);if(e===1/0)return Gr(rt(wi(n),t[1]),t[0]);if(e===-1/0)return Rh(rt(wi(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return gi(rt(an(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Ep=te({norm_:Sj});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ij(n,e=null,t=!1){return Ep(n,"euclidean",e,t)}const $j=te({euclideanNorm_:Ij});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ej(n){const t={x:B(n,"x","exp")};return q.runKernel(Eu,t)}const $o=te({exp_:Ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(n,e=0){const t=B(n,"x","expandDims","string_or_numeric");F(e<=t.rank,()=>"Axis must be <= rank of the tensor");const i={input:t},r={dim:e};return q.runKernel(Pf,i,r)}const Ai=te({expandDims_:Nj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(n){const t={x:B(n,"x","expm1")};return q.runKernel(Nu,t)}const Dj=te({expm1_:kj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tj(n,e){const t=B(n,"x","tile","string_or_numeric");F(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const i={x:t},r={reps:e};return q.runKernel(rd,i,r)}const Vr=te({tile_:Tj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rj(n,e,t,i="float32"){e==null&&(e=n);const r=wt([n,e],i),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const s=ee(r.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return Vr(Ai(s,0),[t[0],1,1]);if(t.length===2)return Vr(Ai(Ai(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Vr(Ai(Ai(Ai(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const $2=te({eye_:Rj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _j(n){const t={x:B(n,"x","floor","float32")};return q.runKernel(ku,t)}const Np=te({floor_:_j});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aj(n,e,t=0,i=0){const r=B(n,"x","gather"),o=B(e,"indices","gather","int32"),s={x:r,indices:o},a={axis:t,batchDims:i};return q.runKernel(Ff,s,a)}const w0=te({gather_:Aj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oj(n,e){let t=B(n,"a","greater","string_or_numeric"),i=B(e,"b","greater","string_or_numeric");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Lf,r)}const ur=te({greater_:Oj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pj(n,e){let t=B(n,"a","greaterEqual","string_or_numeric"),i=B(e,"b","greaterEqual","string_or_numeric");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Tu,r)}const Oa=te({greaterEqual_:Pj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mj(n){const t={input:B(n,"input","imag")};return q.runKernel(jx,t)}const C0=te({imag_:Mj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(n){const t={x:B(n,"x","isFinite")};return q.runKernel(_u,t)}const Lj=te({isFinite_:Fj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(n){const t={x:B(n,"x","isInf")};return q.runKernel(Au,t)}const Bj=te({isInf_:zj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(n){const t={x:B(n,"x","isNaN")};return q.runKernel(Ou,t)}const Wj=te({isNaN_:Vj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gj(n,e=.2){const i={x:B(n,"x","leakyRelu")},r={alpha:e};return q.runKernel(zf,i,r)}const S0=te({leakyRelu_:Gj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(n,e){let t=B(n,"a","less","string_or_numeric"),i=B(e,"b","less","string_or_numeric");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Bf,r)}const _h=te({less_:Hj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(n,e){let t=B(n,"a","lessEqual","string_or_numeric"),i=B(e,"b","lessEqual","string_or_numeric");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Vf,r)}const ec=te({lessEqual_:Uj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(n,e=5,t=1,i=1,r=.5){const o=B(n,"x","localResponseNormalization");F(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),F(kl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let s=o,a=!1;o.rank===3&&(a=!0,s=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:s},c={depthRadius:e,bias:t,alpha:i,beta:r},u=q.runKernel(Uf,l,c);return a?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Kj=te({localResponseNormalization_:jj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xj(n){const t={x:B(n,"x","log","float32")};return q.runKernel(Pu,t)}const Eo=te({log_:Xj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(n){const t={x:B(n,"x","log1p")};return q.runKernel(Mu,t)}const E2=te({log1p_:qj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yj(n,e){F(wg(n),()=>"The f passed in variableGrads(f) must be a function"),F(e==null||Array.isArray(e)&&e.every(c=>c instanceof Dh),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in q.registeredVariables)e.push(q.registeredVariables[c])}const i=t?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),F(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:s,grads:a}=q.gradients(n,e,null,o);F(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),F(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),i!=null&&i.forEach(c=>l[c.name]=null),{value:s,grads:l}}function Al(n){return q.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jj(n){const t={x:B(n,"x","neg")};return q.runKernel(Zf,t)}const In=te({neg_:Jj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(n){const t={x:B(n,"x","softplus")};return q.runKernel(Zu,t)}const ad=te({softplus_:Zj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(n){const e=B(n,"x","logSigmoid");return Al(i=>({value:In(ad(In(i))),gradFunc:s=>K(s,Ql(In(i)))}))(e)}const eK=te({logSigmoid_:Qj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(n,e){let t=B(n,"a","sub"),i=B(e,"b","sub");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(td,r)}const ct=te({sub_:tK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n,e=-1){const t=B(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Al((r,o)=>{const a=Gr(r,e,!0),l=ct(r,a),c=ct(Pe(l,"float32"),Eo(rt($o(l),e,!0)));return o([c]),{value:c,gradFunc:(d,f)=>{const[h]=f,p=!0,m=$o(h);return ct(d,K(rt(d,e,p),m))}}})(t)}const N2=te({logSoftmax_:nK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(n,e=null,t=!1){const i=B(n,"x","logSumExp"),r=Ct(e,i.shape),o=Gr(i,r,!0),s=ct(i,o),a=$o(s),l=rt(a,r),c=Eo(l),u=$e(ee(o,c.shape),c);if(t){const d=Pn(u.shape,r);return ee(u,d)}return u}const k2=te({logSumExp_:iK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n,e){const t=B(n,"a","logicalAnd","bool"),i=B(e,"b","logicalAnd","bool");vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Wf,r)}const Uo=te({logicalAnd_:rK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(n){const t={x:B(n,"x","logicalNot","bool")};return q.runKernel(Gf,t)}const I0=te({logicalNot_:oK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(n,e){const t=B(n,"a","logicalOr","bool"),i=B(e,"b","logicalOr","bool");vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Hf,r)}const D2=te({logicalOr_:sK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n,e){const t=B(n,"a","logicalXor","bool"),i=B(e,"b","logicalXor","bool");return vt(t.shape,i.shape),Uo(D2(n,e),I0(Uo(n,e)))}const lK=te({logicalXor_:aK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(n,e,t,i,r){const o=B(n,"x","maxPool"),s=1;let a=o,l=!1;o.rank===3&&(l=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),F(vi(t,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`),Vi("maxPool",i,r);const c={x:a},u={filterSize:e,strides:t,pad:i,dimRoundingMode:r},d=q.runKernel(Kf,c,u);return l?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const $0=te({maxPool_:cK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uK(n,e=[1,1,1],t,i,r,o="NDHWC"){const s=B(n,"x","maxPool3d");let a=s,l=!1;s.rank===4&&(l=!0,a=ee(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),F(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Vi("maxPool3d",i,r);const c={x:a},u={filterSize:e,strides:t,pad:i,dimRoundingMode:r,dataFormat:o},d=q.runKernel(Xf,c,u);return l?ee(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const dK=te({maxPool3d_:uK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n,e){let t=B(n,"a","maximum"),i=B(e,"b","maximum");[t,i]=$n(t,i),t.dtype==="bool"&&(t=Pe(t,"int32"),i=Pe(i,"int32")),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Fu,r)}const As=te({maximum_:hK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n,e=null,t=!1){const r={x:B(n,"x","mean")},o={axis:e,keepDims:t};return q.runKernel(qf,r,o)}const On=te({mean_:fK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yn(n,e="float32"){if(Zo(n),e==="complex64"){const i=Yn(n,"float32"),r=Yn(n,"float32");return ma(i,r)}const t=mi(he(n),e);return q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Os(n,e="float32"){if(Zo(n),e==="complex64"){const i=Os(n,"float32"),r=Yn(n,"float32");return ma(i,r)}const t=yx(he(n),e);return q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n,e){let t=B(n,"a","minimum"),i=B(e,"b","minimum");[t,i]=$n(t,i),t.dtype==="bool"&&(t=Pe(t,"int32"),i=Pe(i,"int32")),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Lu,r)}const jc=te({minimum_:pK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(n,e,t){F(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const i=B(n,"x","mirrorPad");if(i.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");F(e.length===i.rank,()=>`Padding doesn't match input. Must be ${i.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<i.rank;a++)F(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),F(e[a][0]>=0&&e[a][0]<=i.shape[a]-r&&e[a][1]>=0&&e[a][1]<=i.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${i.shape[a]-r} or less than 0 for input of shape ${i.shape}`);const o={paddings:e,mode:t},s={x:i};return q.runKernel(Jf,s,o)}const gK=te({mirrorPad_:mK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(n,e){let t=B(n,"a","mod"),i=B(e,"b","mod");[t,i]=$n(t,i);const r={a:t,b:i};return q.runKernel(zu,r)}const xK=te({mod_:vK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(n,e=null,t=!1){n=B(n,"x","moments");const i=Ct(e,n.shape),r=On(n,i,t);let o=r.shape;t||(o=Pn(r.shape,i));const s=an(ct(Pe(n,"float32"),ee(r,o))),a=On(s,i,t);return{mean:r,variance:a}}const E0=te({moments_:bK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(n,e){let t=B(n,"a","notEqual","string_or_numeric"),i=B(e,"b","notEqual","string_or_numeric");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i};return q.runKernel(Qf,r)}const Ah=te({notEqual_:yK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(n,e,t=1,i=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:B(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:i};return q.runKernel(tp,s,a)}const T2=te({oneHot_:wK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(n){const t={x:B(n,"x","onesLike")};return q.runKernel(ep,t)}const Dr=te({onesLike_:CK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(n,e,t=0){const i=B(n,"x","pad");if(i.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:i};return q.runKernel(ip,o,r)}const N0=te({pad_:SK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n,e,t){const i=B(n,"x","spaceToBatchND");F(i.rank>=1+e.length,()=>`input rank ${i.rank} should be > than [blockShape] ${e.length}`),F(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),F(i.shape.reduce((s,a,l)=>l>0&&l<=e.length?s&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:s,!0),()=>`input spatial dimensions ${i.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:i},o={blockShape:e,paddings:t};return q.runKernel(fp,r,o)}const k0=te({spaceToBatchND_:IK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n,e,t,i,r,o,s){r==null&&(r=[1,1]),o==null&&(o=1),i===0&&(i="valid");const a=B(n,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(vi(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const u=_r(l.shape,e,o,r,i),d=[u.dilationHeight,u.dilationWidth];let f;i==="same"?f=NK([u.filterHeight,u.filterWidth],d):f=[[0,0],[0,0]];const h=d[0]===1&&d[1]===1,[p,m]=EK([u.inHeight,u.inWidth],d,f),g=h?i:"valid",v=h?l:k0(l,d,p),b=(t==="avg"?()=>m0(v,e,o,g,s):()=>$0(v,e,o,g,s))(),w=h?b:g0(b,d,m);return c?ee(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function EK(n,e,t){const i=t.map(u=>u[0]),r=t.map(u=>u[1]),o=n.concat(i,r),s=e.map((u,d)=>(u-o[d]%u)%u),a=r.map((u,d)=>u+s[d]),l=e.map((u,d)=>[i[d],a[d]]),c=e.map((u,d)=>[0,s[d]]);return[l,c]}function NK(n,e){const i=n.map((s,a)=>s+(s-1)*(e[a]-1)).map(s=>s-1),r=i.map(s=>Math.floor(s/2)),o=i.map((s,a)=>s-r[a]);return i.map((s,a)=>[r[a],o[a]])}const kK=te({pool_:$K});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(n,e){const t=B(n,"x","prelu"),i=B(e,"alpha","prelu"),r={x:t,alpha:i};return q.runKernel(rp,r)}const D0=te({prelu_:DK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(n,e=null,t=!1){let i=B(n,"x","prod");i.dtype==="bool"&&(i=Pe(i,"int32"));const r={x:i},o={axis:e,keepDims:t};return q.runKernel(op,r,o)}const RK=te({prod_:TK});var T0={exports:{}};T0.exports;(function(n){(function(e,t,i){function r(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function o(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function s(l,c){var u=new r(l),d=c&&c.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=s:this.alea=s})(mo,n)})(T0);var _K=T0.exports,R0={exports:{}};R0.exports;(function(n){(function(e,t,i){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function s(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=s:this.xor128=s})(mo,n)})(R0);var AK=R0.exports,_0={exports:{}};_0.exports;(function(n){(function(e,t,i){function r(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function s(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=s:this.xorwow=s})(mo,n)})(_0);var OK=_0.exports,A0={exports:{}};A0.exports;(function(n){(function(e,t,i){function r(a){var l=this;l.next=function(){var u=l.x,d=l.i,f,h;return f=u[d],f^=f>>>7,h=f^f<<24,f=u[d+1&7],h^=f^f>>>10,f=u[d+3&7],h^=f^f>>>3,f=u[d+4&7],h^=f^f<<7,f=u[d+7&7],f=f^f<<13,h^=f^f<<9,u[d]=h,l.i=d+1&7,h};function c(u,d){var f,h=[];if(d===(d|0))h[0]=d;else for(d=""+d,f=0;f<d.length;++f)h[f&7]=h[f&7]<<15^d.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],u.x=h,u.i=0,f=256;f>0;--f)u.next()}c(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function s(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.x&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=s:this.xorshift7=s})(mo,n)})(A0);var PK=A0.exports,O0={exports:{}};O0.exports;(function(n){(function(e,t,i){function r(a){var l=this;l.next=function(){var u=l.w,d=l.X,f=l.i,h,p;return l.w=u=u+1640531527|0,p=d[f+34&127],h=d[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=d[f]=p^h,l.i=f,p+(u^u>>>16)|0};function c(u,d){var f,h,p,m,g,v=[],x=128;for(d===(d|0)?(h=d,d=null):(d=d+"\0",h=0,x=Math.max(x,d.length)),p=0,m=-32;m<x;++m)d&&(h^=d.charCodeAt((m+32)%d.length)),m===0&&(g=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,m>=0&&(g=g+1640531527|0,f=v[m&127]^=h+g,p=f==0?p+1:0);for(p>=128&&(v[(d&&d.length||0)&127]=-1),p=127,m=4*128;m>0;--m)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;u.w=g,u.X=v,u.i=p}c(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function s(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.X&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=s:this.xor4096=s})(mo,n)})(O0);var MK=O0.exports,P0={exports:{}};P0.exports;(function(n){(function(e,t,i){function r(a){var l=this,c="";l.next=function(){var d=l.b,f=l.c,h=l.d,p=l.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-h|0,l.d=h<<16^f>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function s(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=s:this.tychei=s})(mo,n)})(P0);var FK=P0.exports,R2={exports:{}};(function(n){(function(e,t,i){var r=256,o=6,s=52,a="random",l=i.pow(r,o),c=i.pow(2,s),u=c*2,d=r-1,f;function h(w,y,C){var $=[];y=y==!0?{entropy:!0}:y||{};var I=v(g(y.entropy?[w,b(t)]:w??x(),3),$),E=new p($),N=function(){for(var k=E.g(o),D=l,_=0;k<c;)k=(k+_)*r,D*=r,_=E.g(1);for(;k>=u;)k/=2,D/=2,_>>>=1;return(k+_)/D};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,v(b(E.S),t),(y.pass||C||function(k,D,_,R){return R&&(R.S&&m(R,E),k.state=function(){return m(E,{})}),_?(i[a]=k,D):k})(N,I,"global"in y?y.global:this==i,y.state)}function p(w){var y,C=w.length,$=this,I=0,E=$.i=$.j=0,N=$.S=[];for(C||(w=[C++]);I<r;)N[I]=I++;for(I=0;I<r;I++)N[I]=N[E=d&E+w[I%C]+(y=N[I])],N[E]=y;($.g=function(k){for(var D,_=0,R=$.i,T=$.j,A=$.S;k--;)D=A[R=d&R+1],_=_*r+A[d&(A[R]=A[T=d&T+D])+(A[T]=D)];return $.i=R,$.j=T,_})(r)}function m(w,y){return y.i=w.i,y.j=w.j,y.S=w.S.slice(),y}function g(w,y){var C=[],$=typeof w,I;if(y&&$=="object")for(I in w)try{C.push(g(w[I],y-1))}catch{}return C.length?C:$=="string"?w:w+"\0"}function v(w,y){for(var C=w+"",$,I=0;I<C.length;)y[d&I]=d&($^=y[d&I]*19)+C.charCodeAt(I++);return b(y)}function x(){try{var w;return f&&(w=f.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var y=e.navigator,C=y&&y.plugins;return[+new Date,e,C,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(v(i.random(),t),n.exports){n.exports=h;try{f=oA}catch{}}else i["seed"+a]=h})(typeof self<"u"?self:mo,[],Math)})(R2);var LK=R2.exports,zK=_K,BK=AK,VK=OK,WK=PK,GK=MK,HK=FK,Pa=LK;Pa.alea=zK;Pa.xor128=BK;Pa.xorwow=VK;Pa.xorshift7=WK;Pa.xor4096=GK;Pa.tychei=HK;var M0=Pa;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _2{constructor(e,t,i,r,o){this.mean=e,this.stdDev=t,this.dtype=i,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const s=o||Math.random();this.random=M0.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,i=!1;for(;!i;){let r,o,s;do r=2*this.random()-1,o=2*this.random()-1,s=r*r+o*o;while(s>=1||s===0);const a=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(i=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class UK{constructor(e=0,t=1,i,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=i,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=M0.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n,e=0,t=1,i,r){if(Zo(n),i!=null&&i==="bool")throw new Error(`Unsupported data type ${i}`);const o=new _2(e,t,i,!1,r),s=wt(n,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const A2=te({randomNormal_:jK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(n,e=0,t=1,i="float32",r){Zo(n);const o=wt(n,i),s=new UK(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const ld=te({randomUniform_:KK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kc(n,e,t=1,i="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:i};return q.runKernel(Qx,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(n){const t={input:B(n,"input","real")};return q.runKernel(e0,t)}const Oh=te({real_:XK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qK(n){const t={x:B(n,"x","reciprocal")};return q.runKernel(Wu,t)}const YK=te({reciprocal_:qK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n){const t={x:B(n,"x","relu")};return q.runKernel(Gu,t)}const Ma=te({relu_:JK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n){const t={x:B(n,"x","relu6")};return q.runKernel(Hu,t)}const O2=te({relu6_:ZK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(n,e){const i={x:B(n,"x","reverse")},r={dims:e};return q.runKernel(cp,i,r)}const Ca=te({reverse_:QK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(n){const t={x:B(n,"x","round")};return q.runKernel(Uu,t)}const P2=te({round_:e5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(n){const t={x:B(n,"x","rsqrt","float32")};return q.runKernel(ju,t)}const M2=te({rsqrt_:t5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n){const t={x:B(n,"x","selu")};return q.runKernel(Ku,t)}const F2=te({selu_:n5});function i5(n,e,t,i,r,o=[1,1],s="NHWC"){const a=B(n,"x","separableConv2d"),l=B(e,"depthwiseFilter","separableConv2d"),c=B(t,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),F(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),F(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),F(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],h=l.shape[3];F(c.shape[2]===f*h,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*h}, but got ${c.shape[2]}.`);const p=b0(u,l,i,r,s,o),g=ya(p,c,1,"valid",s);return d?ee(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const L2=te({separableConv2d_:i5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(n){const t={x:B(n,"x","sign")};return q.runKernel(Yu,t)}const o5=te({sign_:r5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(n){const t={x:B(n,"x","sin","float32")};return q.runKernel(Xu,t)}const z2=te({sin_:s5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(n){const t={x:B(n,"x","sinh")};return q.runKernel(qu,t)}const B2=te({sinh_:a5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(n,e,t){const i=B(n,"x","slice1d");return F(i.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${i.rank} tensor`),tn(i,[e],[t])}const F0=te({slice1d_:l5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(n,e,t){const i=B(n,"x","slice2d");return F(i.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${i.rank} tensor`),tn(i,e,t)}const V2=te({slice2d_:c5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(n,e,t){const i=B(n,"x","slice3d");return F(i.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${i.rank} tensor`),tn(i,e,t)}const L0=te({slice3d_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(n,e,t){const i=B(n,"x","slice4d");return F(i.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${i.rank} tensor`),tn(i,e,t)}const Ph=te({slice4d_:d5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(n,e=-1){const t=B(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const i={logits:t},r={dim:e};return q.runKernel(mp,i,r)}const z0=te({softmax_:h5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(n){F(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return q.runKernel(Wx,e)}const W2=te({fft_:f5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(n){F(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return q.runKernel(Ux,e)}const Lg=te({ifft_:p5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(n){const e=n.shape[n.shape.length-1],t=n.size/e;let i;if(e<=2){const r=ee(n,[t,e]);i=Lg(r)}else{const r=[t,2*(e-1)],o=ee(Oh(n),[t,e]),s=ee(C0(n),[t,e]),a=Ca(tn(o,[0,1],[t,e-2]),1),l=K(Ca(tn(s,[0,1],[t,e-2]),1),Gt(-1)),c=Fi([o,a],1),u=Fi([s,l],1),d=ee(ma(c,u),[r[0],r[1]]);i=Lg(d)}if(i=Oh(i),n.rank===3&&n.shape[0]!==0){const r=i,o=n.shape[0];i=ee(i,[o,i.shape[0]/o,i.shape[1]]),r.dispose()}return i}const g5=te({irfft_:m5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(n,e,t=0){const r={x:B(n,"x","split")},o={numOrSizeSplits:e,axis:t};return q.runKernel(pp,r,o)}const ar=te({split_:v5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(n,e){F(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const i=n.size/t;let r;if(e!=null&&e<t){const p=n.shape.map(g=>0),m=n.shape.map(g=>g);m[n.shape.length-1]=e,r=tn(n,p,m),t=e}else if(e!=null&&e>t){const p=n.shape.map(m=>m);p[n.shape.length-1]=e-t,r=Fi([n,Yn(p)],n.shape.length-1),t=e}else r=n;const o=Mt(r),s=ee(ma(r,o),[i,t]),a=W2(s),l=Math.floor(t/2)+1,c=Oh(a),u=C0(a),d=ar(c,[l,t-l],c.shape.length-1),f=ar(u,[l,t-l],u.shape.length-1),h=r.shape.slice();return h[r.shape.length-1]=l,ee(ma(d[0],f[0]),h)}const b5=te({rfft_:x5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(n,e){let t=B(n,"a","squaredDifference"),i=B(e,"b","squaredDifference");[t,i]=$n(t,i),vt(t.shape,i.shape);const r={a:t,b:i},o={};return q.runKernel(ed,r,o)}const w5=te({squaredDifference_:y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(n,e){const t=B(n,"x","squeeze","string_or_numeric");return ee(t,ks(t.shape,e).newShape)}const cd=te({squeeze_:C5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(n,e=0){const t=a2(n,"tensors","stack","string_or_numeric");F(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&F(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const i=t,r={axis:e};return q.runKernel(np,i,r)}const jo=te({stack_:S5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(n,e=0){const i={x:B(n,"x","step")},r={alpha:e};return q.runKernel(od,i,r)}const ud=te({step_:I5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(n,e,t,i,r=0,o=0,s=0,a=0,l=0){const u={x:B(n,"x","stridedSlice","string_or_numeric")},d={begin:e,end:t,strides:i,beginMask:r,endMask:o,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return q.runKernel(o0,u,d)}const E5=te({stridedSlice_:$5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n){const t={x:B(n,"x","tan","float32")};return q.runKernel(nd,t)}const k5=te({tan_:N5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(n,e){fE(n);const t=yp(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return wp(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ch(n,e,t){if(fE(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const i=yp(n,t);if(i.length!==2&&i.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(i.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return wp(n,e,i,t)}function G2(n,e,t){const i=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${i}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<i+(t.rank-r))throw new Error(o+` Output shape length < ${i+(t.rank-r)}`);if(t.rank!==r+n.length-i)throw new Error(o+` update.rank != ${r+n.length-i}`);for(let s=0;s<r;++s)if(t.shape[s]!==e.shape[s])throw new Error(o+` updates.shape[${s}] (${t.shape[s]}) != indices.shape[${s}] (${e.shape[s]}).`);for(let s=0;s<t.rank-r;++s)if(t.shape[s+r]!==n[s+i])throw new Error(o+` updates.shape[${s+r}] (${t.shape[s+r]}) != shape[${s+r}] (${n[s+r]})`)}function D5(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}G2(t,e,n)}function Fa(n,e,t){const i=e.shape.length,r=i>1?e.shape[i-1]:1,o=t.length;let s=1;for(let d=r;d<o;++d)s*=t[d];const a=r<1?1:r,l=he(e.shape)/a,c=[...Qe(t.slice(0,r)),1],u=he(t);return{sliceRank:r,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T5(n,e=1,t=!0){const i=B(n,"x","topk");if(i.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=i.shape[i.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:i},s={k:e,sorted:t},[a,l]=q.runKernel(s0,o,s);return{values:a,indices:l}}const R5=te({topk_:T5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n,e=0,t=1,i,r){if(Zo(n),i!=null&&i==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new _2(e,t,i,!0,r),s=wt(n,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const H2=te({truncatedNormal_:_5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5(n,e=0){const t=B(n,"x","unique","string_or_numeric");F(t.rank>0,()=>"The input tensor must be at least 1D");const i={x:t},r={axis:e},[o,s]=q.runKernel(l0,i,r);return{values:o,indices:s}}const O5=te({unique_:A5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(n,e,t){const i=B(n,"x","unsortedSegmentSum"),r=B(e,"segmentIds","unsortedSegmentSum","int32");F(kl(t),()=>"numSegments must be of dtype int");const o={x:i,segmentIds:r},s={numSegments:t};return q.runKernel(vp,o,s)}const U2=te({unsortedSegmentSum_:P5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n,e=0){const t=B(n,"x","unstack","string_or_numeric");F(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const i={value:t},r={axis:e};return q.runKernel(gp,i,r)}const Sa=te({unstack_:M5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(n,e=!0,t,i){return q.makeVariable(n,e,t,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const i=wt(n,"int32"),r=wt([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const s=i.indexToLoc(t[o]),a=o*n.length;r.values.set(s,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(n,e,t){const i=B(n,"x","transpose");if(e==null&&(e=i.shape.map((s,a)=>a).reverse()),F(i.rank===e.length,()=>`Error in transpose: rank of input ${i.rank} must match length of perm ${e}.`),e.forEach(s=>{F(s>=0&&s<i.rank,()=>`All entries in 'perm' must be between 0 and ${i.rank-1} but got ${e}`)}),i.rank<=1)return i.clone();const r={x:i},o={perm:e};return i.dtype==="complex64"?ie(()=>{let s=Oh(i),a=C0(i);return s=q.runKernel(ll,{x:s},o),a=q.runKernel(ll,{x:a},o),t&&(a=In(a)),ma(s,a)}):q.runKernel(ll,r,o)}const Pt=te({transpose_:L5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5(n,e){if(e==null)return n.shape.slice();if(Ht(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let i=0;i<n.shape.length;i++)e[i]==null&&n.shape[i]!=null?t.push(n.shape[i]):t.push(e[i]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n,e,t,i){const r=B(n,"x","dropout");if(F(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),F(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Ln?r.clone():r;const o=z5(r,t),s=1-e,a=at(Np($e(ld(o,0,1,"float32",i),s)),s);return K(r,a)}const V5=te({dropout_:B5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(n,e,t,i,r,o="NHWC",s){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]])),F(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),F(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),F(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=o==="NHWC"?a.shape[3]:a.shape[1],u=o==="NHWC"?l.shape[3]:l.shape[1];F(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),F(u===t[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${t[3]}).`),Vi("conv2dDerFilter",r,s);const d={x:a,dy:l},f={strides:i,pad:r,dataFormat:o,dimRoundingMode:s,filterShape:t};return q.runKernel(Rx,d,f)}const B0=te({conv2DBackpropFilter_:W5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return K(n,ud(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function W0(n,e){let t=e;const i=Gn(n.shape,e.shape);return i.length>0&&(t=rt(t,i)),ee(t,n.shape)}function G0(n,e,t,i){if(e==="linear")return n;if(e==="relu")return Ma(n);if(e==="elu")return $p(n);if(e==="relu6")return O2(n);if(e==="prelu")return D0(n,t);if(e==="leakyrelu")return S0(n,i);if(e==="sigmoid")return Ql(n);throw new Error(`Unknown fused activation ${e}.`)}const H0=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5({x:n,filter:e,strides:t,pad:i,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",H0(q.state.gradientDepth,l)===!1){F(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=ya(n,e,t,i,r,o,s);return a!=null&&(C=$e(C,a)),G0(C,l,c,u)}const d=B(n,"x","conv2d","float32"),f=B(e,"filter","conv2d","float32");let h=d,p=!1;d.rank===3&&(p=!0,h=ee(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(h.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${h.rank}.`),F(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),Vi("fused conv2d",i,s);const m=r==="NHWC"?h.shape[3]:h.shape[1];F(f.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${f.shape[2]}.`),F(vi(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const g=ni(h.shape,f.shape,t,o,i,s);let v;a!=null&&(v=B(a,"bias","fused conv2d"),[v]=$n(v,d),r==="NHWC"?vt(g.outShape,v.shape):(F(v.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${v.shape.length}.`),F(v.shape.length===0||v.shape[0]===g.outChannels||v.shape[0]===1,()=>`Error in fused conv2d: bias shape (${v.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let x;if(c!=null){const C=c.shape;if(F(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)F(C[0]===1||C[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${g.outChannels}).`);else if(C.length===3)try{vt(C,g.outShape)}catch{const I=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(I)}x=B(c,"prelu weights","fused conv2d")}const b=(C,$)=>{F(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[I,E,N,k]=$,D=V0(C,N,l);F(xa(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const _=v0(E.shape,D,I,t,i),R=B0(E,D,I.shape,t,i),T=[_,R];if(k!=null){const A=W0(k,D);T.push(A)}return T},w={x:h,filter:f,bias:v,preluActivationWeights:x},y={strides:t,pad:i,dataFormat:r,dilations:o,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?Al(($,I,E)=>{let N=q.runKernel(Eh,w,y);return E([I,$,N]),p&&(N=ee(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:b}})(h,f):Al(($,I,E,N)=>{let k=q.runKernel(Eh,w,y);return N([I,$,k,E]),p&&(k=ee(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:b}})(h,f,v)}const H5=te({fusedConv2d_:G5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(n,e,t,i,r,o=[1,1],s){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:i,pad:r,dimRoundingMode:s,dilations:o,filterShape:t};return q.runKernel(Lx,c,u)}const j5=te({depthwiseConv2dNativeBackpropFilter_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n,e,t,i,r,o=[1,1],s){let a=e,l=!1;e.rank===3&&(l=!0,a=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:t},u={strides:i,pad:r,dimRoundingMode:s,dilations:o,inputShape:n},d=q.runKernel(zx,c,u);return l?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const X5=te({depthwiseConv2dNativeBackpropInput_:K5});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q5({a:n,b:e,transposeA:t=!1,transposeB:i=!1,bias:r,activation:o="linear",preluActivationWeights:s,leakyreluAlpha:a=.2}){if(H0(q.state.gradientDepth,o)===!1){let k=Wt(n,e,t,i);return r!=null&&(k=$e(k,r)),G0(k,o,s,a)}let l=B(n,"a","fused matMul"),c=B(e,"b","fused matMul");[l,c]=$n(l,c);const u=t?l.shape[l.rank-2]:l.shape[l.rank-1],d=i?c.shape[c.rank-1]:c.shape[c.rank-2],f=t?l.shape[l.rank-1]:l.shape[l.rank-2],h=i?c.shape[c.rank-2]:c.shape[c.rank-1],p=l.shape.slice(0,-2),m=c.shape.slice(0,-2),g=he(p),v=he(m);F(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${i} must match.`);const b=vt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,h]),w=t?ee(l,[g,u,f]):ee(l,[g,f,u]),y=i?ee(c,[v,h,d]):ee(c,[v,d,h]);let C;r!=null&&(C=B(r,"bias","fused matMul"),[C]=$n(C,l),vt(b,C.shape));let $;s!=null&&($=B(s,"prelu weights","fused matMul"));const I=(k,D)=>{const[_,R,T,A]=D,O=V0(ee(k,T.shape),T,o);let P,M;if(!t&&!i?(P=Wt(O,R,!1,!0),M=Wt(_,O,!0,!1)):!t&&i?(P=Wt(O,R,!1,!1),M=Wt(O,_,!0,!1)):t&&!i?(P=Wt(R,O,!1,!0),M=Wt(_,O,!1,!1)):(P=Wt(R,O,!0,!0),M=Wt(O,_,!0,!0)),r!=null){const z=W0(A,O);return[P,M,z]}else return[P,M]},E={a:w,b:y,bias:C,preluActivationWeights:$},N={transposeA:t,transposeB:i,activation:o,leakyreluAlpha:a};return r==null?Al((D,_,R)=>{const T=q.runKernel($h,E,N);return R([D,_,T]),{value:ee(T,b),gradFunc:I}})(w,y):Al((D,_,R,T)=>{const A=q.runKernel($h,E,N);return T([D,_,A,R]),{value:ee(A,b),gradFunc:I}})(w,y,C)}const OC=te({fusedMatMul_:q5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(n,e,t,i,r="bilinear",o=0){const s=B(n,"image","cropAndResize"),a=B(e,"boxes","cropAndResize","float32"),l=B(t,"boxInd","cropAndResize","int32"),c=a.shape[0];F(s.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`),F(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),F(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),F(i.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${i.length}.`),F(i[0]>=1&&i[1]>=1,()=>`cropSize must be atleast [1,1], but was ${i}`),F(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:s,boxes:a,boxInd:l},d={method:r,extrapolationValue:o,cropSize:i};return q.runKernel(Px,u,d)}const J5=te({cropAndResize_:Y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n){const e=B(n,"image","flipLeftRight","float32");F(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return q.runKernel(Hx,t,{})}const Q5=te({flipLeftRight_:Z5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(n){const e=B(n,"image","grayscaleToRGB"),t=e.rank-1,i=e.shape[t];F(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),F(i===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${i}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Vr(e,r)}const t8=te({grayscaleToRGB_:e8});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(n){const e=B(n,"image","RGBToGrayscale"),t=e.rank-1,i=e.shape[t];F(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),F(i===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${i}.`);const r=e.dtype,o=Pe(e,"float32"),s=Xi([.2989,.587,.114]);let a;switch(e.rank){case 2:a=xc("ij,j->i",o,s);break;case 3:a=xc("ijk,k->ij",o,s);break;case 4:a=xc("ijkl,l->ijk",o,s);break;case 5:a=xc("ijklm,m->ijkl",o,s);break;case 6:a=xc("ijklmn,n->ijklm",o,s);break;default:throw new Error("Not a valid tensor rank.")}return a=Ai(a,-1),Pe(a,r)}const i8=te({rgbToGrayscale_:n8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(n,e,t=0,i=.5){const r=B(n,"image","rotateWithOffset","float32");F(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},s={radians:e,fillValue:t,center:i};return q.runKernel(c0,o,s)}const o8=te({rotateWithOffset_:r8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(n,e,t,i,r,o){i==null&&(i=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const s=n.shape[0];return t=Math.min(t,s),F(0<=i&&i<=1,()=>`iouThreshold must be in [0, 1], but was '${i}'`),F(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),F(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),F(e.rank===1,()=>"scores must be a 1D tensor"),F(e.shape[0]===s,()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${e.shape[0]}`),F(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:i,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8(n,e,t,i=.5,r=Number.NEGATIVE_INFINITY){const o=B(n,"boxes","nonMaxSuppression","float32"),s=B(e,"scores","nonMaxSuppression","float32"),a=tc(o,s,t,i,r);t=a.maxOutputSize,i=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:i,scoreThreshold:r};return q.runKernel(Yx,{boxes:o,scores:s},l)}const a8=te({nonMaxSuppression_:s8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(n,e,t){const i=c8(n,e,t),r=i<0?-(i+1):i;n.splice(r,0,e)}function c8(n,e,t){return d8(n,e,t||u8)}function u8(n,e){return n>e?1:n<e?-1:0}function d8(n,e,t){let i=0,r=n.length,o=0,s=!1;for(;i<r;){o=i+(r-i>>>1);const a=t(e,n[o]);a>0?i=o+1:(r=o,s=!a)}return s?i:-i-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0(n,e,t,i,r){return X0(n,e,t,i,r,0)}function j0(n,e,t,i,r,o){return X0(n,e,t,i,r,0,!1,o,!0)}function K0(n,e,t,i,r,o){return X0(n,e,t,i,r,o,!0)}function X0(n,e,t,i,r,o,s=!1,a=!1,l=!1){const c=[];for(let g=0;g<e.length;g++)e[g]>r&&c.push({score:e[g],boxIndex:g,suppressBeginIndex:0});c.sort(PC);const u=o>0?-.5/o:0,d=[],f=[];for(;d.length<t&&c.length>0;){const g=c.pop(),{score:v,boxIndex:x,suppressBeginIndex:b}=g;if(v<r)break;let w=!1;for(let y=d.length-1;y>=b;--y){const C=h8(n,x,d[y]);if(C>=i){w=!0;break}if(g.score=g.score*f8(i,u,C),g.score<=r)break}g.suppressBeginIndex=d.length,w||(g.score===v?(d.push(x),f.push(g.score)):g.score>r&&l8(c,g,PC))}const h=d.length,p=t-h;a&&p>0&&(d.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const m={selectedIndices:d};return s&&(m.selectedScores=f),l&&(m.validOutputs=h),m}function h8(n,e,t){const i=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(i[0],i[2]),s=Math.min(i[1],i[3]),a=Math.max(i[0],i[2]),l=Math.max(i[1],i[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),h=(a-o)*(l-s),p=(d-c)*(f-u);if(h<=0||p<=0)return 0;const m=Math.max(o,c),g=Math.max(s,u),v=Math.min(a,d),x=Math.min(l,f),b=Math.max(v-m,0)*Math.max(x-g,0);return b/(h+p-b)}function f8(n,e,t){const i=Math.exp(e*t*t);return t<=n?i:0}function PC(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function p8(n,e,t,i=.5,r=Number.NEGATIVE_INFINITY){const o=B(n,"boxes","nonMaxSuppressionAsync"),s=B(e,"scores","nonMaxSuppressionAsync"),a=tc(o,s,t,i,r);t=a.maxOutputSize,i=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),s.data()]),c=l[0],u=l[1],{selectedIndices:d}=U0(c,u,t,i,r);return o!==n&&o.dispose(),s!==e&&s.dispose(),Xi(d,"int32")}const m8=p8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(n,e,t,i=.5,r=Number.NEGATIVE_INFINITY,o=0){const s=B(n,"boxes","nonMaxSuppression"),a=B(e,"scores","nonMaxSuppression"),l=tc(s,a,t,i,r,o);t=l.maxOutputSize,i=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const c={boxes:s,scores:a},u={maxOutputSize:t,iouThreshold:i,scoreThreshold:r,softNmsSigma:o},d=q.runKernel(Zx,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const v8=te({nonMaxSuppressionWithScore_:g8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function x8(n,e,t,i=.5,r=Number.NEGATIVE_INFINITY,o=0){const s=B(n,"boxes","nonMaxSuppressionAsync"),a=B(e,"scores","nonMaxSuppressionAsync"),l=tc(s,a,t,i,r,o);t=l.maxOutputSize,i=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const c=await Promise.all([s.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:f,selectedScores:h}=K0(u,d,t,i,r,o);return s!==n&&s.dispose(),a!==e&&a.dispose(),{selectedIndices:Xi(f,"int32"),selectedScores:Xi(h)}}const b8=x8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(n,e,t,i=.5,r=Number.NEGATIVE_INFINITY,o=!1){const s=B(n,"boxes","nonMaxSuppression"),a=B(e,"scores","nonMaxSuppression"),l=tc(s,a,t,i,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,f={boxes:s,scores:a},h={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:o},p=q.runKernel(Jx,f,h);return{selectedIndices:p[0],validOutputs:p[1]}}const w8=te({nonMaxSuppressionPadded_:y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function C8(n,e,t,i=.5,r=Number.NEGATIVE_INFINITY,o=!1){const s=B(n,"boxes","nonMaxSuppressionAsync"),a=B(e,"scores","nonMaxSuppressionAsync"),l=tc(s,a,t,i,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[f,h]=await Promise.all([s.data(),a.data()]),{selectedIndices:p,validOutputs:m}=j0(f,h,c,u,d,o);return s!==n&&s.dispose(),a!==e&&a.dispose(),{selectedIndices:Xi(p,"int32"),validOutputs:Gt(m,"int32")}}const S8=C8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(n,e,t=!1,i=!1){const r=B(n,"images","resizeBilinear");F(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),F(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),F(i===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,s=!1;r.rank===3&&(s=!0,o=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:i,size:e},c=q.runKernel(lp,a,l);return s?ee(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const K2=te({resizeBilinear_:I8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(n,e,t=!1,i=!1){const r=B(n,"images","resizeNearestNeighbor");F(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),F(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),F(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),F(i===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,s=!1;r.rank===3&&(s=!0,o=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:i,size:e},c=q.runKernel(ap,a,l);return s?ee(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const X2=te({resizeNearestNeighbor_:$8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(n,e="binary",t=!1,i=.5){const r=B(n,"image","threshold"),o=.2989,s=.587,a=.114,l=r.shape[0]*r.shape[1];let c=K(Xi([i]),255),u,d,f,h;if(F(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),F(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),F(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),F(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[u,d,f]=ar(r,[1,1,1],-1);const g=K(u,o),v=K(d,s),x=K(f,a);h=$e($e(g,v),x)}else h=n;if(e==="otsu"){const g=D6(Pe(P2(h),"int32"),cl([]),256);c=N8(g,l)}const p=t?ec(h,c):ur(h,c);return Pe(K(p,255),"int32")}function N8(n,e){let t=Xi([-1]),i=Xi([0]),r=Xi([0]),o,s,a,l,c,u;for(let d=0;d<n.size-1;d++){o=tn(n,0,d+1),s=tn(n,d+1),c=at(rt(o),e),u=at(rt(s),e);const f=rt(K(o,Kc(0,o.size)));a=at(f,rt(o));const h=Ip(s.shape,o.size),p=$e(Kc(0,s.size),h),m=K(s,p);l=at(rt(m),rt(s));const g=ct(a,l),v=ct(a,l),x=K(c,u);r=K(K(x,g),v);const b=ur(r,i);i=$i(b,r,i),t=$i(b,Xi([d]),t)}return t}const k8=te({threshold_:E8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(n,e,t="nearest",i="constant",r=0,o){const s=B(n,"image","transform","float32"),a=B(e,"transforms","transform","float32");F(s.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`),F(a.rank===2&&(a.shape[0]===s.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),F(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:s,transforms:a},c={interpolation:t,fillMode:i,fillValue:r,outputShape:o};return q.runKernel(a0,l,c)}const T8=te({transform_:D8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(n,e,t){const i=B(n,"a","bandPart");F(i.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${i.rank}.`);const r=i.shape,[o,s]=i.shape.slice(-2);let a,l;typeof e=="number"?(F(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),F(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=B(e<0?o:e,"numLower","bandPart")):(F(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=$i(_h(e,0),o,jc(e,o))),typeof t=="number"?(F(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),F(t<=s,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${s}).`),l=B(t<0?s:t,"numUpper","bandPart")):(F(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=$i(_h(t,0),s,jc(t,s)));const c=ee(Kc(0,o,1,"int32"),[-1,1]),u=Kc(0,s,1,"int32"),d=ct(c,u),f=Uo(ec(d,a),Oa(d,In(l))),h=Yn([o,s],i.dtype);return ee(jo(Sa(ee(i,[-1,o,s])).map(p=>$i(f,p,h))),r)}const _8=te({bandPart_:R8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(n){let e;if(Array.isArray(n)){e=!1,F(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)F(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=ar(n,n.shape[0],0).map(r=>cd(r,[0]));F(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],i=n;for(let r=0;r<n.length;++r)t.push(q.tidy(()=>{let o=i[r];if(r>0)for(let s=0;s<r;++s){const a=K(rt(K(t[s],o)),t[s]);o=ct(o,a)}return at(o,Ep(o,"euclidean"))}));return e?jo(t,0):t}const O8=te({gramSchmidt_:A8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P8(n,e=!1){if(F(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return MC(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),i=Sa(ee(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];i.forEach(l=>{const[c,u]=MC(l,e);r.push(c),o.push(u)});const s=ee(jo(r,0),n.shape),a=ee(jo(o,0),n.shape);return[s,a]}}function MC(n,e=!1){return q.tidy(()=>{F(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],i=n.shape[1];let r=$2(t),o=la(n);const s=ch([[1]],[1,1]);let a=la(s);const l=t>=i?i:t;for(let c=0;c<l;++c){const u=o,d=a,f=r;[a,o,r]=q.tidy(()=>{const h=tn(o,[c,c],[t-c,1]),p=Ep(h),m=tn(o,[c,c],[1,1]),g=$i(ur(m,0),ch([[-1]]),ch([[1]])),v=ct(m,K(g,p)),x=at(h,v);x.shape[0]===1?a=la(s):a=Fi([s,tn(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);const b=In(at(Wt(g,v),p)),w=tn(o,[c,0],[t-c,i]),y=K(b,a),C=Pt(a);if(c===0)o=ct(w,Wt(y,Wt(C,w)));else{const E=ct(w,Wt(y,Wt(C,w)));o=Fi([tn(o,[0,0],[c,i]),E],0)}const $=Pt(y),I=tn(r,[0,c],[t,r.shape[1]-c]);if(c===0)r=ct(I,Wt(Wt(I,a),$));else{const E=ct(I,Wt(Wt(I,a),$));r=Fi([tn(r,[0,0],[t,c]),E],1)}return[a,o,r]}),yt([u,d,f])}return!e&&t>i&&(r=tn(r,[0,0],[t,i]),o=tn(o,[0,0],[i,i])),[r,o]})}const M8=te({qr_:P8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bo={flipLeftRight:Q5,grayscaleToRGB:t8,resizeNearestNeighbor:X2,resizeBilinear:K2,rgbToGrayscale:i8,rotateWithOffset:o8,cropAndResize:J5,nonMaxSuppression:a8,nonMaxSuppressionAsync:m8,nonMaxSuppressionWithScore:v8,nonMaxSuppressionWithScoreAsync:b8,nonMaxSuppressionPadded:w8,nonMaxSuppressionPaddedAsync:S8,threshold:k8,transform:T8},F8={bandPart:_8,gramSchmidt:O8,qr:M8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8=new Map,z8=new Map;class nc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class yr{constructor(){this.classNameMap={}}static getMap(){return yr.instance==null&&(yr.instance=new yr),yr.instance}static register(e){yr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ce(n,e,t){F(n.className!=null,()=>"Class being registered does not have the static className property defined."),F(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),F(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const i=t,r=e+">"+i;return yr.register(n),L8.set(r,n),z8.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ps extends nc{minimize(e,t=!1,i){const{value:r,grads:o}=this.computeGradients(e,i);if(i!=null){const s=i.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(s)}else this.applyGradients(o);return yt(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Yj(e,t)}dispose(){this.iterations_!=null&&yt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Gt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ps,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q2 extends Ps{static get className(){return"Adadelta"}constructor(e,t,i=null){super(),this.learningRate=e,this.rho=t,this.epsilon=i,this.accumulatedGrads=[],this.accumulatedUpdates=[],i==null&&(this.epsilon=q.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const o=q.registeredVariables[i],s=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${i}/accum_grad`,variable:ie(()=>Mt(o).variable(s))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${i}/accum_var`,variable:ie(()=>Mt(o).variable(s))});const a=Array.isArray(e)?e[r].tensor:e[i];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;ie(()=>{const u=$e(K(l,this.rho),K(an(a),1-this.rho)),d=K(at(gi($e(c,this.epsilon)),gi($e(l,this.epsilon))),a),f=$e(K(c,this.rho),K(an(d),1-this.rho));l.assign(u),c.assign(f);const h=$e(K(d,-this.learningRate),o);o.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(yt(this.accumulatedGrads.map(e=>e.variable)),yt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,i=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y2 extends Ps{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const o=q.registeredVariables[i];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${i}/accumulator`,variable:ie(()=>Ip(o.shape,this.initialAccumulatorValue).variable(!1))});const s=Array.isArray(e)?e[r].tensor:e[i];if(s==null)return;const a=this.accumulatedGrads[r].variable;ie(()=>{const l=$e(a,an(s));a.assign(l);const c=$e(K(at(s,gi($e(l,q.backend.epsilon()))),-this.learningRate),o);o.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&yt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(i=>({originalName:i.name,variable:i.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J2 extends Ps{static get className(){return"Adam"}constructor(e,t,i,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=i,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ie(()=>{this.accBeta1=Gt(t).variable(),this.accBeta2=Gt(i).variable()}),r==null&&(this.epsilon=q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ie(()=>{const i=ct(1,this.accBeta1),r=ct(1,this.accBeta2);t.forEach((o,s)=>{const a=q.registeredVariables[o],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${o}/m`,variable:ie(()=>Mt(a).variable(l))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${o}/v`,variable:ie(()=>Mt(a).variable(l))});const c=Array.isArray(e)?e[s].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[s].variable,d=this.accumulatedSecondMoment[s].variable,f=$e(K(u,this.beta1),K(c,1-this.beta1)),h=$e(K(d,this.beta2),K(an(c),1-this.beta2)),p=at(f,i),m=at(h,r);u.assign(f),d.assign(h);const g=$e(K(at(p,$e(gi(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(K(this.accBeta1,this.beta1)),this.accBeta2.assign(K(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&yt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&yt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ie(()=>{this.accBeta1.assign(wa(this.beta1,this.iterations_+1)),this.accBeta2.assign(wa(this.beta2,this.iterations_+1))});const t=e.length/2,i=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z2 extends Ps{static get className(){return"Adamax"}constructor(e,t,i,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=i,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ie(()=>{this.iteration=Gt(0).variable(),this.accBeta1=Gt(t).variable()}),r==null&&(this.epsilon=q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ie(()=>{const i=ct(1,this.accBeta1),r=at(-this.learningRate,$e(K(this.iteration,this.decay),1));t.forEach((o,s)=>{const a=q.registeredVariables[o],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${o}/m`,variable:Mt(a).variable(l)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${o}/v`,variable:Mt(a).variable(l)});const c=Array.isArray(e)?e[s].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[s].variable,d=this.accumulatedWeightedInfNorm[s].variable,f=$e(K(u,this.beta1),K(c,1-this.beta1)),h=K(d,this.beta2),p=wi(c),m=As(h,p);u.assign(f),d.assign(m);const g=$e(K(at(r,i),at(f,$e(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign($e(this.iteration,1)),this.accBeta1.assign(K(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&yt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&yt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q0 extends Ps{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const o=Array.isArray(e)?e[r].tensor:e[i];if(o==null)return;const s=q.registeredVariables[i];ie(()=>{const a=$e(K(this.c,o),s);s.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=vo(Gt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q2 extends q0{static get className(){return"Momentum"}constructor(e,t,i=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=i,this.accumulations=[],this.m=Gt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const o=q.registeredVariables[i];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${i}/momentum`,variable:ie(()=>Mt(o).variable(!1))});const s=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[i];a!=null&&ie(()=>{let l;const c=$e(K(this.m,s),a);this.useNesterov?l=$e(K(this.c,$e(a,K(c,this.m))),o):l=$e(K(this.c,c),o),s.assign(c),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&yt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(i=>({originalName:i.name,variable:i.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eN extends Ps{static get className(){return"RMSProp"}constructor(e,t=.9,i=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=i,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=q.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const o=q.registeredVariables[i],s=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${i}/rms`,variable:ie(()=>Mt(o).variable(s))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${i}/momentum`,variable:ie(()=>Mt(o).variable(s))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${i}/mg`,variable:ie(()=>Mt(o).variable(s))});const a=Array.isArray(e)?e[r].tensor:e[i];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;ie(()=>{const u=$e(K(l,this.decay),K(an(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,f=$e(K(d,this.decay),K(a,1-this.decay)),h=at(K(a,this.learningRate),gi(ct(u,$e(an(f),this.epsilon)))),p=$e(K(c,this.momentum),h);l.assign(u),d.assign(f),c.assign(p);const m=ct(o,p);o.assign(m)}else{const d=$e(K(l,this.decay),K(an(a),1-this.decay)),f=$e(K(c,this.momentum),at(K(a,this.learningRate),gi($e(d,this.epsilon))));l.assign(d),c.assign(f);const h=ct(o,f);o.assign(h)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&yt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&yt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&yt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,i=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8=[q2,Y2,J2,Z2,Q2,eN,q0];function V8(){for(const n of B8)Ce(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FC(n,e,t,i){s(n),t=t??0,i=i??1,a(t,i);let r=0;const o=l=>(l.then(c=>{const u=t+ ++r/n.length*(i-t);return e(u),c}),l);function s(l){F(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){F(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),F(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),F(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function W8(n,e){e==null&&(e={});const t=e.fetchFunc==null?ae().platform.fetch:e.fetchFunc,i=n.map(d=>t(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(i):await FC(i,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await FC(a,e.onProgress,.5,1)}function G8(n,e){var t;const i=e.fetchFunc==null?ae().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async s=>{for(var a;r<n.length;){o||(o=(await i(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await o.read();if(l){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}s.enqueue(c);return}s.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8="application/octet-stream",U8="application/json";class Y0{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(F(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ae().platform.fetch,F(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&F(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const i=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=cU(e,i);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:U8}),"model.json"),e.weightData!=null){const s=Ts.join(e.weightData);t.body.append("model.weights.bin",new Blob([s],{type:H8}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:f0(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let s=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?s+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":s+=" Please make sure the server is serving valid JSON for this request.",new Error(s)}const i=t.modelTopology,r=t.weightsManifest;if(i==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return dU(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),i=RC(e.weightsManifest),r=()=>G8(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:i,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[i,r]=j8(t),o=this.weightPathPrefix||i,s=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):s.push(o+c+r);return this.weightUrlConverter&&s.push(...await Promise.all(a)),s}async loadWeights(e){const t=await this.getWeightUrls(e),i=RC(e),r=await W8(t,this.loadOptions);return[i,r]}}Y0.URL_SCHEME_REGEX=/^https?:\/\//;function j8(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),i=n.substring(0,e),r=t>e?n.substring(t):"";return[i+"/",r]}function LC(n){return n.match(Y0.URL_SCHEME_REGEX)!=null}const tN=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(i=>LC(i)):t=LC(n),t)return nN(n,e)}return null};Xn.registerSaveRouter(tN);Xn.registerLoadRouter(tN);function nN(n,e){return new Y0(n,e)}function K8(n,e){return nN(n,e)}function J0(n,e){const t=n.shape.length,i=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[i-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[i-1]} vs. ${t}`);if(he(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let s=1;for(let d=0;d<r.length-1;++d)s*=r[d];const a=n.shape,l=r.slice();l.pop();let c=1;for(let d=o;d<t;++d)c*=a[d],l.push(a[d]);const u=[...Qe(n.shape).map(d=>d/c),1].slice(0,o);return[l,s,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zg=-2,X8=-1;function Z0(n,e,t){const i=n.shape.length;F(i===e.length,()=>`Error in slice${i}D: Length of begin ${e} must match the rank of the array (${i}).`),F(i===t.length,()=>`Error in slice${i}D: Length of size ${t} must match the rank of the array (${i}).`);for(let r=0;r<i;++r)F(e[r]+t[r]<=n.shape[r],()=>`Error in slice${i}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function q8(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Q0(n,e,t){const i=[];for(let r=0;r<n.length;r++)i[r]=Math.ceil((e[r]-n[r])/t[r]);return i}function iN(n,e,t,i){const r=[...n];for(let o=r.length;o<i.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function rN(n,e,t){return t<=n?t:t-(e-1)}function oN(n,e){const t=[];for(let i=0;i<n;i++)t.push(e+i);return t}function Y8(n,e,t,i,r,o,s,a,l){const c=n.length;let u=new Array(c),d=new Array(c),f=new Array(c);if(e.length&&t>0){const h=e[0],p=t+1;u=sN(s,h,p,i,n),d=aN(a,h,p,r,n),f=iN(o,h,p,n)}else for(let h=0;h<c;h++)u[h]=cN(s,i,o,n,h,l),d[h]=uN(a,r,o,n,h,l),f[h]=lN(o,h,l);return{begin:u,end:d,strides:f}}function sN(n,e,t,i,r){const o=[...r],s=oN(t,e);for(let a=0;a<o.length;a++)if(s.indexOf(a)>-1)o[a]=0;else{const l=rN(e,t,a);let c=i[l];n&1<<l&&(c=0),o[a]=c}return o}function aN(n,e,t,i,r){const o=[...r],s=oN(t,e);for(let a=0;a<o.length;a++)if(s.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=rN(e,t,a);let c=i[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),o[a]=c}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=fa(0,o[a],r[a])}return o}function lN(n,e,t){let i=n[e];return(t&1<<e||i==null)&&(i=1),i}function cN(n,e,t,i,r,o){let s=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);const l=i[r];return s<0&&(s+=l),s=fa(0,s,l-1),s}function uN(n,e,t,i,r,o){let s=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);const l=i[r];return s<0&&(s+=l),a>0?s=fa(0,s,l):s=fa(-1,s,l-1),s}function eb(n,e,t){let i=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){i=r;break}for(let r=i+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function tb(n,e){let t=n.length>0?n[n.length-1]:1;for(let i=0;i<n.length-1;i++)t+=n[i]*e[i];return t}function kp(n,e,t){let i;const r=n.shape.length;typeof e=="number"?i=[e,...new Array(r-1).fill(0)]:e.length<r?i=e.concat(new Array(r-e.length).fill(0)):i=e.slice(),i.forEach(s=>{F(s!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((s,a)=>s>=0?s:(F(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),n.shape[a]-i[a])),[i,o]}function nb(n,e,t,i,r,o,s,a,l){let c;if(i==null?(c=new Array(e.length),c.fill(1)):c=i,s!=null&&s&s-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:r,endMask:o,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<d.dims;b++)u&&1<<b&a&&d.numAddAxisAfterEllipsis++,1<<b&s&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};J8(d,f);let h=!0,p=!0,m=!0;const g=[],v=[];for(let b=0;b<n.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);const w=!!(f.shrinkAxisMask&1<<b),y=n[b];if(y===-1){g.push(w?1:-1);continue}const C=[f.beginMask&1<<b,f.endMask&1<<b],$=[f.strides[b]>0?0:-1,f.strides[b]>0?y:y-1];if(w&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&f.strides[b]===1;const I=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(w){const D=f.begin[b]<0?y+f.begin[b]:f.begin[b];if(f.begin[b]=D,f.end[b]=f.begin[b]+1,D<0||D>=y)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=zC(f.begin[b],0,f.strides[b],y,C,$),f.end[b]=zC(f.end[b],1,f.strides[b],y,C,$);const k=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===y;h=h&&k,p=p&&(b===0&&f.strides[b]===1||k)}else h=h&&f.strides[b]===1&&I,p=p&&(b===0&&f.strides[b]===1||I);let E,N=!1;if(f.beginValid&&f.endValid?(E=f.end[b]-f.begin[b],N=!0):w?(E=1,N=!0):I&&y>=0&&(f.strides[b]<0?E=-y:E=y,N=!0),N){let k;E===0||E<0!=f.strides[b]<0?k=0:k=Math.trunc(E/f.strides[b])+(E%f.strides[b]!==0?1:0),g.push(k)}else g.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){const w=f.finalShapeGatherIndices[b];w>=0?v.push(g[w]):w===zg&&v.push(1)}return{finalShapeSparse:v.filter((b,w)=>f.finalShapeGatherIndices[w]!==zg),finalShape:v,isIdentity:h,sliceDim0:p,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function J8(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let i=0;i<n.dims;i++)if(1<<i&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-i)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=i}else if(1<<i&n.newAxisMask)e.finalShapeGatherIndices.push(zg),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[i]),n.end!=null&&(e.end[t]=n.end[i]),e.strides[t]=n.strides[i],n.beginMask&1<<i&&(e.beginMask|=1<<t),n.endMask&1<<i&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<i?(e.finalShapeGatherIndices.push(X8),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(i)),e.inputShapeGatherIndicesSparse[t]=i,t++}}function zC(n,e,t,i,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const s=n<0?i+n:n;return s<o[0]?o[0]:s>o[1]?o[1]:s}}const Z8=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Z0,computeFlatOffset:tb,computeOutShape:Q0,getNormalizedAxes:Y8,isSliceContinous:eb,maskToAxes:q8,parseSliceParams:kp,sliceInfo:nb,startForAxis:cN,startIndicesWithElidedDims:sN,stopForAxis:uN,stopIndicesWithElidedDims:aN,stridesForAxis:lN,stridesWithElidedDims:iN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q8{static sgd(e){return new q0(e)}static momentum(e,t,i=!1){return new Q2(e,t,i)}static rmsprop(e,t=.9,i=0,r=null,o=!1){return new eN(e,t,i,r,o)}static adam(e=.001,t=.9,i=.999,r=null){return new J2(e,t,i,r)}static adadelta(e=.001,t=.95,i=null){return new q2(e,t,i)}static adamax(e=.002,t=.9,i=.999,r=null,o=0){return new Z2(e,t,i,r,o)}static adagrad(e,t=.1){return new Y2(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ka=Q8;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e7=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function dN(){return new Promise(n=>e7(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ib(n,e){const t=n[0].length;n.forEach((r,o)=>{F(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),F(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const i=n[0];n.forEach((r,o)=>{for(let s=0;s<t;s++)F(s===e||r[s]===i[s],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${i}) along the non-concatenated axis ${o}.`)})}function xo(n,e){const t=n[0].slice();for(let i=1;i<n.length;i++)t[e]+=n[i][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Br;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Br||(Br={}));function hN(n,e,t){let i=new Array;if(t==null&&e==null)return i;if(e==null)for(;i.length<n+t.length;)i.push(-1);else i=e.slice();if(t==null)return i;if(n+t.length!==i.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${i.length}`);for(let r=1;r<t.length;++r){const o=t[r],s=i[i.length-t.length+r],a=i[s];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else i[s]=o}return i}function fN(n){const e={FIRST_DIM_SIZE:Br.FIRST_DIM_SIZE,VALUE_ROWIDS:Br.VALUE_ROWIDS,ROW_LENGTHS:Br.ROW_LENGTHS,ROW_SPLITS:Br.ROW_SPLITS,ROW_LIMITS:Br.ROW_LIMITS,ROW_STARTS:Br.ROW_STARTS},t=[];for(const i of n)if(i in e)t.push(e[i]);else break;return t}function pN(n){return n.length===0?0:n[0]===Br.FIRST_DIM_SIZE?n.length-1:n.length}function mN(n,e){if(n==null||e==null)return;const t=n.length,i=e.length;if(t>=i)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${i})`);for(let r=0;r<Math.min(t,i-1);++r){const o=n[r],s=e[r+1];if(o>=0&&s>=0&&o!==1&&o!==s)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${s}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rb=30;function Dp(n){return n<=rb?n:Cg(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ob(n,e,t){const i=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[i,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dd(n,e,t,i=!0){let r=[];if(i)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let s=0;s<o;++s)r=r.concat([n[s+1]/e[s],e[s]]);r=r.concat(n.slice(o+1))}return r}function hd(n,e,t=!0){const i=[];if(t){i.push(e);for(let r=e+1;r<n;++r)r<=2*e?(i.push(r),i.push(r-(e+1))):i.push(r)}else{const r=[],o=[];for(let s=1;s<n;++s)s>=e*2+1||s%2===1?o.push(s):r.push(s);i.push(...r),i.push(0),i.push(...o)}return i}function fd(n,e,t,i=!0){const r=[];i?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?i?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function sb(n,e){const t=[0];for(let i=0;i<e;++i)t.push(n[i][0]);return t}function ab(n,e,t){const i=n.slice(0,1);for(let r=0;r<t;++r)i.push(n[r+1]-e[r][0]-e[r][1]);return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tp=1.7580993408473768,Rp=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lb=.3275911,cb=.254829592,ub=-.284496736,db=1.421413741,hb=-1.453152027,fb=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ko(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let i=0;i<t.length;i+=2)t[i]=n[i/2],t[i+1]=e[i/2];return t}function gN(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let i=0;i<n.length;i+=2)e[i/2]=n[i],t[i/2]=n[i+1];return{real:e,imag:t}}function vN(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),i=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],i[Math.floor(r/4)]=n[r+1];return{real:t,imag:i}}function xN(n){const e=Math.floor(n.length/4),t=new Float32Array(e),i=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],i[Math.floor(r/4)]=n[r+1];return{real:t,imag:i}}function pb(n,e){const t=n[e*2],i=n[e*2+1];return{real:t,imag:i}}function bN(n,e,t,i){n[i*2]=e,n[i*2+1]=t}function yN(n,e){const t=new Float32Array(n/2),i=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),i[r]=Math.sin(o)}return{real:t,imag:i}}function wN(n,e,t){const i=(t?2:-2)*Math.PI*(n/e),r=Math.cos(i),o=Math.sin(i);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $m="->",t7=/->/g,BC=",",VC="...";function mb(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(t7,"").length)/$m.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${$m}").`);const[i,r]=n.split($m);F(i.indexOf(VC)===-1,()=>`The ellipsis notation ("${VC}") is not supported yet.`);const o=i.split(BC),s=o.length;if(e!==s)throw new Error(`Expected ${s} input tensors, received ${e}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<r.length;++f){const h=r[f];if(!o.some(p=>p.indexOf(h)!==-1))throw new Error(`Output subscripts contain the label ${h} not present in the input subscripts.`);a.indexOf(h)===-1&&a.push(h)}for(let f=0;f<i.length;++f){const h=i[f];a.indexOf(h)===-1&&h!==BC&&a.push(h)}const l=new Array(o.length);for(let f=0;f<s;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let h=0;h<o[f].length;++h)l[f].push(a.indexOf(o[f][h]))}const c=a.length,u=r.length,d=[];for(let f=u;f<c;++f)d.push(f);return{allDims:a,summedDims:d,idDims:l}}function gb(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const i=[];for(let r=0;r<n;++r)t[r]===-1&&i.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:i}}function vb(n,e,t){const i=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let s=0;s<e[r].length;++s)i[e[r][s]]===void 0?i[e[r][s]]=o[s]:F(i[e[r][s]]===o[s],()=>`Expected dimension ${i[e[r][s]]} at axis ${s} of input shaped ${JSON.stringify(o)}, but got dimension ${o[s]}`)}}function xb(n,e){const t=n,i=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let s=0;s<r;++s)i.push([]);const o=[];for(let s=0;s<t.length;++s){const a=t[s],l=n7(e,a);for(const c of l)o.indexOf(c)===-1&&(i[s].push(c),o.push(c))}return{path:t,steps:i}}function bb(n){return n.every((e,t)=>e===t)}function n7(n,e){const t=[];for(let i=0;i<n.length;++i)(n[i].length===0||n[i].indexOf(e)!==-1||e===-1)&&t.push(i);return t}function yb(n,e,t=0){let i=[];if(typeof e=="number")F(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),i=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((s,a)=>(a===-1&&(s+=1),s),0);F(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const s=e.reduce((a,l)=>l>0?a+l:a);e[o]=n.shape[t]-s}F(n.shape[t]===e.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),i=e}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CN(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function SN(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function IN(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function EN(n,e){return`size ${n} must be non-negative, not ${e}`}function NN(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function kN(n,e){const t=he(n),i=he(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${i}. inputShape=${n} outputShape= ${e}`}function DN(n,e){const t=he(n),i=he(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${i}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bg(){return"segment ids must be >= 0"}function TN(){return"segment ids are not increasing"}function RN(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function _N(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AN(n,e){let t=!1,i;for(n<=rb?(i=n,t=!0):i=Cg(n,Math.floor(Math.sqrt(n)));!t;)i>e||i===n?t=!0:i=Cg(n,i+1);return i}function ON(n,e,t){const i=[],r=n.length;for(let o=0;o<r;o++)o!==e?i.push(n[o]):i.push(t);return i}function wb(n,e,t,i){const r=e.shape.length,o=n.shape.length;if(i!==0&&(i<-r||i>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${i}`);if(i<0&&(i+=r),i>o)throw new Error(`batchDims (${i}) must be less than rank(x) (
    ${o}).`);if(t<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${t}).`);for(let d=0;d<i;++d)if(n.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const s=n.shape[t],a=[];let l=1,c=1,u=1;for(let d=0;d<i;++d)a.push(n.shape[d]),l*=n.shape[d];for(let d=i;d<t;d++)a.push(n.shape[d]),c*=n.shape[d];for(let d=i;d<r;d++)a.push(e.shape[d]);for(let d=t+1;d<o;d++)a.push(n.shape[d]),u*=n.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}const i7=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:wb,computeOutShape:ON,segOpComputeOptimalWindowSize:AN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(n){try{return n.map(e=>ws(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function PN(n){return n.map(e=>ps(e))}const r7=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:cb,ERF_A2:ub,ERF_A3:db,ERF_A4:hb,ERF_A5:fb,ERF_P:lb,PARALLELIZE_THRESHOLD:rb,get RowPartitionType(){return Br},SELU_SCALE:Rp,SELU_SCALEALPHA:Tp,applyActivation:G0,assertAndGetBroadcastShape:vt,assertAxesAreInnerMostDims:ii,assertParamsConsistent:ib,assignToTypedArray:bN,axesAreInnerMostDims:y0,calculateShapes:Fa,checkEinsumDimSizes:vb,checkPadOnDimRoundingMode:Vi,combineLocations:S2,combineRaggedTensorToTensorShapes:hN,complexWithEvenIndex:vN,complexWithOddIndex:xN,computeConv2DInfo:ni,computeConv3DInfo:Rs,computeDefaultPad:p0,computeDilation2DInfo:sd,computeOptimalWindowSize:Dp,computeOutAndReduceShapes:Zn,computeOutShape:xo,computePool2DInfo:_r,computePool3DInfo:Qo,convertConv2DDataFormat:es,decodeEinsumEquation:mb,eitherStridesOrDilationsAreOne:vi,expandShapeToKeepDim:Pn,exponent:wN,exponents:yN,fromStringArrayToUint8:PN,fromUint8ToStringArray:Xo,getAxesPermutation:xn,getBroadcastDims:_l,getComplexWithIndex:pb,getEinsumComputePath:xb,getEinsumPermutation:gb,getFusedBiasGradient:W0,getFusedDyActivation:V0,getImageCenter:ob,getInnerMostAxes:Dn,getPermuted:hd,getRaggedRank:pN,getReductionAxes:Gn,getReshaped:dd,getReshapedPermuted:fd,getRowPartitionTypesHelper:fN,getSliceBeginCoords:sb,getSliceSize:ab,getSparseFillEmptyRowsIndicesDenseShapeMismatch:CN,getSparseFillEmptyRowsNegativeIndexErrorMessage:SN,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:IN,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:NN,getSparseReshapeInputOutputMismatchErrorMessage:DN,getSparseReshapeInputOutputMultipleErrorMessage:kN,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:$N,getSparseReshapeNegativeOutputDimErrorMessage:EN,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:_N,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Bg,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:TN,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:RN,getUndoAxesPermutation:_s,isIdentityPermutation:bb,log:NH,mergeRealAndImagArrays:Ko,prepareAndValidate:J0,prepareSplitSize:yb,segment_util:i7,shouldFuse:H0,slice_util:Z8,splitRealAndImagArrays:gN,stridesOrDilationsArePositive:ba,tupleValuesAreOne:xa,upcastType:Zi,validateDefaultValueShape:mN,validateInput:D5,validateUpdateShape:G2,warn:rr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */V8();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN={kernelName:bf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,ud(Pe(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7={kernelName:du,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const i=an(Pe(t,"float32")),r=gi(ct(Gt(1),i));return In(at(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7={kernelName:hu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const i=gi(ct(an(Pe(t,"float32")),1));return at(n,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a7={kernelName:Zl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{let a=n;const l=Gn(t.shape,r);return l.length>0&&(a=rt(a,l)),ee(a,t.shape)},b:()=>{let a=n;const l=Gn(i.shape,r);return l.length>0&&(a=rt(a,l)),ee(a,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l7={kernelName:Sx,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((i,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7={kernelName:yf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Mt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u7={kernelName:wf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Mt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7={kernelName:fu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,gi(ct(Gt(1),an(Pe(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h7={kernelName:pu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const i=gi($e(Gt(1),an(Pe(t,"float32"))));return at(n,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f7={kernelName:vu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{const a=$e(an(t),an(i));let l=K(n,at(i,a));const c=Gn(t.shape,r);return c.length>0&&(l=rt(l,c)),ee(l,t.shape)},b:()=>{const a=$e(an(t),an(i));let l=In(K(n,at(t,a)));const c=Gn(i.shape,r);return c.length>0&&(l=rt(l,c)),ee(l,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7={kernelName:mu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,$e(an(Pe(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7={kernelName:gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,ct(Gt(1),an(Pe(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(n,e,t,i,r,o){const s=B(n,"dy","avgPool3dGrad"),a=B(e,"input","avgPool3dGrad");let l=s,c=a,u=!1;a.rank===4&&(u=!0,l=ee(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),F(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Vi("avgPool3dGrad",r,o);const d={dy:l,input:c},f={filterSize:t,strides:i,pad:r,dimRoundingMode:o},h=q.runKernel(Nx,d,f);return u?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const v7=te({avgPool3dGrad_:g7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7={kernelName:Sf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{filterSize:r,strides:o,pad:s,dimRoundingMode:a}=t;return{x:()=>v7(n,i,r,o,s,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n,e,t,i,r){const o=B(n,"dy","avgPoolGrad"),s=B(e,"input","avgPoolGrad");F(s.rank===o.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${o.rank})`);let a=s,l=o,c=!1;s.rank===3&&(c=!0,a=ee(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]])),F(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),F(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:t,strides:i,pad:r},f=q.runKernel(Ex,u,d);return c?ee(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const y7=te({avgPoolGrad_:b7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7={kernelName:Cf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{filterSize:r,strides:o,pad:s}=t;return{x:()=>y7(n,i,r,o,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7={kernelName:If,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[i,r]=e,{transposeA:o,transposeB:s}=t;return!o&&!s?{a:()=>Wt(n,r,!1,!0),b:()=>Wt(i,n,!0,!1)}:!o&&s?{a:()=>Wt(n,r,!1,!1),b:()=>Wt(n,i,!0,!1)}:o&&!s?{a:()=>Wt(r,n,!1,!0),b:()=>Wt(i,n,!1,!1)}:{a:()=>Wt(r,n,!0,!0),b:()=>Wt(n,i,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7={kernelName:$f,gradFunc:(n,e,t)=>{const{blockShape:i,crops:r}=t;return{x:()=>k0(n,i,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7={kernelName:SH,gradFunc:(n,e,t)=>{const i=t,r=i.inputShape,o=i.shape,s=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])s[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>rt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7={kernelName:xu,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7={kernelName:bu,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7={kernelName:yu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>$i(Uo(Oa(i,r),ec(i,o)),n,Mt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7={kernelName:Ef,inputsToSave:["x"],gradFunc:MN.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7={kernelName:Nf,saveAllInputs:!0,gradFunc:(n,e,t)=>{const i=e.map(l=>l.shape),{axis:r}=t,o=Ct(r,e[0].shape)[0],s=i.map(l=>l[o]);return ar(n,s,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7={kernelName:kf,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[i,r]=e,{dilations:o,strides:s,pad:a,dataFormat:l}=t;return F(xa(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>v0(i.shape,n,r,s,a,l),filter:()=>B0(i,n,r.shape,s,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7={kernelName:Df,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[i,r]=e,{strides:o,pad:s,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>ya(n,r,o,s,a,1,l),filter:()=>B0(n,i,r.shape,o,s,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n,e,t,i,r){let o=n;n.rank===4&&(o=ee(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let s=e;s.rank===4&&(s=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),F(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),F(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),F(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),F(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),F(s.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:s},l={strides:i,pad:r,filterShape:t};return q.runKernel(_x,a,l)}const A7=te({conv3DBackpropFilter_:_7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7={kernelName:Tf,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:i,strides:r,pad:o}=t;F(xa(i),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const[s,a]=e;return{x:()=>b2(s.shape,n,a,r,o),filter:()=>A7(s,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7={kernelName:wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(In(z2(Pe(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7={kernelName:Cu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(B2(Pe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7={kernelName:Rf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{axis:r,exclusive:o,reverse:s}=t;return{x:()=>{const a=xn([r],i.rank);let l=w2(n,r,o,!s);return a!=null&&(l=Pt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7={kernelName:_f,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:i,strides:r,pad:o,dimRoundingMode:s}=t,a=i??[1,1];F(xa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return F(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),F(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),F(vi(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Vi("depthwiseConv2d",o,s),{x:()=>X5(l.shape,n,c,r,o,a,s),filter:()=>j5(l,n,c.shape,r,o,a,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7={kernelName:Af,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[i,r]=e,o={x:i,filter:r,dy:n},s={x:i,filter:r,dy:n};return{x:()=>q.runKernel(Sg,o,t),filter:()=>q.runKernel(Ig,s,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7={kernelName:Iu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,i={dy:n,y:t};return{x:()=>q.runKernel(Vx,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7={kernelName:$u,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,i=K($o(In(an(t))),2/Math.sqrt(Math.PI));return{x:()=>K(n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7={kernelName:Eu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7={kernelName:Pf,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7={kernelName:Nu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,$o(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7={kernelName:ku,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7={kernelName:Du,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{const a=at(n,Pe(i,"float32")),l=Gn(t.shape,r);return l.length>0?ee(rt(a,l),t.shape):a},b:()=>{let a=K(n,Pe(t,"float32"));const l=Gn(i.shape,r);l.length>0&&(a=ee(rt(a,l),i.shape));const c=an(i);return In(at(a,Pe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7={kernelName:Mf,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:i}=t,[r,o,s,a]=e,l=a??Gt(1),c=Gn(o.shape,r.shape),u=[];if(o.rank===1){for(let w=0;w<r.shape.length-1;++w)u.push(r.shape[w]);u.push(1)}const d=ct(r,o),f=K(n,l),h=M2($e(s,Gt(i))),p=K(K(K(h,h),h),Gt(-.5));return{x:()=>o.rank===1?ee(K(K(n,Vr(ee(h,[1,1,1,o.shape[0]]),u)),l),r.shape):ee(K(K(n,h),l),r.shape),mean:()=>{let w=K(K(h,Gt(-1)),f);return o.rank===1&&(w=rt(w,c)),ee(w,o.shape)},variance:()=>{let w=K(K(p,d),f);return o.rank===1&&(w=rt(w,c)),ee(w,o.shape)},scale:()=>{const w=K(d,h);let y=K(n,w);return o.rank===1&&(y=rt(y,c)),ee(y,o.shape)},offset:()=>{let w=n;return o.rank===1&&(w=rt(w,c)),ee(w,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7={kernelName:Ff,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[i,r]=e,{axis:o,batchDims:s}=t,a=Ct(o,i.shape)[0],l=(c,u,d)=>()=>{const f=c.shape,h=u.size,p=f.slice(0,a),m=p.length,g=f.slice(o,f.length).slice(1),v=g.length,x=WC(0,m),b=WC(m+1,m+1+v),w=GC([p,[h],g]),y=ee(d,w),C=ee(u,[h]),$=GC([[m],x,b]),I=Pt(y,$);let E=U2(I,C,c.shape[a]);const N=_s($);return E=Pt(E,N),E};if(s===1){const c=i.shape[0],u=i.split(c,0);return{x:()=>jo(u.map((h,p)=>l(h,r.slice(p,1),n.slice(p,1))())).reshape(i.shape),indices:()=>r}}else return{x:l(i,r,n),indices:()=>r}}};function WC(n,e){const t=[];for(let i=n;i<e;++i)t.push(i);return t}function GC(n){const e=[];for(let t=0;t<n.length;++t)for(let i=0;i<n[t].length;++i)e.push(n[t][i]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7={kernelName:Tu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e;return{a:()=>Mt(t),b:()=>Mt(i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7={kernelName:Ru,gradFunc:n=>({x:()=>Pe(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7={kernelName:_u,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7={kernelName:Au,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7={kernelName:Ou,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX={kernelName:zf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{alpha:r}=t,o=ur(i,0);return{x:()=>$i(o,n,K(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX={kernelName:Mu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,$e(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX={kernelName:Pu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,Pe(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX={kernelName:$H,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[i]=e,{axis:r}=t;return{logits:()=>{const s=$o(i);return ct(n,K(rt(n,r,!0),s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(n,e,t,i=5,r=1,o=1,s=.5){const a={x:n,y:e,dy:t},l={depthRadius:i,bias:r,alpha:o,beta:s};return q.runKernel(Kx,a,l)}const oX=te({localResponseNormalizationBackprop_:rX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX={kernelName:Uf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[i,r]=e,{depthRadius:o,bias:s,alpha:a,beta:l}=t;return{x:()=>oX(i,r,n,o,s,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FN(n,e,t,i){return e.rank<t.rank&&(e=ee(e,Pn(e.shape,i))),n.rank<t.rank&&(n=ee(n,Pn(n.shape,i))),{x:()=>K(n,Pe(Io(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HC={kernelName:jf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const i=t,{reductionIndices:r}=i,o=e[0],s=e[1],a=Ct(r,o.shape),l=FN(n,s,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aX={kernelName:Fu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e;return{a:()=>K(n,Pe(Oa(t,i),"float32")),b:()=>K(n,Pe(_h(t,i),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(n,e,t,i,r,o,s){const a=B(n,"dy","maxPool3dGrad"),l=B(e,"input","maxPool3dGrad"),c=B(t,"output","maxPool3dGrad");let u=a,d=l,f=c,h=!1;l.rank===4&&(h=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=ee(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=ee(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),F(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),F(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),F(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),Vi("maxPool3dGrad",o,s);const p={dy:u,input:d,output:f},m={filterSize:i,strides:r,pad:o,dimRoundingMode:s},g=q.runKernel(qx,p,m);return h?ee(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const cX=te({maxPool3dGrad_:lX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX={kernelName:Xf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[i,r]=e,{filterSize:o,strides:s,pad:a,dimRoundingMode:l}=t;return{x:()=>cX(n,i,r,o,s,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n,e,t,i,r,o,s){const a=B(n,"dy","maxPoolGrad"),l=B(e,"input","maxPoolGrad"),c=B(t,"output","maxPoolGrad");F(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),F(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),F(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Vi("maxPoolGrad",o,s);const u={dy:a,input:l,output:c},d={filterSize:i,strides:r,pad:o,dimRoundingMode:s};return q.runKernel(Xx,u,d)}const hX=te({maxPoolGrad_:dX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX={kernelName:Kf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[i,r]=e,{filterSize:o,strides:s,pad:a}=t;return{x:()=>hX(n,i,r,o,s,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX={kernelName:qf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{axis:r}=t,o=Ct(r,i.shape),a=Zn(i.shape,o)[1],l=he(a);return{x:()=>{const u=i.shape.slice();o.forEach(h=>{u[h]=1});const d=ee(n,u);return at(K(d,Os(i.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX={kernelName:Yf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const i=t,{axis:r}=i,[o,s]=e,a=Ct(r,o.shape),l=FN(n,s,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gX={kernelName:Lu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e;return{a:()=>K(n,Pe(ec(t,i),"float32")),b:()=>K(n,Pe(ur(t,i),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX={kernelName:Jf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const i=e[0],{paddings:r}=t,o=r.map(s=>s[0]);return{x:()=>tn(n,o,i.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX={kernelName:zu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{const a=Gn(t.shape,r);return a.length>0?ee(rt(n,a),t.shape):n},b:()=>{const a=K(n,In(Np(at(t,i)))),l=Gn(i.shape,r);return l.length>0?ee(rt(a,l),i.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bX={kernelName:Bu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{const a=K(n,Pe(i,"float32")),l=Gn(t.shape,r);return l.length>0?ee(rt(a,l),t.shape):a},b:()=>{const a=K(n,Pe(t,"float32")),l=Gn(i.shape,r);return l.length>0?ee(rt(a,l),i.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yX={kernelName:Zf,gradFunc:n=>({x:()=>In(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX={kernelName:tp,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Yn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX={kernelName:ep,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX={kernelName:np,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:i}=t;return Sa(n,i).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC={kernelName:ip,inputsToSave:["x"],gradFunc:(n,e,t)=>{const i=e[0],{paddings:r}=t,o=r.map(s=>s[0]);return{x:()=>tn(n,o,i.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IX={kernelName:Vu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,i,r]=e,o=t,s=i,a=vt(o.shape,s.shape);return{a:()=>{const u=Pe(s,"float32");let d=K(n,K(u,wa(o,ct(u,Gt(1)))));const f=Gn(o.shape,a);return f.length>0&&(d=rt(d,f)),ee(d,o.shape)},b:()=>{const u=ur(o,0),d=$i(u,Eo(o),Mt(o));let f=K(n,K(r,d));const h=Gn(s.shape,a);return h.length>0&&(f=rt(f,h)),ee(f,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $X={kernelName:rp,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,i]=e,r=ur(t,0);return{x:()=>$i(r,n,K(n,i)),alpha:()=>{let o=$i(r,Mt(n),K(n,t));const s=Gn(i.shape,n.shape);return s.length>0&&(o=rt(o,s)),ee(o,i.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(n,e,t){const i=n.shape.slice();i[t]=1;const r=ee(e,i),o=Fg(n,t,!0,!1),s=Fg(n,t,!0,!0),a=K(o,s);return K(r,a)}function NX(n,e,t){const i=n.shape.length,r=i-t.length,o=xn(t,i);let s=n;o!=null&&(s=Pt(n,o));const a=s.shape.slice(),c=a.splice(i-t.length,t.length).reduce((f,h)=>f*h,1);a.push(c);const u=s.reshape(a);let d=EX(u,e,r);if(d=d.reshape(s.shape),o!=null){const f=_s(o);d=Pt(d,f)}return d}const kX={kernelName:op,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{axis:r}=t;let o=[];return r==null?o=i.shape.map((s,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>NX(i,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DX={kernelName:Su,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{const a=at(n,Pe(i,"float32")),l=Gn(t.shape,r);return l.length>0?ee(rt(a,l),t.shape):a},b:()=>{let a=K(n,Pe(t,"float32"));const l=Gn(i.shape,r);l.length>0&&(a=ee(rt(a,l),i.shape));const c=an(i);return In(at(a,Pe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX={kernelName:Wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,In(an(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX={kernelName:Hu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,i=K(ec(t,6),ud(t));return{x:()=>K(n,Pe(i,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X={kernelName:Gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,Pe(ud(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX={kernelName:sp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OX={kernelName:lp,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[i]=e,r={dy:n,images:i};return{images:()=>q.runKernel(n0,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX={kernelName:ap,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[i]=e,r={dy:n,images:i};return{images:()=>q.runKernel(t0,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MX={kernelName:cp,gradFunc:(n,e,t)=>{const{dims:i}=t,r=Ct(i,n.shape);return{x:()=>Ca(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX={kernelName:Uu,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LX={kernelName:ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>In(at(n,K(wa(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX={kernelName:up,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Pe(Mt(t),"float32"),t:()=>K(n,Pe(t,n.dtype)),e:()=>K(n,Pe(I0(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BX={kernelName:Ku,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const i=ur(t,Gt(0)),r=Gt(Tp),o=Gt(Rp),s=K(n,o),a=K(K(n,r),$o(Pe(t,"float32")));return $i(i,s,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VX={kernelName:Ju,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,K(t,ct(Gt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WX={kernelName:Yu,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GX={kernelName:Xu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(x0(Pe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HX={kernelName:qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(y2(Pe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UX={kernelName:dp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{begin:r,size:o}=t,s=i.shape,[a,l]=kp(i,r,o),c=[];for(let u=0;u<n.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>N0(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jX={kernelName:mp,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[i]=e,{dim:r}=t,o=!0,s=K(n,i);return{logits:()=>ct(s,K(rt(s,[r],o),i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KX={kernelName:Zu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,Ql(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jC={kernelName:fp,gradFunc:(n,e,t)=>{const{blockShape:i,paddings:r}=t;return{x:()=>g0(n,i,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KC={kernelName:pp,gradFunc:(n,e,t)=>{const{axis:i}=t;return{x:()=>Fi(n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XX={kernelName:Qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,K(gi(Pe(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qX={kernelName:i0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,K(Pe(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YX={kernelName:ed,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=Gt(2);return{a:()=>K(n,K(r,ct(t,i))),b:()=>K(n,K(r,ct(i,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX={kernelName:od,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZX={kernelName:td,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,i]=e,r=vt(t.shape,i.shape);return{a:()=>{let a=n;const l=Gn(t.shape,r);return l.length>0&&(a=rt(a,l)),ee(a,t.shape)},b:()=>{let a=n;const l=Gn(i.shape,r);return l.length>0&&(a=rt(a,l)),ee(In(a),i.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QX={kernelName:hp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,r=i.shape.slice(),{axis:o}=t;Ct(o,i.shape).forEach(c=>{r[c]=1});const a=ee(n,r),l=K(a,Os(i.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eq={kernelName:nd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>at(n,an(x0(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tq={kernelName:id,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(ct(Gt(1),an(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nq={kernelName:rd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[i]=e,{reps:r}=t;return{x:()=>{let s=Mt(i);if(i.rank===1)for(let a=0;a<r[0];++a)s=$e(s,tn(n,[a*i.shape[0]],[i.shape[0]]));else if(i.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)s=$e(s,tn(n,[a*i.shape[0],l*i.shape[1]],[i.shape[0],i.shape[1]]));else if(i.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)s=$e(s,tn(n,[a*i.shape[0],l*i.shape[1],c*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else if(i.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let u=0;u<r[3];++u)s=$e(s,tn(n,[a*i.shape[0],l*i.shape[1],c*i.shape[2],u*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);return s}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iq={kernelName:ll,gradFunc:(n,e,t)=>{const i=t,{perm:r}=i,o=_s(r);return{x:()=>Pt(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rq={kernelName:gp,gradFunc:(n,e,t)=>{const i=t,{axis:r}=i;return{value:()=>jo(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq={kernelName:vp,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>sq(n,t)}}};function sq(n,e){const t=As(e,Mt(e)),i=w0(n,t);let r=Oa(e,Gt(0,"int32"));const o=i.rank-r.rank;for(let a=0;a<o;++a)r=Ai(r,a+1);r=Uo(r,Os(i.shape,"bool"));const s=Mt(i);return $i(r,i,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aq={kernelName:xp,gradFunc:n=>({x:()=>Mt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq=[MN,o7,s7,a7,l7,c7,u7,d7,h7,f7,p7,m7,x7,w7,C7,S7,I7,$7,E7,N7,k7,D7,R7,T7,O7,P7,M7,F7,L7,z7,DX,B7,V7,W7,G7,H7,j7,U7,K7,X7,q7,Y7,J7,Z7,Q7,eX,tX,nX,iX,sX,HC,HC,aX,uX,fX,pX,mX,gX,vX,xX,bX,yX,wX,CX,SX,UC,UC,IX,$X,kX,TX,RX,_X,AX,OX,PX,MX,FX,LX,zX,BX,VX,WX,GX,HX,UX,jX,KX,jC,jC,KC,KC,XX,YX,qX,JX,ZX,QX,eq,tq,nq,iq,rq,oq,aq];for(const n of lq)kH(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.abs=function(){return this.throwIfDisposed(),wi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.acos=function(){return this.throwIfDisposed(),WU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.acosh=function(){return this.throwIfDisposed(),HU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.add=function(n){return this.throwIfDisposed(),$e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.all=function(n,e){return this.throwIfDisposed(),g2(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.any=function(n,e){return this.throwIfDisposed(),Pg(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.argMax=function(n){return this.throwIfDisposed(),Gc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.argMin=function(n){return this.throwIfDisposed(),qU(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asScalar=function(){return this.throwIfDisposed(),F(this.size===1,()=>"The array must have only 1 element."),ee(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asType=function(n){return this.throwIfDisposed(),Pe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as1D=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as2D=function(n,e){return this.throwIfDisposed(),ee(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ee(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as4D=function(n,e,t,i){return this.throwIfDisposed(),ee(this,[n,e,t,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as5D=function(n,e,t,i,r){return this.throwIfDisposed(),ee(this,[n,e,t,i,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asin=function(){return this.throwIfDisposed(),JU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asinh=function(){return this.throwIfDisposed(),QU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atan=function(){return this.throwIfDisposed(),t6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atan2=function(n){return this.throwIfDisposed(),i6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atanh=function(){return this.throwIfDisposed(),o6(this)};de().prototype.avgPool=function(n,e,t,i){return this.throwIfDisposed(),m0(this,n,e,t,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),g0(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.batchNorm=function(n,e,t,i,r){return this.throwIfDisposed(),Sp(this,n,e,t,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Ac(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cast=function(n){return this.throwIfDisposed(),Pe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.ceil=function(){return this.throwIfDisposed(),_6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),cr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Ln&&(n=[n]),Fi([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv1d=function(n,e,t,i,r,o){return this.throwIfDisposed(),v2(this,n,e,t,i,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv2dTranspose=function(n,e,t,i,r){return this.throwIfDisposed(),x2(this,n,e,t,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv2d=function(n,e,t,i,r,o){return this.throwIfDisposed(),ya(this,n,e,t,i,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cos=function(){return this.throwIfDisposed(),x0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cosh=function(){return this.throwIfDisposed(),y2(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Fg(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),w2(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),ij(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.depthwiseConv2d=function(n,e,t,i,r,o){return this.throwIfDisposed(),b0(this,n,e,t,i,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.dilation2d=function(n,e,t,i,r){return this.throwIfDisposed(),sj(this,n,e,t,i,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.divNoNan=function(n){return this.throwIfDisposed(),dj(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.div=function(n){return this.throwIfDisposed(),at(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.dot=function(n){return this.throwIfDisposed(),fj(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.elu=function(){return this.throwIfDisposed(),$p(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.equal=function(n){return this.throwIfDisposed(),Io(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.erf=function(){return this.throwIfDisposed(),C2(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),$j(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.exp=function(){return this.throwIfDisposed(),$o(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.expandDims=function(n){return this.throwIfDisposed(),Ai(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.expm1=function(){return this.throwIfDisposed(),Dj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.fft=function(){return this.throwIfDisposed(),W2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.flatten=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.floor=function(){return this.throwIfDisposed(),Np(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.floorDiv=function(n){return this.throwIfDisposed(),m2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.gather=function(n,e,t){return this.throwIfDisposed(),w0(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Oa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.greater=function(n){return this.throwIfDisposed(),ur(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.ifft=function(){return this.throwIfDisposed(),Lg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.irfft=function(){return this.throwIfDisposed(),g5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isFinite=function(){return this.throwIfDisposed(),Lj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isInf=function(){return this.throwIfDisposed(),Bj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isNaN=function(){return this.throwIfDisposed(),Wj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.leakyRelu=function(n){return this.throwIfDisposed(),S0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.lessEqual=function(n){return this.throwIfDisposed(),ec(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.less=function(n){return this.throwIfDisposed(),_h(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.localResponseNormalization=function(n,e,t,i){return this.throwIfDisposed(),Kj(this,n,e,t,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSigmoid=function(){return this.throwIfDisposed(),eK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSoftmax=function(n){return this.throwIfDisposed(),N2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),k2(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.log=function(){return this.throwIfDisposed(),Eo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.log1p=function(){return this.throwIfDisposed(),E2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Uo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalNot=function(){return this.throwIfDisposed(),I0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalOr=function(n){return this.throwIfDisposed(),D2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalXor=function(n){return this.throwIfDisposed(),lK(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Wt(this,n,e,t)};de().prototype.maxPool=function(n,e,t,i){return this.throwIfDisposed(),$0(this,n,e,t,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.max=function(n,e){return this.throwIfDisposed(),Gr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.maximum=function(n){return this.throwIfDisposed(),As(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mean=function(n,e){return this.throwIfDisposed(),On(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.min=function(n,e){return this.throwIfDisposed(),Rh(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.minimum=function(n){return this.throwIfDisposed(),jc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),gK(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mod=function(n){return this.throwIfDisposed(),xK(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mul=function(n){return this.throwIfDisposed(),K(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.neg=function(){return this.throwIfDisposed(),In(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Ep(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.notEqual=function(n){return this.throwIfDisposed(),Ah(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),T2(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.onesLike=function(){return this.throwIfDisposed(),Dr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.pad=function(n,e){return this.throwIfDisposed(),N0(this,n,e)};de().prototype.pool=function(n,e,t,i,r,o){return this.throwIfDisposed(),kK(this,n,e,t,i,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.pow=function(n){return this.throwIfDisposed(),wa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.prelu=function(n){return this.throwIfDisposed(),D0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.prod=function(n,e){return this.throwIfDisposed(),RK(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reciprocal=function(){return this.throwIfDisposed(),YK(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.relu=function(){return this.throwIfDisposed(),Ma(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.relu6=function(){return this.throwIfDisposed(),O2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ee(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reshape=function(n){return this.throwIfDisposed(),ee(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),K2(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),X2(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reverse=function(n){return this.throwIfDisposed(),Ca(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.rfft=function(){return this.throwIfDisposed(),b5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.round=function(){return this.throwIfDisposed(),P2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.rsqrt=function(){return this.throwIfDisposed(),M2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.selu=function(){return this.throwIfDisposed(),F2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.separableConv2d=function(n,e,t,i,r,o){return this.throwIfDisposed(),L2(this,n,e,t,i,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sigmoid=function(){return this.throwIfDisposed(),Ql(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sign=function(){return this.throwIfDisposed(),o5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sin=function(){return this.throwIfDisposed(),z2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sinh=function(){return this.throwIfDisposed(),B2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.slice=function(n,e){return this.throwIfDisposed(),tn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.softmax=function(n){return this.throwIfDisposed(),z0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.softplus=function(){return this.throwIfDisposed(),ad(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),k0(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.split=function(n,e){return this.throwIfDisposed(),ar(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sqrt=function(){return this.throwIfDisposed(),gi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.square=function(){return this.throwIfDisposed(),an(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.squaredDifference=function(n){return this.throwIfDisposed(),w5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.squeeze=function(n){return this.throwIfDisposed(),cd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Ln?[this,n]:[this,...n];return jo(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.step=function(n){return this.throwIfDisposed(),ud(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.stridedSlice=function(n,e,t,i,r,o,s,a){return this.throwIfDisposed(),E5(this,n,e,t,i,r,o,s,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sub=function(n){return this.throwIfDisposed(),ct(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sum=function(n,e){return this.throwIfDisposed(),rt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tan=function(){return this.throwIfDisposed(),k5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tanh=function(){return this.throwIfDisposed(),Cp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tile=function(n){return this.throwIfDisposed(),Vr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toBool=function(){return this.throwIfDisposed(),Pe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toFloat=function(){return this.throwIfDisposed(),Pe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toInt=function(){return this.throwIfDisposed(),Pe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.topk=function(n,e){return this.throwIfDisposed(),R5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.transpose=function(n){return this.throwIfDisposed(),Pt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unique=function(n){return this.throwIfDisposed(),O5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),U2(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unstack=function(n){return this.throwIfDisposed(),Sa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.where=function(n,e){return this.throwIfDisposed(),$i(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.zerosLike=function(){return this.throwIfDisposed(),Mt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ao extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ao.prototype)}}class $r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,$r.prototype)}}class G extends Error{constructor(e){super(e),Object.setPrototypeOf(this,G.prototype)}}class bt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bt.prototype)}}class Cb extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Cb.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class LN{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const i=this.cache.keys().next().value;this.cache.delete(i)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const i=this.cache.keys().next().value;this.cache.delete(i)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ia(n,e){if(Array.isArray(n)){let t=[];for(let i=0;i<e;i++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function lo(n,e){if(!n)throw new Cb(e)}function XC(n,e){let t=0;for(const i of n)i===e&&t++;return t}function Oi(n){return n.length===1?n[0]:n}function jt(n){return Array.isArray(n)?n:[n]}function Ao(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ys(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let pr={};function Sb(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Vg(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Vg(e));else{const e=Object.keys(n);for(const t of e){const i=n[t];i!=null&&typeof i=="object"&&(!Array.isArray(i)&&i.type==="ndarray"&&typeof i.value=="number"?n[t]=i.value:Vg(i))}}}function pd(n,e={},t={},i="object",r=!1){if(typeof n=="string"){const o=n;let s;if(o in t)s=t[o];else if(o in pr)s=pr[o];else if(s=e[o],s==null)throw new G(`Unknown ${i}: ${n}. This may be due to one of the following reasons:
1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{const o=n;if(o.className==null||o.config==null)throw new G(`${i}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const s=o.className;let a,l;if(s in t?[a,l]=t[s]:s in pr?[a,l]=pr.className:s in e&&([a,l]=e[s]),a==null)throw new G(`Unknown ${i}: ${s}. This may be due to one of the following reasons:
1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const h of Object.keys(pr))c[h]=pr[h];for(const h of Object.keys(t))c[h]=t[h];const u=o.config;u.customObjects=c;const d=Object.assign({},pr);for(const h of Object.keys(t))pr[h]=t[h];Vg(o.config);const f=l(a,o.config,t,r);return pr=Object.assign({},d),f}else{const c=Object.assign({},pr);for(const d of Object.keys(t))pr[d]=t[d];const u=new a(o.config);return pr=Object.assign({},c),u}}}function cq(n,e){return n<e?-1:n>e?1:0}function Vd(n,e){return-1*cq(n,e)}function ms(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function uq(n){if(n==null)throw new G(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function La(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new G(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Ib(n,e,t=0,i=1/0){return lo(t>=0),lo(i>=t),Array.isArray(n)&&n.length>=t&&n.length<=i&&n.every(r=>typeof r===e)}function Jn(n,e){Array.isArray(n)?(F(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,i)=>Jn(t,`element ${i+1} of ${e}`))):F(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${zN(n)}.`)}function zN(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>zN(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function dq(n,e,t){let i=t!=null?t():_i(),r;return(...s)=>{const a=t!=null?t():_i();return a-i<e||(i=a,r=n(...s)),r}}function BN(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let hq=0;function VN(){return hq++}const Wd={};function _p(n=""){return n in Wd||(Wd[n]=0),Wd[n]+=1,n+Wd[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const fq=["channelsFirst","channelsLast"],pq=["nearest","bilinear"],mq=["valid","same","causal"],gq=["max","avg"],vq=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xa=new Map;function Tn(n){La(fq,"DataFormat",n)}function xq(n){La(pq,"InterpolationFormat",n)}function dr(n){La(mq,"PaddingMode",n)}function WN(n){La(gq,"PoolMode",n)}const Oc=[],qC="/";function ca(n,e){Oc.push(n);try{const t=e();return Oc.pop(),t}catch(t){throw Oc.pop(),t}}function bq(){return Oc.length===0?"":Oc.join(qC)+qC}function GN(n){if(!UN(n))throw new Error("Not a valid tensor name: '"+n+"'");return bq()+n}function HN(n){if(!UN(n))throw new Error("Not a valid tensor name: '"+n+"'");Xa.has(n)||Xa.set(n,0);const e=Xa.get(n);if(Xa.set(n,Xa.get(n)+1),e>0){const t=`${n}_${e}`;return Xa.set(t,1),t}else return n}const yq=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function UN(n){return!!n.match(yq)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wq(n){return n===parseInt(n.toString(),10)}function gs(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let i=1;for(let r=e;r<t;++r)i*=n[r];return i}function Ol(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const i=n[t];i<e&&(e=i)}return e}function Cs(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const i=n[t];i>e&&(e=i)}return e}function Ur(n,e){if(e<n)throw new G(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let i=n;i<e;++i)t.push(i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Em;function zn(){return Em==null&&(Em=tU().epsilon()),Em}function jr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bo(n,e){return Pe(n,e)}function md(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ee(n,t)}function Cq(n,e){return ie(()=>{if(n.shape.length!==2)throw new G(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=md(n,1);return Wg(t,[1,e,1])})}function Sq(n){const e=[gs(n.shape)];return ee(n,e)}function Iq(n){if(n.rank<=1)throw new G(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],gs(n.shape,1)];return ee(n,e)}function ua(n,e,t){return ie(()=>{switch(n.rank){case 1:return F0(n,e,t);case 2:return V2(n,[e,0],[t,n.shape[1]]);case 3:return L0(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Ph(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return tn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return tn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new G(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Nm(n,e,t){return ie(()=>{switch(n.rank){case 1:return F0(n,e,t);case 2:return V2(n,[0,e],[n.shape[0],t]);case 3:return L0(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Ph(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Gd(n,e,t,i){return ie(()=>{switch(n.rank){case 1:return F0(n,e,t);case 2:switch(i){case 1:return ua(n,e,t);case 2:return Nm(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${i}`)}case 3:switch(i){case 1:return ua(n,e,t);case 2:return L0(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Nm(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${i}`)}case 4:switch(i){case 1:return ua(n,e,t);case 2:return Ph(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Ph(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Nm(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${i}`)}default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function $b(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Fi(n,e)}function YC(n,e){switch(n.rank){case 1:return P6([n,e]);case 2:return F6([n,e],0);case 3:return z6([n,e],0);case 4:return V6([n,e],0);default:throw new G(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Wg(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new G(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Vr(n,e)}function Ap(n,e=0,t=1,i,r){return A2(n,e,t,i,r)}function yo(n,e,t,i){if(n.rank<2||e.rank<2)throw new bt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new bt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return OC({a:n,b:e,transposeA:!1,transposeB:!1,bias:i?Gg(n.rank,i,jr()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=ee(n,[-1,o]);const s=e.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=ee(Pt(e,u),[l,-1]);const d=[...r,...c];return ee(OC({a:n,b:e,transposeA:!1,transposeB:!1,bias:i?Gg(n.rank,i,jr()):null,activation:t}),d)}}function jN(n,e,t){return ie(()=>(Array.isArray(e)?e=Xi(e,"int32"):e=Pe(e,"int32"),w0(n,e,t)))}function gd(n){return K(n,n)}function Gg(n,e,t){const i=e.shape;if(e.rank!==1&&e.rank!==n)throw new G(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return i.length===1?ee(e,[1,i[0],1,1,1]):ee(e,[1,i[3],i[0],i[1],i[2]]);if(t==="channelsLast")return i.length===1?ee(e,[1,1,1,1,i[0]]):ee(e,[1].concat(i))}else if(n===4){if(t==="channelsFirst")return i.length===1?ee(e,[1,i[0],1,1]):ee(e,[1,i[2],i[0],i[1]]);if(t==="channelsLast")return i.length===1?ee(e,[1,1,1,i[0]]):ee(e,[1].concat(i))}else if(n===3){if(t==="channelsFirst")return i.length===1?ee(e,[1,i[0],1]):ee(e,[1,i[1],i[0]]);if(t==="channelsLast")return i.length===1?ee(e,[1,1,i[0]]):ee(e,[1].concat(i))}else if(n<3)return e;throw new G(`Unsupported input rank by biasAdd: ${e.rank}`)}function Yr(n,e,t){return ie(()=>(t==null&&(t=jr()),Tn(t),$e(n,Gg(n.rank,e,t))))}function $q(n,e=1){if(e!==1)throw new bt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return $p(n)}function Eq(n){return ie(()=>at(n,$e(wi(n),1)))}function KN(n,e,t,i){return ie(()=>V5(n,e,t,i))}function Nq(n){return ie(()=>{const e=$e(.5,K(.2,n));return cr(e,0,1)})}function vd(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kq=["fanIn","fanOut","fanAvg"],Dq=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Tq(n){La(kq,"FanMode",n)}function Rq(n){La(Dq,"Distribution",n)}class Ar extends nc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class XN extends Ar{apply(e,t){return Yn(e,t)}}XN.className="Zeros";Ce(XN);class Eb extends Ar{apply(e,t){return Os(e,t)}}Eb.className="Ones";Ce(Eb);class qN extends Ar{constructor(e){if(super(),typeof e!="object")throw new G(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new G(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ie(()=>K(Gt(this.value),Os(e,t)))}getConfig(){return{value:this.value}}}qN.className="Constant";Ce(qN);class YN extends Ar{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return ld(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}YN.className="RandomUniform";Ce(YN);class JN extends Ar{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`randomNormal does not support dType ${t}.`);return Ap(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}JN.className="RandomNormal";Ce(JN);class ZN extends Ar{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`truncatedNormal does not support dType ${t}.`);return H2(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}ZN.className="TruncatedNormal";Ce(ZN);class QN extends Ar{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ie(()=>{if(e.length!==2||e[0]!==e[1])throw new G("Identity matrix initializer can only be used for 2D square matrices.");return K(this.gain,$2(e[0]))})}getConfig(){return{gain:this.gain}}}QN.className="Identity";Ce(QN);function _q(n,e="channelsLast"){let t,i;if(Tn(e),n.length===2)t=n[0],i=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=gs(n,2);t=n[1]*r,i=n[0]*r}else if(e==="channelsLast"){const r=gs(n,0,n.length-2);t=n[n.length-2]*r,i=n[n.length-1]*r}}else{const r=gs(n);t=Math.sqrt(r),i=Math.sqrt(r)}return[t,i]}class Qi extends Ar{constructor(e){if(super(),e.scale<0)throw new G(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Tq(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Rq(this.distribution),this.seed=e.seed}apply(e,t){const i=_q(e),r=i[0],o=i[1];let s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,r):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(s);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new bt(`${this.getClassName()} does not support dType ${t}.`);return H2(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*s);return ld(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Qi.className="VarianceScaling";Ce(Qi);class Nb extends Qi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qi.className}}Nb.className="GlorotUniform";Ce(Nb);class kb extends Qi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qi.className}}kb.className="GlorotNormal";Ce(kb);class Db extends Qi{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qi.className}}Db.className="HeNormal";Ce(Db);class Tb extends Qi{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qi.className}}Tb.className="HeUniform";Ce(Tb);class Rb extends Qi{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qi.className}}Rb.className="LeCunNormal";Ce(Rb);class _b extends Qi{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qi.className}}_b.className="LeCunUniform";Ce(_b);class ek extends Ar{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ie(()=>{if(e.length<2)throw new bt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const i=he(e.slice(0,-1)),r=e[e.length-1],o=i*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const s=[Math.max(r,i),Math.min(r,i)],a=Ap(s,0,1,t,this.seed),l=F8.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,i)*Math.min(r,i)],[Math.min(r,i)+1]);return c=K(c,d.sign()),i<r&&(c=c.transpose()),K(Gt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}ek.className="Orthogonal";Ce(ek);const JC={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ZC(n,e={}){return pd(n,yr.getMap().classNameMap,e,"initializer")}function gn(n){return Sb(n)}function hn(n){if(typeof n=="string"){const e=n in JC?JC[n]:n;if(e==="GlorotNormal")return new kb;if(e==="GlorotUniform")return new Nb;if(e==="HeNormal")return new Db;if(e==="HeUniform")return new Tb;if(e==="LeCunNormal")return new Rb;if(e==="LeCunUniform")return new _b;{const t={};return t.className=e,t.config={},ZC(t)}}else return n instanceof Ar?n:ZC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hg(n){return Array.isArray(n)&&Array.isArray(n[0])}function Mh(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function ut(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new G(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Vt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new G(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fh(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((i,r)=>i*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const QC="Variable";class Aq{constructor(e,t="float32",i=QC,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=VN(),i=i??QC,this.originalName=GN(i),this.name=HN(this.originalName),this.trainable_=r,this.constraint=o,this.val=F5(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Oq(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Oq(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Ug(n){return n.map(e=>e.read())}function Ab(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class No{constructor(e,t,i,r,o,s,a){this.dtype=e,this.shape=t,this.sourceLayer=i,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=VN(),s!=null&&(this.originalName=GN(s),this.name=HN(this.originalName)),this.rank=t.length}}let Pq=0;class Op{constructor(e,t){this.callArgs=t,this.id=Pq++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const i of e.inboundLayers)i!=null&&i.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Mq=0;class St extends nc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Mq++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const i=this.getClassName();t=Ao(i)+"_"+_p(i)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let i;if(e.batchInputShape!=null)i=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),i=[o].concat(e.inputShape)}this.batchInputShape=i;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new $r(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new G(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Oi(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Oi(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ao(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ao(`Layer ${this.name} is not connected, no input to return.`);return Oi(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ao(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ao(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Oi(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=jt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const i=jt(this.inputSpec);if(t.length!==i.length)throw new G(`Layer ${this.name} expects ${i.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],s=i[r];if(s==null)continue;const a=o.rank;if(s.ndim!=null&&a!==s.ndim)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${a}`);if(s.maxNDim!=null&&a>s.maxNDim)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${a}`);if(s.minNDim!=null&&a<s.minNDim)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${a}.`);if(s.dtype!=null&&o.dtype!==s.dtype)throw new G(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${o.dtype}.`);if(s.axes){const l=o.shape;for(const c in s.axes){const u=Number(c),d=s.axes[c],f=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(f)===-1)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(s.shape!=null)for(let l=0;l<s.shape.length;++l){const c=s.shape[l],u=o.shape[l];if(c!=null&&u!=null&&c!==u)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const i=jt(e),r=zq(e),o=Bq(e);if(r===o)throw new G("Arguments to apply() must be all SymbolicTensors or all Tensors");return ca(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const s=[];for(const a of jt(e))s.push(a.shape);this.build(Oi(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let s=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,s);const a=jt(s),l=[];for(let c of a)i.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=Oi(l),this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{const s=Fq(e),a=this.computeOutputShape(s);let l;const c=Lq(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new No(c,u,this,jt(e),t,this.name,d)):l=new No(c,a,this,jt(e),t,this.name),this.addInboundNode(e,l,null,null,s,a,t),this._refCount++,this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((i,r)=>{i!=null&&e[r]!=null&&e[r]!==i&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ao(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const i=JSON.stringify(t.outputShapes);e.indexOf(i)===-1&&e.push(i)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new ao(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new $r(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Fh(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Ug(e?this.trainableWeights:this.weights)}setWeights(e){ie(()=>{const t=this.weights;if(t.length!==e.length)throw new G(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const i=[],r=Ug(t);for(let o=0;o<r.length;++o){const s=r[o],a=t[o],l=e[o];if(!Ht(s.shape,l.shape))throw new G(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);i.push([a,l])}Ab(i)})}addWeight(e,t,i,r,o,s,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new G(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),i==null&&(i="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():hn("zeros"));const c=r.apply(t,i),u=new Aq(c,i,e,s,a);return c.dispose(),o!=null&&this.addLoss(()=>o.apply(u.read())),s==null&&(s=!0),s?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=jt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(i=>{if(i!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,i){if(!this.supportsMasking)return;const r=this.computeMask(e,i),o=jt(t),s=jt(r);if(o.length!==s.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=s[a]}addInboundNode(e,t,i,r,o,s,a=null){const l=jt(e);t=jt(t),i=jt(i),r=jt(r),o=Mh(o),s=Mh(s);const c=[],u=[],d=[];for(const f of l)c.push(f.sourceLayer),u.push(f.nodeIndex),d.push(f.tensorIndex);new Op({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:t,inputMasks:i,outputMasks:r,inputShapes:o,outputShapes:s},a);for(let f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Fq(n){n=jt(n);const e=[];for(const t of n)e.push(t.shape);return Oi(e)}function Lq(n){return"float32"}function tk(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;{const r=[];for(let o=0;o<i.inboundLayers.length;o++){const s=i.inputTensors[o],a=i.inboundLayers[o],l=i.nodeIndices[o],c=tk(s,a,l);for(const u of c)r.indexOf(u)===-1&&r.push(u)}return r}}}function zq(n){let e=!0;for(const t of jt(n))if(!(t instanceof No)){e=!1;break}return e}function Bq(n){let e=!0;for(const t of jt(n))if(t instanceof No){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xd extends St{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:_p("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new G("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new G("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new G("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const i=e.dtype||"float32";this.batchInputShape=t,this.dtype=i,this.inputSpec=[{shape:t}];const r=new No(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Op({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new G(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}xd.className="InputLayer";Ce(xd);function Vq(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new G("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new xd({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wq(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Pe(e,n.dtype)}catch{throw new G(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class us{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof us)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,i){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Wq(e,t),this.name2Id[e.name]=e.id,i!=null&&(this.id2Mask[e.id]=i);else throw new G(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof No){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof No){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&yt(this.id2Mask)}}const Lh=new LN,zh=new LN;function Gq(n){Lh!=null&&Lh.setMaxEntries(n),zh!=null&&zh.setMaxEntries(n)}function Sc(n,e,t,i){const r=t==null?!1:t.training,o=Array.isArray(n),s=o?n:[n],a=s.map(p=>p.name),l=[],c=e.names();for(const p of a)c.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const u=a.join(",")+"|"+e.names().sort().join(",");let d=Lh.get(u),f;if(d==null){const p=Hq(s,e);d=p.sorted,f=p.recipientCounts,Lh.put(u,d),zh.put(u,f)}f={},r||Object.assign(f,zh.get(u));const h=new us(e);for(let p=0;p<d.length;++p){const m=d[p],g=m.sourceLayer;if(g instanceof xd)continue;const v=[],x=[],b=[];let w=!1;for(const E of m.inputs){const N=h.getValue(E),k=h.getMask(E);v.push(N),x.push(k),k!=null&&(w=!0),r||(f[E.name]--,f[E.name]===0&&!e.hasKey(E)&&a.indexOf(E.name)===-1&&!N.isDisposed&&E.sourceLayer.stateful!==!0&&b.push(N))}w&&(t=t||{},t.mask=x[0]);const y=jt(g.apply(v,t));let C=null;g.supportsMasking&&(C=g.computeMask(v,x));const $=jq(m),I=Array.isArray($)?$:[$];for(let E=0;E<I.length;++E){h.hasKey(I[E])||h.add(I[E],y[E],Array.isArray(C)?C[0]:C);const N=a.indexOf(I[E].name);N!==-1&&(l[N]=y[E])}r||yt(b)}return h.disposeMasks(),o?l:l[0]}function Hq(n,e){F(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],i={};if(n.length===1){const r=eS(n[0],e);t=r.sorted,i=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:s,recipientMap:a}=eS(o,e);for(const l of s)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)i[l]==null&&(i[l]=new Set),a[l].forEach(c=>i[l].add(c))}}return{sorted:t,recipientCounts:Uq(i)}}function Uq(n){const e={};for(const t in n)e[t]=n[t].size;return e}function eS(n,e){const t=new Set,i=[],r={};for(const a of e.names())t.add(a);const o=[],s=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const l=s[s.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),i.push(a),t.add(a.name),l&&s.pop();else{s.push(o.length-1);for(const c of a.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(a.name),!t.has(c.name)&&o.push(c)}}return{sorted:i,recipientMap:r}}function jq(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let i=0;i<n.sourceLayer.inboundNodes.length;++i)for(const r of n.sourceLayer.inboundNodes[i].outputTensors)if(r.id===n.id){t=i;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=ae();Kq.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Gq);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ob(n,e){return ie(()=>gi(rt(K(n,n),e,!0)))}class bd extends nc{getConfig(){return{}}}class nk extends bd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>{const t=Ob(e,this.axis),i=cr(t,0,this.maxValue);return K(e,at(i,$e(zn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}nk.className="MaxNorm";Ce(nk);class ik extends bd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>at(e,$e(zn(),Ob(e,this.axis))))}getConfig(){return{axis:this.axis}}}ik.className="UnitNorm";Ce(ik);class rk extends bd{apply(e){return Ma(e)}}rk.className="NonNeg";Ce(rk);class ok extends bd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>{const t=Ob(e,this.axis),i=$e(K(this.rate,cr(t,this.minValue,this.maxValue)),K(1-this.rate,t));return K(e,at(i,$e(zn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}ok.className="MinMaxNorm";Ce(ok);const tS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Vn(n){return Sb(n)}function nS(n,e={}){return pd(n,yr.getMap().classNameMap,e,"constraint")}function Wn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in tS?tS[n]:n,config:{}};return nS(t)}else return n instanceof bd?n:nS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Hs(n){if(n==null)return;const e=[],t=[],i=[];for(const r in n){const o=n[r];if(typeof o!="number"){const s=o;e.push(s.data()),t.push(r),i.push(s)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];yt(i)}}function sk(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var iS;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(iS||(iS={}));const Xq=125;class Xc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class qq{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const i of this.callbacks)await i.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const i of this.callbacks)await i.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const i of this.callbacks)await i.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const i of this.callbacks)await i.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class Yq extends Xc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const i=t.size==null?0:t.size;this.seen+=i;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*i;else{let s;r in this.totals?s=this.totals[r]:this.totals[r]=0;const a=ie(()=>$e(this.totals[r],K(o,i)));this.totals[r]=a,s!=null&&s.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const i of this.params.metrics)this.totals[i]!=null&&(typeof this.totals[i]=="number"?t[i]=this.totals[i]/this.seen:ie(()=>{const r=K(at(1,this.seen),this.totals[i]);t[i]=r,this.totals[i].dispose(),vo(t[i])}))}}class Jq extends Xc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const i in t)this.history[i]==null&&(this.history[i]=[]),this.history[i].push(t[i])}async syncData(){const e=[],t=[],i=[];for(const o in this.history){const s=this.history[o];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){const l=s[a];e.push(l.data()),t.push(o),i.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][i[o]].dispose(),this.history[t[o]][i[o]]=r[o][0]}}class Zq extends Xc{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||dN,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Xq),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");yg(this.yieldEvery)&&(this.maybeWait=dq(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,i){const r=[];this.yield!=null&&(await Hs(i),r.push(this.yield(e,t,i))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Hs(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const i=[];this.epochEnd!=null&&(await Hs(t),i.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&i.push(this.nextFrameFunc()),await Promise.all(i)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Hs(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const i=[];this.batchEnd!=null&&(await Hs(t),i.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?i.push(this.nextFrameFunc()):yg(this.yieldEvery)&&i.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(i)}async onTrainBegin(e){this.trainBegin!=null&&(await Hs(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Hs(e),await this.trainEnd(e))}}function ak(n,e){return n==null&&(n={}),n instanceof Xc?[n]:Array.isArray(n)&&n[0]instanceof Xc?n:jt(n).map(i=>new Zq(i,e))}class xr{constructor(){}static registerCallbackConstructor(e,t){F(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),xr.checkForDuplicate(t),xr.constructors[e]==null&&(xr.constructors[e]=[]),xr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in xr.constructors)xr.constructors[+t].forEach(r=>{if(r===e)throw new G("Duplicate callback constructor.")})}static clear(){xr.constructors={}}static createCallbacks(e){const t=[];for(const i in xr.constructors){const r=+i;e>=r&&t.push(...xr.constructors[r])}return t.map(i=>new i)}}xr.constructors={};function lk(n,e,t,i,r,o,s,a,l){const c=new Jq,u=[new Yq,...xr.createCallbacks(e)];n!=null&&u.push(...n),u.push(c);const d=new qq(u);return d.setParams({epochs:t,initialEpoch:i,samples:r,steps:o,batchSize:s,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wo(n,e={},t=!1){return pd(n,yr.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bh(n,e){return ie(()=>{n.dtype!=="float32"&&(n=Pe(n,"float32"));const t=rt(gd(n),e,!0),i=Ip(t.shape,zn()),r=gi(As(t,i));return at(n,r)})}function Pp(n,e){return ie(()=>On(gd(ct(e,n)),-1))}function Pb(n,e){return ie(()=>On(wi(ct(e,n)),-1))}function Mb(n,e){return ie(()=>{const t=ct(n,e),i=cr(wi(n),zn(),Number.MAX_VALUE),r=wi(at(t,i));return K(100,On(r,-1))})}function Qq(n,e){return ie(()=>{const t=cr(e,zn(),Number.MAX_VALUE),i=Eo($e(1,t)),r=cr(n,zn(),Number.MAX_VALUE),o=Eo($e(1,r));return On(gd(ct(i,o)),-1)})}function e9(n,e){return ie(()=>{const t=As(0,ct(1,K(n,e)));return On(gd(t),-1)})}function t9(n,e){return ie(()=>{const t=As(0,ct(1,K(n,e)));return On(t,-1)})}function n9(n,e){return ie(()=>{const t=rt(K(n,e),-1),i=Gr(K(ct(1,n),e),-1);return As(0,$e(1,ct(i,t)))})}function i9(n,e){return ie(()=>{const t=Math.log(2),i=ct(e,n),r=ct($e(i,ad(K(-2,i))),t);return On(r,-1)})}function qc(n,e,t=!1){return ie(()=>{if(t)e=z0(e);else{const i=rt(e,e.shape.length-1,!0);e=at(e,i)}return e=cr(e,zn(),1-zn()),In(rt(K(Pe(n,"float32"),Eo(e)),e.shape.length-1))})}function Vh(n,e,t=!1){return ie(()=>{const i=Pe(Np(Sq(n)),"int32");e=cr(e,zn(),1-zn());const r=e.shape,o=ee(T2(i,r[r.length-1]),r);return qc(o,e,t)})}function r9(n,e){if(!Ht(n.shape,e.shape))throw new G(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ie(()=>{const t=Ma(e),i=In(wi(e));return $e(ct(t,K(e,n)),E2($o(i)))})}function Mp(n,e){return ie(()=>{let t;return t=cr(e,zn(),1-zn()),t=Eo(at(t,ct(1,t))),On(r9(n,t),-1)})}function o9(n,e){return ie(()=>{const t=cr(n,zn(),1),i=cr(e,zn(),1);return rt(K(n,Eo(at(t,i))),-1)})}function s9(n,e){return ie(()=>{const t=Eo($e(zn(),e));return On(ct(e,K(n,t)),-1)})}function ck(n,e){return ie(()=>{const t=Bh(n,-1),i=Bh(e,-1),r=K(t,i);return In(rt(r,-1))})}const Wh={meanSquaredError:Pp,meanAbsoluteError:Pb,meanAbsolutePercentageError:Mb,meanSquaredLogarithmicError:Qq,squaredHinge:e9,hinge:t9,categoricalHinge:n9,logcosh:i9,categoricalCrossentropy:qc,sparseCategoricalCrossentropy:Vh,binaryCrossentropy:Mp,kullbackLeiblerDivergence:o9,poisson:s9,cosineProximity:ck};function km(n){if(typeof n=="string"){if(n in Wh)return Wh[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new G(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uk(n,e){return ie(()=>{const t=K(.5,Dr(e)),i=bo(ur(e,t),n.dtype);return On(Io(n,i),-1)})}function dk(n,e){return ie(()=>bo(Io(Gc(n,-1),Gc(e,-1)),"float32"))}function a9(n,e){return ie(()=>Pe(rt(Uo(Io(n,1),Io(e,1))),"float32"))}function l9(n,e){return ie(()=>Pe(rt(Uo(Io(n,0),Io(e,1))),"float32"))}function c9(n,e){return ie(()=>{const t=a9(n,e),i=l9(n,e),r=$e(t,i);return Pe($i(ur(r,0),at(t,r),0),"float32")})}function u9(n,e){return Mp(n,e)}function d9(n,e){return n.rank===e.rank&&(n=cd(n,[n.rank-1])),e=Gc(e,-1),e.dtype!==n.dtype&&(e=Pe(e,n.dtype)),Pe(Io(n,e),"float32")}const h9=Pp,f9=Pp,p9=Pb,m9=Pb,g9=Mb,v9=Mb,hk=qc,x9=ck,fk=Vh,Gh={binaryAccuracy:uk,categoricalAccuracy:dk,precision:c9,categoricalCrossentropy:hk,sparseCategoricalCrossentropy:fk,mse:h9,MSE:f9,mae:p9,MAE:m9,mape:g9,MAPE:v9,cosine:x9};function b9(n){if(typeof n=="string"&&n in Gh)return Gh[n];if(typeof n!="string"&&n!=null)return n;throw new G(`Unknown metric ${n}`)}function Hd(n){if(lo(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Wh))if(Wh[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Gh))if(Gh[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function y9(n){const e={Adagrad:()=>Ka.adagrad(.01),Adadelta:()=>Ka.adadelta(1,.95,zn()),Adam:()=>Ka.adam(.001,.9,.999,zn()),Adamax:()=>Ka.adamax(.002,.9,.999,zn(),0),RMSProp:()=>Ka.rmsprop(.001,.9,0,zn()),SGD:()=>Ka.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new G(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rS=1*1024*1024;function oS(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!jg(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const i=JSON.stringify(n);i.length>rS&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${i.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${rS}.`)}}function jg(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!jg(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!jg(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function w9(n,e,t,i=console.log){const r=S9(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(u=>Math.floor(e*u)));let s;if(!r){o.push("Receives inputs"),s=[];for(const u in n.nodesByDepth)s.push(...n.nodesByDepth[u])}i("_".repeat(e)),Hh(o,t,i),i("=".repeat(e));const a=n.layers;for(let u=0;u<a.length;++u)r?I9(a[u],t,i):$9(a[u],t,s,i),i((u===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=C9(n),c=Fh(n.nonTrainableWeights);i(`Total params: ${l+c}`),i(`Trainable params: ${l}`),i(`Non-trainable params: ${c}`),i("_".repeat(e))}function C9(n){let e;return n.collectedTrainableWeights!=null?e=Fh(n.collectedTrainableWeights):e=Fh(n.trainableWeights),e}function S9(n){let e=!0;const t=[],i=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}i.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const s of r.inboundNodes)if(i.indexOf(s)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Hh(n,e,t=console.log){let i="";for(let r=0;r<n.length;++r)r>0&&(i=i.slice(0,i.length-1)+" "),i+=n[r],i=i.slice(0,e[r]),i+=" ".repeat(e[r]-i.length);t(i)}function I9(n,e,t){let i,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{i=JSON.stringify(n.outputShape)}catch{i="multiple"}const o=n.name,s=n.getClassName(),a=[`${o} (${s})`,r,i,n.countParams().toString()];Hh(a,e,t)}function $9(n,e,t,i){let r,o;try{o=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const s=[];for(const d of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(d)===-1))for(let f=0;f<d.inboundLayers.length;++f){const h=d.inboundLayers[f].name,p=d.nodeIndices[f],m=d.tensorIndices[f];s.push(`${h}[${p}][${m}]`)}const a=n.name,l=n.getClassName(),c=s.length===0?"":s[0],u=[`${a} (${l})`,o,r,n.countParams().toString(),c];Hh(u,e,i);for(let d=1;d<s.length;++d)Hh(["","","","",s[d]],e,i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pk(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Uh(n,e){if(n===null)return null;if(typeof n=="string")return Ys(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],i=n.length;for(let r=0;r<i;++r){const o=n[r];pk(e,r,o)?t.push(o):t.push(Uh(o,e))}return t}else{const t={};for(const i of Object.keys(n)){const r=n[i];if(i==="name"&&typeof r=="string")t[i]=r;else{const o=Ys(i);t[o]=Uh(r,o)}}return t}}function Kg(n,e){if(n==null)return null;if(typeof n=="string")return Ao(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],i=n.length;for(let r=0;r<i;++r){const o=n[r];pk(e,r,o)?t.push(o):t.push(Kg(o,e))}return t}else{const t={};for(const i of Object.keys(n)){const r=n[i],o=Ao(i);(i==="name"||i==="className")&&typeof r=="string"?t[o]=r:t[o]=Kg(r,i)}return t}}/** @license See the LICENSE file. */const mk="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const E9=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Lr extends St{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const x=this.getClassName().toLowerCase();this.name=_p(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ms(this.inputs).length!==this.inputs.length)throw new G(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);ms(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const x of this.outputs){const b=x.sourceLayer,w=x.nodeIndex,y=x.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(y)}for(const x of this.inputs){const b=x.sourceLayer,w=x.nodeIndex,y=x.tensorIndex;lo(w===0,"input layer has >1 nodes"),lo(y===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(y)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){const b=this.inputLayers[x];if(!(b instanceof xd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${x} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(const x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);const t={},i={},r={},o={},s={},a=[],l=(x,b,w,y,C,$)=>{(y==null||C==null||$==null)&&(y=x.sourceLayer,C=x.nodeIndex,$=x.tensorIndex);const I=y.inboundNodes[C];if(w.indexOf(I)!==-1)throw new $r(`The tensor ${x.name} at layer "${y.name}" is part of a cycle.`);if(b.indexOf(I)!==-1)return;this.containerNodes.add(Lr.nodeKey(y,C)),y.id in s||(s[y.id]=Object.keys(s).length),w.indexOf(I)===-1&&w.push(I);const E=I.inboundLayers.length;for(let N=0;N<E;N++){const k=I.inputTensors[N],D=I.inboundLayers[N],_=I.nodeIndices[N],R=I.tensorIndices[N];l(k,b,w,D,_,R)}for(b.push(I);w.indexOf(I)>=0;)w.splice(w.indexOf(I),1);a.push(I)},c=[],u=[];for(const x of this.outputs)l(x,c,u);const d=a.slice().reverse();for(const x of d){i[x.id]=x,x.id in t||(t[x.id]=0);let b=t[x.id];const w=r[x.outboundLayer.id]==null?0:r[x.outboundLayer.id];b=Math.max(b,w),r[x.outboundLayer.id]=b,o[x.outboundLayer.id]=x.outboundLayer,t[x.id]=b;for(let y=0;y<x.inboundLayers.length;y++){const C=x.inboundLayers[y],$=x.nodeIndices[y],I=C.inboundNodes[$],E=t[I.id]==null?0:t[I.id];t[I.id]=Math.max(b+1,E),i[I.id]=I}}const f={};for(const x in t){const b=t[x];b in f||(f[b]=[]),f[b].push(i[x])}const h={};for(const x in r){const b=r[x];b in h||(h[b]=[]),h[b].push(o[x])}let p=Object.keys(h).map(x=>parseInt(x,10)).sort(Vd);this.layers=[];for(const x of p){const b=h[x];b.sort((w,y)=>{const C=s[w.id],$=s[y.id];return C<$?-1:C>$?1:0});for(const w of b)w instanceof Lr&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=h,p=Object.keys(f).map(x=>parseInt(x,10)).sort(Vd);const m=this.inputs.slice(),g=[];for(const x of p)for(const b of f[x]){const w=b.outboundLayer;if(w!=null){for(const y of b.inputTensors)if(m.indexOf(y)===-1)throw new $r(`Graph disconnected: cannot obtain value for tensor ${y} at layer "${w.name}". The following previous layers were accessed without issue: ${g}`);for(const y of b.outputTensors)m.push(y);g.push(w.name)}}this.nodesByDepth=f;const v=this.layers.map(x=>x.name);for(const x of v){const b=v.filter(w=>w===x).length;if(b!==1)throw new $r(`The name "${x}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new Op({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(i=>i.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new G("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const i of this.layers)t.push(...i.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const i={};let r=0;const o=E9(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=o?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(i[u]!=null)throw new G(`Duplicate weight name: ${u}`);i[u]=c,r++}const s=[];for(const a in e){let l=a;if(i[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(i[l]!=null)s.push([i[l],e[a]]);else if(t)throw new G(`Provided weight data has no target variable: ${a}`);delete i[l]}if(t){const a=[];for(const l in i)a.push(l);if(a.length>0)throw new G(`${a.length} of ${r} weights are not set: ${a}`)}Ab(s)}parseWeights(e){for(const t in Object.keys(e)){const i=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=i.map(s=>s.startsWith("_")?s.slice(1):s).filter(s=>!r.includes(s)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${mk}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const i=Kg(this.updatedConfig());return t?JSON.stringify(i):i}call(e,t){return ie(()=>{e=jt(e);const i=new us;for(let r=0;r<this.inputs.length;++r)i.add(this.inputs[r],e[r]);return Sc(this.outputs,i,t)})}computeMask(e,t){return ie(()=>{e=jt(e);let i;return t==null?i=Ia(null,e.length):i=jt(t),this.runInternalGraph(e,i)[1]})}computeOutputShape(e){const t=Mh(e);if(t.length!==this.inputLayers.length)throw new G(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const i={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],c=t[a],u=l.name+"_0_0";i[u]=c}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Vd);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;const d=[];for(let m=0;m<c.inboundLayers.length;m++){const g=c.inboundLayers[m],v=c.nodeIndices[m],x=c.tensorIndices[m],b=`${g.name}_${v}_${x}`,w=i[b];d.push(w)}const f=u.computeOutputShape(Oi(d)),h=Mh(f),p=u.inboundNodes.indexOf(c);for(let m=0;m<h.length;m++){const g=`${u.name}_${p}_${m}`;i[g]=h[m]}}}const o=[],s=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){const l=s[a];lo(l in i),o.push(i[l])}return Oi(o)}runInternalGraph(e,t){t==null&&(t=Ia(null,e.length));const i={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=t[l];i[c.id]=[u,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Vd);for(const l of r){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,f=u.inputTensors,h=u.outputTensors,p=new Array;for(const m of f)m.id in i&&p.push(i[m.id]);if(p.length===f.length){let m={},g,v,x,b;if(u.callArgs!=null&&(m=u.callArgs),p.length===1){const[w,y]=p[0];m.mask==null&&(m.mask=y),x=jt(d.call(w,m)),b=jt(d.computeMask(w,y)),g=[w],v=[y]}else g=p.map(w=>w[0]),v=p.map(w=>w[1]),m.mask==null&&(m.mask=v),x=jt(d.call(g,m)),b=jt(d.computeMask(g,v));if(d.activityRegularizer)throw new bt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<h.length;++w){const y=h[w],C=x[w],$=b[w];i[y.id]=[C,$]}}}}const o=[],s=[],a=[];for(const l of this.outputs){lo(l.id in i,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=i[l.id];a.push(c.shape),o.push(c),s.push(u)}return[o,s,a]}buildNodeConversionMap(e){const t={};let i;for(const r of this.layers){i=r instanceof Lr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const s=Lr.nodeKey(r,o);this.containerNodes.has(s)&&(t[s]=i,i+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new G("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const i of this.layers)if(i.name===e)return i;throw new G(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new G(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ie(()=>{const e=[];for(const t of this.layers)for(let i=0;i<t.inboundNodes.length;++i){const r=Lr.nodeKey(t,i);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),i=[];for(const s of this.layers){const a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){const f=s.inboundNodes[d],h=Lr.nodeKey(s,d);let p={};if(this.containerNodes.has(h)){if(f.callArgs)try{JSON.stringify(f.callArgs),p=f.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(f.inboundLayers.length>0){const m=[];for(let g=0;g<f.inboundLayers.length;g++){const v=f.inboundLayers[g],x=f.nodeIndices[g],b=f.tensorIndices[g],w=Lr.nodeKey(v,x);let y=t[w];y==null&&(y=0),m.push([v.name,y,b,p])}c.push(m)}}}const u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,i.push(u)}e.layers=i;const r=[];for(let s=0;s<this.inputLayers.length;s++){const a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=Lr.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[s];r.push([a.name,u,d])}e.inputLayers=r;const o=[];for(let s=0;s<this.outputLayers.length;s++){const a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=Lr.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[s];o.push([a.name,u,d])}return e.outputLayers=o,e}static fromConfig(e,t,i={},r=!1){const o={},s={};function a(g,v){g.name in s?s[g.name].push(v):s[g.name]=[v]}function l(g,v){const x=[];let b;for(const w of v){const y=w[0],C=w[1],$=w[2];if(b=w[3]==null?{}:w[3],!(y in o)){a(g,v);return}const I=o[y];if(I.inboundNodes.length<=C){a(g,v);return}const E=I.inboundNodes[C];x.push(E.outputTensors[$])}x.length>0&&g.apply(Oi(x),b)}function c(g){const v=g.name,x=wo(g,t.customObjects!=null?t.customObjects:{});x.setFastWeightInitDuringBuild(r),o[v]=x,g.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new G(`Corrupted configuration, expected array for nodeData: ${w}`);a(x,w)})}const u=t.name,d=t.layers;for(const g of d)c(g);for(;!uq(s);)for(const g of d){const v=o[g.name];if(v.name in s){const x=s[v.name];delete s[v.name];for(const b of x)l(v,b)}}const f=[],h=[],p=t.inputLayers;for(const g of p){const v=g[0],x=g[1],b=g[2];lo(v in o);const y=o[v].inboundNodes[x].outputTensors;f.push(y[b])}const m=t.outputLayers;for(const g of m){const v=g[0],x=g[1],b=g[2];lo(v in o);const y=o[v].inboundNodes[x].outputTensors;h.push(y[b])}return new e({inputs:f,outputs:h,name:u})}get stateful(){if(this._stateful)throw new G("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ie(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function N9(n,e,t){const i=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(i===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==i)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${i}) outputs, so ${t} must be either an array with ${i} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function gk(n,e){return N9(n,e,"classWeight")}async function vk(n,e,t,i){if(t!=null){const r=ie(()=>{if(n.shape.length===1)return la(n);if(n.shape.length===2){if(n.shape[1]>1)return Gc(n,1);if(n.shape[1]===1)return ee(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());yt(r);const s=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(t[a])}),Xi(s,"float32")}else return null}function k9(n,e){return K(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const D9=32;function xk(n,e){let t,i;const r=e;t=r.xs,i=r.ys,F(t!=null&&i!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=sS("input",n.inputNames,t),s=sS("output",n.outputNames,i),a=o[0].shape[0];F(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),F(s.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)F(o[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<s.length;l++)F(s[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:s}}function sS(n,e,t){if(t instanceof Ln)return[t];if(Array.isArray(t))return F(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const i=[];for(const r of e){if(t[r]==null)throw new G(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);i.push(t[r])}return i}}function T9(n){if(n.length===3)throw new bt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function R9(n,e,t){const i=t.batchesPerEpoch!=null;if(F(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),F(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),F(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),F(!i||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),F(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,s;if(r)if(aS(t.validationData))F(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const g=T9(t.validationData);o=g.xs,s=g.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();const u=ak(t.callbacks,t.yieldEvery),d=t.verbose==null?1:t.verbose,{callbackList:f,history:h}=lk(u,d,t.epochs,null,null,_9(e,t),null,r,c);f.setModel(n),n.history=h,await f.onTrainBegin(),n.stopTraining_=!1;let p=t.initialEpoch==null?0:t.initialEpoch,m=await e.iterator();for(;p<t.epochs;){const g={};await f.onEpochBegin(p);let v=0,x=0;for(i||(m=await e.iterator());!i||v<t.batchesPerEpoch;){const b=await m.next();if(i&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){const{xs:w,ys:y}=xk(n,b.value),C={};C.batch=x,C.size=w[0].shape[0],await f.onBatchBegin(x,C);const $=[];if(t.classWeight!=null){const N=gk(t.classWeight,n.outputNames);for(let k=0;k<N.length;++k)$.push(await vk(y[k],null,N[k]))}const I=w.concat(y).concat($),E=a(I);yt(I);for(let N=0;N<l.length;++N){const k=l[N],D=E[N];C[k]=D,vo(D)}await f.onBatchEnd(x,C),sk(C),x++,v++}if(i?v>=t.batchesPerEpoch:b.done){if(r){let w;aS(t.validationData)?w=jt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):w=jt(n.evaluate(o,s,{batchSize:t.validationBatchSize==null?D9:t.validationBatchSize,verbose:0}));for(let y=0;y<n.metricsNames.length;++y)g[`val_${n.metricsNames[y]}`]=w[y]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(p,g),p++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function _9(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function aS(n){return typeof n.iterator=="function"}function A9(n){return typeof n.next=="function"}async function O9(n,e,t){t=t||{};const i=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new bt("Verbose mode is not implemented yet.");F(!i||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const s=A9(e)?e:await e.iterator();let a=0,l=0;for(;!i||l<t.batches;){const c=await s.next();if(o=ie(()=>{if(c.value){const{xs:u,ys:d}=xk(n,c.value),f=u.concat(d),h=ie(()=>r(f));if(yt(f),l===0)for(let m=0;m<h.length;++m)o.push(Gt(0));const p=f[0].shape[0];for(let m=0;m<h.length;++m){const g=h[m],v=o[m];o[m]=ie(()=>$e(o[m],K(p,g))),l>0&&yt(v)}yt(h),a+=p,++l}return o}),c.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<o.length;++c){const u=o[c];o[c]=at(o[c],a),yt(u)}return Oi(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dm(n){F(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function bc(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(i=>ua(i,e,t-e)):ua(n,e,t-e)}function Xg(n,e){return ie(()=>n==null?null:Array.isArray(n)?n.map(t=>Xg(t,e)):jN(n,e.dtype==="int32"?e:Pe(e,"int32")))}function Tm(n,e){const t=[];let i=0,r=null;for(;i<n;)r=i+e,r>=n&&(r=n),t.push([i,r]),i=r;return t}function bk(n){const e=[];n instanceof Ln&&(n=[n]);for(let t=0;t<n.length;++t){const i=n[t];if(i.rank===1)e.push(md(i,1));else{if(i.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(i)}}return e}function Fr(n,e){if(n==null)return;const t=[];if(e instanceof Ln)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const i=[];if(n instanceof Ln)t.indexOf(n.id)===-1&&i.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&i.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P9(n){return n instanceof Ln}function qg(n){return Array.isArray(n)}function lS(n){return!P9(n)&&!qg(n)}function cS(n,e,t,i=!0,r=""){if(e==null||e.length===0){if(n!=null){let s=!1;if(qg(n)&&n.length>0)s=!0;else if(lS(n)){for(const a in n)if(n.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new G(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(s=>null);let o;if(lS(n)){n=n,o=[];for(const s of e){if(n[s]==null)throw new G(`No data provided for "${s}". Need data for each key in: ${e}`);o.push(n[s])}}else if(qg(n)){if(n=n,n.length!==e.length)throw new G(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new G(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=bk(o),t!=null)for(let s=0;s<e.length;++s){if(t[s]==null)continue;const a=o[s];if(a.shape.length!==t[s].length)throw new G(`Error when checking ${r}: expected ${e[s]} to have ${t[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[s].length;++l){if(l===0&&!i)continue;const c=a.shape[l],u=t[s][l];if(u!=null&&u>=0&&c!==u)throw new G(`${r} expected a batch of elements where each example has shape [${t[s].slice(1,t[s].length)}] (i.e.,tensor shape [*,${t[s].slice(1,t[s].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function M9(n,e,t){const i=ms(n.map(o=>o.shape[0]));i.sort();const r=ms(e.map(o=>o.shape[0]));if(r.sort(),i.length>1)throw new G(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new G(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(i.length>0&&r.length>0&&!Ht(i,r))throw new G(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${r[0]} target sample(s).`)}function F9(n,e,t){const i=[Pp,Mp,qc];for(let r=0;r<n.length;++r){const o=n[r],s=e[r],a=t[r];if(s!=null){if(s===qc&&o.shape[o.shape.length-1]===1)throw new G(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(i.indexOf(s)!==-1){const l=o.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],f=c[u];if(f!=null&&d!==f)throw new G(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function uS(n,e,t,i=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new G(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new G(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let s=0;s<e.length;++s){if(t[s]==null)continue;const a=o[s];if(a.shape.length!==t[s].length)throw new G(`Error when checking ${r}: expected ${e[s]} to have ${t[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[s].length;++l){if(l===0&&!i)continue;const c=a.shape[l],u=t[s][l];if(u!=null&&u!==c)throw new G(`Error when checking ${r}: expected ${e[s]} to have shape ${JSON.stringify(t[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function L9(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(i=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(i=>t);{const i=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),i.push(o)}return i}}const z9="layers-model";class dl extends Lr{constructor(e){super(e),this.isTraining=!1}summary(e,t,i=console.log){if(!this.built)throw new G("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");w9(this,e,t,i)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=y9(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ps))throw new G("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const s in e.loss)if(this.outputNames.indexOf(s)===-1)throw new G(`Unknown entry in loss dictionary: "${s}". Only expected the following keys: ${this.outputNames}`);for(const s of this.outputNames)e.loss[s]==null&&console.warn(`Output "${s}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${s} during training`),t.push(km(e.loss[s]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new G(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>km(a))}else{const s=km(e.loss);this.outputs.forEach(a=>{t.push(s)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){const a=this.internalOutputShapes[s],l=this.outputNames[s];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[s])}const i=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ca("loss",()=>{for(let s=0;s<this.outputs.length;++s){if(i.indexOf(s)!==-1)continue;const a=this.lossFunctions[s];this.outputs.length>1&&(this.metricsTensors.push([a,s]),this.metricsNames.push(this.outputNames[s]+"_loss"))}});const r=L9(e.metrics,this.outputNames),o=(s,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[s]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,s])};ca("metric",()=>{for(let s=0;s<this.outputs.length;++s){if(i.indexOf(s)!==-1)continue;const a=r[s];(c=>{const u="";let d,f,h;for(const p of c){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[s];g[g.length-1]===1||this.lossFunctions[s]===Mp?["accuracy","acc"].indexOf(p)!==-1?f=uk:["crossentropy","ce"].indexOf(p)!==-1&&(f=u9):this.lossFunctions[s]===Vh?["accuracy","acc"].indexOf(p)!==-1?f=d9:["crossentropy","ce"].indexOf(p)!==-1&&(f=fk):["accuracy","acc"].indexOf(p)!==-1?f=dk:["crossentropy","ce"].indexOf(p)!==-1&&(f=hk);let v;["accuracy","acc"].indexOf(p)!==-1?v="acc":["crossentropy","ce"].indexOf(p)!==-1&&(v="ce"),h=f,d=u+v}else h=b9(p),d=u+Hd(p);let m;ca(d,()=>{m=h}),o(s,d,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,i={}){const r=i.batchSize==null?32:i.batchSize;Dm(r);const s=this.standardizeUserDataXY(e,t,!0,r);try{const a=s[0].concat(s[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,r,i.verbose,i.steps);return Oi(c)}finally{Fr(s[0],e),Fr(s[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),O9(this,e,t)}checkNumSamples(e,t,i,r="steps"){let o;if(i!=null){if(o=null,t!=null)throw new G(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new G(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new G("`outputs` is an empty Array, which is not allowed.");const i=Array.isArray(t),r=i?t:[t],o=this.retrieveSymbolicTensors(r),s=new us;if(e instanceof Ln&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new G(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)s.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new G(`No value is provided for the model's input ${l.name}`);s.add(l,c)}const a=Sc(o,s);return i?a:a[0]}retrieveSymbolicTensors(e){const t=Ia(null,e.length);let i=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],s=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=s.indexOf(e[a]);if(l!==-1&&(t[a]=o[l],i--),i===0)break}if(i===0)break}if(i>0){const r=[];throw t.forEach((o,s)=>{o==null&&r.push(e[s])}),new G(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,i=!1){return ie(()=>{const r=this.checkNumSamples(e);if(i)throw new bt("Verbose predictLoop() is not implemented yet.");const o=Tm(r,t),s=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ie(()=>{const c=o[a][0],u=o[a][1],d=bc(e,c,u),f=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)f.push({key:this.inputs[p],value:d[p]});else f.push({key:this.inputs[0],value:d});const h=new us(f);return Sc(this.outputs,h)}).forEach((c,u)=>s[u].push(c));return Oi(s.map(a=>Fi(a,0)))})}predict(e,t={}){const i=bk(e);uS(i,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return Dm(r),this.predictLoop(i,r)}finally{Fr(i,e)}}predictOnBatch(e){uS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,i=!0,r){if(this.optimizer_==null)throw new $r("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let s=0;s<this.feedOutputShapes.length;++s){const a=this.feedOutputShapes[s];this.feedLossFns[s]===Vh?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=cS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=cS(t,this.feedOutputNames,o,!1,"target"),M9(e,t),F9(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new G(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,i,r,o=!0,s){const[a,l]=this.standardizeUserDataXY(e,t,o,s);if(i!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const u=gk(r,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await vk(l[d],null,u[d]))}return[a,l,c]}testLoop(e,t,i,r=0,o){return ie(()=>{const s=this.checkNumSamples(t,i,o,"steps"),a=[];if(r>0)throw new bt("Verbose mode is not implemented yet.");if(o!=null)throw new bt("steps mode in testLoop() is not implemented yet");{const l=Tm(s,i),c=Xi(Ur(0,s));for(let u=0;u<l.length;++u){const d=l[u][0],f=l[u][1],h=ua(c,d,f-d),p=Xg(t,h),m=e(p);if(u===0)for(let g=0;g<m.length;++g)a.push(Gt(0));for(let g=0;g<m.length;++g){const v=m[g];a[g]=$e(a[g],K(f-d,v))}}for(let u=0;u<a.length;++u)a[u]=at(a[u],s)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let i=0;i<e.length;++i){const r=e[i];let o=r;if(XC(e,r)>1){const s=XC(e.slice(0,i),r);o+=`_${s}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],i=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),s=[],a=()=>{const d=[];for(let m=0;m<this.inputs.length;++m)d.push({key:this.inputs[m],value:i[m]});const f=new us(d),h=Sc(this.outputs,f,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let v=g(r[m],h[m]);o[m]!=null&&(v=k9(v,o[m]));const x=On(v);t.push(x),m===0?p=v:p=$e(p,v)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=t[m];else{const v=this.metricsTensors[m][0],x=this.metricsTensors[m][1];g=On(v(r[x],h[x]))}vo(g),s.push(g)}return p=On(p),this.calculateLosses().forEach(m=>{p=$e(p,m)}),p},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(s)}}makeTestFunction(){this.testFunction=e=>ie(()=>{const t=[];let i;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let c=0;c<this.inputs.length;++c)s.push({key:this.inputs[c],value:r[c]});const a=new us(s),l=Sc(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=On(u(o[c],l[c]));c===0?i=d:i=$e(i,d),t.push(i)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],f=On(u(o[d],l[d]));t.push(f)}return t})}async fit(e,t,i={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,s,a,l,c,u,d,f;try{const h=i.batchSize==null?32:i.batchSize;Dm(h);const m=await this.standardizeUserData(e,t,i.sampleWeight,i.classWeight,!1,h);r=m[0],o=m[1],f=m[2];let g=!1,v;if(i.validationData!=null&&i.validationData.length>0){if(g=!0,i.validationData.length===2)l=i.validationData[0],c=i.validationData[1];else throw i.validationData.length===3?new bt("validationData including sample weights is not supported yet."):new G(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${i.validationData} is invalid.`);const N=await this.standardizeUserData(l,c,null,null,!0,h);u=N[0],d=N[1],v=u.concat(d)}else if(i.validationSplit!=null&&i.validationSplit>0&&i.validationSplit<1){g=!0;const E=Math.floor(r[0].shape[0]*(1-i.validationSplit)),N=r[0].shape[0];u=bc(r,E,N),s=r,r=bc(r,0,E),d=bc(o,E,N),a=o,o=bc(o,0,E),v=u.concat(d)}else i.validationSteps!=null&&(g=!0);const x=r.concat(o).concat(f);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let y,C;g?(this.makeTestFunction(),y=this.testFunction,C=w.slice().concat(w.map(E=>"val_"+E))):(y=null,v=[],C=w.slice());const $=ak(i.callbacks,i.yieldEvery);return await this.fitLoop(b,x,w,h,i.epochs,i.verbose,$,y,v,i.shuffle,C,i.initialEpoch,null,null)}finally{this.isTraining=!1,Fr(r,e),Fr(o,t),Fr(s,e),Fr(a,t),Fr(u,l),Fr(d,c),f!=null&&yt(f)}}async fitLoop(e,t,i,r,o,s,a,l,c,u,d,f,h,p){r==null&&(r=32),o==null&&(o=1),u==null&&(u=!0),f==null&&(f=0);let m=!1;if(l!=null&&c!=null&&(m=!0),p!=null&&(m=!0,h==null))throw new G("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(t,r,h,"steps_per_epoch");let v;g!=null&&(v=Ur(0,g)),s==null&&(s=1);const{callbackList:x,history:b}=lk(a,s,o,f,g,h,r,m,d);x.setModel(this),this.history=b,await x.onTrainBegin(),this.stopTraining_=!1;for(let w=f;w<o;++w){await x.onEpochBegin(w);const y={};if(h!=null)throw new bt("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new bt("batch shuffling is not implemneted yet");u&&uH(v);const C=Xi(v),$=Tm(g,r);for(let I=0;I<$.length;++I){const E={};if(await x.onBatchBegin(I,E),ie(()=>{const N=$[I][0],k=$[I][1],D=ua(C,N,k-N);E.batch=I,E.size=k-N;const _=Xg(t,D),R=e(_);for(let T=0;T<i.length;++T){const A=i[T],O=R[T];E[A]=O,vo(O)}if(I===$.length-1&&m){const T=this.testLoop(l,c,r);for(let A=0;A<i.length;++A){const O=i[A],P=T[A];vo(P),y["val_"+O]=P}}}),await x.onBatchEnd(I,E),sk(E),this.stopTraining_)break}C.dispose()}if(await x.onEpochEnd(w,y),this.stopTraining_)break}return await x.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return R9(this,e,t)}async trainOnBatch(e,t){const i=await this.standardizeUserData(e,t),r=i[0],o=i[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return yt(a),Fr(i[0],e),Fr(i[1],t),Oi(l)}getNamedWeights(e){const t=[],i=e!=null&&e.trainableOnly,r=i?this.trainableWeights:this.weights,o=this.getWeights(i);for(let s=0;s<r.length;++s)i&&!r[s].trainable||t.push({name:r[s].originalName,tensor:o[s]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=kC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-kC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ao(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Ao(t))}else{const t=Object.keys(this.loss);e={};const i=this.loss;for(const r of t)if(typeof i[r]=="string")e[r]=Ao(i[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ao(Hd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ao(Hd(e)));{const e={};for(const t in this.metrics)e[t]=Ao(Hd(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Uh(e.optimizer_config),i=wo(t);let r;if(typeof e.loss=="string")r=Ys(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(s=>Ys(s));else if(e.loss!=null){r={};for(const s in e.loss)r[s]=Ys(e.loss[s])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(s=>Ys(s));else if(e.metrics!=null){o={};for(const s in e.metrics)o[s]=Ys(e.metrics[s])}this.compile({loss:r,metrics:o,optimizer:i})}async save(e,t){if(typeof e=="string"){const c=gU(e);if(c.length===0)throw new G(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new G(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new G("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const i=await DC(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:z9,generatedBy:`TensorFlow.js tfjs-layers v${mk}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await DC(await this.optimizer.getWeights(),c);i.specs.push(...d),i.data=lU([i.data,u])}return this.userDefinedMetadata!=null&&(oS(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=i.data,a.weightSpecs=i.specs,e.save(a)}setUserDefinedMetadata(e){oS(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}dl.className="Model";Ce(dl);class yk extends dl{}yk.className="Functional";Ce(yk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function wk(n,e){if(e==null&&(e={}),typeof n=="string"){const t=vU(n,e);if(t.length===0)t.push(K8(n,e));else if(t.length>1)throw new G(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return B9(n,void 0,e)}async function B9(n,e,t){if(t==null&&(t={}),n.load==null)throw new G("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const i=await n.load();let r=i.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,s=i.weightData!=null&&i.weightSpecs!=null&&o,a=wo(Uh(r),e,s),l=i.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),i.userDefinedMetadata!=null&&a.setUserDefinedMetadata(i.userDefinedMetadata),i.weightData!=null){if(i.weightSpecs==null)throw new G("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=V9(i.weightData,i.weightSpecs);a.loadWeights(c,o),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),yt(c),yt(u.map(d=>d.tensor))}return a}function V9(n,e){const t=nU(n,e),i={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):i[o.name]=t[o.name]}),{modelWeights:i,optimizerWeights:r}}class Pl extends dl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:_p("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(i=>i<0))throw new G(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Pl||e instanceof dl;let i;if(t){if(i=e,i.outputs.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(i.inputs.length!==1)throw new G("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new G("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=Vq({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=i.outputs,this.inputs=i.inputs;else{if(e.inboundNodes.length!==1)throw new G(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=tk(this.outputs[0])}this.inboundNodes=[],new Op({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ia(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Vt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new dl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,i=console.log){this.built||this.build(),super.summary(e,t,i)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,i={}){if(!this.built)throw new $r("The model needs to be compiled before being used.");return this.model.evaluate(e,t,i)}async evaluateDataset(e,t){if(!this.built)throw new $r("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,i={}){if(!this.built)throw new $r("The model needs to be compiled before being used.");return this.model.fit(e,t,i)}async fitDataset(e,t){if(!this.built)throw new $r("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,i={},r=!1){let o,s={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new G("Legacy serialization format not supported yet.");o=t}else F(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,s=t;const a=new e(s);if(!(a instanceof Pl))throw new bt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const u=wo(l,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new G("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new G("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const i={};i.className=t.getClassName(),i.config=t.getConfig(),e.push(i)}return{name:this.name,layers:e}}}Pl.className="Sequential";Ce(Pl);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function W9(n){return new Pl(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let xi=class extends nc{getConfig(){return{}}};class Ck extends xi{apply(e,t=1){return $q(e,t)}}Ck.className="elu";Ce(Ck);class Sk extends xi{apply(e){return F2(e)}}Sk.className="selu";Ce(Sk);class Ik extends xi{apply(e){return Ma(e)}}Ik.className="relu";Ce(Ik);class $k extends xi{apply(e){return ie(()=>jc(6,Ma(e)))}}$k.className="relu6";Ce($k);class Ek extends xi{apply(e){return e}}Ek.className="linear";Ce(Ek);class Nk extends xi{apply(e){return Ql(e)}}Nk.className="sigmoid";Ce(Nk);class kk extends xi{apply(e){return Nq(e)}}kk.className="hardSigmoid";Ce(kk);class Dk extends xi{apply(e){return ad(e)}}Dk.className="softplus";Ce(Dk);class Tk extends xi{apply(e){return Eq(e)}}Tk.className="softsign";Ce(Tk);class Rk extends xi{apply(e){return Cp(e)}}Rk.className="tanh";Ce(Rk);let Fb=class extends xi{apply(e,t=-1){return z0(e,t)}};Fb.className="softmax";Ce(Fb);class _k extends xi{apply(e,t=-1){return N2(e,t)}}_k.className="logSoftmax";Ce(_k);class Ak extends xi{apply(e){return ie(()=>ie(()=>{const t=Math.sqrt(2),i=K(.5,$e(1,C2(at(e,t))));return K(e,i)}))}}Ak.className="gelu";Ce(Ak);class Ok extends xi{apply(e){return ie(()=>K(.5,K(e,$e(1,Cp(K(gi(at(2,Math.PI)),$e(e,K(.044715,wa(e,3)))))))))}}Ok.className="gelu_new";Ce(Ok);class Pk extends xi{apply(e){return ie(()=>K(e,Cp(ad(e))))}}Pk.className="mish";Ce(Pk);class Mk extends xi{apply(e,t=1){return ie(()=>K(Ql(K(e,t)),e))}}Mk.className="swish";Ce(Mk);function Ss(n){return n.getClassName()}function Rm(n,e={}){return pd(n,yr.getMap().classNameMap,e,"activation")}function Is(n){if(n==null){const e={};return e.className="linear",e.config={},Rm(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Rm(e)}else return n instanceof xi?n:Rm(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G9(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class Fk extends nc{}class Lk extends Fk{constructor(e){super(),G9(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ie(()=>{let t=Yn([1]);return this.hasL1&&(t=$e(t,rt(K(this.l1,wi(e))))),this.hasL2&&(t=$e(t,rt(K(this.l2,gd(e))))),ee(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Lk.className="L1L2";Ce(Lk);const dS={l1l2:"L1L2"};function Jt(n){return Sb(n)}function hS(n,e={}){return pd(n,yr.getMap().classNameMap,e,"regularizer")}function fn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in dS?dS[n]:n,config:{}};return hS(t)}else return n instanceof Fk?n:hS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zk extends St{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=ut(e);let i=Ma(e);return this.maxValue!=null&&(i=cr(i,0,this.maxValue)),i}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}zk.className="ReLU";Ce(zk);class Bk extends St{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const i=ut(e);return S0(i,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Bk.className="LeakyReLU";Ce(Bk);class Vk extends St{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=hn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=fn(e.alphaRegularizer),this.alphaConstraint=Wn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new G(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Vt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const i={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)i[r]=e[r];this.inputSpec=[new Bn({ndim:e.length,axes:i})],this.built=!0}call(e,t){return e=ut(e),D0(e,this.alpha.read())}getConfig(){const e={alphaInitializer:gn(this.alphaInitializer),alphaRegularizer:Jt(this.alphaRegularizer),alphaConstraint:Vn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}Vk.className="PReLU";Ce(Vk);let Wk=class extends St{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new bt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const i=ut(e);return $p(i)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};Wk.className="ELU";Ce(Wk);class Gk extends St{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const i=ut(e);return K(i,Pe(ur(i,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}Gk.className="ThresholdedReLU";Ce(Gk);class Hk extends St{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Fb().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ie(()=>{let i=ut(e);const r=t.mask;if(r!=null){const o=K(ct(Os(i.shape),Pe(r,i.dtype)),Gt(-1e9));i=$e(i,o)}return this.axis instanceof Array?this.axis.length>1?$o(ct(i,k2(i,this.axis,!0))):this.softmax(i,this.axis[0]):this.softmax(i,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Hk.className="Softmax";Ce(Hk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hl(n,e,t){if(typeof n=="number")return Ia(n,e);if(n.length!==e)throw new G(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let i=0;i<e;++i){const r=n[i];if(!wq(r))throw new G(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Hr(n,e,t,i,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let s;return t==="same"?s=n:s=n-o+1,Math.floor((s+i-1)/i)}function co(n,e,t,i){if(n==null)return null;if(i==="valid")n=n*e+Cs([t-e,0]);else if(i==="same")n=n*e;else throw new G(`Unsupport padding mode: ${i}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lb(n,e){return ie(()=>(Tn(e),e==="channelsFirst"?Pt(n,[0,2,3,1]):n))}function Uk(n,e){return ie(()=>(Tn(e),e==="channelsFirst"?Pt(n,[0,2,3,4,1]):n))}function H9(n,e,t,i=1,r="valid",o,s=1){return ie(()=>{if(o==null&&(o=jr()),Tn(o),n.shape.length!==3)throw new G(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new G(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new G(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=Pt(n,[0,2,1])),r==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=v2(n,e,i,r==="same"?"same":"valid","NWC",s);return t!=null&&(a=Yr(a,t)),a})}function fS(n,e,t,i=[1,1],r="valid",o,s,a=null){return ie(()=>{if(o==null&&(o=jr()),Tn(o),n.rank!==3&&n.rank!==4)throw new G(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new G(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Lb(n,o);if(r==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=H5({x:l,filter:e,strides:i,pad:r==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(l=Pt(l,[0,3,1,2])),l})}function U9(n,e,t,i=[1,1,1],r="valid",o,s){return ie(()=>{if(o==null&&(o=jr()),Tn(o),n.rank!==4&&n.rank!==5)throw new G(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new G(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=Uk(n,o);if(r==="causal")throw new bt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=K6(a,e,i,r==="same"?"same":"valid","NDHWC",s),t!=null&&(a=Yr(a,t)),o==="channelsFirst"&&(a=Pt(a,[0,4,1,2,3])),a})}class Fp extends St{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Fp.verifyArgs(t),this.rank=e,Jn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new bt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=hl(t.kernelSize,e,"kernelSize"),this.strides=hl(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,dr(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Tn(this.dataFormat),this.activation=Is(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=hn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Wn(t.biasConstraint),this.biasRegularizer=fn(t.biasRegularizer),this.activityRegularizer=fn(t.activityRegularizer),this.dilationRate=hl(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new G(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new G(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new G(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(lo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Ib(e.kernelSize,"number",1,3))throw new G(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ss(this.activation),useBias:this.useBias,biasInitializer:gn(this.biasInitializer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),biasConstraint:Vn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class ic extends Fp{constructor(e,t){super(e,t),this.kernel=null,ic.verifyArgs(t),this.filters=t.filters,Jn(this.filters,"filters"),this.kernelInitializer=hn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Wn(t.kernelConstraint),this.kernelRegularizer=fn(t.kernelRegularizer)}build(e){e=Vt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[t]}`);const i=e[t],r=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:i}}],this.built=!0}call(e,t){return ie(()=>{e=ut(e);let i;const r=this.bias==null?null:this.bias.read(),o=BN(this.activation.getClassName());if(o!=null&&this.rank===2)i=fS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)i=H9(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)i=fS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)i=U9(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new bt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(i=this.activation.apply(i))}return i})}computeOutputShape(e){e=Vt(e);const t=[],i=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<i.length;++o){const s=Hr(i[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(s)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:gn(this.kernelInitializer),kernelRegularizer:Jt(this.kernelRegularizer),kernelConstraint:Vn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new G(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class yd extends ic{constructor(e){super(2,e),yd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ib(e.kernelSize,"number",1,2))throw new G(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}yd.className="Conv2D";Ce(yd);class wd extends ic{constructor(e){super(3,e),wd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new G(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}wd.className="Conv3D";Ce(wd);class jk extends yd{constructor(e){if(super(e),this.inputSpec=[new Bn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vt(e),e.length!==4)throw new G("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const i=e[t],r=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Bn({ndim:4,axes:{[t]:i}})],this.built=!0}call(e,t){return ie(()=>{let i=ut(e);if(i.shape.length!==4)throw new G(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);const r=i.shape,o=r[0];let s,a;this.dataFormat==="channelsFirst"?(s=2,a=3):(s=1,a=2);const l=r[s],c=r[a],u=this.kernelSize[0],d=this.kernelSize[1],f=this.strides[0],h=this.strides[1],p=co(l,f,u,this.padding),m=co(c,h,d,this.padding),g=[o,p,m,this.filters];this.dataFormat!=="channelsLast"&&(i=Pt(i,[0,2,3,1]));let v=x2(i,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=Pt(v,[0,3,1,2])),this.bias!=null&&(v=Yr(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=Vt(e);const t=e.slice();let i,r,o;this.dataFormat==="channelsFirst"?(i=1,r=2,o=3):(i=3,r=1,o=2);const s=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[i]=this.filters,t[r]=co(t[r],l,s,this.padding),t[o]=co(t[o],c,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}jk.className="Conv2DTranspose";Ce(jk);class Kk extends wd{constructor(e){if(super(e),this.inputSpec=[new Bn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vt(e),e.length!==5)throw new G("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const i=e[t],r=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Bn({ndim:5,axes:{[t]:i}})],this.built=!0}call(e,t){return ie(()=>{let i=ut(e);if(i.shape.length!==5)throw new G(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);const r=i.shape,o=r[0];let s,a,l;this.dataFormat==="channelsFirst"?(l=2,s=3,a=4):(l=1,s=2,a=3);const c=r[l],u=r[s],d=r[a],f=this.kernelSize[0],h=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],v=this.strides[2],x=co(c,m,f,this.padding),b=co(u,g,h,this.padding),w=co(d,v,p,this.padding),y=[o,x,b,w,this.filters];this.dataFormat!=="channelsLast"&&(i=Pt(i,[0,2,3,4,1]));let C=Y6(i,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=Pt(C,[0,4,1,2,3])),this.bias!==null&&(C=Yr(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=Vt(e);const t=e.slice();let i,r,o,s;this.dataFormat==="channelsFirst"?(i=1,r=2,o=3,s=4):(i=4,r=1,o=2,s=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],f=this.strides[2];return t[i]=this.filters,t[r]=co(t[r],u,a,this.padding),t[o]=co(t[o],d,l,this.padding),t[s]=co(t[s],f,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Kk.className="Conv3DTranspose";Ce(Kk);class Xk extends ic{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new G("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new G("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new G(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=hn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=fn(t.depthwiseRegularizer),this.depthwiseConstraint=Wn(t.depthwiseConstraint),this.pointwiseInitializer=hn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=fn(t.pointwiseRegularizer),this.pointwiseConstraint=Wn(t.pointwiseConstraint)}build(e){if(e=Vt(e),e.length<this.rank+2)throw new G(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new G(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const i=e[t],r=this.kernelSize.concat([i,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(i*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new Bn({ndim:this.rank+2,axes:{[t]:i}})],this.built=!0}call(e,t){return ie(()=>{e=ut(e);let i;if(this.rank===1)throw new bt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Pt(e,[0,2,3,1])),i=L2(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(i=Yr(i,this.bias.read(),this.dataFormat)),this.activation!=null&&(i=this.activation.apply(i)),this.dataFormat==="channelsFirst"&&(i=Pt(i,[0,3,1,2])),i})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=gn(this.depthwiseInitializer),e.pointwiseInitializer=gn(this.pointwiseInitializer),e.depthwiseRegularizer=Jt(this.depthwiseRegularizer),e.pointwiseRegularizer=Jt(this.pointwiseRegularizer),e.depthwiseConstraint=Vn(this.depthwiseConstraint),e.pointwiseConstraint=Vn(this.pointwiseConstraint),e}}Xk.className="SeparableConv";class qk extends Xk{constructor(e){super(2,e)}}qk.className="SeparableConv2D";Ce(qk);class Lp extends ic{constructor(e){super(1,e),Lp.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ib(e.kernelSize,"number",1,1))throw new G(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Lp.className="Conv1D";Ce(Lp);class Yk extends St{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ie(()=>{if(e=ut(e),this.dataFormat==="channelsLast"){const i=Gd(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Gd(i,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const i=Gd(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Gd(i,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Yk.className="Cropping2D";Ce(Yk);class Jk extends St{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Tn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,xq(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],i=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,i]}else{const t=e[1]==null?null:this.size[0]*e[1],i=e[2]==null?null:this.size[1]*e[2];return[e[0],t,i,e[3]]}}call(e,t){return ie(()=>{let i=ut(e);const r=i.shape;if(this.dataFormat==="channelsFirst"){i=Pt(i,[0,2,3,1]);const o=this.size[0]*r[2],s=this.size[1]*r[3],a=this.interpolation==="nearest"?Bo.resizeNearestNeighbor(i,[o,s]):Bo.resizeBilinear(i,[o,s]);return Pt(a,[0,3,1,2])}else{const o=this.size[0]*r[1],s=this.size[1]*r[2];return this.interpolation==="nearest"?Bo.resizeNearestNeighbor(i,[o,s]):Bo.resizeBilinear(i,[o,s])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}Jk.className="UpSampling2D";Ce(Jk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function j9(n,e,t=[1,1],i="valid",r,o){return ie(()=>{r==null&&(r=jr()),Tn(r);let s=Lb(n,r);if(n.rank!==4)throw new G(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new G(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return s=b0(s,e,t,i==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(s=Pt(s,[0,3,1,2])),s})}class Zk extends Fp{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=hn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Wn(e.depthwiseConstraint),this.depthwiseRegularizer=fn(e.depthwiseRegularizer)}build(e){if(e=Vt(e),e.length<4)throw new G(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new G(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const i=e[t],r=[this.kernelSize[0],this.kernelSize[1],i,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[i*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ie(()=>{e=ut(e);let i=j9(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(i=Yr(i,this.bias.read(),this.dataFormat)),this.activation!=null&&(i=this.activation.apply(i)),i})}computeOutputShape(e){e=Vt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Hr(t,this.kernelSize[0],this.padding,this.strides[0]),s=Hr(i,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,s]:[e[0],o,s,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=gn(this.depthwiseInitializer),e.depthwiseRegularizer=Jt(this.depthwiseRegularizer),e.depthwiseConstraint=Vn(this.depthwiseRegularizer),e}}Zk.className="DepthwiseConv2D";Ce(Zk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qk(n,e,t,i){if(Array.isArray(n)){if(e!=null||t!=null)throw new G("When inputs is an array, neither initialState or constants should be provided");i!=null&&(t=n.slice(n.length-i,n.length),n=n.slice(0,n.length-i)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function eD(n,e,t,i=!1,r,o,s=!1,a=!1){return ie(()=>{const l=e.shape.length;if(l<3)throw new G(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Ur(2,l));e=Pt(e,c),s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Pe(Pe(r,"bool"),"float32"),r.rank===l-1&&(r=Ai(r,-1)),r=Pt(r,c)),i&&(e=Ca(e,0),r!=null&&(r=Ca(r,0)));const u=[];let d,f=t;const h=e.shape[0],p=Sa(e);let m;r!=null&&(m=Sa(r));for(let v=0;v<h;++v){const x=p[v],b=ie(()=>n(x,f));if(r==null)d=b[0],f=b[1];else{const w=ie(()=>{const y=m[v],C=ct(Dr(y),y),$=$e(K(b[0],y),K(f[0],C)),I=f.map((E,N)=>$e(K(b[1][N],y),K(E,C)));return{output:$,newStates:I}});d=w.output,f=w.newStates}a&&u.push(d)}let g;return a&&(g=jo(u,1)),[d,g,f]})}class Ms extends St{constructor(e){super(e);let t;if(e.cell==null)throw new G("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Vb({cells:e.cell}):t=e.cell,t.stateSize==null)throw new G("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Bn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ur(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Hg(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const i=t[0];let r;if(this.returnSequences?r=[e[0],e[1],i]:r=[e[0],i],this.returnState){const o=[];for(const s of t)o.push([e[0],s]);return[r].concat(o)}else return r}computeMask(e,t){return ie(()=>{Array.isArray(t)&&(t=t[0]);const i=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[i].concat(r)}else return i})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let i=0;i<e;++i)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new bt("Constants support is not implemented in RNN yet.");Hg(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Bn({shape:[t,null,...i]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Ht(this.stateSpec.map(s=>s.shape[s.shape.length-1]),o))throw new G(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(s=>new Bn({shape:[null,s]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ie(()=>{if(!this.stateful)throw new ao("Cannot call resetStates() on an RNN Layer that is not stateful.");const i=this.inputSpec[0].shape[0];if(i==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Yn([i,r])):this.states_=[Yn([i,this.cell.stateSize])];else if(e==null)yt(this.states_),this.keptStates!=null&&(yt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Yn([i,r])):this.states_[0]=Yn([i,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):yt(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],s=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[i,s];if(!Ht(o.shape,a))throw new G(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>vo(r.clone()))})}apply(e,t){let i=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=Qk(e,i,r,this.numConstants);e=o.inputs,i=o.initialState,r=o.constants;let s=[],a=[];if(i!=null){t.initialState=i,s=s.concat(i),this.stateSpec=[];for(const c of i)this.stateSpec.push(new Bn({shape:c.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,s=s.concat(r),this.numConstants=r.length),s[0]instanceof No){const c=[e].concat(s),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const f=super.apply(c,t);return this.inputSpec=d,f}else return super.apply(e,t)}call(e,t){return ie(()=>{const i=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=ut(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==s)throw new G(`RNN Layer has ${s} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},c=eD((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},e,o,this.goBackwards,i,null,this.unroll,this.returnSequences),u=c[0],d=c[1],f=c[2];this.stateful&&this.resetStates(f,r);const h=this.returnSequences?d:u;return this.returnState?[h].concat(f):h})}getInitialState(e){return ie(()=>{let t=Yn(e.shape);return t=rt(t,[1,2]),t=md(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(i=>i>1?Wg(t,[1,i]):t):this.cell.stateSize>1?[Wg(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const i=this.cell.getConfig();return this.getClassName()===Ms.className&&(t.cell={className:this.cell.getClassName(),config:i}),Object.assign(Object.assign(Object.assign({},i),e),t)}static fromConfig(e,t,i={}){const r=t.cell,o=wo(r,i);return new e(Object.assign(t,{cell:o}))}}Ms.className="RNN";Ce(Ms);class zp extends St{}class zb extends zp{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Jn(this.units,"units"),this.activation=Is(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=hn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=fn(e.kernelRegularizer),this.recurrentRegularizer=fn(e.recurrentRegularizer),this.biasRegularizer=fn(e.biasRegularizer),this.kernelConstraint=Wn(e.kernelConstraint),this.recurrentConstraint=Wn(e.recurrentConstraint),this.biasConstraint=Wn(e.biasConstraint),this.dropout=Ol([1,Cs([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ol([1,Cs([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ie(()=>{if(e=e,e.length!==2)throw new G(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let i=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$s({ones:()=>Dr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$s({ones:()=>Dr(i),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const s=this.dropoutMask,a=this.recurrentDropoutMask;s!=null?o=yo(K(e,s),this.kernel.read()):o=yo(e,this.kernel.read()),this.bias!=null&&(o=Yr(o,this.bias.read())),a!=null&&(i=K(i,a));let l=$e(o,yo(i,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ss(this.activation),useBias:this.useBias,kernelInitializer:gn(this.kernelInitializer),recurrentInitializer:gn(this.recurrentInitializer),biasInitializer:gn(this.biasInitializer),kernelRegularizer:Jt(this.kernelRegularizer),recurrentRegularizer:Jt(this.recurrentRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),recurrentConstraint:Vn(this.recurrentConstraint),biasConstraint:Vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}zb.className="SimpleRNNCell";Ce(zb);class tD extends Ms{constructor(e){e.cell=new zb(e),super(e)}call(e,t){return ie(()=>{this.cell.dropoutMask!=null&&(yt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(yt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:i,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}tD.className="SimpleRNN";Ce(tD);class Bb extends zp{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new G("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Jn(this.units,"units"),this.activation=Is(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Is(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=hn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=fn(e.kernelRegularizer),this.recurrentRegularizer=fn(e.recurrentRegularizer),this.biasRegularizer=fn(e.biasRegularizer),this.kernelConstraint=Wn(e.kernelConstraint),this.recurrentConstraint=Wn(e.recurrentConstraint),this.biasConstraint=Wn(e.biasConstraint),this.dropout=Ol([1,Cs([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ol([1,Cs([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ie(()=>{if(e=e,e.length!==2)throw new G(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const i=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$s({ones:()=>Dr(e),rate:this.dropout,training:i,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$s({ones:()=>Dr(r),rate:this.recurrentDropout,training:i,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,s=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=K(e,o[0]));let u=yo(e,this.kernel.read());this.useBias&&(u=Yr(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=K(r,s[0]));const d=this.recurrentKernel.read(),[f,h]=ar(d,[2*this.units,this.units],d.rank-1),p=yo(r,f),[m,g,v]=ar(u,3,u.rank-1),[x,b]=ar(p,2,p.rank-1);a=this.recurrentActivation.apply($e(m,x)),l=this.recurrentActivation.apply($e(g,b));const w=yo(K(l,r),h);c=this.activation.apply($e(v,w));const y=$e(K(a,r),K($e(1,In(a)),c));return[y,y]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ss(this.activation),recurrentActivation:Ss(this.recurrentActivation),useBias:this.useBias,kernelInitializer:gn(this.kernelInitializer),recurrentInitializer:gn(this.recurrentInitializer),biasInitializer:gn(this.biasInitializer),kernelRegularizer:Jt(this.kernelRegularizer),recurrentRegularizer:Jt(this.recurrentRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),recurrentConstraint:Vn(this.recurrentConstraint),biasConstraint:Vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Bb.className="GRUCell";Ce(Bb);class nD extends Ms{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Bb(e),super(e)}call(e,t){return ie(()=>{this.cell.dropoutMask!=null&&(yt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(yt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:i,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}nD.className="GRU";Ce(nD);class Bp extends zp{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Jn(this.units,"units"),this.activation=Is(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Is(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=hn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=fn(e.kernelRegularizer),this.recurrentRegularizer=fn(e.recurrentRegularizer),this.biasRegularizer=fn(e.biasRegularizer),this.kernelConstraint=Wn(e.kernelConstraint),this.recurrentConstraint=Wn(e.recurrentConstraint),this.biasConstraint=Wn(e.biasConstraint),this.dropout=Ol([1,Cs([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ol([1,Cs([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Vt(e);const i=e[e.length-1];this.kernel=this.addWeight("kernel",[i,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,s=this.units;r=new(t=class extends Ar{apply(l,c){const u=o.apply([s]),d=new Eb().apply([s]),f=o.apply([s*2]);return YC(YC(u,d),f)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ie(()=>{const i=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new G(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$s({ones:()=>Dr(e),rate:this.dropout,training:i,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$s({ones:()=>Dr(r),rate:this.recurrentDropout,training:i,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=K(e,s[0]));let f=yo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=K(r,a[0])),f=$e(f,yo(r,this.recurrentKernel.read())),this.useBias&&(f=Yr(f,this.bias.read()));const[h,p,m,g]=ar(f,4,f.rank-1);l=this.recurrentActivation.apply(h),c=this.recurrentActivation.apply(p),u=$e(K(c,o),K(l,this.activation.apply(m))),d=this.recurrentActivation.apply(g);const v=K(d,this.activation.apply(u));return[v,v,u]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ss(this.activation),recurrentActivation:Ss(this.recurrentActivation),useBias:this.useBias,kernelInitializer:gn(this.kernelInitializer),recurrentInitializer:gn(this.recurrentInitializer),biasInitializer:gn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Jt(this.kernelRegularizer),recurrentRegularizer:Jt(this.recurrentRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),recurrentConstraint:Vn(this.recurrentConstraint),biasConstraint:Vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Bp.className="LSTMCell";Ce(Bp);class iD extends Ms{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Bp(e),super(e)}call(e,t){return ie(()=>{this.cell.dropoutMask!=null&&(yt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(yt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:i,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}iD.className="LSTM";Ce(iD);class Vb extends zp{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ie(()=>{e=e;let i=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(i.splice(0,a.stateSize.length)):r.push(i.splice(0,1));r.reverse();const o=[];let s;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];i=r[a],a===0?s=[e[0]].concat(i):s=[s[0]].concat(i),s=l.call(s,t),o.push(s.slice(1))}i=[];for(const a of o.slice().reverse())i.push(...a);return[s[0]].concat(i)})}build(e){Hg(e)&&(e=e[0]),e=e;let t;this.cells.forEach((i,r)=>{ca(`RNNCell_${r}`,()=>{i.build(e),Array.isArray(i.stateSize)?t=i.stateSize[0]:t=i.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,i={}){const r=[];for(const o of t.cells)r.push(wo(o,i));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const i of this.cells)t.push(...i.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Ug(e)}setWeights(e){const t=[];for(const i of this.cells){const r=i.weights.length,o=e.splice(r);for(let s=0;s<i.weights.length;++s)t.push([i.weights[s],o[s]])}Ab(t)}}Vb.className="StackedRNNCells";Ce(Vb);function $s(n){const{ones:e,rate:t,training:i=!1,count:r=1,dropoutFunc:o}=n,s=()=>o!=null?o(e(),t):KN(e(),t),a=()=>vd(s,e,i);return!r||r<=1?vo(a().clone()):Array(r).fill(void 0).map(a).map(c=>vo(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var K9=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};class rD extends Ms{constructor(e){if(e.unroll)throw new bt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new bt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Bn({ndim:5})]}call(e,t){return ie(()=>{if(this.cell.dropoutMask!=null&&(yt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(yt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new G("ConvRNN2D cell does not support constants");const i=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:i,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ie(()=>{const{stateSize:t}=this.cell,i=e.shape,r=this.computeSingleOutputShape(i),o=[r[0],...r.slice(2)],s=Yn(o);return Array.isArray(t)?Array(t.length).fill(s):[s]})}resetStates(e,t=!1){ie(()=>{if(!this.stateful)throw new ao("Cannot call resetStates() on an RNN Layer that is not stateful.");const i=this.inputSpec[0].shape,r=this.computeSingleOutputShape(i),o=[r[0],...r.slice(2)];if(i[0]==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Yn(o)):this.states_=[Yn(o)];else if(e==null)yt(this.states_),this.keptStates!=null&&(yt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Yn(o)):this.states_[0]=Yn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):yt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=o;if(!Ht(l.shape,c))throw new G(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>vo(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:i,kernelSize:r,padding:o,strides:s,dilationRate:a}=this.cell,l=t==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=Hr(c,r[0],o,s[0],a[0]),f=Hr(u,r[1],o,s[1],a[1]);return[...e.slice(0,2),...l?[i,d,f]:[d,f,i]]}}rD.className="ConvRNN2D";class Wb extends Bp{constructor(e){const{filters:t,kernelSize:i,strides:r,padding:o,dataFormat:s,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Jn(this.filters,"filters"),this.kernelSize=hl(i,2,"kernelSize"),this.kernelSize.forEach(l=>Jn(l,"kernelSize")),this.strides=hl(r||1,2,"strides"),this.strides.forEach(l=>Jn(l,"strides")),this.padding=o||"valid",dr(this.padding),this.dataFormat=s||"channelsLast",Tn(this.dataFormat),this.dilationRate=hl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Jn(l,"dilationRate"))}build(e){var t;e=Vt(e);const i=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[i]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[i]}`);const r=e[i],o=4,s=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(t=class extends Ar{apply(f,h){const p=c.apply([u]),m=Os([u]),g=c.apply([u*2]);return $b([p,m,g])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ie(()=>{if(e.length!==3)throw new G(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const i=t.training||!1,r=e[0],o=e[1],s=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$s({ones:()=>Dr(r),rate:this.dropout,training:i,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(z,L,W)=>!L||!L[W]?z:K(L[W],z);let u=c(r,l,0),d=c(r,l,1),f=c(r,l,2),h=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$s({ones:()=>Dr(o),rate:this.recurrentDropout,training:i,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=c(o,p,0),g=c(o,p,1),v=c(o,p,2),x=c(o,p,3);const b=3,[w,y,C,$]=ar(this.kernel.read(),a,b),[I,E,N,k]=this.useBias?ar(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,w,I,this.padding),d=this.inputConv(d,y,E,this.padding),f=this.inputConv(f,C,N,this.padding),h=this.inputConv(h,$,k,this.padding);const[D,_,R,T]=ar(this.recurrentKernel.read(),a,b);m=this.recurrentConv(m,D),g=this.recurrentConv(g,_),v=this.recurrentConv(v,R),x=this.recurrentConv(x,T);const A=this.recurrentActivation.apply($e(u,m)),O=this.recurrentActivation.apply($e(d,g)),P=$e(K(O,s),K(A,this.activation.apply($e(f,v)))),M=K(this.recurrentActivation.apply($e(h,x)),this.activation.apply(P));return[M,M,P]})}getConfig(){const e=super.getConfig(),t=K9(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),i)}inputConv(e,t,i,r){const o=ya(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return i?Yr(o,i,this.dataFormat):o}recurrentConv(e,t){return ya(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Wb.className="ConvLSTM2DCell";Ce(Wb);class oD extends rD{constructor(e){const t=new Wb(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}oD.className="ConvLSTM2D";Ce(oD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gb extends St{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,i=[];for(let r=0;r<this.noiseShape.length;++r)i.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return i}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(i);return vd(()=>KN(i,this.rate,o,this.seed),()=>i,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Gb.className="Dropout";Ce(Gb);class sD extends Gb{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}sD.className="SpatialDropout1D";Ce(sD);class Hb extends St{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Jn(this.units,"units"),this.activation=Is(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Wn(e.kernelConstraint),this.biasConstraint=Wn(e.biasConstraint),this.kernelRegularizer=fn(e.kernelRegularizer),this.biasRegularizer=fn(e.biasRegularizer),this.activityRegularizer=fn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Vt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Vt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e),r=BN(this.activation.getClassName());let o;return r!=null?o=yo(i,this.kernel.read(),r,this.bias?this.bias.read():null):(o=yo(i,this.kernel.read()),this.bias!=null&&(o=Yr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:Ss(this.activation),useBias:this.useBias,kernelInitializer:gn(this.kernelInitializer),biasInitializer:gn(this.biasInitializer),kernelRegularizer:Jt(this.kernelRegularizer),biasRegularizer:Jt(this.biasRegularizer),activityRegularizer:Jt(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),biasConstraint:Vn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Hb.className="Dense";Ce(Hb);class aD extends St{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Vt(e);for(const t of e.slice(1))if(t==null)throw new G(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],gs(e,1)]}call(e,t){return ie(()=>{this.invokeCallHook(e,t);let i=ut(e);if(this.dataFormat==="channelsFirst"&&i.rank>1){const r=[0];for(let o=2;o<i.rank;++o)r.push(o);r.push(1),i=Pt(i,r)}return Iq(i)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}aD.className="Flatten";Ce(aD);class lD extends St{constructor(e){super(e),this.supportsMasking=!0,this.activation=Is(e.activation)}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e);return this.activation.apply(i)})}getConfig(){const e={activation:Ss(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}lD.className="Activation";Ce(lD);class cD extends St{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ie(()=>(e=ut(e),Cq(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}cD.className="RepeatVector";Ce(cD);class uD extends St{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const i="Total size of new array must be unchanged.",r=t.slice();let o=1,s=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(s===null)s=l;else throw new G("Can only specifiy one unknown dimension.");else o*=c}const a=gs(e);if(s!==null){if(o===0||a%o!==0)throw new G(i);r[s]=a/o}else if(a!==o)throw new G(i);return r}computeOutputShape(e){let t=!1;for(let i=0;i<e.length;++i)if(this.isUnknown(e[i])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e),r=i.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ee(i,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}uD.className="Reshape";Ce(uD);class dD extends St{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Ur(1,e.dims.length+1);if(!Ht(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Bn({ndim:this.dims.length+1})]}computeOutputShape(e){e=Vt(e);const t=e.slice();return this.dims.forEach((i,r)=>{t[r+1]=e[i]}),t}call(e,t){return Pt(ut(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}dD.className="Permute";Ce(dD);class hD extends St{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const i=ut(e);return Pg(Ah(i,this.maskValue),-1)}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e),s=Pg(Ah(i,this.maskValue),-1,!0);return K(i,Pe(s,i.dtype))})}}hD.className="Masking";Ce(hD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fD extends St{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(jt(e.inputLength))}this.inputDim=e.inputDim,Jn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Jn(this.outputDim,"outputDim"),this.embeddingsInitializer=hn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=fn(e.embeddingsRegularizer),this.activityRegularizer=fn(e.activityRegularizer),this.embeddingsConstraint=Wn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ie(()=>this.maskZero?(e=ut(e),Ah(e,Mt(e))):null)}computeOutputShape(e){if(e=Vt(e),this.inputLength==null)return[...e,this.outputDim];const t=jt(this.inputLength);if(t.length!==e.length-1)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let i=0;for(let r=0;r<t.length;++r){const o=t[r],s=e[r+1];if(o!=null&&s!=null&&o!==s)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[i]=s),i++}}return[e[0],...t,this.outputDim]}call(e,t){return ie(()=>{this.invokeCallHook(e,t);let i=ut(e);i.dtype!=="int32"&&(i=bo(i,"int32"));const r=jN(this.embeddings.read(),ee(i,[i.size]));return ee(r,Vt(this.computeOutputShape(i.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:gn(this.embeddingsInitializer),embeddingsRegularizer:Jt(this.embeddingsRegularizer),activityRegularizer:Jt(this.activityRegularizer),embeddingsConstraint:Vn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}fD.className="Embedding";Ce(fD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class za extends St{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new bt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const i=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],s=t[r];if(o==null||s==null||o<0||s<0)i.push(null);else if(o===1)i.push(s);else if(s===1)i.push(o);else{if(o!==s)throw new G("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));i.push(o)}}return i}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Vt(e)]),e=e,e.length<2)throw new G(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=ms(t),t.length>1)throw new G(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let i=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const s=e[o]==null?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&ms(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ie(()=>{if(e=e,this.reshapeRequired){const i=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Cs(r);for(let s of e){const a=s.rank;for(let l=0;l<o-a;++l)s=md(s,1);i.push(s)}return this.mergeFunction(i)}else{let o=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],f=u.slice(1).concat([d]);let h=ee(l,[d].concat(gs(u.slice(1))));h=Pt(h,[1,0]),h=ee(h,f),i.push(h),o=!0}else if(c>1){const u=Ur(1,c).concat([0]);i.push(Pt(l,u)),o=!0}else i.push(l)}let s=this.mergeFunction(i);const a=s.rank;if(o){if(a==null){const l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=ee(Pt(ee(s,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Ur(0,a-1));s=Pt(s,l)}}return s}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let i=[];for(const r of e)r!=null&&r[0]!==null&&i.push(r[0]);return i=ms(i),i.length===1?t=i.concat(t):t=[null].concat(t),t}computeMask(e,t){return ie(()=>{if(t==null)return null;if(!Array.isArray(t))throw new G("`mask` should be an Array");if(!Array.isArray(e))throw new G("`inputs` should be an Array");if(t.length!==e.length)throw new G(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Ai(r,0));let i=t[0];for(let r=1;r<t.length-1;++r)i=Uo(i,t[r]);return i})}}class pD extends za{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0].clone();for(let i=1;i<e.length;++i)t=$e(t,e[i]);return t})}}pD.className="Add";Ce(pD);class mD extends za{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0].clone();for(let i=1;i<e.length;++i)t=K(t,e[i]);return t})}}mD.className="Multiply";Ce(mD);class gD extends za{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0].clone();for(let i=1;i<e.length;++i)t=$e(t,e[i]);return K(1/e.length,t)})}}gD.className="Average";Ce(gD);class vD extends za{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0];for(let i=1;i<e.length;++i)t=As(t,e[i]);return t})}}vD.className="Maximum";Ce(vD);class xD extends za{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0];for(let i=1;i<e.length;++i)t=jc(t,e[i]);return t})}}xD.className="Minimum";Ce(xD);class bD extends za{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new G("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const i=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let s=!1;for(const a of i)if(Ht(a,o)){s=!0;break}s||i.push(o)}if(i.length>1)throw new G("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ie(()=>$b(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new G("A `Concatenate` layer should be called on a list of inputs.");const t=e,i=t[0].slice(),r=this.axis<0?i.length+this.axis:this.axis;for(const o of t.slice(1)){if(i[r]==null||o[r]==null){i[r]=null;break}i[r]+=o[r]}return i}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new G("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new G("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new G(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ie(()=>{let i=!0;if(t.forEach(s=>{if(s!=null){i=!1;return}}),i)return null;const r=[];for(let s=0;s<e.length;++s)t[s]==null?r.push(Pe(Dr(e[s]),"bool")):t[s].rank<e[s].rank?r.push(Ai(t[s],-1)):r.push(t[s]);const o=Fi(r,this.axis);return g2(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}bD.className="Concatenate";Ce(bD);function yc(n,e){for(;n<0;)n+=e;return n}function X9(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new bt("batchDot is not implemented for tensors of 4D or higher rank yet");if(F(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),F(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new bt("batchDot is not implemented for complex64-type Tensors yet.");const i=n.shape.length,r=e.shape.length;t==null&&(t=[i-1,r-2]);const o=t;return ie(()=>{let s;if(i>r){s=i-r;const l=[];for(let c=0;c<s;++c)l.push(1);e=ee(e,e.shape.concat(l))}else if(r>i){s=r-i;const l=[];for(let c=0;c<s;++c)l.push(1);n=ee(n,n.shape.concat(l))}else s=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=rt(K(n,e),o[0]):a=rt(K(Pt(n,[1,0]),e),o[1]);else{const l=o[0]!==n.shape.length-1,c=o[1]===e.shape.length-1;a=Wt(n,e,l,c)}if(s>0){let l;i>r?l=i+r-3:l=i-1;const c=[];for(let u=l;u<l+s;++u)c.push(u);a=cd(a,c)}return a.shape.length===1&&(a=Ai(a,1)),a})}class yD extends za{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){F(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],i=e[1];if(t.length>3||i.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,i);if(t[r[0]]!==i[r[1]])throw new G(`Dimension incompatibility: ${t[r[0]]} !== ${i[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new G(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],i=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,s)=>yc(o,e[s].shape.length)):r=[yc(this.axes,t.shape.length),yc(this.axes,i.shape.length)],this.normalize&&(t=Bh(t,r[0]),i=Bh(i,r[1])),X9(t,i,r)}interpretAxes(e,t){let i;return Array.isArray(this.axes)?i=this.axes:i=[yc(this.axes,e.length),yc(this.axes,t.length)],i}computeOutputShape(e){F(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),i=e[1].slice();if(t.length>3||i.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,i);t.splice(r[0],1),i.splice(r[1],1),i.splice(0,1);const o=t.concat(i);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}yD.className="Dot";Ce(yD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wD extends St{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e);return vd(()=>$e(Ap(i.shape,0,this.stddev),i),()=>i,t.training||!1)})}}wD.className="GaussianNoise";Ce(wD);class CD extends St{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const i=ut(e);return this.rate>0&&this.rate<1?vd(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return K(i,Ap(i.shape,1,o))},()=>i,t.training||!1):i})}}CD.className="GaussianDropout";Ce(CD);class SD extends St{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||ut(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ie(()=>{if(this.rate<1&&this.rate>0){const i=this._getNoiseShape(e);return vd(()=>{const o=ut(e),l=-1.6732632423543772*1.0507009873554805;let c=Oa(ld(i),this.rate);c=bo(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,f=$e(K(o,c),K($e(c,-1),l));return $e(K(f,u),d)},()=>ut(e),t.training||!1)}return e})}}SD.className="AlphaDropout";Ce(SD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yc(n,e,t,i,r,o=.001){let s;if(n.rank===2)s=S6(n,e,t,i,r,o);else if(n.rank===3)s=$6(n,e,t,i,r,o);else if(n.rank===4)s=N6(n,e,t,i,r,o);else throw new bt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return s}function q9(n,e,t,i,r=.001){return ie(()=>{const o=E0(n,i),s=o.mean,a=o.variance;return[Yc(n,s,a,t,e,r),s,a]})}function Y9(n,e,t,i,r=.001){return ie(()=>{const o=E0(n,i),s=o.mean,a=o.variance,l=[];for(const p of Ur(0,n.rank))i.indexOf(p)!==-1?l.push(1):l.push(n.shape[p]);const c=ee(s,l),u=ee(a,l),d=e==null?null:ee(e,l),f=t==null?null:ee(t,l);return[Yc(n,c,u,f,d,r),s,a]})}function J9(n,e,t,i,r=.001){return Ht(i.slice().sort(),Ur(0,n.rank-1))?q9(n,e,t,i,r):Y9(n,e,t,i,r)}class ID extends St{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=hn(e.betaInitializer||"zeros"),this.gammaInitializer=hn(e.gammaInitializer||"ones"),this.movingMeanInitializer=hn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=hn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Wn(e.betaConstraint),this.gammaConstraint=Wn(e.gammaConstraint),this.betaRegularizer=fn(e.betaRegularizer),this.gammaRegularizer=fn(e.gammaRegularizer)}build(e){e=Vt(e);const t=this.axis>=0?this.axis:this.axis+e.length,i=e[t];if(i==null)throw new G(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Bn({ndim:e.length,axes:{[t]:i}})];const r=[i];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ie(()=>{const i=t.training==null?!1:t.training,r=ut(e),o=r.shape,s=o.length,a=Ur(0,s),l=this.axis>=0?this.axis:this.axis+s;a.splice(l,1);const c=Ia(1,s);c[l]=o[l];const u=a.slice();u.sort();const d=!Ht(u,Ur(0,s).slice(0,s-1)),f=()=>{if(d){const x=ee(this.movingMean.read(),c),b=ee(this.movingVariance.read(),c),w=this.center?ee(this.beta.read(),c):null,y=this.scale?ee(this.gamma.read(),c):null;return Yc(r,x,b,w,y,this.epsilon)}else return Yc(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!i)return f();const[h,p,m]=J9(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(x,b,w)=>{ie(()=>{const y=1-w,C=x.read(),$=K(ct(C,b),y);x.write(ct(C,$))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:gn(this.betaInitializer),gammaInitializer:gn(this.gammaInitializer),movingMeanInitializer:gn(this.movingMeanInitializer),movingVarianceInitializer:gn(this.movingVarianceInitializer),betaRegularizer:Jt(this.betaRegularizer),gammaRegularizer:Jt(this.gammaRegularizer),betaConstraint:Vn(this.betaConstraint),gammaConstraint:Vn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}ID.className="BatchNormalization";Ce(ID);class $D extends St{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=hn(e.betaInitializer||"zeros"),this.gammaInitializer=hn(e.gammaInitializer||"ones"),this.betaRegularizer=fn(e.betaRegularizer),this.gammaRegularizer=fn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Vt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==ms(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const i=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",i,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",i,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const i=ut(e),r=i.shape,o=r.length;return ie(()=>{let{mean:a,variance:l}=E0(i,this.axis,!0);const c=Ia(1,o);for(const m of this.axis)c[m]=r[m];const u=m=>m!=null&&m.shape.length!==o?ee(m,c):m;let d=this.scale?u(this.gamma.read()):null,f=this.center?u(this.beta.read()):null;const h=[],p=[];for(let m=0;m<o;++m)this.axis.indexOf(m)!==-1?(h.push(r[m]),p.push(1)):(h.push(1),p.push(r[m]));return a=Vr(a,h),l=Vr(l,h),d!=null&&(d=Vr(d,p)),f!=null&&(f=Vr(f,p)),Yc(i,a,l,f,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:gn(this.betaInitializer),gammaInitializer:gn(this.gammaInitializer),betaRegularizer:Jt(this.betaRegularizer),gammaRegularizer:Jt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}$D.className="LayerNormalization";Ce($D);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Z9(n,e,t){return ie(()=>{if(n.rank!==4)throw new G(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new G("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=jr()),t!=="channelsLast"&&t!=="channelsFirst")throw new G(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let i;return t==="channelsFirst"?i=[[0,0],[0,0],e[0],e[1]]:i=[[0,0],e[0],e[1],[0,0]],N0(n,i)})}class ED extends St{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?jr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new G(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,i;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new G(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new G(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);i=e.padding[1]}this.padding=[t,i]}this.inputSpec=[new Bn({ndim:4})]}computeOutputShape(e){e=Vt(e);let t,i;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?i=e[3]+this.padding[1][0]+this.padding[1][1]:i=null,[e[0],e[1],t,i]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?i=e[2]+this.padding[1][0]+this.padding[1][1]:i=null,[e[0],t,i,e[3]])}call(e,t){return ie(()=>Z9(ut(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}ED.className="ZeroPadding2D";Ce(ED);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vp(n,e,t,i,r,o){return ie(()=>{Tn(r),WN(o),dr(i),t==null&&(t=[1,1]),i==null&&(i="valid"),r==null&&(r=jr()),o==null&&(o="max"),n=Lb(n,r);let s;const a=i==="same"?"same":"valid";return o==="max"?s=$0(n,e,t,a):s=m0(n,e,t,a),r==="channelsFirst"&&(s=Pt(s,[0,3,1,2])),s})}function ND(n,e,t,i,r,o){return ie(()=>{Tn(r),WN(o),dr(i),t==null&&(t=[1,1,1]),i==null&&(i="valid"),r==null&&(r=jr()),o==null&&(o="max"),n=Uk(n,r);let s;const a=i==="same"?"same":"valid";return o==="max"?s=dK(n,e,t,a):s=f6(n,e,t,a),r==="channelsFirst"&&(s=Pt(s,[0,4,1,2,3])),s})}class kD extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new G(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Jn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new G(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Jn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,dr(this.padding),this.inputSpec=[new Bn({ndim:3})]}computeOutputShape(e){e=Vt(e);const t=Hr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ie(()=>{this.invokeCallHook(e,t),e=md(ut(e),2);const i=this.poolingFunction(ut(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return cd(i,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class DD extends kD{constructor(e){super(e)}poolingFunction(e,t,i,r,o){return Tn(o),dr(r),Vp(e,t,i,r,o,"max")}}DD.className="MaxPooling1D";Ce(DD);class TD extends kD{constructor(e){super(e)}poolingFunction(e,t,i,r,o){return Tn(o),dr(r),Vp(e,t,i,r,o,"avg")}}TD.className="AveragePooling1D";Ce(TD);class RD extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new G(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Jn(this.poolSize,"poolSize"),Jn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Tn(this.dataFormat),dr(this.padding),this.inputSpec=[new Bn({ndim:4})]}computeOutputShape(e){e=Vt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Hr(t,this.poolSize[0],this.padding,this.strides[0]),i=Hr(i,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,i]:[e[0],t,i,e[3]]}call(e,t){return ie(()=>(this.invokeCallHook(e,t),this.poolingFunction(ut(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class _D extends RD{constructor(e){super(e)}poolingFunction(e,t,i,r,o){return Tn(o),dr(r),Vp(e,t,i,r,o,"max")}}_D.className="MaxPooling2D";Ce(_D);class AD extends RD{constructor(e){super(e)}poolingFunction(e,t,i,r,o){return Tn(o),dr(r),Vp(e,t,i,r,o,"avg")}}AD.className="AveragePooling2D";Ce(AD);class OD extends St{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new G(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Jn(this.poolSize,"poolSize"),Jn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Tn(this.dataFormat),dr(this.padding),this.inputSpec=[new Bn({ndim:5})]}computeOutputShape(e){e=Vt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],i=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Hr(t,this.poolSize[0],this.padding,this.strides[0]),i=Hr(i,this.poolSize[1],this.padding,this.strides[1]),r=Hr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,i,r]:[e[0],t,i,r,e[4]]}call(e,t){return ie(()=>(this.invokeCallHook(e,t),this.poolingFunction(ut(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class PD extends OD{constructor(e){super(e)}poolingFunction(e,t,i,r,o){return Tn(o),dr(r),ND(e,t,i,r,o,"max")}}PD.className="MaxPooling3D";Ce(PD);class MD extends OD{constructor(e){super(e)}poolingFunction(e,t,i,r,o){return Tn(o),dr(r),ND(e,t,i,r,o,"avg")}}MD.className="AveragePooling3D";Ce(MD);class FD extends St{constructor(e){super(e),this.inputSpec=[new Bn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new bt}}class LD extends FD{constructor(e){super(e||{})}call(e,t){return ie(()=>{const i=ut(e);return On(i,1)})}}LD.className="GlobalAveragePooling1D";Ce(LD);class zD extends FD{constructor(e){super(e||{})}call(e,t){return ie(()=>{const i=ut(e);return Gr(i,1)})}}zD.className="GlobalMaxPooling1D";Ce(zD);class BD extends St{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Tn(this.dataFormat),this.inputSpec=[new Bn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new bt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class VD extends BD{call(e,t){return ie(()=>{const i=ut(e);return this.dataFormat==="channelsLast"?On(i,[1,2]):On(i,[2,3])})}}VD.className="GlobalAveragePooling2D";Ce(VD);class WD extends BD{call(e,t){return ie(()=>{const i=ut(e);return this.dataFormat==="channelsLast"?Gr(i,[1,2]):Gr(i,[2,3])})}}WD.className="GlobalMaxPooling2D";Ce(WD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class GD extends St{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,i={}){const r=t.layer,o=wo(r,i);delete t.layer;const s={layer:o};return Object.assign(s,t),new e(s)}}class HD extends GD{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Vt(e),e.length<3)throw new G(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Vt(e);const t=[e[0]].concat(e.slice(2)),i=this.layer.computeOutputShape(t),r=e[1];return[i[0],r].concat(i.slice(1))}call(e,t){return ie(()=>(e=ut(e),eD((s,a)=>[ut(this.layer.call(s,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}HD.className="TimeDistributed";Ce(HD);function Q9(n){La(vq,"BidirectionalMergeMode",n)}const eY="concat";class UD extends GD{constructor(e){super(e);const t=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=t,this.forwardLayer=wo(i),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=wo(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?eY:e.mergeMode,Q9(this.mergeMode),e.weights)throw new bt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,i=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,i)),this.backwardLayer.setWeights(e.slice(i))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let i,r,o;return this.returnState&&(o=t.slice(1)),i=t[0],i=i,this.mergeMode==="concat"?(i[i.length-1]*=2,r=[i]):this.mergeMode==null?r=[i,i.slice()]:r=[i],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[i].concat(o).concat(o.slice()):Oi(r)}apply(e,t){let i=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=Qk(e,i,r,this.numConstants);if(e=o.inputs,i=o.initialState,r=o.constants,Array.isArray(e)&&(i=e.slice(1),e=e[0]),(i==null||i.length===0)&&r==null)return super.apply(e,t);const s=[],a=[];if(i!=null){const c=i.length;if(c%2>0)throw new G("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=i,s.push(...i);const u=i.map(d=>new Bn({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(r!=null)throw new bt("Support for constants in Bidirectional layers is not implemented yet.");const l=s[0]instanceof No;for(const c of s)if(c instanceof No!==l)throw new G("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(s),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const f=super.apply(c,t);return this.inputSpec=d,f}else return super.apply(e,t)}call(e,t){return ie(()=>{const i=t.initialState;let r,o;if(i==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const l=i.slice(0,i.length/2),c=i.slice(i.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let s;this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Ca(o,1));let a;return this.mergeMode==="concat"?a=$b([r,o]):this.mergeMode==="sum"?a=$e(r,o):this.mergeMode==="ave"?a=K(.5,$e(r,o)):this.mergeMode==="mul"?a=K(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(s):[a].concat(s):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ca(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ca(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let i;if(this.returnSequences?this.mergeMode==null?i=[t,t]:i=t:this.mergeMode==null?i=[null,null]:i=null,this.returnState){const o=this.forwardLayer.states.map(s=>null);return Array.isArray(i)?i.concat(o).concat(o):[i].concat(o).concat(o)}else return i}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const i=wo(t.layer);if(delete t.layer,t.numConstants!=null)throw new bt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=i,new e(r)}}UD.className="Bidirectional";Ce(UD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jD extends St{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ie(()=>(e=ut(e),e.dtype!=="float32"&&(e=bo(e,"float32")),$e(K(e,this.scale),this.offset)))}}jD.className="Rescaling";Ce(jD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:tY,cropAndResize:nY}=Bo;class KD extends St{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,i,r,o,s,a,l){return ie(()=>{let c,u=!1;const d=t/s,f=i/a,h=(r+t)/s,p=(o+i)/a,m=[d,f,h,p],g=[];e.rank===3?(u=!0,c=jo([e])):c=e;for(let y=0;y<c.shape[0];y++)g.push(m);const v=cl(g,[g.length,4]),x=Kc(0,g.length,1,"int32"),w=nY(c,v,x,[r,o],"nearest");return bo(u?ut(Sa(w)):w,l)})}upsize(e,t,i,r){return ie(()=>{const o=tY(e,[t,i]);return bo(o,r)})}call(e,t){return ie(()=>{const i=ut(e),r=i.dtype,o=i.shape,s=o[o.length-3],a=o[o.length-2];let l=0;s!==this.height&&(l=Math.floor((s-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(i,l,c,this.height,this.width,s,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Vt(e);const t=e.length-3,i=e.length-2;return e[t]=this.height,e[i]=this.width,e}}KD.className="CenterCrop";Ce(KD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iY(n,e,t,i){let r=ut(n);if(r.dtype!=="int32"&&(r=bo(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=Ai(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Ai(r,-1)),r.rank>2)throw new G(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const s=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof i<"u"&&e==="count"?l=AC(a,i,t,s):l=AC(a,[],t,s),e!=="tfIdf")return l;if(i)return K(l,i);throw new G("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class XD extends St{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Vt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ie(()=>{e=ut(e),e.dtype!=="int32"&&(e=bo(e,"int32"));let i;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new G(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);i=ut(t.countWeights)}const r=Gr(e),o=Rh(e),s=ur(this.numTokens,r).bufferSync().get(0),a=Oa(o,0).bufferSync().get(0);if(!(s&&a))throw new G(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return iY(e,this.outputMode,this.numTokens,i)})}}XD.className="CategoryEncoding";Ce(XD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rY=["bilinear","nearest"],pS=new Set(rY);class qD extends St{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(pS.has(e.interpolation))this.interpolation=e.interpolation;else throw new G(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Vt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ie(()=>{const i=[this.height,this.width];if(this.interpolation==="bilinear")return Bo.resizeBilinear(e,i,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Bo.resizeNearestNeighbor(e,i,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...pS]} are supported`)})}}qD.className="Resizing";Ce(qD);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YD{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}YD.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JD extends St{constructor(e){super(e),this.randomGenerator=new YD(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}JD.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oY=["bilinear","nearest"],mS=new Set(oY);class ZD extends JD{constructor(e){super(e);const{factor:t,interpolation:i="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new G(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new G(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new G(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(i)if(mS.has(i))this.interpolation=i;else throw new G(`Invalid interpolation parameter: ${i} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Vt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ie(()=>{const i=ut(e);this.imgHeight=i.shape[i.shape.length-3];const r=i.shape[i.shape.length-2];this.widthFactor=ld([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const s=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Bo.resizeBilinear(e,s);case"nearest":return Bo.resizeNearestNeighbor(e,s);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...mS]} are supported`)}})}}ZD.className="RandomWidth";Ce(ZD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _m(n){return new Hb(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sY=ae();sY.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var gS;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(gS||(gS={}));var vS;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(vS||(vS={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var xS;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(xS||(xS={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function He(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&F(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY=j2;class Wp extends vx{nextDataId(){return Wp.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new hE(this,ro())}write(e,t,i){this.firstUse&&(this.firstUse=!1,ae().get("IS_NODE")&&rr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:i,refCount:1}),r}makeTensorInfo(e,t,i){let r;if(t==="string"&&i!=null&&i.length>0&&uu(i[0])){const o=i.map(s=>ps(s));r=this.write(o,e,t)}else r=this.write(i,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,i,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:i}=this.data.get(e);if(t==="complex64"){const r=this.readSync(i.real.dataId),o=this.readSync(i.imag.dataId);return Ko(r,o)}return gH(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const i=t.map(r=>ws(r));return wt(e.shape,e.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return wt(e.shape,e.dtype,t)}makeOutput(e,t,i){return ro().makeTensorFromTensorInfo(this.makeTensorInfo(t,i,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:i}=this.data.get(e);i!=null&&(this.disposeData(i.real.dataId,!0),this.disposeData(i.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=_i();return e(),{kernelMs:_i()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){He([e],"where");const t=this.readSync(e.dataId);return aY(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Wp.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const lY=n=>{const{x:e}=n.inputs,t=n.backend;He(e,"abs");let i=new Float32Array(he(e.shape));const r=t.data.get(e.dataId).values;return i=QD(r),t.makeOutput(i,e.shape,e.dtype)},cY={kernelName:bf,backendName:"cpu",kernelFunc:lY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rn(n){return(e,t,i,r,o)=>{const s=vt(e,t),a=s.length,l=Qe(s),c=he(s),u=pi(o,c),d=e.length,f=t.length,h=Qe(e),p=Qe(t),m=_l(e,s),g=_l(t,s);if(m.length+g.length===0)for(let v=0;v<u.length;++v)u[v]=n(i[v%i.length],r[v%r.length]);else for(let v=0;v<u.length;++v){const x=Jl(v,a,l),b=x.slice(-d);m.forEach($=>b[$]=0);const w=go(b,d,h),y=x.slice(-f);g.forEach($=>y[$]=0);const C=go(y,f,p);u[v]=n(i[w],r[C])}return[u,s]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ji(n){const{inputs:e,backend:t}=n,{real:i,imag:r}=e,o=t.data.get(i.dataId).values,s=t.data.get(r.dataId).values,a=t.makeTensorInfo(i.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(i.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",s)},a}const uY={kernelName:Tx,backendName:"cpu",kernelFunc:ji};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jh(n,e,t="float32"){if(t==="complex64"){const r=jh(n,e,"float32"),o=jh(n,e,"float32");return ji({inputs:{real:r,imag:o},backend:n})}const i=mi(he(e),t);return n.makeTensorInfo(e,t,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ko(n){const{inputs:e,backend:t}=n,{x:i}=e;return t.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const dY={kernelName:Ru,backendName:"cpu",kernelFunc:ko};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(n){const{inputs:e,backend:t}=n,{input:i}=e,r=t.data.get(i.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const hY={kernelName:e0,backendName:"cpu",kernelFunc:$a};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(n,e,t,i){if(i==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(i==="bool"){const r=Aa([0],t),[o,s]=Rn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[s,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${i}`)}function Es(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{dtype:o}=i;if(o==="complex64"){if(r.dtype==="complex64")return ko({inputs:{x:r},backend:t});const u=jh(t,r.shape,r.dtype),d=Es({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),f=ji({inputs:{real:d,imag:u},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),f}if(r.dtype==="complex64"){const u=$a({inputs:{input:r},backend:t}),d=Es({inputs:{x:u},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(u),d}if(!mE(r.dtype,o)){const u=ko({inputs:{x:r},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:o}}const s=t.data.get(r.dataId).values,[a,l,c]=eT(s,r.shape,r.dtype,o);return t.makeTensorInfo(a,l,c)}const fY={kernelName:xu,backendName:"cpu",kernelFunc:Es};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(n,e,t,i){return t==null?({inputs:r,backend:o})=>{const{a:s,b:a}=r,l=o;He([s,a],n);const c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=s.dtype==="string"?Xo(c):c,f=s.dtype==="string"?Xo(u):u,h=i||s.dtype,[p,m]=e(s.shape,a.shape,d,f,h);return l.makeTensorInfo(m,h,p)}:({inputs:r,backend:o})=>{const{a:s,b:a}=r,l=o;if(s.dtype==="complex64"||a.dtype==="complex64"){const c=Es({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,h=l.data.get(d.dataId).values,p=l.data.get(f.dataId).values,m=Es({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),v=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,b=l.data.get(v.dataId).values,w=l.data.get(x.dataId).values,[y,C,$]=t(s.shape,a.shape,h,p,b,w),I=l.makeTensorInfo($,"float32",y),E=l.makeTensorInfo($,"float32",C),N=ji({inputs:{real:I,imag:E},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(I),l.disposeIntermediateTensorInfo(E),N}else{const c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=i||s.dtype,[f,h]=e(s.shape,a.shape,c,u,d);return l.makeTensorInfo(h,d,f)}}}function Ub(n){return(e,t,i,r,o,s)=>{const a=vt(e,t),l=he(a),c=a.length,u=Qe(a),d=pi("float32",l),f=pi("float32",l),h=_l(e,a),p=_l(t,a),m=Ko(i,r),g=Ko(o,s),v=e.length,x=Qe(e),b=t.length,w=Qe(t);if(h.length+p.length===0)for(let y=0;y<d.length;y++){const C=y%m.length,$=y%g.length,I=n(m[C*2],m[C*2+1],g[$*2],g[$*2+1]);d[y]=I.real,f[y]=I.imag}else for(let y=0;y<d.length;y++){const C=Jl(y,c,u),$=C.slice(-v);h.forEach(D=>$[D]=0);const I=go($,v,x),E=C.slice(-b);p.forEach(D=>E[D]=0);const N=go(E,b,w),k=n(m[I*2],m[I*2+1],g[N*2],g[N*2+1]);d[y]=k.real,f[y]=k.imag}return[d,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tT=Rn((n,e)=>n+e),pY=Ub((n,e,t,i)=>({real:n+t,imag:e+i})),Ml=Hn(Zl,tT,pY),mY={kernelName:Zl,backendName:"cpu",kernelFunc:Ml};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jb(n,e,t,i,r){const o=he(i),s=mi(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?s[l]+=e[a]:s[l]+=1)}return s}function nT(n,e,t,i=!1){const r=n.shape[0],o=n.shape[1],s=wt([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const c=n.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(i?s.set(1,a,c):e.size>0?s.set(s.get(a,c)+e.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iT=Rn((n,e)=>n&e),gY=Hn(Dx,iT),vY={kernelName:Dx,backendName:"cpu",kernelFunc:gY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Do(n){return(e,t,i)=>{const r=Sn(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],i);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kt(n,e,t){const i=Do(e);return Fs(n,i,t)}function Fs(n,e,t){return({inputs:i,attrs:r,backend:o})=>{const{x:s}=i;He(s,n);const a=o,l=a.data.get(s.dataId).values;let c;if(s.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=Xo(l)}else c=l;const u=t||s.dtype,d=e(c,u,r);return a.makeTensorInfo(s.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rT=Do(n=>Math.ceil(n)),xY=Fs(bu,rT),bY={kernelName:bu,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(n,e,t,i){const r=Sn(t,he(e));if(i&&t!=="string"){let o=0;n.forEach(s=>{const a=he(s.shape);r.set(s.vals,o),o+=a})}else{let o=0;n.forEach(s=>{const a=t==="string"?Xo(s.vals):s.vals;let l=0;for(let c=0;c<s.shape[0];++c){const u=c*e[1]+o;for(let d=0;d<s.shape[1];++d)r[u+d]=a[l++]}o+=s.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sT=Rn((n,e)=>n===e?1:0),aT=Hn(Of,sT,null,"bool"),yY={kernelName:Of,backendName:"cpu",kernelFunc:aT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lT=Do(n=>Math.exp(n)),cT=Fs(Eu,lT,"float32"),wY={kernelName:Eu,backendName:"cpu",kernelFunc:cT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uT=Do(n=>Math.expm1(n)),CY=Fs(Nu,uT),SY={kernelName:Nu,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dT=Do(n=>Math.floor(n)),IY=Fs(ku,dT),$Y={kernelName:ku,backendName:"cpu",kernelFunc:IY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hT=Rn((n,e)=>Math.floor(n/e)),EY=Hn(Du,hT,null,"int32"),NY={kernelName:Du,backendName:"cpu",kernelFunc:EY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(n,e,t,i,r,o,s,a,l){const c=wt([i,o],t);for(let u=0;u<i;u++){const d=[];let f=0;for(let h=0;h<r;h++){const p=n[u*r+h];f+=p*s[h],d.push(p)}if(f<0||f>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let h=0;h<o;h++)c.values[u*o+h]=e.get(...e.indexToLoc(f*o+h))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pT(n,e,t){const i=wt(t,n.dtype);for(let r=0;r<i.size;++r){const s=i.indexToLoc(r).slice(),a=s[0],l=s[2],c=e.locToIndex([a,l]);s[2]=e.values[c];const u=n.locToIndex(s);0<=u&&u<n.values.length&&(i.values[r]=n.values[u])}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mT=Rn((n,e)=>n>e?1:0),kY=Hn(Lf,mT,null,"bool"),DY={kernelName:Lf,backendName:"cpu",kernelFunc:kY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gT=Rn((n,e)=>n>=e?1:0),TY=Hn(Tu,gT,null,"bool"),RY={kernelName:Tu,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vT=Rn((n,e)=>n<e?1:0),_Y=Hn(Bf,vT,null,"bool"),AY={kernelName:Bf,backendName:"cpu",kernelFunc:_Y};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xT=Rn((n,e)=>n<=e?1:0),OY=Hn(Vf,xT,null,"bool"),PY={kernelName:Vf,backendName:"cpu",kernelFunc:OY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(n,e,t){const i=(e-n)/(t-1),r=mi(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+i;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yT=Do(n=>Math.log(n)),MY=Fs(Pu,yT),FY={kernelName:Pu,backendName:"cpu",kernelFunc:MY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wT(n,e,t,i){const r=pi(i,he(t));for(let o=0;o<r.length;++o){const s=o*e;let a=n[s];for(let l=0;l<e;++l){const c=n[s+l];(Number.isNaN(c)||c>a)&&(a=c)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CT=Rn((n,e)=>Math.max(n,e)),LY=Hn(Fu,CT),zY={kernelName:Fu,backendName:"cpu",kernelFunc:LY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ST=Rn((n,e)=>Math.min(n,e)),BY=Hn(Lu,ST),VY={kernelName:Lu,backendName:"cpu",kernelFunc:BY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kb=Rn((n,e)=>n*e),WY=Ub((n,e,t,i)=>({real:n*t-e*i,imag:n*i+e*t})),Gp=Hn(Bu,Kb,WY),GY={kernelName:Bu,backendName:"cpu",kernelFunc:Gp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IT(n,e,t){const i=Ds(-1,t);return Kb([],e,i,n,t)}function HY(n){const{inputs:e,backend:t}=n,{x:i}=e;He(i,"neg");const r=t.data.get(i.dataId).values,[o,s]=IT(r,i.shape,i.dtype);return t.makeTensorInfo(s,i.dtype,o)}const UY={kernelName:Zf,backendName:"cpu",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $T=Rn((n,e)=>n!==e?1:0),jY=Hn(Qf,$T,null,"bool"),KY={kernelName:Qf,backendName:"cpu",kernelFunc:jY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xb(n,e,t,i,r){const o=e.length,s=he(e),a=Qe(e),l=Qe(r),c=pi(t,he(r));for(let u=0;u<s;++u){const d=Jl(u,o,a),f=new Array(d.length);for(let p=0;p<f.length;p++)f[p]=d[i[p]];const h=go(f,o,l);c[h]=n[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zi(n){const{inputs:e,attrs:t,backend:i}=n,{x:r}=e,{perm:o}=t;He(r,"transpose");const s=r.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=r.shape[o[d]];const l=i.data.get(r.dataId).values,c=Xb(l,r.shape,r.dtype,o,a);return{dataId:i.write(c,a,r.dtype),shape:a,dtype:r.dtype}}const XY={kernelName:ll,backendName:"cpu",kernelFunc:zi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ET(n,e,t,i){const[r,o]=Zn(n,i),s=Zi(e,"int32"),a=mi(he(r),s),l=he(o);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let f=0;f<l;++f)d*=t[u+f];a[c]=d}return{outVals:a,outShape:r,outDtype:s}}function qY(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i;He(r,"prod");const a=r.shape.length,l=Ct(o,r.shape),c=xn(l,a);let u=l,d=r;const f=[];c!=null&&(d=zi({inputs:{x:r},backend:t,attrs:{perm:c}}),f.push(d),u=Dn(u.length,a));const h=t.data.get(d.dataId).values,{outVals:p,outShape:m,outDtype:g}=ET(d.shape,d.dtype,h,u);let v=m;return s&&(v=Pn(m,l)),f.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(v,g,p)}const YY={kernelName:op,backendName:"cpu",kernelFunc:qY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(n,e,t){n.forEach((i,r)=>{if(i<0||i>=t){const o=Jl(r,e.length,Qe(e)).join(",");throw new Error(`indices[${o}] = ${i} is not in [0, ${t})`)}})}function ZY(n,e){for(let t=0;t<n.length;++t){const i=n[t],r=t===n.length-1?e:n[t+1].length;if(i.length===0)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<i.length;++o)if(i[o-1]>i[o])throw new Error("Ragged splits must be sorted in ascending order")}}function QY(n,e,t,i){const r=[];let o=0;const s=e.length-1+t.length,a=new Array(s).fill(null).map(()=>[0]);ZY(t,i);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<n.length;++c){let u=n[c],d=n[c]+1;for(let f=0;f<t.length;++f){const h=t[f],p=f+e.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-h[u];for(let v=u;v<d;++v)a[p].push(h[v+1]+g)}u=h[u],d=h[d]}d!==u&&(r.push([u,d]),o+=d-u)}return{outSplits:a,valueSlices:r,numValues:o}}function eJ(n){const e=[];for(let t=0;t<n.length;++t){const i=n[t].length,r=Sn("int32",i);e.push(r),n[t].forEach((o,s)=>r[s]=o)}return e}function bS(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let i=e;i<n.length;i++)t[e-1]*=n[i];return t}function tJ(n,e,t,i,r,o){const s=bS(e,2)[1],a=bS(o,2)[1];let l=0;for(const c of t)for(let u=c[0];u<c[1];++u){for(let d=0;d<i;++d)r[l*a+d]=n[u*s+d];++l}}function nJ(n,e,t,i,r){const o=e.slice();o[0]=r;const s=Sn(t,he(o)),a=n.length,l=a===0?0:a/e[0];return tJ(n,e,i,l,s,o),[s,o]}function NT(n,e,t,i,r,o,s,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(JY(o,s,l),i.length===0)throw new Error("params.rank must be nonzero");const c=i[0],{outSplits:u,valueSlices:d,numValues:f}=QY(o,s,n,c),h=eJ(u),p=nJ(t,i,r,d,f);return[h,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yS=2147483647;function kT(n,e,t,i,r,o,s){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=s.length===0,u=[];a||u.push(e[0]),l||u.push(r[0]),c||u.push(s[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],f=Sn("int32",d+1);f[0]=0;for(let g=0;g<d;++g){const v=a?n[0]:n[g],x=l?i[0]:i[g],b=c?o[0]:o[g];if(b===0)throw new Error("Requires delta != 0");let w;if(b>0&&x<v||b<0&&x>v)w=0;else if(w=Math.ceil(Math.abs((x-v)/b)),w>yS)throw new Error(`Requires ((limit - start) / delta) <= ${yS}`);f[g+1]=f[g]+w}const h=f[d],p=Sn(t,h);let m=0;for(let g=0;g<d;++g){const v=f[g+1]-f[g];let x=a?n[0]:n[g];const b=c?o[0]:o[g];for(let w=0;w<v;++w)p[m++]=x,x+=b}return[f,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mr=Br;class Kh{constructor(e,t,i,r,o,s,a,l,c,u){this.shape=e,this.shapeShape=t,this.values=i,this.valuesShape=r,this.valuesDType=o,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=fN(u),this.raggedRank=pN(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===mr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===mr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case mr.VALUE_ROWIDS:return Kh.getMaxWidthValueRowID(t);case mr.ROW_SPLITS:return Kh.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${mr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let i=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>i&&(i=o)}return i}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let i=0,r=e[0],o=0;for(let s=1;s<t;++s){const a=e[s];a!==r&&(r=a,o=Math.max(s-i,o),i=s)}return Math.max(t-i,o)}tensorShapeFromTensor(e,t,i=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return CS(e,i)}calculateOutputSize(e){const t=this.valuesShape,i=this.defaultValueShape;mN(i,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=hN(this.raggedRank,r,t);s[0]<0&&(s[0]=e);for(let a=1;a<=this.raggedRank;++a)s[a]<0&&(s[a]=this.getMaxWidth(a));return s}calculateFirstParentOutputIndex(e,t,i){const r=Math.min(e,i),o=[];let s=0;for(let a=0;a<r;++a,s+=t)o.push(s);for(let a=r;a<e;++a)o.push(-1);return F(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,i,r){const o=e.length,s=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),u=t[a];u===-1&&(c=0);for(let d=0;d<c;++d)s.push(u),u+=i;for(let d=0;d<l-c;++d)s.push(-1)}if(o>0&&s.length!==e[o-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(e,t,i,r){const o=e.length,s=[];if(o===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];s.push(c);for(let u=1;u<o;++u){const d=e[u];if(d===l)c>=0&&(++a,a<r?c+=i:c=-1);else{if(a=0,l=d,d>=t.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${t.length}`);c=t[d]}s.push(c)}if(s.length!==e.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(e,t,i,r){const o=this.getRowPartitionTensor(e),s=this.getRowPartitionTypeByDimension(e);switch(s){case mr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,i,r);case mr.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,i,r);default:throw new Error(`Unsupported partition type: ${mr[s]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case mr.FIRST_DIM_SIZE:return e[0];case mr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case mr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${mr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),i=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*i[l+1];const o=CS(i,!1),s=Sn(this.valuesDType,he(o));if(r[0]*i[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],i[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],i[c]);this.setOutput(this.raggedRank,l,s,o)}return[o,s]}setOutput(e,t,i,r){if(i.length===0)return;const o=this.values,s=i;let a=r.slice();a=a.slice(e+1);const l=he(a),c=t.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const p=this.defaultValueShape;ie(()=>{const m=ee(u,p);u=Ac(m,a).dataSync()})}let d=0,f=0,h=0;for(let p=0;p<=c;++p){let m=p<c?t[p]:-1;if(m===h){++h;continue}if(f<h){const g=o.subarray(d*l),v=s.subarray(f*l),x=(h-f)*l;wS(v,g,x)}if(p>=c){const g=i.length;m=Math.floor(g/l)}if(m>h)if(this.defaultValue.length===1)s.subarray(h*l,m*l).fill(this.defaultValue[0]),h=m;else for(;m>h;){const g=s.slice(h*l);wS(g,u,l),++h}m<0?(d=p+1,f=h):(d=p,f=h,h=f+1)}}}function wS(n,e,t){for(let i=0;i<t;i++)n[i]=e[i]}function CS(n,e){const t=[];for(let i of n){if(i<0){if(!e)throw new Error(`Dimension ${i} must be >= 0`);if(i<-1)throw new Error(`Dimension ${i} must be >= -1`);i=-1}t.push(i)}return t}function DT(n,e,t,i,r,o,s,a,l,c){return new Kh(n,e,t,i,r,o,s,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TT(n,e,t,i){const r=n===e,o=n<e&&t<0,s=e<n&&t>1;if(r||o||s)return mi(0,i);const a=Math.abs(Math.ceil((e-n)/t)),l=mi(a,i);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RT=Do(n=>1/Math.sqrt(n)),iJ=Fs(ju,RT),rJ={kernelName:ju,backendName:"cpu",kernelFunc:iJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ta(n,e,t,i,r,o,s,a,l,c){const u=[i/r,r],d=n.values,f=e.values;if(i===0)return wt(t,e.dtype);const h=l instanceof ti?l:wt(u,e.dtype);typeof l=="string"||typeof l=="number"?h.values.fill(l):typeof l=="boolean"&&h.values.fill(+l);for(let p=0;p<o;p++){const m=[];let g=0;for(let v=0;v<s;v++){const x=d[p*s+v];m.push(x),g+=x*a[v]}if(g<0||g>=i/r)throw new Error(`Invalid indices: ${m} does not index into ${t}`);for(let v=0;v<r;v++)c?h.values[g*r+v]+=f[p*r+v]:h.values[g*r+v]=e.rank===0?f[0]:f[p*r+v]}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oJ=Do(n=>1/(1+Math.exp(-n))),_T=Kt(Ju,n=>1/(1+Math.exp(-n))),sJ={kernelName:Ju,backendName:"cpu",kernelFunc:_T};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AT(n,e,t,i,r){const o=eb(i,e,t),s=he(t),a=Qe(i);if(o){const d=tb(e,a);return r==="string"?n.slice(d,d+s):n.subarray(d,d+s)}const l=r==="string"?Xo(n):n,c=wt(i,r,l),u=wt(t,r);for(let d=0;d<u.size;++d){const f=u.indexToLoc(d),h=f.map((p,m)=>p+e[m]);u.set(c.get(...h),...f)}return r==="string"?PN(u.values):u.values}function Ea(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{begin:o,size:s}=i;He(r,"slice");const[a,l]=kp(r,o,s);Z0(r,a,l);const c=t.data.get(r.dataId).values,u=AT(c,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,u)}const aJ={kernelName:dp,backendName:"cpu",kernelFunc:Ea};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OT(n,e,t,i,r,o,s){const a=e[0],l=o[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(CN(a));const g=Sn(t,0),v=Sn(r,0);return[g,[0,d],v,c,u]}let f=!0,h=0;const p=new Array(l).fill(0);for(let g=0;g<a;++g){const v=n[g*d];if(v<0)throw new Error(SN(g,v));if(v>=l)throw new Error(IN(g,v,l));++p[v],f=f&&v>=h,h=v}let m=!0;for(let g=0;g<l;++g){const v=p[g]===0;c[g]=v,m=m&&!v,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&f){const g=n,v=i;for(let x=0;x<a;++x)u[x]=x;return[g,[a,d],v,c,u]}else{const g=p[l-1],v=Sn(t,g*d),x=Sn(r,g),b=new Array(l).fill(0);for(let w=0;w<a;++w){const y=n[w*d],C=b[y],$=(y===0?0:p[y-1])+C;b[y]++;for(let I=0;I<d;++I)v[$*d+I]=n[w*d+I];x[$]=i[w],u[w]=$}for(let w=0;w<l;++w)if(b[w]===0){const C=w===0?0:p[w-1];v[C*d+0]=w;for(let $=1;$<d;++$)v[C*d+$]=0;x[C]=s}return[v,[g,d],x,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(n,e,t,i,r){const o=he(i),s=e[0],a=r.length,l=[];let c=1,u=-1;for(let g=0;g<a;++g){const v=r[g];if(v===-1){if(u!==-1)throw new Error($N(u,g));u=g,l.push(1)}else{if(v<0)throw new Error(EN(g,v));c*=v,l.push(v)}}if(u!==-1){if(c<=0)throw new Error(NN());const g=Math.trunc(o/c);if(c*g!==o)throw new Error(kN(i,l));l[u]=g}if(he(l)!==o)throw new Error(DN(i,l));const f=i.length,h=[];if(f>0){h[f-1]=1;for(let g=f-2;g>=0;--g)h[g]=h[g+1]*i[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*l[g+1]}const m=Sn(t,s*a);for(let g=0;g<s;++g){let v=0;for(let x=0;x<f;++x)v+=n[g*f+x]*h[x];for(let x=0;x<a;++x)m[g*a+x]=Math.trunc(v/p[x]),v%=p[x]}return[m,[s,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(n,e,t,i,r,o=!1,s=0){const a=i.length,l=[e[0],n.length/e[0]],c=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(Bg());const f=e.slice();f[0]=d;const h=f.reduce((b,w)=>b*w,1),p=Sn(t,h);if(a===0)return d>0&&p.fill(s),[p,f];if(d<=0)throw new Error(Bg());let m=0,g=1,v=0,x=r[m];for(;;){let b=0;if(g<a){if(b=r[g],x===b){++g;continue}if(x>=b)throw new Error(TN())}if(x<0||x>=d)throw new Error(RN(x,d));x>v&&p.fill(s,v*c,x*c);for(let w=m;w<g;++w){const y=i[w];if(y<0||y>=l[0])throw new Error(_N(w,i[w],l[0]));for(let C=0;C<c;C++)p[x*c+C]+=n[y*c+C]}if(o)for(let w=0;w<c;w++)p[x*c+w]/=g-m;if(m=g,++g,v=x+1,x=b,g>a)break}return v<d&&p.fill(s,v*c,d*c),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ=Do(n=>Math.sqrt(n)),cJ=Kt(Qu,n=>Math.sqrt(n)),uJ={kernelName:Qu,backendName:"cpu",kernelFunc:cJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MT=Rn((n,e)=>{const t=n-e;return t*t}),dJ=Hn(ed,MT),hJ={kernelName:ed,backendName:"cpu",kernelFunc:dJ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FT=Do((n,e)=>{const{pattern:t,replaceGlobal:i,rewrite:r}=e;return n.replace(new RegExp(t,i?"g":""),r)}),fJ=Fs(r0,FT),pJ={kernelName:r0,backendName:"cpu",kernelFunc:fJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(n,e,t,i){const r=wt(n,e.dtype);for(let o=0;o<r.size;o++){const s=r.indexToLoc(o),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*t[l]+i[l];r.set(e.get(...a),...s)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mJ{constructor(e,t,i,r,o,s){this.separator=ps(e),this.nGramWidths=t,this.leftPad=ps(i),this.rightPad=ps(r),this.padWidth=o,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const i=this.getPadWidth(t);return Math.max(0,e+2*i-t+1)}createNGrams(e,t,i,r,o,s){for(let a=0;a<o;++a){const l=this.getPadWidth(s),c=Math.max(0,l-a),u=Math.max(0,l-(o-(a+1))),d=s-(c+u),f=t+(c>0?0:a-l);let h=0;h+=c*this.leftPad.length;for(let x=0;x<d;++x)h+=e[f+x].length;h+=u*this.rightPad.length;const p=c+u+d-1;h+=p*this.separator.length,i[r+a]=new Uint8Array(h);const m=i[r+a];let g=0;const v=x=>x.forEach(b=>m[g++]=b);for(let x=0;x<c;++x)v(this.leftPad),v(this.separator);for(let x=0;x<d-1;++x)v(e[f+x]),v(this.separator);if(d>0){v(e[f+d-1]);for(let x=0;x<u;++x)v(this.separator),v(this.rightPad)}else{for(let x=0;x<u-1;++x)v(this.rightPad),v(this.separator);v(this.rightPad)}}}compute(e,t){const i=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let u=t[c]>=l;if(u=u&&t[c]<=i,!u)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${i}]`);l=t[c]}if(l!==i)throw new Error(`Last split value must be data size. Expected ${i}, got ${l}`)}const o=r-1,s=Sn("int32",r);if(i===0||r===0){const l=new Array(i);for(let c=0;c<=o;++c)s[c]=0;return[l,s]}s[0]=0;for(let l=1;l<=o;++l){const c=t[l]-t[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),s[l]=s[l-1]+u}const a=new Array(s[o]);for(let l=0;l<o;++l){const c=t[l];let u=s[l];if(this.nGramWidths.forEach(d=>{const f=t[l+1]-t[l],h=this.getNumNGrams(f,d);this.createNGrams(e,c,a,u,h,d),u+=h}),this.preserveShort&&u===s[l]){const d=t[l+1]-t[l];if(d===0)continue;const f=d+2*this.padWidth;this.createNGrams(e,c,a,u,1,f)}}return[a,s]}}function zT(n,e,t,i,r,o,s,a){return new mJ(t,i,r,o,s,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(n,e,t,i){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)i.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let s=n.indexOf(o);for(;s!==-1;){const a=n.subarray(0,s);(!t||a.length!==0)&&i.push(a),n=n.subarray(s+1),s=n.indexOf(o)}(!t||n.length!==0)&&i.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const s=n.subarray(r,o);(!t||s.length!==0)&&i.push(s),r=o+1}}function BT(n,e,t){const i=n.length,r=[];let o=0,s=0;const a=new Array(i);for(let f=0;f<i;++f){const h=r.length;gJ(n[f],e,t,r);const p=r.length-h;a[f]=p,o+=p,s=Math.max(s,p)}const l=Sn("int32",o*2),c=new Array(o),u=[i,s];let d=0;for(let f=0;f<i;++f)for(let h=0;h<a[f];++h)l[d*2]=f,l[d*2+1]=h,c[d]=r[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VT(n,e){const t=Sn("int32",n.length);for(let i=0;i<n.length;++i)t[i]=PH(n[i]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WT=Rn((n,e)=>n-e),vJ=Ub((n,e,t,i)=>({real:n-t,imag:e-i})),Yb=Hn(td,WT,vJ),xJ={kernelName:td,backendName:"cpu",kernelFunc:Yb};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GT(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const i=wt(t,n.dtype);for(let r=0;r<i.values.length;++r){const o=i.indexToLoc(r),s=new Array(n.rank);for(let l=0;l<s.length;l++)s[l]=o[l]%n.shape[l];const a=n.locToIndex(s);i.values[r]=n.values[a]}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ic=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function HT(n,e,t=0,i=n.length-1){for(;i>t;){if(i-t>600){const a=i-t+1,l=e-t+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),f=Math.max(t,Math.floor(e-l*u/a+d)),h=Math.min(i,Math.floor(e+(a-l)*u/a+d));HT(n,e,f,h)}const r=n[e];let o=t,s=i;for(Za(n,t,e),Ic(n[i],r)>0&&Za(n,t,i);o<s;){for(Za(n,o,s),o++,s--;Ic(n[o],r)<0;)o=o+1;for(;Ic(n[s],r)>0;)s=s-1}Ic(n[t],r)===0?Za(n,t,s):(s=s+1,Za(n,s,i)),s<=e&&(t=s+1),e<=s&&(i=s-1)}}function UT(n,e,t,i,r){const o=e[e.length-1],[s,a]=[n.length/o,o],l=pi(t,s*i),c=pi("int32",s*i);for(let d=0;d<s;d++){const f=d*a,h=n.subarray(f,f+a);let p=new Array(h.length);h.forEach((x,b)=>p[b]={value:x,index:b}),i<p.length&&(HT(p,i),p=p.slice(0,i)),r&&p.sort(Ic);const m=d*i,g=l.subarray(m,m+i),v=c.subarray(m,m+i);for(let x=0;x<i;x++)g[x]=p[x].value,v[x]=p[x].index}const u=e.slice();return u[u.length-1]=i,[wt(u,t,l),wt(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jT(n,e,t,i){const r=Ct(e,t)[0],o=[1,t[0],1];for(let p=0;p<r;p++)o[0]*=t[p];o[1]=t[r];for(let p=r+1;p<t.length;p++)o[2]*=t[p];const s=new Map,a=new Int32Array(t[r]),l=new ti(o,i,n),c=[],u=o[0]===1&&o[2]===1;for(let p=0;p<t[r];p++){let m;if(u)m=n[p].toString();else{const v=[];for(let x=0;x<o[0];x++)for(let b=0;b<o[2];b++)v.push(l.get(x,p,b));m=v.join(",")}const g=s.get(m);if(g!=null)a[p]=g;else{const v=s.size;s.set(m,v),a[p]=v,c.push(p)}}const d=o.slice();d[1]=s.size;const f=new ti(d,i);c.forEach((p,m)=>{for(let g=0;g<o[0];g++)for(let v=0;v<o[2];v++)f.set(l.get(g,p,v),g,m,v)});const h=t.slice();return h[r]=d[1],{outputValues:f.values,outputShape:h,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ=Object.freeze(Object.defineProperty({__proto__:null,addImpl:tT,bincountImpl:jb,bincountReduceImpl:nT,bitwiseAndImpl:iT,castImpl:eT,ceilImpl:rT,concatImpl:oT,equalImpl:sT,expImpl:lT,expm1Impl:uT,floorDivImpl:hT,floorImpl:dT,gatherNdImpl:fT,gatherV2Impl:pT,greaterEqualImpl:gT,greaterImpl:mT,lessEqualImpl:xT,lessImpl:vT,linSpaceImpl:bT,logImpl:yT,maxImpl:wT,maximumImpl:CT,minimumImpl:ST,multiplyImpl:Kb,negImpl:IT,notEqualImpl:$T,prodImpl:ET,raggedGatherImpl:NT,raggedRangeImpl:kT,raggedTensorToTensorImpl:DT,rangeImpl:TT,rsqrtImpl:RT,scatterImpl:ta,sigmoidImpl:oJ,simpleAbsImpl:QD,sliceImpl:AT,sparseFillEmptyRowsImpl:OT,sparseReshapeImpl:PT,sparseSegmentReductionImpl:qb,sqrtImpl:lJ,squaredDifferenceImpl:MT,staticRegexReplaceImpl:FT,stridedSliceImpl:LT,stringNGramsImpl:zT,stringSplitImpl:BT,stringToHashBucketFastImpl:VT,subImpl:WT,tileImpl:GT,topKImpl:UT,transposeImpl:Xb,uniqueImpl:jT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */l2("cpu",()=>new Wp,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KT=Kt(Iu,n=>n>=0?n:Math.exp(n)-1),yJ={kernelName:Iu,backendName:"cpu",kernelFunc:KT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XT(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{alpha:o}=i;He([r],"leakyRelu");const s=he(r.shape),a=t.data.get(r.dataId).values,l=pi("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?o*a[c]:a[c];return t.makeTensorInfo(r.shape,"float32",l)}const wJ={kernelName:zf,backendName:"cpu",kernelFunc:XT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CJ=Rn((n,e)=>n<0?e*n:n);function qT(n){const{inputs:e,backend:t}=n,{x:i,alpha:r}=e;He([i,r],"prelu");const o=t.data.get(i.dataId).values,s=t.data.get(r.dataId).values,[a,l]=CJ(i.shape,r.shape,o,s,"float32");return t.makeTensorInfo(l,"float32",a)}const SJ={kernelName:rp,backendName:"cpu",kernelFunc:qT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YT=Kt(Gu,n=>Math.max(0,n)),IJ={kernelName:Gu,backendName:"cpu",kernelFunc:YT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JT=Kt(Hu,n=>Math.min(Math.max(0,n),6)),$J={kernelName:Hu,backendName:"cpu",kernelFunc:JT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(n,e,t,i,r){if(t==="linear")return ko({inputs:{x:e},backend:n});if(t==="relu")return YT({inputs:{x:e},backend:n});if(t==="elu")return KT({inputs:{x:e},backend:n});if(t==="relu6")return JT({inputs:{x:e},backend:n});if(t==="prelu")return qT({inputs:{x:e,alpha:i},backend:n});if(t==="leakyrelu")return XT({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return _T({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rn(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{shape:o}=i,s=he(r.shape),a=pE(o,s),l=he(a);F(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const c=t.data.get(r.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const EJ={kernelName:sp,backendName:"cpu",kernelFunc:rn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(n){const{inputs:e,backend:t,attrs:i}=n,{a:r,b:o}=e,{transposeA:s,transposeB:a}=i;He([r,o],"matMul");const l=r.shape.length,c=o.shape.length,u=s?r.shape[l-2]:r.shape[l-1],d=a?o.shape[c-1]:o.shape[c-2],f=s?r.shape[l-1]:r.shape[l-2],h=a?o.shape[c-2]:o.shape[c-1],p=r.shape.slice(0,-2),m=o.shape.slice(0,-2),g=he(p),v=he(m),b=vt(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,h]);F(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${s} and transposeB=${a} must match.`);const w=s?[g,u,f]:[g,f,u],y=a?[v,h,d]:[v,d,h],C=rn({inputs:{x:r},backend:t,attrs:{shape:w}}),$=rn({inputs:{x:o},backend:t,attrs:{shape:y}}),I=s?C.shape[1]:C.shape[2],E=s?C.shape[2]:C.shape[1],N=a?$.shape[1]:$.shape[2],k=Math.max(g,v),D=t.data.get(C.dataId).values,_=t.data.get($.dataId).values,R=Qe(C.shape),T=Qe($.shape),[A,O,P]=s?[R[0],1,R[1]]:[R[0],R[1],1],[M,z,L]=a?[1,T[1],T[0]]:[T[1],1,T[0]],W=E*N,U=wt([k,E,N],C.dtype),V=U.values,H=t.blockSize;for(let Y=0;Y<k;Y++){const Q=Y%g,Z=Y%v;for(let pe=0;pe<E;pe+=H){const oe=Math.min(pe+H,E);for(let X=0;X<N;X+=H){const j=Math.min(X+H,N);for(let ne=0;ne<I;ne+=H){const se=Math.min(ne+H,I);for(let ce=pe;ce<oe;ce++)for(let re=X;re<j;re++){let be=0;for(let Ie=ne;Ie<se;Ie++){const Ee=D[Q*A+ce*O+Ie*P],Se=_[Ie*M+re*z+Z*L];be+=Ee*Se}V[Y*W+(ce*N+re)]+=be}}}}}return t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo($),t.makeTensorInfo(b,U.dtype,U.values)}const NJ={kernelName:If,backendName:"cpu",kernelFunc:ZT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kJ(n){const{inputs:e,backend:t,attrs:i}=n,{a:r,b:o,bias:s,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=i;let f,h,p;const m=[];f=ZT({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:c},backend:t}),s&&(h=Ml({inputs:{a:f,b:s},backend:t}),m.push(f),f=h),u&&(p=Xh(t,f,u,a,d),m.push(f),f=p);for(const v of m)t.disposeIntermediateTensorInfo(v);return f}const DJ={kernelName:$h,backendName:"cpu",kernelFunc:kJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TJ=Kt(du,n=>Math.acos(n)),RJ={kernelName:du,backendName:"cpu",kernelFunc:TJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _J=Kt(hu,n=>Math.acosh(n)),AJ={kernelName:hu,backendName:"cpu",kernelFunc:_J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OJ(n){const{inputs:e,backend:t}=n,i=e;He(e,"addN");const r=i.map(a=>t.data.get(a.dataId).values),o=wt(i[0].shape,i[0].dtype),s=o.values;for(let a=0;a<i.length;a++){const l=r[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const PJ={kernelName:Sx,backendName:"cpu",kernelFunc:OJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i;He(r,"all");const a=Ct(o,r.shape);let l=a;const c=xn(l,r.shape.length);let u=r;c!=null&&(u=zi({inputs:{x:r},backend:t,attrs:{perm:c}}),l=Dn(l.length,r.shape.length)),ii("all",l,u.shape.length);const[d,f]=Zn(u.shape,l),h=he(f),p=mi(he(d),u.dtype),m=t.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const x=v*h;let b=m[x];for(let w=0;w<h;++w){const y=m[x+w];b=b&&y}p[v]=b}c!=null&&t.disposeIntermediateTensorInfo(u);const g=t.makeTensorInfo(d,u.dtype,p);if(s){const v=Pn(d,a),x=rn({inputs:{x:g},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(g),x}return g}const FJ={kernelName:Ix,backendName:"cpu",kernelFunc:MJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i;He(r,"any");const a=Ct(o,r.shape);let l=a;const c=xn(l,r.shape.length);let u=r;c!=null&&(u=zi({inputs:{x:r},backend:t,attrs:{perm:c}}),l=Dn(l.length,r.shape.length)),ii("any",l,u.shape.length);const[d,f]=Zn(u.shape,l),h=he(f),p=mi(he(d),u.dtype),m=t.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const x=v*h;let b=m[x];for(let w=0;w<h;++w){const y=m[x+w];b=b||y}p[v]=b}c!=null&&t.disposeIntermediateTensorInfo(u);const g=t.makeTensorInfo(d,u.dtype,p);if(s){const v=Pn(d,a),x=rn({inputs:{x:g},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(g),x}return g}const zJ={kernelName:$x,backendName:"cpu",kernelFunc:LJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BJ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o}=i;He(r,"argMax");let s=Ct(o,r.shape);const a=xn(s,r.shape.length);let l=r;const c=[];a!=null&&(l=zi({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),s=Dn(s.length,l.shape.length)),s=[s[0]],ii("argMax",s,l.shape.length);const[u,d]=Zn(l.shape,s),f=he(u),h=mi(f,"int32"),p=he(d),m=t.data.get(l.dataId).values;for(let g=0;g<h.length;++g){const v=g*p;let x=m[v],b=0;for(let w=0;w<p;++w){const y=m[v+w];y>x&&(x=y,b=w)}h[g]=b}return c.forEach(g=>t.disposeIntermediateTensorInfo(g)),t.makeTensorInfo(u,"int32",h)}const VJ={kernelName:yf,backendName:"cpu",kernelFunc:BJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o}=i;He(r,"argMin");let s=Ct(o,r.shape);const a=xn(s,r.shape.length);let l=r;const c=[];a!=null&&(l=zi({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),s=Dn(s.length,l.shape.length)),s=[s[0]],ii("argMin",s,l.shape.length);const[u,d]=Zn(l.shape,s),f=he(u),h=mi(f,"int32"),p=he(d),m=t.data.get(l.dataId).values;for(let g=0;g<h.length;++g){const v=g*p;let x=m[v],b=0;for(let w=0;w<p;++w){const y=m[v+w];y<x&&(x=y,b=w)}h[g]=b}return c.forEach(g=>t.disposeIntermediateTensorInfo(g)),t.makeTensorInfo(u,"int32",h)}const GJ={kernelName:wf,backendName:"cpu",kernelFunc:WJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HJ=Kt(fu,n=>Math.asin(n)),UJ={kernelName:fu,backendName:"cpu",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jJ=Kt(pu,n=>Math.asinh(n)),KJ={kernelName:pu,backendName:"cpu",kernelFunc:jJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XJ=Kt(mu,n=>Math.atan(n)),qJ={kernelName:mu,backendName:"cpu",kernelFunc:XJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YJ=Rn((n,e)=>Math.atan2(n,e)),JJ=Hn(vu,YJ),ZJ={kernelName:vu,backendName:"cpu",kernelFunc:JJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ=Kt(gu,n=>Math.atanh(n)),eZ={kernelName:gu,backendName:"cpu",kernelFunc:QJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jb(n,e,t,i,r,o){const s=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=wt(r.outShape,t),g=m.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],x=r.outShape[2]*r.outShape[3],b=r.outShape[3];for(let w=0;w<r.batchSize;++w){const y=w*v,C=w*i[0];for(let $=0;$<r.inChannels;++$)for(let I=0;I<r.outHeight;++I){const E=I*s-f,N=Math.max(0,E),k=Math.min(r.inHeight,u+E),D=y+I*x;for(let _=0;_<r.outWidth;++_){const R=_*a-h,T=Math.max(0,R),A=Math.min(r.inWidth,d+R);let O=p,P=0,M=0;for(let L=N;L<k;L+=l){const W=C+L*i[1];for(let U=T;U<A;U+=c){const V=W+U*i[2],H=n[V+$];o==="max"&&H>O?O=H:o==="avg"&&(P+=H,M++)}if(isNaN(O))break}const z=D+_*b+$;g[z]=o==="avg"?P/M:O}}}return m}function QT(n,e,t,i,r=!1,o=!1){const s=wt(i.outShape,"int32"),a=i.strideHeight,l=i.strideWidth,c=i.dilationHeight,u=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=i.padInfo.top,p=i.padInfo.left,m=wt(e,t,n);for(let g=0;g<i.batchSize;++g)for(let v=0;v<i.inChannels;++v)for(let x=0;x<i.outHeight;++x){const b=x*a-h;let w=b;for(;w<0;)w+=c;const y=Math.min(i.inHeight,d+b);for(let C=0;C<i.outWidth;++C){const $=C*l-p;let I=$;for(;I<0;)I+=u;const E=Math.min(i.inWidth,f+$);let N=Number.NEGATIVE_INFINITY,k=-1;for(let D=w;D<y;D+=c){const _=D-b;for(let R=I;R<E;R+=u){const T=R-$,A=m.get(g,D,R,v);A>N&&(N=A,r?k=o?((g*i.inHeight+D)*i.inWidth+R)*i.inChannels+v:(D*i.inWidth+R)*i.inChannels+v:k=_*f+T)}}s.set(k,g,x,C,v)}}return s}function eR(n,e,t,i,r,o){const s=r.strideDepth,a=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,f=r.effectiveFilterDepth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,x=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=wt(r.outShape,t),w=b.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],$=r.outShape[3]*r.outShape[4],I=r.outShape[4];for(let E=0;E<r.batchSize;++E){const N=E*y,k=E*i[0];for(let D=0;D<r.inChannels;++D)for(let _=0;_<r.outDepth;++_){const R=_*s-m;let T=R;for(;T<0;)T+=c;const A=Math.min(r.inDepth,f+R),O=N+_*C;for(let P=0;P<r.outHeight;++P){const M=P*a-g;let z=M;for(;z<0;)z+=u;const L=Math.min(r.inHeight,h+M),W=O+P*$;for(let U=0;U<r.outWidth;++U){const V=U*l-v;let H=V;for(;H<0;)H+=d;const Y=Math.min(r.inWidth,p+V),Q=W+U*I;let Z=x,pe=0,oe=0;for(let j=T;j<A;j+=c){const ne=k+j*i[1];for(let se=z;se<L;se+=u){const ce=ne+se*i[2];for(let re=H;re<Y;re+=d){const be=ce+re*i[3],Ie=n[be+D];if(o==="max"&&Ie>Z?Z=Ie:o==="avg"&&(pe+=Ie,oe++),isNaN(Z))break}if(isNaN(Z))break}if(isNaN(Z))break}const X=Q+D;w[X]=o==="avg"?pe/Math.max(oe,1):Z}}}}return b}function tZ(n,e){const t=wt(e.outShape,"int32"),i=e.strideDepth,r=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,h=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let v=0;v<e.outDepth;++v){const x=v*i-f;let b=x;for(;b<0;)b+=s;const w=Math.min(e.inDepth,c+x);for(let y=0;y<e.outHeight;++y){const C=y*r-h;let $=C;for(;$<0;)$+=a;const I=Math.min(e.inHeight,u+C);for(let E=0;E<e.outWidth;++E){const N=E*o-p;let k=N;for(;k<0;)k+=l;const D=Math.min(e.inWidth,d+N);let _=Number.NEGATIVE_INFINITY,R=-1;for(let T=b;T<w;T+=s){const A=T-x;for(let O=$;O<I;O+=a){const P=O-C;for(let M=k;M<D;M+=l){const z=M-N,L=n.get(m,T,O,M,g);L>=_&&(_=L,R=A*u*d+P*u+z)}}}t.set(R,m,v,y,E,g)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e;He(r,"avgPool");const{filterSize:o,strides:s,pad:a,dimRoundingMode:l}=i,c=1;F(vi(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=_r(r.shape,o,s,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Ht(u.inShape,u.outShape))d=ko({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,h=Qe(r.shape),p=Jb(f,r.shape,r.dtype,h,u,"avg");d=t.makeTensorInfo(u.outShape,r.dtype,p.values)}return d}const iZ={kernelName:Cf,backendName:"cpu",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{filterSize:o,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=i;He(r,"avgPool3d");const u=Qo(r.shape,o,s,1,a,l,c),d=t.data.get(r.dataId).values,f=eR(d,r.shape,r.dtype,Qe(r.shape),u,"avg");return t.makeTensorInfo(f.shape,"float32",f.values)}const oZ={kernelName:Sf,backendName:"cpu",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o}=e,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=i;He([r,o],"avgPool3DGrad");const u=Qo(o.shape,s,a,1,l,c),d=u.strideDepth,f=u.strideHeight,h=u.strideWidth,p=u.filterDepth,m=u.filterHeight,g=u.filterWidth,v=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,w=u.effectiveFilterDepth,y=u.effectiveFilterHeight,C=u.effectiveFilterWidth,$=w-1-u.padInfo.front,I=C-1-u.padInfo.left,E=y-1-u.padInfo.top,N=wt(o.shape,"float32"),k=1/(p*m*g),D=t.bufferSync(r);for(let _=0;_<u.batchSize;++_)for(let R=0;R<u.inChannels;++R)for(let T=0;T<u.inDepth;++T)for(let A=0;A<u.inHeight;++A)for(let O=0;O<u.inWidth;++O){const P=T-$,M=A-E,z=O-I;let L=0;for(let W=0;W<w;W+=v){const U=(P+W)/d;if(!(U<0||U>=u.outDepth||Math.floor(U)!==U))for(let V=0;V<y;V+=x){const H=(M+V)/f;if(!(H<0||H>=u.outHeight||Math.floor(H)!==H))for(let Y=0;Y<C;Y+=b){const Q=(z+Y)/h;if(Q<0||Q>=u.outWidth||Math.floor(Q)!==Q)continue;const Z=D.get(_,U,H,Q,R);L+=Z}}}N.set(L*k,_,T,A,O,R)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const aZ={kernelName:Nx,backendName:"cpu",kernelFunc:sZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o}=e,s=o;He([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=i,u=_r(s.shape,a,l,1,c),d=u.strideHeight,f=u.strideWidth,h=u.filterHeight,p=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,v=u.effectiveFilterHeight,x=u.effectiveFilterWidth,b=x-1-u.padInfo.left,w=v-1-u.padInfo.top,y=wt(s.shape,"float32"),C=1/(h*p),$=t.data.get(r.dataId).values,I=wt(r.shape,"float32",$);for(let E=0;E<u.batchSize;++E)for(let N=0;N<u.inChannels;++N)for(let k=0;k<u.inHeight;++k)for(let D=0;D<u.inWidth;++D){const _=k-w,R=D-b;let T=0;for(let A=0;A<v;A+=m){const O=(_+A)/d;if(!(O<0||O>=u.outHeight||Math.floor(O)!==O))for(let P=0;P<x;P+=g){const M=(R+P)/f;if(M<0||M>=u.outWidth||Math.floor(M)!==M)continue;const z=I.get(E,O,M,N);T+=z}}y.set(T*C,E,k,D,N)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const cZ={kernelName:Ex,backendName:"cpu",kernelFunc:lZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,scale:o,offset:s,mean:a,variance:l}=e;F(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),He([r,a,l,o,s],"batchNorm");let{varianceEpsilon:c}=i;c==null&&(c=.001);const u=t.data.get(r.dataId).values,d=t.data.get(a.dataId).values,f=t.data.get(l.dataId).values,h=o?t.data.get(o.dataId).values:new Float32Array([1]),p=s?t.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=p.length,v=h.length,x=f.length,b=d.length;let w=0,y=0,C=0,$=0;for(let I=0;I<u.length;++I)m[I]=p[w++]+(u[I]-d[y++])*h[C++]/Math.sqrt(f[$++]+c),w>=g&&(w=0),y>=b&&(y=0),C>=v&&(C=0),$>=x&&($=0);return t.makeTensorInfo(r.shape,r.dtype,m)}const dZ={kernelName:Mf,backendName:"cpu",kernelFunc:uZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{blockShape:o,crops:s}=i;He([r],"batchToSpaceND");const a=o.reduce((v,x)=>v*x),l=dd(r.shape,o,a),c=hd(l.length,o.length),u=fd(r.shape,o,a),d=sb(s,o.length),f=ab(u,s,o.length),h=rn({inputs:{x:r},backend:t,attrs:{shape:l}}),p=zi({inputs:{x:h},backend:t,attrs:{perm:c}}),m=rn({inputs:{x:p},backend:t,attrs:{shape:u}}),g=Ea({inputs:{x:m},backend:t,attrs:{begin:d,size:f}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}const fZ={kernelName:$f,backendName:"cpu",kernelFunc:hZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,weights:o}=e,{size:s}=i,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,c=jb(a,l,o.dtype,o.shape,s);return t.makeTensorInfo([s],o.dtype,c)}const mZ={kernelName:kx,backendName:"cpu",kernelFunc:pZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(n){const{inputs:e,backend:t}=n,{s0:i,s1:r}=e,o=t.data.get(i.dataId).values,s=t.data.get(r.dataId).values,a=vt(Array.from(o),Array.from(s));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const vZ={kernelName:yE,backendName:"cpu",kernelFunc:gZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xZ=Kt(yu,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),bZ={kernelName:yu,backendName:"cpu",kernelFunc:xZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yZ=n=>{const{x:e}=n.inputs,t=n.backend,i=new Float32Array(he(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,s=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];i[c]=Math.hypot(u,d)}return t.makeOutput(i,e.shape,"float32")},wZ={kernelName:Ef,backendName:"cpu",kernelFunc:yZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fl(n){const{inputs:e,backend:t}=n,{input:i}=e,r=t.data.get(i.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const CZ={kernelName:jx,backendName:"cpu",kernelFunc:Fl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ll(n){const{inputs:e,backend:t,attrs:i}=n,{axis:r}=i,o=Ct(r,e[0].shape)[0],s=e.map(m=>m.shape);ib(s,o);let a=xo(e.map(m=>m.shape),o);if(he(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>he(m.shape)>0);if(l.length===1)return ko({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const m=l.map(w=>$a({inputs:{input:w},backend:t})),g=l.map(w=>Fl({inputs:{input:w},backend:t})),v=Ll({inputs:m,backend:t,attrs:{axis:o}}),x=Ll({inputs:g,backend:t,attrs:{axis:o}}),b=ji({inputs:{real:v,imag:x},backend:t});return m.forEach(w=>t.disposeIntermediateTensorInfo(w)),g.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(x),b}const c=l.map(m=>{const v=[-1,he(m.shape.slice(o))];return rn({inputs:{x:m},backend:t,attrs:{shape:v}})}),u=c.map(m=>({vals:t.data.get(m.dataId).values,shape:m.shape}));a=xo(c.map(m=>m.shape),1);const d=c[0].shape[0]===1,f=oT(u,a,e[0].dtype,d),h=xo(l.map(m=>m.shape),o),p=t.makeTensorInfo(h,e[0].dtype,f);return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const SZ={kernelName:Nf,backendName:"cpu",kernelFunc:Ll};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tR(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=i;He([r,o],"conv2d");const d=es(l),f=ni(r.shape,o.shape,s,c,a,u,!1,d),h=f.filterHeight,p=f.filterWidth,m=f.dilationHeight,g=f.dilationWidth,v=f.padInfo.left,x=f.padInfo.top,b=f.dataFormat==="channelsLast",w=new ti(f.outShape,r.dtype),y=Qe(r.shape),C=Qe(o.shape),$=y[0],I=b?y[1]:y[2],E=b?y[2]:1,N=b?1:y[1],k=w.strides[0],D=b?w.strides[1]:w.strides[2],_=b?w.strides[2]:1,R=b?1:w.strides[1],T=t.data.get(r.dataId).values,A=t.data.get(o.dataId).values,O=w.values;for(let P=0;P<f.batchSize;++P){const M=P*$,z=P*k;for(let L=0;L<f.outHeight;++L){const W=z+L*D,U=L*f.strideHeight-x;for(let V=0;V<h;++V){const H=U+V*m;if(H<0||H>=f.inHeight)continue;const Y=V*C[0],Q=M+H*I;for(let Z=0;Z<f.outWidth;++Z){const pe=W+Z*_,oe=Z*f.strideWidth-v;for(let X=0;X<p;++X){const j=oe+X*g;if(j<0||j>=f.inWidth)continue;const ne=Y+X*C[1],se=Q+j*E;let ce=ne;for(let re=0;re<f.inChannels;++re){const be=T[se+re*N];for(let Ie=0;Ie<f.outChannels;++Ie)O[pe+Ie*R]+=be*A[ce+Ie];ce+=f.outChannels}}}}}}return t.makeTensorInfo(w.shape,w.dtype,O)}const IZ={kernelName:kf,backendName:"cpu",kernelFunc:tR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,dy:o}=e,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=i;He([r,o],"conv2dBackpropFilter");const d=es(l),f=ni(r.shape,u,s,1,a,c,!1,d),{strideHeight:h,strideWidth:p,filterHeight:m,filterWidth:g}=f,v=f.dataFormat==="channelsLast",x=new ti(f.filterShape,"float32"),b=f.padInfo.left,w=f.padInfo.top,y=t.data.get(r.dataId).values,C=t.data.get(o.dataId).values,$=new ti(r.shape,r.dtype,y),I=new ti(o.shape,o.dtype,C);for(let E=0;E<m;++E){const N=Math.max(0,Math.ceil((w-E)/h)),k=Math.min(f.outHeight,(f.inHeight+w-E)/h);for(let D=0;D<g;++D){const _=Math.max(0,Math.ceil((b-D)/p)),R=Math.min(f.outWidth,(f.inWidth+b-D)/p);for(let T=0;T<f.inChannels;++T)for(let A=0;A<f.outChannels;++A){let O=0;for(let P=0;P<f.batchSize;++P)for(let M=N;M<k;++M){const z=E+M*h-w;for(let L=_;L<R;++L){const W=D+L*p-b;v?O+=$.get(P,z,W,T)*I.get(P,M,L,A):O+=$.get(P,T,z,W)*I.get(P,A,M,L)}}x.set(O,E,D,T,A)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const EZ={kernelName:Rx,backendName:"cpu",kernelFunc:$Z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,filter:o}=e,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=i;He([r,o],"conv2dBackpropInput");const d=Qe(o.shape),f=Qe(r.shape);let h=es(c);const p=ni(s,o.shape,a,1,l,u,!1,h),m=new ti(p.inShape,"float32"),g=m.values,v=t.data.get(r.dataId).values,x=t.data.get(o.dataId).values,[b,w,y]=d,{batchSize:C,filterHeight:$,filterWidth:I,inChannels:E,inHeight:N,inWidth:k,outChannels:D,outHeight:_,outWidth:R,strideHeight:T,strideWidth:A}=p;h=p.dataFormat;const O=$-1-p.padInfo.top,P=I-1-p.padInfo.left,M=h==="channelsLast",z=m.strides[0],L=M?m.strides[1]:m.strides[2],W=M?m.strides[2]:1,U=M?1:m.strides[1],V=f[0],H=M?f[1]:f[2],Y=M?f[2]:1,Q=M?1:f[1];for(let Z=0;Z<C;++Z)for(let pe=0;pe<E;++pe)for(let oe=0;oe<N;++oe){const X=oe-O,j=Math.max(0,Math.ceil(X/T)),ne=Math.min(_,($+X)/T);for(let se=0;se<k;++se){const ce=se-P,re=Math.max(0,Math.ceil(ce/A)),be=Math.min(R,(I+ce)/A);let Ie=0;for(let Se=j;Se<ne;++Se){const fe=Se*T-X;for(let ge=re;ge<be;++ge){const we=ge*A-ce,ve=V*Z+H*Se+Y*ge,Ne=b*($-1-fe)+w*(I-1-we)+y*pe;for(let Ae=0;Ae<D;++Ae){const Ve=v[ve+Q*Ae],Ue=x[Ne+Ae];Ie+=Ve*Ue}}}const Ee=z*Z+L*oe+W*se+U*pe;g[Ee]=Ie}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const kZ={kernelName:Df,backendName:"cpu",kernelFunc:NZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dilations:l}=i;He([r,o],"conv3d");const c=Rs(r.shape,o.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:f,dilationDepth:h,dilationHeight:p,dilationWidth:m,padInfo:g}=c,v=g.front,x=g.left,b=g.top,w=new ti(c.outShape,r.dtype),y=t.data.get(r.dataId).values,C=t.data.get(o.dataId).values,$=w.values,I=Qe(r.shape),E=Qe(o.shape);for(let N=0;N<c.batchSize;++N){const k=N*I[0],D=N*w.strides[0];for(let _=0;_<c.outDepth;++_){const R=D+_*w.strides[1],T=_*c.strideDepth-v;for(let A=0;A<u;++A){const O=T+A*h;if(O<0||O>=c.inDepth)continue;const P=A*E[0],M=k+O*I[1];for(let z=0;z<c.outHeight;++z){const L=R+z*w.strides[2],W=z*c.strideHeight-b;for(let U=0;U<d;++U){const V=W+U*p;if(V<0||V>=c.inHeight)continue;const H=P+U*E[1],Y=M+V*I[2];for(let Q=0;Q<c.outWidth;++Q){const Z=L+Q*c.outChannels,pe=Q*c.strideWidth-x;for(let oe=0;oe<f;++oe){const X=pe+oe*m;if(X<0||X>=c.inWidth)continue;const j=H+oe*E[2],ne=Y+X*c.inChannels;let se=j;for(let ce=0;ce<c.inChannels;++ce){const re=y[ne+ce];for(let be=0;be<c.outChannels;++be)$[Z+be]+=re*C[se+be];se+=c.outChannels}}}}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const TZ={kernelName:Tf,backendName:"cpu",kernelFunc:DZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,dy:o}=e,{strides:s,pad:a,filterShape:l}=i;He([r,o],"conv3dBackpropFilterV2");const c=Qe(r.shape),u=Qe(o.shape),d=Rs(r.shape,l,s,1,a),f=d.strideDepth,h=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,v=d.filterWidth,x=new ti(d.filterShape,"float32"),b=x.values,[w,y,C,$]=x.strides,I=t.data.get(o.dataId).values,[E,N,k,D]=u,_=t.data.get(r.dataId).values,[R,T,A,O]=c,P=d.padInfo.front,M=d.padInfo.left,z=d.padInfo.top;for(let L=0;L<m;++L){const W=Math.max(0,Math.ceil((P-L)/f)),U=Math.min(d.outDepth,(d.inDepth+P-L)/f),V=L*w;for(let H=0;H<g;++H){const Y=Math.max(0,Math.ceil((z-H)/h)),Q=Math.min(d.outHeight,(d.inHeight+z-H)/h),Z=H*y+V;for(let pe=0;pe<v;++pe){const oe=Math.max(0,Math.ceil((M-pe)/p)),X=Math.min(d.outWidth,(d.inWidth+M-pe)/p),j=pe*C+Z;for(let ne=0;ne<d.inChannels;++ne){const se=ne*$+j;for(let ce=0;ce<d.outChannels;++ce){let re=0;for(let be=0;be<d.batchSize;++be){const Ie=be*R,Ee=be*E;for(let Se=W;Se<U;++Se){const ge=(L+Se*f-P)*T+Ie,we=Se*N+Ee;for(let ve=Y;ve<Q;++ve){const Ae=(H+ve*h-z)*A+ge,Ve=ve*k+we;for(let Ue=oe;Ue<X;++Ue){const Le=(pe+Ue*p-M)*O+Ae,lt=Ue*D+Ve;re+=_[Le+ne]*I[lt+ce]}}}}b[se+ce]=re}}}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const _Z={kernelName:_x,backendName:"cpu",kernelFunc:RZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AZ(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,filter:o}=e,{pad:s,strides:a,inputShape:l}=i;He([r],"conv3dBackpropInputV2");const c=Qe(r.shape),u=Qe(o.shape),d=Rs(l,o.shape,a,1,s),f=new ti(d.inShape,"float32"),h=f.values,[p,m,g,v]=f.strides,x=t.data.get(r.dataId).values,[b,w,y,C]=c,$=t.data.get(o.dataId).values,[I,E,N,k]=u,{batchSize:D,filterDepth:_,filterHeight:R,filterWidth:T,inChannels:A,inDepth:O,inHeight:P,inWidth:M,outChannels:z,outDepth:L,outHeight:W,outWidth:U,strideDepth:V,strideHeight:H,strideWidth:Y}=d,Q=_-1-d.padInfo.front,Z=R-1-d.padInfo.top,pe=T-1-d.padInfo.left;for(let oe=0;oe<D;++oe)for(let X=0;X<A;++X)for(let j=0;j<O;++j){const ne=j-Q,se=Math.max(0,Math.ceil(ne/V)),ce=Math.min(L,(_+ne)/V);for(let re=0;re<P;++re){const be=re-Z,Ie=Math.max(0,Math.ceil(be/H)),Ee=Math.min(W,(R+be)/H);for(let Se=0;Se<M;++Se){const fe=Se-pe,ge=Math.max(0,Math.ceil(fe/Y)),we=Math.min(U,(T+fe)/Y);let ve=0;for(let Ne=se;Ne<ce;++Ne){const Ae=Ne*V-ne;for(let Ve=Ie;Ve<Ee;++Ve){const Ue=Ve*H-be;for(let We=ge;We<we;++We){const Le=We*Y-fe,lt=b*oe+w*Ne+y*Ve+C*We,ot=I*(_-1-Ae)+E*(R-1-Ue)+N*(T-1-Le)+k*X;for(let Me=0;Me<z;++Me){const Fe=x[lt+Me],Ke=$[ot+Me];ve+=Fe*Ke}}}}h[p*oe+m*j+g*re+v*Se+X]=ve}}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const OZ={kernelName:Ax,backendName:"cpu",kernelFunc:AZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PZ=Kt(wu,n=>Math.cos(n)),MZ={kernelName:wu,backendName:"cpu",kernelFunc:PZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FZ=Kt(Cu,n=>Math.cosh(n)),LZ={kernelName:Cu,backendName:"cpu",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(n){const{inputs:e,backend:t,attrs:i}=n,{image:r,boxes:o,boxInd:s}=e,{cropSize:a,method:l,extrapolationValue:c}=i,[u,d,f,h]=r.shape,p=o.shape[0],[m,g]=a,v=wt([p,m,g,h],"float32"),x=t.data.get(o.dataId).values,b=t.data.get(s.dataId).values,w=t.data.get(r.dataId).values,y=Qe(r.shape),C=Qe(v.shape);for(let $=0;$<p;$++){const I=$*4,E=x[I],N=x[I+1],k=x[I+2],D=x[I+3],_=b[$];if(_>=u)continue;const R=m>1?(k-E)*(d-1)/(m-1):0,T=g>1?(D-N)*(f-1)/(g-1):0;for(let A=0;A<m;A++){const O=m>1?E*(d-1)+A*R:.5*(E+k)*(d-1);if(O<0||O>d-1){for(let P=0;P<g;P++)for(let M=0;M<h;M++){const z=M+P*C[2]+A*C[1]+$*C[0];v.values[z]=c}continue}if(l==="bilinear"){const P=Math.floor(O),M=Math.ceil(O),z=O-P;for(let L=0;L<g;L++){const W=g>1?N*(f-1)+L*T:.5*(N+D)*(f-1);if(W<0||W>f-1){for(let Y=0;Y<h;Y++){const Q=Y+L*C[2]+A*C[1]+$*C[0];v.values[Q]=c}continue}const U=Math.floor(W),V=Math.ceil(W),H=W-U;for(let Y=0;Y<h;Y++){let Q=Y+U*y[2]+P*y[1]+_*y[0];const Z=w[Q];Q=Y+V*y[2]+P*y[1]+_*y[0];const pe=w[Q];Q=Y+U*y[2]+M*y[1]+_*y[0];const oe=w[Q];Q=Y+V*y[2]+M*y[1]+_*y[0];const X=w[Q],j=Z+(pe-Z)*H,ne=oe+(X-oe)*H;Q=Y+L*C[2]+A*C[1]+$*C[0],v.values[Q]=j+(ne-j)*z}}}else for(let P=0;P<g;++P){const M=g>1?N*(f-1)+P*T:.5*(N+D)*(f-1);if(M<0||M>f-1){for(let W=0;W<h;W++){const U=W+P*C[2]+A*C[1]+$*C[0];v.values[U]=c}continue}const z=Math.round(M),L=Math.round(O);for(let W=0;W<h;W++){const U=W+z*y[2]+L*y[1]+_*y[0],V=W+P*C[2]+A*C[1]+$*C[0];v.values[V]=w[U]}}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const BZ={kernelName:Px,backendName:"cpu",kernelFunc:zZ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,exclusive:s,reverse:a}=i;He(r,"cumprod");const l=xn([o],r.shape.length);let c=r;l!=null&&(c=zi({inputs:{x:r},backend:t,attrs:{perm:l}}));const u=Dn(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Zi(c.dtype,"int32"),f=yx(he(c.shape),d),h=t.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,x)=>v+p-x-1:(v,x)=>v+x;for(let v=0;v<h.length;v+=p)for(let x=0;x<p;x++){const b=m(v,x);if(x===0)f[b]=s?1:h[b];else{const w=m(v,x-1);f[b]=s?h[w]*f[w]:h[b]*f[w]}}const g=t.makeTensorInfo(c.shape,d,f);if(l!=null){const v=_s(l),x=zi({inputs:{x:g},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(c),x}return g}const WZ={kernelName:Ox,backendName:"cpu",kernelFunc:VZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,exclusive:s,reverse:a}=i;He(r,"cumsum");const l=xn([o],r.shape.length);let c=r;l!=null&&(c=zi({inputs:{x:r},backend:t,attrs:{perm:l}}));const u=Dn(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Zi(c.dtype,"int32"),f=mi(he(c.shape),d),h=t.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,x)=>v+p-x-1:(v,x)=>v+x;for(let v=0;v<h.length;v+=p)for(let x=0;x<p;x++){const b=m(v,x);if(x===0)f[b]=s?0:h[b];else{const w=m(v,x-1);f[b]=s?h[w]+f[w]:h[b]+f[w]}}const g=t.makeTensorInfo(c.shape,d,f);if(l!=null){const v=_s(l),x=zi({inputs:{x:g},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(c),x}return g}const HZ={kernelName:Rf,backendName:"cpu",kernelFunc:GZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,weights:o}=e,{size:s,binaryOutput:a}=i;if(r.shape.length===1){const l=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,u=jb(l,c,o.dtype,o.shape,s);return t.makeTensorInfo([s],o.dtype,u)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(o),u=nT(l,c,s,a);return t.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const jZ={kernelName:Mx,backendName:"cpu",kernelFunc:UZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{blockSize:o,dataFormat:s}=i;F(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`);const a=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],d=l*o,f=c*o,h=u/(o*o),p=t.data.get(r.dataId).values,m=new Float32Array(a*d*f*h);let g=0;for(let v=0;v<a;++v)for(let x=0;x<d;++x){const b=Math.floor(x/o),w=x%o;for(let y=0;y<f;++y){const C=Math.floor(y/o),$=y%o,I=(w*o+$)*h;for(let E=0;E<h;++E){const k=E+I+u*(C+c*(b+l*v));m[g++]=p[k]}}}return t.makeTensorInfo([a,d,f,h],r.dtype,m)}const XZ={kernelName:Fx,backendName:"cpu",kernelFunc:KZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=i;He([r,o],"depthwiseConv2DNative");const u=Qe(r.shape),d=Qe(o.shape);let f=l;f==null&&(f=[1,1]),F(vi(s,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${f}'`);const h=ni(r.shape,o.shape,s,f,a,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:v,padInfo:x}=h,b=x.left,w=x.top,y=h.outChannels/h.inChannels,C=new ti(h.outShape,r.dtype),$=t.data.get(r.dataId).values,I=t.data.get(o.dataId).values,E=C.values;for(let N=0;N<h.batchSize;++N){const k=N*u[0],D=N*C.strides[0];for(let _=0;_<h.outHeight;++_){const R=D+_*C.strides[1],T=_*h.strideHeight-w;for(let A=0;A<p;++A){const O=T+A*g;if(O<0||O>=h.inHeight)continue;const P=A*d[0],M=k+O*u[1];for(let z=0;z<h.outWidth;++z){const L=R+z*C.strides[2],W=z*h.strideWidth-b;for(let U=0;U<m;++U){const V=W+U*v;if(V<0||V>=h.inWidth)continue;const H=P+U*d[1],Y=M+V*h.inChannels;let Q=L,Z=H;for(let pe=0;pe<h.inChannels;++pe){const oe=$[Y+pe];for(let X=0;X<y;++X)E[Q+X]+=oe*I[Z+X];Q+=y,Z+=y}}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const qZ={kernelName:_f,backendName:"cpu",kernelFunc:nR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,dy:o}=e,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=i;He([r,o],"depthwiseConv2dNativeBackpropFilter");const d=ni(r.shape,u,s,a,l,c,!0),{strideHeight:f,strideWidth:h,filterHeight:p,filterWidth:m}=d,g=new ti(d.filterShape,"float32"),v=d.padInfo.left,x=d.padInfo.top,b=d.outChannels/d.inChannels,w=t.data.get(r.dataId).values,y=new ti(r.shape,r.dtype,w),C=t.data.get(o.dataId).values,$=new ti(o.shape,o.dtype,C);for(let I=0;I<p;++I){const E=Math.max(0,Math.ceil((x-I)/f)),N=Math.min(d.outHeight,(d.inHeight+x-I)/f);for(let k=0;k<m;++k){const D=Math.max(0,Math.ceil((v-k)/h)),_=Math.min(d.outWidth,(d.inWidth+v-k)/h);for(let R=0;R<d.outChannels;++R){const T=Math.trunc(R/b),A=R%b;let O=0;for(let P=0;P<d.batchSize;++P)for(let M=E;M<N;++M){const z=I+M*f-x;for(let L=D;L<_;++L){const W=k+L*h-v;O+=y.get(P,z,W,T)*$.get(P,M,L,R)}}g.set(O,I,k,T,A)}}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const JZ={kernelName:Lx,backendName:"cpu",kernelFunc:YZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,filter:o}=e,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=i;He([r,o],"depthwiseConv2DNativeBackpropInput");const d=Qe(r.shape),f=Qe(o.shape),h=ni(u,o.shape,s,a,l,c,!0),p=new ti(h.inShape,"float32"),m=p.values,[g,v,x]=p.strides,b=t.data.get(r.dataId).values,[w,y,C]=d,$=t.data.get(o.dataId).values,[I,E,N]=f,{batchSize:k,filterHeight:D,filterWidth:_,inChannels:R,inHeight:T,inWidth:A,outChannels:O,outHeight:P,outWidth:M,strideHeight:z,strideWidth:L}=h,W=D-1-h.padInfo.top,U=_-1-h.padInfo.left,V=O/R;for(let H=0;H<k;++H)for(let Y=0;Y<R;++Y)for(let Q=0;Q<T;++Q){const Z=Q-W,pe=Math.max(0,Math.ceil(Z/z)),oe=Math.min(P,(D+Z)/z);for(let X=0;X<A;++X){const j=X-U,ne=Math.max(0,Math.ceil(j/L)),se=Math.min(M,(_+j)/L);let ce=0;for(let re=pe;re<oe;++re){const be=re*z-Z;for(let Ie=ne;Ie<se;++Ie){const Ee=Ie*L-j,Se=w*H+y*re+C*Ie,fe=I*(D-1-be)+E*(_-1-Ee)+N*Y;for(let ge=0;ge<V;++ge){const we=Y*V+ge,ve=b[Se+we],Ne=$[fe+ge];ce+=ve*Ne}}}m[g*H+v*Q+x*X+Y]=ce}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const QZ={kernelName:zx,backendName:"cpu",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(n){const{inputs:e,backend:t}=n,{x:i}=e,r=he(i.shape),o=t.data.get(i.dataId).values,s=wt([r,r],i.dtype),a=s.values;for(let c=0;c<o.length;c++)a[c*r+c]=o[c];const l=[...i.shape,...i.shape];return t.makeTensorInfo(l,s.dtype,s.values)}const tQ={kernelName:wE,backendName:"cpu",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nQ={kernelName:Af,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:i,filter:r}=n,{strides:o,pad:s,dilations:a}=t,l=e,c=l.data.get(i.dataId).values,u=i.shape.length,d=l.data.get(r.dataId).values,f=r.shape.length,{batchSize:h,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:x,padInfo:b,strideHeight:w,strideWidth:y,filterHeight:C,filterWidth:$,dilationHeight:I,dilationWidth:E,outShape:N}=sd(i.shape,r.shape,o,s,"NHWC",a),k=he(N),D=N.length,_=Sn(i.dtype,k);for(let T=0;T<h;++T)for(let A=0;A<v;++A){const O=A*w-b.top;for(let P=0;P<x;++P){const M=P*y-b.left;for(let z=0;z<g;++z){let L=Number.MIN_SAFE_INTEGER;for(let U=0;U<C;++U){const V=O+U*I;if(V>=0&&V<p)for(let H=0;H<$;++H){const Y=M+H*E;if(Y>=0&&Y<m){const Q=go([T,V,Y,z],u,Qe(i.shape)),Z=go([U,H,z],f,Qe(r.shape)),pe=c[Q]+d[Z];pe>L&&(L=pe)}}}const W=go([T,A,P,z],D,Qe(N));_[W]=L}}}return{dataId:l.write(Aa(_,i.dtype),N,i.dtype),shape:N,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ={kernelName:Ig,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:i,filter:r,dy:o}=n,{strides:s,pad:a,dilations:l}=t,c=e,u=Wr(i.shape,c.data.get(i.dataId).values),d=Wr(r.shape,c.data.get(r.dataId).values),{batchSize:f,inHeight:h,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:y,filterWidth:C,dilationHeight:$,dilationWidth:I,outShape:E}=sd(i.shape,r.shape,s,a,"NHWC",l);F(o.rank===E.length,()=>`Error in ${Ig}, dy must have the same rank as output ${E.length}, but got ${o.rank}`);const N=Wr(E,c.data.get(o.dataId).values),k=vE(r.shape,r.dtype);for(let _=0;_<f;++_)for(let R=0;R<g;++R){const T=R*b-x.top;for(let A=0;A<v;++A){const O=A*w-x.left;for(let P=0;P<m;++P){let M=Number.MIN_SAFE_INTEGER,z=0,L=0;for(let W=0;W<y;++W){const U=T+W*$;if(U>=0&&U<h)for(let V=0;V<C;++V){const H=O+V*I;if(H>=0&&H<p){const Y=u[_][U][H][P]+d[W][V][P];Y>M&&(M=Y,z=W,L=V)}}}k[z][L][P]+=N[_][R][A][P]}}}return{dataId:c.write(Aa(k,i.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rQ={kernelName:Sg,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:i,filter:r,dy:o}=n,{strides:s,pad:a,dilations:l}=t,c=e,u=Wr(i.shape,c.data.get(i.dataId).values),d=Wr(r.shape,c.data.get(r.dataId).values),{batchSize:f,inHeight:h,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:y,filterWidth:C,dilationHeight:$,dilationWidth:I,outShape:E}=sd(i.shape,r.shape,s,a,"NHWC",l);F(o.rank===E.length,()=>`Error in ${Sg}, dy must have the same rank as output ${E.length}, but got ${o.rank}`);const N=Wr(E,c.data.get(o.dataId).values),k=vE(i.shape,i.dtype);for(let _=0;_<f;++_)for(let R=0;R<g;++R){const T=R*b-x.top;for(let A=0;A<v;++A){const O=A*w-x.left;for(let P=0;P<m;++P){let M=Number.MIN_SAFE_INTEGER,z=T<0?0:T,L=O<0?0:O;for(let W=0;W<y;++W){const U=T+W*$;if(U>=0&&U<h)for(let V=0;V<C;++V){const H=O+V*I;if(H>=0&&H<p){const Y=u[_][U][H][P]+d[W][V][P];Y>M&&(M=Y,z=U,L=H)}}}k[_][z][L][P]+=N[_][R][A][P]}}}return{dataId:c.write(Aa(k,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(n){const{inputs:e,backend:t,attrs:i}=n,{image:r}=e,{canvas:o,options:s}=i,{contextOptions:a,imageOptions:l}=s||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[f,h]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],m=t.data.get(r.dataId).values,g=r.dtype==="float32"?255:1,v=new Uint8ClampedArray(h*f*4);for(let b=0;b<f*h;++b){const w=[0,0,0,255*c];for(let C=0;C<p;C++){const $=m[b*p+C];if(r.dtype==="float32"){if($<0||$>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${$}.`)}else if(r.dtype==="int32"&&($<0||$>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${$}.`);p===1?(w[0]=$*g,w[1]=$*g,w[2]=$*g):w[C]=$*g}const y=b*4;v[y+0]=Math.round(w[0]),v[y+1]=Math.round(w[1]),v[y+2]=Math.round(w[2]),v[y+3]=Math.round(w[3])}o.width=h,o.height=f;const x=new ImageData(v,h,f);return d.putImageData(x,0,0),r}const sQ={kernelName:IH,backendName:"cpu",kernelFunc:oQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cd(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i;He(r,"sum");let a;r.dtype==="bool"?a=Es({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=ko({inputs:{x:r},backend:t});const l=a.shape.length,c=Ct(o,a.shape),u=xn(c,l);let d=c,f=a;u!=null&&(f=zi({inputs:{x:a},backend:t,attrs:{perm:u}}),d=Dn(d.length,l)),ii("sum",d,f.shape.length);const[h,p]=Zn(f.shape,d),m=Zi(f.dtype,"int32");let g=jh(t,h,m);const v=he(p),x=t.data.get(g.dataId).values,b=t.data.get(f.dataId).values;for(let w=0;w<x.length;++w){const y=w*v;let C=0;for(let $=0;$<v;++$)C+=b[y+$];x[w]=C}if(s){const w=Pn(g.shape,c),y=g;g=rn({inputs:{x:g},backend:t,attrs:{shape:w}}),t.disposeIntermediateTensorInfo(y)}return t.disposeIntermediateTensorInfo(a),u!=null&&t.disposeIntermediateTensorInfo(f),g}const aQ={kernelName:hp,backendName:"cpu",kernelFunc:Cd};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(n){const{inputs:e,backend:t,attrs:i}=n,{equation:r}=i,o=e,{allDims:s,summedDims:a,idDims:l}=mb(r,o.length);vb(s.length,l,o);const{path:c,steps:u}=xb(a,l),d=u.length;let f=null,h=s.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:v,expandDims:x}=gb(h,l[g]);let b;bb(v)?b=o[g]:(b=zi({inputs:{x:o[g]},backend:t,attrs:{perm:v}}),p.push(b));const w=b.shape.slice();for(let y=0;y<x.length;++y)w.splice(x[y],0,1);Ht(b.shape,w)||(b=rn({inputs:{x:b},backend:t,attrs:{shape:w}}),p.push(b)),f===null?f=b:(f=Gp({inputs:{a:b,b:f},backend:t}),p.push(f))}m<d-1&&(c[m]>=0&&(f=Cd({inputs:{x:f},backend:t,attrs:{axis:c[m]-(s.length-h),keepDims:!1}}),p.push(f)),h--)}for(const m of p)m!==f&&t.disposeIntermediateTensorInfo(m);return f}const cQ={kernelName:Bx,backendName:"cpu",kernelFunc:lQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(n){const{inputs:e,backend:t}=n,{dy:i,y:r}=e;He([i,r],"eluGrad");const o=new Float32Array(he(r.shape)),s=t.data.get(r.dataId).values,a=t.data.get(i.dataId).values;for(let l=0;l<s.length;++l){const c=s[l];c>=0?o[l]=a[l]:o[l]=a[l]*(c+1)}return t.makeTensorInfo(r.shape,"float32",o)}const dQ={kernelName:Vx,backendName:"cpu",kernelFunc:uQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hQ=lb,fQ=cb,pQ=ub,mQ=db,gQ=hb,vQ=fb,xQ=Kt($u,n=>{const e=Math.sign(n),t=Math.abs(n),i=1/(1+hQ*t);return e*(1-((((vQ*i+gQ)*i+mQ)*i+pQ)*i+fQ)*i*Math.exp(-t*t))}),bQ={kernelName:$u,backendName:"cpu",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qh(n){const{inputs:e,backend:t,attrs:i}=n,{input:r}=e,{dim:o}=i,s=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(F(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),rn({inputs:{x:r},backend:t,attrs:{shape:a}})}const yQ={kernelName:Pf,backendName:"cpu",kernelFunc:qh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wQ=Rn((n,e)=>n/e),Zb=Hn(Su,wQ),Yg={kernelName:Su,backendName:"cpu",kernelFunc:Zb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n,e,t){const i=n.shape,r=i[0],o=i[1],s=t.data.get(n.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[r,o],u=he(c),d=pi("float32",u),f=pi("float32",u);for(let g=0;g<r;g++){const v=Ea({inputs:{x:a},backend:t,attrs:{begin:[g,0],size:[1,o]}}),x=Ea({inputs:{x:l},backend:t,attrs:{begin:[g,0],size:[1,o]}}),b=ji({inputs:{real:v,imag:x},backend:t}),{real:w,imag:y}=CQ(b,e,t),C=Ko(w,y);for(let $=0;$<o;$++){const I=pb(C,$);d[g*o+$]=I.real,f[g*o+$]=I.imag}t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(b)}const h=t.makeTensorInfo(c,"float32",d),p=t.makeTensorInfo(c,"float32",f),m=ji({inputs:{real:h,imag:p},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),m}function CQ(n,e,t){const i=he(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,s=t.data.get(r.complexTensorInfos.imag.dataId).values;if(SQ(i)){const a=Jg(o,s,i,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",a.real),u=t.makeTensorInfo(l,"float32",a.imag),d=t.makeTensorInfo([],"float32",Ds(i,"float32")),f=ko({inputs:{x:d},backend:t}),h=Yg.kernelFunc({inputs:{a:c,b:d},backend:t}),p=Yg.kernelFunc({inputs:{a:u,b:f},backend:t}),m=t.data.get(h.dataId).values,g=t.data.get(p.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=Ko(o,s),l=IQ(a,i,e);return gN(l)}}function SQ(n){return(n&n-1)===0}function Jg(n,e,t,i,r){if(t===1)return{real:n,imag:e};const o=Ko(n,e),s=t/2,a=vN(o),l=a.real,c=a.imag,u=[l.length],d=r.makeTensorInfo(u,"float32",l),f=r.makeTensorInfo(u,"float32",c),h=ji({inputs:{real:d,imag:f},backend:r}),p=xN(o),m=p.real,g=p.imag,v=[m.length],x=r.makeTensorInfo(v,"float32",m),b=r.makeTensorInfo(v,"float32",g),w=ji({inputs:{real:x,imag:b},backend:r}),y=Jg(l,c,s,i,r),C=y.real,$=y.imag,I=[C.length],E=r.makeTensorInfo(I,"float32",C),N=r.makeTensorInfo(I,"float32",$),k=ji({inputs:{real:E,imag:N},backend:r}),D=Jg(m,g,s,i,r),_=D.real,R=D.imag,T=[_.length],A=r.makeTensorInfo(T,"float32",_),O=r.makeTensorInfo(T,"float32",R),P=ji({inputs:{real:A,imag:O},backend:r}),M=yN(t,i),z=[M.real.length],L=r.makeTensorInfo(z,"float32",M.real),W=r.makeTensorInfo(z,"float32",M.imag),U=ji({inputs:{real:L,imag:W},backend:r}),V=Gp({inputs:{a:U,b:P},backend:r}),H=Ml({inputs:{a:k,b:V},backend:r}),Y=Yb({inputs:{a:k,b:V},backend:r}),Q=$a({inputs:{input:H},backend:r}),Z=$a({inputs:{input:Y},backend:r}),pe=Fl({inputs:{input:H},backend:r}),oe=Fl({inputs:{input:Y},backend:r}),X=Ll({inputs:[Q,Z],backend:r,attrs:{axis:0}}),j=Ll({inputs:[pe,oe],backend:r,attrs:{axis:0}}),ne=r.data.get(X.dataId).values,se=r.data.get(j.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(j),{real:ne,imag:se}}function IQ(n,e,t){const i=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,s=0;for(let a=0;a<e;a++){const l=wN(r*a,e,t),c=pb(n,a);o+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}t&&(o/=e,s/=e),bN(i,o,s,r)}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(n){const{inputs:e,backend:t}=n,{input:i}=e,r=he(i.shape),o=i.shape[i.shape.length-1],s=r/o,a=rn({inputs:{x:i},backend:t,attrs:{shape:[s,o]}}),l=iR(a,!1,t),c=rn({inputs:{x:l},backend:t,attrs:{shape:i.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const EQ={kernelName:Wx,backendName:"cpu",kernelFunc:$Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qb(n){const{backend:e,attrs:t}=n,{shape:i,value:r,dtype:o}=t,s=o||Yl(r),a=Sn(s,he(i));return kQ(a,r,s),e.makeTensorInfo(i,s,a)}const NQ={kernelName:Gx,backendName:"cpu",kernelFunc:Qb};function kQ(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DQ={kernelName:Hx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:i}=n,r=t,o=pi(i.dtype,he(i.shape)),[s,a,l,c]=i.shape,u=r.data.get(i.dataId).values;for(let f=0;f<s;f++){const h=f*l*a*c;for(let p=0;p<a;p++){const m=p*(l*c);for(let g=0;g<l;g++){const v=g*c;for(let x=0;x<c;x++){const b=Math.round(l-g-1),w=h+m+v+x;let y=u[w];if(b>=0&&b<l){const C=b*c,$=h+m+C+x;y=u[$]}o[w]=y}}}}return{dataId:r.write(o,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o,bias:s,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=i;let m=tR({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f}});if(s){const g=m;if(u==="NCHW"&&s.shape.length===1&&s.shape[0]!==1){const v=rn({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});m=Ml({inputs:{a:m,b:v},backend:t}),t.disposeIntermediateTensorInfo(v)}else m=Ml({inputs:{a:m,b:s},backend:t});t.disposeIntermediateTensorInfo(g)}if(h){const g=m;if(u==="NCHW"&&h==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const v=rn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});m=Xh(t,m,h,v,p),t.disposeIntermediateTensorInfo(v)}else m=Xh(t,m,h,a,p);t.disposeIntermediateTensorInfo(g)}return m}const RQ={kernelName:Eh,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o,bias:s,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=i;let m=nR({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f}});if(s){const g=m;m=Ml({inputs:{a:m,b:s},backend:t}),t.disposeIntermediateTensorInfo(g)}if(h){const g=m;m=Xh(t,m,h,a,p),t.disposeIntermediateTensorInfo(g)}return m}const AQ={kernelName:BE,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(n){const{inputs:e,backend:t}=n,{params:i,indices:r}=e,o=he(i.shape),s=r.shape,a=s[s.length-1],[l,c,u,d]=J0(i,r);if(c===0)return t.makeTensorInfo(l,i.dtype,[]);const f=t.data.get(r.dataId).values,h=t.bufferSync(i),p=fT(f,h,i.dtype,c,a,u,d,i.shape,o);return t.makeTensorInfo(l,i.dtype,p.values)}const PQ={kernelName:CE,backendName:"cpu",kernelFunc:OQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,indices:o}=e,{axis:s,batchDims:a}=i;He([r,o],"gatherV2");const l=Ct(s,r.shape)[0],c=t.data.get(o.dataId).values,u=r.shape[l];for(let w=0;w<c.length;++w){const y=c[w];F(y<=u-1&&y>=0,()=>`GatherV2: the index value ${y} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const f=he(o.shape),h=wb(r,o,l,d),p=rn({inputs:{x:r},backend:t,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),m=rn({inputs:{x:o},backend:t,attrs:{shape:[h.batchSize,f/h.batchSize]}}),g=[h.batchSize,h.outerSize,f/h.batchSize,h.sliceSize],v=t.bufferSync(m),x=t.bufferSync(p),b=pT(x,v,g);return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.makeTensorInfo(h.outputShape,b.dtype,b.values)}const FQ={kernelName:Ff,backendName:"cpu",kernelFunc:MQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LQ(n){const{inputs:e,backend:t}=n,{input:i}=e,r=he(i.shape),o=i.shape[i.shape.length-1],s=r/o,a=rn({inputs:{x:i},backend:t,attrs:{shape:[s,o]}}),l=iR(a,!0,t),c=rn({inputs:{x:l},backend:t,attrs:{shape:i.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const zQ={kernelName:Ux,backendName:"cpu",kernelFunc:LQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ=Kt(_u,n=>Number.isFinite(n)?1:0,"bool"),VQ={kernelName:_u,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WQ=Kt(Au,n=>Math.abs(n)===1/0?1:0,"bool"),GQ={kernelName:Au,backendName:"cpu",kernelFunc:WQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HQ=Kt(Ou,n=>Number.isNaN(n)?1:0,"bool"),UQ={kernelName:Ou,backendName:"cpu",kernelFunc:HQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jQ(n){const{backend:e,attrs:t}=n,{start:i,stop:r,num:o}=t,s=bT(i,r,o);return e.makeTensorInfo([s.length],"float32",s)}const KQ={kernelName:SE,backendName:"cpu",kernelFunc:jQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XQ=Kt(Mu,n=>Math.log1p(n)),qQ={kernelName:Mu,backendName:"cpu",kernelFunc:XQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YQ=Rn((n,e)=>n&&e),JQ=Hn(Wf,YQ,null,"bool"),ZQ={kernelName:Wf,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QQ=Kt(Gf,n=>n?0:1,"bool"),eee={kernelName:Gf,backendName:"cpu",kernelFunc:QQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tee=Rn((n,e)=>n||e),nee=Hn(Hf,tee,null,"bool"),iee={kernelName:Hf,backendName:"cpu",kernelFunc:nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ree(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{depthRadius:o,bias:s,alpha:a,beta:l}=i;He(r,"LRN");const c=r.shape[3],u=c-1,d=t.data.get(r.dataId).values,f=he(r.shape),h=new Float32Array(f);function p(m){const g=m%c;let v=m-g+Math.max(0,g-o);const x=m-g+Math.min(g+o,u);let b=0;for(;v<=x;v++){const w=d[v];b+=w*w}return b}for(let m=0;m<f;m++){const g=p(m),v=d[m]*Math.pow(s+a*g,-l);h[m]=v}return t.makeTensorInfo(r.shape,r.dtype,h)}const oee={kernelName:Uf,backendName:"cpu",kernelFunc:ree};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function see(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,y:o,dy:s}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=i;He(s,"LRNGrad");const d=he(s.shape),f=s.shape[3],h=t.data.get(s.dataId).values,p=t.data.get(r.dataId).values,m=t.data.get(o.dataId).values,g=new Float32Array(d),v=d;for(let x=0;x<v;x++){const b=x%f,w=x-b+Math.max(0,b-a),y=x-b+Math.min(f,b+a+1);let C=0;for(let $=w;$<y;$++)C+=Math.pow(p[$],2);C=c*C+l;for(let $=w;$<y;$++){let I=-2*c*u*p[$]*m[x]/C;x===$&&(I+=Math.pow(C,-u)),I*=h[x],g[$]+=I}}return t.makeTensorInfo(s.shape,r.dtype,g)}const aee={kernelName:Kx,backendName:"cpu",kernelFunc:see};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{reductionIndices:o,keepDims:s}=i,a=t;let l=r.shape;const c=l.length,u=Ct(o,l);let d=u;const f=xn(d,c);let h=a.data.get(r.dataId).values;if(f!=null){const w=new Array(c);for(let y=0;y<w.length;y++)w[y]=l[f[y]];h=Xb(h,l,r.dtype,f,w),d=Dn(d.length,c),l=w}He(r,"max"),ii("max",d,c);const[p,m]=Zn(l,d),g=he(m),v=wT(h,g,p,r.dtype),x=a.write(v,p,r.dtype);let b=p;return s&&(b=Pn(p,u)),{dataId:x,shape:b,dtype:r.dtype}}const lee={kernelName:jf,backendName:"cpu",kernelFunc:rR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cee(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e;He(r,"maxPool");const{filterSize:o,strides:s,pad:a,dimRoundingMode:l}=i,c=1;F(vi(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=_r(r.shape,o,s,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Ht(u.inShape,u.outShape))d=ko({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,h=Qe(r.shape),p=Jb(f,r.shape,r.dtype,h,u,"max");d=t.makeTensorInfo(u.outShape,r.dtype,p.values)}return d}const uee={kernelName:Kf,backendName:"cpu",kernelFunc:cee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dee(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{filterSize:o,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=i;He(r,"maxPool3d");const u=Qo(r.shape,o,s,1,a,l,c),d=t.data.get(r.dataId).values,f=eR(d,r.shape,r.dtype,Qe(r.shape),u,"max");return t.makeTensorInfo(f.shape,"float32",f.values)}const hee={kernelName:Xf,backendName:"cpu",kernelFunc:dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o}=e,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=i;He([r,o],"maxPool3DGrad");const u=Qo(o.shape,s,a,1,l,c),d=t.bufferSync(o),f=tZ(d,u),h=u.strideDepth,p=u.strideHeight,m=u.strideWidth,g=u.dilationDepth,v=u.dilationHeight,x=u.dilationWidth,b=u.effectiveFilterDepth,w=u.effectiveFilterHeight,y=u.effectiveFilterWidth,C=b-1-u.padInfo.front,$=y-1-u.padInfo.left,I=w-1-u.padInfo.top,E=wt(o.shape,"float32"),N=t.bufferSync(r);for(let k=0;k<u.batchSize;++k)for(let D=0;D<u.inChannels;++D)for(let _=0;_<u.inDepth;++_)for(let R=0;R<u.inHeight;++R)for(let T=0;T<u.inWidth;++T){const A=_-C,O=R-I,P=T-$;let M=0;for(let z=0;z<b;z+=g){const L=(A+z)/h;if(!(L<0||L>=u.outDepth||Math.floor(L)!==L))for(let W=0;W<w;W+=v){const U=(O+W)/p;if(!(U<0||U>=u.outHeight||Math.floor(U)!==U))for(let V=0;V<y;V+=x){const H=(P+V)/m;if(H<0||H>=u.outWidth||Math.floor(H)!==H)continue;const Y=b*w*y-1-f.get(k,L,U,H,D),Q=z*w*y+W*y+V,Z=Y===Q?1:0;if(Z===0)continue;const pe=N.get(k,L,U,H,D);M+=pe*Z}}}E.set(M,k,_,R,T,D)}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const pee={kernelName:qx,backendName:"cpu",kernelFunc:fee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mee(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o,output:s}=e,a=o;He([o,s],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=i,f=_r(a.shape,l,c,1,u,d),h=t.data.get(a.dataId).values,p=wt(f.outShape,a.dtype,QT(h,a.shape,a.dtype,f).values),m=f.strideHeight,g=f.strideWidth,v=f.dilationHeight,x=f.dilationWidth,b=f.effectiveFilterHeight,w=f.effectiveFilterWidth,y=w-1-f.padInfo.left,C=b-1-f.padInfo.top,$=wt(a.shape,"float32"),I=t.data.get(r.dataId).values,E=wt(r.shape,"float32",I);for(let N=0;N<f.batchSize;++N)for(let k=0;k<f.inChannels;++k)for(let D=0;D<f.inHeight;++D)for(let _=0;_<f.inWidth;++_){const R=D-C,T=_-y;let A=0;for(let O=0;O<b;O+=v){const P=(R+O)/m;if(!(P<0||P>=f.outHeight||Math.floor(P)!==P))for(let M=0;M<w;M+=x){const z=(T+M)/g;if(z<0||z>=f.outWidth||Math.floor(z)!==z)continue;const L=b*w-1-p.get(N,P,z,k),W=O*w+M,U=L===W?1:0;if(U===0)continue;const V=E.get(N,P,z,k);A+=V*U}}$.set(A,N,D,_,k)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const gee={kernelName:Xx,backendName:"cpu",kernelFunc:mee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vee(n,e,t,i,r){const o=Qe(e),s=Jb(n,e,t,o,r,"max"),a=QT(n,e,t,r,!0,i);return[s.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xee={kernelName:IE,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:i}=n,{filterSize:r,strides:o,pad:s,includeBatchInIndex:a}=e,l=t;He(i,"MaxPoolWithArgmax");const c=l.data.get(i.dataId).values,u=_r(i.shape,r,o,[1,1],s),[d,f]=vee(c,i.shape,i.dtype,a,u),h=l.write(d,u.outShape,i.dtype),p=l.write(f,u.outShape,i.dtype);return[{dataId:h,shape:u.outShape,dtype:i.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i,a=Ct(o,r.shape),c=Zn(r.shape,a)[1],u=he(c),d=[],f=t.makeTensorInfo([],"float32",new Float32Array([u]));d.push(f);const h=Es({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});d.push(h);const p=Zb({inputs:{a:h,b:f},backend:t});d.push(p);const m=Cd({inputs:{x:p},backend:t,attrs:{axis:o,keepDims:s}});return d.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const yee={kernelName:qf,backendName:"cpu",kernelFunc:bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wee(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i;He(r,"min");const a=Ct(o,r.shape);let l=a;const c=xn(l,r.shape.length);let u=r;c!=null&&(u=zi({inputs:{x:r},backend:t,attrs:{perm:c}}),l=Dn(l.length,r.shape.length)),ii("min",l,u.shape.length);const[d,f]=Zn(u.shape,l),h=he(f),p=mi(he(d),u.dtype),m=t.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const x=v*h;let b=m[x];for(let w=0;w<h;++w){const y=m[x+w];(Number.isNaN(y)||y<b)&&(b=y)}p[v]=b}c!=null&&t.disposeIntermediateTensorInfo(u);const g=t.makeTensorInfo(d,u.dtype,p);if(s){const v=Pn(d,a),x=rn({inputs:{x:g},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(g),x}return g}const Cee={kernelName:Yf,backendName:"cpu",kernelFunc:wee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function See(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{paddings:o,mode:s}=i;He(r,"mirrorPad");const a=o.map((b,w)=>b[0]+r.shape[w]+b[1]),l=o.map(b=>b[0]),c=o.map((b,w)=>b[0]+r.shape[w]),u=s==="reflect"?0:1,d=t.data.get(r.dataId).values,f=r.shape.length,h=Qe(r.shape),p=he(a),m=a.length,g=Qe(a),v=pi(r.dtype,p);for(let b=0;b<p;b++){let w=Jl(b,m,g);for(let C=0;C<m;C++)w[C]<l[C]?w[C]=l[C]*2-w[C]-u:w[C]>=c[C]&&(w[C]=(c[C]-1)*2-w[C]+u);w=w.map((C,$)=>C-l[$]);const y=go(w,f,h);v[b]=d[y]}return{dataId:t.write(v,a,r.dtype),shape:a,dtype:r.dtype}}const Iee={kernelName:Jf,backendName:"cpu",kernelFunc:See};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ee=Rn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),Eee=Hn(zu,$ee),Nee={kernelName:zu,backendName:"cpu",kernelFunc:Eee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(n){const{inputs:e,backend:t,attrs:i}=n,{logits:r}=e,{dim:o}=i,s=r.shape.length;let a=o;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);const l=Ct([a],r.shape),c=rR({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),u=Pn(c.shape,l),d=rn({inputs:{x:c},backend:t,attrs:{shape:u}}),f=Yb({inputs:{a:r,b:d},backend:t}),h=cT({inputs:{x:f},backend:t}),p=Cd({inputs:{x:h},backend:t,attrs:{axis:l,keepDims:!1}}),m=rn({inputs:{x:p},backend:t,attrs:{shape:u}}),g=Zb({inputs:{a:h,b:m},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}const kee={kernelName:mp,backendName:"cpu",kernelFunc:oR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dee(n){const{inputs:e,backend:t,attrs:i}=n,{logits:r}=e,{numSamples:o,seed:s,normalized:a}=i;He(r,"multinomial");const l=a?r:oR({inputs:{logits:r},backend:t,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=t.data.get(l.dataId).values,f=[c,o],h=mi(he(f),"int32");for(let p=0;p<c;++p){const m=p*u,g=new Float32Array(u-1);g[0]=d[m];for(let b=1;b<g.length;++b)g[b]=g[b-1]+d[m+b];const v=M0.alea(s.toString()),x=p*o;for(let b=0;b<o;++b){const w=v();h[x+b]=g.length;for(let y=0;y<g.length;y++)if(w<g[y]){h[x+b]=y;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(f,"int32",h)}const Tee={kernelName:$E,backendName:"cpu",kernelFunc:Dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ree=U0;function _ee(n){const{inputs:e,backend:t,attrs:i}=n,{boxes:r,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=i;He(r,"NonMaxSuppression");const c=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,{selectedIndices:d}=Ree(c,u,s,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Aee={kernelName:Yx,backendName:"cpu",kernelFunc:_ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oee=j0;function Pee(n){const{inputs:e,backend:t,attrs:i}=n,{boxes:r,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=i;He(r,"NonMaxSuppressionPadded");const u=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:f,validOutputs:h}=Oee(u,d,s,a,l,c);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([h]))]}const Mee={kernelName:Jx,backendName:"cpu",kernelFunc:Pee};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fee=K0;function Lee(n){const{inputs:e,backend:t,attrs:i}=n,{boxes:r,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=i;He(r,"NonMaxSuppressionWithScore");const u=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,f=s,h=a,p=l,m=c,{selectedIndices:g,selectedScores:v}=Fee(u,d,f,h,p,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const zee={kernelName:Zx,backendName:"cpu",kernelFunc:Lee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bee(n){const{inputs:e,backend:t,attrs:i}=n,{indices:r}=e,{dtype:o,depth:s,onValue:a,offValue:l}=i;He(r,"oneHot");const c=he(r.shape),u=new Float32Array(c*s);u.fill(l);const d=t.data.get(r.dataId).values;for(let f=0;f<c;++f)d[f]>=0&&d[f]<s&&(u[f*s+d[f]]=a);return t.makeTensorInfo([...r.shape,s],o,u)}const Vee={kernelName:tp,backendName:"cpu",kernelFunc:Bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yh(n){const{inputs:e,backend:t}=n,{x:i}=e;if(i.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(i.dtype==="complex64"){const r=$a({inputs:{input:i},backend:t}),o=Yh({inputs:{x:r},backend:t}),s=Fl({inputs:{input:i},backend:t}),a=Yh({inputs:{x:s},backend:t}),l=ji({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),l}else return Qb({backend:t,attrs:{shape:i.shape,value:0,dtype:i.dtype}})}const Wee={kernelName:xp,backendName:"cpu",kernelFunc:Yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR(n){const{inputs:e,backend:t}=n,{x:i}=e;if(i.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(i.dtype==="complex64"){const r=$a({inputs:{input:i},backend:t}),o=sR({inputs:{x:r},backend:t}),s=Fl({inputs:{input:i},backend:t}),a=Yh({inputs:{x:s},backend:t}),l=ji({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),l}else return Qb({backend:t,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}const Gee={kernelName:ep,backendName:"cpu",kernelFunc:sR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n){const{inputs:e,backend:t,attrs:i}=n,{axis:r}=i;if(e.length===1)return qh({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,s=e[0].dtype;e.forEach(u=>{bx(o,u.shape,"All tensors passed to stack must have matching shapes"),F(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=qh({inputs:{input:u},backend:t,attrs:{dim:r}});return a.push(d),d}),c=Ll({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const Hee={kernelName:np,backendName:"cpu",kernelFunc:aR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{paddings:o,constantValue:s}=i;He(r,"pad");const a=o.map((x,b)=>x[0]+r.shape[b]+x[1]),l=o.map(x=>x[0]),c=t.data.get(r.dataId).values,u=he(r.shape),d=r.shape.length,f=Qe(r.shape),h=he(a),p=a.length,m=Qe(a),g=pi(r.dtype,h);s!==0&&g.fill(s);for(let x=0;x<u;x++){const w=Jl(x,d,f).map((C,$)=>C+l[$]),y=go(w,p,m);g[y]=c[x]}return{dataId:t.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const lR={kernelName:ip,backendName:"cpu",kernelFunc:Uee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jee=Rn((n,e)=>Math.pow(n,e)),Kee=Hn(Vu,jee),Xee={kernelName:Vu,backendName:"cpu",kernelFunc:Kee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qee(n){const{inputs:e,backend:t,attrs:i}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:s}=e,a=r.map(g=>t.data.get(g.dataId).values),l=r.map(g=>g.shape),c=t.data.get(o.dataId).values,u=t.data.get(s.dataId).values,[d,f,h]=NT(a,l,c,o.shape,o.dtype,u,s.shape),p=d.map(g=>t.makeTensorInfo([g.length],"int32",g)),m=t.makeTensorInfo(h,o.dtype,f);return p.concat([m])}const Yee={kernelName:EE,backendName:"cpu",kernelFunc:qee};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jee(n){const{inputs:e,backend:t}=n,{starts:i,limits:r,deltas:o}=e,s=t.data.get(i.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[c,u]=kT(s,i.shape,i.dtype,a,r.shape,l,o.shape),d=t.makeTensorInfo([c.length],"int32",c),f=t.makeTensorInfo([u.length],i.dtype,u);return[d,f]}const Zee={kernelName:NE,backendName:"cpu",kernelFunc:Jee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qee(n){const{inputs:e,backend:t,attrs:i}=n,{shape:r,values:o,defaultValue:s,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=i,c=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=t.data.get(s.dataId).values,f=a.map(g=>t.data.get(g.dataId).values),h=a.map(g=>g.shape),[p,m]=DT(c,r.shape,u,o.shape,o.dtype,d,s.shape,f,h,l);return t.makeTensorInfo(p,o.dtype,m)}const ete={kernelName:kE,backendName:"cpu",kernelFunc:Qee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tte(n){const{backend:e,attrs:t}=n,{start:i,stop:r,dtype:o,step:s}=t,a=TT(i,r,s,o);return e.makeTensorInfo([a.length],o,a)}const nte={kernelName:Qx,backendName:"cpu",kernelFunc:tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ite=Kt(Wu,n=>1/n),rte={kernelName:Wu,backendName:"cpu",kernelFunc:ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ote(n){const{inputs:e,backend:t,attrs:i}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:s,size:a}=i;He(r,"resizeBilinear");const l=Qe(r.shape),[c,u]=a,[d,f,h,p]=r.shape,m=t.data.get(r.dataId).values,g=new Float32Array(he([d,c,u,p])),v=[o&&c>1?f-1:f,o&&u>1?h-1:h],x=[o&&c>1?c-1:c,o&&u>1?u-1:u];let b=0;const w=v[0]/x[0],y=v[1]/x[1];for(let C=0;C<d;C++)for(let $=0;$<c;$++){let I;s?I=w*($+.5)-.5:I=w*$;const E=Math.max(0,Math.floor(I)),N=I-E,k=Math.min(f-1,Math.ceil(I)),D=C*l[0]+E*l[1],_=C*l[0]+k*l[1];for(let R=0;R<u;R++){let T;s?T=y*(R+.5)-.5:T=y*R;const A=Math.max(0,Math.floor(T)),O=T-A,P=Math.min(h-1,Math.ceil(T)),M=D+A*l[2],z=_+A*l[2],L=D+P*l[2],W=_+P*l[2];for(let U=0;U<p;U++){const V=m[M+U],H=m[z+U],Y=m[L+U],Q=m[W+U],Z=V+(Y-V)*O,pe=H+(Q-H)*O,oe=Z+(pe-Z)*N;g[b++]=oe}}}return t.makeTensorInfo([d,c,u,p],"float32",g)}const ste={kernelName:lp,backendName:"cpu",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ate(n){const{inputs:e,backend:t,attrs:i}=n,{images:r,dy:o}=e,{alignCorners:s}=i;He([o,r],"resizeBilinearGrad");const a=Qe(r.shape),[l,c,u,d]=r.shape,[,f,h]=o.shape,p=new Float32Array(l*c*u*d),m=[s&&f>1?c-1:c,s&&h>1?u-1:u],g=[s&&f>1?f-1:f,s&&h>1?h-1:h],v=m[0]/g[0],x=m[1]/g[1],b=t.data.get(o.dataId).values;let w=0;for(let y=0;y<l;y++){const C=y*a[0];for(let $=0;$<f;$++){const I=$*v,E=Math.floor(I),N=Math.min(Math.ceil(I),c-1),k=C+E*a[1],D=C+N*a[1],_=I-E,R=1-_;for(let T=0;T<h;T++){const A=T*x,O=Math.floor(A),P=Math.min(Math.ceil(A),u-1),M=A-O,z=1-M,L=k+O*a[2],W=k+P*a[2],U=D+O*a[2],V=D+P*a[2],H=R*z,Y=R*M,Q=_*z,Z=_*M;for(let pe=0;pe<d;pe++){const oe=b[w++];p[L+pe]+=oe*H,p[W+pe]+=oe*Y,p[U+pe]+=oe*Q,p[V+pe]+=oe*Z}}}}return t.makeTensorInfo([l,u,c,d],"float32",p)}const lte={kernelName:n0,backendName:"cpu",kernelFunc:ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cte(n){const{inputs:e,backend:t,attrs:i}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:s,size:a}=i;He(r,"resizeNearestNeighbor");const l=Qe(r.shape),[c,u]=a,[d,f,h,p]=r.shape,m=t.data.get(r.dataId).values,g=new Float32Array(d*c*u*p),v=[o&&c>1?f-1:f,o&&u>1?h-1:h],x=[o&&c>1?c-1:c,o&&u>1?u-1:u],b=v[0]/x[0],w=v[1]/x[1];let y=0;for(let C=0;C<d;C++){const $=C*l[0];for(let I=0;I<c;I++){const E=s?b*(I+.5):b*I;let N=Math.min(f-1,o?Math.round(E):Math.floor(E));s&&(N=Math.max(0,N));const k=$+N*l[1];for(let D=0;D<u;D++){const _=s?w*(D+.5):w*D;let R=Math.min(h-1,o?Math.round(_):Math.floor(_));s&&(R=Math.max(0,R));const T=k+R*l[2];for(let A=0;A<p;A++){const O=m[T+A];g[y++]=O}}}}return t.makeTensorInfo([d,c,u,p],r.dtype,g)}const ute={kernelName:ap,backendName:"cpu",kernelFunc:cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dte(n){const{inputs:e,backend:t,attrs:i}=n,{images:r,dy:o}=e,{alignCorners:s}=i;He([o,r],"resizeNearestNeighborGrad");const a=Qe(r.shape),l=Qe(o.shape),[c,u,d,f]=r.shape,[,h,p]=o.shape,m=new Float32Array(c*u*d*f),g=t.data.get(o.dataId).values,v=[s&&h>1?u-1:u,s&&p>1?d-1:d],x=[s&&h>1?h-1:h,s&&p>1?p-1:p],b=v[0]/x[0],w=v[1]/x[1],y=1/b,C=1/w,$=Math.ceil(y)*2+2,I=Math.ceil(C)*2+2;for(let E=0;E<c;E++){const N=E*a[0];for(let k=0;k<u;k++){const D=N+k*a[1],_=Math.floor(k*y),R=Math.floor(_-$/2);for(let T=0;T<d;T++){const A=D+T*a[2],O=Math.floor(T*C),P=Math.floor(O-I/2);for(let M=0;M<f;M++){let z=0;for(let L=0;L<$;L++){const W=L+R;if(W<0||W>=h)continue;const U=N+W*l[1],V=W*b,H=Math.min(u-1,s?Math.round(V):Math.floor(V));if(k===H)for(let Y=0;Y<I;Y++){const Q=Y+P;if(Q<0||Q>=p)continue;const Z=U+Q*l[2],pe=Q*w,oe=Math.min(d-1,s?Math.round(pe):Math.floor(pe));T===oe&&(z+=g[Z+M])}}m[A+M]=z}}}}return t.makeTensorInfo(r.shape,r.dtype,m)}const hte={kernelName:t0,backendName:"cpu",kernelFunc:dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fte(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{dims:o}=i;He(r,"reverse");const s=r.shape.length,a=Ct(o,r.shape);if(s===0)return ko({inputs:{x:r},backend:t});const l=new ti(r.shape,r.dtype),c=t.bufferSync(r);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),f=d.slice();a.forEach(h=>f[h]=r.shape[h]-1-f[h]),l.set(c.get(...f),...d)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const pte={kernelName:cp,backendName:"cpu",kernelFunc:fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte={kernelName:c0,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:i}=n,{radians:r,fillValue:o,center:s}=e,a=t,l=pi(i.dtype,he(i.shape)),[c,u,d,f]=i.shape,[h,p]=ob(s,u,d),m=255,g=Math.sin(r),v=Math.cos(r),x=a.data.get(i.dataId).values;for(let w=0;w<c;w++){const y=w*d*u*f;for(let C=0;C<u;C++){const $=C*(d*f);for(let I=0;I<d;I++){const E=I*f;for(let N=0;N<f;N++){const k=[c,C,I,N],D=k[2],_=k[1];let R=(D-h)*v-(_-p)*g,T=(D-h)*g+(_-p)*v;R=Math.round(R+h),T=Math.round(T+p);let A=o;if(typeof o!="number"&&(N===3?A=m:A=o[N]),R>=0&&R<d&&T>=0&&T<u){const P=T*(d*f),M=R*f,z=y+P+M+N;A=x[z]}const O=y+$+E+N;l[O]=A}}}}return{dataId:a.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gte=Kt(Uu,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),vte={kernelName:Uu,backendName:"cpu",kernelFunc:gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(n){const{inputs:e,backend:t,attrs:i}=n,{indices:r,updates:o}=e,{shape:s}=i,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Fa(o,r,s),f=!0,h=t.bufferSync(r),p=t.bufferSync(o),m=ta(h,p,s,d,c,l,a,u,0,f);return t.makeTensorInfo(s,m.dtype,m.values)}const bte={kernelName:DE,backendName:"cpu",kernelFunc:xte};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yte(n,e){let t=0,i=n.length,r=0;for(;t<i;)r=Math.floor((t+i)/2),n[r]<e?t=r+1:i=r;return i}function wte(n,e){let t=0,i=n.length,r=0;for(;t<i;)r=Math.floor((t+i)/2),n[r]<=e?t=r+1:i=r;return i}function Cte(n,e,t,i,r,o){const s=Sn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*i,(a+1)*i),c=a*r;for(let u=0;u<r;++u)s[c+u]=o==="left"?yte(l,e[u+c]):wte(l,e[u+c])}return s}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ste(n){const{inputs:e,backend:t,attrs:i}=n,{sortedSequence:r,values:o}=e,{side:s}=i,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,c=Cte(a,l,r.shape[0],r.shape[1],o.shape[1],s);return t.makeTensorInfo(o.shape,"int32",c)}const Ite={kernelName:RE,backendName:"cpu",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $te(n){const{inputs:e,backend:t}=n,{condition:i,t:r,e:o}=e;He([i,r,o],"select");const s=i.shape.length,a=t.data.get(i.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,u=Zi(r.dtype,o.dtype),d=mi(he(r.shape),u);let f=0;const h=s===0||s>1||r.shape.length===1?1:he(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<h;m++)a[p]===1?d[f++]=l[p]:d[f++]=c[p];return t.makeTensorInfo(r.shape,u,d)}const Ete={kernelName:up,backendName:"cpu",kernelFunc:$te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte=Tp,kte=Rp,Dte=Kt(Ku,n=>n>=0?kte*n:Nte*(Math.exp(n)-1)),Tte={kernelName:Ku,backendName:"cpu",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=Kt(Yu,n=>n<0?-1:n>0?1:0),_te={kernelName:Yu,backendName:"cpu",kernelFunc:Rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ate=Kt(Xu,n=>Math.sin(n)),Ote={kernelName:Xu,backendName:"cpu",kernelFunc:Ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte=Kt(qu,n=>Math.sinh(n)),Mte={kernelName:qu,backendName:"cpu",kernelFunc:Pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fte=11920928955078125e-23,SS=Math.log(Fte)+2,Lte=Kt(Zu,n=>{const e=n>-SS,t=n<SS,i=Math.exp(n);let r;return t?r=i:e?r=n:r=Math.log(1+i),r}),zte={kernelName:Zu,backendName:"cpu",kernelFunc:Lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bte(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{blockShape:o,paddings:s}=i;He([r],"spaceToBatchND");const a=he(o),l=[[0,0]];l.push(...s);for(let C=1+o.length;C<r.shape.length;++C)l.push([0,0]);const c=lR.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),u=dd(c.shape,o,a,!1),d=hd(u.length,o.length,!1),f=fd(c.shape,o,a,!1),m=rn({inputs:{x:c},backend:t,attrs:{shape:u}}),x=zi({inputs:{x:m},backend:t,attrs:{perm:d}}),y=rn({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(x),y}const Vte={kernelName:fp,backendName:"cpu",kernelFunc:Bte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wte(n){const{inputs:e,backend:t}=n,{indices:i,values:r,denseShape:o,defaultValue:s}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${i.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,u=t.data.get(s.dataId).values[0],[d,f,h,p,m]=OT(a,i.shape,i.dtype,l,r.dtype,c,u);return[t.makeTensorInfo(f,i.dtype,d),t.makeTensorInfo([f[0]],r.dtype,h),t.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),t.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}const Gte={kernelName:_E,backendName:"cpu",kernelFunc:Wte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(n){const{inputs:e,backend:t}=n,{inputIndices:i,inputShape:r,newShape:o}=e;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${i.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const s=Array.from(t.data.get(r.dataId).values),a=t.data.get(i.dataId).values,l=Array.from(t.data.get(o.dataId).values),[c,u,d]=PT(a,i.shape,i.dtype,s,l);return[t.makeTensorInfo(u,i.dtype,c),t.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const Ute={kernelName:AE,backendName:"cpu",kernelFunc:Hte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jte(n){const{inputs:e,backend:t}=n,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const s=t.data.get(i.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[c,u]=qb(s,i.shape,i.dtype,a,l,!0);return t.makeTensorInfo(u,i.dtype,c)}const Kte={kernelName:OE,backendName:"cpu",kernelFunc:jte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xte(n){const{inputs:e,backend:t}=n,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const s=t.data.get(i.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[c,u]=qb(s,i.shape,i.dtype,a,l);return t.makeTensorInfo(u,i.dtype,c)}const qte={kernelName:PE,backendName:"cpu",kernelFunc:Xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(n){const{inputs:e,backend:t,attrs:i}=n,{sparseIndices:r,sparseValues:o,defaultValue:s}=e,{outputShape:a}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:f}=Fa(o,r,a),h=!1,p=t.bufferSync(r);let m;switch(o.dtype){case"bool":{const g=t.bufferSync(o),v=!!t.data.get(s.dataId).values[0];m=ta(p,g,a,f,u,c,l,d,v,h);break}case"float32":{const g=t.bufferSync(o),v=t.data.get(s.dataId).values[0];m=ta(p,g,a,f,u,c,l,d,v,h);break}case"int32":{const g=t.bufferSync(o),v=t.data.get(s.dataId).values[0];m=ta(p,g,a,f,u,c,l,d,v,h);break}case"string":{const g=t.bufferSync(o),v=ws(t.data.get(s.dataId).values[0]);m=ta(p,g,a,f,u,c,l,d,v,h);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,m.dtype,m.values)}const Jte={kernelName:ME,backendName:"cpu",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zte(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{numOrSizeSplits:o,axis:s}=i,a=Ct(s,r.shape)[0],l=yb(r,o,a),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(d=>{const f=[...u];f[a]=d;const h=Ea({inputs:{x:r},backend:t,attrs:{begin:c,size:f}});return c[a]+=d,h})}const Qte={kernelName:pp,backendName:"cpu",kernelFunc:Zte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ene={kernelName:i0,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,i=e;He(t,"square");const r=i.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:i.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tne=Kt(od,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),nne={kernelName:od,backendName:"cpu",kernelFunc:tne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ine(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{begin:o,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:f}=i;He(r,"stridedSlice");const{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:x,end:b,strides:w}=nb(r.shape,o,s,a,l,c,u,d,f);let y;if(m)y=rn({inputs:{x:r},backend:t,attrs:{shape:p}});else if(g||v){F(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=Q0(x,b,w),$=Ea({inputs:{x:r},backend:t,attrs:{begin:x,size:C}});y=rn({inputs:{x:$},backend:t,attrs:{shape:p}}),t.disposeIntermediateTensorInfo($)}else{const C=t.bufferSync(r),$=LT(h,C,w,x);y=t.makeTensorInfo(p,$.dtype,$.values)}return y}const rne={kernelName:o0,backendName:"cpu",kernelFunc:ine};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(n){const{inputs:e,backend:t,attrs:i}=n,{separator:r,nGramWidths:o,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:d}=e,f=t.data.get(u.dataId).values,h=t.data.get(d.dataId).values,[p,m]=zT(f,h,r,o,s,a,l,c);return[t.makeTensorInfo([p.length],"string",p),t.makeTensorInfo(d.shape,"int32",m)]}const sne={kernelName:FE,backendName:"cpu",kernelFunc:one};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ane(n){const{inputs:e,backend:t,attrs:i}=n,{skipEmpty:r}=i,{input:o,delimiter:s}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const a=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values[0],[c,u,d]=BT(a,l,r),f=u.length;return[t.makeTensorInfo([f,2],"int32",c),t.makeTensorInfo([f],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const lne={kernelName:LE,backendName:"cpu",kernelFunc:ane};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(n){const{inputs:e,backend:t,attrs:i}=n,{numBuckets:r}=i,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const s=t.data.get(o.dataId).values,a=VT(s,r);return t.makeTensorInfo(o.shape,"int32",a)}const une={kernelName:zE,backendName:"cpu",kernelFunc:cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dne=Kt(nd,n=>Math.tan(n)),hne={kernelName:nd,backendName:"cpu",kernelFunc:dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fne=Kt(id,n=>Math.tanh(n)),pne={kernelName:id,backendName:"cpu",kernelFunc:fne};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(n){const{inputs:e,backend:t}=n,{tensor:i,indices:r,updates:o}=e,{sliceRank:s,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=Fa(o,r,i.shape),d=!1,f=t.bufferSync(r),h=t.bufferSync(o),p=t.bufferSync(i),m=ta(f,h,i.shape,u,l,a,s,c,p,d);return t.makeTensorInfo(i.shape,m.dtype,m.values)}const gne={kernelName:TE,backendName:"cpu",kernelFunc:mne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vne(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{reps:o}=i;He(r,"tile");const s=GT(t.bufferSync(r),o);return t.makeTensorInfo(s.shape,s.dtype,s.values)}const xne={kernelName:rd,backendName:"cpu",kernelFunc:vne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{k:o,sorted:s}=i;He(r,"topk");const a=t.data.get(r.dataId).values,[l,c]=UT(a,r.shape,r.dtype,o,s);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const yne={kernelName:s0,backendName:"cpu",kernelFunc:bne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wne(n){const{inputs:e,attrs:t,backend:i}=n,{image:r,transforms:o}=e,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=t,[u,d,f,h]=r.shape,[p,m]=c??[d,f],g=[u,p,m,h],v=Qe(r.shape),x=v[0],b=v[1],w=v[2],y=Qe(g),C=y[0],$=y[1],I=y[2],E=pi(r.dtype,he(g));E.fill(l);const N=i.data.get(r.dataId).values,k=i.data.get(o.dataId).values;for(let _=0;_<u;++_){const R=o.shape[0]===1?k:k.subarray(_*8,_*8+8);for(let T=0;T<p;++T)for(let A=0;A<m;++A)for(let O=0;O<h;++O){let P;const M=R[6]*A+R[7]*T+1;if(M===0)continue;const z=(R[0]*A+R[1]*T+R[2])/M,L=(R[3]*A+R[4]*T+R[5])/M,W=IS(z,f,a),U=IS(L,d,a);switch(s){case"nearest":P=Nne(N,d,f,x,b,w,_,U,W,O,l);break;case"bilinear":P=kne(N,d,f,x,b,w,_,U,W,O,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}const V=_*C+T*$+A*I+O;E[V]=P}return i.makeTensorInfo(g,r.dtype,E)}return{dataId:i.write(E,g,r.dtype),shape:r.shape,dtype:r.dtype}}const Cne={kernelName:a0,backendName:"cpu",kernelFunc:wne};function IS(n,e,t){switch(t){case"reflect":return Sne(n,e);case"wrap":return Ine(n,e);case"nearest":return Ene(n,e);case"constant":default:return $ne(n)}}function Sne(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const i=2*e;t<i&&(t=i*Math.trunc(-t/i)+t),t=t<-e?t+i:-t-1}else if(t>e-1)if(e<=1)t=0;else{const i=2*e;t-=i*Math.trunc(t/i),t>=e&&(t=i-t-1)}return fa(0,t,e-1)}function Ine(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const i=e-1;t+=e*(Math.trunc(-t/i)+1)}else if(t>e-1)if(e<=1)t=0;else{const i=e-1;t-=e*Math.trunc(t/i)}return fa(0,t,e-1)}function $ne(n,e){return n}function Ene(n,e){return fa(0,n,e-1)}function $c(n,e,t,i,r,o,s,a,l,c,u){const d=s*i+a*r+l*o+c;return 0<=a&&a<e&&0<=l&&l<t?n[d]:u}function Nne(n,e,t,i,r,o,s,a,l,c,u){const d=Math.round(a),f=Math.round(l);return $c(n,e,t,i,r,o,s,d,f,c,u)}function kne(n,e,t,i,r,o,s,a,l,c,u){const d=Math.floor(a),f=Math.floor(l),h=d+1,p=f+1,m=(p-l)*$c(n,e,t,i,r,o,s,d,f,c,u)+(l-f)*$c(n,e,t,i,r,o,s,d,p,c,u),g=(p-l)*$c(n,e,t,i,r,o,s,h,f,c,u)+(l-f)*$c(n,e,t,i,r,o,s,h,p,c,u);return(h-a)*m+(a-d)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dne(n){const{inputs:e,attrs:t,backend:i}=n,{axis:r}=t,{x:o}=e;He(o,"unique");const s=i.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:c}=jT(s,r,o.shape,o.dtype);return[i.makeTensorInfo(l,o.dtype,a),i.makeTensorInfo([c.length],"int32",c)]}const Tne={kernelName:l0,backendName:"cpu",kernelFunc:Dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(n){const{inputs:e,backend:t,attrs:i}=n,{value:r}=e;let{axis:o}=i;o<0&&(o+=r.shape.length);const s=r.shape.length,a=r.shape[o],l=new Array(s-1);let c=0;for(let h=0;h<s;h++)h!==o&&(l[c++]=r.shape[h]);const u=new Array(s).fill(0),d=r.shape.slice();d[o]=1;const f=new Array(a);for(let h=0;h<f.length;h++){u[o]=h;const p=Ea({inputs:{x:r},backend:t,attrs:{begin:u,size:d}});f[h]=rn({inputs:{x:p},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(p)}return f}const _ne={kernelName:gp,backendName:"cpu",kernelFunc:Rne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ane(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,segmentIds:o}=e,{numSegments:s}=i;He(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,c=[],u=[],d=a-l;let f=o;for(let p=0;p<d;++p){const m=qh({inputs:{input:f},backend:t,attrs:{dim:p+1}});f=m,u.push(m)}for(let p=0;p<s;++p){const m=Ds(p,"int32"),g=t.makeTensorInfo([],"int32",m),v=aT({inputs:{a:g,b:f},backend:t}),x=Es({inputs:{x:v},backend:t,attrs:{dtype:"float32"}}),b=Gp({inputs:{a:x,b:r},backend:t}),w=Cd({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});c.push(w),u.push(g),u.push(v),u.push(x),u.push(b),u.push(w)}const h=aR({inputs:c,backend:t,attrs:{axis:0}});return u.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const One={kernelName:vp,backendName:"cpu",kernelFunc:Ane};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pne=[DJ,cY,RJ,AJ,mY,PJ,FJ,zJ,VJ,GJ,UJ,KJ,qJ,ZJ,eZ,iZ,oZ,aZ,cZ,NJ,dZ,fZ,mZ,vY,vZ,fY,bY,bZ,uY,wZ,SZ,IZ,EZ,kZ,TZ,_Z,OZ,MZ,LZ,BZ,WZ,HZ,jZ,XZ,qZ,JZ,QZ,tQ,nQ,iQ,rQ,sQ,cQ,yJ,dQ,yY,bQ,wY,yQ,SY,EQ,NQ,DQ,$Y,NY,RQ,AQ,PQ,FQ,DY,RY,dY,zQ,CZ,VQ,GQ,UQ,wJ,AY,PY,KQ,FY,qQ,ZQ,eee,iee,oee,aee,lee,zY,uee,hee,pee,gee,xee,yee,Cee,VY,Iee,Nee,Tee,GY,UY,Aee,Mee,zee,KY,Vee,Gee,Hee,lR,Xee,SJ,YY,Yee,Zee,ete,nte,hY,Yg,rte,IJ,$J,EJ,ste,lte,ute,hte,pte,mte,vte,rJ,bte,Ite,Ete,Tte,sJ,_te,Ote,Mte,aJ,kee,zte,Vte,Gte,Ute,Kte,qte,Jte,Qte,uJ,ene,hJ,pJ,nne,rne,sne,lne,une,xJ,aQ,hne,pne,gne,xne,yne,Cne,XY,Tne,_ne,One,Wee];for(const n of Pne)VE(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Js={},Ud={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Mne(n,e){Js[n]=e}function Kr(n,e){if(!(n in Js)||e!=null){const i=Lne(n,e);if(i!==null)Js[n]=i;else return console.log("Could not get context for WebGL version",n),null}const t=Js[n];return t==null||t.isContextLost()?(delete Js[n],Kr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Js[n])}function Fne(n){if(!ae().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Lne(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??Fne(n);return t.addEventListener("webglcontextlost",i=>{i.preventDefault(),delete Js[n]},!1),ae().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ud.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Ud)||t.getContext("experimental-webgl",Ud):t.getContext("webgl2",Ud)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Jc;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Jc||(Jc={}));var or;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(or||(or={}));var ei;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ei||(ei={}));function Sd(n,e){return[e,n]}function zne(n,e){return n*e}function jd(n){const e=he(n),t=Math.ceil(e/4);return bg(t)}function rc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Bne(n,e){const[t,i]=rc(n,e);return t*i*4}function ey(n,e){const t=n;let i,r,o,s,a,l,c,u,d,f;return ae().getNumber("WEBGL_VERSION")===2?(i=t.R32F,r=t.R16F,o=t.RGBA16F,s=t.RGBA32F,a=t.RED,c=4,u=1,d=t.HALF_FLOAT,f=t.FLOAT,l=t.RGBA8):(i=n.RGBA,r=n.RGBA,o=n.RGBA,s=t.RGBA,a=n.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,f=n.FLOAT,l=n.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oe(n,e){const t=e();return ae().getBool("DEBUG")&&Vne(n),t}function Vne(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+Une(n,e))}const Wne=596e-10,Gne=65504;function Hne(n){return!!(ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Wne<Math.abs(n)&&Math.abs(n)<Gne)}function Une(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Kd(n,e){return ts(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function jne(n,e){const t=ts(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Oe(n,()=>n.shaderSource(t,e)),Oe(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function Kne(n,e){const t=ts(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Oe(n,()=>n.shaderSource(t,e)),Oe(n,()=>n.compileShader(t)),ae().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw cR(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const Xne=/ERROR: [0-9]+:([0-9]+):/g;function cR(n,e){const t=Xne.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const i=+t[1],r=n.split(`
`),o=r.length.toString().length+2,s=r.map((d,f)=>al((f+1).toString(),o)+d);let a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);const l=s.slice(0,i-1),c=s.slice(i-1,i),u=s.slice(i);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${al(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function qne(n){return ts(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function Yne(n,e){if(Oe(n,()=>n.linkProgram(e)),!ae().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Am(n,e){if(Oe(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Jne(n,e){const t=ts(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Oe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Oe(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Zne(n,e){const t=ts(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Oe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Oe(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Qne(n){return ts(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function eie(n,e){const t=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const i=`[${n}x${e}]`;throw new Error("Requested texture size "+i+" is invalid.")}if(n>t||e>t){const i=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+r+".")}}function tie(n){return ts(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function $S(n,e,t,i,r,o,s){const a=n.getAttribLocation(e,t);return a===-1?!1:(Oe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,i)),Oe(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,s)),Oe(n,()=>n.enableVertexAttribArray(a)),!0)}function nie(n,e,t){aie(n,t),Oe(n,()=>n.activeTexture(n.TEXTURE0+t)),Oe(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function iie(n,e,t){return ts(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function rie(n,e,t){return n.getUniformLocation(e,t)}function oie(n,e,t,i){Oe(n,()=>nie(n,e,i)),Oe(n,()=>n.uniform1i(t,i))}function Om(n,e,t){Oe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Oe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function ES(n,e){Oe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Oe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Xd(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+sie(n,e))}function sie(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ts(n,e,t){const i=Oe(n,()=>e());if(i==null)throw new Error(t);return i}function aie(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=e+n.TEXTURE0;if(i<n.TEXTURE0||i>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function zl(n,e=2){return he(n.slice(0,n.length-e))}function Bl(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function qd(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[zl(n),...Bl(n)]),e}function lie(n,e=!1){let t=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=ae().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");i===1/0&&ae().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=t/2),e&&(t=t*2,i=i*2,n=n.map((a,l)=>l>=n.length-2?xx(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=ks(n).newShape);let r=he(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const s=o!=null&&Math.max(...o)>i&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||s)if(e){const a=zl(n);let l=2,c=2;n.length&&([l,c]=Bl(n)),r=a*(l/2)*(c/2),o=bg(r).map(u=>u*2)}else o=bg(r);return o}function Yd(n){return n%2===0}function Jh(n,e){if(n=n.slice(-2),e=e.slice(-2),Ht(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],i=e[e.length-1];if(t===i||Yd(t)&&Yd(i)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Yd(n[0])&&Yd(e[0])}let Pm,Mm;function cie(n){if(Pm==null){const e=Kr(n);Pm=e.getParameter(e.MAX_TEXTURE_SIZE)}return Pm}function uie(n){if(Mm==null){const e=Kr(n);Mm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Mm)}function die(n){if(n===0)return 0;let e;const t=Kr(n);return Er(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Er(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Er(n,e){return n.getExtension(e)!=null}function NS(n){try{if(Kr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function hie(n){if(n===0)return!1;const e=Kr(n);if(n===1){if(!Er(e,"OES_texture_float"))return!1}else if(!Er(e,"EXT_color_buffer_float"))return!1;return Zg(e)}function fie(n){if(n===0)return!1;const e=Kr(n);if(n===1){if(!Er(e,"OES_texture_float")||!Er(e,"WEBGL_color_buffer_float"))return!1}else{if(Er(e,"EXT_color_buffer_float"))return Zg(e);const i="EXT_color_buffer_half_float";if(Er(e,i)){const r=e.getExtension(i);return pie(e,r)}return!1}return Zg(e)}function Zg(n){const e=ey(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),s}function pie(n,e){const t=ey(n,e),i=n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(i),n.deleteFramebuffer(s),a}function mie(n){return n!==2?!1:Kr(n).fenceSync!=null}function Id(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&F(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const je=ae();je.registerFlag("HAS_WEBGL",()=>je.getNumber("WEBGL_VERSION")>0);je.registerFlag("WEBGL_VERSION",()=>NS(2)?2:NS(1)?1:0);je.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);je.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>je.get("WEBGL_VERSION")===2);je.registerFlag("WEBGL_CPU_FORWARD",()=>!0);je.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);je.registerFlag("WEBGL_PACK",()=>je.getBool("HAS_WEBGL"));je.registerFlag("WEBGL_PACK_NORMALIZATION",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_CLIP",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_REDUCE",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_LAZILY_UNPACK",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_CONV_IM2COL",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>je.getBool("WEBGL_PACK"));je.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>cie(je.getNumber("WEBGL_VERSION")));je.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>uie(je.getNumber("WEBGL_VERSION")));je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=je.getNumber("WEBGL_VERSION");return n===0?0:die(n)});je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>je.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!r2());je.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>hie(je.getNumber("WEBGL_VERSION")));je.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>je.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:je.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));je.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>fie(je.getNumber("WEBGL_VERSION")));je.registerFlag("WEBGL_FENCE_API_ENABLED",()=>mie(je.getNumber("WEBGL_VERSION")));je.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>je.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);je.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});je.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>r2()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});je.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);je.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);je.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);je.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);je.registerFlag("WEBGL_EXP_CONV",()=>!1);je.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>je.getBool("IS_TEST"));je.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);je.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);je.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);je.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Di(){let n,e,t,i,r,o,s,a,l,c;return ae().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",i="in",r="texture",o="outputColor",s="out vec4 outputColor;",a=ae().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",i="varying",r="texture2D",o="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:i,texture2D:r,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ba(n,e,t="index"){const i=Qe(e);return i.map((r,o)=>{const s=`int ${n[o]} = ${t} / ${r}`,a=o===i.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${s}; ${a};`}).join("")}function Hp(n,e,t="index"){const i=Qe(e);return i.map((r,o)=>{const s=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===i.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${s}; ${a};`}).join("")}function gie(n,e){const t=n.length,i=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=i[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${i[o+1]})`;return r}function vie(n,e,t="index"){const i=n.map((o,s)=>s),r=gie(i,e);return r.map((o,s)=>{const a=`int ${n[s]} = ${t} / ${r[s]}`,l=s===r.length-1?`int ${n[s+1]} = ${t} - ${n[s]} * ${r[s]}`:`index -= ${n[s]} * ${r[s]}`;return`${a}; ${l};`}).join("")}function ty(n){const e=Qe(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function ny(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const uR=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:dR}=r7;function xie(n,e,t){const i=[];if(n.forEach(h=>{const p=he(h.shapeInfo.logicalShape);if(h.shapeInfo.isUniform?i.push(`uniform float ${h.name}${p>1?`[${p}]`:""};`):(i.push(`uniform sampler2D ${h.name};`),i.push(`uniform int offset${h.name};`)),t.enableShapeUniforms){const{uniformShape:m}=iy(t.packedInputs,h.shapeInfo.logicalShape,h.shapeInfo.texShape);switch(m.length){case 1:i.push(`uniform int ${h.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${h.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${h.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${h.name}Shape;`);break}i.push(`uniform ivec2 ${h.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;");break}i.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(h=>{i.push(`uniform ${h.type} ${h.name}${h.arrayIndex?`[${h.arrayIndex}]`:""};`)});const r=i.join(`
`),o=n.map(h=>bie(h,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),s=e.texShape,a=Di(),l=Cie(a);let c,u,d=$ie(a);return e.isPacked?(c=yie(e.logicalShape,s,t.enableShapeUniforms),u=Iie(a)):(c=wie(e.logicalShape,s,t.enableShapeUniforms),u=Sie(a)),t.packedInputs&&(d+=Die),[d,l,u,r,c,o,t.userCode].join(`
`)}function oc(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return Vie(n,e);case 1:return Gie(n,e);case 2:return Uie(n,e);case 3:return Kie(n,e);case 4:return qie(n,e);case 5:return Yie(n);case 6:return Jie(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function hR(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return Bie(n);case 1:return Wie(n,e);case 2:return Hie(n,e);case 3:return jie(n,e);default:return Xie(n,e)}}function bie(n,e,t=!1,i){let r="";t?r+=hR(n,i):r+=oc(n,i);const o=n.shapeInfo.logicalShape,s=e.logicalShape;return o.length<=s.length&&(t?r+=Zie(n,e):r+=Qie(n,e)),r}function yie(n,e,t){switch(n.length){case 0:return fR();case 1:return Tie(n,e,t);case 2:return Lie(n,e,t);case 3:return _ie(n,e,t);default:return Oie(n,e,t)}}function wie(n,e,t){switch(n.length){case 0:return fR();case 1:return Rie(n,e,t);case 2:return zie(n,e,t);case 3:return Aie(n,e,t);case 4:return Pie(n,e,t);case 5:return Mie(n,e);case 6:return Fie(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function Cie(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function Sie(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function Iie(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function $ie(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Eie}
    ${Nie}
    ${kie}
  `}const Eie=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Nie=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kie=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Die=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function fR(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Tie(n,e,t){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return i[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${i[1]}.0);
      }
    `:i[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${i[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);
    }
  `}function Rie(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function _ie(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Aie(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Hp(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const i=Ba(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec3(r, c, d);
    }
  `}function Oie(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let s=o,a="",l="b, r, c";for(let c=2;c<n.length-1;c++)s*=n[n.length-c-1],a=`
      int b${c} = index / ${s};
      index -= b${c} * ${s};
    `+a,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function Pie(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Hp(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const i=Ba(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec4(r, c, d, d2);
    }
  `}function Mie(n,e){const t=Ba(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Fie(n,e){const t=Ba(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Lie(n,e,t){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ht(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));

      int index = resTexRC.x * ${i[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function zie(n,e,t){return Ht(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Va(n){return`offset${n}`}function Bie(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),i=Di();return`
    vec4 ${t}() {
      return ${i.texture2D}(${e}, halfCR);
    }
  `}function Vie(n,e){const t=n.name,i="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${i}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${i}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const s=Va(t);if(e)return`
    float ${i}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${s});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${i}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${s});
      return sampleTexture(${t}, uv);
    }
  `}function Wie(n,e){const t=n.name,i="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=Di();if(e)return`
    vec4 ${i}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const s=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${i}(int index) {
      vec2 uv = packedUVfrom1D(
        ${s[0]}, ${s[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function Gie(n,e){const t=n.name,i="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${i}(int index) {
        ${sc(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],s=r[1];if(s===1&&o===1)return`
      float ${i}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Va(t);return s===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${s}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${o}, ${s}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function Hie(n,e){const t=n.shapeInfo.logicalShape,i=n.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n.shapeInfo.texShape,s=o[0],a=o[1],l=Di();if(o!=null&&Ht(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);

        return ${l.texture2D}(${i}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${s}.0);

        return ${l.texture2D}(${i}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${i}, uv);
    }
  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${i}, uv);
    }
  `}function Uie(n,e){const t=n.shapeInfo.logicalShape,i=n.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n.shapeInfo.texShape;if(o!=null&&Ht(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `;const f=o[0],h=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${h}.0, ${f}.0);
      return sampleTexture(${i}, uv);
    }
  `}const{newShape:s,keptDims:a}=ks(t),l=s;if(l.length<t.length){const f=ac(n,l),h=["row","col"];return`
      ${oc(f,e)}
      float ${r}(int row, int col) {
        return ${r}(${lc(h,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${sc(n)}
      }
    `;const c=o[0],u=o[1],d=Va(i);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${i}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${i}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
        return sampleTexture(${i}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${i}, uv);
  }
`}function jie(n,e){const t=n.shapeInfo.logicalShape,i=n.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n.shapeInfo.texShape,s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const f=t.slice(1),h=[1,2],p=ac(n,f),m=["b","row","col"];return`
        ${hR(p,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${lc(m,h)});
        }
      `}const a=Di();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `;const l=s[0],c=s[1],u=Math.ceil(t[2]/2),d=u*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `}function Kie(n,e){const t=n.shapeInfo.logicalShape,i=n.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t[1]*t[2],s=t[2],{newShape:a,keptDims:l}=ks(t),c=a;if(c.length<t.length){const m=ac(n,c),g=["row","col","depth"];return`
        ${oc(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${lc(g,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${s}, 1)));
        ${sc(n)}
      }
    `;const u=n.shapeInfo.texShape,d=u[0],f=u[1],h=n.shapeInfo.flatOffset;if(f===o&&h==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${i}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${s}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${i}, uv);
        }
      `;if(f===s&&h==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${i}, uv);
    }
  `;const p=Va(i);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${i}Shape[1] * ${i}Shape[2];
      int stride1 = ${i}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
      return sampleTexture(${i}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${s} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${i}, uv);
      }
  `}function Xie(n,e){const t=n.name,i="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Di();if(e)return`
    vec4 ${i}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,s=o.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(o[s-1]/2);let f=d*Math.ceil(o[s-2]/2),h="int b, int row, int col",p=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<s-1;m++)h=`int b${m}, `+h,f*=o[s-m-1],p=`b${m} * ${f} + `+p;return`
    vec4 ${i}(${h}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${r.texture2D}(${t}, uv);
    }
  `}function qie(n,e){const t=n.shapeInfo.logicalShape,i=n.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t[3],s=t[2]*o,a=t[1]*s,{newShape:l,keptDims:c}=ks(t);if(l.length<t.length){const x=ac(n,l),b=["row","col","depth","depth2"];return`
      ${oc(x,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${lc(b,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${s}, ${o}, 1)));
        ${sc(n)}
      }
    `;const u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],h=d[1],p=`int stride2 = ${i}Shape[3];`,m=`int stride1 = ${i}Shape[2] * stride2;`,g=`int stride0 = ${i}Shape[1] * stride1;`;if(h===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${i}, uv);
      }
    `;if(h===o&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${i}, uv);
      }
    `;const v=Va(i);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${v});
      return sampleTexture(${i}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${h}, index + ${v});
      return sampleTexture(${i}, uv);
    }
  `}function Yie(n){const e=n.shapeInfo.logicalShape,t=n.name,i="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,s=e[2]*o,a=e[1]*s,{newShape:l,keptDims:c}=ks(e);if(l.length<e.length){const m=ac(n,l),g=["row","col","depth","depth2","depth3"];return`
      ${oc(m)}
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        return ${i}(${lc(g,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${o}, ${r})) +
          depth3;
        ${sc(n)}
      }
    `;const u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],h=d[1];if(h===a&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(h===r&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const p=Va(t);return`
    float ${i}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${o} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${h}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Jie(n){const e=n.shapeInfo.logicalShape,t=n.name,i="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=ks(e);if(r.length<e.length){const g=ac(n,r),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${oc(g)}
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${i}(${lc(v,o)});
      }
    `}const s=e[5],a=e[4]*s,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${sc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,h=f[0],p=f[1];if(p===u&&d==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===s&&d==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${t}, uv);
      }
    `;const m=Va(t);return`
    float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${m};
      vec2 uv = uvFromFlat(${h}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function sc(n){const e=n.name,t=he(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Zie(n,e){const t=n.name,i=t.charAt(0).toUpperCase()+t.slice(1),r="get"+i+"AtOutCoords",o=n.shapeInfo.logicalShape.length,s=e.logicalShape.length,a=dR(n.shapeInfo.logicalShape,e.logicalShape),l=qt(s),c=s-o;let u;const d=["x","y","z","w","u","v"];o===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(x=>`coords.${d[x+c]} = 0;`).join(`
`);let f="";s<2&&o>0?f="coords":f=n.shapeInfo.logicalShape.map((x,b)=>`coords.${d[b+c]}`).join(", ");let h="return outputValue;";const m=he(n.shapeInfo.logicalShape)===1,v=he(e.logicalShape)===1;if(o===1&&!m&&!v)h=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!v)s===1?h=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:h=`
        return vec4(outputValue.x);
      `;else if(a.length){const x=o-2,b=o-1;a.indexOf(x)>-1&&a.indexOf(b)>-1?h="return vec4(outputValue.x);":a.indexOf(x)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${i}(${f});
      ${h}
    }
  `}function Qie(n,e){const t=n.name,i=t.charAt(0).toUpperCase()+t.slice(1),r="get"+i+"AtOutCoords",o=e.texShape,s=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&Ht(s,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=qt(l),u=dR(n.shapeInfo.logicalShape,e.logicalShape),d=l-a;let f;const h=["x","y","z","w","u","v"];a===0?f="":l<2&&u.length>=1?f="coords = 0;":f=u.map(m=>`coords.${h[m+d]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=n.shapeInfo.logicalShape.map((m,g)=>`coords.${h[g+d]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${i}(${p});
    }
  `}function qt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function iy(n,e,t){const{newShape:i,keptDims:r}=ks(e),o=e.length,s=n&&o===3&&e[0]===1,a=s?e.slice(1):i,l=!n&&o>1&&!Ht(e,t)&&i.length<o||s;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function ac(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function lc(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ere(n,e,t,i){const r=t.map((u,d)=>{const f={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(f.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:f}}),o=r.map(u=>u.shapeInfo),s={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},a=xie(r,s,e),l=Kne(n.gl,a),c=n.createProgram(l);return ae().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:s},pR(n,e,c)))}function pR(n,e,t){const i=[],r=[];let o,s,a,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),ae().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const f={name:d,uniform:n.getUniformLocation(t,d,u),offset:n.getUniformLocation(t,`offset${d}`,u)};e.enableShapeUniforms&&(f.shape=n.getUniformLocation(t,`${d}Shape`,u),f.texShape=n.getUniformLocation(t,`${d}TexShape`,u)),i.push(f)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",u),a=n.getUniformLocation(t,"outShapeStrides",u),s=n.getUniformLocation(t,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)r.push(n.getUniformLocation(t,d.name,u));return{variablesLocations:i,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:s}}function kS(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,i)=>{const r=t.logicalShape,o=e[i],s=o.shape;if(!Ht(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!Ht(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function tre(n,e,t,i,r){e.program.enableShapeUniforms||(kS(e.inShapeInfos,t),kS([e.outShapeInfo],[i]));const o=i.texData.texture,s=i.texData.texShape;i.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,s[0],s[1]):n.setOutputMatrixTexture(o.texture,s[0],s[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),ae().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:u,offset:d,shape:f,texShape:h}=e.variablesLocations[l];if(f){const{uniformShape:p}=iy(e.program.packedInputs,c.shape,c.texData.texShape);switch(p.length){case 1:n.gl.uniform1iv(f,new Int32Array(p));break;case 2:n.gl.uniform2iv(f,new Int32Array(p));break;case 3:n.gl.uniform3iv(f,new Int32Array(p));break;case 4:n.gl.uniform4iv(f,new Int32Array(p));break}}if(h&&n.gl.uniform2i(h,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(he(c.shape)<2)n.gl.uniform1f(u,c.uniformValues[0]);else{let p=c.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),n.gl.uniform1fv(u,p)}continue}c.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(i.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(i.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(i.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(i.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(i.shape));break}if(e.outShapeStridesLocation){const l=Qe(i.shape);switch(i.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=r[l];if(c.type==="float")n.gl.uniform1fv(u,d);else if(c.type==="vec2")n.gl.uniform2fv(u,d);else if(c.type==="vec3")n.gl.uniform3fv(u,d);else if(c.type==="vec4")n.gl.uniform4fv(u,d);else if(c.type==="int")n.gl.uniform1iv(u,d);else if(c.type==="ivec2")n.gl.uniform2iv(u,d);else if(c.type==="ivec3")n.gl.uniform3iv(u,d);else if(c.type==="ivec4")n.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function nre(n,e,t){let i="";e.concat(t).forEach(s=>{const a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!s.isUniform){const l=s.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=iy(n.packedInputs,s.shape,l);let f="",h="",p="";if(u.length===1&&n.packedInputs){const y=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${y[0]>1}_${y[1]>1}`}else if(u.length===2&&!n.packedInputs)h=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!n.packedInputs){const y=Qe(u);p=`${y[0]===l[1]}_${y[y.length-1]===l[1]}`}const m=s.shape.length,g=u.length===2&&Ht(s.shape,l),v=he(s.shape)===1,x=_l(s.shape,t.shape),b=!n.packedInputs&&m===t.shape.length&&Ht(l,t.texData.texShape),w=n.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;i+=`${m}_${b}_${c?d:""}_${u.length}_${v}_${x}_${g}_${f}_${h}_${p}_${w}_${a}`}else{const l=s.isUniform?"uniform":s.texData.texShape;i+=`${s.shape}_${l}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+i+"_"+r+`${ae().getNumber("WEBGL_VERSION")}`,o}function bi(n){return ae().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ire{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Jc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Di();this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Hp(["r","c","d"],e):Ba(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rre{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Jc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Di();this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Hp(["r","c","d"],e):Ba(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ore{constructor(e){this.variableNames=["A"],this.outTexUsage=or.DOWNLOAD;const t=Di();this.outputShape=e,this.userCode=`
      ${uR}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sre{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=or.DOWNLOAD;const t=Di();this.outputShape=e,this.userCode=`
      ${uR}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are={R:0,G:1,B:2,A:3};class DS{constructor(e,t=!1,i="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Di();this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let s="";for(let a=0;a<i.length;a++){const l=i[a];s+=`
          if(offset == ${a}) {
            result = values[${are[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?ny():ty(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${i.length});

        flatIndex = idiv(flatIndex, ${i.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${s}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lre{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=Di();this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){const l=s*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${i.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?ny():ty(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${i.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(n){const e=Di(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return jne(n,t)}function ure(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Jne(n,e)}function dre(n){const e=new Uint16Array([0,1,2,2,1,3]);return Zne(n,e)}function $d(n,e,t,i,r,o){eie(e,t);const s=Qne(n),a=n.TEXTURE_2D;return Oe(n,()=>n.bindTexture(a,s)),Oe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Oe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Oe(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Oe(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),ae().getNumber("WEBGL_VERSION")===1?Oe(n,()=>n.texImage2D(a,0,i,e,t,0,r,o,null)):Oe(n,()=>n.texStorage2D(a,1,i,e,t)),Oe(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:s,texShape:[t,e]}}function mR(n){return n.internalFormatFloat}function hre(n,e,t,i){const[r,o]=Sd(e,t);return $d(n,r,o,mR(i),i.textureFormatFloat,n.FLOAT)}function gR(n){return n.internalFormatHalfFloat}function fre(n,e,t,i){const[r,o]=Sd(e,t);return $d(n,r,o,gR(i),i.textureFormatFloat,i.textureTypeHalfFloat)}function vR(n){return n.downloadTextureFormat}function pre(n,e,t,i){const[r,o]=Sd(e,t);return $d(n,r,o,vR(i),n.RGBA,n.UNSIGNED_BYTE)}function xR(n){return n.internalFormatPackedFloat}function mre(n,e,t,i){const[r,o]=rc(e,t);return $d(n,r,o,xR(i),n.RGBA,n.FLOAT)}function bR(n){return n.internalFormatPackedHalfFloat}function gre(n,e,t,i){const[r,o]=rc(e,t);return $d(n,r,o,bR(i),n.RGBA,i.textureTypeHalfFloat)}function vre(n,e,t){return Oe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),$S(n,e,"clipSpacePos",t,3,20,0)&&$S(n,e,"uv",t,2,20,12)}function xre(n,e,t,i,r,o){Oe(n,()=>n.bindTexture(n.TEXTURE_2D,e));let s,a,l;r instanceof Uint8Array?(s=new Uint8Array(t*i*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(t*i*4),a=n.FLOAT,l=o.internalFormatPackedFloat),s.set(r),ae().getNumber("WEBGL_VERSION")===2?Oe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,i,n.RGBA,a,s)):Oe(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,i,0,n.RGBA,a,s)),Oe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function bre(n,e,t){Oe(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ae().getNumber("WEBGL_VERSION")===2?Oe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Oe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ae().getNumber("WEBGL_VERSION")===2?Oe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Oe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Oe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function yre(n,e,t,i){const r=n.createBuffer();Oe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Oe(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Oe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Oe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function wre(n,e,t){const i=n,r=new Float32Array(t);return i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}function Cre(n,e,t,i){const[r,o]=Sd(e,t),s=4,a=new Uint8Array(zne(e*t,s));return Oe(n,()=>n.readPixels(0,0,r,o,i.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Sre(n,e,t,i,r,o,s,a){const l=n,c=new Float32Array(Bne(o,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Ire(n,e,t){const i=new Float32Array(e*t*4);return Oe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,i)),i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fm{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=ae().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Mne(t,e)):this.gl=Kr(t),e=this.gl,ae().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Oe(o,()=>o.createVertexArray()),this.bindVertexArray=s=>Oe(o,()=>o.bindVertexArray(s)),this.deleteVertexArray=s=>Oe(o,()=>o.deleteVertexArray(s)),this.getVertexArray=()=>Oe(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Oe(e,()=>o.createVertexArrayOES()),this.bindVertexArray=s=>Oe(e,()=>o.bindVertexArrayOES(s)),this.deleteVertexArray=s=>Oe(e,()=>o.deleteVertexArrayOES(s)),this.getVertexArray=()=>Oe(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let i="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ae().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=Kd(this.gl,o),Er(this.gl,s))this.textureHalfFloatExtension=Kd(this.gl,s);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),Er(this.gl,r))this.colorBufferHalfFloatExtension=Kd(this.gl,r);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",Er(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(Er(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=ure(this.gl),this.indexBuffer=dre(this.gl),this.framebuffer=tie(this.gl),this.textureConfig=ey(this.gl,this.textureHalfFloatExtension)}get debug(){return ae().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Oe(e,()=>e.finish()),Oe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Oe(e,()=>e.deleteFramebuffer(this.framebuffer)),Oe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Oe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Oe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),hre(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),fre(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),pre(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),bre(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,i,r){this.throwIfDisposed(),xre(this.gl,e,t,i,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),gre(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),mre(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(ES(this.gl,this.framebuffer),this.outputTexture=null),Oe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,i){return this.downloadMatrixDriver(e,()=>Cre(this.gl,t,i,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,i,r,o,s){return Sre(this.gl,e,t,i,r,o,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return wre(this.gl,e,t)}createBufferFromTexture(e,t,i){this.bindTextureToFrameBuffer(e);const r=yre(this.gl,t,i,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,i;if(ae().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),i=()=>{const s=r.clientWaitSync(o,0,0);return s===r.ALREADY_SIGNALED||s===r.CONDITION_SATISFIED},t=o}else ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),i=()=>this.isQueryAvailable(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):i=()=>!0;return{query:t,isFencePassed:i}}downloadMatrixFromPackedTexture(e,t,i){return this.downloadMatrixDriver(e,()=>Ire(this.gl,t,i))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=cre(t));const i=qne(t);Oe(t,()=>t.attachShader(i,this.vertexShader)),Oe(t,()=>t.attachShader(i,e)),Yne(t,i);const r=Object.assign(i,{vao:this.createVertexArray()});return this.debug&&Am(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Oe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),vre(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Oe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Am(this.gl,this.program),Oe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,i=!0){return this.throwIfDisposed(),i?iie(this.gl,e,t):rie(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Oe(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,i){this.throwIfDisposed(),this.throwIfNoProgram(),oie(this.gl,e,t,i)}setOutputMatrixTexture(e,t,i){this.setOutputMatrixTextureDriver(e,i,t)}setOutputPackedMatrixTexture(e,t,i){this.throwIfDisposed();const[r,o]=rc(t,i);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,i,r){this.setOutputMatrixWriteRegionDriver(i,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,i,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Am(this.gl,this.program),Xd(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Oe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Oe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Kd(this.gl,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const i=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=i.createQuery();return i.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,i=this.getQueryTimerExtensionWebGL2();t.endQuery(i.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await fC(()=>this.disposed||this.isQueryAvailable(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const i=this.gl;return i.getQueryParameter(e,i.QUERY_RESULT)/1e6}else{const i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const i=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=i.getQueryParameter(e,i.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const i=this.getQueryTimerExtensionWebGL1(),r=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=$re(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:i}=this.itemsToPoll[t];i()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let i;"setTimeoutCustom"in ae().platform&&(i=ae().platform.setTimeoutCustom.bind(ae().platform)),fC(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,i)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Om(this.gl,e,this.framebuffer),this.debug&&Xd(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Om(this.gl,this.outputTexture,this.framebuffer),this.debug&&Xd(this.gl)):ES(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const i=t();return this.unbindTextureToFrameBuffer(),i}setOutputMatrixTextureDriver(e,t,i){this.throwIfDisposed();const r=this.gl;Om(r,e,this.framebuffer),this.debug&&Xd(r),this.outputTexture=e,Oe(r,()=>r.viewport(0,0,t,i)),Oe(r,()=>r.scissor(0,0,t,i))}setOutputMatrixWriteRegionDriver(e,t,i,r){this.throwIfDisposed(),Oe(this.gl,()=>this.gl.scissor(e,t,i,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function $re(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Ere,bincountImpl:yR,bincountReduceImpl:Nre,bitwiseAndImpl:kre,castImpl:Dre,ceilImpl:Tre,concatImpl:Rre,equalImpl:_re,expImpl:Are,expm1Impl:Ore,floorImpl:Pre,gatherNdImpl:Mre,gatherV2Impl:Fre,greaterImpl:Lre,greaterEqualImpl:zre,lessImpl:Bre,lessEqualImpl:Vre,linSpaceImpl:Wre,logImpl:Gre,maxImpl:Hre,maximumImpl:Ure,minimumImpl:jre,multiplyImpl:Kre,negImpl:Xre,notEqualImpl:qre,prodImpl:Yre,raggedGatherImpl:Jre,raggedRangeImpl:Zre,raggedTensorToTensorImpl:Qre,rangeImpl:eoe,rsqrtImpl:toe,scatterImpl:noe,sigmoidImpl:ioe,simpleAbsImpl:wR,sliceImpl:roe,sparseFillEmptyRowsImpl:ooe,sparseReshapeImpl:soe,sparseSegmentReductionImpl:CR,sqrtImpl:aoe,staticRegexReplaceImpl:loe,stridedSliceImpl:coe,stringNGramsImpl:uoe,stringSplitImpl:doe,stringToHashBucketFastImpl:hoe,subImpl:foe,tileImpl:poe,topKImpl:moe,transposeImpl:ry,uniqueImpl:goe}=bJ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SR(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Ii(n,e){return e===1?[n]:SR(n,e)}function voe(n,e){if(n===1)return"rc";let t="";for(let i=0;i<n;i++)t+=e[i],i<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xoe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=bi(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Ii("rc",this.rank),i=qt(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),s=this.getOutput(t);this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let i=0;i<=1;i++)for(let r=0;r<=1;r++){let o=`${i===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)o=`${e[e.length-1-s]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let i=this.rank-2;i<this.rank;i++)t+=`${e[i]} >= ${this.enableShapeUniforms?`outShape[${i}]`:this.outputShape[i]}`,i<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),i=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${i};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IR{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length);let i="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),i+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${boe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?ny():ty(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${i}

        setOutput(result);
      }
    `}}function boe(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?vie(["r","c","d"],"inputShape"):Ba(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yoe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,i){const r=RS(t,i),o=_S(e,r,i);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const s=TS(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,i);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===ei.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===ei.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===ei.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===ei.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===ei.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(e,t,i,r){if(this.freeTextures==null)return;const o=RS(i,r),s=_S(t,o,r);s in this.freeTextures||(this.freeTextures[s]=[]);const a=TS(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=ae().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[s],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function woe(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function TS(n,e,t,i,r){const o=Coe(e,i);let s;if(r){const[l,c]=rc(n[0],n[1]);s=l*c}else{const[l,c]=Sd(n[0],n[1]);s=l*c}const a=woe(t,o);return s*a}function Coe(n,e){switch(n){case ei.PACKED_2X2_FLOAT32:return xR(e);case ei.PACKED_2X2_FLOAT16:return bR(e);case ei.UNPACKED_FLOAT32:return mR(e);case ei.UNPACKED_FLOAT16:return gR(e);case ei.PACKED_4X1_UNSIGNED_BYTE:return vR(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function Soe(n){return ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ei.PACKED_2X2_FLOAT32:ei.UNPACKED_FLOAT32:n?ei.PACKED_2X2_FLOAT16:ei.UNPACKED_FLOAT16}function RS(n,e){if(n===or.UPLOAD)return ei.PACKED_2X2_FLOAT32;if(n===or.RENDER||n==null)return Soe(e);if(n===or.DOWNLOAD||n===or.PIXELS)return ei.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function _S(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ho{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Or="if (isnan(x)) return x;",Ioe="return x;",AS="return abs(x);",$oe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Eoe=Or+`
  return (x < 0.0) ? 0.0 : x;
`,Noe=Or+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ss="return x;",koe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Doe="return x;",Toe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Roe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_oe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Aoe="return 1.0 / (1.0 + exp(-1.0 * x));";class ds{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ooe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length);const t=e.length,i=Ii("rc",t),r=qt(t),o=voe(t,i),s=i.slice(-2),a=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Poe=j2,Moe=1e-7,Foe=1e-4,Jd={};function Loe(n){return n in Jd||(Jd[n]={}),Jd[n]}const zoe=ae().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Boe=600;function Voe(){return ae().global.screen==null?1024:ae().global.screen.height*ae().global.screen.width*window.devicePixelRatio*Boe/1024/1024}class Up extends vx{nextDataId(){return Up.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof Fm)t=e;else{const i=Kr(ae().getNumber("WEBGL_VERSION"),e);t=new Fm(i)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const i=Kr(ae().getNumber("WEBGL_VERSION"));t=new Fm(i),this.binaryCache=Loe(ae().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new yoe(this.gpgpu),this.numMBBeforeWarning=Voe(),this.texData=new hE(this,ro())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,i,r,o,s){const a=this.makeTensorInfo(t,i),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const c=qd(t),u=new DS(c,!1,s),d=this.runWebGLProgram(u,[a],i,[[r,o]]);return d.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,t,i){if((ae().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ae().getBool("DEBUG"))&&this.checkNumericalProblems(e),i==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:i,values:e,usage:or.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,i,r,o){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:r,values:t,usage:or.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:i,dtype:r,complexTensorInfos:o,slice:s,shape:a,isPacked:l}=t;if(s!=null){let f;l?f=new ds(a,ss):f=new ho(a,ss);const h=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:r}],r),p=this.readSync(h.dataId);return this.disposeIntermediateTensorInfo(h),p}if(i!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return i;const c=this.activeTimers!=null;let u;c&&(u=_i());let d;if(r==="complex64"){const f=this.readSync(o.real.dataId),h=this.readSync(o.imag.dataId);d=Ko(f,h)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=_i()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const t=this.texData.get(e),{values:i,shape:r,slice:o,dtype:s,complexTensorInfos:a,isPacked:l}=t;if(o!=null){let p;l?p=new ds(r,ss):p=new ho(r,ss);const m=this.runWebGLProgram(p,[{dataId:e,shape:r,dtype:s}],s),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(i!=null)return this.convertAndCacheOnCPU(e);if(ae().getBool("DEBUG")&&!ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(s!=="complex64"&&ae().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const p=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(p.texture.texture,...jd(r))}this.pendingRead.set(e,[]),s!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(s==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];d=Ko(m,g)}else if(c==null)d=this.getValuesFromTexture(e);else{const p=he(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const p=this.gpgpu.gl;Oe(p,()=>p.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,d),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(p=>p(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ro().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,t={}){const i=this.texData.get(e),{values:r,shape:o,slice:s,dtype:a,isPacked:l,texture:c}=i;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){let h;l?h=new ds(o,ss):h=new ho(o,ss);const p=this.runWebGLProgram(h,[{dataId:e,shape:o,dtype:a}],a),m=this.readToGPU(p,t);return this.disposeIntermediateTensorInfo(p),m}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,t.customTexShape),d=ro().makeTensorFromTensorInfo(u),f=this.texData.get(u.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const i=t.map(r=>ws(r));return wt(e.shape,e.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return wt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const i=e[t];if(!Hne(i))throw ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${i} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${i} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:i,isPacked:r}=this.texData.get(e),o=he(t);if(ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),h=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(h.texture.texture,...jd(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),p}const s=ae().getBool("WEBGL_PACK")&&r===!0,a=s?qd(t):t,l=s?new sre(a):new ore(a),c=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,i=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=i,r=!0):this.activeTimers.push(i),this.activeTimers=i,e();const o=pa(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),s=pa(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=dH(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:s[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:_i(),endMs:null}}endTimer(e){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=_i(),e)}async getQueryTime(e){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:i}=this.texData.get(e);return i!=null&&(this.disposeData(i.real.dataId,t),this.disposeData(i.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:i,texShape:r,usage:o,isPacked:s,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,i),this.textureManager.releaseTexture(t,r,o,s)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=zoe){return ae().getBool("WEBGL_CPU_FORWARD")&&e.every(i=>this.texData.get(i.dataId).texture==null&&he(i.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){rr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Poe(e.shape,t)}packedUnaryOp(e,t,i){const r=new ds(e.shape,t),o=this.compileAndRun(r,[e],i);return ro().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=wR(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,AS,e.dtype);const t=new ho(e.shape,AS),i=this.compileAndRun(t,[e]);return ro().makeTensorFromTensorInfo(i)}makeTensorInfo(e,t,i){let r;if(t==="string"&&i!=null&&i.length>0&&uu(i[0])){const o=i.map(s=>ps(s));r=this.write(o,e,t)}else r=this.write(i,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,i){return ro().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,i),this)}unpackTensor(e){const t=new Ooe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new xoe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const i=[zl(e.shape),...Bl(e.shape)],r={dtype:e.dtype,shape:i,dataId:e.dataId},o=[zl(t),...Bl(t)],s=new IR(o,i),a=!0,l=[i],c=this.runWebGLProgram(s,[r],e.dtype,l,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const i=this.texData.get(e),{isPacked:r,shape:o,dtype:s}=i;if(t!=null){const f=he(o),h=t[0]*t[1]*4;F(f<=h,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=qd(o);let l;r?l=new rre(a):l=new ire(a);const c=!0,u=[t??jd(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],s,u,c,t);return{dtype:s,shape:o,dataId:d.dataId}}runWebGLProgram(e,t,i,r,o=!1,s){const a=this.makeTensorInfo(e.outputShape,i),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Jc.DENSE){const v=s??jd(e.outputShape);l.texShape=v.map(x=>x*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),he(a.shape)===0)return l.values=pi(a.dtype,0),a;const c=[],u=t.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let x=this.texData.get(v.dataId);if(x.texture==null){if(!e.packedInputs&&he(v.shape)<=ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!x.isPacked!=!!e.packedInputs)v=x.isPacked?this.unpackTensor(v):this.packTensor(v),c.push(v),x=this.texData.get(v.dataId);else if(x.isPacked&&!Jh(x.shape,v.shape)){const b=v,w=v.shape;v.shape=x.shape,v=this.packedReshape(v,w),c.push(v),x=this.texData.get(v.dataId),b.shape=w}return{shape:v.shape,texData:x,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},f=nre(e,u,d),h=this.getAndSaveBinary(f,()=>ere(this.gpgpu,e,u,d)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),ae().get("ENGINE_COMPILE_ONLY")||tre(this.gpgpu,h,u,d,r),c.forEach(v=>this.disposeIntermediateTensorInfo(v)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=ae().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const v=_i();v-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!ae().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const v=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),v}return a}compileAndRun(e,t,i,r,o=!1){return i=i||t[0].dtype,this.runWebGLProgram(e,t,i,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ie(()=>{if(!ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ae().getBool("DEBUG");ae().set("DEBUG",!1);const t=this.abs(Gt(1e-8)).dataSync()[0];if(ae().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Moe:Foe}uploadToGPU(e){const t=this.texData.get(e),{shape:i,dtype:r,values:o,texture:s,usage:a,isPacked:l}=t;if(s!=null)return;const c=this.activeTimers!=null;let u;c&&(u=_i());let d=t.texShape;if(d==null&&(d=lie(i,l),t.texShape=d),o!=null){const f=qd(i);let h,p=d[1],m=d[0];const g=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!g)&&([p,m]=rc(d[0],d[1])),l?h=new lre(f,g):h=new DS(f,g);const v=g?[m,p]:d,x=this.makeTensorInfo(v,r),b=this.texData.get(x.dataId);g?b.usage=or.PIXELS:b.usage=or.UPLOAD,b.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),p,m,o);const w=[[m,p]],C=this.runWebGLProgram(h,[x],r,w,!0),$=this.texData.get(C.dataId);t.texShape=$.texShape,t.isPacked=$.isPacked,t.usage=$.usage,ae().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(t.texture=$.texture,t.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(x),c&&(this.uploadWaitMs+=_i()-u)}else{const f=this.acquireTexture(d,a,r,l);t.texture=f}}convertAndCacheOnCPU(e,t){const i=this.texData.get(e),{dtype:r}=i;return t!=null&&(i.values=Woe(t,r)),i.values}acquireTexture(e,t,i,r){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Ih(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const i=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(i)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await dN(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(cR(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:i,infLoc:r,nanLoc:o,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:l}=pR(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=i,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=s,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,i){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:s,channels:a}=e,l=ro().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,t,i,o,s,a);return ro().makeTensorFromDataId(c,t,i,l)}}Up.nextDataId=0;function Woe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let i=0;i<t.length;++i)t[i]=Math.round(n[i]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */o2()&&l2("webgl",()=>new Up,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oy=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Na{constructor(e,t,i){this.variableNames=["A","B"],this.outputShape=vt(t,i),this.enableShapeUniforms=bi(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wa=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class cc{constructor(e,t,i,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=vt(t,i);const o=this.outputShape.length;this.enableShapeUniforms=bi(o);let s="";if(r)if(o===0||he(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${qt(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Ii("coords",o);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function er(n){const{inputs:e,backend:t}=n,{x:i}=e;return t.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const Goe={kernelName:Ru,backendName:"webgl",kernelFunc:er};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ls(n){const{inputs:e,backend:t}=n,{real:i,imag:r}=e,o=t.makeTensorInfo(i.shape,"complex64"),s=t.texData.get(o.dataId),a=er({inputs:{x:i},backend:t}),l=er({inputs:{x:r},backend:t});return s.complexTensorInfos={real:a,imag:l},o}const Hoe={kernelName:Tx,backendName:"webgl",kernelFunc:Ls};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $R="return (a < 0.) ? b * a : a;",ER=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Uoe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{alpha:o}=i,s=t.makeTensorInfo([],"float32",Ds(o,"float32")),a=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cc(ER,r.shape,s.shape):new Na($R,r.shape,s.shape),l=t.runWebGLProgram(a,[r,s],"float32");return t.disposeIntermediateTensorInfo(s),l}const joe={kernelName:zf,backendName:"webgl",kernelFunc:Uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NR="return (a < 0.) ? b * a : a;",kR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Koe(n){const{inputs:e,backend:t}=n,{x:i,alpha:r}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cc(kR,i.shape,r.shape):new Na(NR,i.shape,r.shape);return t.runWebGLProgram(o,[i,r],"float32")}const Xoe={kernelName:rp,backendName:"webgl",kernelFunc:Koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uc="if (isnan(x)) return x;";function Ft({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:i}){return({inputs:r,backend:o})=>{const{x:s}=r,a=o,l=i||s.dtype;if(a.shouldExecuteOnCPU([s])&&t!=null){const d=a.texData.get(s.dataId),f=t(d.values,l);return a.makeTensorInfo(s.shape,l,f)}const c=ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new ds(s.shape,e):u=new ho(s.shape,n),a.runWebGLProgram(u,[s],l)}}function ri({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:i=!1,cpuKernelImpl:r,dtype:o}){return({inputs:s,backend:a})=>{const{a:l,b:c}=s,u=a;if(i&&l.dtype==="complex64"){const p=u.texData.get(l.dataId),m=u.texData.get(c.dataId),[g,v]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{const[w,y]=b,C={dataId:w.dataId,dtype:w.dtype,shape:l.shape},$={dataId:y.dataId,dtype:y.dtype,shape:c.shape},I=new Na(n,l.shape,c.shape);return u.runWebGLProgram(I,[C,$],Zi(w.dtype,y.dtype))}),x=Ls({inputs:{real:g,imag:v},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(v),x}const d=o||Zi(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&r!=null){const p=u.texData.get(l.dataId).values,m=u.texData.get(c.dataId).values,g=l.dtype==="string"?Xo(p):p,v=l.dtype==="string"?Xo(m):m,[x,b]=r(l.shape,c.shape,g,v,d),w=u.makeTensorInfo(b,d),y=u.texData.get(w.dataId);return y.values=x,w}const f=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let h;return f?h=new cc(e,l.shape,c.shape,t):h=new Na(n,l.shape,c.shape),u.runWebGLProgram(h,[l,c],d)}}function Zc(n,e=!1){if(n==="linear")return e?Doe:Ioe;if(n==="relu")return e?Roe:Eoe;if(n==="elu")return e?Toe:$oe;if(n==="relu6")return e?_oe:Noe;if(n==="prelu")return e?kR:NR;if(n==="leakyrelu")return e?ER:$R;if(n==="sigmoid")return e?Aoe:koe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DR{constructor(e,t,i,r=!1,o=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i,this.enableShapeUniforms=bi(this.outputShape.length);const u=r?e[1]:e[2],d=Math.ceil(u/2),f=r?"i * 2, rc.y":"rc.y, i * 2",h=o?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",v="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,v="result = activation(result);");const x=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";e[0]<t[0]?b=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(w=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${w};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${h});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${v}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class PS{constructor(e,t,i){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=vt(t,i),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MS="return a * b;";function sy(n){const{inputs:e,backend:t}=n,{a:i,b:r}=e,o=Zi(i.dtype,r.dtype);if(i.dtype==="complex64"){const a=t.texData.get(i.dataId),l=t.texData.get(r.dataId),c=new PS(OS.REAL,i.shape,r.shape),u=new PS(OS.IMAG,i.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:i.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],f=t.runWebGLProgram(c,d,"float32"),h=t.runWebGLProgram(u,d,"float32"),p=Ls({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([i,r])){const a=t.texData.get(i.dataId),l=t.texData.get(r.dataId),[c,u]=Kre(i.shape,r.shape,a.values,l.values,o),d=t.makeTensorInfo(u,o),f=t.texData.get(d.dataId);return f.values=c,d}let s;return ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new cc(MS,i.shape,r.shape):s=new Na(MS,i.shape,r.shape),t.runWebGLProgram(s,[i,r],o)}const qoe={kernelName:Bu,backendName:"webgl",kernelFunc:sy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yoe(n,e,t){const i=[zl(n.shape),...Bl(n.shape)],r={dtype:n.dtype,shape:i,dataId:n.dataId},o=[zl(e),...Bl(e)],s=new IR(o,i),a=!0,l=[i],c=t.runWebGLProgram(s,[r],n.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function De(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{shape:o}=i,s=t,a=he(r.shape),l=pE(o,a),c=he(l);F(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=s.texData.get(r.dataId);return u.isPacked&&!Jh(r.shape,l)&&!(u.texture!==null&&Jh(u.shape,l))?Yoe(r,l,s):(s.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const Joe={kernelName:sp,backendName:"webgl",kernelFunc:De};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FS{constructor(e,t){this.variableNames=["x"];const{windowSize:i,batchSize:r,inSize:o,outSize:s}=e;this.outputShape=[r,s];const a=Math.floor(i/4)*4,l=i%4;let c="sumValue += dot(values, ones);";if(t!=null){const d=1/t;c=`sumValue += dot(values * ${kl(d)?d.toPrecision(2):d}, ones);`}let u="";o%i>0&&(u=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zoe{constructor(e,t){this.variableNames=["x"];const{windowSize:i,batchSize:r,inSize:o,outSize:s}=e;this.outputShape=[r,s];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const u=Math.floor(i/4)*4,d=i%4;let f=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,h="vec4";t==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):t==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");let p="";o%i>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qoe(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],i=Dp(t);e.push({inSize:t,windowSize:i,outSize:Math.ceil(t/i)})}return e}function Ga(n,e,t,i){const r=Qoe(n.shape);let o=n;for(let s=0;s<r.length;s++){const{inSize:a,windowSize:l,outSize:c}=r[s];let u,d;t==="mean"?u=s===0?new FS({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},a):new FS({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c}):u=new Zoe({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},t),d=o,o=i.runWebGLProgram(u,[o],e),d.dataId!==n.dataId&&i.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ese{constructor(e,t){this.variableNames=["A"];const i=new Array(e.length);for(let s=0;s<i.length;s++)i[s]=e[t[s]];this.outputShape=i,this.rank=i.length;const r=qt(this.rank),o=tse(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function tse(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(e);for(let r=0;r<n.length;r++)i[n[r]]=t[r];return i.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nse{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const i=new Array(e.length);for(let u=0;u<i.length;u++)i[u]=e[t[u]];if(this.outputShape=i,this.rank=i.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=qt(this.rank),o=SR("rc",this.rank),s=new Array(this.rank);for(let u=0;u<t.length;u++)s[t[u]]=o[u];const a=`vec2(${s.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${i[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${i[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jp(n,e,t){const i=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nse(n.shape,e):new ese(n.shape,e);return t.runWebGLProgram(i,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(n,e,t,i){const r=e,o=n.shape.length,s=Ct(r,n.shape);let a=s;const l=xn(a,o),c=l!=null;let u=n;c&&(u=jp(n,l,i),a=Dn(a.length,o)),ii("sum",a,o);const[d,f]=Zn(u.shape,a);let h=d;t&&(h=Pn(d,s));const p=he(f),g=he(n.shape)/p,v=De({inputs:{x:u},attrs:{shape:[g,p]},backend:i}),x=d0(n.dtype),b=Ga(v,x,"sum",i),w=De({inputs:{x:b},attrs:{shape:h},backend:i});return i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(b),c&&i.disposeIntermediateTensorInfo(u),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kp(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i;return ise(r,o,s,t)}const rse={kernelName:hp,backendName:"webgl",kernelFunc:Kp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{perm:o}=i,s=t,a=r.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=r.shape[o[u]];let c;if(s.shouldExecuteOnCPU([r])){const d=s.texData.get(r.dataId).values,f=ry(d,r.shape,r.dtype,o,l);c=s.makeTensorInfo(l,r.dtype);const h=s.texData.get(c.dataId);h.values=f}else c=jp(r,o,s);return c}const ose={kernelName:ll,backendName:"webgl",kernelFunc:Ni};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TR=1e3;function Zh({a:n,b:e,transposeA:t,transposeB:i,backend:r,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){const c=n.shape.length,u=e.shape.length,d=t?n.shape[c-2]:n.shape[c-1],f=i?e.shape[u-1]:e.shape[u-2],h=t?n.shape[c-1]:n.shape[c-2],p=i?e.shape[u-2]:e.shape[u-1],m=n.shape.slice(0,-2),g=e.shape.slice(0,-2),v=he(m),x=he(g),w=vt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([h,p]);F(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${i} must match.`);const y=t?[v,d,h]:[v,h,d],C=i?[x,p,f]:[x,f,p],$=De({inputs:{x:n},backend:r,attrs:{shape:y}}),I=De({inputs:{x:e},backend:r,attrs:{shape:C}}),E=[$,I],N=Math.max(v,x),k=t?$.shape[1]:$.shape[2],D=o!=null,_=s!=null,R=l==="leakyrelu",T=l!=null?Zc(l,!0):null,A=D||_||R||T!=null;let O;if((h===1||p===1)&&k>TR&&A===!1){let M=$,z=I;t&&(M=Ni({inputs:{x:$},backend:r,attrs:{perm:[0,2,1]}}),E.push(M)),i&&(z=Ni({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),E.push(z));const L=p!==1,W=p===1;let U=M;L&&(U=De({inputs:{x:M},backend:r,attrs:{shape:[N,k,1]}}),E.push(U));const V=p===1?2:1;let H=z;W&&(H=De({inputs:{x:z},backend:r,attrs:{shape:[N,1,k]}}),E.push(H));const Y=sy({inputs:{a:U,b:H},backend:r});O=Kp({inputs:{x:Y},backend:r,attrs:{axis:V,keepDims:!0}}),E.push(Y)}else{const M=Zi(n.dtype,e.dtype),z=new DR(y,C,[N,h,p],t,i,D,T,_,R),L=[$,I];if(o!=null&&L.push(o),_&&L.push(s),R){const W=r.makeTensorInfo([],"float32",Ds(a,"float32"));L.push(W),E.push(W)}O=r.runWebGLProgram(z,L,M)}const P=De({inputs:{x:O},backend:r,attrs:{shape:w}});E.push(O);for(const M of E)r.disposeIntermediateTensorInfo(M);return P}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sse(n){const{inputs:e,backend:t,attrs:i}=n,{a:r,b:o,bias:s,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=i;return Zh({a:r,b:o,transposeA:l,transposeB:c,backend:t,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const ase={kernelName:$h,backendName:"webgl",kernelFunc:sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LS="return abs(x);";function lse(n){const{inputs:e,backend:t}=n,{x:i}=e;if(t.shouldExecuteOnCPU([i])&&i.dtype!=="complex64"){const o=t.texData.get(i.dataId),s=wR(o.values);return t.makeTensorInfo(i.shape,i.dtype,s)}let r;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ds(i.shape,LS):r=new ho(i.shape,LS),t.runWebGLProgram(r,[i],i.dtype)}const cse={kernelName:bf,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const use=Or+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,dse=Ft({opSnippet:use}),hse={kernelName:du,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=Or+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,pse=Ft({opSnippet:fse}),mse={kernelName:hu,backendName:"webgl",kernelFunc:pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zS="return a + b;",gse=ri({opSnippet:zS,packedOpSnippet:zS,supportsComplex:!0,cpuKernelImpl:Ere}),vse={kernelName:Zl,backendName:"webgl",kernelFunc:gse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xse{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,s)=>`T${s}`);const i=[];this.variableNames.forEach(o=>{i.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bse{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,s)=>`T${s}`);const i=[];this.variableNames.forEach(o=>{i.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uh(n){const{inputs:e,backend:t}=n,i=e;if(i.length===1)return er({inputs:{x:i[0]},backend:t});if(i.length>ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(i.length/2),c=uh({inputs:i.slice(0,l),backend:t}),u=uh({inputs:i.slice(l),backend:t});return uh({inputs:[c,u],backend:t})}const r=i.map(l=>l.dtype).reduce((l,c)=>Zi(l,c)),o=i.map(l=>l.shape),a=ae().getBool("WEBGL_PACK")?new bse(i[0].shape,o):new xse(i[0].shape,o);return t.runWebGLProgram(a,i,r)}const yse={kernelName:Sx,backendName:"webgl",kernelFunc:uh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i,a=r.shape.length,l=Ct(o,r.shape);let c=l;const u=xn(c,a);let d=r;u!=null&&(d=Ni({inputs:{x:r},backend:t,attrs:{perm:u}}),c=Dn(c.length,a)),ii("all",c,a);const[f,h]=Zn(d.shape,c),p=he(h),m=De({inputs:{x:d},backend:t,attrs:{shape:[-1,p]}}),g=Ga(m,m.dtype,"all",t);let v;if(s){const x=Pn(f,l);v=De({inputs:{x:g},backend:t,attrs:{shape:x}})}else v=De({inputs:{x:g},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),u!=null&&t.disposeIntermediateTensorInfo(d),v}const Cse={kernelName:Ix,backendName:"webgl",kernelFunc:wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i,a=r.shape.length,l=Ct(o,r.shape);let c=l;const u=xn(c,a);let d=r;u!=null&&(d=Ni({inputs:{x:r},backend:t,attrs:{perm:u}}),c=Dn(c.length,a)),ii("any",c,a);const[f,h]=Zn(d.shape,c),p=he(h),m=De({inputs:{x:d},backend:t,attrs:{shape:[-1,p]}}),g=Ga(m,m.dtype,"any",t);let v;if(s){const x=Pn(f,l);v=De({inputs:{x:g},backend:t,attrs:{shape:x}})}else v=De({inputs:{x:g},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),u!=null&&t.disposeIntermediateTensorInfo(d),v}const Ise={kernelName:$x,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $se{constructor(e,t,i){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:s}=e;i||this.variableNames.push("bestIndicesA"),this.outputShape=[o,s];const a=t==="max"?">":"<",l=i?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ese{constructor(e,t,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,F(e.length>2,()=>`Packed arg${i.charAt(0).toUpperCase()+i.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],s=Math.ceil(o/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=qt(l),u=Ii("coords",l);let d,f;if(s===1){f=l+1;const I=qt(f);d=`
        ${I} sourceLocR = ${I}(${u.join()}, 0);
        ++${u[l-1]};
        ${I} sourceLocG = ${I}(${u.join()}, 0);
        ++${u[l-2]};
        ${I} sourceLocA = ${I}(${u.join()}, 0);
        --${u[l-1]};
        ${I} sourceLocB = ${I}(${u.join()}, 0);
        --${u[l-2]};`}else f=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const h=["x","y","z","w","u","v"].slice(0,f),p="."+h[f-1],m=h.map(I=>"int "+I),g=Ii("sourceLocR",f-1).concat("inIdx.r"),v=Ii("sourceLocG",f-1).concat("inIdx.g"),x=Ii("sourceLocB",f-1).concat("inIdx.b"),b=Ii("sourceLocA",f-1).concat("inIdx.a"),w=i==="max"?"greaterThan":"lessThan",y=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,$=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${h.join()}),
                                          vec2(${h.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${h.join()}),
                               vec2(${h.slice(-2).join()}));
      }
      ${$}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${y}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RR(n,e,t,i=null){let r=e.shape[0],o=e.shape[1];i!=null&&(r=i.shape[0],o=i.shape[1]);const s=Dp(o),a={windowSize:s,inSize:o,batchSize:r,outSize:Math.ceil(o/s)},l=new $se(a,t,i==null),c=[e];i!=null&&c.push(i);const u=n.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=RR(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}function _R(n,e,t,i=null){const r=i!=null?i.shape:e.shape,o=r[r.length-1],s=Dp(o),a=new Ese(r,s,t,i==null),l=i==null?[e]:[e,i],c=n.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=_R(n,e,t,c);return n.disposeIntermediateTensorInfo(c),u}return c}function AR(n,e,t,i){const r=[t];if(ii("arg"+i.charAt(0).toUpperCase()+i.slice(1),r,e.shape.length),!ae().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],s=n.texData.get(e.dataId),a=s!==null&&s.isPacked;let l=e;a&&(l=n.unpackTensor(e),o.push(l));const[c,u]=Zn(l.shape,r),d=he(u),f=De({inputs:{x:l},backend:n,attrs:{shape:[-1,d]}});o.push(f);const h=RR(n,f,i);o.push(h);const p=De({inputs:{x:h},backend:n,attrs:{shape:c}});return o.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}return _R(n,e,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o}=i;let s=Ct(o,r.shape);const a=xn(s,r.shape.length);let l=r;const c=[];a!=null&&(l=Ni({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),s=Dn(s.length,l.shape.length)),ii("argMax",[s[0]],l.shape.length);const u=AR(t,l,s[0],"max");return c.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const kse={kernelName:yf,backendName:"webgl",kernelFunc:Nse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dse(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o}=i;let s=Ct(o,r.shape);const a=xn(s,r.shape.length);let l=r;const c=[];a!=null&&(l=Ni({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),s=Dn(s.length,l.shape.length)),ii("argMin",[s[0]],l.shape.length);const u=AR(t,l,s[0],"min");return c.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const Tse={kernelName:wf,backendName:"webgl",kernelFunc:Dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rse=Or+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_se=Ft({opSnippet:Rse}),Ase={kernelName:fu,backendName:"webgl",kernelFunc:_se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ose=Or+"return log(x + sqrt(x * x + 1.0));",Pse=Ft({opSnippet:Ose}),Mse={kernelName:pu,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse=Or+`
  return atan(x);
`,Lse=Ft({opSnippet:Fse}),zse={kernelName:mu,backendName:"webgl",kernelFunc:Lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bse=oy+`
  return atan(a, b);
`,Vse=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Wa+`
  return result;
`,Wse=ri({opSnippet:Bse,packedOpSnippet:Vse}),Gse={kernelName:vu,backendName:"webgl",kernelFunc:Wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hse=Or+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Use=Ft({opSnippet:Hse}),jse={kernelName:gu,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qc{constructor(e,t,i,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=t==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,v=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let x="0.0";if(m||(x="-1.0 / 1e-20"),i){const I=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${h}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${I} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?g:v:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let w=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(w="avgValue / max(count, 1.0)");const y=Math.floor(s/4)*4,C=s%4,$=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${h}, ${p});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${y}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${$}
          }

          int xC = xCCorner + ${y};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${$}
          }
        }
        setOutput(${w});
      }
    `}}class ay{constructor(e,t,i,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,v=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const b=t==="avg";let w="0.0";if(b||(w="-1.0 / 1e-20"),i){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${v}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${h};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const y="max";let C=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(C="avgValue / max(count, 1.0)");const $=Math.floor(s/4)*4,I=s%4,E=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${y}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${v}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${$}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${E}
            }

            int xC = xCCorner + ${$};
            if (${I===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${I===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${I===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${E}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e;Id(r,"avgPool");const{filterSize:o,strides:s,pad:a,dimRoundingMode:l}=i,c=1;F(vi(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=_r(r.shape,o,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Ht(u.inShape,u.outShape))return er({inputs:{x:r},backend:t});const d=new Qc(u,"avg",!1);return t.runWebGLProgram(d,[r],"float32")}const Xse={kernelName:Cf,backendName:"webgl",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{filterSize:o,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=i,u=[1,1,1],d=Qo(r.shape,o,s,u,a,l,c),f=new ay(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const Yse={kernelName:Sf,backendName:"webgl",kernelFunc:qse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jse{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,i=e.filterWidth,r=e.strideHeight,o=e.strideWidth,s=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,f=1/(t*i);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Zse{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,i=e.filterHeight,r=e.filterWidth,o=e.strideDepth,s=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=f-1-e.padInfo.top,g=h-1-e.padInfo.left,v=1/(t*i*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qse(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o}=e,s=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,d=[1,1,1],f=Qo(s.shape,a,l,d,c,u),h=new Zse(f);return t.runWebGLProgram(h,[r],s.dtype)}const eae={kernelName:Nx,backendName:"webgl",kernelFunc:Qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o}=e,s=o;Id([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=i,u=_r(s.shape,a,l,1,c),d=new Jse(u);return t.runWebGLProgram(d,[r],s.dtype)}const nae={kernelName:Ex,backendName:"webgl",kernelFunc:tae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(n){const{inputs:e,backend:t,attrs:i}=n,{a:r,b:o}=e,{transposeA:s,transposeB:a}=i;return Zh({a:r,b:o,transposeA:s,transposeB:a,backend:t})}const rae={kernelName:If,backendName:"webgl",kernelFunc:iae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oae{constructor(e,t,i,r,o,s){this.outputShape=[],this.variableNames=["x","mean","variance"],vt(e,t),vt(e,i);let a="0.0";r!=null&&(vt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(vt(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sae{constructor(e,t,i,r,o,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],vt(e,t),vt(e,i);let a="vec4(0.0)";r!=null&&(vt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(vt(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aae=({inputs:n,backend:e,attrs:t})=>{const{x:i,mean:r,variance:o,offset:s,scale:a}=n;F(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(s==null||r.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[i,r,o];let u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));const f=ae().getBool("WEBGL_PACK_NORMALIZATION")?new sae(i.shape,r.shape,o.shape,u,d,l):new oae(i.shape,r.shape,o.shape,u,d,l);return e.runWebGLProgram(f,c,c[0].dtype)},lae={kernelName:Mf,backendName:"webgl",kernelFunc:aae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cae{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=qt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const i=uae(this.rank);let r;const o=e.map((s,a)=>`sourceLoc.${Qg[a]} = start[${a}] + coords.${Qg[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${i}));
      }
    `}}const Qg=["x","y","z","w","u","v"];function uae(n){if(n===1)return"sourceLoc";if(n<=6)return Qg.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dae{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=qt(this.rank),i=Ii("coords",this.rank),r=Ii("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${s};
      if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${s};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${i[this.rank-1]};
      if (++${i[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${s};
        if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${r[d]} = ${i[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(n,e,t,i){const r=i.texData.get(n.dataId),o=i.makeTensorInfo(t,n.dtype),s=i.texData.get(o.dataId);Object.assign(s,r),s.refCount=1,s.shape=t,s.dtype=n.dtype;let a=tb(e,Qe(n.shape));r.slice&&(a+=r.slice.flatOffset),s.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=i.dataRefCount.get(s.slice.origDataId)||1;return i.dataRefCount.set(s.slice.origDataId,l+1),o}function dc(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{begin:o,size:s}=i,[a,l]=kp(r,o,s);if(Z0(r,a,l),he(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=t.texData.get(r.dataId),f=roe(d.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,f)}const{isPacked:c}=t.texData.get(r.dataId),u=eb(r.shape,a,l);if(c||!u){const d=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dae(l):new cae(l),f=[a];return t.runWebGLProgram(d,[r],r.dtype,f)}return t.uploadToGPU(r.dataId),hae(r,a,l,t)}const fae={kernelName:dp,backendName:"webgl",kernelFunc:dc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pae=n=>{const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{blockShape:o,crops:s}=i;F(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((x,b)=>x*b),l=dd(r.shape,o,a),c=hd(l.length,o.length),u=fd(r.shape,o,a),d=sb(s,o.length),f=ab(u,s,o.length),h=[],p=De({inputs:{x:r},backend:t,attrs:{shape:l}}),m=Ni({inputs:{x:p},backend:t,attrs:{perm:c}}),g=De({inputs:{x:m},backend:t,attrs:{shape:u}}),v=dc({inputs:{x:g},backend:t,attrs:{begin:d,size:f}});return h.push(p),h.push(m),h.push(g),h.forEach(x=>t.disposeIntermediateTensorInfo(x)),v},mae={kernelName:$f,backendName:"webgl",kernelFunc:pae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gae(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,weights:o}=e,{size:s}=i,a=t.readSync(r.dataId),l=t.readSync(o.dataId),c=yR(a,l,o.dtype,o.shape,s);return t.makeTensorInfo([s],o.dtype,c)}const vae={kernelName:kx,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xae=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,bae=`
  return float(int(a.r) & int(b.r));
`;function yae(n){const{inputs:e,backend:t}=n,{a:i,b:r}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=ae().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([i,r])||s===1){const l=t.texData.get(i.dataId).values,c=t.texData.get(r.dataId).values,[u,d]=kre(i.shape,r.shape,l,c,i.dtype),f=t.makeTensorInfo(d,i.dtype),h=t.texData.get(f.dataId);return h.values=u,f}let a;return o?a=new cc(xae,i.shape,r.shape,!1):a=new Na(bae,i.shape,r.shape),t.runWebGLProgram(a,[i,r],i.dtype)}const wae={kernelName:Dx,backendName:"webgl",kernelFunc:yae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cae(n){const{inputs:e,backend:t}=n,{s0:i,s1:r}=e,o=t.readSync(i.dataId),s=t.readSync(r.dataId),a=vt(Array.from(o),Array.from(s));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Sae={kernelName:yE,backendName:"webgl",kernelFunc:Cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iae="return float(a != b);",OR=ri({opSnippet:Iae,cpuKernelImpl:qre,dtype:"bool"}),$ae={kernelName:Qf,backendName:"webgl",kernelFunc:OR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ed(n){const{inputs:e,backend:t}=n,{input:i}=e,r=t.texData.get(i.dataId);return er({inputs:{x:r.complexTensorInfos.real},backend:t})}const Eae={kernelName:e0,backendName:"webgl",kernelFunc:Ed};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nae="return float(int(x));";function kae(n,e){const t=new ho(n.shape,Nae),i=e.runWebGLProgram(t,[n],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{dtype:o}=i;if(o==="complex64"){if(r.dtype==="complex64")return er({inputs:{x:r},backend:t});const s=Yn(r.shape),a=ev({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=Ls({inputs:{real:a,imag:s},backend:t});return s.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const s=Ed({inputs:{input:r},backend:t}),a=ev({inputs:{x:s},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(s),a}if(!mE(r.dtype,o)){const s=er({inputs:{x:r},backend:t});return{dataId:s.dataId,shape:s.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const s=t.texData.get(r.dataId).values,[a,l,c]=Dre(s,r.shape,r.dtype,o);return t.makeTensorInfo(a,l,c)}if(o==="int32")return kae(r,t);if(o==="bool"){const s=t.makeTensorInfo([],"bool",pi("bool",1)),l=OR({inputs:{a:r,b:s},backend:t});return t.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const Dae={kernelName:xu,backendName:"webgl",kernelFunc:ev};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS="return ceil(x);",Tae=Ft({opSnippet:BS,packedOpSnippet:BS,cpuKernelImpl:Tre}),Rae={kernelName:bu,backendName:"webgl",kernelFunc:Tae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ae{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oae(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{clipValueMin:o,clipValueMax:s}=i;let a;ae().getBool("WEBGL_PACK_CLIP")?a=new Aae(r.shape):a=new _ae(r.shape);const l=[[o],[s]];return t.runWebGLProgram(a,[r],r.dtype,l)}const Pae={kernelName:yu,backendName:"webgl",kernelFunc:Oae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mae{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VS(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Fae(n){const{inputs:e,backend:t}=n,{x:i}=e,r=t.texData.get(i.dataId),o=new Mae(i.shape),s=[VS(i,r.complexTensorInfos.real),VS(i,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,s,s[0].dtype)}const Lae={kernelName:Ef,backendName:"webgl",kernelFunc:Fae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zae{constructor(e){this.outputShape=[],this.outputShape=xo(e,1),this.variableNames=e.map((s,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let s=1;s<t.length;s++)t[s]=t[s-1]+e[s][1];const i=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<t.length;s++){const a=t[s-1];i.push(`else if (yC < ${t[s]}) setOutput(getT${s}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];i.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${i.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bae{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=xo(e,t);const i=this.outputShape,r=i.length,o=qt(r),s=Ii("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][t];const c=a[t],u=a.slice(-2),d=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];f+=`
        if (${c} < ${l[m]}  && ${c} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${Zd(a,c,g)}),
            vec2(${Zd(u,c,g)}));
        }`}const h=l.length,p=l[l.length-1];f+=`
        return getChannel(
          getT${h}(${Zd(a,c,p)}),
          vec2(${Zd(u,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[r-1]} = ${s[r-1]} + 1;
        if (${s[r-1]} < ${i[r-1]}) {
          result.g = getValue(${s});
        }

        ${s[r-2]} = ${s[r-2]} + 1;
        if (${s[r-2]} < ${i[r-2]}) {
          result.a = getValue(${s});
        }

        ${s[r-1]} = ${s[r-1]} - 1;
        if (${s[r-2]} < ${i[r-2]} &&
            ${s[r-1]} < ${i[r-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}}function Zd(n,e,t){const i=n.indexOf(e);return n.map((o,s)=>s===i?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xp(n){const{inputs:e,backend:t}=n,{input:i}=e,r=t.texData.get(i.dataId);return er({inputs:{x:r.complexTensorInfos.imag},backend:t})}const Vae={kernelName:jx,backendName:"webgl",kernelFunc:Xp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ec(n,e,t){const i=n[0].dtype;if(i==="complex64"){const h=n.map(x=>Ed({inputs:{input:x},backend:t})),p=n.map(x=>Xp({inputs:{input:x},backend:t})),m=Ec(h,e,t),g=Ec(p,e,t),v=Ls({inputs:{real:m,imag:g},backend:t});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),p.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),v}let r=t.shouldExecuteOnCPU(n);if(i==="string"&&(r=!0),r){const h=n.map(w=>{const C=[-1,he(w.shape.slice(e))];return De({inputs:{x:w},backend:t,attrs:{shape:C}})}),p=h.map(w=>({vals:t.readSync(w.dataId),shape:w.shape})),m=xo(h.map(w=>w.shape),1),g=h[0].shape[0]===1,v=Rre(p,m,i,g),x=xo(n.map(w=>w.shape),e),b=t.makeTensorInfo(x,i,v);return h.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}const o=n.filter(h=>he(h.shape)>0),s=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const h=s?new ho(n[0].shape,ss):new ds(n[0].shape,ss);return t.runWebGLProgram(h,n,i)}const a=ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const h=[];for(let m=0;m<o.length;m+=a){const g=o.slice(m,m+a);h.push(Ec(g,e,t))}const p=Ec(h,e,t);for(const m of h)t.disposeIntermediateTensorInfo(m);return p}if(s){const h=new Bae(o.map(p=>p.shape),e);return t.runWebGLProgram(h,o,i)}const{tensors2D:l,outShape:c}=Wae(o,e,t),u=new zae(l.map(h=>h.shape)),d=t.runWebGLProgram(u,l,i);l.forEach(h=>t.disposeIntermediateTensorInfo(h));const f=De({inputs:{x:d},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(d),f}function Wae(n,e,t){const i=xo(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>De({inputs:{x:o},attrs:{shape:[-1,he(o.shape.slice(e))]},backend:t})),outShape:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PR(n){const{inputs:e,backend:t,attrs:i}=n,{axis:r}=i,o=Ct(r,e[0].shape)[0],s=e.map(c=>c.shape);ib(s,o);const a=xo(e.map(c=>c.shape),o);if(he(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>he(c.shape)>0);return l.length===1?er({inputs:{x:l[0]},backend:t}):Ec(l,o,t)}const Gae={kernelName:Nf,backendName:"webgl",kernelFunc:PR};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MR{constructor(e,t=!1,i=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",v=g?1:2,x=g?2:3,b=g?3:1;let w="",y="";i&&(r?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:o?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:w=`
          float activation(float x) {
            ${i}
          }
        `,y="result = activation(result);");const C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${y}
        setOutput(result);
      }
    `}}class Hae{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,i=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,s=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,f=e.filterHeight,h=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${s}, ${a});
      const ivec3 pads = ivec3(${t}, ${i}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FR{constructor(e,t=!1,i=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=bi(this.outputShape.length);const s=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)f+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)f+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(d+1)/2;g++){const v=g*2;if(f+=`
           xC = xCCorner + ${v*l};
           `,a===1){if(v<u&&(s%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }
               `,l===1&&v>0?f+=`
                 xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                   } else {
                     xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xC${v} = xTexelC${v};
                 `,v+1<u)){const x=s%2===0?xx(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                     xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${v+1}.zw = vec2(0.0);
                     }
                     xTexelC${v+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                     } else {
                      xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                     }
                     `:f+=`
                     xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                     `):x===1?f+=`
                     xC${v+1} = xTexelC${v};
                     `:f+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                       xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${v+1}.zw = vec2(0.0);
                       }
                       xTexelC${v+1}Ready = 1;
                     }

                     xC${v+1} = xTexelC${v+1};
                     `}}else v<u&&(s%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.0);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
               `,v+1<u&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(
                   xTexelC${v}.xy, xTexelC${v+1}.xy);
               `,v+1<u&&(f+=`
                   xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                 `)));v<u&&(f+=`
             wTexel = getW(r, ${v}, d1, d2);
             dotProd += xC${v}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${v}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<u&&(f+=`
               wTexel = getW(r, ${v+1}, d1, d2);
               dotProd += xC${v+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${v+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let h="",p="";i&&(r?h=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${i}
         }`:o?h=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${i}
         }`:h=`vec4 activation(vec4 x) {
           ${i}
         }`,p="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${h}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uae{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=bi(this.outputShape.length);const{dataFormat:i}=t,r=Di(),o=i==="channelsLast",s=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qh(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function LR({x:n,filter:e,convInfo:t,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:a=null}){const l=n.shape,c=i.texData.get(n.dataId),u=t.inChannels,d=l[0]*l[1]*l[2],f=t.outChannels,h=t.dataFormat==="channelsLast",p=!1,m=!1;let g;const v=[];if(o!=null){const w=Qh(o.shape,h);w!=null&&(o=De({inputs:{x:o},backend:i,attrs:{shape:w}}),v.push(o))}if(r!=null){const w=Qh(r.shape,h);w!=null&&(r=De({inputs:{x:r},backend:i,attrs:{shape:w}}),v.push(r))}if(!((d===1||f===1)&&u>TR)&&c.isPacked&&h&&c.texture!=null&&l[2]%2!==0&&Ht(c.shape.slice(-3),l.slice(-3))){const w=l[0]*l[1]*(l[2]+1),y={dataId:n.dataId,shape:[1,w,t.inChannels],dtype:n.dtype},C=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,F(Jh(c.shape,y.shape),()=>`packed reshape ${c.shape} to ${y.shape} isn't free`);const $=De({inputs:{x:e},backend:i,attrs:{shape:[1,t.inChannels,t.outChannels]}});v.push($);const I=Zh({a:y,b:$,backend:i,transposeA:p,transposeB:m,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:s}),E=i.texData.get(I.dataId);F(E.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=C,E.shape=t.outShape,g=er({inputs:{x:I},backend:i}),g.shape=t.outShape,v.push(I)}else{const w=t.outHeight*t.outWidth,y=De({inputs:{x:n},backend:i,attrs:{shape:h?[t.batchSize,w,t.inChannels]:[t.batchSize,t.inChannels,w]}}),C=De({inputs:{x:e},backend:i,attrs:{shape:[1,t.inChannels,t.outChannels]}}),$=Zh({a:h?y:C,b:h?C:y,transposeA:!h,transposeB:m,backend:i,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:s});g=De({inputs:{x:$},backend:i,attrs:{shape:t.outShape}}),v.push(y),v.push(C),v.push($)}for(const w of v)i.disposeIntermediateTensorInfo(w);return g}function zR({x:n,filter:e,convInfo:t,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:f,dataFormat:h}=t,p=h==="channelsLast",m=l*c*u,g=f*d,v=[t.batchSize,m,g],x=!0,b=!1,w=[];if(o!=null){const P=Qh(o.shape,p);P!=null&&(o=De({inputs:{x:o},backend:i,attrs:{shape:P}}),w.push(o))}if(r!=null){const P=Qh(r.shape,p);P!=null&&(r=De({inputs:{x:r},backend:i,attrs:{shape:P}}),w.push(r))}const y=De({inputs:{x:e},backend:i,attrs:{shape:[1,m,he(e.shape)/m]}});w.push(y);const C=new Uae(v,t),$=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],I=i.runWebGLProgram(C,[n],"float32",$),E=De({inputs:{x:I},backend:i,attrs:{shape:v}});w.push(I),w.push(E);const N=r!=null,k=o!=null,D=a==="leakyrelu",_=a?Zc(a,!0):null,R=new DR(p?E.shape:y.shape,p?y.shape:E.shape,p?[t.batchSize,g,t.outChannels]:[t.batchSize,t.outChannels,g],x,b,N,_,k,D),T=p?[E,y]:[y,E];if(r&&T.push(r),k&&T.push(o),D){const P=i.makeTensorInfo([],"float32",Ds(s,"float32"));T.push(P),w.push(P)}const A=i.runWebGLProgram(R,T,"float32"),O=De({inputs:{x:A},backend:i,attrs:{shape:t.outShape}});w.push(A);for(const P of w)i.disposeIntermediateTensorInfo(P);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=i,d=es(l),f=ni(r.shape,o.shape,s,c,a,u,!1,d);let h;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))h=LR({x:r,filter:o,convInfo:f,backend:t});else if(f.strideWidth<=2&&d==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const m=new FR(f),g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];h=t.runWebGLProgram(m,[r,o],"float32",g)}else if(ae().getBool("WEBGL_CONV_IM2COL"))h=zR({x:r,filter:o,convInfo:f,backend:t});else{const m=new MR(f);h=t.runWebGLProgram(m,[r,o],"float32")}const p=De({inputs:{x:h},backend:t,attrs:{shape:f.outShape}});return t.disposeIntermediateTensorInfo(h),p}const Kae={kernelName:kf,backendName:"webgl",kernelFunc:jae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xae{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,i=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qae{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,i=e.filterWidth,r=e.strideHeight,o=e.strideWidth,s=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=i-1-e.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Yae{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,i=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,s=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${i} - ${s};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Jae{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,i=e.filterHeight,r=e.filterWidth,o=e.strideDepth,s=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,c=i-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${i}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${i} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,dy:o}=e,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=i,d=es(l),f=ni(r.shape,u,s,1,a,c,!1,d),h=new Xae(f);return t.runWebGLProgram(h,[r,o],"float32")}const Qae={kernelName:Rx,backendName:"webgl",kernelFunc:Zae};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ele{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=bi(this.outputShape.length);const t=e.filterHeight,i=e.filterWidth,r=t-1-e.padInfo.top,o=i-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            int wCPerm = ${i} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,filter:o}=e,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=i,d=es(c),f=ni(s,o.shape,a,1,l,u,!1,d);if(ae().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const h=[[f.strideHeight,f.strideWidth]],p=new ele(f);return t.runWebGLProgram(p,[r,o],"float32",h)}else{const h=new qae(f);return t.runWebGLProgram(h,[r,o],"float32")}}const nle={kernelName:Df,backendName:"webgl",kernelFunc:tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ile(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dilations:l}=i,c=Rs(r.shape,o.shape,s,l,a),u=new Hae(c);return t.runWebGLProgram(u,[r,o],"float32")}const rle={kernelName:Tf,backendName:"webgl",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,dy:o}=e,{strides:s,pad:a,filterShape:l}=i,c=Rs(r.shape,l,s,1,a),u=new Yae(c);return t.runWebGLProgram(u,[r,o],"float32")}const sle={kernelName:_x,backendName:"webgl",kernelFunc:ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,filter:o}=e,{pad:s,strides:a,inputShape:l}=i,c=Rs(l,o.shape,a,1,s),u=new Jae(c);return t.runWebGLProgram(u,[r,o],"float32")}const lle={kernelName:Ax,backendName:"webgl",kernelFunc:ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cle=uc+`
  return cos(x);
`,ule=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Wa}
  return result;
`,dle=Ft({opSnippet:cle,packedOpSnippet:ule}),hle={kernelName:wu,backendName:"webgl",kernelFunc:dle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fle=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,ple=Ft({opSnippet:fle}),mle={kernelName:Cu,backendName:"webgl",kernelFunc:ple};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gle{constructor(e,t,i,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,a,l,c]=e,[u]=t,[d,f]=i;this.outputShape=[u,d,f,c];const h=r==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[g,v,x]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,w,y]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${w};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${y};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${h} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vle=n=>{const{inputs:e,backend:t,attrs:i}=n,{image:r,boxes:o,boxInd:s}=e,{cropSize:a,method:l,extrapolationValue:c}=i,u=new gle(r.shape,o.shape,a,l,c);return t.runWebGLProgram(u,[r,o,s],"float32")},xle={kernelName:Px,backendName:"webgl",kernelFunc:vle};var eu;(function(n){n.Prod="*",n.Sum="+"})(eu||(eu={}));class WS{constructor(e,t,i,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,s=this.op===eu.Prod?"1.0":"0.0",a=i?s:`getX(${GS(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";i?(c=r?`end != ${l-1}`:"end != 0",u=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${qt(o)} coords = getOutputCoords();
        int end = ${HS(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${HS(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${GS(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function GS(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function HS(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n,e,t,i,r,o){const s=e.shape.length,a=xn([i],s);let l=e;a!=null&&(l=Ni({inputs:{x:e},backend:t,attrs:{perm:a}}));const c=Dn(1,s)[0];if(c!==s-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${i}`);const u=l.shape[c];let d=er({inputs:{x:l},backend:t});for(let f=0;f<=Math.ceil(Math.log2(u))-1;f++){const h=new WS(n,l.shape,!1,o),p=[[f]],m=d;d=t.runWebGLProgram(h,[d],d.dtype,p),t.disposeIntermediateTensorInfo(m)}if(r){const f=new WS(n,l.shape,r,o),h=d;d=t.runWebGLProgram(f,[d],d.dtype),t.disposeIntermediateTensorInfo(h)}if(a!=null){const f=_s(a),h=Ni({inputs:{x:d},backend:t,attrs:{perm:f}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(l),h}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,exclusive:s,reverse:a}=i;return BR(eu.Prod,r,t,o,s,a)}const yle={kernelName:Ox,backendName:"webgl",kernelFunc:ble};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,exclusive:s,reverse:a}=i;return BR(eu.Sum,r,t,o,s,a)}const Cle={kernelName:Rf,backendName:"webgl",kernelFunc:wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,weights:o}=e,{size:s,binaryOutput:a}=i;if(r.shape.length===1){const l=t.readSync(r.dataId),c=t.readSync(o.dataId),u=yR(l,c,o.dtype,o.shape,s);return t.makeTensorInfo([s],o.dtype,u)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(o),u=Nre(l,c,s,a);return t.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Ile={kernelName:Mx,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $le{constructor(e,t,i){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=i,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{blockSize:o,dataFormat:s}=i,a=r.shape[0],l=s==="NHWC"?r.shape[1]:r.shape[2],c=s==="NHWC"?r.shape[2]:r.shape[3],u=s==="NHWC"?r.shape[3]:r.shape[1],d=l*o,f=c*o,h=u/(o*o),p=s==="NHWC"?[a,d,f,h]:[a,h,d,f],m=new $le(p,o,s);return t.runWebGLProgram(m,[r],r.dtype)}const Nle={kernelName:Fx,backendName:"webgl",kernelFunc:Ele};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VR{constructor(e,t=!1,i=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=bi(this.outputShape.length);const s=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";i&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:o?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:c=`
          float activation(float x) {
            ${i}
          }
        `,u="result = activation(result);");const d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WR{constructor(e,t=!1,i=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=bi(this.outputShape.length);const s=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let h=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)h+=`
          vec4 xTexelC${v*2};
          int xTexelC${v*2}Ready;
          vec4 xTexelC${v*2+1};
          int xTexelC${v*2+1}Ready;
          vec4 xC${v};`;h+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let v=0;v<d;v++)h+=`
          xTexelC${v*2} = vec4(0.0);
          xTexelC${v*2}Ready = 0;
          xTexelC${v*2+1} = vec4(0.0);
          xTexelC${v*2+1}Ready = 0;
          xC${v} = vec4(0.0);`;h+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let v=0;v<(f+1)/2;v++){const x=v*2;if(h+=`
          xC = xCCorner + ${x*c};
          `,l===1){if(x<d&&(a%2===1?(h+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,c===1&&x>0?h+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:h+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):h+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<d)){const b=a%2===0?xx(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(h+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,c>1?h+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:h+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):b===1?h+=`
                    xC${x+1} = xTexelC${x};
                    `:h+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<d&&(a%2===1?(h+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<d&&(h+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(h+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<d&&(h+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<d&&(h+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<d&&(h+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}h+=`
    }
  `,h+=`
      }
    `;let p="",m="";i&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:o?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:p=`vec4 activation(vec4 x) {
          ${i}
        }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${h}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kle(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=i;let u=l;u==null&&(u=[1,1]),F(vi(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);const d=ni(r.shape,o.shape,s,u,a,c,!0);let f;ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new WR(d):f=new VR(d);const h=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return t.runWebGLProgram(f,[r,o],"float32",h)}const Dle={kernelName:_f,backendName:"webgl",kernelFunc:kle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tle{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,i=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Rle{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,i=e.filterWidth,r=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.top,a=i-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,dy:o}=e,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=i,d=ni(r.shape,u,s,a,l,c,!0),f=new Tle(d);return t.runWebGLProgram(f,[r,o],"float32")}const Ale={kernelName:Lx,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ole(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,filter:o}=e,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=i,d=ni(u,o.shape,s,a,l,c,!0),f=new Rle(d);return t.runWebGLProgram(f,[r,o],"float32")}const Ple={kernelName:zx,backendName:"webgl",kernelFunc:Ole};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mle{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(n){const{inputs:e,backend:t}=n,{x:i}=e,r=[...i.shape,...i.shape],o=he(i.shape),s=De({inputs:{x:i},backend:t,attrs:{shape:[o]}}),a=new Mle(o),l=t.runWebGLProgram(a,[s],s.dtype),c=De({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(l),c}const Lle={kernelName:wE,backendName:"webgl",kernelFunc:Fle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zle{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:i,padInfo:r,strideHeight:o,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${s});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${i}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o}=e,{strides:s,pad:a,dilations:l}=i,c=sd(r.shape,o.shape,s,a,"NHWC",l);let u;const d=new zle(c);u=t.runWebGLProgram(d,[r,o],"float32");const f=De({inputs:{x:u},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(u),f}const Vle={kernelName:Af,backendName:"webgl",kernelFunc:Ble};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(n){const{inputs:e,backend:t,attrs:i}=n,{equation:r}=i,o=e,{allDims:s,summedDims:a,idDims:l}=mb(r,o.length);vb(s.length,l,o);const{path:c,steps:u}=xb(a,l),d=u.length;let f=null,h=s.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:v,expandDims:x}=gb(h,l[g]);let b;bb(v)?b=o[g]:(b=Ni({inputs:{x:o[g]},backend:t,attrs:{perm:v}}),p.push(b));const w=b.shape.slice();for(let y=0;y<x.length;++y)w.splice(x[y],0,1);Ht(b.shape,w)||(b=De({inputs:{x:b},backend:t,attrs:{shape:w}}),p.push(b)),f===null?f=b:(f=sy({inputs:{a:b,b:f},backend:t}),p.push(f))}m<d-1&&(c[m]>=0&&(f=Kp({inputs:{x:f},backend:t,attrs:{axis:c[m]-(s.length-h),keepDims:!1}}),p.push(f)),h--)}for(const m of p)m!==f&&t.disposeIntermediateTensorInfo(m);return f}const Gle={kernelName:Bx,backendName:"webgl",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hle="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ule=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,jle=Ft({opSnippet:Hle,packedOpSnippet:Ule}),Kle={kernelName:Iu,backendName:"webgl",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle="return (b >= 0.0) ? a : a * (b + 1.0);",qle=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Yle=n=>{const{inputs:e,backend:t}=n,{dy:i,y:r}=e,o=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cc(qle,i.shape,r.shape):new Na(Xle,i.shape,r.shape);return t.runWebGLProgram(o,[i,r],i.dtype)},Jle={kernelName:Vx,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zle=`
  return vec4(equal(a, b));
`,Qle="return float(a == b);",ece=ri({opSnippet:Qle,packedOpSnippet:Zle,dtype:"bool",cpuKernelImpl:_re}),tce={kernelName:Of,backendName:"webgl",kernelFunc:ece};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${lb};
  float a1 = ${cb};
  float a2 = ${ub};
  float a3 = ${db};
  float a4 = ${hb};
  float a5 = ${fb};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,ice=Ft({opSnippet:nce}),rce={kernelName:$u,backendName:"webgl",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=uc+`
  return exp(x);
`,sce=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,GR=Ft({opSnippet:oce,packedOpSnippet:sce,cpuKernelImpl:Are,dtype:"float32"}),ace={kernelName:Eu,backendName:"webgl",kernelFunc:GR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tv(n){const{inputs:e,attrs:t,backend:i}=n,{dim:r}=t,{input:o}=e,s=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(F(-(s+1)<=r,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+r+1),a.splice(l,0,1),De({inputs:{x:o},backend:i,attrs:{shape:a}})}const lce={kernelName:Pf,backendName:"webgl",kernelFunc:tv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const US="return exp(x) - 1.0;",cce=Ft({opSnippet:US,packedOpSnippet:US,cpuKernelImpl:Ore}),uce={kernelName:Nu,backendName:"webgl",kernelFunc:cce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jS{constructor(e,t,i){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=i?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=i?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HR(n,e,t){const i=t.texData.get(n.dataId),r=he(n.shape),o=n.shape[n.shape.length-1],s=r/o,a=De({inputs:{x:n},backend:t,attrs:{shape:[s,o]}}),l=a.shape,c=new jS("real",l,e),u=new jS("imag",l,e),d=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:l},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:l}],f=t.runWebGLProgram(c,d,"float32"),h=t.runWebGLProgram(u,d,"float32"),p=Ls({inputs:{real:f,imag:h},backend:t});t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h);const m=De({inputs:{x:p},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(n){const{inputs:e,backend:t}=n,{input:i}=e;return HR(i,!1,t)}const hce={kernelName:Wx,backendName:"webgl",kernelFunc:dce};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fce{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(n){const{backend:e,attrs:t}=n,{shape:i,value:r}=t;let{dtype:o}=t;if(o=o||Yl(r),o==="string"){const s=Sn(o,he(i));return s.fill(r),e.makeTensorInfo(i,o,s)}else{const s=new fce(i,r),a=[[r]];return e.runWebGLProgram(s,[],o,a)}}const pce={kernelName:Gx,backendName:"webgl",kernelFunc:Nd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mce{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce={kernelName:Hx,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,i=e,r=new mce(t.shape);return i.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS="return floor(x);",vce=Ft({opSnippet:KS,packedOpSnippet:KS,cpuKernelImpl:Pre}),xce={kernelName:ku,backendName:"webgl",kernelFunc:vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bce=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,yce=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,wce=ri({opSnippet:bce,packedOpSnippet:yce,dtype:"int32"}),Cce={kernelName:Du,backendName:"webgl",kernelFunc:wce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sce{constructor(e){this.variableNames=["A"];const t=Di(),[i,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${i}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ice{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Di(),[i,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${i}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ce={kernelName:EH,backendName:"webgl",kernelFunc:Ece};let qa,Lm=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Ece(n){const{inputs:e,backend:t,attrs:i}=n;let{pixels:r}=e;const{numChannels:o}=i,s=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=s?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],d=[c,l,o];if(a||s){const m=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(qa==null||m!==Lm)&&(Lm=m,qa=document.createElement("canvas").getContext("2d",{willReadFrequently:Lm})),qa.canvas.width=l,qa.canvas.height=c,qa.drawImage(r,0,0,l,c),r=qa.canvas}const f=t.makeTensorInfo(u,"int32");t.texData.get(f.dataId).usage=or.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),r);const h=ae().getBool("WEBGL_PACK")?new Ice(d):new Sce(d),p=t.runWebGLProgram(h,[f],"int32");return t.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o,bias:s,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=i,m=es(u),g=ni(r.shape,o.shape,l,d,c,f,!1,m);let v;const x=[],b=s!=null,w=a!=null,y=h==="leakyrelu",C=()=>{const I=[r,o],E=(N,k)=>{if(k==="NCHW"&&N.shape.length===1&&N.shape[0]!==1){const D=De({inputs:{x:N},backend:t,attrs:{shape:[N.shape[0],1,1]}});return x.push(D),D}return N};if(b&&I.push(E(s,u)),w&&I.push(E(a,u)),y){const N=t.makeTensorInfo([],"float32",Ds(p,"float32"));I.push(N),x.push(N)}return I};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))v=LR({x:r,filter:o,convInfo:g,backend:t,bias:s,activation:h,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const I=h?Zc(h,!0):null,E=new FR(g,b,I,w,y),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],k=C();v=t.runWebGLProgram(E,k,"float32",N)}else if(ae().getBool("WEBGL_CONV_IM2COL"))v=zR({x:r,filter:o,convInfo:g,backend:t,bias:s,activation:h,preluActivationWeights:a,leakyreluAlpha:p});else{const I=h?Zc(h,!1):null,E=new MR(g,b,I,w,y),N=C();v=t.runWebGLProgram(E,N,"float32")}const $=De({inputs:{x:v},backend:t,attrs:{shape:g.outShape}});return x.push(v),x.forEach(I=>t.disposeIntermediateTensorInfo(I)),$}const kce={kernelName:Eh,backendName:"webgl",kernelFunc:Nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,filter:o,bias:s,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:f,leakyreluAlpha:h}=i,p=[];let m=u;m==null&&(m=[1,1]),F(vi(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=ni(r.shape,o.shape,l,m,c,d,!0),v=ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=f?Zc(f,v):null,b=[r,o],w=s!=null,y=a!=null,C=f==="leakyrelu";if(w&&b.push(s),y&&b.push(a),C){const N=t.makeTensorInfo([],"float32",Ds(h,"float32"));b.push(N),p.push(N)}let $;v?$=new WR(g,w,x,y,C):$=new VR(g,w,x,y,C);const I=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],E=t.runWebGLProgram($,b,"float32",I);return p.forEach(N=>t.disposeIntermediateTensorInfo(N)),E}const Tce={kernelName:BE,backendName:"webgl",kernelFunc:Dce};class Rce{constructor(e,t,i,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=i;const o=qt(i.length);let s=`
    int index;`;for(let a=0;a<this.sliceDim;a++)s+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ce(n){const{inputs:e,backend:t}=n,{params:i,indices:r}=e,o=r.shape,s=o[o.length-1],a=he(i.shape),[l,c,u,d]=J0(i,r),f=De({inputs:{x:r},backend:t,attrs:{shape:[c,s]}}),h=De({inputs:{x:i},backend:t,attrs:{shape:[he(i.shape)/u,u]}});if(t.shouldExecuteOnCPU([i,r])||i.dtype==="string"){const v=t.readSync(r.dataId),x=t.bufferSync(i),b=Mre(v,x,i.dtype,c,s,u,d,i.shape,a);return t.makeTensorInfo(l,i.dtype,b.values)}const p=new Rce(s,d,[c,u],i.shape),m=t.runWebGLProgram(p,[h,f],h.dtype),g=De({inputs:{x:m},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(m),g}const Ace={kernelName:CE,backendName:"webgl",kernelFunc:_ce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oce{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const i=qt(this.rank),r=Pce(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Pce(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let r=0;r<n.length;r++)r===2?i.push("index"):i.push(`${t[r]}`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UR(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,indices:o}=e,{axis:s,batchDims:a}=i,l=Ct(s,r.shape)[0];if(ae().get("DEBUG")){const x=t.readSync(o.dataId),b=r.shape[l];for(let w=0;w<x.length;++w){const y=x[w];F(y<=b-1&&y>=0,()=>`GatherV2: the index value ${y} is not in [0, ${b-1}]`)}}const c=wb(r,o,l,a),u=he(o.shape),d=[],f=De({inputs:{x:r},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),h=De({inputs:{x:o},backend:t,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(f),d.push(h);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const x=t.bufferSync(h),b=t.bufferSync(f),w=Fre(b,x,p);return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(c.outputShape,w.dtype,w.values)}const m=new Oce(f.shape,p),g=t.runWebGLProgram(m,[f,h],f.dtype);d.push(g);const v=De({inputs:{x:g},backend:t,attrs:{shape:c.outputShape}});return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),v}const Mce={kernelName:Ff,backendName:"webgl",kernelFunc:UR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce="return float(a > b);",Lce=`
  return vec4(greaterThan(a, b));
`,zce=ri({opSnippet:Fce,packedOpSnippet:Lce,cpuKernelImpl:Lre,dtype:"bool"}),Bce={kernelName:Lf,backendName:"webgl",kernelFunc:zce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce="return float(a >= b);",Wce=`
  return vec4(greaterThanEqual(a, b));
`,Gce=ri({opSnippet:Vce,packedOpSnippet:Wce,dtype:"bool",cpuKernelImpl:zre}),Hce={kernelName:Tu,backendName:"webgl",kernelFunc:Gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uce(n){const{inputs:e,backend:t}=n,{input:i}=e;return HR(i,!0,t)}const jce={kernelName:Ux,backendName:"webgl",kernelFunc:Uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kce="return float(!isnan(x) && !isinf(x));",Xce=Ft({opSnippet:Kce,dtype:"bool"}),qce={kernelName:_u,backendName:"webgl",kernelFunc:Xce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yce="return float(isinf(x));",Jce=Ft({opSnippet:Yce,dtype:"bool"}),Zce={kernelName:Au,backendName:"webgl",kernelFunc:Jce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qce="return float(isnan(x));",eue=Ft({opSnippet:Qce,dtype:"bool"}),tue={kernelName:Ou,backendName:"webgl",kernelFunc:eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue="return float(a < b);",iue=`
  return vec4(lessThan(a, b));
`,rue=ri({opSnippet:nue,packedOpSnippet:iue,cpuKernelImpl:Bre,dtype:"bool"}),oue={kernelName:Bf,backendName:"webgl",kernelFunc:rue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue="return float(a <= b);",aue=`
  return vec4(lessThanEqual(a, b));
`,lue=ri({opSnippet:sue,packedOpSnippet:aue,cpuKernelImpl:Vre,dtype:"bool"}),cue={kernelName:Vf,backendName:"webgl",kernelFunc:lue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(n){const{backend:e,attrs:t}=n,{start:i,stop:r,num:o}=t,s=Wre(i,r,o);return e.makeTensorInfo([s.length],"float32",s)}const due={kernelName:SE,backendName:"webgl",kernelFunc:uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue=uc+`
  return x < 0.0 ? 0./0. : log(x);
`,fue=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,pue=Ft({opSnippet:hue,packedOpSnippet:fue,cpuKernelImpl:Gre}),mue={kernelName:Pu,backendName:"webgl",kernelFunc:pue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gue=uc+`
  return log(1.0 + x);
`,vue=Ft({opSnippet:gue}),xue={kernelName:Mu,backendName:"webgl",kernelFunc:vue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bue="return float(a >= 1.0 && b >= 1.0);",yue=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,wue=ri({opSnippet:bue,packedOpSnippet:yue,dtype:"bool"}),Cue={kernelName:Wf,backendName:"webgl",kernelFunc:wue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sue="return float(!(x >= 1.0));",Iue=Ft({opSnippet:Sue}),$ue={kernelName:Gf,backendName:"webgl",kernelFunc:Iue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eue="return float(a >= 1.0 || b >= 1.0);",Nue=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,kue=ri({opSnippet:Eue,packedOpSnippet:Nue,dtype:"bool"}),Due={kernelName:Hf,backendName:"webgl",kernelFunc:kue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tue{constructor(e,t,i,r,o){this.variableNames=["x"],this.outputShape=[];const s=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${i}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rue{constructor(e,t,i,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${i}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ue=n=>{const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{depthRadius:o,bias:s,alpha:a,beta:l}=i,c=ae().getBool("WEBGL_PACK_NORMALIZATION")?new Rue(r.shape,o,s,a,l):new Tue(r.shape,o,s,a,l);return t.runWebGLProgram(c,[r],r.dtype)},Aue={kernelName:Uf,backendName:"webgl",kernelFunc:_ue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oue{constructor(e,t,i,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=i,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${i});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue=n=>{const{inputs:e,backend:t,attrs:i}=n,{x:r,y:o,dy:s}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=i,d=new Oue(r.shape,a,l,c,u);return t.runWebGLProgram(d,[r,o,s],r.dtype)},Mue={kernelName:Kx,backendName:"webgl",kernelFunc:Pue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fue(n,e,t,i){const r=he(e),s=he(n.shape)/r,a=De({inputs:{x:n},attrs:{shape:[s,r]},backend:i}),l=Ga(a,n.dtype,"max",i),c=De({inputs:{x:l},attrs:{shape:t},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{reductionIndices:o,keepDims:s}=i,a=r.shape.length,l=Ct(o,r.shape);let c=l;const u=xn(c,a),d=u!=null,f=t.shouldExecuteOnCPU([r]);let h=r;if(d){if(f){const b=t.texData.get(h.dataId).values,w=new Array(a);for(let $=0;$<w.length;$++)w[$]=r.shape[u[$]];const y=ry(b,r.shape,r.dtype,u,w);h=t.makeTensorInfo(w,r.dtype);const C=t.texData.get(h.dataId);C.values=y}else h=jp(r,u,t);c=Dn(c.length,a)}ii("max",c,a);const[p,m]=Zn(h.shape,c);let g=p;s&&(g=Pn(p,l));let v;if(f){const b=t.texData.get(h.dataId).values,w=Hre(b,he(m),g,r.dtype);v=t.makeTensorInfo(g,r.dtype);const y=t.texData.get(v.dataId);y.values=w}else v=Fue(h,m,g,t);return d&&t.disposeIntermediateTensorInfo(h),v}const Lue={kernelName:jf,backendName:"webgl",kernelFunc:jR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zue=oy+`
  return max(a, b);
`,Bue=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Wa+`
  return result;
`,Vue=ri({opSnippet:zue,packedOpSnippet:Bue,cpuKernelImpl:Ure}),Wue={kernelName:Fu,backendName:"webgl",kernelFunc:Vue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e;Id(r,"maxPool");const{filterSize:o,strides:s,pad:a,dimRoundingMode:l}=i,c=1;F(vi(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=_r(r.shape,o,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Ht(u.inShape,u.outShape))return er({inputs:{x:r},backend:t});const d=new Qc(u,"max",!1);return t.runWebGLProgram(d,[r],r.dtype)}const Hue={kernelName:Kf,backendName:"webgl",kernelFunc:Gue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{filterSize:o,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=i,u=[1,1,1],d=Qo(r.shape,o,s,u,a,c,l),f=new ay(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const jue={kernelName:Xf,backendName:"webgl",kernelFunc:Uue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kue{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,i=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,s=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Xue{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,i=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,f=c-1-e.padInfo.top,h=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o}=e,s=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,d=[1,1,1],f=Qo(s.shape,a,l,d,c,u),h=new ay(f,"max",!0),p=t.runWebGLProgram(h,[s],s.dtype),m=new Xue(f),g=t.runWebGLProgram(m,[r,p],s.dtype);return t.disposeIntermediateTensorInfo(p),g}const Yue={kernelName:qx,backendName:"webgl",kernelFunc:que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jue(n){const{inputs:e,backend:t,attrs:i}=n,{dy:r,input:o,output:s}=e,a=o;Id([o,s],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=i,f=_r(a.shape,l,c,1,u,d),h=!0,p=new Qc(f,"max",h),m=t.runWebGLProgram(p,[a],a.dtype),g=new Kue(f),v=t.runWebGLProgram(g,[r,m],a.dtype);return t.disposeIntermediateTensorInfo(m),v}const Zue={kernelName:Xx,backendName:"webgl",kernelFunc:Jue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(n,e,t,i){let r=new Qc(t,"max",!1);const o=i.runWebGLProgram(r,[n],"float32");r=new Qc(t,"max",!0,!0,e);const s=i.runWebGLProgram(r,[n],"float32");return[o,s]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ede={kernelName:IE,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:i}=n,{filterSize:r,strides:o,pad:s,includeBatchInIndex:a}=e,l=t;F(i.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const c=[1,1];F(vi(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=_r(i.shape,r,o,c,s),[d,f]=Que(i,a,u,l);return[d,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tde(n,e,t,i){const r=he(e),s=he(n.shape)/r,a=De({inputs:{x:n},attrs:{shape:[s,r]},backend:i}),l=Ga(a,"float32","mean",i),c=De({inputs:{x:l},attrs:{shape:t},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nde={kernelName:qf,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:i}=n,{keepDims:r,axis:o}=e,s=t,a=i.shape.length,l=Ct(o,i.shape);let c=l;const u=xn(c,a),d=u!=null,f=s.shouldExecuteOnCPU([i]),h=[];let p=i;if(d){if(f){const w=s.texData.get(p.dataId).values,y=new Array(a);for(let I=0;I<y.length;I++)y[I]=i.shape[u[I]];const C=ry(w,i.shape,i.dtype,u,y);p=s.makeTensorInfo(y,i.dtype);const $=s.texData.get(p.dataId);$.values=C}else p=jp(i,u,s);h.push(p),c=Dn(c.length,a)}ii("sum",c,a);const[m,g]=Zn(p.shape,c);let v=m;r&&(v=Pn(m,l));const x=tde(p,g,v,s);for(const b of h)s.disposeIntermediateTensorInfo(b);return x}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i,a=r.shape.length,l=Ct(o,r.shape);let c=l;const u=xn(c,a);let d=r;u!=null&&(d=Ni({inputs:{x:r},backend:t,attrs:{perm:u}}),c=Dn(c.length,r.shape.length)),ii("min",c,a);const[f,h]=Zn(d.shape,c),p=he(h),m=De({inputs:{x:d},backend:t,attrs:{shape:[-1,p]}}),g=Ga(m,m.dtype,"min",t);let v;if(s){const x=Pn(f,l);v=De({inputs:{x:g},backend:t,attrs:{shape:x}})}else v=De({inputs:{x:g},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),u!=null&&t.disposeIntermediateTensorInfo(d),v}const rde={kernelName:Yf,backendName:"webgl",kernelFunc:ide};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ode=oy+`
  return min(a, b);
`,sde=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Wa+`
  return result;
`,ade=ri({opSnippet:ode,packedOpSnippet:sde,cpuKernelImpl:jre}),lde={kernelName:Lu,backendName:"webgl",kernelFunc:ade};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cde{constructor(e,t,i){this.variableNames=["x"],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,o=qt(r),s=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=i==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${s});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ude{constructor(e,t,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((p,m)=>p[0]+e[m]+p[1]);const r=e.length,o=qt(r),s=t.map(p=>p[0]).join(","),a=t.map((p,m)=>p[0]+e[m]).join(","),l=Ii("rc",r),c=Ii("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,f=i==="reflect"?0:1;let h="";if(r===1){const p=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;h=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const p=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;h=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[r-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${s});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dde=({inputs:n,backend:e,attrs:t})=>{const{x:i}=n,{paddings:r,mode:o}=t,s=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ude(i.shape,r,o):new cde(i.shape,r,o);return e.runWebGLProgram(s,[i],i.dtype)},hde={kernelName:Jf,backendName:"webgl",kernelFunc:dde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fde=`if (b == 0.0) return NAN;
  return mod(a, b);`,pde=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Wa+`
  return result;
`,mde=ri({opSnippet:fde,packedOpSnippet:pde}),gde={kernelName:zu,backendName:"webgl",kernelFunc:mde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vde{constructor(e,t,i){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,i],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde=`
if (a == b) {
  return 1.0;
};
return a / b;`,bde=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,KR=ri({opSnippet:xde,packedOpSnippet:bde,checkOutOfBounds:!0}),yde={kernelName:Su,backendName:"webgl",kernelFunc:KR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XS="return a - b;",XR=ri({opSnippet:XS,packedOpSnippet:XS,supportsComplex:!0,cpuKernelImpl:foe}),wde={kernelName:td,backendName:"webgl",kernelFunc:XR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n){const{inputs:e,backend:t,attrs:i}=n,{logits:r}=e,{dim:o}=i,s=Ct([o],r.shape),a=jR({inputs:{x:r},backend:t,attrs:{reductionIndices:s,keepDims:!1}}),l=Pn(a.shape,s),c=De({inputs:{x:a},backend:t,attrs:{shape:l}}),u=XR({inputs:{a:r,b:c},backend:t}),d=GR({inputs:{x:u},backend:t}),f=Kp({inputs:{x:d},backend:t,attrs:{axis:s,keepDims:!1}}),h=De({inputs:{x:f},backend:t,attrs:{shape:l}}),p=KR({inputs:{a:d,b:h},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}const Cde={kernelName:mp,backendName:"webgl",kernelFunc:qR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sde(n){const{inputs:e,backend:t,attrs:i}=n,{logits:r}=e,{numSamples:o,seed:s,normalized:a}=i,l=a?r:qR({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new vde(c,u,o),f=[[s]],h=t.runWebGLProgram(d,[l],"int32",f);return a||t.disposeIntermediateTensorInfo(l),h}const Ide={kernelName:$E,backendName:"webgl",kernelFunc:Sde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $de=Or+`
  return -x;
`,Ede=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Nde(n){const{inputs:e,backend:t}=n,{x:i}=e;if(t.shouldExecuteOnCPU([i])){const o=t.texData.get(i.dataId),[s,a]=Xre(o.values,i.shape,i.dtype);return t.makeTensorInfo(a,i.dtype,s)}let r;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ds(i.shape,Ede):r=new ho(i.shape,$de),t.runWebGLProgram(r,[i],i.dtype)}const kde={kernelName:Zf,backendName:"webgl",kernelFunc:Nde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dde=U0;function Tde(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:i}=n,{boxes:r,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=i,c=t.readSync(r.dataId),u=t.readSync(o.dataId),{selectedIndices:d}=Dde(c,u,s,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Rde={kernelName:Yx,backendName:"webgl",kernelFunc:Tde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _de=j0;function Ade(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:i}=n,{boxes:r,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=i,u=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:f,validOutputs:h}=_de(u,d,s,a,l,c);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([h]))]}const Ode={kernelName:Jx,backendName:"webgl",kernelFunc:Ade};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pde=K0;function Mde(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:i}=n,{boxes:r,scores:o}=e,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=i,u=t.readSync(r.dataId),d=t.readSync(o.dataId),f=s,h=a,p=l,m=c,{selectedIndices:g,selectedScores:v}=Pde(u,d,f,h,p,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const Fde={kernelName:Zx,backendName:"webgl",kernelFunc:Mde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lde{constructor(e,t,i,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${i}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zde=n=>{const{inputs:e,backend:t,attrs:i}=n,{indices:r}=e,{dtype:o,depth:s,onValue:a,offValue:l}=i,c=he(r.shape),u=new Lde(c,s,a,l),d=De({inputs:{x:r},backend:t,attrs:{shape:[c]}}),f=t.runWebGLProgram(u,[d],o);t.disposeIntermediateTensorInfo(d);const h=[...r.shape,s],p=De({inputs:{x:f},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(f),p},Bde={kernelName:tp,backendName:"webgl",kernelFunc:zde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ef(n){const{inputs:e,backend:t}=n,{x:i}=e;if(i.dtype==="complex64"){const r=Ed({inputs:{input:i},backend:t}),o=ef({inputs:{x:r},backend:t}),s=Xp({inputs:{input:i},backend:t}),a=ef({inputs:{x:s},backend:t}),l=Ls({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),l}else return Nd({attrs:{shape:i.shape,dtype:i.dtype,value:i.dtype==="string"?"":0},backend:t})}const Vde={kernelName:xp,backendName:"webgl",kernelFunc:ef};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YR(n){const{inputs:e,backend:t}=n,{x:i}=e;if(i.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(i.dtype==="complex64"){const r=Ed({inputs:{input:i},backend:t}),o=YR({inputs:{x:r},backend:t}),s=Xp({inputs:{input:i},backend:t}),a=ef({inputs:{x:s},backend:t}),l=Ls({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(a),l}else return Nd({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:t})}const Wde={kernelName:ep,backendName:"webgl",kernelFunc:YR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gde(n){const{inputs:e,backend:t,attrs:i}=n,{axis:r}=i;if(e.length===1)return tv({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,s=e[0].dtype;e.forEach(u=>{bx(o,u.shape,"All tensors passed to stack must have matching shapes"),F(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=tv({inputs:{input:u},backend:t,attrs:{dim:r}});return a.push(d),d}),c=PR({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const Hde={kernelName:np,backendName:"webgl",kernelFunc:Gde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ude{constructor(e,t,i){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,u)=>c[0]+e[u]+c[1]);const r=e.length,o=qt(r),s=t.map(c=>c[0]).join(","),a=t.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${s});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jde{constructor(e,t,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,o=qt(r),s=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),l=Ii("rc",r),c=Ii("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${u}) {`],h=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=r===1?2:4;m<g;m++)p+=`
        ${f[m]}
        if (${h}) {
          result[${m}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${d});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${s});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JR=n=>{const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{paddings:o,constantValue:s}=i;if(he(r.shape)===0){const c=o.map((u,d)=>u[0]+r.shape[d]+u[1]);return Nd({backend:t,attrs:{shape:c,value:s,dtype:r.dtype}})}const a=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jde(r.shape,o,s):new Ude(r.shape,o,s),l=[[s]];return t.runWebGLProgram(a,[r],r.dtype,l)},Kde={kernelName:ip,backendName:"webgl",kernelFunc:JR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xde=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,qde=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Wa+`
  return result;
`,Yde=ri({opSnippet:Xde,packedOpSnippet:qde}),Jde={kernelName:Vu,backendName:"webgl",kernelFunc:Yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zde(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{axis:o,keepDims:s}=i,a=r.shape.length,l=[],c=Ct(o,r.shape);let u=c;const d=xn(u,a);let f=r;d!=null&&(f=Ni({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Dn(u.length,a),l.push(f)),ii("prod",u,a);let h;if(t.shouldExecuteOnCPU([f])){const p=t.texData.get(f.dataId).values,{outVals:m,outShape:g,outDtype:v}=Yre(f.shape,f.dtype,p,u);h=t.makeTensorInfo(g,v,m)}else{const[p,m]=Zn(f.shape,u),g=he(m),v=De({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}}),x=d0(r.dtype),b=Ga(v,x,"prod",t);h=De({inputs:{x:b},backend:t,attrs:{shape:p}}),l.push(v),l.push(b)}if(s){l.push(h);const p=Pn(h.shape,c);h=De({inputs:{x:h},backend:t,attrs:{shape:p}})}return l.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const Qde={kernelName:op,backendName:"webgl",kernelFunc:Zde};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ehe(n){const{inputs:e,backend:t,attrs:i}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:s}=e,{outputRaggedRank:a}=i,l=r.map(v=>t.readSync(v.dataId)),c=r.map(v=>v.shape),u=t.readSync(o.dataId),d=t.readSync(s.dataId),[f,h,p]=Jre(l,c,u,o.shape,o.dtype,d,s.shape,a),m=f.map(v=>t.makeTensorInfo([v.length],"int32",v)),g=t.makeTensorInfo(p,o.dtype,h);return m.concat([g])}const the={kernelName:EE,backendName:"webgl",kernelFunc:ehe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nhe(n){const{inputs:e,backend:t}=n,{starts:i,limits:r,deltas:o}=e,s=t.readSync(i.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[c,u]=Zre(s,i.shape,i.dtype,a,r.shape,l,o.shape),d=t.makeTensorInfo([c.length],"int32",c),f=t.makeTensorInfo([u.length],i.dtype,u);return[d,f]}const ihe={kernelName:NE,backendName:"webgl",kernelFunc:nhe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rhe(n){const{inputs:e,backend:t,attrs:i}=n,{shape:r,values:o,defaultValue:s,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=i,c=t.readSync(r.dataId),u=t.readSync(o.dataId),d=t.readSync(s.dataId),f=a.map(g=>t.readSync(g.dataId)),h=a.map(g=>g.shape),[p,m]=Qre(c,r.shape,u,o.shape,o.dtype,d,s.shape,f,h,l);return t.makeTensorInfo(p,o.dtype,m)}const ohe={kernelName:kE,backendName:"webgl",kernelFunc:rhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZR=n=>{const{backend:e,attrs:t}=n,{start:i,stop:r,step:o,dtype:s}=t,a=eoe(i,r,o,s);return e.makeTensorInfo([a.length],s,a)},she={kernelName:Qx,backendName:"webgl",kernelFunc:ZR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ahe="return 1.0 / x;",lhe=Ft({opSnippet:ahe}),che={kernelName:Wu,backendName:"webgl",kernelFunc:lhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uhe=Or+`
  return (x < 0.0) ? 0.0 : x;
`,dhe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hhe=Ft({opSnippet:uhe,packedOpSnippet:dhe}),fhe={kernelName:Gu,backendName:"webgl",kernelFunc:hhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const phe=Or+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,mhe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ghe=Ft({opSnippet:phe,packedOpSnippet:mhe}),vhe={kernelName:Hu,backendName:"webgl",kernelFunc:ghe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xhe{constructor(e,t,i,r,o){this.variableNames=["A"],this.outputShape=[];const[s,a,l,c]=e;this.outputShape=[s,t,i,c];const u=[r&&t>1?a-1:a,r&&i>1?l-1:l],d=[r&&t>1?t-1:t,r&&i>1?i-1:i];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bhe{constructor(e,t,i,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,l,c]=e;this.outputShape=[s,t,i,c];const u=[r&&t>1?a-1:a,r&&i>1?l-1:l],d=[r&&t>1?t-1:t,r&&i>1?i-1:i];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${i-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yhe(n){const{inputs:e,backend:t,attrs:i}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:s,size:a}=i,[l,c]=a,u=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new bhe(r.shape,l,c,o,s):new xhe(r.shape,l,c,o,s);return t.runWebGLProgram(u,[r],"float32")}const whe={kernelName:lp,backendName:"webgl",kernelFunc:yhe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Che{constructor(e,t,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,s,a]=e,l=[i&&s>1?r-1:r,i&&a>1?o-1:o],c=[i&&s>1?s-1:s,i&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],f=1/u,h=1/d,p=Math.ceil(f)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${h});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(n){const{inputs:e,backend:t,attrs:i}=n,{images:r,dy:o}=e,{alignCorners:s}=i,a=new Che(o.shape,r.shape,s);return t.runWebGLProgram(a,[o],o.dtype)}const Ihe={kernelName:n0,backendName:"webgl",kernelFunc:She};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $he{constructor(e,t,i,r,o){this.variableNames=["A"],this.outputShape=[];const[s,a,l,c]=e;this.outputShape=[s,t,i,c];const u=[r&&t>1?a-1:a,r&&i>1?l-1:l],d=[r&&t>1?t-1:t,r&&i>1?i-1:i],f=r?"0.5":"0.0";let h;o?h="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ehe{constructor(e,t,i,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,l,c]=e;this.outputShape=[s,t,i,c];const u=[r&&t>1?a-1:a,r&&i>1?l-1:l],d=[r&&t>1?t-1:t,r&&i>1?i-1:i],f=r?"0.5":"0.0";let h;o?h="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${i-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nhe(n){const{inputs:e,backend:t,attrs:i}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:s,size:a}=i,[l,c]=a,u=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Ehe(r.shape,l,c,o,s):new $he(r.shape,l,c,o,s);return t.runWebGLProgram(u,[r],r.dtype)}const khe={kernelName:ap,backendName:"webgl",kernelFunc:Nhe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dhe{constructor(e,t,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,s,a]=e,l=[i&&s>1?r-1:r,i&&a>1?o-1:o],c=[i&&s>1?s-1:s,i&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],f=1/u,h=1/d,p=Math.ceil(f)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${h});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${i} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${i} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function The(n){const{inputs:e,backend:t,attrs:i}=n,{images:r,dy:o}=e,{alignCorners:s}=i,a=new Dhe(o.shape,r.shape,s);return t.runWebGLProgram(a,[o],o.dtype)}const Rhe={kernelName:t0,backendName:"webgl",kernelFunc:The};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _he{constructor(e,t){this.variableNames=["x"];const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);if(this.outputShape=e,i===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>r(l)).join(","),s=qt(i);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ahe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);this.outputShape=e;const r=Ii("rc",i),o=`${r[i-1]} + 1 < ${this.outputShape[i-1]}`,s=`${r[i-2]} + 1 < ${this.outputShape[i-2]}`,a=qt(i);i===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${c(r.slice())};
          }
          if(${s}) {
            result.b = ${u(r.slice())};
            if(${o}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return f(p)}function c(p){return p[i-1]="("+p[i-1]+" + 1)",f(p)}function u(p){return p[i-2]="("+p[i-2]+" + 1)",f(p)}function d(p){return p[i-1]="("+p[i-1]+" + 1)",p[i-2]="("+p[i-2]+" + 1)",f(p)}function f(p){const m=e.map((x,b)=>h(b,p)),g=m.join(","),v=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${v}))`}function h(p,m){return t.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ohe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{dims:o}=i,s=r.shape.length,a=Ct(o,r.shape);if(s===0)return er({inputs:{x:r},backend:t});const l=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ahe(r.shape,a):new _he(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const Phe={kernelName:cp,backendName:"webgl",kernelFunc:Ohe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mhe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const i=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${i}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fhe={kernelName:c0,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:i}=n,{radians:r,fillValue:o,center:s}=e,a=t,l=new Mhe(i.shape,o),[c,u]=ob(s,i.shape[1],i.shape[2]),d=[[c,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[i],i.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lhe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,zhe=Ft({opSnippet:Lhe}),Bhe={kernelName:Uu,backendName:"webgl",kernelFunc:zhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vhe="return inversesqrt(x);",Whe=Ft({opSnippet:Vhe,cpuKernelImpl:toe}),Ghe={kernelName:ju,backendName:"webgl",kernelFunc:Whe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ly{constructor(e,t,i,r,o,s,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const c=qt(o.length),u=qt(s.length);let d="";i===1?d="i":i===2&&(d="i, j");const f=`getIndices(${d})`;let h="";r===1?h="i":r===2&&(h="i, coords[1]");const p=`getUpdates(${h})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${v};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hhe{constructor(e,t,i,r,o,s,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;const c=qt(o.length),u=qt(s.length);let d="";i===1?d="i":i===2&&(d="i, j");const f=`getIndices(${d})`;let h="";r===1?h="i":r===2&&(h="i, coords[1]");const p=`getUpdates(${h})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=t>1?"strides[j]":"strides",x=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${v};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uhe(n){const{inputs:e,backend:t,attrs:i}=n,{indices:r,updates:o}=e,{shape:s}=i,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Fa(o,r,s),f=[d/c,c];if(d===0)return t.makeTensorInfo(s,r.dtype);const h=De({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),p=De({inputs:{x:o},backend:t,attrs:{shape:[l,c]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0]));let g;ae().getBool("WEBGL_PACK")?g=new Hhe(l,a,h.shape.length,p.shape.length,u,f):g=new ly(l,a,h.shape.length,p.shape.length,u,f);const v=t.runWebGLProgram(g,[p,h,m],p.dtype),x=De({inputs:{x:v},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(m),x}const jhe={kernelName:DE,backendName:"webgl",kernelFunc:Uhe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Khe{constructor(e,t,i,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,i];const o="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=ae().getNumber("WEBGL_VERSION")===2?o:s,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xhe(n){const{inputs:e,backend:t,attrs:i}=n,{sortedSequence:r,values:o}=e,{side:s}=i,a=new Khe(r.shape[0],r.shape[1],o.shape[1],s),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",l)}const qhe={kernelName:RE,backendName:"webgl",kernelFunc:Xhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yhe{constructor(e,t,i){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(i>4)throw Error(`Where for rank ${i} is not yet supported`);if(i===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<t.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);r=l.join(),o=c.join()}const s=qt(i);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jhe(n){const{inputs:e,backend:t}=n,{condition:i,t:r,e:o}=e,s=new Yhe(i.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(s,[i,r,o],Zi(r.dtype,o.dtype))}const Zhe={kernelName:up,backendName:"webgl",kernelFunc:Jhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qhe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Tp};
  float scale = ${Rp};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,efe=Ft({opSnippet:Qhe}),tfe={kernelName:Ku,backendName:"webgl",kernelFunc:efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nfe=uc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,ife=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rfe=Ft({opSnippet:nfe,packedOpSnippet:ife,cpuKernelImpl:ioe}),ofe={kernelName:Ju,backendName:"webgl",kernelFunc:rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sfe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,afe=Ft({opSnippet:sfe}),lfe={kernelName:Yu,backendName:"webgl",kernelFunc:afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cfe=uc+`
  return sin(x);
`,ufe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Wa}
  return result;
`,dfe=Ft({opSnippet:cfe,packedOpSnippet:ufe}),hfe={kernelName:Xu,backendName:"webgl",kernelFunc:dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ffe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,pfe=Ft({opSnippet:ffe}),mfe={kernelName:qu,backendName:"webgl",kernelFunc:pfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gfe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,vfe=Ft({opSnippet:gfe}),xfe={kernelName:Zu,backendName:"webgl",kernelFunc:vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bfe=n=>{const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{blockShape:o,paddings:s}=i;F(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((v,x)=>v*x),l=[[0,0]];l.push(...s);for(let v=1+o.length;v<r.shape.length;++v)l.push([0,0]);const c=[],u=JR({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=dd(u.shape,o,a,!1),f=hd(d.length,o.length,!1),h=fd(u.shape,o,a,!1),p=De({inputs:{x:u},backend:t,attrs:{shape:d}}),m=Ni({inputs:{x:p},backend:t,attrs:{perm:f}}),g=De({inputs:{x:m},backend:t,attrs:{shape:h}});return c.push(u),c.push(p),c.push(m),c.forEach(v=>t.disposeIntermediateTensorInfo(v)),g},yfe={kernelName:fp,backendName:"webgl",kernelFunc:bfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wfe(n){const{inputs:e,backend:t}=n,{indices:i,values:r,denseShape:o,defaultValue:s}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${i.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);const a=t.readSync(i.dataId),l=t.readSync(r.dataId),c=t.readSync(o.dataId),u=t.readSync(s.dataId)[0],[d,f,h,p,m]=ooe(a,i.shape,i.dtype,l,r.dtype,c,u);return[t.makeTensorInfo(f,i.dtype,d),t.makeTensorInfo([f[0]],r.dtype,h),t.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),t.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}const Cfe={kernelName:_E,backendName:"webgl",kernelFunc:wfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sfe(n){const{inputs:e,backend:t}=n,{inputIndices:i,inputShape:r,newShape:o}=e;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const s=Array.from(t.readSync(r.dataId)),a=t.readSync(i.dataId),l=Array.from(t.readSync(o.dataId)),[c,u,d]=soe(a,i.shape,i.dtype,s,l);return[t.makeTensorInfo(u,i.dtype,c),t.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const Ife={kernelName:AE,backendName:"webgl",kernelFunc:Sfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $fe(n){const{inputs:e,backend:t}=n,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const s=t.readSync(i.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[c,u]=CR(s,i.shape,i.dtype,a,l,!0);return t.makeTensorInfo(u,i.dtype,c)}const Efe={kernelName:OE,backendName:"webgl",kernelFunc:$fe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(n){const{inputs:e,backend:t}=n,{data:i,indices:r,segmentIds:o}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const s=t.readSync(i.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[c,u]=CR(s,i.shape,i.dtype,a,l);return t.makeTensorInfo(u,i.dtype,c)}const kfe={kernelName:PE,backendName:"webgl",kernelFunc:Nfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dfe(n){const{inputs:e,backend:t,attrs:i}=n,{sparseIndices:r,sparseValues:o,defaultValue:s}=e,{outputShape:a}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:f}=Fa(o,r,a),h=!1;if(o.dtype==="string"){const v=t.bufferSync(r),x=t.bufferSync(o),b=ws(t.readSync(s.dataId)[0]),w=noe(v,x,a,f,u,c,l,d,b,h);return t.makeTensorInfo(a,w.dtype,w.values)}const p=new ly(c,l,r.shape.length,o.shape.length,d,[f,1],h),m=t.runWebGLProgram(p,[o,r,s],o.dtype),g=De({inputs:{x:m},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(m),g}const Tfe={kernelName:ME,backendName:"webgl",kernelFunc:Dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rfe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{numOrSizeSplits:o,axis:s}=i,a=Ct(s,r.shape)[0],l=yb(r,o,a),c=r.shape.length,u=new Array(c).fill(0),d=r.shape.slice();return l.map(f=>{const h=[...d];h[a]=f;const p=dc({inputs:{x:r},backend:t,attrs:{begin:u,size:h}});return u[a]+=f,p})}const _fe={kernelName:pp,backendName:"webgl",kernelFunc:Rfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qS="return sqrt(x);",Afe=Ft({opSnippet:qS,packedOpSnippet:qS,cpuKernelImpl:aoe}),Ofe={kernelName:Qu,backendName:"webgl",kernelFunc:Afe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pfe="return x * x;",Mfe=Ft({opSnippet:Pfe}),Ffe={kernelName:i0,backendName:"webgl",kernelFunc:Mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YS="return (a - b) * (a - b);",Lfe=ri({opSnippet:YS,packedOpSnippet:YS}),zfe={kernelName:ed,backendName:"webgl",kernelFunc:Lfe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bfe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),s=Xo(o),a=loe(s,"string",i);return t.makeTensorInfo(r.shape,"string",a)}const Vfe={kernelName:r0,backendName:"webgl",kernelFunc:Bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wfe({inputs:n,attrs:e,backend:t}){const{x:i}=n,r=Or+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new ho(i.shape,r);return t.runWebGLProgram(o,[i],i.dtype)}const Gfe={kernelName:od,backendName:"webgl",kernelFunc:Wfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hfe{constructor(e,t,i){this.variableNames=["x"],this.outputShape=i;const r=i.length,o=qt(i.length),s=qt(i.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=i.map((c,u)=>(l++,i.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ufe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{begin:o,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:f}=i,{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:x,end:b,strides:w}=nb(r.shape,o,s,a,l,c,u,d,f);let y;if(m)y=De({inputs:{x:r},backend:t,attrs:{shape:p}});else if(g||v){F(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const $=Q0(x,b,w),I=dc({inputs:{x:r},backend:t,attrs:{begin:x,size:$}});y=De({inputs:{x:I},backend:t,attrs:{shape:p}}),t.disposeIntermediateTensorInfo(I)}else if(t.shouldExecuteOnCPU([r])){const I=t.readSync(r.dataId),E=wt(r.shape,r.dtype,I),N=coe(h,E,w,x);y=t.makeTensorInfo(p,r.dtype,N.values)}else{const I=new Hfe(x,w,h);y=t.runWebGLProgram(I,[r],r.dtype)}const C=De({inputs:{x:y},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),C}const jfe={kernelName:o0,backendName:"webgl",kernelFunc:Ufe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kfe(n){const{inputs:e,backend:t,attrs:i}=n,{separator:r,nGramWidths:o,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:d}=e,f=t.readSync(u.dataId),h=t.readSync(d.dataId),[p,m]=uoe(f,h,r,o,s,a,l,c);return[t.makeTensorInfo([p.length],"string",p),t.makeTensorInfo(d.shape,"int32",m)]}const Xfe={kernelName:FE,backendName:"webgl",kernelFunc:Kfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qfe(n){const{inputs:e,backend:t,attrs:i}=n,{skipEmpty:r}=i,{input:o,delimiter:s}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const a=t.readSync(o.dataId),l=t.readSync(s.dataId)[0],[c,u,d]=doe(a,l,r),f=u.length;return[t.makeTensorInfo([f,2],"int32",c),t.makeTensorInfo([f],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const Yfe={kernelName:LE,backendName:"webgl",kernelFunc:qfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jfe(n){const{inputs:e,backend:t,attrs:i}=n,{numBuckets:r}=i,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const s=t.readSync(o.dataId),a=hoe(s,r);return t.makeTensorInfo(o.shape,"int32",a)}const Zfe={kernelName:zE,backendName:"webgl",kernelFunc:Jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qfe="return tan(x);",epe=Ft({opSnippet:Qfe}),tpe={kernelName:nd,backendName:"webgl",kernelFunc:epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const npe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,ipe=Ft({opSnippet:npe}),rpe={kernelName:id,backendName:"webgl",kernelFunc:ipe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ope(n){const{inputs:e,backend:t,attrs:i}=n,{tensor:r,indices:o,updates:s}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Fa(s,o,r.shape),f=[d/c,c];if(d===0)return t.makeTensorInfo(r.shape,o.dtype);const h=De({inputs:{x:o},backend:t,attrs:{shape:[l,a]}}),p=De({inputs:{x:s},backend:t,attrs:{shape:[l,c]}}),m=De({inputs:{x:r},backend:t,attrs:{shape:f}}),g=new ly(l,a,h.shape.length,p.shape.length,u,f,!1,!0),v=t.runWebGLProgram(g,[p,h,m],m.dtype),x=De({inputs:{x:v},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v),x}const spe={kernelName:TE,backendName:"webgl",kernelFunc:ope};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ape{constructor(e,t){this.variableNames=["A"];const i=new Array(e.length);for(let s=0;s<i.length;s++)i[s]=e[s]*t[s];this.outputShape=i,this.rank=i.length;const r=qt(this.rank),o=lpe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function lpe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let r=0;r<n.length;r++)i.push(`imod(${t[r]}, ${n[r]})`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QR(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{reps:o}=i;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),c=r.dtype==="string"?l.map(f=>ws(f)):l,u=wt(r.shape,r.dtype,c),d=poe(u,o);return t.makeTensorInfo(d.shape,d.dtype,d.values)}const s=new ape(r.shape,o);return t.runWebGLProgram(s,[r],r.dtype)}const cpe={kernelName:rd,backendName:"webgl",kernelFunc:QR};class upe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class dpe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Us(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function JS(n){let e=1;for(;e<n;)e*=2;return e}function hpe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r}=e,{k:o,sorted:s}=i,a=ae().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ae().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(t.shouldExecuteOnCPU([r])||u<a||o>l){const N=t.readSync(r.dataId),[k,D]=moe(N,c,r.dtype,o,s);return[t.makeTensorInfo(k.shape,k.dtype,k.values),t.makeTensorInfo(D.shape,D.dtype,D.values)]}if(o===0)return c[c.length-1]=0,[t.makeTensorInfo(c,r.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(u===1)return[r,Nd({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const d=t.texData.get(r.dataId),f=d!==null&&d.isPacked,h=f?t.unpackTensor(r):r,m=he(c)/u,g=De({inputs:{x:h},attrs:{shape:[m,u]},backend:t});f&&Us(t,h);const v=JS(o),x=JS(u);let b=null;const w=()=>b===null?[g,g]:[g,b],y=(N,k,D)=>{const _=w(),R=new upe(D),A=[[u],[b===null?1:0],[Number.NEGATIVE_INFINITY],[N],[k]],O=b;b=t.runWebGLProgram(R,_,"int32",A),Us(t,O)};for(let N=1;N<v;N*=2){const k=N*2;for(let D=N;D>=1;D/=2)y(k,D,[m,x])}for(let N=x;N>v;N/=2){const k=w(),D=new dpe([m,N/2]),R=[[u],[b===null?1:0],[v]],T=b;b=t.runWebGLProgram(D,k,"int32",R),Us(t,T);const A=v/2,O=A*2;for(let P=A;P>=1;P/=2)y(O,P,b.shape)}let C=b;b=dc({inputs:{x:b},backend:t,attrs:{begin:0,size:[m,o]}}),Us(t,C);let $=UR({inputs:{x:g,indices:b},backend:t,attrs:{axis:1,batchDims:1}});Us(t,g);const I=c.slice(0,-1);I.push(o),C=b,b=De({inputs:{x:b},attrs:{shape:I},backend:t}),Us(t,C);const E=$;return $=De({inputs:{x:$},attrs:{shape:I},backend:t}),Us(t,E),[$,b]}const fpe={kernelName:s0,backendName:"webgl",kernelFunc:hpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ppe{constructor(e,t,i,r,o,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const a=i==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mpe(n){const{inputs:e,backend:t,attrs:i}=n,{image:r,transforms:o}=e,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=i,[u,d,f,h]=r.shape,[p,m]=c??[d,f],g=[u,p,m,h],v=new ppe(d,f,s,a,l,g);return t.runWebGLProgram(v,[r,o],"float32")}const gpe={kernelName:a0,backendName:"webgl",kernelFunc:mpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vpe(n){const{inputs:e,attrs:t,backend:i}=n,{axis:r}=t,{x:o}=e;Id(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=i.readSync(o.dataId),{outputValues:a,outputShape:l,indices:c}=goe(s,r,o.shape,o.dtype);return[i.makeTensorInfo(l,o.dtype,a),i.makeTensorInfo([c.length],"int32",c)]}const xpe={kernelName:l0,backendName:"webgl",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(n){const{inputs:e,backend:t,attrs:i}=n,{value:r}=e;let{axis:o}=i;o<0&&(o+=r.shape.length);const s=r,a=s.shape.length,l=r.shape[o],c=new Array(a-1);let u=0;for(let m=0;m<a;m++)m!==o&&(c[u++]=s.shape[m]);const d=[],f=new Array(a).fill(0),h=s.shape.slice();h[o]=1;const p=new Array(l);for(let m=0;m<p.length;m++){f[o]=m;const g=dc({inputs:{x:s},backend:t,attrs:{begin:f,size:h}}),v=De({inputs:{x:g},backend:t,attrs:{shape:c}});p[m]=v,d.push(g)}return d.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const ype={kernelName:gp,backendName:"webgl",kernelFunc:bpe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wpe{constructor(e,t){this.variableNames=["x","segmentIds"];const i=e.windowSize,r=e.batchSize,o=e.inSize,s=e.numSegments,a=s*Math.ceil(o/i);this.outputShape=[r,a];const l="0.0",c="sumValue",u=Math.floor(i/4)*4,d=i%4,f=`
        sumValue += dot(values, segFilter);
    `;let h="";o%i>0&&(h=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let p="";o%i>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${i}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cpe(n){const{inputs:e,backend:t,attrs:i}=n,{x:r,segmentIds:o}=e,{numSegments:s}=i,a=r.shape.length,l=[];let c=0;const u=xn([c],a);let d=r;u!=null&&(d=Ni({inputs:{x:r},backend:t,attrs:{perm:u}}),l.push(d),c=Dn(1,a)[0]);const f=ON(d.shape,c,s),h=he([d.shape[c]]),p=De({inputs:{x:d},backend:t,attrs:{shape:[-1,h]}});l.push(p);const m=d0(r.dtype),g=(w,y,C,$,I)=>{const E=w.shape[0],N=w.shape[1],k=AN(N,I),D={windowSize:k,inSize:N,batchSize:E,numSegments:I},_=new wpe(D,y),R=t.compileAndRun(_,[w,C],$);if(l.push(R),R.shape[1]===I)return R;const T=ZR({backend:t,attrs:{start:0,stop:I,step:1,dtype:"float32"}}),A=QR({inputs:{x:T},backend:t,attrs:{reps:[N/k]}});return l.push(T),l.push(A),g(R,y,A,$,I)},v=g(p,"unsortedSegmentSum",o,m,s),x=De({inputs:{x:v},backend:t,attrs:{shape:f}});let b=x;if(u!=null){l.push(x);const w=_s(u);b=Ni({inputs:{x:b},backend:t,attrs:{perm:w}})}return l.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}const Spe={kernelName:vp,backendName:"webgl",kernelFunc:Cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ipe=[ase,cse,hse,mse,vse,yse,Cse,Ise,kse,Tse,Ase,Mse,zse,Gse,jse,Xse,Yse,eae,nae,rae,lae,mae,vae,wae,Sae,Dae,Rae,Pae,Hoe,Lae,Gae,Kae,Qae,nle,rle,sle,lle,hle,mle,xle,yle,Cle,Ile,Nle,Dle,Ale,Ple,Lle,Vle,Gle,Kle,Jle,tce,rce,ace,lce,uce,hce,pce,gce,xce,Cce,$ce,kce,Tce,Ace,Mce,Bce,Hce,Goe,jce,Vae,qce,Zce,tue,joe,oue,cue,due,mue,xue,Cue,$ue,Due,Aue,Mue,Lue,Wue,Hue,jue,Yue,Zue,ede,nde,rde,lde,hde,gde,Ide,qoe,kde,Rde,Ode,Fde,$ae,Bde,Wde,Hde,Kde,Jde,Xoe,Qde,the,ihe,ohe,she,Eae,yde,che,fhe,vhe,Joe,whe,Ihe,khe,Rhe,Phe,Fhe,Bhe,Ghe,jhe,qhe,Zhe,tfe,ofe,lfe,hfe,mfe,fae,Cde,xfe,yfe,Cfe,Ife,Efe,kfe,Tfe,_fe,Ofe,Ffe,zfe,Vfe,Gfe,jfe,Xfe,Yfe,Zfe,wde,rse,tpe,rpe,spe,cpe,fpe,gpe,ose,xpe,ype,Spe,Vde];for(const n of Ipe)VE(n);var e_={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(n,e){(function(i,r){n.exports=r()})(mo,function(){return function(t){var i={};function r(o){if(i[o])return i[o].exports;var s=i[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=i,r.d=function(o,s,a){r.o(o,s)||Object.defineProperty(o,s,{enumerable:!0,get:a})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,s){if(s&1&&(o=r(o)),s&8||s&4&&typeof o=="object"&&o&&o.__esModule)return o;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:o}),s&2&&typeof o!="string")for(var l in o)r.d(a,l,(function(c){return o[c]}).bind(null,l));return a},r.n=function(o){var s=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(s,"a",s),s},r.o=function(o,s){return Object.prototype.hasOwnProperty.call(o,s)},r.p="",r(r.s=20)}([function(t,i){var r={};t.exports=r,function(){r._baseDelta=1e3/60,r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r._warnedOnce={},r._decomp=null,r.extend=function(s,a){var l,c;typeof a=="boolean"?(l=2,c=a):(l=1,c=!0);for(var u=l;u<arguments.length;u++){var d=arguments[u];if(d)for(var f in d)c&&d[f]&&d[f].constructor===Object&&(!s[f]||s[f].constructor===Object)?(s[f]=s[f]||{},r.extend(s[f],c,d[f])):s[f]=d[f]}return s},r.clone=function(s,a){return r.extend({},a,s)},r.keys=function(s){if(Object.keys)return Object.keys(s);var a=[];for(var l in s)a.push(l);return a},r.values=function(s){var a=[];if(Object.keys){for(var l=Object.keys(s),c=0;c<l.length;c++)a.push(s[l[c]]);return a}for(var u in s)a.push(s[u]);return a},r.get=function(s,a,l,c){a=a.split(".").slice(l,c);for(var u=0;u<a.length;u+=1)s=s[a[u]];return s},r.set=function(s,a,l,c,u){var d=a.split(".").slice(c,u);return r.get(s,a,0,-1)[d[d.length-1]]=l,l},r.shuffle=function(s){for(var a=s.length-1;a>0;a--){var l=Math.floor(r.random()*(a+1)),c=s[a];s[a]=s[l],s[l]=c}return s},r.choose=function(s){return s[Math.floor(r.random()*s.length)]},r.isElement=function(s){return typeof HTMLElement<"u"?s instanceof HTMLElement:!!(s&&s.nodeType&&s.nodeName)},r.isArray=function(s){return Object.prototype.toString.call(s)==="[object Array]"},r.isFunction=function(s){return typeof s=="function"},r.isPlainObject=function(s){return typeof s=="object"&&s.constructor===Object},r.isString=function(s){return toString.call(s)==="[object String]"},r.clamp=function(s,a,l){return s<a?a:s>l?l:s},r.sign=function(s){return s<0?-1:1},r.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-r._nowStartTime},r.random=function(s,a){return s=typeof s<"u"?s:0,a=typeof a<"u"?a:1,s+o()*(a-s)};var o=function(){return r._seed=(r._seed*9301+49297)%233280,r._seed/233280};r.colorToNumber=function(s){return s=s.replace("#",""),s.length==3&&(s=s.charAt(0)+s.charAt(0)+s.charAt(1)+s.charAt(1)+s.charAt(2)+s.charAt(2)),parseInt(s,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warnOnce=function(){var s=Array.prototype.slice.call(arguments).join(" ");r._warnedOnce[s]||(r.warn(s),r._warnedOnce[s]=!0)},r.deprecated=function(s,a,l){s[a]=r.chain(function(){r.warnOnce(" deprecated ",l)},s[a])},r.nextId=function(){return r._nextId++},r.indexOf=function(s,a){if(s.indexOf)return s.indexOf(a);for(var l=0;l<s.length;l++)if(s[l]===a)return l;return-1},r.map=function(s,a){if(s.map)return s.map(a);for(var l=[],c=0;c<s.length;c+=1)l.push(a(s[c]));return l},r.topologicalSort=function(s){var a=[],l=[],c=[];for(var u in s)!l[u]&&!c[u]&&r._topologicalSort(u,l,c,s,a);return a},r._topologicalSort=function(s,a,l,c,u){var d=c[s]||[];l[s]=!0;for(var f=0;f<d.length;f+=1){var h=d[f];l[h]||a[h]||r._topologicalSort(h,a,l,c,u)}l[s]=!1,a[s]=!0,u.push(s)},r.chain=function(){for(var s=[],a=0;a<arguments.length;a+=1){var l=arguments[a];l._chained?s.push.apply(s,l._chained):s.push(l)}var c=function(){for(var u,d=new Array(arguments.length),f=0,h=arguments.length;f<h;f++)d[f]=arguments[f];for(f=0;f<s.length;f+=1){var p=s[f].apply(u,d);typeof p<"u"&&(u=p)}return u};return c._chained=s,c},r.chainPathBefore=function(s,a,l){return r.set(s,a,r.chain(l,r.get(s,a)))},r.chainPathAfter=function(s,a,l){return r.set(s,a,r.chain(r.get(s,a),l))},r.setDecomp=function(s){r._decomp=s},r.getDecomp=function(){var s=r._decomp;try{!s&&typeof window<"u"&&(s=window.decomp),!s&&typeof mo<"u"&&(s=mo.decomp)}catch{s=null}return s}}()},function(t,i){var r={};t.exports=r,function(){r.create=function(o){var s={min:{x:0,y:0},max:{x:0,y:0}};return o&&r.update(s,o),s},r.update=function(o,s,a){o.min.x=1/0,o.max.x=-1/0,o.min.y=1/0,o.max.y=-1/0;for(var l=0;l<s.length;l++){var c=s[l];c.x>o.max.x&&(o.max.x=c.x),c.x<o.min.x&&(o.min.x=c.x),c.y>o.max.y&&(o.max.y=c.y),c.y<o.min.y&&(o.min.y=c.y)}a&&(a.x>0?o.max.x+=a.x:o.min.x+=a.x,a.y>0?o.max.y+=a.y:o.min.y+=a.y)},r.contains=function(o,s){return s.x>=o.min.x&&s.x<=o.max.x&&s.y>=o.min.y&&s.y<=o.max.y},r.overlaps=function(o,s){return o.min.x<=s.max.x&&o.max.x>=s.min.x&&o.max.y>=s.min.y&&o.min.y<=s.max.y},r.translate=function(o,s){o.min.x+=s.x,o.max.x+=s.x,o.min.y+=s.y,o.max.y+=s.y},r.shift=function(o,s){var a=o.max.x-o.min.x,l=o.max.y-o.min.y;o.min.x=s.x,o.max.x=s.x+a,o.min.y=s.y,o.max.y=s.y+l}}()},function(t,i){var r={};t.exports=r,function(){r.create=function(o,s){return{x:o||0,y:s||0}},r.clone=function(o){return{x:o.x,y:o.y}},r.magnitude=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},r.magnitudeSquared=function(o){return o.x*o.x+o.y*o.y},r.rotate=function(o,s,a){var l=Math.cos(s),c=Math.sin(s);a||(a={});var u=o.x*l-o.y*c;return a.y=o.x*c+o.y*l,a.x=u,a},r.rotateAbout=function(o,s,a,l){var c=Math.cos(s),u=Math.sin(s);l||(l={});var d=a.x+((o.x-a.x)*c-(o.y-a.y)*u);return l.y=a.y+((o.x-a.x)*u+(o.y-a.y)*c),l.x=d,l},r.normalise=function(o){var s=r.magnitude(o);return s===0?{x:0,y:0}:{x:o.x/s,y:o.y/s}},r.dot=function(o,s){return o.x*s.x+o.y*s.y},r.cross=function(o,s){return o.x*s.y-o.y*s.x},r.cross3=function(o,s,a){return(s.x-o.x)*(a.y-o.y)-(s.y-o.y)*(a.x-o.x)},r.add=function(o,s,a){return a||(a={}),a.x=o.x+s.x,a.y=o.y+s.y,a},r.sub=function(o,s,a){return a||(a={}),a.x=o.x-s.x,a.y=o.y-s.y,a},r.mult=function(o,s){return{x:o.x*s,y:o.y*s}},r.div=function(o,s){return{x:o.x/s,y:o.y/s}},r.perp=function(o,s){return s=s===!0?-1:1,{x:s*-o.y,y:s*o.x}},r.neg=function(o){return{x:-o.x,y:-o.y}},r.angle=function(o,s){return Math.atan2(s.y-o.y,s.x-o.x)},r._temp=[r.create(),r.create(),r.create(),r.create(),r.create(),r.create()]}()},function(t,i,r){var o={};t.exports=o;var s=r(2),a=r(0);(function(){o.create=function(l,c){for(var u=[],d=0;d<l.length;d++){var f=l[d],h={x:f.x,y:f.y,index:d,body:c,isInternal:!1};u.push(h)}return u},o.fromPath=function(l,c){var u=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,d=[];return l.replace(u,function(f,h,p){d.push({x:parseFloat(h),y:parseFloat(p)})}),o.create(d,c)},o.centre=function(l){for(var c=o.area(l,!0),u={x:0,y:0},d,f,h,p=0;p<l.length;p++)h=(p+1)%l.length,d=s.cross(l[p],l[h]),f=s.mult(s.add(l[p],l[h]),d),u=s.add(u,f);return s.div(u,6*c)},o.mean=function(l){for(var c={x:0,y:0},u=0;u<l.length;u++)c.x+=l[u].x,c.y+=l[u].y;return s.div(c,l.length)},o.area=function(l,c){for(var u=0,d=l.length-1,f=0;f<l.length;f++)u+=(l[d].x-l[f].x)*(l[d].y+l[f].y),d=f;return c?u/2:Math.abs(u)/2},o.inertia=function(l,c){for(var u=0,d=0,f=l,h,p,m=0;m<f.length;m++)p=(m+1)%f.length,h=Math.abs(s.cross(f[p],f[m])),u+=h*(s.dot(f[p],f[p])+s.dot(f[p],f[m])+s.dot(f[m],f[m])),d+=h;return c/6*(u/d)},o.translate=function(l,c,u){u=typeof u<"u"?u:1;var d=l.length,f=c.x*u,h=c.y*u,p;for(p=0;p<d;p++)l[p].x+=f,l[p].y+=h;return l},o.rotate=function(l,c,u){if(c!==0){var d=Math.cos(c),f=Math.sin(c),h=u.x,p=u.y,m=l.length,g,v,x,b;for(b=0;b<m;b++)g=l[b],v=g.x-h,x=g.y-p,g.x=h+(v*d-x*f),g.y=p+(v*f+x*d);return l}},o.contains=function(l,c){for(var u=c.x,d=c.y,f=l.length,h=l[f-1],p,m=0;m<f;m++){if(p=l[m],(u-h.x)*(p.y-h.y)+(d-h.y)*(h.x-p.x)>0)return!1;h=p}return!0},o.scale=function(l,c,u,d){if(c===1&&u===1)return l;d=d||o.centre(l);for(var f,h,p=0;p<l.length;p++)f=l[p],h=s.sub(f,d),l[p].x=d.x+h.x*c,l[p].y=d.y+h.y*u;return l},o.chamfer=function(l,c,u,d,f){typeof c=="number"?c=[c]:c=c||[8],u=typeof u<"u"?u:-1,d=d||2,f=f||14;for(var h=[],p=0;p<l.length;p++){var m=l[p-1>=0?p-1:l.length-1],g=l[p],v=l[(p+1)%l.length],x=c[p<c.length?p:c.length-1];if(x===0){h.push(g);continue}var b=s.normalise({x:g.y-m.y,y:m.x-g.x}),w=s.normalise({x:v.y-g.y,y:g.x-v.x}),y=Math.sqrt(2*Math.pow(x,2)),C=s.mult(a.clone(b),x),$=s.normalise(s.mult(s.add(b,w),.5)),I=s.sub(g,s.mult($,y)),E=u;u===-1&&(E=Math.pow(x,.32)*1.75),E=a.clamp(E,d,f),E%2===1&&(E+=1);for(var N=Math.acos(s.dot(b,w)),k=N/E,D=0;D<E;D++)h.push(s.add(s.rotate(C,k*D),I))}return h},o.clockwiseSort=function(l){var c=o.mean(l);return l.sort(function(u,d){return s.angle(c,u)-s.angle(c,d)}),l},o.isConvex=function(l){var c=0,u=l.length,d,f,h,p;if(u<3)return null;for(d=0;d<u;d++)if(f=(d+1)%u,h=(d+2)%u,p=(l[f].x-l[d].x)*(l[h].y-l[f].y),p-=(l[f].y-l[d].y)*(l[h].x-l[f].x),p<0?c|=1:p>0&&(c|=2),c===3)return!1;return c!==0?!0:null},o.hull=function(l){var c=[],u=[],d,f;for(l=l.slice(0),l.sort(function(h,p){var m=h.x-p.x;return m!==0?m:h.y-p.y}),f=0;f<l.length;f+=1){for(d=l[f];u.length>=2&&s.cross3(u[u.length-2],u[u.length-1],d)<=0;)u.pop();u.push(d)}for(f=l.length-1;f>=0;f-=1){for(d=l[f];c.length>=2&&s.cross3(c[c.length-2],c[c.length-1],d)<=0;)c.pop();c.push(d)}return c.pop(),u.pop(),c.concat(u)}})()},function(t,i,r){var o={};t.exports=o;var s=r(3),a=r(2),l=r(7),c=r(0),u=r(1),d=r(11);(function(){o._timeCorrection=!0,o._inertiaScale=4,o._nextCollidingGroupId=1,o._nextNonCollidingGroupId=-1,o._nextCategory=1,o._baseDelta=1e3/60,o.create=function(h){var p={id:c.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:s.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},m=c.extend(p,h);return f(m,h),m},o.nextGroup=function(h){return h?o._nextNonCollidingGroupId--:o._nextCollidingGroupId++},o.nextCategory=function(){return o._nextCategory=o._nextCategory<<1,o._nextCategory};var f=function(h,p){p=p||{},o.set(h,{bounds:h.bounds||u.create(h.vertices),positionPrev:h.positionPrev||a.clone(h.position),anglePrev:h.anglePrev||h.angle,vertices:h.vertices,parts:h.parts||[h],isStatic:h.isStatic,isSleeping:h.isSleeping,parent:h.parent||h}),s.rotate(h.vertices,h.angle,h.position),d.rotate(h.axes,h.angle),u.update(h.bounds,h.vertices,h.velocity),o.set(h,{axes:p.axes||h.axes,area:p.area||h.area,mass:p.mass||h.mass,inertia:p.inertia||h.inertia});var m=h.isStatic?"#14151f":c.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),g=h.isStatic?"#555":"#ccc",v=h.isStatic&&h.render.fillStyle===null?1:0;h.render.fillStyle=h.render.fillStyle||m,h.render.strokeStyle=h.render.strokeStyle||g,h.render.lineWidth=h.render.lineWidth||v,h.render.sprite.xOffset+=-(h.bounds.min.x-h.position.x)/(h.bounds.max.x-h.bounds.min.x),h.render.sprite.yOffset+=-(h.bounds.min.y-h.position.y)/(h.bounds.max.y-h.bounds.min.y)};o.set=function(h,p,m){var g;typeof p=="string"&&(g=p,p={},p[g]=m);for(g in p)if(Object.prototype.hasOwnProperty.call(p,g))switch(m=p[g],g){case"isStatic":o.setStatic(h,m);break;case"isSleeping":l.set(h,m);break;case"mass":o.setMass(h,m);break;case"density":o.setDensity(h,m);break;case"inertia":o.setInertia(h,m);break;case"vertices":o.setVertices(h,m);break;case"position":o.setPosition(h,m);break;case"angle":o.setAngle(h,m);break;case"velocity":o.setVelocity(h,m);break;case"angularVelocity":o.setAngularVelocity(h,m);break;case"speed":o.setSpeed(h,m);break;case"angularSpeed":o.setAngularSpeed(h,m);break;case"parts":o.setParts(h,m);break;case"centre":o.setCentre(h,m);break;default:h[g]=m}},o.setStatic=function(h,p){for(var m=0;m<h.parts.length;m++){var g=h.parts[m];p?(g.isStatic||(g._original={restitution:g.restitution,friction:g.friction,mass:g.mass,inertia:g.inertia,density:g.density,inverseMass:g.inverseMass,inverseInertia:g.inverseInertia}),g.restitution=0,g.friction=1,g.mass=g.inertia=g.density=1/0,g.inverseMass=g.inverseInertia=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.angularVelocity=0,g.speed=0,g.angularSpeed=0,g.motion=0):g._original&&(g.restitution=g._original.restitution,g.friction=g._original.friction,g.mass=g._original.mass,g.inertia=g._original.inertia,g.density=g._original.density,g.inverseMass=g._original.inverseMass,g.inverseInertia=g._original.inverseInertia,g._original=null),g.isStatic=p}},o.setMass=function(h,p){var m=h.inertia/(h.mass/6);h.inertia=m*(p/6),h.inverseInertia=1/h.inertia,h.mass=p,h.inverseMass=1/h.mass,h.density=h.mass/h.area},o.setDensity=function(h,p){o.setMass(h,p*h.area),h.density=p},o.setInertia=function(h,p){h.inertia=p,h.inverseInertia=1/h.inertia},o.setVertices=function(h,p){p[0].body===h?h.vertices=p:h.vertices=s.create(p,h),h.axes=d.fromVertices(h.vertices),h.area=s.area(h.vertices),o.setMass(h,h.density*h.area);var m=s.centre(h.vertices);s.translate(h.vertices,m,-1),o.setInertia(h,o._inertiaScale*s.inertia(h.vertices,h.mass)),s.translate(h.vertices,h.position),u.update(h.bounds,h.vertices,h.velocity)},o.setParts=function(h,p,m){var g;for(p=p.slice(0),h.parts.length=0,h.parts.push(h),h.parent=h,g=0;g<p.length;g++){var v=p[g];v!==h&&(v.parent=h,h.parts.push(v))}if(h.parts.length!==1){if(m=typeof m<"u"?m:!0,m){var x=[];for(g=0;g<p.length;g++)x=x.concat(p[g].vertices);s.clockwiseSort(x);var b=s.hull(x),w=s.centre(b);o.setVertices(h,b),s.translate(h.vertices,w)}var y=o._totalProperties(h);h.area=y.area,h.parent=h,h.position.x=y.centre.x,h.position.y=y.centre.y,h.positionPrev.x=y.centre.x,h.positionPrev.y=y.centre.y,o.setMass(h,y.mass),o.setInertia(h,y.inertia),o.setPosition(h,y.centre)}},o.setCentre=function(h,p,m){m?(h.positionPrev.x+=p.x,h.positionPrev.y+=p.y,h.position.x+=p.x,h.position.y+=p.y):(h.positionPrev.x=p.x-(h.position.x-h.positionPrev.x),h.positionPrev.y=p.y-(h.position.y-h.positionPrev.y),h.position.x=p.x,h.position.y=p.y)},o.setPosition=function(h,p,m){var g=a.sub(p,h.position);m?(h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.velocity.x=g.x,h.velocity.y=g.y,h.speed=a.magnitude(g)):(h.positionPrev.x+=g.x,h.positionPrev.y+=g.y);for(var v=0;v<h.parts.length;v++){var x=h.parts[v];x.position.x+=g.x,x.position.y+=g.y,s.translate(x.vertices,g),u.update(x.bounds,x.vertices,h.velocity)}},o.setAngle=function(h,p,m){var g=p-h.angle;m?(h.anglePrev=h.angle,h.angularVelocity=g,h.angularSpeed=Math.abs(g)):h.anglePrev+=g;for(var v=0;v<h.parts.length;v++){var x=h.parts[v];x.angle+=g,s.rotate(x.vertices,g,h.position),d.rotate(x.axes,g),u.update(x.bounds,x.vertices,h.velocity),v>0&&a.rotateAbout(x.position,g,h.position,x.position)}},o.setVelocity=function(h,p){var m=h.deltaTime/o._baseDelta;h.positionPrev.x=h.position.x-p.x*m,h.positionPrev.y=h.position.y-p.y*m,h.velocity.x=(h.position.x-h.positionPrev.x)/m,h.velocity.y=(h.position.y-h.positionPrev.y)/m,h.speed=a.magnitude(h.velocity)},o.getVelocity=function(h){var p=o._baseDelta/h.deltaTime;return{x:(h.position.x-h.positionPrev.x)*p,y:(h.position.y-h.positionPrev.y)*p}},o.getSpeed=function(h){return a.magnitude(o.getVelocity(h))},o.setSpeed=function(h,p){o.setVelocity(h,a.mult(a.normalise(o.getVelocity(h)),p))},o.setAngularVelocity=function(h,p){var m=h.deltaTime/o._baseDelta;h.anglePrev=h.angle-p*m,h.angularVelocity=(h.angle-h.anglePrev)/m,h.angularSpeed=Math.abs(h.angularVelocity)},o.getAngularVelocity=function(h){return(h.angle-h.anglePrev)*o._baseDelta/h.deltaTime},o.getAngularSpeed=function(h){return Math.abs(o.getAngularVelocity(h))},o.setAngularSpeed=function(h,p){o.setAngularVelocity(h,c.sign(o.getAngularVelocity(h))*p)},o.translate=function(h,p,m){o.setPosition(h,a.add(h.position,p),m)},o.rotate=function(h,p,m,g){if(!m)o.setAngle(h,h.angle+p,g);else{var v=Math.cos(p),x=Math.sin(p),b=h.position.x-m.x,w=h.position.y-m.y;o.setPosition(h,{x:m.x+(b*v-w*x),y:m.y+(b*x+w*v)},g),o.setAngle(h,h.angle+p,g)}},o.scale=function(h,p,m,g){var v=0,x=0;g=g||h.position;for(var b=0;b<h.parts.length;b++){var w=h.parts[b];s.scale(w.vertices,p,m,g),w.axes=d.fromVertices(w.vertices),w.area=s.area(w.vertices),o.setMass(w,h.density*w.area),s.translate(w.vertices,{x:-w.position.x,y:-w.position.y}),o.setInertia(w,o._inertiaScale*s.inertia(w.vertices,w.mass)),s.translate(w.vertices,{x:w.position.x,y:w.position.y}),b>0&&(v+=w.area,x+=w.inertia),w.position.x=g.x+(w.position.x-g.x)*p,w.position.y=g.y+(w.position.y-g.y)*m,u.update(w.bounds,w.vertices,h.velocity)}h.parts.length>1&&(h.area=v,h.isStatic||(o.setMass(h,h.density*v),o.setInertia(h,x))),h.circleRadius&&(p===m?h.circleRadius*=p:h.circleRadius=null)},o.update=function(h,p){p=(typeof p<"u"?p:1e3/60)*h.timeScale;var m=p*p,g=o._timeCorrection?p/(h.deltaTime||p):1,v=1-h.frictionAir*(p/c._baseDelta),x=(h.position.x-h.positionPrev.x)*g,b=(h.position.y-h.positionPrev.y)*g;h.velocity.x=x*v+h.force.x/h.mass*m,h.velocity.y=b*v+h.force.y/h.mass*m,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.position.x+=h.velocity.x,h.position.y+=h.velocity.y,h.deltaTime=p,h.angularVelocity=(h.angle-h.anglePrev)*v*g+h.torque/h.inertia*m,h.anglePrev=h.angle,h.angle+=h.angularVelocity;for(var w=0;w<h.parts.length;w++){var y=h.parts[w];s.translate(y.vertices,h.velocity),w>0&&(y.position.x+=h.velocity.x,y.position.y+=h.velocity.y),h.angularVelocity!==0&&(s.rotate(y.vertices,h.angularVelocity,h.position),d.rotate(y.axes,h.angularVelocity),w>0&&a.rotateAbout(y.position,h.angularVelocity,h.position,y.position)),u.update(y.bounds,y.vertices,h.velocity)}},o.updateVelocities=function(h){var p=o._baseDelta/h.deltaTime,m=h.velocity;m.x=(h.position.x-h.positionPrev.x)*p,m.y=(h.position.y-h.positionPrev.y)*p,h.speed=Math.sqrt(m.x*m.x+m.y*m.y),h.angularVelocity=(h.angle-h.anglePrev)*p,h.angularSpeed=Math.abs(h.angularVelocity)},o.applyForce=function(h,p,m){var g={x:p.x-h.position.x,y:p.y-h.position.y};h.force.x+=m.x,h.force.y+=m.y,h.torque+=g.x*m.y-g.y*m.x},o._totalProperties=function(h){for(var p={mass:0,area:0,inertia:0,centre:{x:0,y:0}},m=h.parts.length===1?0:1;m<h.parts.length;m++){var g=h.parts[m],v=g.mass!==1/0?g.mass:1;p.mass+=v,p.area+=g.area,p.inertia+=g.inertia,p.centre=a.add(p.centre,a.mult(g.position,v))}return p.centre=a.div(p.centre,p.mass),p}})()},function(t,i,r){var o={};t.exports=o;var s=r(0);(function(){o.on=function(a,l,c){for(var u=l.split(" "),d,f=0;f<u.length;f++)d=u[f],a.events=a.events||{},a.events[d]=a.events[d]||[],a.events[d].push(c);return c},o.off=function(a,l,c){if(!l){a.events={};return}typeof l=="function"&&(c=l,l=s.keys(a.events).join(" "));for(var u=l.split(" "),d=0;d<u.length;d++){var f=a.events[u[d]],h=[];if(c&&f)for(var p=0;p<f.length;p++)f[p]!==c&&h.push(f[p]);a.events[u[d]]=h}},o.trigger=function(a,l,c){var u,d,f,h,p=a.events;if(p&&s.keys(p).length>0){c||(c={}),u=l.split(" ");for(var m=0;m<u.length;m++)if(d=u[m],f=p[d],f){h=s.clone(c,!1),h.name=d,h.source=a;for(var g=0;g<f.length;g++)f[g].apply(a,[h])}}}})()},function(t,i,r){var o={};t.exports=o;var s=r(5),a=r(0),l=r(1),c=r(4);(function(){o.create=function(u){return a.extend({id:a.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},u)},o.setModified=function(u,d,f,h){if(u.isModified=d,d&&u.cache&&(u.cache.allBodies=null,u.cache.allConstraints=null,u.cache.allComposites=null),f&&u.parent&&o.setModified(u.parent,d,f,h),h)for(var p=0;p<u.composites.length;p++){var m=u.composites[p];o.setModified(m,d,f,h)}},o.add=function(u,d){var f=[].concat(d);s.trigger(u,"beforeAdd",{object:d});for(var h=0;h<f.length;h++){var p=f[h];switch(p.type){case"body":if(p.parent!==p){a.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}o.addBody(u,p);break;case"constraint":o.addConstraint(u,p);break;case"composite":o.addComposite(u,p);break;case"mouseConstraint":o.addConstraint(u,p.constraint);break}}return s.trigger(u,"afterAdd",{object:d}),u},o.remove=function(u,d,f){var h=[].concat(d);s.trigger(u,"beforeRemove",{object:d});for(var p=0;p<h.length;p++){var m=h[p];switch(m.type){case"body":o.removeBody(u,m,f);break;case"constraint":o.removeConstraint(u,m,f);break;case"composite":o.removeComposite(u,m,f);break;case"mouseConstraint":o.removeConstraint(u,m.constraint);break}}return s.trigger(u,"afterRemove",{object:d}),u},o.addComposite=function(u,d){return u.composites.push(d),d.parent=u,o.setModified(u,!0,!0,!1),u},o.removeComposite=function(u,d,f){var h=a.indexOf(u.composites,d);if(h!==-1){var p=o.allBodies(d);o.removeCompositeAt(u,h);for(var m=0;m<p.length;m++)p[m].sleepCounter=0}if(f)for(var m=0;m<u.composites.length;m++)o.removeComposite(u.composites[m],d,!0);return u},o.removeCompositeAt=function(u,d){return u.composites.splice(d,1),o.setModified(u,!0,!0,!1),u},o.addBody=function(u,d){return u.bodies.push(d),o.setModified(u,!0,!0,!1),u},o.removeBody=function(u,d,f){var h=a.indexOf(u.bodies,d);if(h!==-1&&(o.removeBodyAt(u,h),d.sleepCounter=0),f)for(var p=0;p<u.composites.length;p++)o.removeBody(u.composites[p],d,!0);return u},o.removeBodyAt=function(u,d){return u.bodies.splice(d,1),o.setModified(u,!0,!0,!1),u},o.addConstraint=function(u,d){return u.constraints.push(d),o.setModified(u,!0,!0,!1),u},o.removeConstraint=function(u,d,f){var h=a.indexOf(u.constraints,d);if(h!==-1&&o.removeConstraintAt(u,h),f)for(var p=0;p<u.composites.length;p++)o.removeConstraint(u.composites[p],d,!0);return u},o.removeConstraintAt=function(u,d){return u.constraints.splice(d,1),o.setModified(u,!0,!0,!1),u},o.clear=function(u,d,f){if(f)for(var h=0;h<u.composites.length;h++)o.clear(u.composites[h],d,!0);return d?u.bodies=u.bodies.filter(function(p){return p.isStatic}):u.bodies.length=0,u.constraints.length=0,u.composites.length=0,o.setModified(u,!0,!0,!1),u},o.allBodies=function(u){if(u.cache&&u.cache.allBodies)return u.cache.allBodies;for(var d=[].concat(u.bodies),f=0;f<u.composites.length;f++)d=d.concat(o.allBodies(u.composites[f]));return u.cache&&(u.cache.allBodies=d),d},o.allConstraints=function(u){if(u.cache&&u.cache.allConstraints)return u.cache.allConstraints;for(var d=[].concat(u.constraints),f=0;f<u.composites.length;f++)d=d.concat(o.allConstraints(u.composites[f]));return u.cache&&(u.cache.allConstraints=d),d},o.allComposites=function(u){if(u.cache&&u.cache.allComposites)return u.cache.allComposites;for(var d=[].concat(u.composites),f=0;f<u.composites.length;f++)d=d.concat(o.allComposites(u.composites[f]));return u.cache&&(u.cache.allComposites=d),d},o.get=function(u,d,f){var h,p;switch(f){case"body":h=o.allBodies(u);break;case"constraint":h=o.allConstraints(u);break;case"composite":h=o.allComposites(u).concat(u);break}return h?(p=h.filter(function(m){return m.id.toString()===d.toString()}),p.length===0?null:p[0]):null},o.move=function(u,d,f){return o.remove(u,d),o.add(f,d),u},o.rebase=function(u){for(var d=o.allBodies(u).concat(o.allConstraints(u)).concat(o.allComposites(u)),f=0;f<d.length;f++)d[f].id=a.nextId();return u},o.translate=function(u,d,f){for(var h=f?o.allBodies(u):u.bodies,p=0;p<h.length;p++)c.translate(h[p],d);return u},o.rotate=function(u,d,f,h){for(var p=Math.cos(d),m=Math.sin(d),g=h?o.allBodies(u):u.bodies,v=0;v<g.length;v++){var x=g[v],b=x.position.x-f.x,w=x.position.y-f.y;c.setPosition(x,{x:f.x+(b*p-w*m),y:f.y+(b*m+w*p)}),c.rotate(x,d)}return u},o.scale=function(u,d,f,h,p){for(var m=p?o.allBodies(u):u.bodies,g=0;g<m.length;g++){var v=m[g],x=v.position.x-h.x,b=v.position.y-h.y;c.setPosition(v,{x:h.x+x*d,y:h.y+b*f}),c.scale(v,d,f)}return u},o.bounds=function(u){for(var d=o.allBodies(u),f=[],h=0;h<d.length;h+=1){var p=d[h];f.push(p.bounds.min,p.bounds.max)}return l.create(f)}})()},function(t,i,r){var o={};t.exports=o;var s=r(4),a=r(5),l=r(0);(function(){o._motionWakeThreshold=.18,o._motionSleepThreshold=.08,o._minBias=.9,o.update=function(c,u){for(var d=u/l._baseDelta,f=o._motionSleepThreshold,h=0;h<c.length;h++){var p=c[h],m=s.getSpeed(p),g=s.getAngularSpeed(p),v=m*m+g*g;if(p.force.x!==0||p.force.y!==0){o.set(p,!1);continue}var x=Math.min(p.motion,v),b=Math.max(p.motion,v);p.motion=o._minBias*x+(1-o._minBias)*b,p.sleepThreshold>0&&p.motion<f?(p.sleepCounter+=1,p.sleepCounter>=p.sleepThreshold/d&&o.set(p,!0)):p.sleepCounter>0&&(p.sleepCounter-=1)}},o.afterCollisions=function(c){for(var u=o._motionSleepThreshold,d=0;d<c.length;d++){var f=c[d];if(f.isActive){var h=f.collision,p=h.bodyA.parent,m=h.bodyB.parent;if(!(p.isSleeping&&m.isSleeping||p.isStatic||m.isStatic)&&(p.isSleeping||m.isSleeping)){var g=p.isSleeping&&!p.isStatic?p:m,v=g===p?m:p;!g.isStatic&&v.motion>u&&o.set(g,!1)}}}},o.set=function(c,u){var d=c.isSleeping;u?(c.isSleeping=!0,c.sleepCounter=c.sleepThreshold,c.positionImpulse.x=0,c.positionImpulse.y=0,c.positionPrev.x=c.position.x,c.positionPrev.y=c.position.y,c.anglePrev=c.angle,c.speed=0,c.angularSpeed=0,c.motion=0,d||a.trigger(c,"sleepStart")):(c.isSleeping=!1,c.sleepCounter=0,d&&a.trigger(c,"sleepEnd"))}})()},function(t,i,r){var o={};t.exports=o;var s=r(3),a=r(9);(function(){var l=[],c={overlap:0,axis:null},u={overlap:0,axis:null};o.create=function(d,f){return{pair:null,collided:!1,bodyA:d,bodyB:f,parentA:d.parent,parentB:f.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},o.collides=function(d,f,h){if(o._overlapAxes(c,d.vertices,f.vertices,d.axes),c.overlap<=0||(o._overlapAxes(u,f.vertices,d.vertices,f.axes),u.overlap<=0))return null;var p=h&&h.table[a.id(d,f)],m;p?m=p.collision:(m=o.create(d,f),m.collided=!0,m.bodyA=d.id<f.id?d:f,m.bodyB=d.id<f.id?f:d,m.parentA=m.bodyA.parent,m.parentB=m.bodyB.parent),d=m.bodyA,f=m.bodyB;var g;c.overlap<u.overlap?g=c:g=u;var v=m.normal,x=m.tangent,b=m.penetration,w=m.supports,y=g.overlap,C=g.axis,$=C.x,I=C.y,E=f.position.x-d.position.x,N=f.position.y-d.position.y;$*E+I*N>=0&&($=-$,I=-I),v.x=$,v.y=I,x.x=-I,x.y=$,b.x=$*y,b.y=I*y,m.depth=y;var k=o._findSupports(d,f,v,1),D=0;if(s.contains(d.vertices,k[0])&&(w[D++]=k[0]),s.contains(d.vertices,k[1])&&(w[D++]=k[1]),D<2){var _=o._findSupports(f,d,v,-1);s.contains(f.vertices,_[0])&&(w[D++]=_[0]),D<2&&s.contains(f.vertices,_[1])&&(w[D++]=_[1])}return D===0&&(w[D++]=k[0]),m.supportCount=D,m},o._overlapAxes=function(d,f,h,p){var m=f.length,g=h.length,v=f[0].x,x=f[0].y,b=h[0].x,w=h[0].y,y=p.length,C=Number.MAX_VALUE,$=0,I,E,N,k,D,_;for(D=0;D<y;D++){var R=p[D],T=R.x,A=R.y,O=v*T+x*A,P=b*T+w*A,M=O,z=P;for(_=1;_<m;_+=1)k=f[_].x*T+f[_].y*A,k>M?M=k:k<O&&(O=k);for(_=1;_<g;_+=1)k=h[_].x*T+h[_].y*A,k>z?z=k:k<P&&(P=k);if(E=M-P,N=z-O,I=E<N?E:N,I<C&&(C=I,$=D,I<=0))break}d.axis=p[$],d.overlap=C},o._findSupports=function(d,f,h,p){var m=f.vertices,g=m.length,v=d.position.x,x=d.position.y,b=h.x*p,w=h.y*p,y=m[0],C=y,$=b*(v-C.x)+w*(x-C.y),I,E,N;for(N=1;N<g;N+=1)C=m[N],E=b*(v-C.x)+w*(x-C.y),E<$&&($=E,y=C);return I=m[(g+y.index-1)%g],$=b*(v-I.x)+w*(x-I.y),C=m[(y.index+1)%g],b*(v-C.x)+w*(x-C.y)<$?(l[0]=y,l[1]=C,l):(l[0]=y,l[1]=I,l)}})()},function(t,i,r){var o={};t.exports=o;var s=r(16);(function(){o.create=function(a,l){var c=a.bodyA,u=a.bodyB,d={id:o.id(c,u),bodyA:c,bodyB:u,collision:a,contacts:[s.create(),s.create()],contactCount:0,separation:0,isActive:!0,isSensor:c.isSensor||u.isSensor,timeCreated:l,timeUpdated:l,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return o.update(d,a,l),d},o.update=function(a,l,c){var u=l.supports,d=l.supportCount,f=a.contacts,h=l.parentA,p=l.parentB;a.isActive=!0,a.timeUpdated=c,a.collision=l,a.separation=l.depth,a.inverseMass=h.inverseMass+p.inverseMass,a.friction=h.friction<p.friction?h.friction:p.friction,a.frictionStatic=h.frictionStatic>p.frictionStatic?h.frictionStatic:p.frictionStatic,a.restitution=h.restitution>p.restitution?h.restitution:p.restitution,a.slop=h.slop>p.slop?h.slop:p.slop,a.contactCount=d,l.pair=a;var m=u[0],g=f[0],v=u[1],x=f[1];(x.vertex===m||g.vertex===v)&&(f[1]=g,f[0]=g=x,x=f[1]),g.vertex=m,x.vertex=v},o.setActive=function(a,l,c){l?(a.isActive=!0,a.timeUpdated=c):(a.isActive=!1,a.contactCount=0)},o.id=function(a,l){return a.id<l.id?a.id.toString(36)+":"+l.id.toString(36):l.id.toString(36)+":"+a.id.toString(36)}})()},function(t,i,r){var o={};t.exports=o;var s=r(3),a=r(2),l=r(7),c=r(1),u=r(11),d=r(0);(function(){o._warming=.4,o._torqueDampen=1,o._minLength=1e-6,o.create=function(f){var h=f;h.bodyA&&!h.pointA&&(h.pointA={x:0,y:0}),h.bodyB&&!h.pointB&&(h.pointB={x:0,y:0});var p=h.bodyA?a.add(h.bodyA.position,h.pointA):h.pointA,m=h.bodyB?a.add(h.bodyB.position,h.pointB):h.pointB,g=a.magnitude(a.sub(p,m));h.length=typeof h.length<"u"?h.length:g,h.id=h.id||d.nextId(),h.label=h.label||"Constraint",h.type="constraint",h.stiffness=h.stiffness||(h.length>0?1:.7),h.damping=h.damping||0,h.angularStiffness=h.angularStiffness||0,h.angleA=h.bodyA?h.bodyA.angle:h.angleA,h.angleB=h.bodyB?h.bodyB.angle:h.angleB,h.plugin={};var v={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return h.length===0&&h.stiffness>.1?(v.type="pin",v.anchors=!1):h.stiffness<.9&&(v.type="spring"),h.render=d.extend(v,h.render),h},o.preSolveAll=function(f){for(var h=0;h<f.length;h+=1){var p=f[h],m=p.constraintImpulse;p.isStatic||m.x===0&&m.y===0&&m.angle===0||(p.position.x+=m.x,p.position.y+=m.y,p.angle+=m.angle)}},o.solveAll=function(f,h){for(var p=d.clamp(h/d._baseDelta,0,1),m=0;m<f.length;m+=1){var g=f[m],v=!g.bodyA||g.bodyA&&g.bodyA.isStatic,x=!g.bodyB||g.bodyB&&g.bodyB.isStatic;(v||x)&&o.solve(f[m],p)}for(m=0;m<f.length;m+=1)g=f[m],v=!g.bodyA||g.bodyA&&g.bodyA.isStatic,x=!g.bodyB||g.bodyB&&g.bodyB.isStatic,!v&&!x&&o.solve(f[m],p)},o.solve=function(f,h){var p=f.bodyA,m=f.bodyB,g=f.pointA,v=f.pointB;if(!(!p&&!m)){p&&!p.isStatic&&(a.rotate(g,p.angle-f.angleA,g),f.angleA=p.angle),m&&!m.isStatic&&(a.rotate(v,m.angle-f.angleB,v),f.angleB=m.angle);var x=g,b=v;if(p&&(x=a.add(p.position,g)),m&&(b=a.add(m.position,v)),!(!x||!b)){var w=a.sub(x,b),y=a.magnitude(w);y<o._minLength&&(y=o._minLength);var C=(y-f.length)/y,$=f.stiffness>=1||f.length===0,I=$?f.stiffness*h:f.stiffness*h*h,E=f.damping*h,N=a.mult(w,C*I),k=(p?p.inverseMass:0)+(m?m.inverseMass:0),D=(p?p.inverseInertia:0)+(m?m.inverseInertia:0),_=k+D,R,T,A,O,P;if(E>0){var M=a.create();A=a.div(w,y),P=a.sub(m&&a.sub(m.position,m.positionPrev)||M,p&&a.sub(p.position,p.positionPrev)||M),O=a.dot(A,P)}p&&!p.isStatic&&(T=p.inverseMass/k,p.constraintImpulse.x-=N.x*T,p.constraintImpulse.y-=N.y*T,p.position.x-=N.x*T,p.position.y-=N.y*T,E>0&&(p.positionPrev.x-=E*A.x*O*T,p.positionPrev.y-=E*A.y*O*T),R=a.cross(g,N)/_*o._torqueDampen*p.inverseInertia*(1-f.angularStiffness),p.constraintImpulse.angle-=R,p.angle-=R),m&&!m.isStatic&&(T=m.inverseMass/k,m.constraintImpulse.x+=N.x*T,m.constraintImpulse.y+=N.y*T,m.position.x+=N.x*T,m.position.y+=N.y*T,E>0&&(m.positionPrev.x+=E*A.x*O*T,m.positionPrev.y+=E*A.y*O*T),R=a.cross(v,N)/_*o._torqueDampen*m.inverseInertia*(1-f.angularStiffness),m.constraintImpulse.angle+=R,m.angle+=R)}}},o.postSolveAll=function(f){for(var h=0;h<f.length;h++){var p=f[h],m=p.constraintImpulse;if(!(p.isStatic||m.x===0&&m.y===0&&m.angle===0)){l.set(p,!1);for(var g=0;g<p.parts.length;g++){var v=p.parts[g];s.translate(v.vertices,m),g>0&&(v.position.x+=m.x,v.position.y+=m.y),m.angle!==0&&(s.rotate(v.vertices,m.angle,p.position),u.rotate(v.axes,m.angle),g>0&&a.rotateAbout(v.position,m.angle,p.position,v.position)),c.update(v.bounds,v.vertices,p.velocity)}m.angle*=o._warming,m.x*=o._warming,m.y*=o._warming}}},o.pointAWorld=function(f){return{x:(f.bodyA?f.bodyA.position.x:0)+(f.pointA?f.pointA.x:0),y:(f.bodyA?f.bodyA.position.y:0)+(f.pointA?f.pointA.y:0)}},o.pointBWorld=function(f){return{x:(f.bodyB?f.bodyB.position.x:0)+(f.pointB?f.pointB.x:0),y:(f.bodyB?f.bodyB.position.y:0)+(f.pointB?f.pointB.y:0)}},o.currentLength=function(f){var h=(f.bodyA?f.bodyA.position.x:0)+(f.pointA?f.pointA.x:0),p=(f.bodyA?f.bodyA.position.y:0)+(f.pointA?f.pointA.y:0),m=(f.bodyB?f.bodyB.position.x:0)+(f.pointB?f.pointB.x:0),g=(f.bodyB?f.bodyB.position.y:0)+(f.pointB?f.pointB.y:0),v=h-m,x=p-g;return Math.sqrt(v*v+x*x)}})()},function(t,i,r){var o={};t.exports=o;var s=r(2),a=r(0);(function(){o.fromVertices=function(l){for(var c={},u=0;u<l.length;u++){var d=(u+1)%l.length,f=s.normalise({x:l[d].y-l[u].y,y:l[u].x-l[d].x}),h=f.y===0?1/0:f.x/f.y;h=h.toFixed(3).toString(),c[h]=f}return a.values(c)},o.rotate=function(l,c){if(c!==0)for(var u=Math.cos(c),d=Math.sin(c),f=0;f<l.length;f++){var h=l[f],p;p=h.x*u-h.y*d,h.y=h.x*d+h.y*u,h.x=p}}})()},function(t,i,r){var o={};t.exports=o;var s=r(3),a=r(0),l=r(4),c=r(1),u=r(2);(function(){o.rectangle=function(d,f,h,p,m){m=m||{};var g={label:"Rectangle Body",position:{x:d,y:f},vertices:s.fromPath("L 0 0 L "+h+" 0 L "+h+" "+p+" L 0 "+p)};if(m.chamfer){var v=m.chamfer;g.vertices=s.chamfer(g.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete m.chamfer}return l.create(a.extend({},g,m))},o.trapezoid=function(d,f,h,p,m,g){g=g||{},m>=1&&a.warn("Bodies.trapezoid: slope parameter must be < 1."),m*=.5;var v=(1-m*2)*h,x=h*m,b=x+v,w=b+x,y;m<.5?y="L 0 0 L "+x+" "+-p+" L "+b+" "+-p+" L "+w+" 0":y="L 0 0 L "+b+" "+-p+" L "+w+" 0";var C={label:"Trapezoid Body",position:{x:d,y:f},vertices:s.fromPath(y)};if(g.chamfer){var $=g.chamfer;C.vertices=s.chamfer(C.vertices,$.radius,$.quality,$.qualityMin,$.qualityMax),delete g.chamfer}return l.create(a.extend({},C,g))},o.circle=function(d,f,h,p,m){p=p||{};var g={label:"Circle Body",circleRadius:h};m=m||25;var v=Math.ceil(Math.max(10,Math.min(m,h)));return v%2===1&&(v+=1),o.polygon(d,f,v,h,a.extend({},g,p))},o.polygon=function(d,f,h,p,m){if(m=m||{},h<3)return o.circle(d,f,p,m);for(var g=2*Math.PI/h,v="",x=g*.5,b=0;b<h;b+=1){var w=x+b*g,y=Math.cos(w)*p,C=Math.sin(w)*p;v+="L "+y.toFixed(3)+" "+C.toFixed(3)+" "}var $={label:"Polygon Body",position:{x:d,y:f},vertices:s.fromPath(v)};if(m.chamfer){var I=m.chamfer;$.vertices=s.chamfer($.vertices,I.radius,I.quality,I.qualityMin,I.qualityMax),delete m.chamfer}return l.create(a.extend({},$,m))},o.fromVertices=function(d,f,h,p,m,g,v,x){var b=a.getDecomp(),w,y,C,$,I,E,N,k,D,_,R;for(w=!!(b&&b.quickDecomp),p=p||{},C=[],m=typeof m<"u"?m:!1,g=typeof g<"u"?g:.01,v=typeof v<"u"?v:10,x=typeof x<"u"?x:.01,a.isArray(h[0])||(h=[h]),_=0;_<h.length;_+=1)if(E=h[_],$=s.isConvex(E),I=!$,I&&!w&&a.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),$||!w)$?E=s.clockwiseSort(E):E=s.hull(E),C.push({position:{x:d,y:f},vertices:E});else{var T=E.map(function(Y){return[Y.x,Y.y]});b.makeCCW(T),g!==!1&&b.removeCollinearPoints(T,g),x!==!1&&b.removeDuplicatePoints&&b.removeDuplicatePoints(T,x);var A=b.quickDecomp(T);for(N=0;N<A.length;N++){var O=A[N],P=O.map(function(Y){return{x:Y[0],y:Y[1]}});v>0&&s.area(P)<v||C.push({position:s.centre(P),vertices:P})}}for(N=0;N<C.length;N++)C[N]=l.create(a.extend(C[N],p));if(m){var M=5;for(N=0;N<C.length;N++){var z=C[N];for(k=N+1;k<C.length;k++){var L=C[k];if(c.overlaps(z.bounds,L.bounds)){var W=z.vertices,U=L.vertices;for(D=0;D<z.vertices.length;D++)for(R=0;R<L.vertices.length;R++){var V=u.magnitudeSquared(u.sub(W[(D+1)%W.length],U[R])),H=u.magnitudeSquared(u.sub(W[D],U[(R+1)%U.length]));V<M&&H<M&&(W[D].isInternal=!0,U[R].isInternal=!0)}}}}}return C.length>1?(y=l.create(a.extend({parts:C.slice(0)},p)),l.setPosition(y,{x:d,y:f}),y):C[0]}})()},function(t,i,r){var o={};t.exports=o;var s=r(0),a=r(8);(function(){o.create=function(l){var c={bodies:[],collisions:[],pairs:null};return s.extend(c,l)},o.setBodies=function(l,c){l.bodies=c.slice(0)},o.clear=function(l){l.bodies=[],l.collisions=[]},o.collisions=function(l){var c=l.pairs,u=l.bodies,d=u.length,f=o.canCollide,h=a.collides,p=l.collisions,m=0,g,v;for(u.sort(o._compareBoundsX),g=0;g<d;g++){var x=u[g],b=x.bounds,w=x.bounds.max.x,y=x.bounds.max.y,C=x.bounds.min.y,$=x.isStatic||x.isSleeping,I=x.parts.length,E=I===1;for(v=g+1;v<d;v++){var N=u[v],k=N.bounds;if(k.min.x>w)break;if(!(y<k.min.y||C>k.max.y)&&!($&&(N.isStatic||N.isSleeping))&&f(x.collisionFilter,N.collisionFilter)){var D=N.parts.length;if(E&&D===1){var _=h(x,N,c);_&&(p[m++]=_)}else for(var R=I>1?1:0,T=D>1?1:0,A=R;A<I;A++)for(var O=x.parts[A],b=O.bounds,P=T;P<D;P++){var M=N.parts[P],k=M.bounds;if(!(b.min.x>k.max.x||b.max.x<k.min.x||b.max.y<k.min.y||b.min.y>k.max.y)){var _=h(O,M,c);_&&(p[m++]=_)}}}}}return p.length!==m&&(p.length=m),p},o.canCollide=function(l,c){return l.group===c.group&&l.group!==0?l.group>0:(l.mask&c.category)!==0&&(c.mask&l.category)!==0},o._compareBoundsX=function(l,c){return l.bounds.min.x-c.bounds.min.x}})()},function(t,i,r){var o={};t.exports=o;var s=r(0);(function(){o.create=function(a){var l={};return a||s.log("Mouse.create: element was undefined, defaulting to document.body","warn"),l.element=a||document.body,l.absolute={x:0,y:0},l.position={x:0,y:0},l.mousedownPosition={x:0,y:0},l.mouseupPosition={x:0,y:0},l.offset={x:0,y:0},l.scale={x:1,y:1},l.wheelDelta=0,l.button=-1,l.pixelRatio=parseInt(l.element.getAttribute("data-pixel-ratio"),10)||1,l.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},l.mousemove=function(c){var u=o._getRelativeMousePosition(c,l.element,l.pixelRatio),d=c.changedTouches;d&&(l.button=0,c.preventDefault()),l.absolute.x=u.x,l.absolute.y=u.y,l.position.x=l.absolute.x*l.scale.x+l.offset.x,l.position.y=l.absolute.y*l.scale.y+l.offset.y,l.sourceEvents.mousemove=c},l.mousedown=function(c){var u=o._getRelativeMousePosition(c,l.element,l.pixelRatio),d=c.changedTouches;d?(l.button=0,c.preventDefault()):l.button=c.button,l.absolute.x=u.x,l.absolute.y=u.y,l.position.x=l.absolute.x*l.scale.x+l.offset.x,l.position.y=l.absolute.y*l.scale.y+l.offset.y,l.mousedownPosition.x=l.position.x,l.mousedownPosition.y=l.position.y,l.sourceEvents.mousedown=c},l.mouseup=function(c){var u=o._getRelativeMousePosition(c,l.element,l.pixelRatio),d=c.changedTouches;d&&c.preventDefault(),l.button=-1,l.absolute.x=u.x,l.absolute.y=u.y,l.position.x=l.absolute.x*l.scale.x+l.offset.x,l.position.y=l.absolute.y*l.scale.y+l.offset.y,l.mouseupPosition.x=l.position.x,l.mouseupPosition.y=l.position.y,l.sourceEvents.mouseup=c},l.mousewheel=function(c){l.wheelDelta=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),c.preventDefault(),l.sourceEvents.mousewheel=c},o.setElement(l,l.element),l},o.setElement=function(a,l){a.element=l,l.addEventListener("mousemove",a.mousemove,{passive:!0}),l.addEventListener("mousedown",a.mousedown,{passive:!0}),l.addEventListener("mouseup",a.mouseup,{passive:!0}),l.addEventListener("wheel",a.mousewheel,{passive:!1}),l.addEventListener("touchmove",a.mousemove,{passive:!1}),l.addEventListener("touchstart",a.mousedown,{passive:!1}),l.addEventListener("touchend",a.mouseup,{passive:!1})},o.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},o.setOffset=function(a,l){a.offset.x=l.x,a.offset.y=l.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},o.setScale=function(a,l){a.scale.x=l.x,a.scale.y=l.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},o._getRelativeMousePosition=function(a,l,c){var u=l.getBoundingClientRect(),d=document.documentElement||document.body.parentNode||document.body,f=window.pageXOffset!==void 0?window.pageXOffset:d.scrollLeft,h=window.pageYOffset!==void 0?window.pageYOffset:d.scrollTop,p=a.changedTouches,m,g;return p?(m=p[0].pageX-u.left-f,g=p[0].pageY-u.top-h):(m=a.pageX-u.left-f,g=a.pageY-u.top-h),{x:m/(l.clientWidth/(l.width||l.clientWidth)*c),y:g/(l.clientHeight/(l.height||l.clientHeight)*c)}}})()},function(t,i,r){var o={};t.exports=o;var s=r(0);(function(){o._registry={},o.register=function(a){if(o.isPlugin(a)||s.warn("Plugin.register:",o.toString(a),"does not implement all required fields."),a.name in o._registry){var l=o._registry[a.name],c=o.versionParse(a.version).number,u=o.versionParse(l.version).number;c>u?(s.warn("Plugin.register:",o.toString(l),"was upgraded to",o.toString(a)),o._registry[a.name]=a):c<u?s.warn("Plugin.register:",o.toString(l),"can not be downgraded to",o.toString(a)):a!==l&&s.warn("Plugin.register:",o.toString(a),"is already registered to different plugin object")}else o._registry[a.name]=a;return a},o.resolve=function(a){return o._registry[o.dependencyParse(a).name]},o.toString=function(a){return typeof a=="string"?a:(a.name||"anonymous")+"@"+(a.version||a.range||"0.0.0")},o.isPlugin=function(a){return a&&a.name&&a.version&&a.install},o.isUsed=function(a,l){return a.used.indexOf(l)>-1},o.isFor=function(a,l){var c=a.for&&o.dependencyParse(a.for);return!a.for||l.name===c.name&&o.versionSatisfies(l.version,c.range)},o.use=function(a,l){if(a.uses=(a.uses||[]).concat(l||[]),a.uses.length===0){s.warn("Plugin.use:",o.toString(a),"does not specify any dependencies to install.");return}for(var c=o.dependencies(a),u=s.topologicalSort(c),d=[],f=0;f<u.length;f+=1)if(u[f]!==a.name){var h=o.resolve(u[f]);if(!h){d.push(" "+u[f]);continue}o.isUsed(a,h.name)||(o.isFor(h,a)||(s.warn("Plugin.use:",o.toString(h),"is for",h.for,"but installed on",o.toString(a)+"."),h._warned=!0),h.install?h.install(a):(s.warn("Plugin.use:",o.toString(h),"does not specify an install function."),h._warned=!0),h._warned?(d.push(" "+o.toString(h)),delete h._warned):d.push(" "+o.toString(h)),a.used.push(h.name))}d.length>0&&s.info(d.join("  "))},o.dependencies=function(a,l){var c=o.dependencyParse(a),u=c.name;if(l=l||{},!(u in l)){a=o.resolve(a)||a,l[u]=s.map(a.uses||[],function(f){o.isPlugin(f)&&o.register(f);var h=o.dependencyParse(f),p=o.resolve(f);return p&&!o.versionSatisfies(p.version,h.range)?(s.warn("Plugin.dependencies:",o.toString(p),"does not satisfy",o.toString(h),"used by",o.toString(c)+"."),p._warned=!0,a._warned=!0):p||(s.warn("Plugin.dependencies:",o.toString(f),"used by",o.toString(c),"could not be resolved."),a._warned=!0),h.name});for(var d=0;d<l[u].length;d+=1)o.dependencies(l[u][d],l);return l}},o.dependencyParse=function(a){if(s.isString(a)){var l=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return l.test(a)||s.warn("Plugin.dependencyParse:",a,"is not a valid dependency string."),{name:a.split("@")[0],range:a.split("@")[1]||"*"}}return{name:a.name,range:a.range||a.version}},o.versionParse=function(a){var l=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;l.test(a)||s.warn("Plugin.versionParse:",a,"is not a valid version or range.");var c=l.exec(a),u=Number(c[4]),d=Number(c[5]),f=Number(c[6]);return{isRange:!!(c[1]||c[2]),version:c[3],range:a,operator:c[1]||c[2]||"",major:u,minor:d,patch:f,parts:[u,d,f],prerelease:c[7],number:u*1e8+d*1e4+f}},o.versionSatisfies=function(a,l){l=l||"*";var c=o.versionParse(l),u=o.versionParse(a);if(c.isRange){if(c.operator==="*"||a==="*")return!0;if(c.operator===">")return u.number>c.number;if(c.operator===">=")return u.number>=c.number;if(c.operator==="~")return u.major===c.major&&u.minor===c.minor&&u.patch>=c.patch;if(c.operator==="^")return c.major>0?u.major===c.major&&u.number>=c.number:c.minor>0?u.minor===c.minor&&u.patch>=c.patch:u.patch===c.patch}return a===l||a==="*"}})()},function(t,i){var r={};t.exports=r,function(){r.create=function(o){return{vertex:o,normalImpulse:0,tangentImpulse:0}}}()},function(t,i,r){var o={};t.exports=o;var s=r(7),a=r(18),l=r(13),c=r(19),u=r(5),d=r(6),f=r(10),h=r(0),p=r(4);(function(){o._deltaMax=1e3/60,o.create=function(m){m=m||{};var g={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},v=h.extend(g,m);return v.world=m.world||d.create({label:"World"}),v.pairs=m.pairs||c.create(),v.detector=m.detector||l.create(),v.detector.pairs=v.pairs,v.grid={buckets:[]},v.world.gravity=v.gravity,v.broadphase=v.grid,v.metrics={},v},o.update=function(m,g){var v=h.now(),x=m.world,b=m.detector,w=m.pairs,y=m.timing,C=y.timestamp,$;g>o._deltaMax&&h.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",o._deltaMax.toFixed(3),"ms."),g=typeof g<"u"?g:h._baseDelta,g*=y.timeScale,y.timestamp+=g,y.lastDelta=g;var I={timestamp:y.timestamp,delta:g};u.trigger(m,"beforeUpdate",I);var E=d.allBodies(x),N=d.allConstraints(x);for(x.isModified&&(l.setBodies(b,E),d.setModified(x,!1,!1,!0)),m.enableSleeping&&s.update(E,g),o._bodiesApplyGravity(E,m.gravity),g>0&&o._bodiesUpdate(E,g),u.trigger(m,"beforeSolve",I),f.preSolveAll(E),$=0;$<m.constraintIterations;$++)f.solveAll(N,g);f.postSolveAll(E);var k=l.collisions(b);c.update(w,k,C),m.enableSleeping&&s.afterCollisions(w.list),w.collisionStart.length>0&&u.trigger(m,"collisionStart",{pairs:w.collisionStart,timestamp:y.timestamp,delta:g});var D=h.clamp(20/m.positionIterations,0,1);for(a.preSolvePosition(w.list),$=0;$<m.positionIterations;$++)a.solvePosition(w.list,g,D);for(a.postSolvePosition(E),f.preSolveAll(E),$=0;$<m.constraintIterations;$++)f.solveAll(N,g);for(f.postSolveAll(E),a.preSolveVelocity(w.list),$=0;$<m.velocityIterations;$++)a.solveVelocity(w.list,g);return o._bodiesUpdateVelocities(E),w.collisionActive.length>0&&u.trigger(m,"collisionActive",{pairs:w.collisionActive,timestamp:y.timestamp,delta:g}),w.collisionEnd.length>0&&u.trigger(m,"collisionEnd",{pairs:w.collisionEnd,timestamp:y.timestamp,delta:g}),o._bodiesClearForces(E),u.trigger(m,"afterUpdate",I),m.timing.lastElapsed=h.now()-v,m},o.merge=function(m,g){if(h.extend(m,g),g.world){m.world=g.world,o.clear(m);for(var v=d.allBodies(m.world),x=0;x<v.length;x++){var b=v[x];s.set(b,!1),b.id=h.nextId()}}},o.clear=function(m){c.clear(m.pairs),l.clear(m.detector)},o._bodiesClearForces=function(m){for(var g=m.length,v=0;v<g;v++){var x=m[v];x.force.x=0,x.force.y=0,x.torque=0}},o._bodiesApplyGravity=function(m,g){var v=typeof g.scale<"u"?g.scale:.001,x=m.length;if(!(g.x===0&&g.y===0||v===0))for(var b=0;b<x;b++){var w=m[b];w.isStatic||w.isSleeping||(w.force.y+=w.mass*g.y*v,w.force.x+=w.mass*g.x*v)}},o._bodiesUpdate=function(m,g){for(var v=m.length,x=0;x<v;x++){var b=m[x];b.isStatic||b.isSleeping||p.update(b,g)}},o._bodiesUpdateVelocities=function(m){for(var g=m.length,v=0;v<g;v++)p.updateVelocities(m[v])}})()},function(t,i,r){var o={};t.exports=o;var s=r(3),a=r(0),l=r(1);(function(){o._restingThresh=2,o._restingThreshTangent=Math.sqrt(6),o._positionDampen=.9,o._positionWarming=.8,o._frictionNormalMultiplier=5,o._frictionMaxStatic=Number.MAX_VALUE,o.preSolvePosition=function(c){var u,d,f,h=c.length;for(u=0;u<h;u++)d=c[u],d.isActive&&(f=d.contactCount,d.collision.parentA.totalContacts+=f,d.collision.parentB.totalContacts+=f)},o.solvePosition=function(c,u,d){var f,h,p,m,g,v,x,b,w=o._positionDampen*(d||1),y=a.clamp(u/a._baseDelta,0,1),C=c.length;for(f=0;f<C;f++)h=c[f],!(!h.isActive||h.isSensor)&&(p=h.collision,m=p.parentA,g=p.parentB,v=p.normal,h.separation=p.depth+v.x*(g.positionImpulse.x-m.positionImpulse.x)+v.y*(g.positionImpulse.y-m.positionImpulse.y));for(f=0;f<C;f++)h=c[f],!(!h.isActive||h.isSensor)&&(p=h.collision,m=p.parentA,g=p.parentB,v=p.normal,b=h.separation-h.slop*y,(m.isStatic||g.isStatic)&&(b*=2),m.isStatic||m.isSleeping||(x=w/m.totalContacts,m.positionImpulse.x+=v.x*b*x,m.positionImpulse.y+=v.y*b*x),g.isStatic||g.isSleeping||(x=w/g.totalContacts,g.positionImpulse.x-=v.x*b*x,g.positionImpulse.y-=v.y*b*x))},o.postSolvePosition=function(c){for(var u=o._positionWarming,d=c.length,f=s.translate,h=l.update,p=0;p<d;p++){var m=c[p],g=m.positionImpulse,v=g.x,x=g.y,b=m.velocity;if(m.totalContacts=0,v!==0||x!==0){for(var w=0;w<m.parts.length;w++){var y=m.parts[w];f(y.vertices,g),h(y.bounds,y.vertices,b),y.position.x+=v,y.position.y+=x}m.positionPrev.x+=v,m.positionPrev.y+=x,v*b.x+x*b.y<0?(g.x=0,g.y=0):(g.x*=u,g.y*=u)}}},o.preSolveVelocity=function(c){var u=c.length,d,f;for(d=0;d<u;d++){var h=c[d];if(!(!h.isActive||h.isSensor)){var p=h.contacts,m=h.contactCount,g=h.collision,v=g.parentA,x=g.parentB,b=g.normal,w=g.tangent;for(f=0;f<m;f++){var y=p[f],C=y.vertex,$=y.normalImpulse,I=y.tangentImpulse;if($!==0||I!==0){var E=b.x*$+w.x*I,N=b.y*$+w.y*I;v.isStatic||v.isSleeping||(v.positionPrev.x+=E*v.inverseMass,v.positionPrev.y+=N*v.inverseMass,v.anglePrev+=v.inverseInertia*((C.x-v.position.x)*N-(C.y-v.position.y)*E)),x.isStatic||x.isSleeping||(x.positionPrev.x-=E*x.inverseMass,x.positionPrev.y-=N*x.inverseMass,x.anglePrev-=x.inverseInertia*((C.x-x.position.x)*N-(C.y-x.position.y)*E))}}}}},o.solveVelocity=function(c,u){var d=u/a._baseDelta,f=d*d,h=f*d,p=-o._restingThresh*d,m=o._restingThreshTangent,g=o._frictionNormalMultiplier*d,v=o._frictionMaxStatic,x=c.length,b,w,y,C;for(y=0;y<x;y++){var $=c[y];if(!(!$.isActive||$.isSensor)){var I=$.collision,E=I.parentA,N=I.parentB,k=I.normal.x,D=I.normal.y,_=I.tangent.x,R=I.tangent.y,T=$.inverseMass,A=$.friction*$.frictionStatic*g,O=$.contacts,P=$.contactCount,M=1/P,z=E.position.x-E.positionPrev.x,L=E.position.y-E.positionPrev.y,W=E.angle-E.anglePrev,U=N.position.x-N.positionPrev.x,V=N.position.y-N.positionPrev.y,H=N.angle-N.anglePrev;for(C=0;C<P;C++){var Y=O[C],Q=Y.vertex,Z=Q.x-E.position.x,pe=Q.y-E.position.y,oe=Q.x-N.position.x,X=Q.y-N.position.y,j=z-pe*W,ne=L+Z*W,se=U-X*H,ce=V+oe*H,re=j-se,be=ne-ce,Ie=k*re+D*be,Ee=_*re+R*be,Se=$.separation+Ie,fe=Math.min(Se,1);fe=Se<0?0:fe;var ge=fe*A;Ee<-ge||Ee>ge?(w=Ee>0?Ee:-Ee,b=$.friction*(Ee>0?1:-1)*h,b<-w?b=-w:b>w&&(b=w)):(b=Ee,w=v);var we=Z*D-pe*k,ve=oe*D-X*k,Ne=M/(T+E.inverseInertia*we*we+N.inverseInertia*ve*ve),Ae=(1+$.restitution)*Ie*Ne;if(b*=Ne,Ie<p)Y.normalImpulse=0;else{var Ve=Y.normalImpulse;Y.normalImpulse+=Ae,Y.normalImpulse>0&&(Y.normalImpulse=0),Ae=Y.normalImpulse-Ve}if(Ee<-m||Ee>m)Y.tangentImpulse=0;else{var Ue=Y.tangentImpulse;Y.tangentImpulse+=b,Y.tangentImpulse<-w&&(Y.tangentImpulse=-w),Y.tangentImpulse>w&&(Y.tangentImpulse=w),b=Y.tangentImpulse-Ue}var We=k*Ae+_*b,Le=D*Ae+R*b;E.isStatic||E.isSleeping||(E.positionPrev.x+=We*E.inverseMass,E.positionPrev.y+=Le*E.inverseMass,E.anglePrev+=(Z*Le-pe*We)*E.inverseInertia),N.isStatic||N.isSleeping||(N.positionPrev.x-=We*N.inverseMass,N.positionPrev.y-=Le*N.inverseMass,N.anglePrev-=(oe*Le-X*We)*N.inverseInertia)}}}}})()},function(t,i,r){var o={};t.exports=o;var s=r(9),a=r(0);(function(){o.create=function(l){return a.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},l)},o.update=function(l,c,u){var d=s.update,f=s.create,h=s.setActive,p=l.table,m=l.list,g=m.length,v=g,x=l.collisionStart,b=l.collisionEnd,w=l.collisionActive,y=c.length,C=0,$=0,I=0,E,N,k;for(k=0;k<y;k++)E=c[k],N=E.pair,N?(N.isActive&&(w[I++]=N),d(N,E,u)):(N=f(E,u),p[N.id]=N,x[C++]=N,m[v++]=N);for(v=0,g=m.length,k=0;k<g;k++)N=m[k],N.timeUpdated>=u?m[v++]=N:(h(N,!1,u),N.collision.bodyA.sleepCounter>0&&N.collision.bodyB.sleepCounter>0?m[v++]=N:(b[$++]=N,delete p[N.id]));m.length!==v&&(m.length=v),x.length!==C&&(x.length=C),b.length!==$&&(b.length=$),w.length!==I&&(w.length=I)},o.clear=function(l){return l.table={},l.list.length=0,l.collisionStart.length=0,l.collisionActive.length=0,l.collisionEnd.length=0,l}})()},function(t,i,r){var o=t.exports=r(21);o.Axes=r(11),o.Bodies=r(12),o.Body=r(4),o.Bounds=r(1),o.Collision=r(8),o.Common=r(0),o.Composite=r(6),o.Composites=r(22),o.Constraint=r(10),o.Contact=r(16),o.Detector=r(13),o.Engine=r(17),o.Events=r(5),o.Grid=r(23),o.Mouse=r(14),o.MouseConstraint=r(24),o.Pair=r(9),o.Pairs=r(19),o.Plugin=r(15),o.Query=r(25),o.Render=r(26),o.Resolver=r(18),o.Runner=r(27),o.SAT=r(28),o.Sleeping=r(7),o.Svg=r(29),o.Vector=r(2),o.Vertices=r(3),o.World=r(30),o.Engine.run=o.Runner.run,o.Common.deprecated(o.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(t,i,r){var o={};t.exports=o;var s=r(15),a=r(0);(function(){o.name="matter-js",o.version="0.20.0",o.uses=[],o.used=[],o.use=function(){s.use(o,Array.prototype.slice.call(arguments))},o.before=function(l,c){return l=l.replace(/^Matter./,""),a.chainPathBefore(o,l,c)},o.after=function(l,c){return l=l.replace(/^Matter./,""),a.chainPathAfter(o,l,c)}})()},function(t,i,r){var o={};t.exports=o;var s=r(6),a=r(10),l=r(0),c=r(4),u=r(12),d=l.deprecated;(function(){o.stack=function(f,h,p,m,g,v,x){for(var b=s.create({label:"Stack"}),w=f,y=h,C,$=0,I=0;I<m;I++){for(var E=0,N=0;N<p;N++){var k=x(w,y,N,I,C,$);if(k){var D=k.bounds.max.y-k.bounds.min.y,_=k.bounds.max.x-k.bounds.min.x;D>E&&(E=D),c.translate(k,{x:_*.5,y:D*.5}),w=k.bounds.max.x+g,s.addBody(b,k),C=k,$+=1}else w+=g}y+=E+v,w=f}return b},o.chain=function(f,h,p,m,g,v){for(var x=f.bodies,b=1;b<x.length;b++){var w=x[b-1],y=x[b],C=w.bounds.max.y-w.bounds.min.y,$=w.bounds.max.x-w.bounds.min.x,I=y.bounds.max.y-y.bounds.min.y,E=y.bounds.max.x-y.bounds.min.x,N={bodyA:w,pointA:{x:$*h,y:C*p},bodyB:y,pointB:{x:E*m,y:I*g}},k=l.extend(N,v);s.addConstraint(f,a.create(k))}return f.label+=" Chain",f},o.mesh=function(f,h,p,m,g){var v=f.bodies,x,b,w,y,C;for(x=0;x<p;x++){for(b=1;b<h;b++)w=v[b-1+x*h],y=v[b+x*h],s.addConstraint(f,a.create(l.extend({bodyA:w,bodyB:y},g)));if(x>0)for(b=0;b<h;b++)w=v[b+(x-1)*h],y=v[b+x*h],s.addConstraint(f,a.create(l.extend({bodyA:w,bodyB:y},g))),m&&b>0&&(C=v[b-1+(x-1)*h],s.addConstraint(f,a.create(l.extend({bodyA:C,bodyB:y},g)))),m&&b<h-1&&(C=v[b+1+(x-1)*h],s.addConstraint(f,a.create(l.extend({bodyA:C,bodyB:y},g))))}return f.label+=" Mesh",f},o.pyramid=function(f,h,p,m,g,v,x){return o.stack(f,h,p,m,g,v,function(b,w,y,C,$,I){var E=Math.min(m,Math.ceil(p/2)),N=$?$.bounds.max.x-$.bounds.min.x:0;if(!(C>E)){C=E-C;var k=C,D=p-1-C;if(!(y<k||y>D)){I===1&&c.translate($,{x:(y+(p%2===1?1:-1))*N,y:0});var _=$?y*N:0;return x(f+_+y*g,w,y,C,$,I)}}})},o.newtonsCradle=function(f,h,p,m,g){for(var v=s.create({label:"Newtons Cradle"}),x=0;x<p;x++){var b=1.9,w=u.circle(f+x*(m*b),h+g,m,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),y=a.create({pointA:{x:f+x*(m*b),y:h},bodyB:w});s.addBody(v,w),s.addConstraint(v,y)}return v},d(o,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),o.car=function(f,h,p,m,g){var v=c.nextGroup(!0),x=20,b=-p*.5+x,w=p*.5-x,y=0,C=s.create({label:"Car"}),$=u.rectangle(f,h,p,m,{collisionFilter:{group:v},chamfer:{radius:m*.5},density:2e-4}),I=u.circle(f+b,h+y,g,{collisionFilter:{group:v},friction:.8}),E=u.circle(f+w,h+y,g,{collisionFilter:{group:v},friction:.8}),N=a.create({bodyB:$,pointB:{x:b,y},bodyA:I,stiffness:1,length:0}),k=a.create({bodyB:$,pointB:{x:w,y},bodyA:E,stiffness:1,length:0});return s.addBody(C,$),s.addBody(C,I),s.addBody(C,E),s.addConstraint(C,N),s.addConstraint(C,k),C},d(o,"car","Composites.car  moved to car example"),o.softBody=function(f,h,p,m,g,v,x,b,w,y){w=l.extend({inertia:1/0},w),y=l.extend({stiffness:.2,render:{type:"line",anchors:!1}},y);var C=o.stack(f,h,p,m,g,v,function($,I){return u.circle($,I,b,w)});return o.mesh(C,p,m,x,y),C.label="Soft Body",C},d(o,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(t,i,r){var o={};t.exports=o;var s=r(9),a=r(0),l=a.deprecated;(function(){o.create=function(c){var u={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(u,c)},o.update=function(c,u,d,f){var h,p,m,g=d.world,v=c.buckets,x,b,w=!1;for(h=0;h<u.length;h++){var y=u[h];if(!(y.isSleeping&&!f)&&!(g.bounds&&(y.bounds.max.x<g.bounds.min.x||y.bounds.min.x>g.bounds.max.x||y.bounds.max.y<g.bounds.min.y||y.bounds.min.y>g.bounds.max.y))){var C=o._getRegion(c,y);if(!y.region||C.id!==y.region.id||f){(!y.region||f)&&(y.region=C);var $=o._regionUnion(C,y.region);for(p=$.startCol;p<=$.endCol;p++)for(m=$.startRow;m<=$.endRow;m++){b=o._getBucketId(p,m),x=v[b];var I=p>=C.startCol&&p<=C.endCol&&m>=C.startRow&&m<=C.endRow,E=p>=y.region.startCol&&p<=y.region.endCol&&m>=y.region.startRow&&m<=y.region.endRow;!I&&E&&E&&x&&o._bucketRemoveBody(c,x,y),(y.region===C||I&&!E||f)&&(x||(x=o._createBucket(v,b)),o._bucketAddBody(c,x,y))}y.region=C,w=!0}}}w&&(c.pairsList=o._createActivePairsList(c))},l(o,"update","Grid.update  replaced by Matter.Detector"),o.clear=function(c){c.buckets={},c.pairs={},c.pairsList=[]},l(o,"clear","Grid.clear  replaced by Matter.Detector"),o._regionUnion=function(c,u){var d=Math.min(c.startCol,u.startCol),f=Math.max(c.endCol,u.endCol),h=Math.min(c.startRow,u.startRow),p=Math.max(c.endRow,u.endRow);return o._createRegion(d,f,h,p)},o._getRegion=function(c,u){var d=u.bounds,f=Math.floor(d.min.x/c.bucketWidth),h=Math.floor(d.max.x/c.bucketWidth),p=Math.floor(d.min.y/c.bucketHeight),m=Math.floor(d.max.y/c.bucketHeight);return o._createRegion(f,h,p,m)},o._createRegion=function(c,u,d,f){return{id:c+","+u+","+d+","+f,startCol:c,endCol:u,startRow:d,endRow:f}},o._getBucketId=function(c,u){return"C"+c+"R"+u},o._createBucket=function(c,u){var d=c[u]=[];return d},o._bucketAddBody=function(c,u,d){var f=c.pairs,h=s.id,p=u.length,m;for(m=0;m<p;m++){var g=u[m];if(!(d.id===g.id||d.isStatic&&g.isStatic)){var v=h(d,g),x=f[v];x?x[2]+=1:f[v]=[d,g,1]}}u.push(d)},o._bucketRemoveBody=function(c,u,d){var f=c.pairs,h=s.id,p;u.splice(a.indexOf(u,d),1);var m=u.length;for(p=0;p<m;p++){var g=f[h(d,u[p])];g&&(g[2]-=1)}},o._createActivePairsList=function(c){var u,d=c.pairs,f=a.keys(d),h=f.length,p=[],m;for(m=0;m<h;m++)u=d[f[m]],u[2]>0?p.push(u):delete d[f[m]];return p}})()},function(t,i,r){var o={};t.exports=o;var s=r(3),a=r(7),l=r(14),c=r(5),u=r(13),d=r(10),f=r(6),h=r(0),p=r(1);(function(){o.create=function(m,g){var v=(m?m.mouse:null)||(g?g.mouse:null);v||(m&&m.render&&m.render.canvas?v=l.create(m.render.canvas):g&&g.element?v=l.create(g.element):(v=l.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var x=d.create({label:"Mouse Constraint",pointA:v.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),b={type:"mouseConstraint",mouse:v,element:null,body:null,constraint:x,collisionFilter:{category:1,mask:4294967295,group:0}},w=h.extend(b,g);return c.on(m,"beforeUpdate",function(){var y=f.allBodies(m.world);o.update(w,y),o._triggerEvents(w)}),w},o.update=function(m,g){var v=m.mouse,x=m.constraint,b=m.body;if(v.button===0){if(x.bodyB)a.set(x.bodyB,!1),x.pointA=v.position;else for(var w=0;w<g.length;w++)if(b=g[w],p.contains(b.bounds,v.position)&&u.canCollide(b.collisionFilter,m.collisionFilter))for(var y=b.parts.length>1?1:0;y<b.parts.length;y++){var C=b.parts[y];if(s.contains(C.vertices,v.position)){x.pointA=v.position,x.bodyB=m.body=b,x.pointB={x:v.position.x-b.position.x,y:v.position.y-b.position.y},x.angleB=b.angle,a.set(b,!1),c.trigger(m,"startdrag",{mouse:v,body:b});break}}}else x.bodyB=m.body=null,x.pointB=null,b&&c.trigger(m,"enddrag",{mouse:v,body:b})},o._triggerEvents=function(m){var g=m.mouse,v=g.sourceEvents;v.mousemove&&c.trigger(m,"mousemove",{mouse:g}),v.mousedown&&c.trigger(m,"mousedown",{mouse:g}),v.mouseup&&c.trigger(m,"mouseup",{mouse:g}),l.clearSourceEvents(g)}})()},function(t,i,r){var o={};t.exports=o;var s=r(2),a=r(8),l=r(1),c=r(12),u=r(3);(function(){o.collides=function(d,f){for(var h=[],p=f.length,m=d.bounds,g=a.collides,v=l.overlaps,x=0;x<p;x++){var b=f[x],w=b.parts.length,y=w===1?0:1;if(v(b.bounds,m))for(var C=y;C<w;C++){var $=b.parts[C];if(v($.bounds,m)){var I=g($,d);if(I){h.push(I);break}}}}return h},o.ray=function(d,f,h,p){p=p||1e-100;for(var m=s.angle(f,h),g=s.magnitude(s.sub(f,h)),v=(h.x+f.x)*.5,x=(h.y+f.y)*.5,b=c.rectangle(v,x,g,p,{angle:m}),w=o.collides(b,d),y=0;y<w.length;y+=1){var C=w[y];C.body=C.bodyB=C.bodyA}return w},o.region=function(d,f,h){for(var p=[],m=0;m<d.length;m++){var g=d[m],v=l.overlaps(g.bounds,f);(v&&!h||!v&&h)&&p.push(g)}return p},o.point=function(d,f){for(var h=[],p=0;p<d.length;p++){var m=d[p];if(l.contains(m.bounds,f))for(var g=m.parts.length===1?0:1;g<m.parts.length;g++){var v=m.parts[g];if(l.contains(v.bounds,f)&&u.contains(v.vertices,f)){h.push(m);break}}}return h}})()},function(t,i,r){var o={};t.exports=o;var s=r(4),a=r(0),l=r(6),c=r(1),u=r(5),d=r(2),f=r(14);(function(){var h,p;typeof window<"u"&&(h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(y){window.setTimeout(function(){y(a.now())},1e3/60)},p=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o._goodFps=30,o._goodDelta=1e3/60,o.create=function(y){var C={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!y.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},$=a.extend(C,y);return $.canvas&&($.canvas.width=$.options.width||$.canvas.width,$.canvas.height=$.options.height||$.canvas.height),$.mouse=y.mouse,$.engine=y.engine,$.canvas=$.canvas||v($.options.width,$.options.height),$.context=$.canvas.getContext("2d"),$.textures={},$.bounds=$.bounds||{min:{x:0,y:0},max:{x:$.canvas.width,y:$.canvas.height}},$.controller=o,$.options.showBroadphase=!1,$.options.pixelRatio!==1&&o.setPixelRatio($,$.options.pixelRatio),a.isElement($.element)&&$.element.appendChild($.canvas),$},o.run=function(y){(function C($){y.frameRequestId=h(C),m(y,$),o.world(y,$),y.context.setTransform(y.options.pixelRatio,0,0,y.options.pixelRatio,0,0),(y.options.showStats||y.options.showDebug)&&o.stats(y,y.context,$),(y.options.showPerformance||y.options.showDebug)&&o.performance(y,y.context,$),y.context.setTransform(1,0,0,1,0,0)})()},o.stop=function(y){p(y.frameRequestId)},o.setPixelRatio=function(y,C){var $=y.options,I=y.canvas;C==="auto"&&(C=x(I)),$.pixelRatio=C,I.setAttribute("data-pixel-ratio",C),I.width=$.width*C,I.height=$.height*C,I.style.width=$.width+"px",I.style.height=$.height+"px"},o.setSize=function(y,C,$){y.options.width=C,y.options.height=$,y.bounds.max.x=y.bounds.min.x+C,y.bounds.max.y=y.bounds.min.y+$,y.options.pixelRatio!==1?o.setPixelRatio(y,y.options.pixelRatio):(y.canvas.width=C,y.canvas.height=$)},o.lookAt=function(y,C,$,I){I=typeof I<"u"?I:!0,C=a.isArray(C)?C:[C],$=$||{x:0,y:0};for(var E={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},N=0;N<C.length;N+=1){var k=C[N],D=k.bounds?k.bounds.min:k.min||k.position||k,_=k.bounds?k.bounds.max:k.max||k.position||k;D&&_&&(D.x<E.min.x&&(E.min.x=D.x),_.x>E.max.x&&(E.max.x=_.x),D.y<E.min.y&&(E.min.y=D.y),_.y>E.max.y&&(E.max.y=_.y))}var R=E.max.x-E.min.x+2*$.x,T=E.max.y-E.min.y+2*$.y,A=y.canvas.height,O=y.canvas.width,P=O/A,M=R/T,z=1,L=1;M>P?L=M/P:z=P/M,y.options.hasBounds=!0,y.bounds.min.x=E.min.x,y.bounds.max.x=E.min.x+R*z,y.bounds.min.y=E.min.y,y.bounds.max.y=E.min.y+T*L,I&&(y.bounds.min.x+=R*.5-R*z*.5,y.bounds.max.x+=R*.5-R*z*.5,y.bounds.min.y+=T*.5-T*L*.5,y.bounds.max.y+=T*.5-T*L*.5),y.bounds.min.x-=$.x,y.bounds.max.x-=$.x,y.bounds.min.y-=$.y,y.bounds.max.y-=$.y,y.mouse&&(f.setScale(y.mouse,{x:(y.bounds.max.x-y.bounds.min.x)/y.canvas.width,y:(y.bounds.max.y-y.bounds.min.y)/y.canvas.height}),f.setOffset(y.mouse,y.bounds.min))},o.startViewTransform=function(y){var C=y.bounds.max.x-y.bounds.min.x,$=y.bounds.max.y-y.bounds.min.y,I=C/y.options.width,E=$/y.options.height;y.context.setTransform(y.options.pixelRatio/I,0,0,y.options.pixelRatio/E,0,0),y.context.translate(-y.bounds.min.x,-y.bounds.min.y)},o.endViewTransform=function(y){y.context.setTransform(y.options.pixelRatio,0,0,y.options.pixelRatio,0,0)},o.world=function(y,C){var $=a.now(),I=y.engine,E=I.world,N=y.canvas,k=y.context,D=y.options,_=y.timing,R=l.allBodies(E),T=l.allConstraints(E),A=D.wireframes?D.wireframeBackground:D.background,O=[],P=[],M,z={timestamp:I.timing.timestamp};if(u.trigger(y,"beforeRender",z),y.currentBackground!==A&&w(y,A),k.globalCompositeOperation="source-in",k.fillStyle="transparent",k.fillRect(0,0,N.width,N.height),k.globalCompositeOperation="source-over",D.hasBounds){for(M=0;M<R.length;M++){var L=R[M];c.overlaps(L.bounds,y.bounds)&&O.push(L)}for(M=0;M<T.length;M++){var W=T[M],U=W.bodyA,V=W.bodyB,H=W.pointA,Y=W.pointB;U&&(H=d.add(U.position,W.pointA)),V&&(Y=d.add(V.position,W.pointB)),!(!H||!Y)&&(c.contains(y.bounds,H)||c.contains(y.bounds,Y))&&P.push(W)}o.startViewTransform(y),y.mouse&&(f.setScale(y.mouse,{x:(y.bounds.max.x-y.bounds.min.x)/y.options.width,y:(y.bounds.max.y-y.bounds.min.y)/y.options.height}),f.setOffset(y.mouse,y.bounds.min))}else P=T,O=R,y.options.pixelRatio!==1&&y.context.setTransform(y.options.pixelRatio,0,0,y.options.pixelRatio,0,0);!D.wireframes||I.enableSleeping&&D.showSleeping?o.bodies(y,O,k):(D.showConvexHulls&&o.bodyConvexHulls(y,O,k),o.bodyWireframes(y,O,k)),D.showBounds&&o.bodyBounds(y,O,k),(D.showAxes||D.showAngleIndicator)&&o.bodyAxes(y,O,k),D.showPositions&&o.bodyPositions(y,O,k),D.showVelocity&&o.bodyVelocity(y,O,k),D.showIds&&o.bodyIds(y,O,k),D.showSeparations&&o.separations(y,I.pairs.list,k),D.showCollisions&&o.collisions(y,I.pairs.list,k),D.showVertexNumbers&&o.vertexNumbers(y,O,k),D.showMousePosition&&o.mousePosition(y,y.mouse,k),o.constraints(P,k),D.hasBounds&&o.endViewTransform(y),u.trigger(y,"afterRender",z),_.lastElapsed=a.now()-$},o.stats=function(y,C,$){for(var I=y.engine,E=I.world,N=l.allBodies(E),k=0,D=55,_=44,R=0,T=0,A=0;A<N.length;A+=1)k+=N[A].parts.length;var O={Part:k,Body:N.length,Cons:l.allConstraints(E).length,Comp:l.allComposites(E).length,Pair:I.pairs.list.length};C.fillStyle="#0e0f19",C.fillRect(R,T,D*5.5,_),C.font="12px Arial",C.textBaseline="top",C.textAlign="right";for(var P in O){var M=O[P];C.fillStyle="#aaa",C.fillText(P,R+D,T+8),C.fillStyle="#eee",C.fillText(M,R+D,T+26),R+=D}},o.performance=function(y,C){var $=y.engine,I=y.timing,E=I.deltaHistory,N=I.elapsedHistory,k=I.timestampElapsedHistory,D=I.engineDeltaHistory,_=I.engineUpdatesHistory,R=I.engineElapsedHistory,T=$.timing.lastUpdatesPerFrame,A=$.timing.lastDelta,O=g(E),P=g(N),M=g(D),z=g(_),L=g(R),W=g(k),U=W/O||0,V=Math.round(O/A),H=1e3/O||0,Y=4,Q=12,Z=60,pe=34,oe=10,X=69;C.fillStyle="#0e0f19",C.fillRect(0,50,Q*5+Z*6+22,pe),o.status(C,oe,X,Z,Y,E.length,Math.round(H)+" fps",H/o._goodFps,function(j){return E[j]/O-1}),o.status(C,oe+Q+Z,X,Z,Y,D.length,A.toFixed(2)+" dt",o._goodDelta/A,function(j){return D[j]/M-1}),o.status(C,oe+(Q+Z)*2,X,Z,Y,_.length,T+" upf",Math.pow(a.clamp(z/V||1,0,1),4),function(j){return _[j]/z-1}),o.status(C,oe+(Q+Z)*3,X,Z,Y,R.length,L.toFixed(2)+" ut",1-T*L/o._goodFps,function(j){return R[j]/L-1}),o.status(C,oe+(Q+Z)*4,X,Z,Y,N.length,P.toFixed(2)+" rt",1-P/o._goodFps,function(j){return N[j]/P-1}),o.status(C,oe+(Q+Z)*5,X,Z,Y,k.length,U.toFixed(2)+" x",U*U*U,function(j){return(k[j]/E[j]/U||0)-1})},o.status=function(y,C,$,I,E,N,k,D,_){y.strokeStyle="#888",y.fillStyle="#444",y.lineWidth=1,y.fillRect(C,$+7,I,1),y.beginPath(),y.moveTo(C,$+7-E*a.clamp(.4*_(0),-2,2));for(var R=0;R<I;R+=1)y.lineTo(C+R,$+7-(R<N?E*a.clamp(.4*_(R),-2,2):0));y.stroke(),y.fillStyle="hsl("+a.clamp(25+95*D,0,120)+",100%,60%)",y.fillRect(C,$-7,4,4),y.font="12px Arial",y.textBaseline="middle",y.textAlign="right",y.fillStyle="#eee",y.fillText(k,C+I,$-5)},o.constraints=function(y,C){for(var $=C,I=0;I<y.length;I++){var E=y[I];if(!(!E.render.visible||!E.pointA||!E.pointB)){var N=E.bodyA,k=E.bodyB,D,_;if(N?D=d.add(N.position,E.pointA):D=E.pointA,E.render.type==="pin")$.beginPath(),$.arc(D.x,D.y,3,0,2*Math.PI),$.closePath();else{if(k?_=d.add(k.position,E.pointB):_=E.pointB,$.beginPath(),$.moveTo(D.x,D.y),E.render.type==="spring")for(var R=d.sub(_,D),T=d.perp(d.normalise(R)),A=Math.ceil(a.clamp(E.length/5,12,20)),O,P=1;P<A;P+=1)O=P%2===0?1:-1,$.lineTo(D.x+R.x*(P/A)+T.x*O*4,D.y+R.y*(P/A)+T.y*O*4);$.lineTo(_.x,_.y)}E.render.lineWidth&&($.lineWidth=E.render.lineWidth,$.strokeStyle=E.render.strokeStyle,$.stroke()),E.render.anchors&&($.fillStyle=E.render.strokeStyle,$.beginPath(),$.arc(D.x,D.y,3,0,2*Math.PI),$.arc(_.x,_.y,3,0,2*Math.PI),$.closePath(),$.fill())}}},o.bodies=function(y,C,$){var I=$;y.engine;var E=y.options,N=E.showInternalEdges||!E.wireframes,k,D,_,R;for(_=0;_<C.length;_++)if(k=C[_],!!k.render.visible){for(R=k.parts.length>1?1:0;R<k.parts.length;R++)if(D=k.parts[R],!!D.render.visible){if(E.showSleeping&&k.isSleeping?I.globalAlpha=.5*D.render.opacity:D.render.opacity!==1&&(I.globalAlpha=D.render.opacity),D.render.sprite&&D.render.sprite.texture&&!E.wireframes){var T=D.render.sprite,A=b(y,T.texture);I.translate(D.position.x,D.position.y),I.rotate(D.angle),I.drawImage(A,A.width*-T.xOffset*T.xScale,A.height*-T.yOffset*T.yScale,A.width*T.xScale,A.height*T.yScale),I.rotate(-D.angle),I.translate(-D.position.x,-D.position.y)}else{if(D.circleRadius)I.beginPath(),I.arc(D.position.x,D.position.y,D.circleRadius,0,2*Math.PI);else{I.beginPath(),I.moveTo(D.vertices[0].x,D.vertices[0].y);for(var O=1;O<D.vertices.length;O++)!D.vertices[O-1].isInternal||N?I.lineTo(D.vertices[O].x,D.vertices[O].y):I.moveTo(D.vertices[O].x,D.vertices[O].y),D.vertices[O].isInternal&&!N&&I.moveTo(D.vertices[(O+1)%D.vertices.length].x,D.vertices[(O+1)%D.vertices.length].y);I.lineTo(D.vertices[0].x,D.vertices[0].y),I.closePath()}E.wireframes?(I.lineWidth=1,I.strokeStyle=y.options.wireframeStrokeStyle,I.stroke()):(I.fillStyle=D.render.fillStyle,D.render.lineWidth&&(I.lineWidth=D.render.lineWidth,I.strokeStyle=D.render.strokeStyle,I.stroke()),I.fill())}I.globalAlpha=1}}},o.bodyWireframes=function(y,C,$){var I=$,E=y.options.showInternalEdges,N,k,D,_,R;for(I.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.render.visible)for(R=N.parts.length>1?1:0;R<N.parts.length;R++){for(k=N.parts[R],I.moveTo(k.vertices[0].x,k.vertices[0].y),_=1;_<k.vertices.length;_++)!k.vertices[_-1].isInternal||E?I.lineTo(k.vertices[_].x,k.vertices[_].y):I.moveTo(k.vertices[_].x,k.vertices[_].y),k.vertices[_].isInternal&&!E&&I.moveTo(k.vertices[(_+1)%k.vertices.length].x,k.vertices[(_+1)%k.vertices.length].y);I.lineTo(k.vertices[0].x,k.vertices[0].y)}I.lineWidth=1,I.strokeStyle=y.options.wireframeStrokeStyle,I.stroke()},o.bodyConvexHulls=function(y,C,$){var I=$,E,N,k;for(I.beginPath(),N=0;N<C.length;N++)if(E=C[N],!(!E.render.visible||E.parts.length===1)){for(I.moveTo(E.vertices[0].x,E.vertices[0].y),k=1;k<E.vertices.length;k++)I.lineTo(E.vertices[k].x,E.vertices[k].y);I.lineTo(E.vertices[0].x,E.vertices[0].y)}I.lineWidth=1,I.strokeStyle="rgba(255,255,255,0.2)",I.stroke()},o.vertexNumbers=function(y,C,$){var I=$,E,N,k;for(E=0;E<C.length;E++){var D=C[E].parts;for(k=D.length>1?1:0;k<D.length;k++){var _=D[k];for(N=0;N<_.vertices.length;N++)I.fillStyle="rgba(255,255,255,0.2)",I.fillText(E+"_"+N,_.position.x+(_.vertices[N].x-_.position.x)*.8,_.position.y+(_.vertices[N].y-_.position.y)*.8)}}},o.mousePosition=function(y,C,$){var I=$;I.fillStyle="rgba(255,255,255,0.8)",I.fillText(C.position.x+"  "+C.position.y,C.position.x+5,C.position.y-5)},o.bodyBounds=function(y,C,$){var I=$;y.engine;var E=y.options;I.beginPath();for(var N=0;N<C.length;N++){var k=C[N];if(k.render.visible)for(var D=C[N].parts,_=D.length>1?1:0;_<D.length;_++){var R=D[_];I.rect(R.bounds.min.x,R.bounds.min.y,R.bounds.max.x-R.bounds.min.x,R.bounds.max.y-R.bounds.min.y)}}E.wireframes?I.strokeStyle="rgba(255,255,255,0.08)":I.strokeStyle="rgba(0,0,0,0.1)",I.lineWidth=1,I.stroke()},o.bodyAxes=function(y,C,$){var I=$;y.engine;var E=y.options,N,k,D,_;for(I.beginPath(),k=0;k<C.length;k++){var R=C[k],T=R.parts;if(R.render.visible)if(E.showAxes)for(D=T.length>1?1:0;D<T.length;D++)for(N=T[D],_=0;_<N.axes.length;_++){var A=N.axes[_];I.moveTo(N.position.x,N.position.y),I.lineTo(N.position.x+A.x*20,N.position.y+A.y*20)}else for(D=T.length>1?1:0;D<T.length;D++)for(N=T[D],_=0;_<N.axes.length;_++)I.moveTo(N.position.x,N.position.y),I.lineTo((N.vertices[0].x+N.vertices[N.vertices.length-1].x)/2,(N.vertices[0].y+N.vertices[N.vertices.length-1].y)/2)}E.wireframes?(I.strokeStyle="indianred",I.lineWidth=1):(I.strokeStyle="rgba(255, 255, 255, 0.4)",I.globalCompositeOperation="overlay",I.lineWidth=2),I.stroke(),I.globalCompositeOperation="source-over"},o.bodyPositions=function(y,C,$){var I=$;y.engine;var E=y.options,N,k,D,_;for(I.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.render.visible)for(_=0;_<N.parts.length;_++)k=N.parts[_],I.arc(k.position.x,k.position.y,3,0,2*Math.PI,!1),I.closePath();for(E.wireframes?I.fillStyle="indianred":I.fillStyle="rgba(0,0,0,0.5)",I.fill(),I.beginPath(),D=0;D<C.length;D++)N=C[D],N.render.visible&&(I.arc(N.positionPrev.x,N.positionPrev.y,2,0,2*Math.PI,!1),I.closePath());I.fillStyle="rgba(255,165,0,0.8)",I.fill()},o.bodyVelocity=function(y,C,$){var I=$;I.beginPath();for(var E=0;E<C.length;E++){var N=C[E];if(N.render.visible){var k=s.getVelocity(N);I.moveTo(N.position.x,N.position.y),I.lineTo(N.position.x+k.x,N.position.y+k.y)}}I.lineWidth=3,I.strokeStyle="cornflowerblue",I.stroke()},o.bodyIds=function(y,C,$){var I=$,E,N;for(E=0;E<C.length;E++)if(C[E].render.visible){var k=C[E].parts;for(N=k.length>1?1:0;N<k.length;N++){var D=k[N];I.font="12px Arial",I.fillStyle="rgba(255,255,255,0.5)",I.fillText(D.id,D.position.x+10,D.position.y-10)}}},o.collisions=function(y,C,$){var I=$,E=y.options,N,k,D,_;for(I.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.isActive)for(k=N.collision,_=0;_<N.contactCount;_++){var R=N.contacts[_],T=R.vertex;I.rect(T.x-1.5,T.y-1.5,3.5,3.5)}for(E.wireframes?I.fillStyle="rgba(255,255,255,0.7)":I.fillStyle="orange",I.fill(),I.beginPath(),D=0;D<C.length;D++)if(N=C[D],!!N.isActive&&(k=N.collision,N.contactCount>0)){var A=N.contacts[0].vertex.x,O=N.contacts[0].vertex.y;N.contactCount===2&&(A=(N.contacts[0].vertex.x+N.contacts[1].vertex.x)/2,O=(N.contacts[0].vertex.y+N.contacts[1].vertex.y)/2),k.bodyB===k.supports[0].body||k.bodyA.isStatic===!0?I.moveTo(A-k.normal.x*8,O-k.normal.y*8):I.moveTo(A+k.normal.x*8,O+k.normal.y*8),I.lineTo(A,O)}E.wireframes?I.strokeStyle="rgba(255,165,0,0.7)":I.strokeStyle="orange",I.lineWidth=1,I.stroke()},o.separations=function(y,C,$){var I=$,E=y.options,N,k,D,_,R;for(I.beginPath(),R=0;R<C.length;R++)if(N=C[R],!!N.isActive){k=N.collision,D=k.bodyA,_=k.bodyB;var T=1;!_.isStatic&&!D.isStatic&&(T=.5),_.isStatic&&(T=0),I.moveTo(_.position.x,_.position.y),I.lineTo(_.position.x-k.penetration.x*T,_.position.y-k.penetration.y*T),T=1,!_.isStatic&&!D.isStatic&&(T=.5),D.isStatic&&(T=0),I.moveTo(D.position.x,D.position.y),I.lineTo(D.position.x+k.penetration.x*T,D.position.y+k.penetration.y*T)}E.wireframes?I.strokeStyle="rgba(255,165,0,0.5)":I.strokeStyle="orange",I.stroke()},o.inspector=function(y,C){y.engine;var $=y.selected,I=y.render,E=I.options,N;if(E.hasBounds){var k=I.bounds.max.x-I.bounds.min.x,D=I.bounds.max.y-I.bounds.min.y,_=k/I.options.width,R=D/I.options.height;C.scale(1/_,1/R),C.translate(-I.bounds.min.x,-I.bounds.min.y)}for(var T=0;T<$.length;T++){var A=$[T].data;switch(C.translate(.5,.5),C.lineWidth=1,C.strokeStyle="rgba(255,165,0,0.9)",C.setLineDash([1,2]),A.type){case"body":N=A.bounds,C.beginPath(),C.rect(Math.floor(N.min.x-3),Math.floor(N.min.y-3),Math.floor(N.max.x-N.min.x+6),Math.floor(N.max.y-N.min.y+6)),C.closePath(),C.stroke();break;case"constraint":var O=A.pointA;A.bodyA&&(O=A.pointB),C.beginPath(),C.arc(O.x,O.y,10,0,2*Math.PI),C.closePath(),C.stroke();break}C.setLineDash([]),C.translate(-.5,-.5)}y.selectStart!==null&&(C.translate(.5,.5),C.lineWidth=1,C.strokeStyle="rgba(255,165,0,0.6)",C.fillStyle="rgba(255,165,0,0.1)",N=y.selectBounds,C.beginPath(),C.rect(Math.floor(N.min.x),Math.floor(N.min.y),Math.floor(N.max.x-N.min.x),Math.floor(N.max.y-N.min.y)),C.closePath(),C.stroke(),C.fill(),C.translate(-.5,-.5)),E.hasBounds&&C.setTransform(1,0,0,1,0,0)};var m=function(y,C){var $=y.engine,I=y.timing,E=I.historySize,N=$.timing.timestamp;I.delta=C-I.lastTime||o._goodDelta,I.lastTime=C,I.timestampElapsed=N-I.lastTimestamp||0,I.lastTimestamp=N,I.deltaHistory.unshift(I.delta),I.deltaHistory.length=Math.min(I.deltaHistory.length,E),I.engineDeltaHistory.unshift($.timing.lastDelta),I.engineDeltaHistory.length=Math.min(I.engineDeltaHistory.length,E),I.timestampElapsedHistory.unshift(I.timestampElapsed),I.timestampElapsedHistory.length=Math.min(I.timestampElapsedHistory.length,E),I.engineUpdatesHistory.unshift($.timing.lastUpdatesPerFrame),I.engineUpdatesHistory.length=Math.min(I.engineUpdatesHistory.length,E),I.engineElapsedHistory.unshift($.timing.lastElapsed),I.engineElapsedHistory.length=Math.min(I.engineElapsedHistory.length,E),I.elapsedHistory.unshift(I.lastElapsed),I.elapsedHistory.length=Math.min(I.elapsedHistory.length,E)},g=function(y){for(var C=0,$=0;$<y.length;$+=1)C+=y[$];return C/y.length||0},v=function(y,C){var $=document.createElement("canvas");return $.width=y,$.height=C,$.oncontextmenu=function(){return!1},$.onselectstart=function(){return!1},$},x=function(y){var C=y.getContext("2d"),$=window.devicePixelRatio||1,I=C.webkitBackingStorePixelRatio||C.mozBackingStorePixelRatio||C.msBackingStorePixelRatio||C.oBackingStorePixelRatio||C.backingStorePixelRatio||1;return $/I},b=function(y,C){var $=y.textures[C];return $||($=y.textures[C]=new Image,$.src=C,$)},w=function(y,C){var $=C;/(jpg|gif|png)$/.test(C)&&($="url("+C+")"),y.canvas.style.background=$,y.canvas.style.backgroundSize="contain",y.currentBackground=C}})()},function(t,i,r){var o={};t.exports=o;var s=r(5),a=r(17),l=r(0);(function(){o._maxFrameDelta=1e3/15,o._frameDeltaFallback=1e3/60,o._timeBufferMargin=1.5,o._elapsedNextEstimate=1,o._smoothingLowerBound=.1,o._smoothingUpperBound=.9,o.create=function(u){var d={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},f=l.extend(d,u);return f.fps=0,f},o.run=function(u,d){return u.timeBuffer=o._frameDeltaFallback,function f(h){u.frameRequestId=o._onNextFrame(u,f),h&&u.enabled&&o.tick(u,d,h)}(),u},o.tick=function(u,d,f){var h=l.now(),p=u.delta,m=0,g=f-u.timeLastTick;if((!g||!u.timeLastTick||g>Math.max(o._maxFrameDelta,u.maxFrameTime))&&(g=u.frameDelta||o._frameDeltaFallback),u.frameDeltaSmoothing){u.frameDeltaHistory.push(g),u.frameDeltaHistory=u.frameDeltaHistory.slice(-u.frameDeltaHistorySize);var v=u.frameDeltaHistory.slice(0).sort(),x=u.frameDeltaHistory.slice(v.length*o._smoothingLowerBound,v.length*o._smoothingUpperBound),b=c(x);g=b||g}u.frameDeltaSnapping&&(g=1e3/Math.round(1e3/g)),u.frameDelta=g,u.timeLastTick=f,u.timeBuffer+=u.frameDelta,u.timeBuffer=l.clamp(u.timeBuffer,0,u.frameDelta+p*o._timeBufferMargin),u.lastUpdatesDeferred=0;var w=u.maxUpdates||Math.ceil(u.maxFrameTime/p),y={timestamp:d.timing.timestamp};s.trigger(u,"beforeTick",y),s.trigger(u,"tick",y);for(var C=l.now();p>0&&u.timeBuffer>=p*o._timeBufferMargin;){s.trigger(u,"beforeUpdate",y),a.update(d,p),s.trigger(u,"afterUpdate",y),u.timeBuffer-=p,m+=1;var $=l.now()-h,I=l.now()-C,E=$+o._elapsedNextEstimate*I/m;if(m>=w||E>u.maxFrameTime){u.lastUpdatesDeferred=Math.round(Math.max(0,u.timeBuffer/p-o._timeBufferMargin));break}}d.timing.lastUpdatesPerFrame=m,s.trigger(u,"afterTick",y),u.frameDeltaHistory.length>=100&&(u.lastUpdatesDeferred&&Math.round(u.frameDelta/p)>w?l.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):u.lastUpdatesDeferred&&l.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof u.isFixed<"u"&&l.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(u.deltaMin||u.deltaMax)&&l.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),u.fps!==0&&l.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},o.stop=function(u){o._cancelNextFrame(u)},o._onNextFrame=function(u,d){if(typeof window<"u"&&window.requestAnimationFrame)u.frameRequestId=window.requestAnimationFrame(d);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return u.frameRequestId},o._cancelNextFrame=function(u){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(u.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var c=function(u){for(var d=0,f=u.length,h=0;h<f;h+=1)d+=u[h];return d/f||0}})()},function(t,i,r){var o={};t.exports=o;var s=r(8),a=r(0),l=a.deprecated;(function(){o.collides=function(c,u){return s.collides(c,u)},l(o,"collides","SAT.collides  replaced by Collision.collides")})()},function(t,i,r){var o={};t.exports=o,r(1);var s=r(0);(function(){o.pathToVertices=function(a,l){typeof window<"u"&&!("SVGPathSeg"in window)&&s.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var c,u,d,f,h,p,m,g,v,x,b=[],w,y,C=0,$=0,I=0;l=l||15;var E=function(k,D,_){var R=_%2===1&&_>1;if(!v||k!=v.x||D!=v.y){v&&R?(w=v.x,y=v.y):(w=0,y=0);var T={x:w+k,y:y+D};(R||!v)&&(v=T),b.push(T),$=w+k,I=y+D}},N=function(k){var D=k.pathSegTypeAsLetter.toUpperCase();if(D!=="Z"){switch(D){case"M":case"L":case"T":case"C":case"S":case"Q":$=k.x,I=k.y;break;case"H":$=k.x;break;case"V":I=k.y;break}E($,I,k.pathSegType)}};for(o._svgPathToAbsolute(a),d=a.getTotalLength(),p=[],c=0;c<a.pathSegList.numberOfItems;c+=1)p.push(a.pathSegList.getItem(c));for(m=p.concat();C<d;){if(x=a.getPathSegAtLength(C),h=p[x],h!=g){for(;m.length&&m[0]!=h;)N(m.shift());g=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":f=a.getPointAtLength(C),E(f.x,f.y,0);break}C+=l}for(c=0,u=m.length;c<u;++c)N(m[c]);return b},o._svgPathToAbsolute=function(a){for(var l,c,u,d,f,h,p=a.pathSegList,m=0,g=0,v=p.numberOfItems,x=0;x<v;++x){var b=p.getItem(x),w=b.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(w))"x"in b&&(m=b.x),"y"in b&&(g=b.y);else switch("x1"in b&&(u=m+b.x1),"x2"in b&&(f=m+b.x2),"y1"in b&&(d=g+b.y1),"y2"in b&&(h=g+b.y2),"x"in b&&(m+=b.x),"y"in b&&(g+=b.y),w){case"m":p.replaceItem(a.createSVGPathSegMovetoAbs(m,g),x);break;case"l":p.replaceItem(a.createSVGPathSegLinetoAbs(m,g),x);break;case"h":p.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(m),x);break;case"v":p.replaceItem(a.createSVGPathSegLinetoVerticalAbs(g),x);break;case"c":p.replaceItem(a.createSVGPathSegCurvetoCubicAbs(m,g,u,d,f,h),x);break;case"s":p.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(m,g,f,h),x);break;case"q":p.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(m,g,u,d),x);break;case"t":p.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(m,g),x);break;case"a":p.replaceItem(a.createSVGPathSegArcAbs(m,g,b.r1,b.r2,b.angle,b.largeArcFlag,b.sweepFlag),x);break;case"z":case"Z":m=l,g=c;break}(w=="M"||w=="m")&&(l=m,c=g)}}})()},function(t,i,r){var o={};t.exports=o;var s=r(6);r(0),function(){o.create=s.create,o.add=s.add,o.remove=s.remove,o.clear=s.clear,o.addComposite=s.addComposite,o.addBody=s.addBody,o.addConstraint=s.addConstraint}()}])})})(e_);var Cn=e_.exports;function zm(n){if(!cy(n))throw new Error("Parameter was not an error")}function cy(n){return!!n&&typeof n=="object"&&$pe(n)==="[object Error]"||n instanceof Error}function $pe(n){return Object.prototype.toString.call(n)}const Epe="Layerr";let Npe=Epe;function kpe(){return Npe}function Dpe(n){let e,t="";if(n.length===0)e={};else if(cy(n[0]))e={cause:n[0]},t=n.slice(1).join(" ")||"";else if(n[0]&&typeof n[0]=="object")e=Object.assign({},n[0]),t=n.slice(1).join(" ")||"";else if(typeof n[0]=="string")e={},t=t=n.join(" ")||"";else throw new Error("Invalid arguments passed to Layerr");return{options:e,shortMessage:t}}class fo extends Error{constructor(e,t){const i=[...arguments],{options:r,shortMessage:o}=Dpe(i);let s=o;if(r.cause&&(s=`${s}: ${r.cause.message}`),super(s),this.message=s,r.name&&typeof r.name=="string"?this.name=r.name:this.name=kpe(),r.cause&&Object.defineProperty(this,"_cause",{value:r.cause}),Object.defineProperty(this,"_info",{value:{}}),r.info&&typeof r.info=="object"&&Object.assign(this._info,r.info),Error.captureStackTrace){const a=r.constructorOpt||this.constructor;Error.captureStackTrace(this,a)}}static cause(e){return zm(e),e._cause&&cy(e._cause)?e._cause:null}static fullStack(e){zm(e);const t=fo.cause(e);return t?`${e.stack}
caused by: ${fo.fullStack(t)}`:e.stack??""}static info(e){zm(e);const t={},i=fo.cause(e);return i&&Object.assign(t,fo.info(i)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}const t_="0123456789ABCDEFGHJKMNPQRSTVWXYZ",Pc=32,ZS=0xffffffffffff,Tpe=10,Rpe=16,Nc=Object.freeze({source:"ulid"});function _pe(n){const e=Ape(),t=e&&(e.crypto||e.msCrypto)||null;if(typeof(t==null?void 0:t.getRandomValues)=="function")return()=>{const i=new Uint8Array(1);return t.getRandomValues(i),i[0]/255};if(typeof(t==null?void 0:t.randomBytes)=="function")return()=>t.randomBytes(1).readUInt8()/255;throw new fo({info:{code:"PRNG_DETECT",...Nc}},"Failed to find a reliable PRNG")}function Ape(){return Mpe()?self:typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:null}function Ope(n,e){let t="";for(;n>0;n--)t=Fpe(e)+t;return t}function Ppe(n,e){if(isNaN(n))throw new fo({info:{code:"ENC_TIME_NAN",...Nc}},`Time must be a number: ${n}`);if(n>ZS)throw new fo({info:{code:"ENC_TIME_SIZE_EXCEED",...Nc}},`Cannot encode a time larger than ${ZS}: ${n}`);if(n<0)throw new fo({info:{code:"ENC_TIME_NEG",...Nc}},`Time must be positive: ${n}`);if(Number.isInteger(n)===!1)throw new fo({info:{code:"ENC_TIME_TYPE",...Nc}},`Time must be an integer: ${n}`);let t,i="";for(let r=e;r>0;r--)t=n%Pc,i=t_.charAt(t)+i,n=(n-t)/Pc;return i}function Mpe(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function Fpe(n){let e=Math.floor(n()*Pc);return e===Pc&&(e=Pc-1),t_.charAt(e)}function Lpe(n,e){const t=_pe(),i=isNaN(n)?Date.now():n;return Ppe(i,Tpe)+Ope(Rpe,t)}var ui=[];for(var Bm=0;Bm<256;++Bm)ui.push((Bm+256).toString(16).slice(1));function zpe(n,e=0){return(ui[n[e+0]]+ui[n[e+1]]+ui[n[e+2]]+ui[n[e+3]]+"-"+ui[n[e+4]]+ui[n[e+5]]+"-"+ui[n[e+6]]+ui[n[e+7]]+"-"+ui[n[e+8]]+ui[n[e+9]]+"-"+ui[n[e+10]]+ui[n[e+11]]+ui[n[e+12]]+ui[n[e+13]]+ui[n[e+14]]+ui[n[e+15]]).toLowerCase()}var Qd,Bpe=new Uint8Array(16);function Vpe(){if(!Qd&&(Qd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qd))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qd(Bpe)}var Wpe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const QS={randomUUID:Wpe};function Vm(n,e,t){if(QS.randomUUID&&!e&&!n)return QS.randomUUID();n=n||{};var i=n.random||(n.rng||Vpe)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,zpe(i)}const n_=800,qo=n_/2,i_=100,tf=i_/2,nv=13;var ka=(n=>(n.Human="human",n.Robot="robot",n))(ka||{});function kc(n,e){return iu(n,-e,e)/e}eU("cpu");const Gpe=1,e1=50,Hpe=.2,Upe=4;class vs{constructor(e,t){jn(this,"model");jn(this,"type",ka.Robot);jn(this,"name");this.model=t??this.init(),this.name=e??Lpe()}static async load(e,t){const i=await wk(t);return new vs(e,i)}init(){const e=W9();return e.add(_m({inputShape:[4],units:10,activation:"relu"})),e.add(_m({units:10,activation:"linear"})),e.add(_m({units:1,activation:"tanh"})),e.compile({optimizer:"adam",loss:"meanSquaredError"}),e}getModelDescription(){const e=[];return ie(()=>{let t;this.model.layers.forEach((i,r,{length:o})=>{i.getWeights().forEach(s=>{if(s.shape.length===2){const a=s.shape[0],l=s.shape[1],c=t??Array(a).fill(0).map(()=>Vm()),u=Array(l).fill(0).map(()=>Vm());e.length===0&&e.push({type:di.Neuron,neuronLayerType:aa.Input,neurons:Array(a).fill(0).map((f,h)=>({id:c[h],bias:0}))});const d=s.arraySync();e.push({type:di.Axon,axons:Array(a*l).fill(0).map((f,h)=>{const p=Math.trunc(h/l),m=h%l;return{id:Vm(),from:c[p],to:u[m],weight:d[p][m]}})}),e.push({type:di.Neuron,neuronLayerType:r===o-1?aa.Output:aa.Hidden,neurons:Array(l).fill(0).map((f,h)=>({id:u[h],bias:0}))}),t=u}else{const a=e.at(-1);if($t(a)||a.type!==di.Neuron)throw new Error("Unknown model structure");s.arraySync().forEach((c,u)=>{a.neurons[u].bias=c})}})})}),e}async mutate(e){const t=await Kpe(this.model,WO(e??Math.random()*Hpe,Upe));return new vs(void 0,t)}async crossoverModels(e){try{const t=await jpe(this.model,e.model);return new vs(void 0,t)}catch{return await this.mutate()}}play(e){const{pivot:t,bobs:[i]}=e,r=Cn.Vector.sub(i.position,t.position),o=kc(Cn.Vector.angle(r,{x:0,y:1}),Math.PI),s=kc(i.velocity.x,e1),a=kc(i.velocity.y,e1),l=kc(t.position.x,qo);return{pivotVelocity:ie(()=>{const u=ch([[s,a,o,l]]),d=this.model.predict(u),f=d.shape;if(f.length===1)return d.arraySync()[0];if(f.length===2)return d.arraySync()[0][0];throw new Error(`Unsupported shape: ${f}`)})*Gpe}}async save(e){await this.model.save(e)}dispose(){this.model.dispose()}}async function r_(n){const e=await new Promise(t=>n.save({async save(i){return t(i),{modelArtifactsInfo:{dateSaved:new Date,modelTopologyType:"JSON"}}}}));return await wk({load:async()=>e})}async function jpe(n,e){const t=n.layers,i=e.layers;if(t.length!==i.length)throw new Error("Layers of parents are not equal");const r=await r_(n);return ie(()=>t.forEach((o,s)=>{const a=o.getWeights(),l=i[s].getWeights();if(a.length!==l.length)throw r.dispose(),new Error("Layers of parents are not equal");const c=a.map((u,d)=>{const f=l[d],h=u.shape,p=Math.trunc(Math.random()*h[0]),m=u.arraySync().slice(0,p),g=f.arraySync().slice(p);return cl([...m,...g],h)});r.layers[s].setWeights(c)})),r}async function Kpe(n,e){const t=await r_(n);return ie(()=>t.layers.forEach(i=>{if(i.getWeights().length>0){const o=i.getWeights().map(s=>{const a=s.shape,l=A2(a,0,e);return s.add(l)});i.setWeights(o)}})),t}function o_(){const n=EF(F4),{robotId:e}=sA(),t=S.useMemo(()=>$t(n)||$t(e)?af(wy):n.getRobot$(e).pipe(Sl(i=>$t(i)?m1(aA(lA.NOT_FOUND,{message:"Robot not found",description:`Robot "${e}" not found in database, try selecting another robot`})):zc(i)),nM(({value:{name:i,modelUrl:r}})=>ra(vs.load(i,r)).pipe(Sl(o=>zc(o)))),iM(),eM(cA)),[n,e]);return NF(t,wy)}const Xpe="_alert-container_1yerd_1",qpe="_left-aligned_1yerd_11",Ype="_container_1yerd_15",Jpe="_container__child-fill_1yerd_21",Zpe="_description_1yerd_27",Qpe="_description-with-removal_1yerd_27",eme="_description__icon_1yerd_38",tme="_description-with-removal__close_1yerd_42",nme="_description__close_1yerd_50",br={alertContainer:Xpe,leftAligned:qpe,container:Ype,containerChildFill:Jpe,description:Zpe,descriptionWithRemoval:Qpe,descriptionIcon:eme,descriptionWithRemovalClose:tme,descriptionClose:nme},tl=30,gr=tl/2,ime=gr**2,Hi=5,t1=150,n1=2,i1=4,no=4,r1="14px monospace",rme=S.memo(()=>{const n=S.useRef(null),{width:e=0,height:t=0}=gv({ref:n,box:"border-box"}),[i,r]=S.useState(),o=S.useRef(null);S.useEffect(()=>{const m=o.current;$t(m)||r(m.getContext("2d",{alpha:!1})??void 0)},[]);const s=o_(),a=S.useMemo(()=>ml(s,{synced:({value:m})=>m.getModelDescription(),unsynced:()=>{}}),[s]),{drawingObjects:l,neuralNetworkWidth:c,neuralNetworkHeight:u}=S.useMemo(()=>{if($t(a))return{drawingObjects:[],neuralNetworkWidth:0,neuralNetworkHeight:0};const m=Math.max(...a.filter(y=>y.type===di.Neuron).map(({neurons:{length:y}})=>y)),g=m*tl+(m-1)*Hi,v=a.reduce((y,C,$,{length:I})=>{const{type:E}=C;switch($!==I-1&&(y+=Hi),E){case di.Neuron:return y+tl;case di.Axon:return y+t1;default:em(E)}},0),x=new Map,b=[];let w=0;for(const y of a){if(y.type===di.Axon){w+=t1+Hi;continue}const C=y.neurons.length,$=C*tl+(C-1)*Hi,I=(g-$)/2;y.neurons.forEach((E,N)=>{const k=w+gr,D=I+gr+N*(tl+Hi);x.set(E.id,{x:k,y:D}),b.push({...E,type:di.Neuron,layerType:y.neuronLayerType,x:k,y:D})}),w+=tl+Hi}for(const y of a)y.type===di.Axon&&y.axons.forEach(C=>{const $=x.get(C.from),I=x.get(C.to);if($t($)||$t(I))return;const E=I.x-$.x,N=I.y-$.y,k=gr+Hi,D=N*(gr+Hi)/E,_=$.x+k,R=$.y+D,T=I.x-k,A=I.y-D;b.push({...C,type:di.Axon,fromX:_,fromY:R,toX:T,toY:A,neuronFromX:$.x,neuronFromY:$.y,neuronToX:I.x,neuronToY:I.y})});return{drawingObjects:b,neuralNetworkWidth:v,neuralNetworkHeight:g}},[a]),[d,f]=S.useState(void 0);S.useEffect(()=>{if(!$t(i)){i.clearRect(0,0,e,t),i.save(),i.translate(e-c>>1,t-u>>1);for(const m of l){const{type:g}=m;switch(g){case di.Neuron:{const v=(d==null?void 0:d.id)===m.id;i.beginPath(),i.arc(m.x,m.y,gr,0,2*Math.PI),i.fillStyle=m.layerType===aa.Input?"#d4380d":m.layerType===aa.Output?"#faad14":"#1677ff",i.fill(),i.lineWidth=v?i1:n1,i.strokeStyle=v?"#ffffff":"#d9d9d9",i.stroke();break}case di.Axon:{const v=(d==null?void 0:d.id)===m.from||(d==null?void 0:d.id)===m.to;i.beginPath(),i.moveTo(m.fromX,m.fromY),i.lineTo(m.toX,m.toY),i.lineWidth=v?i1:n1,i.strokeStyle=v?"#ffffff":"#d9d9d9",i.stroke();break}default:em(g)}}for(const m of l){const{type:g}=m;switch(g){case di.Neuron:{if(!((d==null?void 0:d.id)===m.id)||m.layerType===aa.Input)break;i.font=r1;const x=m.bias.toString(),{width:b,actualBoundingBoxAscent:w,actualBoundingBoxDescent:y}=i.measureText(x),C=Math.ceil(w+y),$=b+2*no,I=C+2*no;i.fillStyle="#000000",i.fillRect(m.x-b/2,m.y+gr+Hi,$,I),i.fillStyle="#ffffff",i.fillText(x,m.x-b/2+no,m.y+gr+Hi+C+no);break}case di.Axon:{if(!((d==null?void 0:d.id)===m.from||(d==null?void 0:d.id)===m.to))break;i.font=r1;const x=m.weight.toString(),{width:b,actualBoundingBoxAscent:w,actualBoundingBoxDescent:y}=i.measureText(x),C=Math.ceil(w+y),$=b+2*no,I=C+2*no,{rectX:E,rectY:N,textX:k,textY:D}=(d==null?void 0:d.id)===m.to?{rectX:m.neuronFromX-b-gr-Hi-no,rectY:m.neuronFromY-C/2-no,textX:m.neuronFromX-b-gr-Hi,textY:m.neuronFromY+C/2}:{rectX:m.neuronToX+gr+Hi-no,rectY:m.neuronToY-C/2-no,textX:m.neuronToX+gr+Hi,textY:m.neuronToY+C/2};i.fillStyle="#000000",i.fillRect(E,N,$,I),i.fillStyle="#ffffff",i.fillText(x,k,D);break}default:em(g)}}i.restore()}},[i,l,e,t,c,u,d]),TI(qi(({x:m,y:g})=>{const v=e-c>>1,x=t-u>>1;for(const b of l)if(b.type===di.Neuron&&ime>(m-v-b.x)**2+(g-x-b.y)**2){f(b);return}f(void 0)}),o);const h=mv(),p=qi(()=>h("/pendulum"));return st.jsxs("div",{ref:n,className:br.container,children:[st.jsx("canvas",{ref:o,className:br.containerChildFill,width:e,height:t}),ml(s,{synced:({value:m})=>st.jsxs("div",{className:br.descriptionWithRemoval,onClick:p,children:[st.jsx(g$,{}),m.name,st.jsx(dv,{className:br.descriptionClose})]}),unsynced:m=>Zs(m)?st.jsx("div",{className:br.alertContainer,children:st.jsx(E1,{})}):xl(m)?st.jsx(rf,{fail:m.fail}):st.jsx("div",{className:br.alertContainer,children:st.jsx(D1,{message:"Select a robot to display the structure of the neural network and its weights",type:"info",showIcon:!0})})})]})}),s_=-4,ome=-2,sme=10,ame=50;function lme(n){return Array(n).fill(0).map(()=>new vs)}async function cme(n){return Promise.all(n.map(({name:e,modelUrl:t})=>vs.load(e,t)))}function ume(n,e){return async function(t,i,r){if(r>=e)return!1;const o=Math.trunc(Math.min(t.length,n)/5),s=P1(t,({score:c})=>c,"desc").filter(c=>c.player.type===ka.Robot),a=[];for(const{player:c,score:u}of s.slice(0,o))u<=i*s_?a.push(await c.mutate(.02)):u<=i*ome?(a.push(await c.mutate(.005)),a.push(await c.mutate(.05)),a.push(await c.mutate(.1))):a.push(dme(c,i,u));for(let c=0;c<o;c++){const u=a[c];!("player"in u)&&!$t(u.mutate)&&(a.push(await u.mutate(.01)),a.push(await u.mutate(.05)))}const l=UO(s.slice(o));for(;a.length<n;)switch(fme({action:"mutate",probability:50},{action:"mutate-aggressive",probability:5},{action:"crossover",probability:10},{action:"pick",probability:5},{action:"new",probability:1})){case"mutate":{const u=eh(s).player;a.push(await u.mutate(.1));break}case"mutate-aggressive":{const u=eh(s).player;a.push(await u.mutate(.2));break}case"crossover":{const u=eh(s).player,d=eh(s).player;u!==d&&!$t(u.crossoverModels)&&a.push(await u.crossoverModels(d));break}case"pick":{if(l.length>0){const{player:u}=l.splice(0,1)[0];a.push(u)}break}case"new":{a.push(new vs);break}}return a}}function dme(n,e,t){if(t<=e*sme)return n;const i=iu(t/(e*ame),0,qo);if(i===0)return n;const r={pivotPosition:hme(-i,i)};return{player:n,pendulumOptions:r}}function hme(n,e){return Math.floor(Math.random()*(e-n)+n)}function eh(n){return n[Math.trunc(Math.random()*n.length)]}function fme(...n){ov(n.length>0,"Actions must not be empty");const e=KO(n.map(({probability:r})=>r)),t=Math.random()*e;let i=0;for(const{action:r,probability:o}of n)if(i+=o,t<i)return r;return n.at(-1).action}function pme(n){const e={positiveTime:0,negativeTime:0,jitterDetector:[]};return t=>{const{pivot:i,bobs:[r]}=n,o=Cn.Vector.sub(r.position,i.position),a=Cn.Vector.angle(o,{x:0,y:1})>0,l=iu(Cn.Vector.magnitude(r.velocity),0,10),c=Math.abs(kc(i.position.x,qo));e.jitterDetector.push(c),e.jitterDetector.length>50&&e.jitterDetector.shift(),a?(e.positiveTime+=t,e.negativeTime=0):(e.negativeTime+=t,e.positiveTime=0);let u=0,d=0,f=0;for(let C=0,$=void 0;C<e.jitterDetector.length-1;C++){const I=e.jitterDetector[C],E=Math.sign(e.jitterDetector[C+1]-I);if(E===0){d++;continue}d=0,$!==void 0&&$!==E&&u++,$=E,I<.1&&(f+=.1-I)}const h=Math.max(e.positiveTime*(1+d)/800,e.positiveTime/50)+e.positiveTime/20*Math.max(0,5-u),p=a?f*10:0,m=a?(10-l)*10:0,g=a?0:l*10,v=h+p+m+g,x=c>.2?c*100:0,b=Math.max(e.negativeTime*(1+d)/800,e.negativeTime/50),w=u*10,y=x+b+w;return Math.round(v-y)}}const o1=30,mme=1e4,s1=2e4;function gme(){const n=nf(),e=bl(bv),[t,i]=S.useState(),r=qi(async()=>{var f;if(!gl(e))return;const{competitionStart:s,generations:a}=e.value,l=ume(o1,mme),c=(f=a==null?void 0:a.at(-1))==null?void 0:f.players.map(({name:h,modelUrl:p})=>({name:h,modelUrl:p}));let u=(a==null?void 0:a.length)??0;const d={start:s,get generationsCount(){return u},init:$t(c)?lme.bind(void 0,o1):cme.bind(void 0,c),scoreCalculatorBuilder:pme,competitionForPlayerCompleted(h,p){return p<s_*s1},competitionCompleted(h){return h>=s1},async restartCompetition(h,p){u++;const m=await Promise.all(h.filter(g=>g.player.type===ka.Robot).map(async({player:g,score:v})=>{const x=`indexeddb://${d.start}-player-${g.name}}`;return await g.save(x),{name:g.name,modelUrl:x,score:v}}));return n(yA({competitionStart:s,generation:{id:u,maxScore:AO(h.map(({score:g})=>g))??0,players:m.sort((g,v)=>v.score-g.score)}})),l(h,p,u)}};i(d)}),o=gl(e)?e.value.competitionStart:void 0;return S.useEffect(()=>{$t(o)?i(void 0):r()},[r,o]),t}const a1=30;function a_(n,e){const t=S.useRef(0);S.useEffect(()=>{if(n||$t(e))return;let s=performance.now(),a=requestAnimationFrame(function l(){const c=performance.now();t.current=Math.round(200/(c-s))*5,s=c,a=requestAnimationFrame(l)});return()=>cancelAnimationFrame(a)},[n,e]);const{frameTime:i,deltaTime:r}=JO(n),o=S.useMemo(()=>{const s=new Set;let a=!1,l=1;return{subscribe(c){return s.add(c),()=>s.delete(c)},async update(c){if(a)return;t.current<a1?l=Math.max(1,l-1):t.current>=a1&&l++;const u=(e==null?void 0:e(c,l))??c;a=!0,await Promise.all(Array.from(s.keys()).map(async d=>{const f=Array.isArray(u)?u:[u];for(const h of f)await d(h)})),a=!1},dispose(){s.clear()}}},[e]);return S.useEffect(()=>void o.update(r),[i,r,o]),o}function Wm(n){ov(n.bobsCount>=1,"Bobs count must be at least 1");const e=Cn.Engine.create(),{world:t}=e,i=Cn.Bodies.circle(0,0,nv,{inertia:1/0,inverseInertia:0,restitution:1,friction:0,frictionAir:0,frictionStatic:0});Cn.Body.setStatic(i,!0),Cn.World.add(t,[i]);const r=[];for(let o=i,s=0;s<n.bobsCount;s++){const a=Cn.Bodies.circle(0,i_*(s+1),nv,{inertia:1/0,inverseInertia:0,restitution:1,friction:0,frictionAir:0,frictionStatic:0});Cn.World.add(t,[a]),Cn.World.add(t,Cn.Constraint.create({bodyA:o,bodyB:a,stiffness:1,damping:0})),o=a,r.push(a)}return!$t(n.pivotPosition)&&n.pivotPosition!==0&&Cn.Body.setPosition(i,{x:iu(n.pivotPosition,-qo,qo),y:0}),{engine:e,pivot:i,bobs:r}}const Gm=500,vme=5e-4;function xme(n,e,t,i){if(e===0)return;const{engine:r,pivot:o}=n,s=Cn.Vector.add(o.position,{x:t.pivotVelocity*e,y:0});if(Cn.Body.setPosition(o,{x:iu(s.x,-qo,qo),y:0}),!$t(i)){const a=i;n.bobs.forEach(l=>{const c=Cn.Vector.sub(l.position,a),u=Cn.Vector.magnitude(c);if(u>Gm)return;const d=Cn.Vector.mult(Cn.Vector.normalise(c),(Gm-u)/Gm*vme);Cn.Body.applyForce(l,l.position,d)})}Cn.Engine.update(r,e)}class bme{constructor(e,t={bobsCount:1}){jn(this,"_gravity",1);jn(this,"queueRenderFrameId");jn(this,"tickerStarted",!1);jn(this,"playersWithWorlds",[]);jn(this,"competitions",[]);jn(this,"renderer");jn(this,"additionalForcePosition");this.ticker=e,this.defaultPendulumOptions=t}async tick(e){var i;await Promise.all(this.playersWithWorlds.map(async r=>{const{player:o,world:s,active:a,competition:l,getScore:c,score:u}=r;if(!a)return;const d=await o.play(s,e);xme(s,e,d,this.additionalForcePosition),$t(c)||(r.score=u+c(e)),!$t(l)&&!$t(l.competitionForPlayerCompleted)&&l.competitionForPlayerCompleted(o,r.score)&&(r.active=!1,r.score=-1/0)})),this.competitions.forEach(r=>{r.timeStamp+=e,r.competition.competitionCompleted(r.timeStamp,this.playersWithWorlds)&&this.playersWithWorlds.forEach(o=>o.active=!1)});const t=this.competitions.filter(({competition:r})=>this.playersWithWorlds.every(({competition:o,active:s})=>o!==r||!s));for(const r of t){const{competition:o}=r,s=this.playersWithWorlds.filter(({competition:l})=>l===o).map(({player:l,score:c})=>({player:l,score:c})),a=await o.restartCompetition(s,r.timeStamp);if(r.timeStamp=0,this.playersWithWorlds=this.playersWithWorlds.filter(({competition:l})=>l!==o),a!==!1){s.forEach(({player:l})=>{a.every(c=>"player"in c?c.player!==l:c!==l)&&l.dispose()});for(const l of a){const{player:c,pendulumOptions:u}="player"in l?{...l,pendulumOptions:{...this.defaultPendulumOptions,...l.pendulumOptions}}:{player:l,pendulumOptions:this.defaultPendulumOptions},d=Wm(u);d.engine.gravity.y=this._gravity,this.playersWithWorlds.push({player:c,world:d,pendulumOptions:u,active:!0,competition:o,getScore:o.scoreCalculatorBuilder(d),score:0})}}else s.forEach(({player:l})=>l.dispose()),this.competitions=this.competitions.filter(({competition:l})=>l!==o),(i=o.dispose)==null||i.call(o)}await this.render()}async render(){(!$t(this.renderer)||!$t(this.queueRenderFrameId))&&(this.queueRenderFrameId=requestAnimationFrame(async()=>{const e=this.renderer;$t(e)||(await e.renderStatic(),await e.render(this.playersWithWorlds.map(({world:t})=>t),this.additionalForcePosition)),this.queueRenderFrameId=void 0}))}startTicker(){this.tickerStarted||(this.ticker.subscribe(e=>this.tick(e)),this.tickerStarted=!0)}async addPlayer(e,t){const i={...this.defaultPendulumOptions,...t},r=Wm(i);r.engine.gravity.y=this._gravity,this.playersWithWorlds.push({player:e,world:r,active:!0,score:0,pendulumOptions:i}),await this.render(),this.startTicker()}async clear(){this.ticker.dispose(),this.tickerStarted=!1,this.competitions.forEach(({competition:e})=>{var t;return(t=e.dispose)==null?void 0:t.call(e)}),this.competitions=[],this.playersWithWorlds.forEach(({player:e})=>e.dispose()),this.playersWithWorlds=[],await this.render()}async addCompetition(e,t){const i={...this.defaultPendulumOptions,...t},r=await e.init();for(const o of r){const s=Wm(i);s.engine.gravity.y=this._gravity,this.playersWithWorlds.push({player:o,world:s,pendulumOptions:i,active:!0,competition:e,getScore:e.scoreCalculatorBuilder(s),score:0})}this.competitions.push({competition:e,timeStamp:0}),await this.render(),this.startTicker()}async setRenderer(e){this.renderer=e,await this.render()}setAdditionalForcePosition(e){this.additionalForcePosition=e}destroy(){this.ticker.dispose(),this.playersWithWorlds.forEach(({player:e})=>e.dispose()),this.competitions.forEach(({competition:e})=>{var t;return(t=e.dispose)==null?void 0:t.call(e)})}setGravity(e){this._gravity=e,this.playersWithWorlds.map(({world:t})=>t.engine.gravity.y=e)}}function l_(n,e,t){const[i,r]=S.useState();S.useEffect(()=>{const s=new bme(n);return r(s),()=>s.destroy()},[n]);const o=t==null?void 0:t.gravity;return S.useEffect(()=>{$t(o)||i==null||i.setGravity(o)},[i,o]),S.useEffect(()=>void(i==null?void 0:i.setRenderer(e)),[i,e]),i}function yme(n,{x:e,y:t}){n.save(),n.beginPath(),n.arc(e,t,20,0,2*Math.PI),n.lineWidth=2+Math.round(Math.random()*3),n.strokeStyle="#4096ff",n.stroke(),n.restore()}const po=2,Ks=12,l1=Ks/2,c1=70,c_=8,wme=4,th=10,u1=12,nh=15,d1=-15,Cme=Math.PI/8,h1=Cme/2,u_=5,Sme=2*Math.PI/u_;function d_(n,...e){n.save();for(const t of e)n.beginPath(),n.arc(t.x,t.y,nv,0,2*Math.PI),n.fillStyle="#FF5733",n.fill(),n.lineWidth=po,n.strokeStyle="white",n.stroke();n.restore()}function Ime(n,e){$me(n,e),Eme(n,e),d_(n,e)}function $me(n,e){n.save(),n.beginPath(),n.moveTo(e.x-tf,e.y),n.lineTo(e.x+tf,e.y),n.lineWidth=c_,n.lineCap="round",n.strokeStyle="white",n.stroke(),n.restore()}function Eme(n,e){const t=e.x-tf,i=e.x+tf,r=t-u1,o=i+u1,s=e.y-l1-th-po,a=t-d1,l=i+d1,c=e.y+l1+nh+po,u=e.x/(th+po),d=-e.x/(nh+po);ih(n,r,s,th,u),ih(n,o,s,th,u),ih(n,a,c,nh,d),ih(n,l,c,nh,d),n.save(),n.lineWidth=c_,n.lineCap="round",n.strokeStyle="white",n.beginPath(),n.moveTo(r,s),n.lineTo(t,e.y),n.lineTo(a,c),n.stroke(),n.beginPath(),n.moveTo(o,s),n.lineTo(i,e.y),n.lineTo(l,c),n.stroke(),n.restore()}function ih(n,e,t,i,r){n.save(),n.beginPath(),n.arc(e,t,i,0,2*Math.PI),n.lineWidth=po,n.strokeStyle="white",n.stroke(),n.restore();for(let o=0,s=r;o<u_;o++,s+=Sme)Nme(n,e,t,i-po*2,s)}function Nme(n,e,t,i,r){n.save(),n.beginPath(),n.moveTo(e,t),n.arc(e,t,i+po,r-h1,r+h1),n.fillStyle="white",n.fill(),n.restore()}function kme(n,...e){if(!(e.length<2)){n.save(),n.lineWidth=wme,n.strokeStyle="white",n.beginPath(),n.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)n.lineTo(e[t].x,e[t].y);n.stroke(),n.restore()}}function Dme(n,{pivot:e,bobs:t}){const i=t.map(({position:r})=>r);n.save(),kme(n,e.position,...i),Ime(n,e.position),d_(n,...i),n.restore()}function Tme(n){n.save(),n.strokeStyle="#999999",n.lineWidth=po,n.roundRect(-qo-c1,-Ks/2,n_+2*c1,Ks,Ks),n.stroke();const e=Math.trunc(qo/10);for(let t=-e;t<=e;t++){const i=t%10===0?3:t%5===0?2:1;if(n.beginPath(),n.moveTo(10*t,Ks),n.lineTo(10*t,(i+1)*Ks),n.stroke(),i===3){const r=Math.abs(t*10).toFixed(0);n.fillStyle="white",n.font="14px serif";const{width:o}=n.measureText(r);n.fillText(r,10*t-o/2,(i+2)*Ks+po)}}n.restore()}function h_(){const[n,e]=S.useState();return[S.useMemo(()=>{if(!$t(n))return{renderStatic(){const{staticContext:i,staticContext:{canvas:{width:r,height:o}}}=n;i.clearRect(0,0,r,o),i.save(),i.translate(r>>1,o>>1),Tme(i),i.restore()},render(i,r){const{context:o,context:{canvas:{width:s,height:a}}}=n;o.clearRect(0,0,s,a),o.save(),o.translate(s>>1,a>>1),i.forEach(l=>Dme(o,l)),$t(r)||yme(o,r),o.restore()}}},[n]),e]}const Rme=S.memo(({className:n,width:e,height:t,onCanvasContext:i})=>{const r=S.useRef(null),o=S.useRef(null);return S.useEffect(()=>{var l,c;const s=(l=r.current)==null?void 0:l.getContext("2d",{alpha:!1}),a=(c=o.current)==null?void 0:c.getContext("2d",{alpha:!0});!$t(a)&&!$t(s)&&i({staticContext:s,context:a})},[e,t,i]),st.jsxs("div",{className:ye(n),children:[st.jsx("canvas",{className:Cy.canvas,ref:r,width:e,height:t}),st.jsx("canvas",{className:Cy.canvas,ref:o,width:e,height:t})]})}),_me="_container_1gr1m_1",Ame="_container__parent-fill_1gr1m_7",Ome="_container__paused_1gr1m_15",Pme="_world-pause-action_1gr1m_31",Mme="_world-gravity_1gr1m_38",Ya={container:_me,containerParentFill:Ame,containerPaused:Ome,worldPauseAction:Pme,worldGravity:Mme},f_=S.memo(({paused:n,gravity:e,pauseResumeKeyCode:t,onGravityChanged:i,onPausedChanged:r,onSetContexts:o,onAdditionalForce:s,children:a})=>{const l=S.useRef(null),{width:c=0,height:u=0}=gv({ref:l,box:"border-box"}),d=qi(()=>r(!n));ZO(t,d,l),TI(qi(({x:h,y:p,buttons:m})=>{m&2**0?s==null||s({x:h-c/2,y:p-u/2}):s==null||s()}),$t(s)?void 0:l),S.useEffect(()=>void r(n),[n,r]);const f=qi(({value:h})=>i(h));return st.jsxs("div",{ref:l,className:Ya.container,tabIndex:-1,children:[st.jsx(Rme,{className:Ya.containerParentFill,width:c,height:u,onCanvasContext:o}),n&&st.jsx("div",{className:Ya.containerParentFill,children:st.jsx(vw,{className:Ya.containerPaused,onClick:d})}),st.jsx(vl,{className:Ya.worldPauseAction,icon:n?st.jsx(vw,{}):st.jsx(UB,{}),onClick:d}),st.jsx(kA,{className:Ya.worldGravity,value:e,vertical:!0,onChange:f,min:.1,step:.1,max:2}),a]})}),Fme=S.memo(()=>{const n=nf(),e=bl(bv),[t,i]=S.useState(!0),r=gme(),o=bl(wA),s=qi(d=>n(CA(d))),[a,l]=h_(),c=a_(t,qi((d,f)=>Array(f).fill(0).map(()=>8+Math.round(Math.random()*2400)/100))),u=l_(c,a,{gravity:o});return S.useEffect(()=>void(u==null?void 0:u.clear().then(()=>$t(r)?void 0:u.addCompetition(r))),[u,r]),ml(e,{synced:()=>st.jsx(f_,{paused:t,gravity:o,pauseResumeKeyCode:"Space",onGravityChanged:s,onPausedChanged:i,onSetContexts:l}),unsynced:d=>st.jsx("div",{className:br.alertContainer,children:xl(d)?st.jsx(rf,{fail:d.fail}):st.jsx(D1,{message:"Competition not started",description:st.jsxs("div",{className:br.leftAligned,children:[st.jsx("p",{children:"The goal of the application is to find the structure of the neural network and its weights using a genetic algorithm to balance the pendulum around the zero mark."}),st.jsxs("ul",{children:[st.jsx("li",{children:"Create a new competition or continue a saved one by making a selection from the list provided below."}),st.jsx("li",{children:"After loading, the fitness function will be on pause; you need to start the execution."}),st.jsx("li",{children:"The generations table will display neural networks sorted by ranking along with their scored points."}),st.jsx("li",{children:"You can select a neural network and see how it performs in the testing tab (you can add influence by clicking and holding the mouse and dragging it to the weight of the pendulum)."})]}),st.jsx("p",{children:"The simulation speed will depend on the available performance, automatically adjusting to the maximum possible while ensuring a responsive UI."})]}),type:"info",showIcon:!0})})})}),Lme="_container_3wv84_1",zme="_list_3wv84_9",Bme="_grid_3wv84_16",Hm={container:Lme,list:zme,grid:Bme},Vme=S.memo(()=>{const n=S.useRef(null),{width:e=0,height:t=0}=gv({ref:n,box:"border-box"}),i=nf(),r=bl(SA),o=bl(bv),s=mv(),a=qi(h=>{$t(h)?i(IA(zc({competitionStart:new Date().toISOString(),generations:[]}))):i($A(h))}),l=S.useMemo(()=>ml(r,{synced:({value:h})=>["new",...h],unsynced:h=>h===hA?["new"]:[]}),[r]),c=S.useMemo(()=>gl(o)?o.value.generations:[],[o]),u=S.useMemo(()=>c.reduce((h,{players:{length:p}})=>Math.max(h,p),0),[c]),d=S.useMemo(()=>[{title:"#",dataIndex:"id",key:"id",fixed:"left",width:80,sorter:(h,p)=>h.id-p.id,defaultSortOrder:"descend"},{title:"Best score",dataIndex:"maxScore",key:"maxScore",fixed:"left",width:110,render:h=>st.jsx(uA,{color:h>0?"green":h<0?"red":"blue",children:h})},...new Array(u).fill(0).map((h,p)=>({title:`Player #${p+1}`,dataIndex:`player-${p}`,key:`player-${p}`,width:340,render:m=>st.jsx(dA,{count:m.score,overflowCount:m.score,color:m.score>0?"green":m.score<0?"red":"blue",children:st.jsx(vl,{type:"link",onClick:()=>s(`/pendulum/${m.name}`),children:m.name})})}))],[u,s]),f=S.useMemo(()=>c.map(({id:h,maxScore:p,players:m})=>m.reduce((g,v,x)=>({...g,[`player-${x}`]:v}),{key:h,id:h,maxScore:p})),[c]);return st.jsxs("div",{ref:n,className:Hm.container,children:[(xl(r)||xl(o))&&st.jsx(rf,{fail:r.fail??o.fail}),(Zs(o)||Sy(o)||Zs(r)||Sy(r))&&st.jsx(ng,{className:Hm.list,loading:Zs(r)||Zs(o),itemLayout:"horizontal",dataSource:l,renderItem:h=>st.jsx(ng.Item,{children:st.jsx(vl,{type:"link",size:"small",onClick:()=>a(h==="new"?void 0:h),children:h==="new"?"Create New":`Continue with ${new Date(h).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}`},"start")})}),Iy(o)&&Iy(r)&&st.jsx(Jo,{virtual:!0,className:Hm.grid,dataSource:f,columns:d,pagination:!1,bordered:!0,scroll:{x:Math.ceil(e),y:Math.ceil(t-56)}})]})}),Wme=.2;class Gme{constructor(){jn(this,"type",ka.Human);jn(this,"name","Human");jn(this,"pressedKeys",new Set);jn(this,"handleKeyDownEvent",({code:e})=>this.pressedKeys.add(e));jn(this,"handleKeyUpEvent",({code:e})=>this.pressedKeys.delete(e));window.addEventListener("keydown",this.handleKeyDownEvent),window.addEventListener("keyup",this.handleKeyUpEvent)}play(){let e=0;return this.pressedKeys.has("ArrowLeft")&&e--,this.pressedKeys.has("ArrowRight")&&e++,(this.pressedKeys.has("ShiftLeft")||this.pressedKeys.has("ShiftRight"))&&(e*=5),{pivotVelocity:e*Wme}}dispose(){window.removeEventListener("keydown",this.handleKeyDownEvent),window.removeEventListener("keyup",this.handleKeyUpEvent)}}const Hme=S.memo(()=>{const n=nf(),e=o_(),t=S.useMemo(()=>ml(e,{synced:({value:m})=>zc(m),unsynced:m=>Zs(m)||xl(m)?m:zc(new Gme)}),[e]),[i,r]=S.useState(!0),o=bl(EA),s=qi(m=>n(NA(m))),[a,l]=S.useState(),[c,u]=h_(),d=a_(i),f=l_(d,c,{gravity:o});S.useEffect(()=>void(f==null?void 0:f.clear().then(()=>{gl(t)&&f.addPlayer(t.value)})),[f,t]),S.useEffect(()=>{$t(f)||f.setAdditionalForcePosition(a)},[f,a]);const h=mv(),p=qi(()=>h("/pendulum"));return Zs(t)?st.jsx("div",{className:br.alertContainer,children:st.jsx(E1,{})}):xl(t)?st.jsx(rf,{fail:t.fail}):st.jsx(f_,{paused:i,gravity:o,pauseResumeKeyCode:"Space",onAdditionalForce:l,onGravityChanged:s,onPausedChanged:r,onSetContexts:u,children:gl(t)&&st.jsxs(st.Fragment,{children:[t.value.type===ka.Human&&st.jsxs("div",{className:br.description,children:[st.jsx(tV,{}),t.value.name]}),t.value.type===ka.Robot&&st.jsxs("div",{className:br.descriptionWithRemoval,onClick:p,children:[st.jsx(g$,{}),t.value.name,st.jsx(dv,{className:br.descriptionClose})]})]})})}),Ume=[{id:"Fitness Playground",component:"FitnessPlayground",tabComponent:"default"},{id:"Generations List",component:"GenerationsList",tabComponent:"default"},{id:"Test Playground",component:"TestPlayground"},{id:"Neural Network",component:"DrawNeuralNetwork"}],age={grid:{root:{type:"branch",data:[{type:"leaf",data:{views:["Fitness Playground"],activeView:"Fitness Playground",id:"1"},size:100},{type:"leaf",data:{views:["Generations List"],activeView:"Generations List",id:"2"},size:100},{type:"branch",data:[{type:"leaf",data:{views:["Test Playground"],activeView:"Test Playground",id:"3"},size:100},{type:"leaf",data:{views:["Neural Network"],activeView:"Neural Network",id:"4"},size:100}],size:100}],size:100},width:204,height:308,orientation:Je.VERTICAL},panels:{"Fitness Playground":{id:"Fitness Playground",contentComponent:"FitnessPlayground",tabComponent:"default",params:{title:"Fitness Playground"},title:"Fitness Playground"},"Generations List":{id:"Generations List",contentComponent:"GenerationsList",tabComponent:"default",params:{title:"Generations"},title:"Generations List"},"Test Playground":{id:"Test Playground",contentComponent:"TestPlayground",title:"Test Playground"},"Neural Network":{id:"Neural Network",contentComponent:"DrawNeuralNetwork",title:"Neural Network"}},activeGroup:"2"},lge={FitnessPlayground:Fme,GenerationsList:Vme,TestPlayground:Hme,DrawNeuralNetwork:rme},cge={default:n=>st.jsx("div",{className:"dv-default-tab",children:st.jsx("div",{className:"dv-default-tab-content",children:n.params.title})})};function uge(n){const e=Ume.find(t=>t.id===n);if($t(e))throw new Error(`Unknown layout tab: ${n}`);return e}const dge=$1(()=>{const n=new dP(void 0);return{registerApi(e){n.next(e)},resetApi(){n.next(void 0)},async openTab(e){await lI(n.pipe(ZP(t=>!$t(t)),su(t=>t.addPanel(e))))}}});export{Ume as A,age as D,lge as L,F4 as M,dge as a,tH as b,cge as c,uge as g,IF as u};
